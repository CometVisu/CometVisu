define("plugins/calendarlist/structure_plugin",["structure_custom"],function(e){function t(e){var n=$("#"+e+" .actor"),r=templateEngine.widgetDataGet(e),i=r.refresh,s=r.src,o=r.maxquantity,u=r.calendar,a=r.days;return $(function(){$(n).calendarListlocal({src:s,maxquantity:o,calendar:u})}),typeof i!="undefined"&&i&&window.setTimeout(function(e){t(e)},i*1e3*60,n),!1}e.prototype.addCreator("calendarlist",{create:function(e,n,r,i){var s=$(e),o="calendarList_"+n,u=templateEngine.design.setWidgetLayout(s,n),a='<div class="widget clearfix calendarList '+u+'">';a+=templateEngine.design.extractLabel(page.find("label")[0],r);var f=""+s.attr("width")?"width:"+s.attr("width")+";":""+s.attr("height")?"height:"+s.attr("height"):"",l='<div class="actor calendarListBody"><div class="calendarList_inline" id="'+o+'" style="'+f+'"></div></div>',c=templateEngine.widgetDataInsert(n,{src:"plugins/calendarlist/calendarlist.php",maxquantity:s.attr("maxquantity"),refresh:s.attr("refresh"),calendar:s.find("calendar"),days:s.find("days")});return templateEngine.bindActionForLoadingFinished(function(){t(n)}),a+l+"</div>"}}),function(e){jQuery.fn.extend({calendarListlocal:function(t){var n={src:"",days:30,html:"<span>{date}: {text}{where}</span>",wrapper:"li",dataType:"json",datetime:!0},t=jQuery.extend(n,t);return this.each(function(){var n=t,r=jQuery(this);if(n.src==""){console.log("calendarListlocal: no src URL");return}var i={maxquantity:n.maxquantity};for(var s=0;s<n.calendar.length;s++){var o="calendarname"+s,u="type"+s,a="userid"+s,f="magiccookie"+s,l="days"+s;i[o]=s,i[u]=n.calendar[s].getAttribute("type"),i[a]=n.calendar[s].getAttribute("userid"),n.calendar[s].hasAttribute("magiccookie")===!0?i[f]=n.calendar[s].getAttribute("magiccookie"):i[f]="",n.calendar[s].hasAttribute("days")===!0?i[l]=n.calendar[s].getAttribute("days"):i[l]=n.days}jQuery.ajax({url:n.src,type:"POST",data:i,dataType:n.dataType,error:function(t,i,s){console.log("C: #%s, Error: %s, calendarList: %s",e(r).attr("id"),s,n.src)},success:function(t){r.html("");var i=t.calendarList.calendarListEntries,s=i.length,o="",u="";for(var a=0;a<s;a++){var f=i[a],l=n.html;color="#FFFFFF";for(var h=0;h<n.calendar.length;h++)f.calendarName==h&&(n.calendar[h].hasAttribute("color")===!0?color=n.calendar[h].getAttribute("color"):color="#FFFFFF",n.calendar[h].hasAttribute("format")===!0?format=n.calendar[h].getAttribute("format"):format="{date}: {text}{where}",l="<span>"+format+"</span>");o=f.StartDate,f.StartTime!="00:00"&&(o=o+", "+f.StartTime);if(f.StartDate!=f.EndDate||f.StartTime!=f.EndTime)o+=" - ";f.StartDate!=f.EndDate?o=o+f.EndDate+", "+f.EndTime:f.StartTime!=f.EndTime&&(o+=f.EndTime),l=l.replace(/{text}/,f.description),f.where!=""?where=" ("+f.where+")":where=f.where,l=l.replace(/{where}/,where),l=l.replace(/{date}/,o);var p=e('<span style="color:'+color+'">').append(l).append("</span><br>");r.append(p)}}})})}})}(jQuery)});