/*!
 * Farbtastic: jQuery color picker plug-in v1.3u
 *
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */

(function(e){e.fn.farbtastic=function(t){return e.farbtastic(this,t),this},e.farbtastic=function(t,n){return t=e(t).get(0),t.farbtastic||(t.farbtastic=new e._farbtastic(t,n))},e._farbtastic=function(t,n){var r=this;e(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var i=e(".farbtastic",t);r.wheel=e(".wheel",t).get(0),r.radius=84,r.square=100,r.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&e("*",i).each(function(){if(this.currentStyle.backgroundImage!="none"){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),e(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),r.linkTo=function(t){typeof r.callback=="object"&&e(r.callback).unbind("keyup",r.updateValue),r.color=null;if(typeof t=="function")r.callback=t;else if(typeof t=="object"||typeof t=="string")r.callback=e(t),r.callback.bind("keyup",r.updateValue),r.callback.get(0).value&&r.setColor(r.callback.get(0).value);return this},r.updateValue=function(){this.value&&this.value!=r.color&&r.setColor(this.value)},r.setColor=function(e){var t=r.unpack(e);return r.color!=e&&t&&(r.color=e,r.rgb=t,r.hsl=r.RGBToHSL(r.rgb),r.updateDisplay()),this},r.setHSL=function(e){return r.hsl=e,r.rgb=r.HSLToRGB(e),r.color=r.pack(r.rgb),r.updateDisplay(),this},r.widgetCoords=function(t){var n=e(r.wheel).offset();return{x:t.pageX-n.left-r.width/2,y:t.pageY-n.top-r.width/2}},r.mousedown=function(t){document.dragging||(e(document).bind("mousemove",r.mousemove).bind("mouseup",r.mouseup),document.dragging=!0);var n=r.widgetCoords(t);return r.circleDrag=Math.max(Math.abs(n.x),Math.abs(n.y))*2>r.square,r.mousemove(t),!1},r.mousemove=function(e){var t=r.widgetCoords(e);return r.circleDrag?(e=Math.atan2(t.x,-t.y)/6.28,e<0&&(e+=1),r.setHSL([e,r.hsl[1],r.hsl[2]])):(e=Math.max(0,Math.min(1,-(t.x/r.square)+.5)),t=Math.max(0,Math.min(1,-(t.y/r.square)+.5)),r.setHSL([r.hsl[0],e,t])),!1},r.mouseup=function(){e(document).unbind("mousemove",r.mousemove),e(document).unbind("mouseup",r.mouseup),document.dragging=!1},r.updateDisplay=function(){var t=r.hsl[0]*6.28;e(".h-marker",i).css({left:Math.round(Math.sin(t)*r.radius+r.width/2)+"px",top:Math.round(-Math.cos(t)*r.radius+r.width/2)+"px"}),e(".sl-marker",i).css({left:Math.round(r.square*(.5-r.hsl[1])+r.width/2)+"px",top:Math.round(r.square*(.5-r.hsl[2])+r.width/2)+"px"}),e(".color",i).css("backgroundColor",r.pack(r.HSLToRGB([r.hsl[0],1,.5]))),typeof r.callback=="object"?(e(r.callback).css({backgroundColor:r.color,color:r.hsl[2]>.5?"#000":"#fff"}),e(r.callback).each(function(){this.value&&this.value!=r.color&&(this.value=r.color)})):typeof r.callback=="function"&&r.callback.call(r,r.color)},r.pack=function(e){var t=Math.round(e[0]*255),n=Math.round(e[1]*255);return e=Math.round(e[2]*255),"#"+(t<16?"0":"")+t.toString(16)+(n<16?"0":"")+n.toString(16)+(e<16?"0":"")+e.toString(16)},r.unpack=function(e){if(e.length==7)return[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255];if(e.length==4)return[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]},r.HSLToRGB=function(e){var t,n=e[0];return t=e[1],e=e[2],t=e<=.5?e*(t+1):e+t-e*t,e=e*2-t,[this.hueToRGB(e,t,n+.33333),this.hueToRGB(e,t,n),this.hueToRGB(e,t,n-.33333)]},r.hueToRGB=function(e,t,n){return n=n<0?n+1:n>1?n-1:n,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(.66666-n)*6:e},r.RGBToHSL=function(e){var t,n,r,i,s=e[0],o=e[1],u=e[2];return t=Math.min(s,Math.min(o,u)),e=Math.max(s,Math.max(o,u)),n=e-t,i=(t+e)/2,r=0,i>0&&i<1&&(r=n/(i<.5?2*i:2-2*i)),t=0,n>0&&(e==s&&e!=o&&(t+=(o-u)/n),e==o&&e!=u&&(t+=2+(u-s)/n),e==u&&e!=s&&(t+=4+(s-o)/n),t/=6),[t,r,i]},e("*",i).mousedown(r.mousedown),r.setColor("#000000"),n&&r.linkTo(n)}})(jQuery);