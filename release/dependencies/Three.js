var THREE=THREE||{};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),THREE.Clock=function(e){this.autoStart=e!==void 0?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime+=this.getDelta(),this.elapsedTime},THREE.Clock.prototype.getDelta=function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e},THREE.Color=function(e){return e!==void 0&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var r,i,s;if(n===0)this.r=this.g=this.b=0;else switch(r=Math.floor(e*6),i=e*6-r,e=n*(1-t),s=n*(1-t*i),t=n*(1-t*(1-i)),r){case 1:this.r=s,this.g=n,this.b=e;break;case 2:this.r=e,this.g=n,this.b=t;break;case 3:this.r=e,this.g=s,this.b=n;break;case 4:this.r=t,this.g=e,this.b=n;break;case 5:this.r=n,this.g=e,this.b=s;break;case 6:case 0:this.r=n,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},getHex:function(){return~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return e.x===this.x&&e.y===this.y}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideSelf:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},setPositionFromMatrix:function(e){this.x=e.n14,this.y=e.n24,this.z=e.n34},setRotationFromMatrix:function(e){var t=Math.cos(this.y);this.y=Math.asin(e.n13),Math.abs(t)>1e-5?(this.x=Math.atan2(-e.n23/t,e.n33/t),this.z=Math.atan2(-e.n12/t,e.n11/t)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return this.lengthSq()<1e-4}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==void 0?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},THREE.Ray=function(e,t){function n(e,t,n){return c.sub(n,e),d=c.dot(t),d<=0?null:(v=h.add(e,p.copy(t).multiplyScalar(d)),m=n.distanceTo(v))}function r(e,t,n,r){return c.sub(r,t),h.sub(n,t),p.sub(e,t),g=c.dot(c),y=c.dot(h),b=c.dot(p),w=h.dot(h),E=h.dot(p),S=1/(g*w-y*y),x=(w*b-y*E)*S,T=(g*E-y*b)*S,x>=0&&T>=0&&x+T<1}this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3,this.intersectScene=function(e){return this.intersectObjects(e.children)},this.intersectObjects=function(e){var t,n,r=[];t=0;for(n=e.length;t<n;t++)Array.prototype.push.apply(r,this.intersectObject(e[t]));return r.sort(function(e,t){return e.distance-t.distance}),r};var i=new THREE.Vector3,s=new THREE.Vector3,o=new THREE.Vector3,u=new THREE.Vector3,e=new THREE.Vector3,t=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3;this.intersectObject=function(c){for(var h,p=[],d=0,v=c.children.length;d<v;d++)Array.prototype.push.apply(p,this.intersectObject(c.children[d]));if(c instanceof THREE.Particle){d=n(this.origin,this.direction,c.matrixWorld.getPosition());if(d===null||d>c.scale.x)return[];h={distance:d,point:c.position,face:null,object:c},p.push(h)}else if(c instanceof THREE.Mesh){d=n(this.origin,this.direction,c.matrixWorld.getPosition());if(d===null||d>c.geometry.boundingSphere.radius*Math.max(c.scale.x,Math.max(c.scale.y,c.scale.z)))return p;var m,g=c.geometry,y=g.vertices,b;c.matrixRotationWorld.extractRotation(c.matrixWorld),d=0;for(v=g.faces.length;d<v;d++)if(h=g.faces[d],e.copy(this.origin),t.copy(this.direction),b=c.matrixWorld,a=b.multiplyVector3(a.copy(h.centroid)).subSelf(e),m=a.dot(t),!(m<=0)&&(i=b.multiplyVector3(i.copy(y[h.a].position)),s=b.multiplyVector3(s.copy(y[h.b].position)),o=b.multiplyVector3(o.copy(y[h.c].position)),h instanceof THREE.Face4&&(u=b.multiplyVector3(u.copy(y[h.d].position))),f=c.matrixRotationWorld.multiplyVector3(f.copy(h.normal)),m=t.dot(f),c.doubleSided||(c.flipSided?m>0:m<0)))(m=f.dot(a.sub(i,e))/m,l.add(e,t.multiplyScalar(m)),h instanceof THREE.Face3)?r(l,i,s,o)&&(h={distance:e.distanceTo(l),point:l.clone(),face:h,object:c},p.push(h)):h instanceof THREE.Face4&&(r(l,i,s,u)||r(l,s,o,u))&&(h={distance:e.distanceTo(l),point:l.clone(),face:h,object:c},p.push(h))}return p};var c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d,v,m,g,y,b,w,E,S,x,T},THREE.Rectangle=function(){function e(){s=r-t,o=i-n}var t,n,r,i,s,o,u=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return s},this.getHeight=function(){return o},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return r},this.getBottom=function(){return i},this.set=function(s,o,f,l){u=!1,t=s,n=o,r=f,i=l,e()},this.addPoint=function(s,o){u?(u=!1,t=s,n=o,r=s,i=o):(t=t<s?t:s,n=n<o?n:o,r=r>s?r:s,i=i>o?i:o),e()},this.add3Points=function(s,o,f,l,p,v){u?(u=!1,t=s<f?s<p?s:p:f<p?f:p,n=o<l?o<v?o:v:l<v?l:v,r=s>f?s>p?s:p:f>p?f:p,i=o>l?o>v?o:v:l>v?l:v):(t=s<f?s<p?s<t?s:t:p<t?p:t:f<p?f<t?f:t:p<t?p:t,n=o<l?o<v?o<n?o:n:v<n?v:n:l<v?l<n?l:n:v<n?v:n,r=s>f?s>p?s>r?s:r:p>r?p:r:f>p?f>r?f:r:p>r?p:r,i=o>l?o>v?o>i?o:i:v>i?v:i:l>v?l>i?l:i:v>i?v:i),e()},this.addRectangle=function(s){u?(u=!1,t=s.getLeft(),n=s.getTop(),r=s.getRight(),i=s.getBottom()):(t=t<s.getLeft()?t:s.getLeft(),n=n<s.getTop()?n:s.getTop(),r=r>s.getRight()?r:s.getRight(),i=i>s.getBottom()?i:s.getBottom()),e()},this.inflate=function(s){t-=s,n-=s,r+=s,i+=s,e()},this.minSelf=function(s){t=t>s.getLeft()?t:s.getLeft(),n=n>s.getTop()?n:s.getTop(),r=r<s.getRight()?r:s.getRight(),i=i<s.getBottom()?i:s.getBottom(),e()},this.intersects=function(e){return Math.min(r,e.getRight())-Math.max(t,e.getLeft())>=0&&Math.min(i,e.getBottom())-Math.max(n,e.getTop())>=0},this.empty=function(){u=!0,i=r=n=t=0,e()},this.isEmpty=function(){return u}},THREE.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var e,t=this.m;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.set(e!==void 0?e:1,t||0,n||0,r||0,i||0,s!==void 0?s:1,o||0,u||0,a||0,f||0,l!==void 0?l:1,c||0,h||0,p||0,d||0,v!==void 0?v:1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return this.n11=e,this.n12=t,this.n13=n,this.n14=r,this.n21=i,this.n22=s,this.n23=o,this.n24=u,this.n31=a,this.n32=f,this.n33=l,this.n34=c,this.n41=h,this.n42=p,this.n43=d,this.n44=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.set(e.n11,e.n12,e.n13,e.n14,e.n21,e.n22,e.n23,e.n24,e.n31,e.n32,e.n33,e.n34,e.n41,e.n42,e.n43,e.n44),this},lookAt:function(e,t,n){var r=THREE.Matrix4.__v1,i=THREE.Matrix4.__v2,s=THREE.Matrix4.__v3;return s.sub(e,t).normalize(),s.length()===0&&(s.z=1),r.cross(n,s).normalize(),r.length()===0&&(s.x+=1e-4,r.cross(n,s).normalize()),i.cross(s,r).normalize(),this.n11=r.x,this.n12=i.x,this.n13=s.x,this.n21=r.y,this.n22=i.y,this.n23=s.y,this.n31=r.z,this.n32=i.z,this.n33=s.z,this},multiply:function(e,t){var n=e.n11,r=e.n12,i=e.n13,s=e.n14,o=e.n21,u=e.n22,a=e.n23,f=e.n24,l=e.n31,c=e.n32,h=e.n33,p=e.n34,d=e.n41,v=e.n42,m=e.n43,g=e.n44,y=t.n11,b=t.n12,w=t.n13,E=t.n14,S=t.n21,x=t.n22,T=t.n23,N=t.n24,C=t.n31,k=t.n32,L=t.n33,A=t.n34,O=t.n41,M=t.n42,_=t.n43,D=t.n44;return this.n11=n*y+r*S+i*C+s*O,this.n12=n*b+r*x+i*k+s*M,this.n13=n*w+r*T+i*L+s*_,this.n14=n*E+r*N+i*A+s*D,this.n21=o*y+u*S+a*C+f*O,this.n22=o*b+u*x+a*k+f*M,this.n23=o*w+u*T+a*L+f*_,this.n24=o*E+u*N+a*A+f*D,this.n31=l*y+c*S+h*C+p*O,this.n32=l*b+c*x+h*k+p*M,this.n33=l*w+c*T+h*L+p*_,this.n34=l*E+c*N+h*A+p*D,this.n41=d*y+v*S+m*C+g*O,this.n42=d*b+v*x+m*k+g*M,this.n43=d*w+v*T+m*L+g*_,this.n44=d*E+v*N+m*A+g*D,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,n){return this.multiply(e,t),n[0]=this.n11,n[1]=this.n21,n[2]=this.n31,n[3]=this.n41,n[4]=this.n12,n[5]=this.n22,n[6]=this.n32,n[7]=this.n42,n[8]=this.n13,n[9]=this.n23,n[10]=this.n33,n[11]=this.n43,n[12]=this.n14,n[13]=this.n24,n[14]=this.n34,n[15]=this.n44,this},multiplyScalar:function(e){return this.n11*=e,this.n12*=e,this.n13*=e,this.n14*=e,this.n21*=e,this.n22*=e,this.n23*=e,this.n24*=e,this.n31*=e,this.n32*=e,this.n33*=e,this.n34*=e,this.n41*=e,this.n42*=e,this.n43*=e,this.n44*=e,this},multiplyVector3:function(e){var t=e.x,n=e.y,r=e.z,i=1/(this.n41*t+this.n42*n+this.n43*r+this.n44);return e.x=(this.n11*t+this.n12*n+this.n13*r+this.n14)*i,e.y=(this.n21*t+this.n22*n+this.n23*r+this.n24)*i,e.z=(this.n31*t+this.n32*n+this.n33*r+this.n34)*i,e},multiplyVector4:function(e){var t=e.x,n=e.y,r=e.z,i=e.w;return e.x=this.n11*t+this.n12*n+this.n13*r+this.n14*i,e.y=this.n21*t+this.n22*n+this.n23*r+this.n24*i,e.z=this.n31*t+this.n32*n+this.n33*r+this.n34*i,e.w=this.n41*t+this.n42*n+this.n43*r+this.n44*i,e},rotateAxis:function(e){var t=e.x,n=e.y,r=e.z;return e.x=t*this.n11+n*this.n12+r*this.n13,e.y=t*this.n21+n*this.n22+r*this.n23,e.z=t*this.n31+n*this.n32+r*this.n33,e.normalize(),e},crossVector:function(e){var t=new THREE.Vector4;return t.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w,t.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w,t.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w,t.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1,t},determinant:function(){var e=this.n11,t=this.n12,n=this.n13,r=this.n14,i=this.n21,s=this.n22,o=this.n23,u=this.n24,a=this.n31,f=this.n32,l=this.n33,c=this.n34,h=this.n41,p=this.n42,d=this.n43,v=this.n44;return r*o*f*h-n*u*f*h-r*s*l*h+t*u*l*h+n*s*c*h-t*o*c*h-r*o*a*p+n*u*a*p+r*i*l*p-e*u*l*p-n*i*c*p+e*o*c*p+r*s*a*d-t*u*a*d-r*i*f*d+e*u*f*d+t*i*c*d-e*s*c*d-n*s*a*v+t*o*a*v+n*i*f*v-e*o*f*v-t*i*l*v+e*s*l*v},transpose:function(){var e;return e=this.n21,this.n21=this.n12,this.n12=e,e=this.n31,this.n31=this.n13,this.n13=e,e=this.n32,this.n32=this.n23,this.n23=e,e=this.n41,this.n41=this.n14,this.n14=e,e=this.n42,this.n42=this.n24,this.n24=e,e=this.n43,this.n43=this.n34,this.n43=e,this},clone:function(){var e=new THREE.Matrix4;return e.n11=this.n11,e.n12=this.n12,e.n13=this.n13,e.n14=this.n14,e.n21=this.n21,e.n22=this.n22,e.n23=this.n23,e.n24=this.n24,e.n31=this.n31,e.n32=this.n32,e.n33=this.n33,e.n34=this.n34,e.n41=this.n41,e.n42=this.n42,e.n43=this.n43,e.n44=this.n44,e},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(e){return e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,e},flattenToArrayOffset:function(e,t){return e[t]=this.n11,e[t+1]=this.n21,e[t+2]=this.n31,e[t+3]=this.n41,e[t+4]=this.n12,e[t+5]=this.n22,e[t+6]=this.n32,e[t+7]=this.n42,e[t+8]=this.n13,e[t+9]=this.n23,e[t+10]=this.n33,e[t+11]=this.n43,e[t+12]=this.n14,e[t+13]=this.n24,e[t+14]=this.n34,e[t+15]=this.n44,e},setTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},setScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},setRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},setRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},setRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},setPosition:function(e){return this.n14=e.x,this.n24=e.y,this.n34=e.z,this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(e){var t=e.n11,n=e.n12,r=e.n13,i=e.n14,s=e.n21,o=e.n22,u=e.n23,a=e.n24,f=e.n31,l=e.n32,c=e.n33,h=e.n34,p=e.n41,d=e.n42,v=e.n43,m=e.n44;return this.n11=u*h*d-a*c*d+a*l*v-o*h*v-u*l*m+o*c*m,this.n12=i*c*d-r*h*d-i*l*v+n*h*v+r*l*m-n*c*m,this.n13=r*a*d-i*u*d+i*o*v-n*a*v-r*o*m+n*u*m,this.n14=i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h,this.n21=a*c*p-u*h*p-a*f*v+s*h*v+u*f*m-s*c*m,this.n22=r*h*p-i*c*p+i*f*v-t*h*v-r*f*m+t*c*m,this.n23=i*u*p-r*a*p-i*s*v+t*a*v+r*s*m-t*u*m,this.n24=r*a*f-i*u*f+i*s*c-t*a*c-r*s*h+t*u*h,this.n31=o*h*p-a*l*p+a*f*d-s*h*d-o*f*m+s*l*m,this.n32=i*l*p-n*h*p-i*f*d+t*h*d+n*f*m-t*l*m,this.n33=r*a*p-i*o*p+i*s*d-t*a*d-n*s*m+t*o*m,this.n34=i*o*f-n*a*f-i*s*l+t*a*l+n*s*h-t*o*h,this.n41=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,this.n42=n*c*p-r*l*p+r*f*d-t*c*d-n*f*v+t*l*v,this.n43=r*o*p-n*u*p-r*s*d+t*u*d+n*s*v-t*o*v,this.n44=n*u*f-r*o*f+r*s*l-t*u*l-n*s*c+t*o*c,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var n=e.x,r=e.y,i=e.z,s=Math.cos(n),n=Math.sin(n),o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i);switch(t){case"YXZ":var a=o*u,f=o*i,l=r*u,c=r*i;this.n11=a+c*n,this.n12=l*n-f,this.n13=s*r,this.n21=s*i,this.n22=s*u,this.n23=-n,this.n31=f*n-l,this.n32=c+a*n,this.n33=s*o;break;case"ZXY":a=o*u,f=o*i,l=r*u,c=r*i,this.n11=a-c*n,this.n12=-s*i,this.n13=l+f*n,this.n21=f+l*n,this.n22=s*u,this.n23=c-a*n,this.n31=-s*r,this.n32=n,this.n33=s*o;break;case"ZYX":a=s*u,f=s*i,l=n*u,c=n*i,this.n11=o*u,this.n12=l*r-f,this.n13=a*r+c,this.n21=o*i,this.n22=c*r+a,this.n23=f*r-l,this.n31=-r,this.n32=n*o,this.n33=s*o;break;case"YZX":a=s*o,f=s*r,l=n*o,c=n*r,this.n11=o*u,this.n12=c-a*i,this.n13=l*i+f,this.n21=i,this.n22=s*u,this.n23=-n*u,this.n31=-r*u,this.n32=f*i+l,this.n33=a-c*i;break;case"XZY":a=s*o,f=s*r,l=n*o,c=n*r,this.n11=o*u,this.n12=-i,this.n13=r*u,this.n21=a*i+c,this.n22=s*u,this.n23=f*i-l,this.n31=l*i-f,this.n32=n*u,this.n33=c*i+a;break;default:a=s*u,f=s*i,l=n*u,c=n*i,this.n11=o*u,this.n12=-o*i,this.n13=r,this.n21=f+l*r,this.n22=a-c*r,this.n23=-n*o,this.n31=c-a*r,this.n32=l+f*r,this.n33=s*o}return this},setRotationFromQuaternion:function(e){var t=e.x,n=e.y,r=e.z,i=e.w,s=t+t,o=n+n,u=r+r,e=t*s,a=t*o;t*=u;var f=n*o;return n*=u,r*=u,s*=i,o*=i,i*=u,this.n11=1-(f+r),this.n12=a-i,this.n13=t+o,this.n21=a+i,this.n22=1-(e+r),this.n23=n-s,this.n31=t-o,this.n32=n+s,this.n33=1-(e+f),this},scale:function(e){var t=e.x,n=e.y,e=e.z;return this.n11*=t,this.n12*=n,this.n13*=e,this.n21*=t,this.n22*=n,this.n23*=e,this.n31*=t,this.n32*=n,this.n33*=e,this.n41*=t,this.n42*=n,this.n43*=e,this},compose:function(e,t,n){var r=THREE.Matrix4.__m1,i=THREE.Matrix4.__m2;return r.identity(),r.setRotationFromQuaternion(t),i.setScale(n.x,n.y,n.z),this.multiply(r,i),this.n14=e.x,this.n24=e.y,this.n34=e.z,this},decompose:function(e,t,n){var r=THREE.Matrix4.__v1,i=THREE.Matrix4.__v2,s=THREE.Matrix4.__v3;return r.set(this.n11,this.n21,this.n31),i.set(this.n12,this.n22,this.n32),s.set(this.n13,this.n23,this.n33),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=r.length(),n.y=i.length(),n.z=s.length(),e.x=this.n14,e.y=this.n24,e.z=this.n34,r=THREE.Matrix4.__m1,r.copy(this),r.n11/=n.x,r.n21/=n.x,r.n31/=n.x,r.n12/=n.y,r.n22/=n.y,r.n32/=n.y,r.n13/=n.z,r.n23/=n.z,r.n33/=n.z,t.setFromRotationMatrix(r),[e,t,n]},extractPosition:function(e){return this.n14=e.n14,this.n24=e.n24,this.n34=e.n34,this},extractRotation:function(e){var t=THREE.Matrix4.__v1,n=1/t.set(e.n11,e.n21,e.n31).length(),r=1/t.set(e.n12,e.n22,e.n32).length(),t=1/t.set(e.n13,e.n23,e.n33).length();return this.n11=e.n11*n,this.n21=e.n21*n,this.n31=e.n31*n,this.n12=e.n12*r,this.n22=e.n22*r,this.n32=e.n32*r,this.n13=e.n13*t,this.n23=e.n23*t,this.n33=e.n33*t,this}},THREE.Matrix4.makeInvert3x3=function(e){var t=e.m33,n=t.m,r=e.n33*e.n22-e.n32*e.n23,i=-e.n33*e.n21+e.n31*e.n23,s=e.n32*e.n21-e.n31*e.n22,o=-e.n33*e.n12+e.n32*e.n13,u=e.n33*e.n11-e.n31*e.n13,a=-e.n32*e.n11+e.n31*e.n12,f=e.n23*e.n12-e.n22*e.n13,l=-e.n23*e.n11+e.n21*e.n13,c=e.n22*e.n11-e.n21*e.n12,e=e.n11*r+e.n21*o+e.n31*f;return e===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),e=1/e,n[0]=e*r,n[1]=e*i,n[2]=e*s,n[3]=e*o,n[4]=e*u,n[5]=e*a,n[6]=e*f,n[7]=e*l,n[8]=e*c,t},THREE.Matrix4.makeFrustum=function(e,t,n,r,i,s){var o;return o=new THREE.Matrix4,o.n11=2*i/(t-e),o.n12=0,o.n13=(t+e)/(t-e),o.n14=0,o.n21=0,o.n22=2*i/(r-n),o.n23=(r+n)/(r-n),o.n24=0,o.n31=0,o.n32=0,o.n33=-(s+i)/(s-i),o.n34=-2*s*i/(s-i),o.n41=0,o.n42=0,o.n43=-1,o.n44=0,o},THREE.Matrix4.makePerspective=function(e,t,n,r){var i,e=n*Math.tan(e*Math.PI/360);return i=-e,THREE.Matrix4.makeFrustum(i*t,e*t,i,e,n,r)},THREE.Matrix4.makeOrtho=function(e,t,n,r,i,s){var o,u,a,f;return o=new THREE.Matrix4,u=t-e,a=n-r,f=s-i,o.n11=2/u,o.n12=0,o.n13=0,o.n14=-((t+e)/u),o.n21=0,o.n22=2/a,o.n23=0,o.n24=-((n+r)/a),o.n31=0,o.n32=0,o.n33=-2/f,o.n34=-((s+i)/f),o.n41=0,o.n42=0,o.n43=0,o.n44=1,o},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.name="",this.id=THREE.Object3DCount++,this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(e){if(this.children.indexOf(e)===-1){e.parent!==void 0&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0,this.children.splice(t,1);for(t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.removeObject(e)}},getChildByName:function(e,t){var n,r,i;n=0;for(r=this.children.length;n<r;n++){i=this.children[n];if(i.name===e)return i;if(t&&(i=i.getChildByName(e,t),i!==void 0))return i}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=o[s]=o[s]||new THREE.RenderableObject;return s++,e}function t(){var e=f[a]=f[a]||new THREE.RenderableVertex;return a++,e}function n(e,t){return t.z-e.z}function r(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerpSelf(t,n),t.lerpSelf(e,1-r),!0))}var i,s,o=[],u,a,f=[],l,c,h=[],p,d=[],v,m,g=[],y,b,w=[],E={objects:[],sprites:[],lights:[],elements:[]},S=new THREE.Vector3,x=new THREE.Vector4,T=new THREE.Matrix4,N=new THREE.Matrix4,C=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],k=new THREE.Vector4,L=new THREE.Vector4;this.computeFrustum=function(e){C[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),C[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),C[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),C[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),C[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),C[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);for(e=0;e<6;e++){var t=C[e];t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}},this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),T.multiply(t.projectionMatrix,t.matrixWorldInverse),T.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),T.multiply(t.matrixWorld,t.projectionMatrixInverse),T.multiplyVector3(e),e},this.pickingRay=function(e,t){var n;return e.z=-1,n=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(n,t),n.subSelf(e).normalize(),new THREE.Ray(e,n)},this.projectGraph=function(t,r){s=0,E.objects.length=0,E.sprites.length=0,E.lights.length=0;var o=function(t){if(t.visible!==!1){var n;if(n=t instanceof THREE.Mesh||t instanceof THREE.Line)if(!(n=t.frustumCulled===!1))e:{for(var r=t.matrixWorld,s=-t.geometry.boundingSphere.radius*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)),u=0;u<6;u++)if(n=C[u].x*r.n14+C[u].y*r.n24+C[u].z*r.n34+C[u].w,n<=s){n=!1;break e}n=!0}n?(T.multiplyVector3(S.copy(t.position)),i=e(),i.object=t,i.z=S.z,E.objects.push(i)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(T.multiplyVector3(S.copy(t.position)),i=e(),i.object=t,i.z=S.z,E.sprites.push(i)):t instanceof THREE.Light&&E.lights.push(t),n=0;for(r=t.children.length;n<r;n++)o(t.children[n])}};return o(t),r&&E.objects.sort(n),E},this.projectScene=function(e,i,s){var o=i.near,S=i.far,C,A,O,M,_,D,P,H,j,I,R,U,z,W,X,V;b=m=p=c=0,E.elements.length=0,i.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(i)),e.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),T.multiply(i.projectionMatrix,i.matrixWorldInverse),this.computeFrustum(T),E=this.projectGraph(e,!1),e=0;for(C=E.objects.length;e<C;e++)if(j=E.objects[e].object,I=j.matrixWorld,U=j.material,a=0,j instanceof THREE.Mesh){R=j.geometry,z=j.geometry.materials,M=R.vertices,W=R.faces,X=R.faceVertexUvs,R=j.matrixRotationWorld.extractRotation(I),A=0;for(O=M.length;A<O;A++)u=t(),u.positionWorld.copy(M[A].position),I.multiplyVector3(u.positionWorld),u.positionScreen.copy(u.positionWorld),T.multiplyVector4(u.positionScreen),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.visible=u.positionScreen.z>o&&u.positionScreen.z<S;M=0;for(A=W.length;M<A;M++){O=W[M];if(O instanceof THREE.Face3){if(_=f[O.a],D=f[O.b],P=f[O.c],!(_.visible&&D.visible&&P.visible)||!j.doubleSided&&j.flipSided==(P.positionScreen.x-_.positionScreen.x)*(D.positionScreen.y-_.positionScreen.y)-(P.positionScreen.y-_.positionScreen.y)*(D.positionScreen.x-_.positionScreen.x)<0)continue;H=h[c]=h[c]||new THREE.RenderableFace3,c++,l=H,l.v1.copy(_),l.v2.copy(D),l.v3.copy(P)}else if(O instanceof THREE.Face4){if(_=f[O.a],D=f[O.b],P=f[O.c],H=f[O.d],!(_.visible&&D.visible&&P.visible&&H.visible)||!j.doubleSided&&j.flipSided==((H.positionScreen.x-_.positionScreen.x)*(D.positionScreen.y-_.positionScreen.y)-(H.positionScreen.y-_.positionScreen.y)*(D.positionScreen.x-_.positionScreen.x)<0||(D.positionScreen.x-P.positionScreen.x)*(H.positionScreen.y-P.positionScreen.y)-(D.positionScreen.y-P.positionScreen.y)*(H.positionScreen.x-P.positionScreen.x)<0))continue;V=d[p]=d[p]||new THREE.RenderableFace4,p++,l=V,l.v1.copy(_),l.v2.copy(D),l.v3.copy(P),l.v4.copy(H)}l.normalWorld.copy(O.normal),R.multiplyVector3(l.normalWorld),l.centroidWorld.copy(O.centroid),I.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),T.multiplyVector3(l.centroidScreen),P=O.vertexNormals,_=0;for(D=P.length;_<D;_++)H=l.vertexNormalsWorld[_],H.copy(P[_]),R.multiplyVector3(H);_=0;for(D=X.length;_<D;_++)if(V=X[_][M]){P=0;for(H=V.length;P<H;P++)l.uvs[_][P]=V[P]}l.material=U,l.faceMaterial=O.materialIndex!==null?z[O.materialIndex]:null,l.z=l.centroidScreen.z,E.elements.push(l)}}else if(j instanceof THREE.Line){N.multiply(T,I),M=j.geometry.vertices,_=t(),_.positionScreen.copy(M[0].position),N.multiplyVector4(_.positionScreen),A=1;for(O=M.length;A<O;A++)if(_=t(),_.positionScreen.copy(M[A].position),N.multiplyVector4(_.positionScreen),D=f[a-2],k.copy(_.positionScreen),L.copy(D.positionScreen),r(k,L))k.multiplyScalar(1/k.w),L.multiplyScalar(1/L.w),j=g[m]=g[m]||new THREE.RenderableLine,m++,v=j,v.v1.positionScreen.copy(k),v.v2.positionScreen.copy(L),v.z=Math.max(k.z,L.z),v.material=U,E.elements.push(v)}e=0;for(C=E.sprites.length;e<C;e++)if(j=E.sprites[e].object,I=j.matrixWorld,j instanceof THREE.Particle&&(x.set(I.n14,I.n24,I.n34,1),T.multiplyVector4(x),x.z/=x.w,x.z>0&&x.z<1))o=w[b]=w[b]||new THREE.RenderableParticle,b++,y=o,y.x=x.x/x.w,y.y=x.y/x.w,y.z=x.z,y.rotation=j.rotation.z,y.scale.x=j.scale.x*Math.abs(y.x-(x.x+i.projectionMatrix.n11)/(x.w+i.projectionMatrix.n14)),y.scale.y=j.scale.y*Math.abs(y.y-(x.y+i.projectionMatrix.n22)/(x.w+i.projectionMatrix.n24)),y.material=j.material,E.elements.push(y);return s&&E.elements.sort(n),E}},THREE.Quaternion=function(e,t,n,r){this.set(e||0,t||0,n||0,r!==void 0?r:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,n=e.x*t,r=e.y*t,i=e.z*t,e=Math.cos(r),r=Math.sin(r),t=Math.cos(-i),i=Math.sin(-i),s=Math.cos(n),n=Math.sin(n),o=e*t,u=r*i;return this.w=o*s-u*n,this.x=o*n+u*s,this.y=r*t*s+e*i*n,this.z=e*i*s-r*t*n,this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.n11+e.n22+e.n33))/2,this.x=Math.sqrt(Math.max(0,t+e.n11-e.n22-e.n33))/2,this.y=Math.sqrt(Math.max(0,t-e.n11+e.n22-e.n33))/2,this.z=Math.sqrt(Math.max(0,t-e.n11-e.n22+e.n33))/2,this.x=e.n32-e.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=e.n13-e.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=e.n21-e.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiplySelf:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.x,o=e.y,u=e.z,e=e.w;return this.x=t*e+i*s+n*u-r*o,this.y=n*e+i*o+r*s-t*u,this.z=r*e+i*u+t*o-n*s,this.w=i*e-t*s-n*o-r*u,this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,r=e.y,i=e.z,s=this.x,o=this.y,u=this.z,a=this.w,f=a*n+o*i-u*r,l=a*r+u*n-s*i,c=a*i+s*r-o*n,n=-s*n-o*r-u*i;return t.x=f*a+n*-s+l*-u-c*-o,t.y=l*a+n*-o+c*-s-f*-u,t.z=c*a+n*-u+f*-o-l*-s,t}},THREE.Quaternion.slerp=function(e,t,n,r){var i=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;i<0?(n.w=-t.w,n.x=-t.x,n.y=-t.y,n.z=-t.z,i=-i):n.copy(t);if(Math.abs(i)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var s=Math.acos(i),i=Math.sqrt(1-i*i);return Math.abs(i)<.001?(n.w=.5*(e.w+t.w),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n):(t=Math.sin((1-r)*s)/i,r=Math.sin(r*s)/i,n.w=e.w*t+n.w*r,n.x=e.x*t+n.x*r,n.y=e.y*t+n.y*r,n.z=e.z*t+n.z*r,n)},THREE.Vertex=function(e){this.position=e||new THREE.Vector3},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new THREE.Vector3},THREE.Face4=function(e,t,n,r,i,s,o){this.a=e,this.b=t,this.c=n,this.d=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof THREE.Color?s:new THREE.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e,new THREE.Vector3(1,1,1));for(var n=0,r=this.vertices.length;n<r;n++)e.multiplyVector3(this.vertices[n].position);n=0;for(r=this.faces.length;n<r;n++){var i=this.faces[n];t.multiplyVector3(i.normal);for(var s=0,o=i.vertexNormals.length;s<o;s++)t.multiplyVector3(i.vertexNormals[s]);e.multiplyVector3(i.centroid)}},computeCentroids:function(){var e,t,n;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.addSelf(this.vertices[n.d].position),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,r,i,s,o=new THREE.Vector3,u=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],r=this.vertices[n.a],i=this.vertices[n.b],s=this.vertices[n.c],o.sub(s.position,i.position),u.sub(r.position,i.position),o.crossSelf(u),o.isZero()||o.normalize(),n.normal.copy(o)},computeVertexNormals:function(){var e,t,n,r;if(this.__tmpVertices===void 0){r=this.__tmpVertices=Array(this.vertices.length),e=0;for(t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)(n=this.faces[e],n instanceof THREE.Face3)?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else{r=this.__tmpVertices,e=0;for(t=this.vertices.length;e<t;e++)r[e].set(0,0,0)}e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal),r[n.d].addSelf(n.normal));e=0;for(t=this.vertices.length;e<t;e++)r[e].normalize();e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c]),n.vertexNormals[3].copy(r[n.d]))},computeTangents:function(){function e(e,t,n,r,i,s,T){u=e.vertices[t].position,a=e.vertices[n].position,f=e.vertices[r].position,l=o[i],c=o[s],h=o[T],p=a.x-u.x,d=f.x-u.x,v=a.y-u.y,m=f.y-u.y,g=a.z-u.z,y=f.z-u.z,b=c.u-l.u,w=h.u-l.u,E=c.v-l.v,S=h.v-l.v,x=1/(b*S-w*E),k.set((S*p-E*d)*x,(S*v-E*m)*x,(S*g-E*y)*x),L.set((b*d-w*p)*x,(b*m-w*v)*x,(b*y-w*g)*x),N[t].addSelf(k),N[n].addSelf(k),N[r].addSelf(k),C[t].addSelf(L),C[n].addSelf(L),C[r].addSelf(L)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[],C=[],k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector3,M=new THREE.Vector3;t=0;for(n=this.vertices.length;t<n;t++)N[t]=new THREE.Vector3,C[t]=new THREE.Vector3;t=0;for(n=this.faces.length;t<n;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.c,0,1,2),e(this,s.a,s.b,s.d,0,1,3));var _=["a","b","c","d"];t=0;for(n=this.faces.length;t<n;t++){s=this.faces[t];for(r=0;r<s.vertexNormals.length;r++)M.copy(s.vertexNormals[r]),i=s[_[r]],T=N[i],A.copy(T),A.subSelf(M.multiplyScalar(M.dot(T))).normalize(),O.cross(s.vertexNormals[r],T),i=O.dot(C[i]),i=i<0?-1:1,s.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,i)}this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,n=this.vertices.length;t<n;t++)e=this.vertices[t],e.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=e.position.x:e.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=e.position.x),e.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=e.position.y:e.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=e.position.y),e.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=e.position.z:e.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=e.position.z)}},computeBoundingSphere:function(){for(var e=0,t=0,n=this.vertices.length;t<n;t++)e=Math.max(e,this.vertices[t].position.length());this.boundingSphere={radius:e}},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s].position,r=[Math.round(r.x*i),Math.round(r.y*i),Math.round(r.z*i)].join("_"),e[r]===void 0?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];s=0;for(o=this.faces.length;s<o;s++)(e=this.faces[s],e instanceof THREE.Face3)?(e.a=n[e.a],e.b=n[e.b],e.c=n[e.c]):e instanceof THREE.Face4&&(e.a=n[e.a],e.b=n[e.b],e.c=n[e.c],e.d=n[e.d]);this.vertices=t}},THREE.GeometryCount=0,THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>this.points.length-2?s:s+1,n[3]=s>this.points.length-3?s:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t*=this.points.length-1,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+n*(1/o)*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Edge=function(e,t,n,r){this.vertices=[e,t],this.vertexIndices=[n,r],this.faces=[],this.faceIndices=[]},THREE.Camera=function(){if(arguments.length)return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3]);THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i!==void 0?i:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=e!==void 0?e:50,this.aspect=t!==void 0?t:1,this.near=n!==void 0?n:.1,this.far=r!==void 0?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((t!==void 0?t:43.25)/(e*2)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix=THREE.Matrix4.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,n,r){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t!==void 0?t:1,this.distance=n!==void 0?n:0,this.castShadow=r!==void 0?r:!1},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Material=function(e){this.name="",this.id=THREE.MaterialCount++,e=e||{},this.opacity=e.opacity!==void 0?e.opacity:1,this.transparent=e.transparent!==void 0?e.transparent:!1,this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending,this.depthTest=e.depthTest!==void 0?e.depthTest:!0,this.depthWrite=e.depthWrite!==void 0?e.depthWrite:!0,this.polygonOffset=e.polygonOffset!==void 0?e.polygonOffset:!1,this.polygonOffsetFactor=e.polygonOffsetFactor!==void 0?e.polygonOffsetFactor:0,this.polygonOffsetUnits=e.polygonOffsetUnits!==void 0?e.polygonOffsetUnits:0,this.alphaTest=e.alphaTest!==void 0?e.alphaTest:0,this.overdraw=e.overdraw!==void 0?e.overdraw:!1},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=e.linewidth!==void 0?e.linewidth:1,this.linecap=e.linecap!==void 0?e.linecap:"round",this.linejoin=e.linejoin!==void 0?e.linejoin:"round",this.vertexColors=e.vertexColors?e.vertexColors:!1,this.fog=e.fog!==void 0?e.fog:!0},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(328965),this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(328965),this.specular=e.specular!==void 0?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=e.shininess!==void 0?e.shininess:30,this.metal=e.metal!==void 0?e.metal:!1,this.perPixel=e.perPixel!==void 0?e.perPixel:!1,this.map=e.map!==void 0?e.map:null,this.lightMap=e.lightMap!==void 0?e.lightMap:null,this.envMap=e.envMap!==void 0?e.envMap:null,this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation,this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1,this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98,this.fog=e.fog!==void 0?e.fog:!0,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round",this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round",this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=e.wireframe?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.MeshShaderMaterial=function(e){return console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial()."),new THREE.ShaderMaterial(e)},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map!==void 0?e.map:null,this.size=e.size!==void 0?e.size:1,this.sizeAttenuation=e.sizeAttenuation!==void 0?e.sizeAttenuation:!0,this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.fog=e.fog!==void 0?e.fog:!0},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.program=e.program!==void 0?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this),this.domElement=e},THREE.ShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=e.fragmentShader!==void 0?e.fragmentShader:"void main() {}",this.vertexShader=e.vertexShader!==void 0?e.vertexShader:"void main() {}",this.uniforms=e.uniforms!==void 0?e.uniforms:{},this.attributes=e.attributes,this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading,this.wireframe=e.wireframe!==void 0?e.wireframe:!1,this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1,this.fog=e.fog!==void 0?e.fog:!1,this.lights=e.lights!==void 0?e.lights:!1,this.vertexColors=e.vertexColors!==void 0?e.vertexColors:!1,this.skinning=e.skinning!==void 0?e.skinning:!1,this.morphTargets=e.morphTargets!==void 0?e.morphTargets:!1},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(e,t,n,r,i,s){this.id=THREE.TextureCount++,this.image=e,this.mapping=t!==void 0?t:new THREE.UVMapping,this.wrapS=n!==void 0?n:THREE.ClampToEdgeWrapping,this.wrapT=r!==void 0?r:THREE.ClampToEdgeWrapping,this.magFilter=i!==void 0?i:THREE.LinearFilter,this.minFilter=s!==void 0?s:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,n,r,i,s,o,u,a){THREE.Texture.call(this,null,i,s,o,u,a),this.image={data:e,width:t,height:n},this.format=r!==void 0?r:THREE.RGBAFormat},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t,this.sortParticles=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=t,this.type=n!==void 0?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t,t instanceof Array&&(console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=t[0]);if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==void 0?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t){THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var n,r,i,s,o,u;if(this.geometry.bones!==void 0){for(n=0;n<this.geometry.bones.length;n++)i=this.geometry.bones[n],s=i.pos,o=i.rotq,u=i.scl,r=this.addBone(),r.name=i.name,r.position.set(s[0],s[1],s[2]),r.quaternion.set(o[0],o[1],o[2],o[3]),r.useQuaternion=!0,u!==void 0?r.scale.set(u[0],u[1],u[2]):r.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)i=this.geometry.bones[n],r=this.bones[n],i.parent===-1?this.add(r):this.bones[i.parent].add(r);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.addBone=function(e){return e===void 0&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}for(var t=this.bones.length,n=this.bones,r=this.boneMatrices,e=0;e<t;e++)n[e].skinMatrix.flattenToArrayOffset(r,e*16)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e,t=[],n=0;n<this.bones.length;n++){e=this.bones[n];var r=new THREE.Matrix4;r.getInverse(e.skinMatrix),t.push(r),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,n*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[];for(e=0;e<this.geometry.skinIndices.length;e++){var n=this.geometry.vertices[e].position,i=this.geometry.skinIndices[e].x,s=this.geometry.skinIndices[e].y,r=new THREE.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesA.push(t[i].multiplyVector3(r)),r=new THREE.Vector3(n.x,n.y,n.z),this.geometry.skinVerticesB.push(t[s].multiplyVector3(r)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(n=(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y))*.5,this.geometry.skinWeights[e].x+=n,this.geometry.skinWeights[e].y+=n)}}},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype=new THREE.Mesh,THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/(this.geometry.morphTargets.length-1);this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration;e=THREE.Math.clamp(Math.floor(this.time/t),0,this.geometry.morphTargets.length-1),e!=this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(e,t){t===void 0&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length;n++)if(t<this.LODs[n].visibleAtDistance)break;this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.n31*this.position.x+e.n32*this.position.y+e.n33*this.position.z+e.n34),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length;t++){if(!(e>=this.LODs[t].visibleAtDistance))break;this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0}for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map instanceof THREE.Texture?e.map:THREE.ImageUtils.loadTexture(e.map),this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending,this.useScreenCoordinates=e.useScreenCoordinates!==void 0?e.useScreenCoordinates:!0,this.mergeWith3D=e.mergeWith3D!==void 0?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=e.affectedByDistance!==void 0?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=e.scaleByViewport!==void 0?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1)this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.addObject=function(e){if(e instanceof THREE.Light)this.lights.indexOf(e)===-1&&this.lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.objects.indexOf(e)===-1){this.objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.addObject(e.children[t])},THREE.Scene.prototype.removeObject=function(e){if(e instanceof THREE.Light){var t=this.lights.indexOf(e);t!==-1&&this.lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.objects.indexOf(e),t!==-1&&(this.objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),t!==-1&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.removeObject(e.children[t])},THREE.Fog=function(e,t,n){this.color=new THREE.Color(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=t!==void 0?t:25e-5},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var e=null,t=new THREE.Projector,n,r,i,s;this.domElement=document.createElement("div"),this.setSize=function(e,t){n=e,r=t,i=n/2,s=r/2},this.render=function(n,r){var o,u,l,h,p,d,v,m;e=t.projectScene(n,r),o=0;for(u=e.length;o<u;o++)if(p=e[o],p instanceof THREE.RenderableParticle){v=p.x*i+i,m=p.y*s+s,l=0;for(h=p.material.length;l<h;l++)if(d=p.material[l],d instanceof THREE.ParticleDOMMaterial)d=d.domElement,d.style.left=v+"px",d.style.top=m+"px"}}},THREE.CanvasRenderer=function(e){function t(e){y!=e&&(v.globalAlpha=y=e)}function n(e){if(b!=e){switch(e){case THREE.NormalBlending:v.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:v.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:v.globalCompositeOperation="darker"}b=e}}function r(e){w!=e&&(v.strokeStyle=w=e)}function i(e){E!=e&&(v.fillStyle=E=e)}var s=this,o,u,a,f=new THREE.Projector,e=e||{},l=e.canvas!==void 0?e.canvas:document.createElement("canvas"),c,h,p,d,v=l.getContext("2d"),m=new THREE.Color(0),g=0,y=1,b=0,w=null,E=null,S=null,x=null,T=null,N,C,k,L,A=new THREE.RenderableVertex,O=new THREE.RenderableVertex,M,_,D,P,H,B,j,F,I,q,R,U,z=new THREE.Color,W=new THREE.Color,X=new THREE.Color,V=new THREE.Color,$=new THREE.Color,J=[],K=[],Q,G,Y,Z,et,tt,nt,rt,it,st,ot=new THREE.Rectangle,ut=new THREE.Rectangle,at=new THREE.Rectangle,ft=!1,lt=new THREE.Color,ct=new THREE.Color,ht=new THREE.Color,pt=new THREE.Vector3,dt,vt,mt,gt,yt,bt,e=16;dt=document.createElement("canvas"),dt.width=dt.height=2,vt=dt.getContext("2d"),vt.fillStyle="rgba(0,0,0,1)",vt.fillRect(0,0,2,2),mt=vt.getImageData(0,0,2,2),gt=mt.data,yt=document.createElement("canvas"),yt.width=yt.height=e,bt=yt.getContext("2d"),bt.translate(-e/2,-e/2),bt.scale(e,e),e--,this.domElement=l,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){c=e,h=t,p=Math.floor(c/2),d=Math.floor(h/2),l.width=c,l.height=h,ot.set(-p,-d,p,d),ut.set(-p,-d,p,d),y=1,b=0,T=x=S=E=w=null},this.setClearColor=function(e,t){m.copy(e),g=t,ut.set(-p,-d,p,d)},this.setClearColorHex=function(e,t){m.setHex(e),g=t,ut.set(-p,-d,p,d)},this.clear=function(){v.setTransform(1,0,0,-1,p,d),ut.isEmpty()||(ut.minSelf(ot),ut.inflate(2),g<1&&v.clearRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight())),g>0&&(n(THREE.NormalBlending),t(1),i("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+g+")"),v.fillRect(Math.floor(ut.getX()),Math.floor(ut.getY()),Math.floor(ut.getWidth()),Math.floor(ut.getHeight()))),ut.empty())},this.render=function(e,l){function c(e){var t,n,r,i;lt.setRGB(0,0,0),ct.setRGB(0,0,0),ht.setRGB(0,0,0),t=0;for(n=e.length;t<n;t++)r=e[t],i=r.color,r instanceof THREE.AmbientLight?(lt.r+=i.r,lt.g+=i.g,lt.b+=i.b):r instanceof THREE.DirectionalLight?(ct.r+=i.r,ct.g+=i.g,ct.b+=i.b):r instanceof THREE.PointLight&&(ht.r+=i.r,ht.g+=i.g,ht.b+=i.b)}function h(e,t,n,r){var i,s,o,u,a,f;i=0;for(s=e.length;i<s;i++)o=e[i],u=o.color,o instanceof THREE.DirectionalLight?(a=o.matrixWorld.getPosition(),f=n.dot(a),f<=0||(f*=o.intensity,r.r+=u.r*f,r.g+=u.g*f,r.b+=u.b*f)):o instanceof THREE.PointLight&&(a=o.matrixWorld.getPosition(),f=n.dot(pt.sub(a,t).normalize()),f<=0||(f*=o.distance==0?1:1-Math.min(t.distanceTo(a)/o.distance,1),f!=0&&(f*=o.intensity,r.r+=u.r*f,r.g+=u.g*f,r.b+=u.b*f)))}function m(e,s,o){t(o.opacity),n(o.blending);var u,a,f,l,c,h;o instanceof THREE.ParticleBasicMaterial?o.map&&(l=o.map.image,c=l.width>>1,h=l.height>>1,o=s.scale.x*p,f=s.scale.y*d,u=o*c,a=f*h,at.set(e.x-u,e.y-a,e.x+u,e.y+a),ot.intersects(at)&&(v.save(),v.translate(e.x,e.y),v.rotate(-s.rotation),v.scale(o,-f),v.translate(-c,-h),v.drawImage(l,0,0),v.restore())):o instanceof THREE.ParticleCanvasMaterial&&(u=s.scale.x*p,a=s.scale.y*d,at.set(e.x-u,e.y-a,e.x+u,e.y+a),ot.intersects(at)&&(r(o.color.getContextStyle()),i(o.color.getContextStyle()),v.save(),v.translate(e.x,e.y),v.rotate(-s.rotation),v.scale(u,a),o.program(v),v.restore()))}function g(e,i,s,o){t(o.opacity),n(o.blending),v.beginPath(),v.moveTo(e.positionScreen.x,e.positionScreen.y),v.lineTo(i.positionScreen.x,i.positionScreen.y),v.closePath(),o instanceof THREE.LineBasicMaterial&&(e=o.linewidth,S!=e&&(v.lineWidth=S=e),e=o.linecap,x!=e&&(v.lineCap=x=e),e=o.linejoin,T!=e&&(v.lineJoin=T=e),r(o.color.getContextStyle()),v.stroke(),at.inflate(o.linewidth*2))}function y(e,r,i,o,u,f,c,p){s.info.render.vertices+=3,s.info.render.faces++,t(p.opacity),n(p.blending),M=e.positionScreen.x,_=e.positionScreen.y,D=r.positionScreen.x,P=r.positionScreen.y,H=i.positionScreen.x,B=i.positionScreen.y,w(M,_,D,P,H,B),p instanceof THREE.MeshBasicMaterial?p.map?p.map.mapping instanceof THREE.UVMapping&&(Z=c.uvs[0],St(M,_,D,P,H,B,Z[o].u,Z[o].v,Z[u].u,Z[u].v,Z[f].u,Z[f].v,p.map)):p.envMap?p.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=l.matrixWorldInverse,pt.copy(c.vertexNormalsWorld[o]),et=(pt.x*e.n11+pt.y*e.n12+pt.z*e.n13)*.5+.5,tt=-(pt.x*e.n21+pt.y*e.n22+pt.z*e.n23)*.5+.5,pt.copy(c.vertexNormalsWorld[u]),nt=(pt.x*e.n11+pt.y*e.n12+pt.z*e.n13)*.5+.5,rt=-(pt.x*e.n21+pt.y*e.n22+pt.z*e.n23)*.5+.5,pt.copy(c.vertexNormalsWorld[f]),it=(pt.x*e.n11+pt.y*e.n12+pt.z*e.n13)*.5+.5,st=-(pt.x*e.n21+pt.y*e.n22+pt.z*e.n23)*.5+.5,St(M,_,D,P,H,B,et,tt,nt,rt,it,st,p.envMap)):p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color):p instanceof THREE.MeshLambertMaterial?(p.map&&!p.wireframe&&(p.map.mapping instanceof THREE.UVMapping&&(Z=c.uvs[0],St(M,_,D,P,H,B,Z[o].u,Z[o].v,Z[u].u,Z[u].v,Z[f].u,Z[f].v,p.map)),n(THREE.SubtractiveBlending)),ft?!p.wireframe&&p.shading==THREE.SmoothShading&&c.vertexNormalsWorld.length==3?(W.r=X.r=V.r=lt.r,W.g=X.g=V.g=lt.g,W.b=X.b=V.b=lt.b,h(a,c.v1.positionWorld,c.vertexNormalsWorld[0],W),h(a,c.v2.positionWorld,c.vertexNormalsWorld[1],X),h(a,c.v3.positionWorld,c.vertexNormalsWorld[2],V),W.r=Math.max(0,Math.min(p.color.r*W.r,1)),W.g=Math.max(0,Math.min(p.color.g*W.g,1)),W.b=Math.max(0,Math.min(p.color.b*W.b,1)),X.r=Math.max(0,Math.min(p.color.r*X.r,1)),X.g=Math.max(0,Math.min(p.color.g*X.g,1)),X.b=Math.max(0,Math.min(p.color.b*X.b,1)),V.r=Math.max(0,Math.min(p.color.r*V.r,1)),V.g=Math.max(0,Math.min(p.color.g*V.g,1)),V.b=Math.max(0,Math.min(p.color.b*V.b,1)),$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=Tt(W,X,V,$),xt(M,_,D,P,H,B,0,0,1,0,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,h(a,c.centroidWorld,c.normalWorld,z),z.r=Math.max(0,Math.min(p.color.r*z.r,1)),z.g=Math.max(0,Math.min(p.color.g*z.g,1)),z.b=Math.max(0,Math.min(p.color.b*z.b,1)),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color)):p instanceof THREE.MeshDepthMaterial?(Q=l.near,G=l.far,W.r=W.g=W.b=1-Nt(e.positionScreen.z,Q,G),X.r=X.g=X.b=1-Nt(r.positionScreen.z,Q,G),V.r=V.g=V.b=1-Nt(i.positionScreen.z,Q,G),$.r=(X.r+V.r)*.5,$.g=(X.g+V.g)*.5,$.b=(X.b+V.b)*.5,Y=Tt(W,X,V,$),xt(M,_,D,P,H,B,0,0,1,0,0,1,Y)):p instanceof THREE.MeshNormalMaterial&&(z.r=Ct(c.normalWorld.x),z.g=Ct(c.normalWorld.y),z.b=Ct(c.normalWorld.z),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z))}function b(e,r,i,o,u,f,c,p,d){s.info.render.vertices+=4,s.info.render.faces++,t(p.opacity),n(p.blending),p.map||p.envMap?(y(e,r,o,0,1,3,c,p,d),y(u,i,f,1,2,3,c,p,d)):(M=e.positionScreen.x,_=e.positionScreen.y,D=r.positionScreen.x,P=r.positionScreen.y,H=i.positionScreen.x,B=i.positionScreen.y,j=o.positionScreen.x,F=o.positionScreen.y,I=u.positionScreen.x,q=u.positionScreen.y,R=f.positionScreen.x,U=f.positionScreen.y,p instanceof THREE.MeshBasicMaterial)?(E(M,_,D,P,H,B,j,F),p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color)):p instanceof THREE.MeshLambertMaterial?ft?!p.wireframe&&p.shading==THREE.SmoothShading&&c.vertexNormalsWorld.length==4?(W.r=X.r=V.r=$.r=lt.r,W.g=X.g=V.g=$.g=lt.g,W.b=X.b=V.b=$.b=lt.b,h(a,c.v1.positionWorld,c.vertexNormalsWorld[0],W),h(a,c.v2.positionWorld,c.vertexNormalsWorld[1],X),h(a,c.v4.positionWorld,c.vertexNormalsWorld[3],V),h(a,c.v3.positionWorld,c.vertexNormalsWorld[2],$),W.r=Math.max(0,Math.min(p.color.r*W.r,1)),W.g=Math.max(0,Math.min(p.color.g*W.g,1)),W.b=Math.max(0,Math.min(p.color.b*W.b,1)),X.r=Math.max(0,Math.min(p.color.r*X.r,1)),X.g=Math.max(0,Math.min(p.color.g*X.g,1)),X.b=Math.max(0,Math.min(p.color.b*X.b,1)),V.r=Math.max(0,Math.min(p.color.r*V.r,1)),V.g=Math.max(0,Math.min(p.color.g*V.g,1)),V.b=Math.max(0,Math.min(p.color.b*V.b,1)),$.r=Math.max(0,Math.min(p.color.r*$.r,1)),$.g=Math.max(0,Math.min(p.color.g*$.g,1)),$.b=Math.max(0,Math.min(p.color.b*$.b,1)),Y=Tt(W,X,V,$),w(M,_,D,P,j,F),xt(M,_,D,P,j,F,0,0,1,0,0,1,Y),w(I,q,H,B,R,U),xt(I,q,H,B,R,U,1,0,1,1,0,1,Y)):(z.r=lt.r,z.g=lt.g,z.b=lt.b,h(a,c.centroidWorld,c.normalWorld,z),z.r=Math.max(0,Math.min(p.color.r*z.r,1)),z.g=Math.max(0,Math.min(p.color.g*z.g,1)),z.b=Math.max(0,Math.min(p.color.b*z.b,1)),E(M,_,D,P,H,B,j,F),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):(E(M,_,D,P,H,B,j,F),p.wireframe?wt(p.color,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(p.color)):p instanceof THREE.MeshNormalMaterial?(z.r=Ct(c.normalWorld.x),z.g=Ct(c.normalWorld.y),z.b=Ct(c.normalWorld.z),E(M,_,D,P,H,B,j,F),p.wireframe?wt(z,p.wireframeLinewidth,p.wireframeLinecap,p.wireframeLinejoin):Et(z)):p instanceof THREE.MeshDepthMaterial&&(Q=l.near,G=l.far,W.r=W.g=W.b=1-Nt(e.positionScreen.z,Q,G),X.r=X.g=X.b=1-Nt(r.positionScreen.z,Q,G),V.r=V.g=V.b=1-Nt(o.positionScreen.z,Q,G),$.r=$.g=$.b=1-Nt(i.positionScreen.z,Q,G),Y=Tt(W,X,V,$),w(M,_,D,P,j,F),xt(M,_,D,P,j,F,0,0,1,0,0,1,Y),w(I,q,H,B,R,U),xt(I,q,H,B,R,U,1,0,1,1,0,1,Y))}function w(e,t,n,r,i,s){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.lineTo(e,t),v.closePath()}function E(e,t,n,r,i,s,o,u){v.beginPath(),v.moveTo(e,t),v.lineTo(n,r),v.lineTo(i,s),v.lineTo(o,u),v.lineTo(e,t),v.closePath()}function wt(e,t,n,i){S!=t&&(v.lineWidth=S=t),x!=n&&(v.lineCap=x=n),T!=i&&(v.lineJoin=T=i),r(e.getContextStyle()),v.stroke(),at.inflate(t*2)}function Et(e){i(e.getContextStyle()),v.fill()}function St(e,t,n,r,s,o,u,a,f,l,c,h,p){if(p.image.width!=0){if(p.needsUpdate==1||J[p.id]==void 0){var d=p.wrapS==THREE.RepeatWrapping,m=p.wrapT==THREE.RepeatWrapping;J[p.id]=v.createPattern(p.image,d&&m?"repeat":d&&!m?"repeat-x":!d&&m?"repeat-y":"no-repeat"),p.needsUpdate=!1}i(J[p.id]);var d=p.offset.x/p.repeat.x,m=p.offset.y/p.repeat.y,g=p.image.width*p.repeat.x,y=p.image.height*p.repeat.y,u=(u+d)*g,a=(a+m)*y,f=(f+d)*g,l=(l+m)*y,c=(c+d)*g,h=(h+m)*y;n-=e,r-=t,s-=e,o-=t,f-=u,l-=a,c-=u,h-=a,d=f*h-c*l,d==0?(K[p.id]==void 0&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,e=t.getContext("2d"),e.drawImage(p.image,0,0),K[p.id]=e.getImageData(0,0,p.image.width,p.image.height).data,delete t),t=K[p.id],u=(Math.floor(u)+Math.floor(a)*p.image.width)*4,z.setRGB(t[u]/255,t[u+1]/255,t[u+2]/255),Et(z)):(d=1/d,p=(h*n-l*s)*d,l=(h*r-l*o)*d,n=(f*s-c*n)*d,r=(f*o-c*r)*d,e=e-p*u-n*a,u=t-l*u-r*a,v.save(),v.transform(p,l,n,r,e,u),v.fill(),v.restore())}}function xt(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,a*=p,f*=d,l*=p,c*=d,n-=e,r-=t,i-=e,s-=t,a-=o,f-=u,l-=o,c-=u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,v.save(),v.transform(p,f,n,r,e,t),v.clip(),v.drawImage(h,0,0),v.restore()}function Tt(e,t,n,r){var i=~~(e.r*255),s=~~(e.g*255),e=~~(e.b*255),o=~~(t.r*255),u=~~(t.g*255),t=~~(t.b*255),a=~~(n.r*255),f=~~(n.g*255),n=~~(n.b*255),l=~~(r.r*255),c=~~(r.g*255),r=~~(r.b*255);return gt[0]=i<0?0:i>255?255:i,gt[1]=s<0?0:s>255?255:s,gt[2]=e<0?0:e>255?255:e,gt[4]=o<0?0:o>255?255:o,gt[5]=u<0?0:u>255?255:u,gt[6]=t<0?0:t>255?255:t,gt[8]=a<0?0:a>255?255:a,gt[9]=f<0?0:f>255?255:f,gt[10]=n<0?0:n>255?255:n,gt[12]=l<0?0:l>255?255:l,gt[13]=c<0?0:c>255?255:c,gt[14]=r<0?0:r>255?255:r,vt.putImageData(mt,0,0),bt.drawImage(dt,0,0),yt}function Nt(e,t,n){return e=(e-t)/(n-t),e*e*(3-2*e)}function Ct(e){return e=(e+1)*.5,e<0?0:e>1?1:e}function kt(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;i!=0&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x+=n,t.y+=r,e.x-=n,e.y-=r)}var Lt,At,Ot,Mt;this.autoClear?this.clear():v.setTransform(1,0,0,-1,p,d),s.info.render.vertices=0,s.info.render.faces=0,o=f.projectScene(e,l,this.sortElements),u=o.elements,a=o.lights,(ft=a.length>0)&&c(a),Lt=0;for(At=u.length;Lt<At;Lt++)if(Ot=u[Lt],Mt=Ot.material,Mt=Mt instanceof THREE.MeshFaceMaterial?Ot.faceMaterial:Mt,Mt!=null&&Mt.opacity!=0)at.empty(),Ot instanceof THREE.RenderableParticle?(N=Ot,N.x*=p,N.y*=d,m(N,Ot,Mt,e)):Ot instanceof THREE.RenderableLine?(N=Ot.v1,C=Ot.v2,N.positionScreen.x*=p,N.positionScreen.y*=d,C.positionScreen.x*=p,C.positionScreen.y*=d,at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),ot.intersects(at)&&g(N,C,Ot,Mt,e)):Ot instanceof THREE.RenderableFace3?(N=Ot.v1,C=Ot.v2,k=Ot.v3,N.positionScreen.x*=p,N.positionScreen.y*=d,C.positionScreen.x*=p,C.positionScreen.y*=d,k.positionScreen.x*=p,k.positionScreen.y*=d,Mt.overdraw&&(kt(N.positionScreen,C.positionScreen),kt(C.positionScreen,k.positionScreen),kt(k.positionScreen,N.positionScreen)),at.add3Points(N.positionScreen.x,N.positionScreen.y,C.positionScreen.x,C.positionScreen.y,k.positionScreen.x,k.positionScreen.y),ot.intersects(at)&&y(N,C,k,0,1,2,Ot,Mt,e)):Ot instanceof THREE.RenderableFace4&&(N=Ot.v1,C=Ot.v2,k=Ot.v3,L=Ot.v4,N.positionScreen.x*=p,N.positionScreen.y*=d,C.positionScreen.x*=p,C.positionScreen.y*=d,k.positionScreen.x*=p,k.positionScreen.y*=d,L.positionScreen.x*=p,L.positionScreen.y*=d,A.positionScreen.copy(C.positionScreen),O.positionScreen.copy(L.positionScreen),Mt.overdraw&&(kt(N.positionScreen,C.positionScreen),kt(C.positionScreen,L.positionScreen),kt(L.positionScreen,N.positionScreen),kt(k.positionScreen,A.positionScreen),kt(k.positionScreen,O.positionScreen)),at.addPoint(N.positionScreen.x,N.positionScreen.y),at.addPoint(C.positionScreen.x,C.positionScreen.y),at.addPoint(k.positionScreen.x,k.positionScreen.y),at.addPoint(L.positionScreen.x,L.positionScreen.y),ot.intersects(at)&&b(N,C,k,L,A,O,Ot,Mt,e)),ut.addRectangle(at);v.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function e(e,t,n,r){var i,s,o,u,a,f;i=0;for(s=e.length;i<s;i++)o=e[i],u=o.color,o instanceof THREE.DirectionalLight?(a=o.matrixWorld.getPosition(),f=n.dot(a),f<=0||(f*=o.intensity,r.r+=u.r*f,r.g+=u.g*f,r.b+=u.b*f)):o instanceof THREE.PointLight&&(a=o.matrixWorld.getPosition(),f=n.dot(N.sub(a,t).normalize()),f<=0||(f*=o.distance==0?1:1-Math.min(t.distanceTo(a)/o.distance,1),f!=0&&(f*=o.intensity,r.r+=u.r*f,r.g+=u.g*f,r.b+=u.b*f)))}function t(e){return C[e]==null&&(C[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),M==0&&C[e].setAttribute("shape-rendering","crispEdges")),C[e]}function n(e){return e=(e+1)*.5,e<0?0:e>1?1:e}var r=this,i,s,o,u=new THREE.Projector,a=document.createElementNS("http://www.w3.org/2000/svg","svg"),f,l,c,h,p,d,v,m,g=new THREE.Rectangle,y=new THREE.Rectangle,b=!1,w=new THREE.Color,E=new THREE.Color,S=new THREE.Color,x=new THREE.Color,T,N=new THREE.Vector3,C=[],k=[],L,A,O,M=1;this.domElement=a,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":M=1;break;case"low":M=0}},this.setSize=function(e,t){f=e,l=t,c=f/2,h=l/2,a.setAttribute("viewBox",-c+" "+ -h+" "+f+" "+l),a.setAttribute("width",f),a.setAttribute("height",l),g.set(-c,-h,c,h)},this.clear=function(){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])},this.render=function(f,l){var N,C,_,D;this.autoClear&&this.clear(),r.info.render.vertices=0,r.info.render.faces=0,i=u.projectScene(f,l,this.sortElements),s=i.elements,o=i.lights,O=A=0;if(b=o.length>0){E.setRGB(0,0,0),S.setRGB(0,0,0),x.setRGB(0,0,0),N=0;for(C=o.length;N<C;N++)D=o[N],_=D.color,D instanceof THREE.AmbientLight?(E.r+=_.r,E.g+=_.g,E.b+=_.b):D instanceof THREE.DirectionalLight?(S.r+=_.r,S.g+=_.g,S.b+=_.b):D instanceof THREE.PointLight&&(x.r+=_.r,x.g+=_.g,x.b+=_.b)}N=0;for(C=s.length;N<C;N++)if(_=s[N],D=_.material,D=D instanceof THREE.MeshFaceMaterial?_.faceMaterial:D,D!=null&&D.opacity!=0)if(y.empty(),_ instanceof THREE.RenderableParticle)p=_,p.x*=c,p.y*=-h;else if(_ instanceof THREE.RenderableLine){if(p=_.v1,d=_.v2,p.positionScreen.x*=c,p.positionScreen.y*=-h,d.positionScreen.x*=c,d.positionScreen.y*=-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y),g.intersects(y)){_=p;var P=d,H=O++;k[H]==null&&(k[H]=document.createElementNS("http://www.w3.org/2000/svg","line"),M==0&&k[H].setAttribute("shape-rendering","crispEdges")),L=k[H],L.setAttribute("x1",_.positionScreen.x),L.setAttribute("y1",_.positionScreen.y),L.setAttribute("x2",P.positionScreen.x),L.setAttribute("y2",P.positionScreen.y),D instanceof THREE.LineBasicMaterial&&(L.setAttribute("style","fill: none; stroke: "+D.color.getContextStyle()+"; stroke-width: "+D.linewidth+"; stroke-opacity: "+D.opacity+"; stroke-linecap: "+D.linecap+"; stroke-linejoin: "+D.linejoin),a.appendChild(L))}}else if(_ instanceof THREE.RenderableFace3){if(p=_.v1,d=_.v2,v=_.v3,p.positionScreen.x*=c,p.positionScreen.y*=-h,d.positionScreen.x*=c,d.positionScreen.y*=-h,v.positionScreen.x*=c,v.positionScreen.y*=-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y),y.addPoint(v.positionScreen.x,v.positionScreen.y),g.intersects(y)){var P=p,H=d,j=v;r.info.render.vertices+=3,r.info.render.faces++,L=t(A++),L.setAttribute("d","M "+P.positionScreen.x+" "+P.positionScreen.y+" L "+H.positionScreen.x+" "+H.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+"z"),D instanceof THREE.MeshBasicMaterial?w.copy(D.color):D instanceof THREE.MeshLambertMaterial?b?(w.r=E.r,w.g=E.g,w.b=E.b,e(o,_.centroidWorld,_.normalWorld,w),w.r=Math.max(0,Math.min(D.color.r*w.r,1)),w.g=Math.max(0,Math.min(D.color.g*w.g,1)),w.b=Math.max(0,Math.min(D.color.b*w.b,1))):w.copy(D.color):D instanceof THREE.MeshDepthMaterial?(T=1-D.__2near/(D.__farPlusNear-_.z*D.__farMinusNear),w.setRGB(T,T,T)):D instanceof THREE.MeshNormalMaterial&&w.setRGB(n(_.normalWorld.x),n(_.normalWorld.y),n(_.normalWorld.z)),D.wireframe?L.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+D.wireframeLinewidth+"; stroke-opacity: "+D.opacity+"; stroke-linecap: "+D.wireframeLinecap+"; stroke-linejoin: "+D.wireframeLinejoin):L.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+D.opacity),a.appendChild(L)}}else if(_ instanceof THREE.RenderableFace4&&(p=_.v1,d=_.v2,v=_.v3,m=_.v4,p.positionScreen.x*=c,p.positionScreen.y*=-h,d.positionScreen.x*=c,d.positionScreen.y*=-h,v.positionScreen.x*=c,v.positionScreen.y*=-h,m.positionScreen.x*=c,m.positionScreen.y*=-h,y.addPoint(p.positionScreen.x,p.positionScreen.y),y.addPoint(d.positionScreen.x,d.positionScreen.y),y.addPoint(v.positionScreen.x,v.positionScreen.y),y.addPoint(m.positionScreen.x,m.positionScreen.y),g.intersects(y))){var P=p,H=d,j=v,I=m;r.info.render.vertices+=4,r.info.render.faces++,L=t(A++),L.setAttribute("d","M "+P.positionScreen.x+" "+P.positionScreen.y+" L "+H.positionScreen.x+" "+H.positionScreen.y+" L "+j.positionScreen.x+","+j.positionScreen.y+" L "+I.positionScreen.x+","+I.positionScreen.y+"z"),D instanceof THREE.MeshBasicMaterial?w.copy(D.color):D instanceof THREE.MeshLambertMaterial?b?(w.r=E.r,w.g=E.g,w.b=E.b,e(o,_.centroidWorld,_.normalWorld,w),w.r=Math.max(0,Math.min(D.color.r*w.r,1)),w.g=Math.max(0,Math.min(D.color.g*w.g,1)),w.b=Math.max(0,Math.min(D.color.b*w.b,1))):w.copy(D.color):D instanceof THREE.MeshDepthMaterial?(T=1-D.__2near/(D.__farPlusNear-_.z*D.__farMinusNear),w.setRGB(T,T,T)):D instanceof THREE.MeshNormalMaterial&&w.setRGB(n(_.normalWorld.x),n(_.normalWorld.y),n(_.normalWorld.z)),D.wireframe?L.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+D.wireframeLinewidth+"; stroke-opacity: "+D.opacity+"; stroke-linecap: "+D.wireframeLinecap+"; stroke-linejoin: "+D.wireframeLinejoin):L.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+D.opacity),a.appendChild(L)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_lambert_vertex:"vLightWeighting = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\nvLightWeighting = vLightWeighting * diffuse + ambient * ambientLightColor;",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\n#ifndef PHONG_PER_PIXEL\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDistance = lDistance;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );\nfloat pointSpecularWeight = pow( pointDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance;\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = pow( dirDotNormalHalf, shininess );\n#ifdef PHYSICALLY_BASED_SHADING\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( shadowDarkness );\n#endif\n}\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(e){var t,n,r,i={};for(t in e)for(n in i[t]={},e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:.0039},shadowDarkness:{type:"f",value:.2}}},THREE.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)}}]),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"gl_FragColor.xyz = gl_FragColor.xyz * vLightWeighting;",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalMatrix * normal;\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){e.__webglCustomAttributesList===void 0&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;s.type==="v2"?o=2:s.type==="v3"?o=3:s.type==="v4"?o=4:s.type==="c"&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=U.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function n(e,t){if(!(!e.material||e.material instanceof THREE.MeshFaceMaterial))return e.material;if(t.materialIndex>=0)return e.geometry.materials[t.materialIndex]}function r(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&e.shading!==void 0&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function i(e){return e.vertexColors?e.vertexColors:!1}function s(e){return e.map||e.lightMap||e instanceof THREE.ShaderMaterial?!0:!1}function o(e,t,n){var r,i,s,o,u=e.vertices;o=u.length;var a=e.colors,f=a.length,l=e.__vertexArray,c=e.__colorArray,h=e.__sortArray,p=e.__dirtyVertices,d=e.__dirtyColors,v=e.__webglCustomAttributesList;if(n.sortParticles){ft.multiplySelf(n.matrixWorld);for(r=0;r<o;r++)i=u[r].position,ht.copy(i),ft.multiplyVector3(ht),h[r]=[ht.z,r];h.sort(function(e,t){return t[0]-e[0]});for(r=0;r<o;r++)i=u[h[r][1]].position,s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;for(r=0;r<f;r++)s=r*3,i=a[h[r][1]],c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++)if(u=v[a],u.boundTo===void 0||u.boundTo==="vertices")if(s=0,i=u.value.length,u.size===1)for(r=0;r<i;r++)o=h[r][1],u.array[r]=u.value[o];else if(u.size===2)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=h[r][1],o=u.value[o],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}else{if(p)for(r=0;r<o;r++)i=u[r].position,s=r*3,l[s]=i.x,l[s+1]=i.y,l[s+2]=i.z;if(d)for(r=0;r<f;r++)i=a[r],s=r*3,c[s]=i.r,c[s+1]=i.g,c[s+2]=i.b;if(v){a=0;for(f=v.length;a<f;a++)if(u=v[a],u.needsUpdate&&(u.boundTo===void 0||u.boundTo==="vertices"))if(i=u.value.length,s=0,u.size===1)for(r=0;r<i;r++)u.array[r]=u.value[r];else if(u.size===2)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,s+=2;else if(u.size===3)if(u.type==="c")for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.r,u.array[s+1]=o.g,u.array[s+2]=o.b,s+=3;else for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,s+=3;else if(u.size===4)for(r=0;r<i;r++)o=u.value[r],u.array[s]=o.x,u.array[s+1]=o.y,u.array[s+2]=o.z,u.array[s+3]=o.w,s+=4}}if(p||n.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,l,t);if(d||n.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,e.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,c,t);if(v){a=0;for(f=v.length;a<f;a++)if(u=v[a],u.needsUpdate||n.sortParticles)U.bindBuffer(U.ARRAY_BUFFER,u.buffer),U.bufferData(U.ARRAY_BUFFER,u.array,t)}}function u(e,t,n){e.__webglVertexBuffer||(e.__webglVertexBuffer=U.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=U.createBuffer()),e.hasPos&&(U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,e.positionArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.position),U.vertexAttribPointer(t.attributes.position,3,U.FLOAT,!1,0,0));if(e.hasNormal){U.bindBuffer(U.ARRAY_BUFFER,e.__webglNormalBuffer);if(n===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p=e.count*3;for(h=0;h<p;h+=9)n=e.normalArray,r=n[h],i=n[h+1],s=n[h+2],o=n[h+3],a=n[h+4],l=n[h+5],u=n[h+6],f=n[h+7],c=n[h+8],r=(r+o+u)/3,i=(i+a+f)/3,s=(s+l+c)/3,n[h]=r,n[h+1]=i,n[h+2]=s,n[h+3]=r,n[h+4]=i,n[h+5]=s,n[h+6]=r,n[h+7]=i,n[h+8]=s}U.bufferData(U.ARRAY_BUFFER,e.normalArray,U.DYNAMIC_DRAW),U.enableVertexAttribArray(t.attributes.normal),U.vertexAttribPointer(t.attributes.normal,3,U.FLOAT,!1,0,0)}U.drawArrays(U.TRIANGLES,0,e.count),e.count=0}function a(e,t,n,r,i,s){if(r.opacity!==0){var o,u,n=b(e,t,n,r,s),t=n.attributes,e=!1,n=i.id*16777215+n.id*2+(r.wireframe?1:0);n!==$&&($=n,e=!0);if(!r.morphTargets&&t.position>=0)e&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglVertexBuffer),U.vertexAttribPointer(t.position,3,U.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,s.morphTargetBase!==-1?(U.bindBuffer(U.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),U.vertexAttribPointer(n.position,3,U.FLOAT,!1,0,0)):n.position>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglVertexBuffer),U.vertexAttribPointer(n.position,3,U.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){o=0;var a=s.morphTargetForcedOrder;for(u=s.morphTargetInfluences;o<r.numSupportedMorphTargets&&o<a.length;)U.bindBuffer(U.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[a[o]]),U.vertexAttribPointer(n["morphTarget"+o],3,U.FLOAT,!1,0,0),s.__webglMorphTargetInfluences[o]=u[a[o]],o++}else{var a=[],f=-1,l=0;u=s.morphTargetInfluences;var c,h=u.length;o=0;for(s.morphTargetBase!==-1&&(a[s.morphTargetBase]=!0);o<r.numSupportedMorphTargets;){for(c=0;c<h;c++)!a[c]&&u[c]>f&&(l=c,f=u[l]);U.bindBuffer(U.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[l]),U.vertexAttribPointer(n["morphTarget"+o],3,U.FLOAT,!1,0,0),s.__webglMorphTargetInfluences[o]=f,a[l]=1,f=-1,o++}}r.program.uniforms.morphTargetInfluences!==null&&U.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(e){if(i.__webglCustomAttributesList){o=0;for(u=i.__webglCustomAttributesList.length;o<u;o++)n=i.__webglCustomAttributesList[o],t[n.buffer.belongsToAttribute]>=0&&(U.bindBuffer(U.ARRAY_BUFFER,n.buffer),U.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,U.FLOAT,!1,0,0))}t.color>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglColorBuffer),U.vertexAttribPointer(t.color,3,U.FLOAT,!1,0,0)),t.normal>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglNormalBuffer),U.vertexAttribPointer(t.normal,3,U.FLOAT,!1,0,0)),t.tangent>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglTangentBuffer),U.vertexAttribPointer(t.tangent,4,U.FLOAT,!1,0,0)),t.uv>=0&&(i.__webglUVBuffer?(U.bindBuffer(U.ARRAY_BUFFER,i.__webglUVBuffer),U.vertexAttribPointer(t.uv,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(t.uv)):U.disableVertexAttribArray(t.uv)),t.uv2>=0&&(i.__webglUV2Buffer?(U.bindBuffer(U.ARRAY_BUFFER,i.__webglUV2Buffer),U.vertexAttribPointer(t.uv2,2,U.FLOAT,!1,0,0),U.enableVertexAttribArray(t.uv2)):U.disableVertexAttribArray(t.uv2)),r.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0&&(U.bindBuffer(U.ARRAY_BUFFER,i.__webglSkinVertexABuffer),U.vertexAttribPointer(t.skinVertexA,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,i.__webglSkinVertexBBuffer),U.vertexAttribPointer(t.skinVertexB,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),U.vertexAttribPointer(t.skinIndex,4,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),U.vertexAttribPointer(t.skinWeight,4,U.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(r.wireframe?(r=r.wireframeLinewidth,r!==rt&&(U.lineWidth(r),rt=r),e&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),U.drawElements(U.LINES,i.__webglLineCount,U.UNSIGNED_SHORT,0)):(e&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),U.drawElements(U.TRIANGLES,i.__webglFaceCount,U.UNSIGNED_SHORT,0)),R.info.render.calls++,R.info.render.vertices+=i.__webglFaceCount,R.info.render.faces+=i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?U.LINE_STRIP:U.LINES,r=r.linewidth,r!==rt&&(U.lineWidth(r),rt=r),U.drawArrays(s,0,i.__webglLineCount),R.info.render.calls++):s instanceof THREE.ParticleSystem?(U.drawArrays(U.POINTS,0,i.__webglParticleCount),R.info.render.calls++):s instanceof THREE.Ribbon&&(U.drawArrays(U.TRIANGLE_STRIP,0,i.__webglVertexCount),R.info.render.calls++)}}function f(e){at[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),at[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),at[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),at[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),at[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),at[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);for(var t,e=0;e<6;e++)t=at[e],t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}function l(e){for(var t=e.matrixWorld,n=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),r=0;r<6;r++)if(e=at[r].x*t.n14+at[r].y*t.n24+at[r].z*t.n34+at[r].w,e<=n)return!1;return!0}function c(e,t){return t.z-e.z}function h(e){var t,n,r,i,s,o,c,h,p=0,d=e.lights;dt||(dt=new THREE.PerspectiveCamera(R.shadowCameraFov,R.shadowMapWidth/R.shadowMapHeight,R.shadowCameraNear,R.shadowCameraFar)),t=0;for(n=d.length;t<n;t++)if(h=d[t],h.castShadow&&h instanceof THREE.SpotLight){V=-1,R.shadowMap[p]||(R.shadowMap[p]=new THREE.WebGLRenderTarget(R.shadowMapWidth,R.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),vt[p]=new THREE.Matrix4),r=R.shadowMap[p],i=vt[p],dt.position.copy(h.position),dt.lookAt(h.target.position),dt.parent==null&&(console.warn("Camera is not on the Scene. Adding it..."),e.add(dt),this.autoUpdateScene&&e.updateMatrixWorld()),dt.matrixWorldInverse.getInverse(dt.matrixWorld),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiplySelf(dt.projectionMatrix),i.multiplySelf(dt.matrixWorldInverse),dt.matrixWorldInverse.flattenToArray(ct),dt.projectionMatrix.flattenToArray(lt),ft.multiply(dt.projectionMatrix,dt.matrixWorldInverse),f(ft),O(r),U.clearColor(1,1,1,1),R.clear(),U.clearColor(F.r,F.g,F.b,I),i=e.__webglObjects.length;for(r=0;r<i;r++)if(o=e.__webglObjects[r],h=o.object,o.render=!1,h.visible&&h.castShadow&&(!(h instanceof THREE.Mesh)||!h.frustumCulled||l(h)))h.matrixWorld.flattenToArray(h._objectMatrixArray),w(h,dt,!1),o.render=!0;S(!0),N(THREE.NormalBlending);for(r=0;r<i;r++)if(o=e.__webglObjects[r],o.render)h=o.object,o=o.buffer,E(h),c=h.customDepthMaterial?h.customDepthMaterial:h.geometry.morphTargets.length?gt:mt,a(dt,d,null,c,o,h);i=e.__webglObjectsImmediate.length;for(r=0;r<i;r++)o=e.__webglObjectsImmediate[r],h=o.object,h.visible&&h.castShadow&&(h.matrixAutoUpdate&&h.matrixWorld.flattenToArray(h._objectMatrixArray),$=-1,w(h,dt,!1),E(h),s=b(dt,d,null,mt,h),h.immediateRenderCallback?h.immediateRenderCallback(s,U,at):h.render(function(e){u(e,s,mt.shading)}));p++}}function p(e,t,n,r,i,s,o,u){var f,l,c,h;t?(l=e.length-1,h=t=-1):(l=0,t=e.length,h=1);for(var p=l;p!==t;p+=h)if(f=e[p],f.render){l=f.object,c=f.buffer;if(u)f=u;else{f=f[n];if(!f)continue;o&&N(f.blending),S(f.depthTest),x(f.depthWrite),T(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}E(l),a(r,i,s,f,c,l)}}function d(e,t,n,r,i,s,o){for(var a,f,l,c,h=0,p=e.length;h<p;h++)if(a=e[h],f=a.object,f.visible){$=-1;if(o)l=o;else{l=a[t];if(!l)continue;s&&N(l.blending),S(l.depthTest),x(l.depthWrite),T(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}E(f),c=b(n,r,i,l,f),f.immediateRenderCallback?f.immediateRenderCallback(c,U,at):f.render(function(e){u(e,c,l.shading)})}}function v(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function m(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function g(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function y(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function b(e,t,n,r,i){r.program||R.initMaterial(r,t,n,i);if(r.morphTargets&&!i.__webglMorphTargetInfluences){i.__webglMorphTargetInfluences=new Float32Array(R.maxMorphTargets);for(var s=0,o=R.maxMorphTargets;s<o;s++)i.__webglMorphTargetInfluences[s]=0}var u=!1,s=r.program,o=s.uniforms,a=r.uniforms;s!==W&&(U.useProgram(s),W=s,u=!0),r.id!==V&&(V=r.id,u=!0);if(u){U.uniformMatrix4fv(o.projectionMatrix,!1,lt),n&&r.fog&&((a.fogColor.value=n.color,n instanceof THREE.Fog)?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){for(var f,l,c=0,h=0,p=0,d,v,m,g=pt,y=g.directional.colors,b=g.directional.positions,w=g.point.colors,E=g.point.positions,S=g.point.distances,x=0,T=0,n=f=m=0,u=t.length;n<u;n++)(f=t[n],l=f.color,d=f.position,v=f.intensity,m=f.distance,f instanceof THREE.AmbientLight)?R.gammaInput?(c+=l.r*l.r,h+=l.g*l.g,p+=l.b*l.b):(c+=l.r,h+=l.g,p+=l.b):f instanceof THREE.DirectionalLight?(m=x*3,R.gammaInput?(y[m]=l.r*l.r*v*v,y[m+1]=l.g*l.g*v*v,y[m+2]=l.b*l.b*v*v):(y[m]=l.r*v,y[m+1]=l.g*v,y[m+2]=l.b*v),b[m]=d.x,b[m+1]=d.y,b[m+2]=d.z,x+=1):f instanceof THREE.SpotLight?(m=x*3,R.gammaInput?(y[m]=l.r*l.r*v*v,y[m+1]=l.g*l.g*v*v,y[m+2]=l.b*l.b*v*v):(y[m]=l.r*v,y[m+1]=l.g*v,y[m+2]=l.b*v),l=1/d.length(),b[m]=d.x*l,b[m+1]=d.y*l,b[m+2]=d.z*l,x+=1):f instanceof THREE.PointLight&&(f=T*3,R.gammaInput?(w[f]=l.r*l.r*v*v,w[f+1]=l.g*l.g*v*v,w[f+2]=l.b*l.b*v*v):(w[f]=l.r*v,w[f+1]=l.g*v,w[f+2]=l.b*v),E[f]=d.x,E[f+1]=d.y,E[f+2]=d.z,S[T]=m,T+=1);n=x*3;for(u=y.length;n<u;n++)y[n]=0;n=T*3;for(u=w.length;n<u;n++)w[n]=0;g.point.length=T,g.directional.length=x,g.ambient[0]=c,g.ambient[1]=h,g.ambient[2]=p,t=pt,a.ambientLightColor.value=t.ambient,a.directionalLightColor.value=t.directional.colors,a.directionalLightDirection.value=t.directional.positions,a.pointLightColor.value=t.point.colors,a.pointLightPosition.value=t.point.positions,a.pointLightDistance.value=t.point.distances}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)a.opacity.value=r.opacity,R.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,(a.map.texture=r.map)&&a.offsetRepeat.value.set(r.map.offset.x,r.map.offset.y,r.map.repeat.x,r.map.repeat.y),a.lightMap.texture=r.lightMap,a.envMap.texture=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping;r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=D.height/2,a.map.texture=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,R.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.specular.value=r.specular)):r instanceof THREE.MeshLambertMaterial?R.gammaInput?a.ambient.value.copyGammaToLinear(r.ambient):a.ambient.value=r.ambient:r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix){for(t=0;t<vt.length;t++)a.shadowMatrix.value[t]=vt[t],a.shadowMap.texture[t]=R.shadowMap[t];a.shadowDarkness.value=R.shadowMapDarkness,a.shadowBias.value=R.shadowMapBias}t=r.uniformsList,a=0;for(n=t.length;a<n;a++)if(h=s.uniforms[t[a][1]])if(c=t[a][0],p=c.type,u=c.value,p==="i")U.uniform1i(h,u);else if(p==="f")U.uniform1f(h,u);else if(p==="v2")U.uniform2f(h,u.x,u.y);else if(p==="v3")U.uniform3f(h,u.x,u.y,u.z);else if(p==="v4")U.uniform4f(h,u.x,u.y,u.z,u.w);else if(p==="c")U.uniform3f(h,u.r,u.g,u.b);else if(p==="fv1")U.uniform1fv(h,u);else if(p==="fv")U.uniform3fv(h,u);else if(p==="v3v"){c._array||(c._array=new Float32Array(3*u.length)),p=0;for(d=u.length;p<d;p++)g=p*3,c._array[g]=u[p].x,c._array[g+1]=u[p].y,c._array[g+2]=u[p].z;U.uniform3fv(h,c._array)}else if(p==="m4")c._array||(c._array=new Float32Array(16)),u.flattenToArray(c._array),U.uniformMatrix4fv(h,!1,c._array);else if(p==="m4v"){c._array||(c._array=new Float32Array(16*u.length)),p=0;for(d=u.length;p<d;p++)u[p].flattenToArrayOffset(c._array,p*16);U.uniformMatrix4fv(h,!1,c._array)}else if(p==="t"){if(U.uniform1i(h,u),h=c.texture)if(h.image instanceof Array&&h.image.length===6){if(c=h,c.image.length===6)if(c.needsUpdate){c.image.__webglTextureCube||(c.image.__webglTextureCube=U.createTexture()),U.activeTexture(U.TEXTURE0+u),U.bindTexture(U.TEXTURE_CUBE_MAP,c.image.__webglTextureCube),u=k(U.TEXTURE_CUBE_MAP,c,c.image[0]);for(h=0;h<6;h++)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,c.image[h]);u&&U.generateMipmap(U.TEXTURE_CUBE_MAP),c.needsUpdate=!1}else U.activeTexture(U.TEXTURE0+u),U.bindTexture(U.TEXTURE_CUBE_MAP,c.image.__webglTextureCube)}else h instanceof THREE.WebGLRenderTargetCube?(c=h,U.activeTexture(U.TEXTURE0+u),U.bindTexture(U.TEXTURE_CUBE_MAP,c.__webglTexture)):L(h,u)}else if(p==="tv"){if(!c._array){c._array=[],p=0;for(d=c.texture.length;p<d;p++)c._array[p]=u+p}U.uniform1iv(h,c._array),p=0;for(d=c.texture.length;p<d;p++)(h=c.texture[p])&&L(h,c._array[p])}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&o.cameraPosition!==null&&U.uniform3f(o.cameraPosition,e.position.x,e.position.y,e.position.z),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&o.viewMatrix!==null&&U.uniformMatrix4fv(o.viewMatrix,!1,ct),r.skinning&&(U.uniformMatrix4fv(o.cameraInverseMatrix,!1,ct),U.uniformMatrix4fv(o.boneGlobalMatrices,!1,i.boneMatrices))}return U.uniformMatrix4fv(o.modelViewMatrix,!1,i._modelViewMatrixArray),o.normalMatrix&&U.uniformMatrix3fv(o.normalMatrix,!1,i._normalMatrixArray),(r instanceof THREE.ShaderMaterial||r.envMap||r.skinning||i.receiveShadow)&&o.objectMatrix!==null&&U.uniformMatrix4fv(o.objectMatrix,!1,i._objectMatrixArray),s}function w(e,t,n){e._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray),n&&THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function E(e){K!==e.doubleSided&&(e.doubleSided?U.disable(U.CULL_FACE):U.enable(U.CULL_FACE),K=e.doubleSided),Q!==e.flipSided&&(e.flipSided?U.frontFace(U.CW):U.frontFace(U.CCW),Q=e.flipSided)}function S(e){Y!==e&&(e?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST),Y=e)}function x(e){Z!==e&&(U.depthMask(e),Z=e)}function T(e,t,n){et!==e&&(e?U.enable(U.POLYGON_OFFSET_FILL):U.disable(U.POLYGON_OFFSET_FILL),et=e),e&&(tt!==t||nt!==n)&&(U.polygonOffset(t,n),tt=t,nt=n)}function N(e){if(e!==G){switch(e){case THREE.AdditiveBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE);break;case THREE.SubtractiveBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:U.blendEquation(U.FUNC_ADD),U.blendFunc(U.ZERO,U.SRC_COLOR);break;default:U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)}G=e}}function C(e,t){var n;return e==="fragment"?n=U.createShader(U.FRAGMENT_SHADER):e==="vertex"&&(n=U.createShader(U.VERTEX_SHADER)),U.shaderSource(n,t),U.compileShader(n),U.getShaderParameter(n,U.COMPILE_STATUS)?n:(console.error(U.getShaderInfoLog(n)),console.error(t),null)}function k(e,t,n){return(n.width&n.width-1)===0&&(n.height&n.height-1)===0?(U.texParameteri(e,U.TEXTURE_WRAP_S,_(t.wrapS)),U.texParameteri(e,U.TEXTURE_WRAP_T,_(t.wrapT)),U.texParameteri(e,U.TEXTURE_MAG_FILTER,_(t.magFilter)),U.texParameteri(e,U.TEXTURE_MIN_FILTER,_(t.minFilter)),!0):(U.texParameteri(e,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(e,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(e,U.TEXTURE_MAG_FILTER,M(t.magFilter)),U.texParameteri(e,U.TEXTURE_MIN_FILTER,M(t.minFilter)),!1)}function L(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=U.createTexture(),R.info.memory.textures++),U.activeTexture(U.TEXTURE0+t),U.bindTexture(U.TEXTURE_2D,e.__webglTexture);var n=k(U.TEXTURE_2D,e,e.image);e instanceof THREE.DataTexture?U.texImage2D(U.TEXTURE_2D,0,_(e.format),e.image.width,e.image.height,0,_(e.format),U.UNSIGNED_BYTE,e.image.data):U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,e.image),n&&U.generateMipmap(U.TEXTURE_2D),e.needsUpdate=!1,e.onUpdated&&e.onUpdated()}else U.activeTexture(U.TEXTURE0+t),U.bindTexture(U.TEXTURE_2D,e.__webglTexture)}function A(e,t){U.bindRenderbuffer(U.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,t.width,t.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,t.width,t.height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,e)):U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,t.width,t.height)}function O(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){e.depthBuffer===void 0&&(e.depthBuffer=!0),e.stencilBuffer===void 0&&(e.stencilBuffer=!0),e.__webglTexture=U.createTexture();if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],U.bindTexture(U.TEXTURE_CUBE_MAP,e.__webglTexture),k(U.TEXTURE_CUBE_MAP,e,e);for(var n=0;n<6;n++){e.__webglFramebuffer[n]=U.createFramebuffer(),e.__webglRenderbuffer[n]=U.createRenderbuffer(),U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,_(e.format),e.width,e.height,0,_(e.format),_(e.type),null);var r=e,i=U.TEXTURE_CUBE_MAP_POSITIVE_X+n;U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer[n]),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,i,r.__webglTexture,0),A(e.__webglRenderbuffer[n],e)}}else e.__webglFramebuffer=U.createFramebuffer(),e.__webglRenderbuffer=U.createRenderbuffer(),U.bindTexture(U.TEXTURE_2D,e.__webglTexture),k(U.TEXTURE_2D,e,e),U.texImage2D(U.TEXTURE_2D,0,_(e.format),e.width,e.height,0,_(e.format),_(e.type),null),n=U.TEXTURE_2D,U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,n,e.__webglTexture,0),A(e.__webglRenderbuffer,e);t?U.bindTexture(U.TEXTURE_CUBE_MAP,null):U.bindTexture(U.TEXTURE_2D,null),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=ot,e=ut,r=it,i=st),t!==X&&(U.bindFramebuffer(U.FRAMEBUFFER,t),U.viewport(r,i,n,e),X=t)}function M(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return U.NEAREST;default:return U.LINEAR}}function _(e){switch(e){case THREE.RepeatWrapping:return U.REPEAT;case THREE.ClampToEdgeWrapping:return U.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return U.MIRRORED_REPEAT;case THREE.NearestFilter:return U.NEAREST;case THREE.NearestMipMapNearestFilter:return U.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return U.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return U.LINEAR;case THREE.LinearMipMapNearestFilter:return U.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return U.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return U.BYTE;case THREE.UnsignedByteType:return U.UNSIGNED_BYTE;case THREE.ShortType:return U.SHORT;case THREE.UnsignedShortType:return U.UNSIGNED_SHORT;case THREE.IntType:return U.INT;case THREE.UnsignedShortType:return U.UNSIGNED_INT;case THREE.FloatType:return U.FLOAT;case THREE.AlphaFormat:return U.ALPHA;case THREE.RGBFormat:return U.RGB;case THREE.RGBAFormat:return U.RGBA;case THREE.LuminanceFormat:return U.LUMINANCE;case THREE.LuminanceAlphaFormat:return U.LUMINANCE_ALPHA}return 0}var e=e||{},D=e.canvas!==void 0?e.canvas:document.createElement("canvas"),P=e.precision!==void 0?e.precision:"highp",H=e.antialias!==void 0?e.antialias:!1,B=e.stencil!==void 0?e.stencil:!0,j=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,F=e.clearColor!==void 0?new THREE.Color(e.clearColor):new THREE.Color(0),I=e.clearAlpha!==void 0?e.clearAlpha:0,q=e.maxLights!==void 0?e.maxLights:4;this.domElement=D,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapBias=.0039,this.shadowMapDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCameraNear=1,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowMap=[],this.shadowMapEnabled=!1,this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.maxMorphTargets=8,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};var R=this,U,z=[],W=null,X=null,V=-1,$=null,J=0,K=null,Q=null,G=null,Y=null,Z=null,et=null,tt=null,nt=null,rt=null,it=0,st=0,ot=0,ut=0,at=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],ft=new THREE.Matrix4,lt=new Float32Array(16),ct=new Float32Array(16),ht=new THREE.Vector4,pt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},dt,vt=[],mt,gt,yt={},bt=!1;U=function(){var e;try{if(!(e=D.getContext("experimental-webgl",{antialias:H,stencil:B,preserveDrawingBuffer:j})))throw"Error creating WebGL context.";console.log(navigator.userAgent+" | "+e.getParameter(e.VERSION)+" | "+e.getParameter(e.VENDOR)+" | "+e.getParameter(e.RENDERER)+" | "+e.getParameter(e.SHADING_LANGUAGE_VERSION))}catch(t){console.error(t)}return e}(),U.clearColor(0,0,0,1),U.clearDepth(1),U.clearStencil(0),U.enable(U.DEPTH_TEST),U.depthFunc(U.LEQUAL),U.frontFace(U.CCW),U.cullFace(U.BACK),U.enable(U.CULL_FACE),U.enable(U.BLEND),U.blendEquation(U.FUNC_ADD),U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA),U.clearColor(F.r,F.g,F.b,I),function(){yt.vertices=new Float32Array(16),yt.faces=new Uint16Array(6);var e=0;yt.vertices[e++]=-1,yt.vertices[e++]=-1,yt.vertices[e++]=0,yt.vertices[e++]=1,yt.vertices[e++]=1,yt.vertices[e++]=-1,yt.vertices[e++]=1,yt.vertices[e++]=1,yt.vertices[e++]=1,yt.vertices[e++]=1,yt.vertices[e++]=1,yt.vertices[e++]=0,yt.vertices[e++]=-1,yt.vertices[e++]=1,yt.vertices[e++]=0,e=yt.vertices[e++]=0,yt.faces[e++]=0,yt.faces[e++]=1,yt.faces[e++]=2,yt.faces[e++]=0,yt.faces[e++]=2,yt.faces[e++]=3,yt.vertexBuffer=U.createBuffer(),yt.elementBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,yt.vertexBuffer),U.bufferData(U.ARRAY_BUFFER,yt.vertices,U.STATIC_DRAW),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,yt.elementBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,yt.faces,U.STATIC_DRAW),yt.program=U.createProgram(),U.attachShader(yt.program,C("fragment",THREE.ShaderLib.sprite.fragmentShader)),U.attachShader(yt.program,C("vertex",THREE.ShaderLib.sprite.vertexShader)),U.linkProgram(yt.program),yt.attributes={},yt.uniforms={},yt.attributes.position=U.getAttribLocation(yt.program,"position"),yt.attributes.uv=U.getAttribLocation(yt.program,"uv"),yt.uniforms.uvOffset=U.getUniformLocation(yt.program,"uvOffset"),yt.uniforms.uvScale=U.getUniformLocation(yt.program,"uvScale"),yt.uniforms.rotation=U.getUniformLocation(yt.program,"rotation"),yt.uniforms.scale=U.getUniformLocation(yt.program,"scale"),yt.uniforms.alignment=U.getUniformLocation(yt.program,"alignment"),yt.uniforms.color=U.getUniformLocation(yt.program,"color"),yt.uniforms.map=U.getUniformLocation(yt.program,"map"),yt.uniforms.opacity=U.getUniformLocation(yt.program,"opacity"),yt.uniforms.useScreenCoordinates=U.getUniformLocation(yt.program,"useScreenCoordinates"),yt.uniforms.affectedByDistance=U.getUniformLocation(yt.program,"affectedByDistance"),yt.uniforms.screenPosition=U.getUniformLocation(yt.program,"screenPosition"),yt.uniforms.modelViewMatrix=U.getUniformLocation(yt.program,"modelViewMatrix"),yt.uniforms.projectionMatrix=U.getUniformLocation(yt.program,"projectionMatrix")}(),function(){var e=THREE.ShaderLib.depthRGBA,t=THREE.UniformsUtils.clone(e.uniforms);mt=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:t}),gt=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:t,morphTargets:!0}),mt._shadowPass=!0,gt._shadowPass=!0}(),this.context=U;var wt=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.getContext=function(){return U},this.supportsVertexTextures=function(){return wt},this.setSize=function(e,t){D.width=e,D.height=t,this.setViewport(0,0,D.width,D.height)},this.setViewport=function(e,t,n,r){it=e,st=t,ot=n,ut=r,U.viewport(it,st,ot,ut)},this.setScissor=function(e,t,n,r){U.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)},this.setClearColorHex=function(e,t){F.setHex(e),I=t,U.clearColor(F.r,F.g,F.b,I)},this.setClearColor=function(e,t){F.copy(e),I=t,U.clearColor(F.r,F.g,F.b,I)},this.getClearColor=function(){return F},this.getClearAlpha=function(){return I},this.clear=function(e,t,n){var r=0;if(e===void 0||e)r|=U.COLOR_BUFFER_BIT;if(t===void 0||t)r|=U.DEPTH_BUFFER_BIT;if(n===void 0||n)r|=U.STENCIL_BUFFER_BIT;U.clear(r)},this.clearTarget=function(e,t,n,r){O(e),this.clear(t,n,r)},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._objectMatrixArray,e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var n=e.geometry.geometryGroups[t];U.deleteBuffer(n.__webglVertexBuffer),U.deleteBuffer(n.__webglNormalBuffer),U.deleteBuffer(n.__webglTangentBuffer),U.deleteBuffer(n.__webglColorBuffer),U.deleteBuffer(n.__webglUVBuffer),U.deleteBuffer(n.__webglUV2Buffer),U.deleteBuffer(n.__webglSkinVertexABuffer),U.deleteBuffer(n.__webglSkinVertexBBuffer),U.deleteBuffer(n.__webglSkinIndicesBuffer),U.deleteBuffer(n.__webglSkinWeightsBuffer),U.deleteBuffer(n.__webglFaceBuffer),U.deleteBuffer(n.__webglLineBuffer);if(n.numMorphTargets)for(var r=0,i=n.numMorphTargets;r<i;r++)U.deleteBuffer(n.__webglMorphTargetsBuffers[r]);if(n.__webglCustomAttributesList)for(r in r=void 0,n.__webglCustomAttributesList)U.deleteBuffer(n.__webglCustomAttributesList[r].buffer);R.info.memory.geometries--}else e instanceof THREE.Ribbon?(e=e.geometry,U.deleteBuffer(e.__webglVertexBuffer),U.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--):e instanceof THREE.Line?(e=e.geometry,U.deleteBuffer(e.__webglVertexBuffer),U.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--):e instanceof THREE.ParticleSystem&&(e=e.geometry,U.deleteBuffer(e.__webglVertexBuffer),U.deleteBuffer(e.__webglColorBuffer),R.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,U.deleteTexture(e.__webglTexture),R.info.memory.textures--)},this.updateShadowMap=function(e,t){h(e,t)},this.render=function(e,t,n,r){var i,s,o,u,a=e.lights,v=e.fog;V=-1,this.autoUpdateObjects&&this.initWebGLObjects(e),t.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(t)),this.autoUpdateScene&&e.updateMatrixWorld(),this.shadowMapEnabled&&this.shadowMapAutoUpdate&&h(e,t),R.info.render.calls=0,R.info.render.vertices=0,R.info.render.faces=0,t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(ct),t.projectionMatrix.flattenToArray(lt),ft.multiply(t.projectionMatrix,t.matrixWorldInverse),f(ft),O(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,r=0;for(i=u.length;r<i;r++)if(s=u[r],o=s.object,s.render=!1,o.visible&&(!(o instanceof THREE.Mesh)||!o.frustumCulled||l(o))){o.matrixWorld.flattenToArray(o._objectMatrixArray),w(o,t,!0);var m=s,g=m.object,y=m.buffer,b=void 0,b=b=void 0,b=g.material;if(b instanceof THREE.MeshFaceMaterial){if(b=y.materialIndex,b>=0)b=g.geometry.materials[b],b.transparent?(m.transparent=b,m.opaque=null):(m.opaque=b,m.transparent=null)}else b&&(b.transparent?(m.transparent=b,m.opaque=null):(m.opaque=b,m.transparent=null));s.render=!0,this.sortObjects&&(o.renderDepth?s.z=o.renderDepth:(ht.copy(o.position),ft.multiplyVector3(ht),s.z=ht.z))}this.sortObjects&&u.sort(c),u=e.__webglObjectsImmediate,r=0;for(i=u.length;r<i;r++)if(s=u[r],o=s.object,o.visible)o.matrixAutoUpdate&&o.matrixWorld.flattenToArray(o._objectMatrixArray),w(o,t,!0),o=s.object.material,o.transparent?(s.transparent=o,s.opaque=null):(s.opaque=o,s.transparent=null);e.overrideMaterial?(N(e.overrideMaterial.blending),S(e.overrideMaterial.depthTest),x(e.overrideMaterial.depthWrite),T(e.overrideMaterial.polygonOffset,e.overrideMaterial.polygonOffsetFactor,e.overrideMaterial.polygonOffsetUnits),p(e.__webglObjects,!1,"",t,a,v,!0,e.overrideMaterial),d(e.__webglObjectsImmediate,"",t,a,v,!1,e.overrideMaterial)):(N(THREE.NormalBlending),p(e.__webglObjects,!0,"opaque",t,a,v,!1),d(e.__webglObjectsImmediate,"opaque",t,a,v,!1),p(e.__webglObjects,!1,"transparent",t,a,v,!0),d(e.__webglObjectsImmediate,"transparent",t,a,v,!0));if(e.__webglSprites.length){o=yt.attributes,a=yt.uniforms,v=ut/ot,r=[],i=ot*.5,u=ut*.5,s=!0,U.useProgram(yt.program),W=yt.program,$=Y=G=-1,bt||(U.enableVertexAttribArray(yt.attributes.position),U.enableVertexAttribArray(yt.attributes.uv),bt=!0),U.disable(U.CULL_FACE),U.enable(U.BLEND),U.depthMask(!0),U.bindBuffer(U.ARRAY_BUFFER,yt.vertexBuffer),U.vertexAttribPointer(o.position,2,U.FLOAT,!1,16,0),U.vertexAttribPointer(o.uv,2,U.FLOAT,!1,16,8),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,yt.elementBuffer),U.uniformMatrix4fv(a.projectionMatrix,!1,lt),U.activeTexture(U.TEXTURE0),U.uniform1i(a.map,0),o=0;for(m=e.__webglSprites.length;o<m;o++)if(g=e.__webglSprites[o],g.visible&&g.opacity!==0)g.useScreenCoordinates?g.z=-g.position.z:(g._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,g.matrixWorld,g._modelViewMatrixArray),g.z=-g._modelViewMatrix.n34);e.__webglSprites.sort(c),o=0;for(m=e.__webglSprites.length;o<m;o++)g=e.__webglSprites[o],g.visible&&g.opacity!==0&&g.map&&g.map.image&&g.map.image.width&&(g.useScreenCoordinates?(U.uniform1i(a.useScreenCoordinates,1),U.uniform3f(a.screenPosition,(g.position.x-i)/i,(u-g.position.y)/u,Math.max(0,Math.min(1,g.position.z)))):(U.uniform1i(a.useScreenCoordinates,0),U.uniform1i(a.affectedByDistance,g.affectedByDistance?1:0),U.uniformMatrix4fv(a.modelViewMatrix,!1,g._modelViewMatrixArray)),t=g.map.image.width/(g.scaleByViewport?ut:1),r[0]=t*v*g.scale.x,r[1]=t*g.scale.y,U.uniform2f(a.uvScale,g.uvScale.x,g.uvScale.y),U.uniform2f(a.uvOffset,g.uvOffset.x,g.uvOffset.y),U.uniform2f(a.alignment,g.alignment.x,g.alignment.y),U.uniform1f(a.opacity,g.opacity),U.uniform3f(a.color,g.color.r,g.color.g,g.color.b),U.uniform1f(a.rotation,g.rotation),U.uniform2fv(a.scale,r),g.mergeWith3D&&!s?(U.enable(U.DEPTH_TEST),s=!0):!g.mergeWith3D&&s&&(U.disable(U.DEPTH_TEST),s=!1),N(g.blending),L(g.map,0),U.drawElements(U.TRIANGLES,6,U.UNSIGNED_SHORT,0));U.enable(U.CULL_FACE),U.enable(U.DEPTH_TEST),U.depthMask(Z)}n&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(U.bindTexture(U.TEXTURE_CUBE_MAP,n.__webglTexture),U.generateMipmap(U.TEXTURE_CUBE_MAP),U.bindTexture(U.TEXTURE_CUBE_MAP,null)):(U.bindTexture(U.TEXTURE_2D,n.__webglTexture),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null)))},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[]);for(;e.__objectsAdded.length;){var u=e.__objectsAdded[0],a=e,f=void 0,l=void 0,c=void 0;if(!u.__webglInit)if(u.__webglInit=!0,u._modelViewMatrix=new THREE.Matrix4,u._normalMatrixArray=new Float32Array(9),u._modelViewMatrixArray=new Float32Array(16),u._objectMatrixArray=new Float32Array(16),u.matrixWorld.flattenToArray(u._objectMatrixArray),u instanceof THREE.Mesh){l=u.geometry;if(l.geometryGroups===void 0){var c=l,h=void 0,p=void 0,d=void 0,b=void 0,w=void 0,E=void 0,S=void 0,x={},T=c.morphTargets.length;c.geometryGroups={},h=0;for(p=c.faces.length;h<p;h++)d=c.faces[h],b=d.materialIndex,E=b!==void 0?b:-1,x[E]===void 0&&(x[E]={hash:E,counter:0}),S=x[E].hash+"_"+x[E].counter,c.geometryGroups[S]===void 0&&(c.geometryGroups[S]={faces3:[],faces4:[],materialIndex:b,vertices:0,numMorphTargets:T}),w=d instanceof THREE.Face3?3:4,c.geometryGroups[S].vertices+w>65535&&(x[E].counter+=1,S=x[E].hash+"_"+x[E].counter,c.geometryGroups[S]===void 0&&(c.geometryGroups[S]={faces3:[],faces4:[],materialIndex:b,vertices:0,numMorphTargets:T})),d instanceof THREE.Face3?c.geometryGroups[S].faces3.push(h):c.geometryGroups[S].faces4.push(h),c.geometryGroups[S].vertices+=w;c.geometryGroupsList=[],h=void 0;for(h in c.geometryGroups)c.geometryGroups[h].id=J++,c.geometryGroupsList.push(c.geometryGroups[h])}for(f in l.geometryGroups)if(c=l.geometryGroups[f],!c.__webglVertexBuffer){h=c,h.__webglVertexBuffer=U.createBuffer(),h.__webglNormalBuffer=U.createBuffer(),h.__webglTangentBuffer=U.createBuffer(),h.__webglColorBuffer=U.createBuffer(),h.__webglUVBuffer=U.createBuffer(),h.__webglUV2Buffer=U.createBuffer(),h.__webglSkinVertexABuffer=U.createBuffer(),h.__webglSkinVertexBBuffer=U.createBuffer(),h.__webglSkinIndicesBuffer=U.createBuffer(),h.__webglSkinWeightsBuffer=U.createBuffer(),h.__webglFaceBuffer=U.createBuffer(),h.__webglLineBuffer=U.createBuffer();if(h.numMorphTargets){d=p=void 0,h.__webglMorphTargetsBuffers=[],p=0;for(d=h.numMorphTargets;p<d;p++)h.__webglMorphTargetsBuffers.push(U.createBuffer())}R.info.memory.geometries++,b=u,w=b.geometry,p=c.faces3,E=c.faces4,h=p.length*3+E.length*4,d=p.length*1+E.length*2,E=p.length*3+E.length*4,p=n(b,c),S=s(p),x=r(p),T=i(p),c.__vertexArray=new Float32Array(h*3),x&&(c.__normalArray=new Float32Array(h*3)),w.hasTangents&&(c.__tangentArray=new Float32Array(h*4)),T&&(c.__colorArray=new Float32Array(h*3));if(S){if(w.faceUvs.length>0||w.faceVertexUvs.length>0)c.__uvArray=new Float32Array(h*2);if(w.faceUvs.length>1||w.faceVertexUvs.length>1)c.__uv2Array=new Float32Array(h*2)}b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(c.__skinVertexAArray=new Float32Array(h*4),c.__skinVertexBArray=new Float32Array(h*4),c.__skinIndexArray=new Float32Array(h*4),c.__skinWeightArray=new Float32Array(h*4)),c.__faceArray=new Uint16Array(d*3),c.__lineArray=new Uint16Array(E*2);if(c.numMorphTargets){c.__morphTargetsArrays=[],b=0;for(w=c.numMorphTargets;b<w;b++)c.__morphTargetsArrays.push(new Float32Array(h*3))}c.__webglFaceCount=d*3,c.__webglLineCount=E*2;if(p.attributes){c.__webglCustomAttributesList===void 0&&(c.__webglCustomAttributesList=[]),d=void 0;for(d in p.attributes){var b=p.attributes[d],w={},N;for(N in b)w[N]=b[N];if(!w.__webglInitialized||w.createUniqueBuffers)w.__webglInitialized=!0,E=1,w.type==="v2"?E=2:w.type==="v3"?E=3:w.type==="v4"?E=4:w.type==="c"&&(E=3),w.size=E,w.array=new Float32Array(h*E),w.buffer=U.createBuffer(),w.buffer.belongsToAttribute=d,b.needsUpdate=!0,w.__original=b;c.__webglCustomAttributesList.push(w)}}c.__inittedArrays=!0,l.__dirtyVertices=!0,l.__dirtyMorphTargets=!0,l.__dirtyElements=!0,l.__dirtyUvs=!0,l.__dirtyNormals=!0,l.__dirtyTangents=!0,l.__dirtyColors=!0}}else if(u instanceof THREE.Ribbon){if(l=u.geometry,!l.__webglVertexBuffer)c=l,c.__webglVertexBuffer=U.createBuffer(),c.__webglColorBuffer=U.createBuffer(),R.info.memory.geometries++,c=l,h=c.vertices.length,c.__vertexArray=new Float32Array(h*3),c.__colorArray=new Float32Array(h*3),c.__webglVertexCount=h,l.__dirtyVertices=!0,l.__dirtyColors=!0}else if(u instanceof THREE.Line){if(l=u.geometry,!l.__webglVertexBuffer)c=l,c.__webglVertexBuffer=U.createBuffer(),c.__webglColorBuffer=U.createBuffer(),R.info.memory.geometries++,c=l,h=u,p=c.vertices.length,c.__vertexArray=new Float32Array(p*3),c.__colorArray=new Float32Array(p*3),c.__webglLineCount=p,t(c,h),l.__dirtyVertices=!0,l.__dirtyColors=!0}else u instanceof THREE.ParticleSystem&&(l=u.geometry,!l.__webglVertexBuffer)&&(c=l,c.__webglVertexBuffer=U.createBuffer(),c.__webglColorBuffer=U.createBuffer(),R.info.geometries++,c=l,h=u,p=c.vertices.length,c.__vertexArray=new Float32Array(p*3),c.__colorArray=new Float32Array(p*3),c.__sortArray=[],c.__webglParticleCount=p,t(c,h),l.__dirtyVertices=!0,l.__dirtyColors=!0);if(!u.__webglActive){if(u instanceof THREE.Mesh)for(f in l=u.geometry,l.geometryGroups)c=l.geometryGroups[f],v(a.__webglObjects,c,u);else u instanceof THREE.Ribbon||u instanceof THREE.Line||u instanceof THREE.ParticleSystem?(l=u.geometry,v(a.__webglObjects,l,u)):THREE.MarchingCubes!==void 0&&u instanceof THREE.MarchingCubes||u.immediateRenderCallback?a.__webglObjectsImmediate.push({object:u,opaque:null,transparent:null}):u instanceof THREE.Sprite&&a.__webglSprites.push(u);u.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){u=e.__objectsRemoved[0],a=e;if(u instanceof THREE.Mesh||u instanceof THREE.ParticleSystem||u instanceof THREE.Ribbon||u instanceof THREE.Line)y(a.__webglObjects,u);else if(u instanceof THREE.Sprite){a=a.__webglSprites,f=u;for(l=a.length-1;l>=0;l--)a[l]===f&&a.splice(l,1)}else(u instanceof THREE.MarchingCubes||u.immediateRenderCallback)&&y(a.__webglObjectsImmediate,u);u.__webglActive=!1,e.__objectsRemoved.splice(0,1)}u=0;for(a=e.__webglObjects.length;u<a;u++)if(N=e.__webglObjects[u].object,f=N.geometry,l=d=p=void 0,N instanceof THREE.Mesh){c=0;for(h=f.geometryGroupsList.length;c<h;c++)if(p=f.geometryGroupsList[c],l=n(N,p),d=l.attributes&&m(l),f.__dirtyVertices||f.__dirtyMorphTargets||f.__dirtyElements||f.__dirtyUvs||f.__dirtyNormals||f.__dirtyColors||f.__dirtyTangents||d){var C=N,d=U.DYNAMIC_DRAW,b=!f.dynamic,S=l;if(p.__inittedArrays){var w=r(S),E=i(S),k=s(S),L=w===THREE.SmoothShading,A=x=S=void 0,O=void 0,M=void 0,_=void 0,D=void 0,P=void 0,H=void 0,B=A=void 0,j=void 0,F=void 0,I=void 0,q=O=void 0,z=void 0,W=void 0,X=O=H=void 0,V=void 0,$=I=F=j=D=void 0,K=O=I=F=j=$=I=F=j=$=I=F=j=void 0,Q=void 0,G=_=void 0,Y=void 0,Z=void 0,et=void 0,tt=void 0,nt=B=Z=Q=0,rt=0,it=K=A=0,st=D=q=0,ot=0,ut=void 0,st=p.__vertexArray,Y=p.__uvArray,ot=p.__uv2Array,G=p.__normalArray,M=p.__tangentArray,z=p.__colorArray,X=p.__skinVertexAArray,V=p.__skinVertexBArray,P=p.__skinIndexArray,at=p.__skinWeightArray,$=p.__morphTargetsArrays,T=p.__webglCustomAttributesList,ft=void 0,ft=p.__faceArray,ut=p.__lineArray,W=C.geometry,lt=W.__dirtyElements,ct=W.__dirtyUvs,_=W.__dirtyNormals,H=W.__dirtyTangents,ht=W.__dirtyColors,et=W.__dirtyMorphTargets,tt=W.vertices,C=p.faces3,pt=p.faces4,dt=W.faces,vt=W.faceVertexUvs[0],mt=W.faceVertexUvs[1],gt=W.skinVerticesA,yt=W.skinVerticesB,bt=W.skinIndices,wt=W.skinWeights,Et=W.morphTargets;if(W.__dirtyVertices){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=tt[O.a].position,F=tt[O.b].position,I=tt[O.c].position,st[Z]=j.x,st[Z+1]=j.y,st[Z+2]=j.z,st[Z+3]=F.x,st[Z+4]=F.y,st[Z+5]=F.z,st[Z+6]=I.x,st[Z+7]=I.y,st[Z+8]=I.z,Z+=9;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=tt[O.a].position,F=tt[O.b].position,I=tt[O.c].position,O=tt[O.d].position,st[Z]=j.x,st[Z+1]=j.y,st[Z+2]=j.z,st[Z+3]=F.x,st[Z+4]=F.y,st[Z+5]=F.z,st[Z+6]=I.x,st[Z+7]=I.y,st[Z+8]=I.z,st[Z+9]=O.x,st[Z+10]=O.y,st[Z+11]=O.z,Z+=12;U.bindBuffer(U.ARRAY_BUFFER,p.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,st,d)}if(et){Z=0;for(et=Et.length;Z<et;Z++){S=st=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=Et[Z].vertices[O.a].position,F=Et[Z].vertices[O.b].position,I=Et[Z].vertices[O.c].position,tt=$[Z],tt[st]=j.x,tt[st+1]=j.y,tt[st+2]=j.z,tt[st+3]=F.x,tt[st+4]=F.y,tt[st+5]=F.z,tt[st+6]=I.x,tt[st+7]=I.y,tt[st+8]=I.z,st+=9;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=Et[Z].vertices[O.a].position,F=Et[Z].vertices[O.b].position,I=Et[Z].vertices[O.c].position,O=Et[Z].vertices[O.d].position,tt=$[Z],tt[st]=j.x,tt[st+1]=j.y,tt[st+2]=j.z,tt[st+3]=F.x,tt[st+4]=F.y,tt[st+5]=F.z,tt[st+6]=I.x,tt[st+7]=I.y,tt[st+8]=I.z,tt[st+9]=O.x,tt[st+10]=O.y,tt[st+11]=O.z,st+=12;U.bindBuffer(U.ARRAY_BUFFER,p.__webglMorphTargetsBuffers[Z]),U.bufferData(U.ARRAY_BUFFER,$[Z],d)}}if(wt.length){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=wt[O.a],F=wt[O.b],I=wt[O.c],at[D]=j.x,at[D+1]=j.y,at[D+2]=j.z,at[D+3]=j.w,at[D+4]=F.x,at[D+5]=F.y,at[D+6]=F.z,at[D+7]=F.w,at[D+8]=I.x,at[D+9]=I.y,at[D+10]=I.z,at[D+11]=I.w,j=bt[O.a],F=bt[O.b],I=bt[O.c],P[D]=j.x,P[D+1]=j.y,P[D+2]=j.z,P[D+3]=j.w,P[D+4]=F.x,P[D+5]=F.y,P[D+6]=F.z,P[D+7]=F.w,P[D+8]=I.x,P[D+9]=I.y,P[D+10]=I.z,P[D+11]=I.w,j=gt[O.a],F=gt[O.b],I=gt[O.c],X[D]=j.x,X[D+1]=j.y,X[D+2]=j.z,X[D+3]=1,X[D+4]=F.x,X[D+5]=F.y,X[D+6]=F.z,X[D+7]=1,X[D+8]=I.x,X[D+9]=I.y,X[D+10]=I.z,X[D+11]=1,j=yt[O.a],F=yt[O.b],I=yt[O.c],V[D]=j.x,V[D+1]=j.y,V[D+2]=j.z,V[D+3]=1,V[D+4]=F.x,V[D+5]=F.y,V[D+6]=F.z,V[D+7]=1,V[D+8]=I.x,V[D+9]=I.y,V[D+10]=I.z,V[D+11]=1,D+=12;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=wt[O.a],F=wt[O.b],I=wt[O.c],$=wt[O.d],at[D]=j.x,at[D+1]=j.y,at[D+2]=j.z,at[D+3]=j.w,at[D+4]=F.x,at[D+5]=F.y,at[D+6]=F.z,at[D+7]=F.w,at[D+8]=I.x,at[D+9]=I.y,at[D+10]=I.z,at[D+11]=I.w,at[D+12]=$.x,at[D+13]=$.y,at[D+14]=$.z,at[D+15]=$.w,j=bt[O.a],F=bt[O.b],I=bt[O.c],$=bt[O.d],P[D]=j.x,P[D+1]=j.y,P[D+2]=j.z,P[D+3]=j.w,P[D+4]=F.x,P[D+5]=F.y,P[D+6]=F.z,P[D+7]=F.w,P[D+8]=I.x,P[D+9]=I.y,P[D+10]=I.z,P[D+11]=I.w,P[D+12]=$.x,P[D+13]=$.y,P[D+14]=$.z,P[D+15]=$.w,j=gt[O.a],F=gt[O.b],I=gt[O.c],$=gt[O.d],X[D]=j.x,X[D+1]=j.y,X[D+2]=j.z,X[D+3]=1,X[D+4]=F.x,X[D+5]=F.y,X[D+6]=F.z,X[D+7]=1,X[D+8]=I.x,X[D+9]=I.y,X[D+10]=I.z,X[D+11]=1,X[D+12]=$.x,X[D+13]=$.y,X[D+14]=$.z,X[D+15]=1,j=yt[O.a],F=yt[O.b],I=yt[O.c],O=yt[O.d],V[D]=j.x,V[D+1]=j.y,V[D+2]=j.z,V[D+3]=1,V[D+4]=F.x,V[D+5]=F.y,V[D+6]=F.z,V[D+7]=1,V[D+8]=I.x,V[D+9]=I.y,V[D+10]=I.z,V[D+11]=1,V[D+12]=O.x,V[D+13]=O.y,V[D+14]=O.z,V[D+15]=1,D+=16;D>0&&(U.bindBuffer(U.ARRAY_BUFFER,p.__webglSkinVertexABuffer),U.bufferData(U.ARRAY_BUFFER,X,d),U.bindBuffer(U.ARRAY_BUFFER,p.__webglSkinVertexBBuffer),U.bufferData(U.ARRAY_BUFFER,V,d),U.bindBuffer(U.ARRAY_BUFFER,p.__webglSkinIndicesBuffer),U.bufferData(U.ARRAY_BUFFER,P,d),U.bindBuffer(U.ARRAY_BUFFER,p.__webglSkinWeightsBuffer),U.bufferData(U.ARRAY_BUFFER,at,d))}if(ht&&E){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],D=O.vertexColors,P=O.color,D.length===3&&E===THREE.VertexColors?(O=D[0],X=D[1],V=D[2]):V=X=O=P,z[q]=O.r,z[q+1]=O.g,z[q+2]=O.b,z[q+3]=X.r,z[q+4]=X.g,z[q+5]=X.b,z[q+6]=V.r,z[q+7]=V.g,z[q+8]=V.b,q+=9;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],D=O.vertexColors,P=O.color,D.length===4&&E===THREE.VertexColors?(O=D[0],X=D[1],V=D[2],D=D[3]):D=V=X=O=P,z[q]=O.r,z[q+1]=O.g,z[q+2]=O.b,z[q+3]=X.r,z[q+4]=X.g,z[q+5]=X.b,z[q+6]=V.r,z[q+7]=V.g,z[q+8]=V.b,z[q+9]=D.r,z[q+10]=D.g,z[q+11]=D.b,q+=12;q>0&&(U.bindBuffer(U.ARRAY_BUFFER,p.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,z,d))}if(H&&W.hasTangents){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],H=O.vertexTangents,q=H[0],z=H[1],W=H[2],M[K]=q.x,M[K+1]=q.y,M[K+2]=q.z,M[K+3]=q.w,M[K+4]=z.x,M[K+5]=z.y,M[K+6]=z.z,M[K+7]=z.w,M[K+8]=W.x,M[K+9]=W.y,M[K+10]=W.z,M[K+11]=W.w,K+=12;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],H=O.vertexTangents,q=H[0],z=H[1],W=H[2],H=H[3],M[K]=q.x,M[K+1]=q.y,M[K+2]=q.z,M[K+3]=q.w,M[K+4]=z.x,M[K+5]=z.y,M[K+6]=z.z,M[K+7]=z.w,M[K+8]=W.x,M[K+9]=W.y,M[K+10]=W.z,M[K+11]=W.w,M[K+12]=H.x,M[K+13]=H.y,M[K+14]=H.z,M[K+15]=H.w,K+=16;U.bindBuffer(U.ARRAY_BUFFER,p.__webglTangentBuffer),U.bufferData(U.ARRAY_BUFFER,M,d)}if(_&&w){S=0;for(x=C.length;S<x;S++)if(O=dt[C[S]],M=O.vertexNormals,_=O.normal,M.length===3&&L)for(K=0;K<3;K++)_=M[K],G[A]=_.x,G[A+1]=_.y,G[A+2]=_.z,A+=3;else for(K=0;K<3;K++)G[A]=_.x,G[A+1]=_.y,G[A+2]=_.z,A+=3;S=0;for(x=pt.length;S<x;S++)if(O=dt[pt[S]],M=O.vertexNormals,_=O.normal,M.length===4&&L)for(K=0;K<4;K++)_=M[K],G[A]=_.x,G[A+1]=_.y,G[A+2]=_.z,A+=3;else for(K=0;K<4;K++)G[A]=_.x,G[A+1]=_.y,G[A+2]=_.z,A+=3;U.bindBuffer(U.ARRAY_BUFFER,p.__webglNormalBuffer),U.bufferData(U.ARRAY_BUFFER,G,d)}if(ct&&vt&&k){S=0;for(x=C.length;S<x;S++)if(A=C[S],A=vt[A],A!==void 0)for(K=0;K<3;K++)G=A[K],Y[B]=G.u,Y[B+1]=G.v,B+=2;S=0;for(x=pt.length;S<x;S++)if(A=pt[S],A=vt[A],A!==void 0)for(K=0;K<4;K++)G=A[K],Y[B]=G.u,Y[B+1]=G.v,B+=2;B>0&&(U.bindBuffer(U.ARRAY_BUFFER,p.__webglUVBuffer),U.bufferData(U.ARRAY_BUFFER,Y,d))}if(ct&&mt&&k){S=0;for(x=C.length;S<x;S++)if(A=C[S],B=mt[A],B!==void 0)for(K=0;K<3;K++)Y=B[K],ot[nt]=Y.u,ot[nt+1]=Y.v,nt+=2;S=0;for(x=pt.length;S<x;S++)if(A=pt[S],B=mt[A],B!==void 0)for(K=0;K<4;K++)Y=B[K],ot[nt]=Y.u,ot[nt+1]=Y.v,nt+=2;nt>0&&(U.bindBuffer(U.ARRAY_BUFFER,p.__webglUV2Buffer),U.bufferData(U.ARRAY_BUFFER,ot,d))}if(lt){S=0;for(x=C.length;S<x;S++)ft[rt]=Q,ft[rt+1]=Q+1,ft[rt+2]=Q+2,rt+=3,ut[it]=Q,ut[it+1]=Q+1,ut[it+2]=Q,ut[it+3]=Q+2,ut[it+4]=Q+1,ut[it+5]=Q+2,it+=6,Q+=3;S=0;for(x=pt.length;S<x;S++)ft[rt]=Q,ft[rt+1]=Q+1,ft[rt+2]=Q+3,ft[rt+3]=Q+1,ft[rt+4]=Q+2,ft[rt+5]=Q+3,rt+=6,ut[it]=Q,ut[it+1]=Q+1,ut[it+2]=Q,ut[it+3]=Q+3,ut[it+4]=Q+1,ut[it+5]=Q+2,ut[it+6]=Q+2,ut[it+7]=Q+3,it+=8,Q+=4;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,p.__webglFaceBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,ft,d),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,p.__webglLineBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,ut,d)}if(T){K=0;for(Q=T.length;K<Q;K++)if(ft=T[K],ft.__original.needsUpdate){ot=0;if(ft.size===1){if(ft.boundTo===void 0||ft.boundTo==="vertices"){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],ft.array[ot]=ft.value[O.a],ft.array[ot+1]=ft.value[O.b],ft.array[ot+2]=ft.value[O.c],ot+=3;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],ft.array[ot]=ft.value[O.a],ft.array[ot+1]=ft.value[O.b],ft.array[ot+2]=ft.value[O.c],ft.array[ot+3]=ft.value[O.d],ot+=4}else if(ft.boundTo==="faces"){S=0;for(x=C.length;S<x;S++)ut=ft.value[C[S]],ft.array[ot]=ut,ft.array[ot+1]=ut,ft.array[ot+2]=ut,ot+=3;S=0;for(x=pt.length;S<x;S++)ut=ft.value[pt[S]],ft.array[ot]=ut,ft.array[ot+1]=ut,ft.array[ot+2]=ut,ft.array[ot+3]=ut,ot+=4}}else if(ft.size===2){if(ft.boundTo===void 0||ft.boundTo==="vertices"){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=F.x,ft.array[ot+3]=F.y,ft.array[ot+4]=I.x,ft.array[ot+5]=I.y,ot+=6;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],O=ft.value[O.d],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=F.x,ft.array[ot+3]=F.y,ft.array[ot+4]=I.x,ft.array[ot+5]=I.y,ft.array[ot+6]=O.x,ft.array[ot+7]=O.y,ot+=8}else if(ft.boundTo==="faces"){S=0;for(x=C.length;S<x;S++)I=F=j=ut=ft.value[C[S]],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=F.x,ft.array[ot+3]=F.y,ft.array[ot+4]=I.x,ft.array[ot+5]=I.y,ot+=6;S=0;for(x=pt.length;S<x;S++)O=I=F=j=ut=ft.value[pt[S]],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=F.x,ft.array[ot+3]=F.y,ft.array[ot+4]=I.x,ft.array[ot+5]=I.y,ft.array[ot+6]=O.x,ft.array[ot+7]=O.y,ot+=8}}else if(ft.size===3){if(w=ft.type==="c"?["r","g","b"]:["x","y","z"],ft.boundTo===void 0||ft.boundTo==="vertices"){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],ft.array[ot]=j[w[0]],ft.array[ot+1]=j[w[1]],ft.array[ot+2]=j[w[2]],ft.array[ot+3]=F[w[0]],ft.array[ot+4]=F[w[1]],ft.array[ot+5]=F[w[2]],ft.array[ot+6]=I[w[0]],ft.array[ot+7]=I[w[1]],ft.array[ot+8]=I[w[2]],ot+=9;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],O=ft.value[O.d],ft.array[ot]=j[w[0]],ft.array[ot+1]=j[w[1]],ft.array[ot+2]=j[w[2]],ft.array[ot+3]=F[w[0]],ft.array[ot+4]=F[w[1]],ft.array[ot+5]=F[w[2]],ft.array[ot+6]=I[w[0]],ft.array[ot+7]=I[w[1]],ft.array[ot+8]=I[w[2]],ft.array[ot+9]=O[w[0]],ft.array[ot+10]=O[w[1]],ft.array[ot+11]=O[w[2]],ot+=12}else if(ft.boundTo==="faces"){S=0;for(x=C.length;S<x;S++)I=F=j=ut=ft.value[C[S]],ft.array[ot]=j[w[0]],ft.array[ot+1]=j[w[1]],ft.array[ot+2]=j[w[2]],ft.array[ot+3]=F[w[0]],ft.array[ot+4]=F[w[1]],ft.array[ot+5]=F[w[2]],ft.array[ot+6]=I[w[0]],ft.array[ot+7]=I[w[1]],ft.array[ot+8]=I[w[2]],ot+=9;S=0;for(x=pt.length;S<x;S++)O=I=F=j=ut=ft.value[pt[S]],ft.array[ot]=j[w[0]],ft.array[ot+1]=j[w[1]],ft.array[ot+2]=j[w[2]],ft.array[ot+3]=F[w[0]],ft.array[ot+4]=F[w[1]],ft.array[ot+5]=F[w[2]],ft.array[ot+6]=I[w[0]],ft.array[ot+7]=I[w[1]],ft.array[ot+8]=I[w[2]],ft.array[ot+9]=O[w[0]],ft.array[ot+10]=O[w[1]],ft.array[ot+11]=O[w[2]],ot+=12}}else if(ft.size===4)if(ft.boundTo===void 0||ft.boundTo==="vertices"){S=0;for(x=C.length;S<x;S++)O=dt[C[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=j.z,ft.array[ot+3]=j.w,ft.array[ot+4]=F.x,ft.array[ot+5]=F.y,ft.array[ot+6]=F.z,ft.array[ot+7]=F.w,ft.array[ot+8]=I.x,ft.array[ot+9]=I.y,ft.array[ot+10]=I.z,ft.array[ot+11]=I.w,ot+=12;S=0;for(x=pt.length;S<x;S++)O=dt[pt[S]],j=ft.value[O.a],F=ft.value[O.b],I=ft.value[O.c],O=ft.value[O.d],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=j.z,ft.array[ot+3]=j.w,ft.array[ot+4]=F.x,ft.array[ot+5]=F.y,ft.array[ot+6]=F.z,ft.array[ot+7]=F.w,ft.array[ot+8]=I.x,ft.array[ot+9]=I.y,ft.array[ot+10]=I.z,ft.array[ot+11]=I.w,ft.array[ot+12]=O.x,ft.array[ot+13]=O.y,ft.array[ot+14]=O.z,ft.array[ot+15]=O.w,ot+=16}else if(ft.boundTo==="faces"){S=0;for(x=C.length;S<x;S++)I=F=j=ut=ft.value[C[S]],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=j.z,ft.array[ot+3]=j.w,ft.array[ot+4]=F.x,ft.array[ot+5]=F.y,ft.array[ot+6]=F.z,ft.array[ot+7]=F.w,ft.array[ot+8]=I.x,ft.array[ot+9]=I.y,ft.array[ot+10]=I.z,ft.array[ot+11]=I.w,ot+=12;S=0;for(x=pt.length;S<x;S++)O=I=F=j=ut=ft.value[pt[S]],ft.array[ot]=j.x,ft.array[ot+1]=j.y,ft.array[ot+2]=j.z,ft.array[ot+3]=j.w,ft.array[ot+4]=F.x,ft.array[ot+5]=F.y,ft.array[ot+6]=F.z,ft.array[ot+7]=F.w,ft.array[ot+8]=I.x,ft.array[ot+9]=I.y,ft.array[ot+10]=I.z,ft.array[ot+11]=I.w,ft.array[ot+12]=O.x,ft.array[ot+13]=O.y,ft.array[ot+14]=O.z,ft.array[ot+15]=O.w,ot+=16}U.bindBuffer(U.ARRAY_BUFFER,ft.buffer),U.bufferData(U.ARRAY_BUFFER,ft.array,d)}}b&&(delete p.__inittedArrays,delete p.__colorArray,delete p.__normalArray,delete p.__tangentArray,delete p.__uvArray,delete p.__uv2Array,delete p.__faceArray,delete p.__vertexArray,delete p.__lineArray,delete p.__skinVertexAArray,delete p.__skinVertexBArray,delete p.__skinIndexArray,delete p.__skinWeightArray)}}f.__dirtyVertices=!1,f.__dirtyMorphTargets=!1,f.__dirtyElements=!1,f.__dirtyUvs=!1,f.__dirtyNormals=!1,f.__dirtyColors=!1,f.__dirtyTangents=!1,l.attributes&&g(l)}else if(N instanceof THREE.Ribbon){if(f.__dirtyVertices||f.__dirtyColors){l=f,N=U.DYNAMIC_DRAW,w=c=w=b=b=void 0,E=l.vertices,h=l.colors,S=E.length,p=h.length,x=l.__vertexArray,d=l.__colorArray,T=l.__dirtyColors;if(l.__dirtyVertices){for(b=0;b<S;b++)w=E[b].position,c=b*3,x[c]=w.x,x[c+1]=w.y,x[c+2]=w.z;U.bindBuffer(U.ARRAY_BUFFER,l.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,x,N)}if(T){for(b=0;b<p;b++)w=h[b],c=b*3,d[c]=w.r,d[c+1]=w.g,d[c+2]=w.b;U.bindBuffer(U.ARRAY_BUFFER,l.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,d,N)}}f.__dirtyVertices=!1,f.__dirtyColors=!1}else if(N instanceof THREE.Line){l=n(N,p),d=l.attributes&&m(l);if(f.__dirtyVertices||f.__dirtyColors||d){N=f,c=U.DYNAMIC_DRAW,S=h=L=E=k=void 0,E=N.vertices,p=N.colors,S=E.length,d=p.length,x=N.__vertexArray,b=N.__colorArray,T=N.__dirtyColors,w=N.__webglCustomAttributesList,Q=dt=pt=C=L=k=void 0;if(N.__dirtyVertices){for(k=0;k<S;k++)L=E[k].position,h=k*3,x[h]=L.x,x[h+1]=L.y,x[h+2]=L.z;U.bindBuffer(U.ARRAY_BUFFER,N.__webglVertexBuffer),U.bufferData(U.ARRAY_BUFFER,x,c)}if(T){for(E=0;E<d;E++)S=p[E],h=E*3,b[h]=S.r,b[h+1]=S.g,b[h+2]=S.b;U.bindBuffer(U.ARRAY_BUFFER,N.__webglColorBuffer),U.bufferData(U.ARRAY_BUFFER,b,c)}if(w){k=0;for(L=w.length;k<L;k++)if(Q=w[k],Q.needsUpdate&&(Q.boundTo===void 0||Q.boundTo==="vertices")){h=0,pt=Q.value.length;if(Q.size===1)for(C=0;C<pt;C++)Q.array[C]=Q.value[C];else if(Q.size===2)for(C=0;C<pt;C++)dt=Q.value[C],Q.array[h]=dt.x,Q.array[h+1]=dt.y,h+=2;else if(Q.size===3)if(Q.type==="c")for(C=0;C<pt;C++)dt=Q.value[C],Q.array[h]=dt.r,Q.array[h+1]=dt.g,Q.array[h+2]=dt.b,h+=3;else for(C=0;C<pt;C++)dt=Q.value[C],Q.array[h]=dt.x,Q.array[h+1]=dt.y,Q.array[h+2]=dt.z,h+=3;else if(Q.size===4)for(C=0;C<pt;C++)dt=Q.value[C],Q.array[h]=dt.x,Q.array[h+1]=dt.y,Q.array[h+2]=dt.z,Q.array[h+3]=dt.w,h+=4;U.bindBuffer(U.ARRAY_BUFFER,Q.buffer),U.bufferData(U.ARRAY_BUFFER,Q.array,c)}}}f.__dirtyVertices=!1,f.__dirtyColors=!1,l.attributes&&g(l)}else N instanceof THREE.ParticleSystem&&(l=n(N,p),d=l.attributes&&m(l),(f.__dirtyVertices||f.__dirtyColors||N.sortParticles||d)&&o(f,U.DYNAMIC_DRAW,N),f.__dirtyVertices=!1,f.__dirtyColors=!1,l.attributes&&g(l))},this.initMaterial=function(e,t,n,r){var i,s,o,u;e instanceof THREE.MeshDepthMaterial?u="depth":e instanceof THREE.MeshNormalMaterial?u="normal":e instanceof THREE.MeshBasicMaterial?u="basic":e instanceof THREE.MeshLambertMaterial?u="lambert":e instanceof THREE.MeshPhongMaterial?u="phong":e instanceof THREE.LineBasicMaterial?u="basic":e instanceof THREE.ParticleBasicMaterial&&(u="particle_basic");if(u){var a=THREE.ShaderLib[u];e.uniforms=THREE.UniformsUtils.clone(a.uniforms),e.vertexShader=a.vertexShader,e.fragmentShader=a.fragmentShader}var f,l,c;f=c=a=0;for(l=t.length;f<l;f++)o=t[f],o instanceof THREE.SpotLight&&c++,o instanceof THREE.DirectionalLight&&c++,o instanceof THREE.PointLight&&a++;a+c<=q?f=c:(f=Math.ceil(q*c/(a+c)),a=q-f),o={directional:f,point:a},a=c=0;for(f=t.length;a<f;a++)l=t[a],l instanceof THREE.SpotLight&&l.castShadow&&c++;var h=50;r!==void 0&&r instanceof THREE.SkinnedMesh&&(h=r.bones.length);var p;e:{f=e.fragmentShader,l=e.vertexShader;var a=e.uniforms,t=e.attributes,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:o.directional,maxPointLights:o.point,maxBones:h,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:c,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel},d,r=[];u?r.push(u):(r.push(f),r.push(l));for(d in n)r.push(d),r.push(n[d]);u=r.join(),d=0;for(r=z.length;d<r;d++)if(z[d].code===u){p=z[d].program;break e}d=U.createProgram(),r=[wt?"#define VERTEX_TEXTURES":"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),o=["#ifdef GL_ES","precision "+P+" float;","#endif","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",R.gammaInput?"#define GAMMA_INPUT":"",R.gammaOutput?"#define GAMMA_OUTPUT":"",R.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapSoft?"#define SHADOWMAP_WIDTH "+n.shadowMapWidth.toFixed(1):"",n.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+n.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),U.attachShader(d,C("fragment",o+f)),U.attachShader(d,C("vertex",r+l)),U.linkProgram(d),U.getProgramParameter(d,U.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+U.getProgramParameter(d,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]"),d.uniforms={},d.attributes={};var v,r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(v in a)r.push(v);v=r,r=0;for(a=v.length;r<a;r++)f=v[r],d.uniforms[f]=U.getUniformLocation(d,f);r=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(v=0;v<n.maxMorphTargets;v++)r.push("morphTarget"+v);for(p in t)r.push(p);p=r,v=0;for(t=p.length;v<t;v++)n=p[v],d.attributes[n]=U.getAttribLocation(d,n);d.id=z.length,z.push({program:d,code:u}),R.info.memory.programs=z.length,p=d}e.program=p,p=e.program.attributes,p.position>=0&&U.enableVertexAttribArray(p.position),p.color>=0&&U.enableVertexAttribArray(p.color),p.normal>=0&&U.enableVertexAttribArray(p.normal),p.tangent>=0&&U.enableVertexAttribArray(p.tangent),e.skinning&&p.skinVertexA>=0&&p.skinVertexB>=0&&p.skinIndex>=0&&p.skinWeight>=0&&(U.enableVertexAttribArray(p.skinVertexA),U.enableVertexAttribArray(p.skinVertexB),U.enableVertexAttribArray(p.skinIndex),U.enableVertexAttribArray(p.skinWeight));if(e.attributes)for(s in e.attributes)p[s]!==void 0&&p[s]>=0&&U.enableVertexAttribArray(p[s]);if(e.morphTargets)for(s=e.numSupportedMorphTargets=0;s<this.maxMorphTargets;s++)v="morphTarget"+s,p[v]>=0&&(U.enableVertexAttribArray(p[v]),e.numSupportedMorphTargets++);e.uniformsList=[];for(i in e.uniforms)e.uniformsList.push([e.uniforms[i],i])},this.setFaceCulling=function(e,t){e?(!t||t==="ccw"?U.frontFace(U.CCW):U.frontFace(U.CW),e==="back"?U.cullFace(U.BACK):e==="front"?U.cullFace(U.FRONT):U.cullFace(U.FRONT_AND_BACK),U.enable(U.CULL_FACE)):U.disable(U.CULL_FACE)}},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=n.wrapS!==void 0?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=n.wrapT!==void 0?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=n.magFilter!==void 0?n.magFilter:THREE.LinearFilter,this.minFilter=n.minFilter!==void 0?n.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=n.format!==void 0?n.format:THREE.RGBAFormat,this.type=n.type!==void 0?n.type:THREE.UnsignedByteType,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(e,t,n,r){var i=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,i),i.h=THREE.Math.clamp(i.h+t,0,1),i.s=THREE.Math.clamp(i.s+n,0,1),i.v=THREE.Math.clamp(i.v+r,0,1),e.setHSV(i.h,i.s,i.v)},rgbToHsv:function(e,t){var n=e.r,r=e.g,i=e.b,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i);if(o===s)o=n=0;else{var u=s-o,o=u/s,n=n===s?(r-i)/u:r===s?2+(i-n)/u:4+(n-r)/u;n/=6,n<0&&(n+=1),n>1&&(n-=1)}return t===void 0&&(t={h:0,s:0,v:0}),t.h=n,t.s=o,t.v=s,t}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){for(var n,r,i=e.vertices.length,s=t instanceof THREE.Mesh?t.geometry:t,o=e.vertices,u=s.vertices,a=e.faces,f=s.faces,l=e.faceVertexUvs[0],c=s.faceVertexUvs[0],h={},p=0;p<e.materials.length;p++)h[e.materials[p].id]=p;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=new THREE.Matrix4,r.extractRotation(n,t.scale));for(var p=0,d=u.length;p<d;p++){var v=new THREE.Vertex(u[p].position.clone());n&&n.multiplyVector3(v.position),o.push(v)}p=0;for(d=f.length;p<d;p++){var o=f[p],m,g,y=o.vertexNormals,b=o.vertexColors;o instanceof THREE.Face3?m=new THREE.Face3(o.a+i,o.b+i,o.c+i):o instanceof THREE.Face4&&(m=new THREE.Face4(o.a+i,o.b+i,o.c+i,o.d+i)),m.normal.copy(o.normal),r&&r.multiplyVector3(m.normal),u=0;for(v=y.length;u<v;u++)g=y[u].clone(),r&&r.multiplyVector3(g),m.vertexNormals.push(g);m.color.copy(o.color),u=0;for(v=b.length;u<v;u++)g=b[u],m.vertexColors.push(g.clone());o.materialIndex!==void 0&&(u=s.materials[o.materialIndex],v=h[u.id],v===void 0&&(v=e.materials.length,e.materials.push(u)),m.materialIndex=v),m.centroid.copy(o.centroid),n&&n.multiplyVector3(m.centroid),a.push(m)}p=0;for(d=c.length;p<d;p++){n=c[p],r=[],u=0;for(v=n.length;u<v;u++)r.push(new THREE.UV(n[u].u,n[u].v));l.push(r)}},clone:function(e){var t=new THREE.Geometry,n,r=e.vertices,i=e.faces,s=e.faceVertexUvs[0];e.materials&&(t.materials=e.materials.slice()),e=0;for(n=r.length;e<n;e++){var o=new THREE.Vertex(r[e].position.clone());t.vertices.push(o)}e=0;for(n=i.length;e<n;e++){var u=i[e],a,f,l=u.vertexNormals,c=u.vertexColors;u instanceof THREE.Face3?a=new THREE.Face3(u.a,u.b,u.c):u instanceof THREE.Face4&&(a=new THREE.Face4(u.a,u.b,u.c,u.d)),a.normal.copy(u.normal),r=0;for(o=l.length;r<o;r++)f=l[r],a.vertexNormals.push(f.clone());a.color.copy(u.color),r=0;for(o=c.length;r<o;r++)f=c[r],a.vertexColors.push(f.clone());a.materialIndex=u.materialIndex,a.centroid.copy(u.centroid),t.faces.push(a)}e=0;for(n=s.length;e<n;e++){i=s[e],a=[],r=0;for(o=i.length;r<o;r++)a.push(new THREE.UV(i[r].u,i[r].v));t.faceVertexUvs[0].push(a)}return t},randomPointInTriangle:function(e,t,n){var r,i,s,o=new THREE.Vector3,u=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),i=THREE.GeometryUtils.random(),r+i>1&&(r=1-r,i=1-i),s=1-r-i,o.copy(e),o.multiplyScalar(r),u.copy(t),u.multiplyScalar(i),o.addSelf(u),u.copy(n),u.multiplyScalar(s),o.addSelf(u),o},randomPointInFace:function(e,t,n){var r,i,s;if(e instanceof THREE.Face3)return r=t.vertices[e.a].position,i=t.vertices[e.b].position,s=t.vertices[e.c].position,THREE.GeometryUtils.randomPointInTriangle(r,i,s);if(e instanceof THREE.Face4){r=t.vertices[e.a].position,i=t.vertices[e.b].position,s=t.vertices[e.c].position;var t=t.vertices[e.d].position,o;return n?e._area1&&e._area2?(n=e._area1,o=e._area2):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t),e._area1=n,e._area2=o):(n=THREE.GeometryUtils.triangleArea(r,i,t),o=THREE.GeometryUtils.triangleArea(i,s,t)),THREE.GeometryUtils.random()*(n+o)<n?THREE.GeometryUtils.randomPointInTriangle(r,i,t):THREE.GeometryUtils.randomPointInTriangle(i,s,t)}},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h,p;for(i=0;i<u;i++)r=s[i],r instanceof THREE.Face3?(l=o[r.a].position,c=o[r.b].position,h=o[r.c].position,r._area=THREE.GeometryUtils.triangleArea(l,c,h)):r instanceof THREE.Face4&&(l=o[r.a].position,c=o[r.b].position,h=o[r.c].position,p=o[r.d].position,r._area1=THREE.GeometryUtils.triangleArea(l,c,p),r._area2=THREE.GeometryUtils.triangleArea(c,h,p),r._area=r._area1+r._area2),a+=r._area,f[i]=a;r=[],o={};for(i=0;i<t;i++)u=THREE.GeometryUtils.random()*a,u=n(u),r[i]=THREE.GeometryUtils.randomPointInFace(s[u],e,!0),o[u]?o[u]+=1:o[u]=1;return r},triangleArea:function(e,t,n){var r,i=THREE.GeometryUtils.__v1;return i.sub(e,t),r=i.length(),i.sub(e,n),e=i.length(),i.sub(t,n),n=i.length(),t=.5*(r+e+n),Math.sqrt(t*(t-r)*(t-e)*(t-n))},center:function(e){e.computeBoundingBox();var t=new THREE.Matrix4;t.setTranslation(-0.5*(e.boundingBox.x[1]+e.boundingBox.x[0]),-0.5*(e.boundingBox.y[1]+e.boundingBox.y[0]),-0.5*(e.boundingBox.z[1]+e.boundingBox.z[0])),e.applyMatrix(t),e.computeBoundingBox()}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={loadTexture:function(e,t,n){var r=new Image,i=new THREE.Texture(r,t);return r.onload=function(){i.needsUpdate=!0,n&&n(this)},r.crossOrigin="",r.src=e,i},loadTextureCube:function(e,t,n){var r,i=[],s=new THREE.Texture(i,t),t=i.loadCount=0;for(r=e.length;t<r;++t)i[t]=new Image,i[t].onload=function(){i.loadCount+=1,i.loadCount===6&&(s.needsUpdate=!0),n&&n(this)},i[t].crossOrigin="",i[t].src=e[t];return s},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=1;c<i;c++){var h=c-1<0?i-1:c-1,p=(c+1)%i,d=l-1<0?r-1:l-1,v=(l+1)%r,m=[],g=[0,0,u[(c*r+l)*4]/255*t];m.push([-1,0,u[(c*r+d)*4]/255*t]),m.push([-1,-1,u[(h*r+d)*4]/255*t]),m.push([0,-1,u[(h*r+l)*4]/255*t]),m.push([1,-1,u[(h*r+v)*4]/255*t]),m.push([1,0,u[(c*r+v)*4]/255*t]),m.push([1,1,u[(p*r+v)*4]/255*t]),m.push([0,1,u[(p*r+l)*4]/255*t]),m.push([-1,1,u[(p*r+d)*4]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=(c*r+l)*4,f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+.5)*255|0,f[g+2]=m[2]*255|0,f[g+3]=255}return o.putImageData(a,0,0),s}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var n,r,i=e.children.length;for(r=0;r<i;r++)n=e.children[r],t(n),THREE.SceneUtils.traverseHierarchy(n,t)},createMultiMaterialObject:function(e,t){var n,r=t.length,i=new THREE.Object3D;for(n=0;n<r;n++){var s=new THREE.Mesh(e,t[n]);i.add(s)}return i},cloneObject:function(e){var t;e instanceof THREE.MorphAnimMesh?(t=new THREE.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof THREE.SkinnedMesh?t=new THREE.SkinnedMesh(e.geometry,e.material):e instanceof THREE.Mesh?t=new THREE.Mesh(e.geometry,e.material):e instanceof THREE.Line?t=new THREE.Line(e.geometry,e.material,e.type):e instanceof THREE.Ribbon?t=new THREE.Ribbon(e.geometry,e.material):e instanceof THREE.ParticleSystem?(t=new THREE.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof THREE.Particle?t=new THREE.Particle(e.material):e instanceof THREE.Sprite?(t=new THREE.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof THREE.LOD?t=new THREE.LOD:e instanceof THREE.MarchingCubes?(t=new THREE.MarchingCubes(e.resolution,e.material),t.field.set(e.field),t.isolation=e.isolation):e instanceof THREE.Object3D&&(t=new THREE.Object3D),t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.doubleSided=e.doubleSided,t.flipSided=e.flipSided,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var n=0;n<e.children.length;n++){var r=THREE.SceneUtils.cloneObject(e.children[n]);t.children[n]=r,r.parent=t}if(e instanceof THREE.LOD)for(n=0;n<e.LODs.length;n++)t.LODs[n]={visibleAtDistance:e.LODs[n].visibleAtDistance,object3D:t.children[n]};return t}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1)return this.cacheArcLengths;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,a<0)o=r+1;else{if(!(a>0)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4;return e+=1e-4,t<0&&(t=0),e>1&&(e=1),t=this.getPoint(t),e=this.getPoint(e),t.clone().subSelf(e).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return this.getTangent(this.getUtoTmapping(e))},THREE.LineCurve=function(e,t){e instanceof THREE.Vector2?(this.v1=e,this.v2=t):THREE.LineCurve.oldConstructor.apply(this,arguments)},THREE.LineCurve.oldConstructor=function(e,t,n,r){this.constructor(new THREE.Vector2(e,t),new THREE.Vector2(n,r))},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;return t.sub(this.v2,this.v1),t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=new THREE.Vector2;return e.sub(this.v2,this.v1),e.normalize(),e},THREE.QuadraticBezierCurve=function(e,t,n){if(!(t instanceof THREE.Vector2))var r=Array.prototype.slice.call(arguments),e=new THREE.Vector2(r[0],r[1]),t=new THREE.Vector2(r[2],r[3]),n=new THREE.Vector2(r[4],r[5]);this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){if(!(t instanceof THREE.Vector2))var i=Array.prototype.slice.call(arguments),e=new THREE.Vector2(i[0],i[1]),t=new THREE.Vector2(i[2],i[3]),n=new THREE.Vector2(i[4],i[5]),r=new THREE.Vector2(i[6],i[7]);this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=e==void 0?[]:e},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=e==0?e:e-1,n[1]=e,n[2]=e>r.length-2?e:e+1,n[3]=e>r.length-3?e:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.ArcCurve=function(e,t,n,r,i,s){this.aX=e,this.aY=t,this.aRadius=n,this.aStartAngle=r,this.aEndAngle=i,this.aClockwise=s},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),e=this.aStartAngle+e*t,new THREE.Vector2(this.aX+this.aRadius*Math.cos(e),this.aY+this.aRadius*Math.sin(e))},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=(n-e)*.5,r=(r-t)*.5,s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=new THREE.Curve,e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=e==0?e:e-1,n[1]=e,n[2]=e>r.length-2?e:e+1,n[3]=e>r.length-3?e:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.CurvePath=function(){this.curves=[],this.bends=[]},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i;t=n=Number.NEGATIVE_INFINITY,r=i=Number.POSITIVE_INFINITY;var s,o,u,a;a=new THREE.Vector2,o=0;for(u=e.length;o<u;o++)s=e[o],s.x>t?t=s.x:s.x<r&&(r=s.x),s.y>n?n=s.y:s.y<n&&(i=s.y),a.addSelf(s.x,s.y);return{minX:r,minY:i,maxX:t,maxY:n,centroid:a.divideScalar(u)}},THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,!0))},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vertex(new THREE.Vector3(e[n].x,e[n].y,0)));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),u=t.getNormalVector(a).multiplyScalar(u),s.x=o.x+u.x,s.y=o.y+u.y;return e},THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);var t,n=e.length;for(t=1;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t))),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),this.curves.push(new THREE.SplineCurve(n)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments);this.curves.push(new THREE.ArcCurve(e,t,n,r,i,s)),this.actions.push({action:THREE.PathActions.ARC,args:o})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){var e=e||12,n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++)switch(s=this.actions[r],o=s.action,s=s.args,o){case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(o=1;o<=e;o++)v=o/e,s=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(s,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],n.length>0?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(o=1;o<=e;o++)v=o/e,s=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(s,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,o=[new THREE.Vector2(o[o.length-2],o[o.length-1])],v=e*s[0].length,o=o.concat(s[0]),s=new THREE.SplineCurve(o);for(o=1;o<=v;o++)n.push(s.getPointAt(o/v));break;case THREE.PathActions.ARC:o=this.actions[r-1].args,u=s[0],a=s[1],f=s[2],c=s[3],v=s[4],h=!!s[5],l=o[o.length-2],p=o[o.length-1],o.length==0&&(l=p=0),d=v-c;var m=e*2;for(o=1;o<=m;o++)v=o/m,h||(v=1-v),v=c+v*d,s=l+u+f*Math.cos(v),v=p+a+f*Math.sin(v),n.push(new THREE.Vector2(s,v))}return t&&n.push(n[0]),n},THREE.Path.prototype.transform=function(e,t){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(t),e)},THREE.Path.prototype.nltransform=function(e,t,n,r,i,s){var o=this.getPoints(),u,a,f,l,c;u=0;for(a=o.length;u<a;u++)f=o[u],l=f.x,c=f.y,f.x=e*l+t*c+n,f.y=r*c+i*l+s;return o},THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();e||(e=document.createElement("canvas"),e.setAttribute("width",t.maxX+100),e.setAttribute("height",t.maxY+100),document.body.appendChild(e)),t=e.getContext("2d"),t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="black",t.beginPath();var n,r,i,e=0;for(n=this.actions.length;e<n;e++)r=this.actions[e],i=r.args,r=r.action,r!=THREE.PathActions.CSPLINE_THRU&&t[r].apply(t,i);t.stroke(),t.closePath(),t.strokeStyle="red",r=this.getPoints(),e=0;for(n=r.length;e<n;e++)i=r[e],t.beginPath(),t.arc(i.x,i.y,1.5,0,Math.PI*2,!1),t.stroke(),t.closePath()},THREE.Path.prototype.toShapes=function(){var e,t,n,r,i=[],s=new THREE.Path;e=0;for(t=this.actions.length;e<t;e++)n=this.actions[e],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&s.actions.length!=0&&(i.push(s),s=new THREE.Path),s[n].apply(s,r);s.actions.length!=0&&i.push(s);if(i.length==0)return[];var o,s=[];if(THREE.Shape.Utils.isClockWise(i[0].getPoints())){e=0;for(t=i.length;e<t;e++)r=i[e],THREE.Shape.Utils.isClockWise(r.getPoints())?(o&&s.push(o),o=new THREE.Shape,o.actions=r.actions,o.curves=r.curves):o.holes.push(r);s.push(o)}else{o=new THREE.Shape,e=0;for(t=i.length;e<t;e++)r=i[e],THREE.Shape.Utils.isClockWise(r.getPoints())?(o.actions=r.actions,o.curves=r.curves,s.push(o),o=new THREE.Shape):o.holes.push(r)}return s},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n=e.concat(),r=n.concat(),i,s,o,u,a,f,l,c,h,p,d=[];for(a=0;a<t.length;a++){f=t[a],Array.prototype.push.apply(r,f),s=Number.POSITIVE_INFINITY;for(i=0;i<f.length;i++){h=f[i],p=[];for(c=0;c<n.length;c++)l=n[c],l=h.distanceToSquared(l),p.push(l),l<s&&(s=l,o=i,u=c)}i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1;var v=[f[o],n[u],n[i]];c=THREE.FontUtils.Triangulate.area(v);var m=[f[o],f[s],n[u]];h=THREE.FontUtils.Triangulate.area(m),p=u,l=o,u+=1,o+=-1,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1,v=[f[o],n[u],n[i]],v=THREE.FontUtils.Triangulate.area(v),m=[f[o],f[s],n[u]],m=THREE.FontUtils.Triangulate.area(m),c+h>v+m&&(u=p,o=l,u<0&&(u+=n.length),u%=n.length,o<0&&(o+=f.length),o%=f.length,i=u-1>=0?u-1:n.length-1,s=o-1>=0?o-1:f.length-1),c=n.slice(0,u),h=n.slice(u),p=f.slice(o),l=f.slice(0,o),s=[f[o],f[s],n[u]],d.push([f[o],n[u],n[i]]),d.push(s),n=c.concat(p).concat(l).concat(h)}return{shape:n,isolatedPts:d,allpoints:r}},triangulateShape:function(e,t){var n=THREE.Shape.Utils.removeHoles(e,t),r=n.allpoints,i=n.isolatedPts,n=THREE.FontUtils.Triangulate(n.shape,!1),s,o,u,a,f={};s=0;for(o=r.length;s<o;s++)a=r[s].x+":"+r[s].y,f[a]!==void 0&&console.log("Duplicate point",a),f[a]=s;s=0;for(o=n.length;s<o;s++){u=n[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}s=0;for(o=i.length;s<o;s++){u=i[s];for(r=0;r<3;r++)a=u[r].x+":"+u[r].y,a=f[a],a!==void 0&&(u[r]=a)}return n.concat(i)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.TextPath=function(e,t){THREE.Path.call(this),this.parameters=t||{},this.set(e)},THREE.TextPath.prototype.set=function(e,t){this.text=e;var t=t||this.parameters,n=t.curveSegments!==void 0?t.curveSegments:4,r=t.font!==void 0?t.font:"helvetiker",i=t.weight!==void 0?t.weight:"normal",s=t.style!==void 0?t.style:"normal";THREE.FontUtils.size=t.size!==void 0?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s},THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(t,e[n].toShapes());return t},THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),t!==-1&&e.splice(t,1)},add:function(e){t[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(e.initialized!==!0){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++){e.hierarchy[n].keys[r].time<0&&(e.hierarchy[n].keys[r].time=0);if(e.hierarchy[n].keys[r].rot!==void 0&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}}if(e.hierarchy[n].keys[0].morphTargets!==void 0){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[];for(n=0;n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){if(typeof e=="string")return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n,r){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=n!==void 0?n:THREE.AnimationHandler.LINEAR,this.JITCompile=r!==void 0?r:!0,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=e!==void 0?e:!0,this.currentTime=t!==void 0?t:0;var n,r=this.hierarchy.length,i;for(n=0;n<r;n++){i=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,i.animationCache===void 0&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var s=i.animationCache.prevKey;i=i.animationCache.nextKey,s.pos=this.data.hierarchy[n].keys[0],s.rot=this.data.hierarchy[n].keys[0],s.scl=this.data.hierarchy[n].keys[0],i.pos=this.getNextKeyWith("pos",n,1),i.rot=this.getNextKeyWith("rot",n,1),i.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.hierarchy.length;e++)this.hierarchy[e].animationCache!==void 0&&(this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix,delete this.hierarchy[e].animationCache)},THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t=["pos","rot","scl"],n,r,i,s,o,u,a,f,l=this.data.JIT.hierarchy,c,h;this.currentTime+=e*this.timeScale,h=this.currentTime,c=this.currentTime%=this.data.length,f=parseInt(Math.min(c*this.data.fps,this.data.length*this.data.fps),10);for(var p=0,d=this.hierarchy.length;p<d;p++)if(e=this.hierarchy[p],a=e.animationCache,this.JITCompile&&l[p][f]!==void 0)e instanceof THREE.Bone?(e.skinMatrix=l[p][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1):(e.matrix=l[p][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix);for(var v=0;v<3;v++){n=t[v],o=a.prevKey[n],u=a.nextKey[n];if(u.time<=h){if(c<h){if(!this.loop){this.stop();return}o=this.data.hierarchy[p].keys[0];for(u=this.getNextKeyWith(n,p,1);u.time<c;)o=u,u=this.getNextKeyWith(n,p,u.index+1)}else do o=u,u=this.getNextKeyWith(n,p,u.index+1);while(u.time<c);a.prevKey[n]=o,a.nextKey[n]=u}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,r=(c-o.time)/(u.time-o.time),i=o[n],s=u[n];if(r<0||r>1)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+p),r=r<0?0:1;if(n==="pos"){if(n=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR)n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r;else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)if(this.points[0]=this.getPrevKeyWith("pos",p,o.index-1).pos,this.points[1]=i,this.points[2]=s,this.points[3]=this.getNextKeyWith("pos",p,u.index+1).pos,r=r*.33+.33,i=this.interpolateCatmullRom(this.points,r),n.x=i[0],n.y=i[1],n.z=i[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)r=this.interpolateCatmullRom(this.points,r*1.01),this.target.set(r[0],r[1],r[2]),this.target.subSelf(n),this.target.y=0,this.target.normalize(),r=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,r,0)}else n==="rot"?THREE.Quaternion.slerp(i,s,e.quaternion,r):n==="scl"&&(n=e.scale,n.x=i[0]+(s[0]-i[0])*r,n.y=i[1]+(s[1]-i[1])*r,n.z=i[2]+(s[2]-i[2])*r)}}if(this.JITCompile&&l[0][f]===void 0){this.hierarchy[0].update(null,!0);for(p=0;p<this.hierarchy.length;p++)l[p][f]=this.hierarchy[p]instanceof THREE.Bone?this.hierarchy[p].skinMatrix.clone():this.hierarchy[p].matrix.clone()}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=s===0?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=(n-e)*.5,r=(r-t)*.5,(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n=n<r.length-1?n:r.length-1:n%=r.length;n<r.length;n++)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(r[n][e]!==void 0)return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.CubeCamera=function(e,t,n,r){this.heightOffset=n,this.position=new THREE.Vector3(0,n,0),this.cameraPX=new THREE.PerspectiveCamera(90,1,e,t),this.cameraNX=new THREE.PerspectiveCamera(90,1,e,t),this.cameraPY=new THREE.PerspectiveCamera(90,1,e,t),this.cameraNY=new THREE.PerspectiveCamera(90,1,e,t),this.cameraPZ=new THREE.PerspectiveCamera(90,1,e,t),this.cameraNZ=new THREE.PerspectiveCamera(90,1,e,t),this.cameraPX.position=this.position,this.cameraNX.position=this.position,this.cameraPY.position=this.position,this.cameraNY.position=this.position,this.cameraPZ.position=this.position,this.cameraNZ.position=this.position,this.cameraPX.up.set(0,-1,0),this.cameraNX.up.set(0,-1,0),this.cameraPY.up.set(0,0,1),this.cameraNY.up.set(0,0,-1),this.cameraPZ.up.set(0,-1,0),this.cameraNZ.up.set(0,-1,0),this.targetPX=new THREE.Vector3(0,0,0),this.targetNX=new THREE.Vector3(0,0,0),this.targetPY=new THREE.Vector3(0,0,0),this.targetNY=new THREE.Vector3(0,0,0),this.targetPZ=new THREE.Vector3(0,0,0),this.targetNZ=new THREE.Vector3(0,0,0),this.renderTarget=new THREE.WebGLRenderTargetCube(r,r,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updatePosition=function(e){this.position.copy(e),this.position.y+=this.heightOffset,this.targetPX.copy(this.position),this.targetNX.copy(this.position),this.targetPY.copy(this.position),this.targetNY.copy(this.position),this.targetPZ.copy(this.position),this.targetNZ.copy(this.position),this.targetPX.x+=1,this.targetNX.x-=1,this.targetPY.y+=1,this.targetNY.y-=1,this.targetPZ.z+=1,this.targetNZ.z-=1,this.cameraPX.lookAt(this.targetPX),this.cameraNX.lookAt(this.targetNX),this.cameraPY.lookAt(this.targetPY),this.cameraNY.lookAt(this.targetNY),this.cameraPZ.lookAt(this.targetPZ),this.cameraNZ.lookAt(this.targetNZ)},this.updateCubeMap=function(e,t){var n=this.renderTarget;n.activeCubeFace=0,e.render(t,this.cameraPX,n),n.activeCubeFace=1,e.render(t,this.cameraNX,n),n.activeCubeFace=2,e.render(t,this.cameraPY,n),n.activeCubeFace=3,e.render(t,this.cameraNY,n),n.activeCubeFace=4,e.render(t,this.cameraPZ,n),n.activeCubeFace=5,e.render(t,this.cameraNZ,n)}},THREE.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")},THREE.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")},THREE.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")},THREE.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")},THREE.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")},THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=new THREE.Camera,THREE.CombinedCamera.prototype.constructor=THREE.CoolCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=Math.tan(this.fov/2)*((this.cameraP.near+this.cameraP.far)/2),t=2*e*this.cameraP.aspect/2;e/=this.zoom,t/=this.zoom,this.cameraO.left=-t,this.cameraO.right=t,this.cameraO.top=e,this.cameraO.bottom=-e,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.setLens=function(e,t){t||(t=43.25);var n=2*Math.atan(t/(e*2));return n*=180/Math.PI,this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=t!==void 0?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){e.preventDefault(),e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){if(this.heightSpeed){var n=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*n*this.heightCoef}else this.autoSpeedFactor=0;t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),n=e*this.lookSpeed,this.activeLook||(n=0),this.lon+=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,e=this.target,t=this.object.position,e.x=t.x+100*Math.sin(this.phi)*Math.cos(this.theta),e.y=t.y+100*Math.cos(this.phi),e.z=t.z+100*Math.sin(this.phi)*Math.sin(this.theta)}e=1,this.constrainVertical&&(e=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),e=this.target,t=this.object.position,e.x=t.x+100*Math.sin(this.phi)*Math.cos(this.theta),e.y=t.y+100*Math.cos(this.phi),e.z=t.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(e)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",n(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",n(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",n(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",n(this,this.onKeyUp),!1)},THREE.PathControls=function(e,t){function n(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}function r(e,t){return function(){t.apply(e,arguments)}}function i(e,t,n,r){var i={name:n,fps:.6,length:r,hierarchy:[]},s,o=t.getControlPointsArray(),u=t.getLength(),a=o.length,f=0;s=a-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:o[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[s]={time:r,pos:o[s],rot:[0,0,0,1],scl:[1,1,1]};for(s=1;s<a-1;s++)f=r*u.chunks[s]/u.total,t.keys[s]={time:f,pos:o[s]};return i.hierarchy[0]=t,THREE.AnimationHandler.add(i),new THREE.Animation(e,n,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function s(e,t){var n,r,i=new THREE.Geometry;for(n=0;n<e.points.length*t;n++)r=n/(e.points.length*t),r=e.getPoint(r),i.vertices[n]=new THREE.Vertex(new THREE.Vector3(r.x,r.y,r.z));return i}this.object=e,this.domElement=t!==void 0?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var o=Math.PI*2,u=Math.PI/180;this.update=function(e){var t;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*u,this.theta=this.lon*u,e=this.phi%o,this.phi=e>=0?e:e+o,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var r=e[1]-e[0];this.phi=n((t-e[0])/r)*r+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),r=e[1]-e[0],this.theta=n((t-e[0])/r)*r+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.CubeGeometry(10,10,20),o=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(n,e),e=new THREE.Mesh(o,t),e.position.set(0,10,0),this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,o=s(t,10),n=s(t,10),u=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),o=new THREE.Line(o,u),n=new THREE.ParticleSystem(n,new THREE.ParticleBasicMaterial({color:16755200,size:3}));o.scale.set(1,1,1),e.add(o),n.scale.set(1,1,1),e.add(n);for(var o=new THREE.SphereGeometry(1,16,8),u=new THREE.MeshBasicMaterial({color:65280}),a=0;a<t.points.length;a++)n=new THREE.Mesh(o,u),n.position.copy(t.points[a]),e.add(n)}this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1)}},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=t!==void 0?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){e.preventDefault(),e.stopPropagation();if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed;e*=this.rollSpeed,this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",n(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",n(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",n(this,this.mouseup),!1),this.domElement.addEventListener("keydown",n(this,this.keydown),!1),this.domElement.addEventListener("keyup",n(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(e,t){this.object=e,this.domElement=t!==void 0?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-0.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Matrix4,o=!1,u=1,a=0,f=0,l=0,c=0,h=0,p=window.innerWidth/2,d=window.innerHeight/2;this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*c),this.rotateVertically(t*h)}t=e*this.movementSpeed,this.object.translateZ(-t*(a>0||this.autoForward&&!(a<0)?1:a)),this.object.translateX(t*f),this.object.translateY(t*l),o&&(this.roll+=this.rollSpeed*e*u),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),i.copy(this.forward),r.set(0,1,0),n.cross(r,i).normalize(),r.cross(i,n).normalize(),this.object.matrix.n11=n.x,this.object.matrix.n12=r.x,this.object.matrix.n13=i.x,this.object.matrix.n21=n.y,this.object.matrix.n22=r.y,this.object.matrix.n23=i.y,this.object.matrix.n31=n.z,this.object.matrix.n32=r.z,this.object.matrix.n33=i.z,s.identity(),s.n11=Math.cos(this.roll),s.n12=-Math.sin(this.roll),s.n21=Math.sin(this.roll),s.n22=Math.cos(this.roll),this.object.matrix.multiplySelf(s),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.n14=this.object.position.x,this.object.matrix.n24=this.object.position.y,this.object.matrix.n34=this.object.position.z},this.translateX=function(e){this.object.position.x+=this.object.matrix.n11*e,this.object.position.y+=this.object.matrix.n21*e,this.object.position.z+=this.object.matrix.n31*e},this.translateY=function(e){this.object.position.x+=this.object.matrix.n12*e,this.object.position.y+=this.object.matrix.n22*e,this.object.position.z+=this.object.matrix.n32*e},this.translateZ=function(e){this.object.position.x-=this.object.matrix.n13*e,this.object.position.y-=this.object.matrix.n23*e,this.object.position.z-=this.object.matrix.n33*e},this.rotateHorizontally=function(e){n.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31),n.multiplyScalar(e),this.forward.subSelf(n),this.forward.normalize()},this.rotateVertically=function(e){r.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32),r.multiplyScalar(e),this.forward.addSelf(r),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){c=(e.clientX-p)/window.innerWidth,h=(e.clientY-d)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=1;break;case 2:a=-1}},!1),this.domElement.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation();switch(e.button){case 0:a=0;break;case 2:a=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:a=1;break;case 37:case 65:f=-1;break;case 40:case 83:a=-1;break;case 39:case 68:f=1;break;case 81:o=!0,u=1;break;case 69:o=!0,u=-1;break;case 82:l=1;break;case 70:l=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:a=0;break;case 37:case 65:f=0;break;case 40:case 83:a=0;break;case 39:case 68:f=0;break;case 81:o=!1;break;case 69:o=!1;break;case 82:l=0;break;case 70:l=0}},!1)},THREE.TrackballControls=function(e,t){var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=e,this.domElement=t!==void 0?t:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.target=new THREE.Vector3(0,0,0);var i=!1,s=r.NONE,o=new THREE.Vector3,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2;this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-n.screen.offsetLeft)/n.radius*.5,(t-n.screen.offsetTop)/n.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-n.screen.width*.5-n.screen.offsetLeft)/n.radius,(n.screen.height*.5+n.screen.offsetTop-t)/n.radius,0),i=r.length();return i>1?r.normalize():r.z=Math.sqrt(1-i*i),o.copy(n.object.position).subSelf(n.target),i=n.object.up.clone().setLength(r.y),i.addSelf(n.object.up.clone().crossSelf(o).setLength(r.x)),i.addSelf(o.setLength(r.z)),i},this.rotateCamera=function(){var e=Math.acos(u.dot(a)/u.length()/a.length());if(e){var t=(new THREE.Vector3).cross(u,a).normalize(),r=new THREE.Quaternion;e*=n.rotateSpeed,r.setFromAxisAngle(t,-e),r.multiplyVector3(o),r.multiplyVector3(n.object.up),r.multiplyVector3(a),n.staticMoving?u=a:(r.setFromAxisAngle(t,e*(n.dynamicDampingFactor-1)),r.multiplyVector3(u))}},this.zoomCamera=function(){var e=1+(l.y-f.y)*n.zoomSpeed;e!==1&&e>0&&(o.multiplyScalar(e),n.staticMoving?f=l:f.y+=(l.y-f.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=h.clone().subSelf(c);if(e.lengthSq()){e.multiplyScalar(o.length()*n.panSpeed);var t=o.clone().crossSelf(n.object.up).setLength(e.x);t.addSelf(n.object.up.clone().setLength(e.y)),n.object.position.addSelf(t),n.target.addSelf(t),n.staticMoving?c=h:c.addSelf(e.sub(h,c).multiplyScalar(n.dynamicDampingFactor))}},this.checkDistances=function(){if(!n.noZoom||!n.noPan)n.object.position.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.setLength(n.maxDistance),o.lengthSq()<n.minDistance*n.minDistance&&n.object.position.add(n.target,o.setLength(n.minDistance))},this.update=function(){o.copy(n.object.position).subSelf(this.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.add(n.target,o),n.checkDistances(),n.object.lookAt(n.target)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){n.enabled&&(i&&(u=a=n.getMouseProjectionOnBall(e.clientX,e.clientY),f=l=n.getMouseOnScreen(e.clientX,e.clientY),c=h=n.getMouseOnScreen(e.clientX,e.clientY),i=!1),s!==r.NONE&&(s===r.ROTATE&&!n.noRotate?a=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?l=n.getMouseOnScreen(e.clientX,e.clientY):s===r.PAN&&!n.noPan&&(h=n.getMouseOnScreen(e.clientX,e.clientY))))},!1),this.domElement.addEventListener("mousedown",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),s===r.NONE)&&(s=e.button,s===r.ROTATE&&!n.noRotate?u=a=n.getMouseProjectionOnBall(e.clientX,e.clientY):s===r.ZOOM&&!n.noZoom?f=l=n.getMouseOnScreen(e.clientX,e.clientY):this.noPan||(c=h=n.getMouseOnScreen(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mouseup",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),s=r.NONE)},!1),window.addEventListener("keydown",function(e){n.enabled&&s===r.NONE&&(e.keyCode===n.keys[r.ROTATE]&&!n.noRotate?s=r.ROTATE:e.keyCode===n.keys[r.ZOOM]&&!n.noZoom?s=r.ZOOM:e.keyCode===n.keys[r.PAN]&&!n.noPan&&(s=r.PAN),s!==r.NONE&&(i=!0))},!1),window.addEventListener("keyup",function(){n.enabled&&s!==r.NONE&&(s=r.NONE)},!1)},THREE.CubeGeometry=function(e,t,n,r,i,s,o,u){function a(e,t,n,o,u,a,l,c){var h,p=r||1,d=i||1,v=u/2,m=a/2,g=f.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")h="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x")h="y",d=s||1;else if(e==="z"&&t==="y"||e==="y"&&t==="z")h="x",p=s||1;var y=p+1,b=d+1,w=u/p,E=a/d,S=new THREE.Vector3;S[h]=l>0?1:-1;for(u=0;u<b;u++)for(a=0;a<y;a++){var x=new THREE.Vector3;x[e]=(a*w-v)*n,x[t]=(u*E-m)*o,x[h]=l,f.vertices.push(new THREE.Vertex(x))}for(u=0;u<d;u++)for(a=0;a<p;a++)e=new THREE.Face4(a+y*u+g,a+y*(u+1)+g,a+1+y*(u+1)+g,a+1+y*u+g),e.normal.copy(S),e.vertexNormals.push(S.clone(),S.clone(),S.clone(),S.clone()),e.materialIndex=c,f.faces.push(e),f.faceVertexUvs[0].push([new THREE.UV(a/p,u/d),new THREE.UV(a/p,(u+1)/d),new THREE.UV((a+1)/p,(u+1)/d),new THREE.UV((a+1)/p,u/d)])}THREE.Geometry.call(this);var f=this,l=e/2,c=t/2,h=n/2,p,d,v,m,g,y;if(o!==void 0){if(o instanceof Array)this.materials=o;else{this.materials=[];for(p=0;p<6;p++)this.materials.push(o)}p=0,m=1,d=2,g=3,v=4,y=5}else this.materials=[];this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(u!=void 0)for(var b in u)this.sides[b]!=void 0&&(this.sides[b]=u[b]);this.sides.px&&a("z","y",-1,-1,n,t,l,p),this.sides.nx&&a("z","y",1,-1,n,t,-l,m),this.sides.py&&a("x","z",1,1,e,n,c,d),this.sides.ny&&a("x","z",1,-1,e,n,-c,g),this.sides.pz&&a("x","y",1,-1,e,t,h,v),this.sides.nz&&a("x","y",-1,-1,e,t,-h,y),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this);var e=e!=null?e:20,t=t!=null?t:20,n=n||100,o=n/2,r=r||8,i=i||1,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r;this.vertices.push(new THREE.Vertex(new THREE.Vector3(d*Math.sin(v*Math.PI*2),-p*n+o,d*Math.cos(v*Math.PI*2)))),c.push(this.vertices.length-1),h.push(new THREE.UV(v,p))}f.push(c),l.push(h)}for(a=0;a<i;a++)for(u=0;u<r;u++){var n=f[a][u],c=f[a+1][u],h=f[a+1][u+1],p=f[a][u+1],d=this.vertices[n].position.clone().setY(0).normalize(),v=this.vertices[c].position.clone().setY(0).normalize(),m=this.vertices[h].position.clone().setY(0).normalize(),g=this.vertices[p].position.clone().setY(0).normalize(),y=l[a][u].clone(),b=l[a+1][u].clone(),w=l[a+1][u+1].clone(),E=l[a][u+1].clone();this.faces.push(new THREE.Face4(n,c,h,p,[d,v,m,g])),this.faceVertexUvs[0].push([y,b,w,E])}if(!s&&e>0){this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,o,0)));for(u=0;u<r;u++)n=f[0][u],c=f[0][u+1],h=this.vertices.length-1,d=new THREE.Vector3(0,1,0),v=new THREE.Vector3(0,1,0),m=new THREE.Vector3(0,1,0),y=l[0][u].clone(),b=l[0][u+1].clone(),w=new THREE.UV(b.u,0),this.faces.push(new THREE.Face3(n,c,h,[d,v,m])),this.faceVertexUvs[0].push([y,b,w])}if(!s&&t>0){this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,-o,0)));for(u=0;u<r;u++)n=f[a][u+1],c=f[a][u],h=this.vertices.length-1,d=new THREE.Vector3(0,-1,0),v=new THREE.Vector3(0,-1,0),m=new THREE.Vector3(0,-1,0),y=l[a][u+1].clone(),b=l[a][u].clone(),w=new THREE.UV(b.u,1),this.faces.push(new THREE.Face3(n,c,h,[d,v,m])),this.faceVertexUvs[0].push([y,b,w])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){if(typeof e!="undefined"){THREE.Geometry.call(this);var e=e instanceof Array?e:[e],n,r=e.length,i;this.shapebb=e[r-1].getBoundingBox();for(n=0;n<r;n++)i=e[n],this.addShape(i,t);this.computeCentroids(),this.computeFaceNormals()}},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).addSelf(e)}function r(e,t,n){var r=THREE.ExtrudeGeometry.__v1,i=THREE.ExtrudeGeometry.__v2,s=THREE.ExtrudeGeometry.__v3,o=THREE.ExtrudeGeometry.__v4,u=THREE.ExtrudeGeometry.__v5,a=THREE.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),i.set(e.x-n.x,e.y-n.y),r=r.normalize(),i=i.normalize(),s.set(-r.y,r.x),o.set(i.y,-i.x),u.copy(e).addSelf(s),a.copy(e).addSelf(o),u.equals(a)?o.clone():(u.copy(t).addSelf(s),a.copy(n).addSelf(o),s=r.dot(o),o=a.subSelf(u).dot(o),s===0&&(console.log("Either infinite or no solutions!"),o===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),o/=s,o<0?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(n.y-e.y,n.x-e.x),t>e&&(e+=Math.PI*2),e=(t+e)/2,new THREE.Vector2(-Math.cos(e),-Math.sin(e))):r.multiplyScalar(o).addSelf(u).subSelf(e).clone())}function i(e){for(k=e.length;--k>=0;){I=k,q=k-1,q<0&&(q=e.length-1);for(var t=0,n=p+l*2,t=0;t<n;t++){var r=D*t,i=D*(t+1),s=R+I+r,o=R+I+i,f=s,r=R+q+r,i=R+q+i,c=o;f+=C,r+=C,i+=C,c+=C,N.faces.push(new THREE.Face4(f,r,i,c,null,null,w)),w&&(f=t/n,r=(t+1)/n,i=u+a*2,s=(N.vertices[s].position.z+a)/i,o=(N.vertices[o].position.z+a)/i,N.faceVertexUvs[0].push([new THREE.UV(s,f),new THREE.UV(o,f),new THREE.UV(o,r),new THREE.UV(s,r)]))}}}function s(e,t,n){N.vertices.push(new THREE.Vertex(new THREE.Vector3(e,t,n)))}function o(e,t,n){e+=C,t+=C,n+=C,N.faces.push(new THREE.Face3(e,t,n,null,null,b));if(b){var r=E.maxY,i=E.maxX,s=N.vertices[t].position.x,t=N.vertices[t].position.y,o=N.vertices[n].position.x,n=N.vertices[n].position.y;N.faceVertexUvs[0].push([new THREE.UV(N.vertices[e].position.x/i,N.vertices[e].position.y/r),new THREE.UV(s/i,t/r),new THREE.UV(o/i,n/r)])}}var u=t.amount!==void 0?t.amount:100,a=t.bevelThickness!==void 0?t.bevelThickness:6,f=t.bevelSize!==void 0?t.bevelSize:a-2,l=t.bevelSegments!==void 0?t.bevelSegments:3,c=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.curveSegments!==void 0?t.curveSegments:12,p=t.steps!==void 0?t.steps:1,d=t.bendPath,v=t.extrudePath,m,g=!1,y=t.useSpacedPoints!==void 0?t.useSpacedPoints:!1,b=t.material,w=t.extrudeMaterial,E=this.shapebb;v&&(m=v.getPoints(h),p=m.length,g=!0,c=!1),c||(f=a=l=0);var S,x,T,N=this,C=this.vertices.length;d&&e.addWrapPath(d),h=y?e.extractAllSpacedPoints(h):e.extractAllPoints(h),d=h.shape,h=h.holes;if(v=!THREE.Shape.Utils.isClockWise(d)){d=d.reverse(),x=0;for(T=h.length;x<T;x++)S=h[x],THREE.Shape.Utils.isClockWise(S)&&(h[x]=S.reverse());v=!1}v=THREE.Shape.Utils.triangulateShape(d,h),y=d,x=0;for(T=h.length;x<T;x++)S=h[x],d=d.concat(S);var k,L,A,O,M,_,D=d.length,P=v.length,H=[];k=0,L=y.length,I=L-1;for(q=k+1;k<L;k++,I++,q++)I===L&&(I=0),q===L&&(q=0),H[k]=r(y[k],y[I],y[q]);var B=[],j,F=H.concat();x=0;for(T=h.length;x<T;x++){S=h[x],j=[],k=0,L=S.length,I=L-1;for(q=k+1;k<L;k++,I++,q++)I===L&&(I=0),q===L&&(q=0),j[k]=r(S[k],S[I],S[q]);B.push(j),F=F.concat(j)}for(A=0;A<l;A++){O=A/l,M=a*(1-O),O=f*Math.sin(O*Math.PI/2),k=0;for(L=y.length;k<L;k++)_=n(y[k],H[k],O),s(_.x,_.y,-M);x=0;for(T=h.length;x<T;x++){S=h[x],j=B[x],k=0;for(L=S.length;k<L;k++)_=n(S[k],j[k],O),s(_.x,_.y,-M)}}O=f;for(k=0;k<D;k++)_=c?n(d[k],F[k],O):d[k],g?s(_.x,_.y+m[0].y,m[0].x):s(_.x,_.y,0);for(A=1;A<=p;A++)for(k=0;k<D;k++)_=c?n(d[k],F[k],O):d[k],g?s(_.x,_.y+m[A-1].y,m[A-1].x):s(_.x,_.y,u/p*A);for(A=l-1;A>=0;A--){O=A/l,M=a*(1-O),O=f*Math.sin(O*Math.PI/2),k=0;for(L=y.length;k<L;k++)_=n(y[k],H[k],O),s(_.x,_.y,u+M);x=0;for(T=h.length;x<T;x++){S=h[x],j=B[x],k=0;for(L=S.length;k<L;k++)_=n(S[k],j[k],O),g?s(_.x,_.y+m[p-1].y,m[p-1].x+M):s(_.x,_.y,u+M)}}if(c){c=D*0;for(k=0;k<P;k++)f=v[k],o(f[2]+c,f[1]+c,f[0]+c);c=D*(p+l*2);for(k=0;k<P;k++)f=v[k],o(f[0]+c,f[1]+c,f[2]+c)}else{for(k=0;k<P;k++)f=v[k],o(f[2],f[1],f[0]);for(k=0;k<P;k++)f=v[k],o(f[0]+D*p,f[1]+D*p,f[2]+D*p)}var I,q,R=0;i(y),R+=y.length,x=0;for(T=h.length;x<T;x++)S=h[x],i(S),R+=S.length},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.IcosahedronGeometry=function(e){function t(e,t,n){var r=Math.sqrt(e*e+t*t+n*n);return i.vertices.push(new THREE.Vertex(new THREE.Vector3(e/r,t/r,n/r)))-1}function n(e,t,n,r){var s=i.vertices[e].position,o=i.vertices[t].position,u=i.vertices[n].position,e=new THREE.Face3(e,t,n);e.vertexNormals.push(s.clone().normalize(),o.clone().normalize(),u.clone().normalize()),r.faces.push(e),r.faceVertexUvs[0].push([new THREE.UV(1-(Math.atan2(s.z,s.x)+Math.PI)%Math.PI/Math.PI*.5,.5-s.y/2),new THREE.UV(1-(Math.atan2(o.z,o.x)+Math.PI)%Math.PI/Math.PI*.5,.5-o.y/2),new THREE.UV(1-(Math.atan2(u.z,u.x)+Math.PI)%Math.PI/Math.PI*.5,.5-u.y/2)])}function r(e,n){var r=i.vertices[e].position,s=i.vertices[n].position;return t((r.x+s.x)/2,(r.y+s.y)/2,(r.z+s.z)/2)}var i=this,s=new THREE.Geometry;this.subdivisions=e||0,THREE.Geometry.call(this),e=(1+Math.sqrt(5))/2,t(-1,e,0),t(1,e,0),t(-1,-e,0),t(1,-e,0),t(0,-1,e),t(0,1,e),t(0,-1,-e),t(0,1,-e),t(e,0,-1),t(e,0,1),t(-e,0,-1),t(-e,0,1),n(0,11,5,s),n(0,5,1,s),n(0,1,7,s),n(0,7,10,s),n(0,10,11,s),n(1,5,9,s),n(5,11,4,s),n(11,10,2,s),n(10,7,6,s),n(7,1,8,s),n(3,9,4,s),n(3,4,2,s),n(3,2,6,s),n(3,6,8,s),n(3,8,9,s),n(4,9,5,s),n(2,4,11,s),n(6,2,10,s),n(8,6,7,s),n(9,8,1,s);for(var o=0;o<this.subdivisions;o++){var e=new THREE.Geometry,u;for(u in s.faces){var a=r(s.faces[u].a,s.faces[u].b),f=r(s.faces[u].b,s.faces[u].c),l=r(s.faces[u].c,s.faces[u].a);n(s.faces[u].a,a,l,e),n(s.faces[u].b,f,a,e),n(s.faces[u].c,l,f,e),n(a,f,l,e)}s.faces=e.faces,s.faceVertexUvs[0]=e.faceVertexUvs[0]}i.faces=s.faces,i.faceVertexUvs[0]=s.faceVertexUvs[0],this.computeCentroids(),this.computeFaceNormals()},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.LatheGeometry=function(e,t,n){THREE.Geometry.call(this),this.steps=t||12,this.angle=n||2*Math.PI;for(var t=this.angle/this.steps,n=[],r=[],i=[],s=[],o=(new THREE.Matrix4).setRotationZ(t),u=0;u<e.length;u++)this.vertices.push(new THREE.Vertex(e[u])),n[u]=e[u].clone(),r[u]=this.vertices.length-1;for(var a=0;a<=this.angle+.001;a+=t){for(u=0;u<n.length;u++)a<this.angle?(n[u]=o.multiplyVector3(n[u].clone()),this.vertices.push(new THREE.Vertex(n[u])),i[u]=this.vertices.length-1):i=s;a==0&&(s=r);for(u=0;u<r.length-1;u++)this.faces.push(new THREE.Face4(i[u],i[u+1],r[u+1],r[u])),this.faceVertexUvs[0].push([new THREE.UV(1-a/this.angle,u/e.length),new THREE.UV(1-a/this.angle,(u+1)/e.length),new THREE.UV(1-(a-t)/this.angle,(u+1)/e.length),new THREE.UV(1-(a-t)/this.angle,u/e.length)]);r=i,i=[]}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.OctahedronGeometry=function(e,t){function n(t){var n=t.clone().normalize(),n=new THREE.Vertex(n.clone().multiplyScalar(e));return n.index=o.vertices.push(n)-1,n.uv=new THREE.UV(Math.atan2(t.z,-t.x)/2/Math.PI+.5,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5),n}function r(e,t,n,u){u<1?(u=new THREE.Face3(e.index,t.index,n.index,[e.position,t.position,n.position]),u.centroid.addSelf(e.position).addSelf(t.position).addSelf(n.position).divideScalar(3),u.normal=u.centroid.clone().normalize(),o.faces.push(u),u=Math.atan2(u.centroid.z,-u.centroid.x),o.faceVertexUvs[0].push([s(e.uv,e.position,u),s(t.uv,t.position,u),s(n.uv,n.position,u)])):(u-=1,r(e,i(e,t),i(e,n),u),r(i(e,t),t,i(t,n),u),r(i(e,n),i(t,n),n,u),r(i(e,t),i(t,n),i(e,n),u))}function i(e,t){u[e.index]||(u[e.index]=[]),u[t.index]||(u[t.index]=[]);var r=u[e.index][t.index];return r===void 0&&(u[e.index][t.index]=u[t.index][e.index]=r=n((new THREE.Vector3).add(e.position,t.position).divideScalar(2))),r}function s(e,t,n){return n<0&&e.u===1&&(e=new THREE.UV(e.u-1,e.v)),t.x===0&&t.z===0&&(e=new THREE.UV(n/2/Math.PI+.5,e.v)),e}THREE.Geometry.call(this);var t=t||0,o=this;n(new THREE.Vector3(1,0,0)),n(new THREE.Vector3(-1,0,0)),n(new THREE.Vector3(0,1,0)),n(new THREE.Vector3(0,-1,0)),n(new THREE.Vector3(0,0,1)),n(new THREE.Vector3(0,0,-1));var u=[],a=this.vertices;r(a[0],a[2],a[4],t),r(a[0],a[4],a[3],t),r(a[0],a[3],a[5],t),r(a[0],a[5],a[2],t),r(a[1],a[2],a[5],t),r(a[1],a[5],a[3],t),r(a[1],a[3],a[4],t),r(a[1],a[4],a[2],t),this.boundingSphere={radius:e}},THREE.OctahedronGeometry.prototype=new THREE.Geometry,THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this);for(var i=e/2,s=t/2,n=n||1,r=r||1,o=n+1,u=r+1,a=e/n,f=t/r,l=new THREE.Vector3(0,0,1),e=0;e<u;e++)for(t=0;t<o;t++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(t*a-i,-(e*f-s),0)));for(e=0;e<r;e++)for(t=0;t<n;t++)i=new THREE.Face4(t+o*e,t+o*(e+1),t+1+o*(e+1),t+1+o*e),i.normal.copy(l),i.vertexNormals.push(l.clone(),l.clone(),l.clone(),l.clone()),this.faces.push(i),this.faceVertexUvs[0].push([new THREE.UV(t/n,e/r),new THREE.UV(t/n,(e+1)/r),new THREE.UV((t+1)/n,(e+1)/r),new THREE.UV((t+1)/n,e/r)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this);var e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=r!=void 0?r:0,i=i!=void 0?i:Math.PI*2,s=s!=void 0?s:0,o=o!=void 0?o:Math.PI,u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[],h=[];for(u=0;u<=t;u++){var p=u/t,d=a/n;this.vertices.push(new THREE.Vertex(new THREE.Vector3(-e*Math.cos(r+p*i)*Math.sin(s+d*o),e*Math.cos(s+d*o),e*Math.sin(r+p*i)*Math.sin(s+d*o)))),c.push(this.vertices.length-1),h.push(new THREE.UV(p,d))}f.push(c),l.push(h)}for(a=0;a<n;a++)for(u=0;u<t;u++){var r=f[a][u+1],i=f[a][u],s=f[a+1][u],o=f[a+1][u+1],c=this.vertices[r].position.clone().normalize(),h=this.vertices[i].position.clone().normalize(),p=this.vertices[s].position.clone().normalize(),d=this.vertices[o].position.clone().normalize(),v=l[a][u+1].clone(),m=l[a][u].clone(),g=l[a+1][u].clone(),y=l[a+1][u+1].clone();Math.abs(this.vertices[r].position.y)==e?(this.faces.push(new THREE.Face3(r,s,o,[c,p,d])),this.faceVertexUvs[0].push([v,g,y])):Math.abs(this.vertices[s].position.y)==e?(this.faces.push(new THREE.Face3(r,i,s,[c,h,p])),this.faceVertexUvs[0].push([v,m,g])):(this.faces.push(new THREE.Face4(r,i,s,o,[c,h,p,d])),this.faceVertexUvs[0].push([v,m,g,y]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){var n=(new THREE.TextPath(e,t)).toShapes();t.amount=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1);if(t.bend){var r=n[n.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(r/2,120),new THREE.Vector2(r,0))}THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,r=0,i=String(e).split(""),s=i.length,o=[],e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u);r+=u.offset,o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o){t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length;for(e=0;e<f;)switch(a=t[e++],a){case"m":a=t[e++]*n+r,l=t[e++]*n,s.push(new THREE.Vector2(a,l)),i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,s.push(new THREE.Vector2(a,l)),i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++){var y=o/u,b=THREE.Shape.Utils.b2(y,c,p,a),y=THREE.Shape.Utils.b2(y,h,d,l);s.push(new THREE.Vector2(b,y))}}break;case"b":if(a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m),o=s[s.length-1]){c=o.x,h=o.y,o=1;for(u=this.divisions;o<=u;o++)y=o/u,b=THREE.Shape.Utils.b3(y,c,p,v,a),y=THREE.Shape.Utils.b3(y,h,d,m,l),s.push(new THREE.Vector2(b,y))}}}return{offset:g.ha*n,points:s,path:i}}}},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5};return e.Triangulate=function(e,n){var r=e.length;if(r<3)return null;var i=[],s=[],o=[],u,a,f;if(t(e)>0)for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;r>2;){if(l--<=0)return console.log("Warning, unable to triangulate polygon!"),n?o:i;u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var h;e:{h=e;var p=u,d=a,v=f,m=r,g=s,y=void 0,b=void 0,w=void 0,E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,b=h[g[p]].x,w=h[g[p]].y,E=h[g[d]].x,S=h[g[d]].y,x=h[g[v]].x,T=h[g[v]].y;if(1e-10>(E-b)*(T-w)-(S-w)*(x-b))h=!1;else{for(y=0;y<m;y++)if(y!=p&&y!=d&&y!=v){var N=h[g[y]].x,C=h[g[y]].y,k=void 0,L=void 0,A=void 0,O=void 0,M=void 0,_=void 0,D=void 0,P=void 0,H=void 0,B=void 0,j=void 0,F=void 0,k=A=M=void 0,k=x-E,L=T-S,A=b-x,O=w-T,M=E-b,_=S-w,D=N-b,P=C-w,H=N-E,B=C-S,j=N-x,F=C-T,k=k*B-L*H,M=M*P-_*D,A=A*F-O*j;if(k>=0&&A>=0&&M>=0){h=!1;break e}}h=!0}}if(h){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=n||8,this.segmentsT=r||6,this.arc=i||Math.PI*2,i=new THREE.Vector3,e=[],t=[];for(n=0;n<=this.segmentsR;n++)for(r=0;r<=this.segmentsT;r++){var s=r/this.segmentsT*this.arc,o=n/this.segmentsR*Math.PI*2;i.x=this.radius*Math.cos(s),i.y=this.radius*Math.sin(s);var u=new THREE.Vector3;u.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),u.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),u.z=this.tube*Math.sin(o),this.vertices.push(new THREE.Vertex(u)),e.push(new THREE.UV(r/this.segmentsT,1-n/this.segmentsR)),t.push(u.clone().subSelf(i).normalize())}for(n=1;n<=this.segmentsR;n++)for(r=1;r<=this.segmentsT;r++){var i=(this.segmentsT+1)*n+r-1,s=(this.segmentsT+1)*(n-1)+r-1,o=(this.segmentsT+1)*(n-1)+r,u=(this.segmentsT+1)*n+r,a=new THREE.Face4(i,s,o,u,[t[i],t[s],t[o],t[u]]);a.normal.addSelf(t[i]),a.normal.addSelf(t[s]),a.normal.addSelf(t[o]),a.normal.addSelf(t[u]),a.normal.normalize(),this.faces.push(a),this.faceVertexUvs[0].push([e[i].clone(),e[s].clone(),e[o].clone(),e[u].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i,s){return t=n/r*e,n=Math.cos(t),new THREE.Vector3(i*(2+n)*.5*Math.cos(e),i*(2+n)*Math.sin(e)*.5,s*i*Math.sin(t)*.5)}THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=n||64,this.segmentsT=r||8,this.p=i||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.segmentsR),n=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3;for(e=0;e<this.segmentsR;++e){this.grid[e]=Array(this.segmentsT);for(t=0;t<this.segmentsT;++t){var a=e/this.segmentsR*2*this.p*Math.PI,o=t/this.segmentsT*2*Math.PI,i=u(a,o,this.q,this.p,this.radius,this.heightScale),a=u(a+.01,o,this.q,this.p,this.radius,this.heightScale);n.x=a.x-i.x,n.y=a.y-i.y,n.z=a.z-i.z,r.x=a.x+i.x,r.y=a.y+i.y,r.z=a.z+i.z,s.cross(n,r),r.cross(s,n),s.normalize(),r.normalize(),a=-this.tube*Math.cos(o),o=this.tube*Math.sin(o),i.x+=a*r.x+o*s.x,i.y+=a*r.y+o*s.y,i.z+=a*r.z+o*s.z,this.grid[e][t]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(i.x,i.y,i.z)))-1}}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var r=(e+1)%this.segmentsR,s=(t+1)%this.segmentsT,i=this.grid[e][t],n=this.grid[r][t],r=this.grid[r][s],s=this.grid[e][s],o=new THREE.UV(e/this.segmentsR,t/this.segmentsT),a=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),f=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),l=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(i,n,r,s)),this.faceVertexUvs[0].push([o,a,f,l])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.SubdivisionModifier=function(e){this.subdivisions=e===void 0?1:e,this.useOldVertexColors=!1,this.supportUVs=!0},THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier,THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)},THREE.SubdivisionModifier.prototype.smooth=function(e){function t(e,t,n,r,u,a){var f=new THREE.Face4(e,t,n,r,null,u.color,u.material);if(o.useOldVertexColors){f.vertexColors=[];for(var l,c,p,d=0;d<4;d++){p=a[d],l=new THREE.Color,l.setRGB(0,0,0);for(var v=0;v<p.length;v++)c=u.vertexColors[p[v]-1],l.r+=c.r,l.g+=c.g,l.b+=c.b;l.r/=p.length,l.g/=p.length,l.b/=p.length,f.vertexColors[d]=l}}i.push(f),(!o.supportUVs||h.length!=0)&&s.push([h[e],h[t],h[n],h[r]])}function n(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}var r=[],i=[],s=[],o=this,u=e.vertices,r=e.faces,a=u.concat(),f=[],l={},c={},h=[],p,d,v,m,g,y=e.faceVertexUvs[0];p=0;for(d=y.length;p<d;p++){v=0;for(m=y[p].length;v<m;v++)g=r[p]["abcd".charAt(v)],h[g]||(h[g]=y[p][v])}var b;p=0;for(d=r.length;p<d;p++)if(g=r[p],f.push(g.centroid),a.push(new THREE.Vertex(g.centroid)),o.supportUVs&&h.length!=0)b=new THREE.UV,g instanceof THREE.Face3?(b.u=h[g.a].u+h[g.b].u+h[g.c].u,b.v=h[g.a].v+h[g.b].v+h[g.c].v,b.u/=3,b.v/=3):g instanceof THREE.Face4&&(b.u=h[g.a].u+h[g.b].u+h[g.c].u+h[g.d].u,b.v=h[g.a].v+h[g.b].v+h[g.c].v+h[g.d].v,b.u/=4,b.v/=4),h.push(b);d=function(e){function t(e,t,n){e[t]===void 0&&(e[t]=[]),e[t].push(n)}var r,i,s,o,u={};r=0;for(i=e.faces.length;r<i;r++)s=e.faces[r],s instanceof THREE.Face3?(o=n(s.a,s.b),t(u,o,r),o=n(s.b,s.c),t(u,o,r),o=n(s.c,s.a),t(u,o,r)):s instanceof THREE.Face4&&(o=n(s.a,s.b),t(u,o,r),o=n(s.b,s.c),t(u,o,r),o=n(s.c,s.d),t(u,o,r),o=n(s.d,s.a),t(u,o,r));return u}(e);var w=0,y=u.length,E,S,x={},T={},N=function(e,t){x[e]===void 0&&(x[e]=[]),x[e].push(t)},C=function(e,t){T[e]===void 0&&(T[e]={}),T[e][t]=null};for(p in d){b=d[p],E=p.split("_"),S=E[0],E=E[1],N(S,[S,E]),N(E,[S,E]),v=0;for(m=b.length;v<m;v++)g=b[v],C(S,g,p),C(E,g,p);b.length<2&&(c[p]=!0)}for(p in d)if(b=d[p],g=b[0],b=b[1],E=p.split("_"),S=E[0],E=E[1],m=new THREE.Vector3,c[p]?(m.addSelf(u[S].position),m.addSelf(u[E].position),m.multiplyScalar(.5)):(m.addSelf(f[g]),m.addSelf(f[b]),m.addSelf(u[S].position),m.addSelf(u[E].position),m.multiplyScalar(.25)),l[p]=y+r.length+w,a.push(new THREE.Vertex(m)),w++,o.supportUVs&&h.length!=0)b=new THREE.UV,b.u=h[S].u+h[E].u,b.v=h[S].v+h[E].v,b.u/=2,b.v/=2,h.push(b);var k,L;E=["123","12","2","23"],m=["123","23","3","31"];var N=["123","31","1","12"],C=["1234","12","2","23"],A=["1234","23","3","34"],O=["1234","34","4","41"],M=["1234","41","1","12"];p=0;for(d=f.length;p<d;p++)g=r[p],b=y+p,g instanceof THREE.Face3?(w=n(g.a,g.b),S=n(g.b,g.c),k=n(g.c,g.a),t(b,l[w],g.b,l[S],g,E),t(b,l[S],g.c,l[k],g,m),t(b,l[k],g.a,l[w],g,N)):g instanceof THREE.Face4?(w=n(g.a,g.b),S=n(g.b,g.c),k=n(g.c,g.d),L=n(g.d,g.a),t(b,l[w],g.b,l[S],g,C),t(b,l[S],g.c,l[k],g,A),t(b,l[k],g.d,l[L],g,O),t(b,l[L],g.a,l[w],g,M)):console.log("face should be a face!",g);r=a,a=new THREE.Vector3,l=new THREE.Vector3,p=0;for(d=u.length;p<d;p++)if(x[p]!==void 0){a.set(0,0,0),l.set(0,0,0),g=new THREE.Vector3(0,0,0),b=0;for(v in T[p])a.addSelf(f[v]),b++;w=0,y=x[p].length;for(v=0;v<y;v++)c[n(x[p][v][0],x[p][v][1])]&&w++;if(w!=2){a.divideScalar(b);for(v=0;v<y;v++)b=x[p][v],b=u[b[0]].position.clone().addSelf(u[b[1]].position).divideScalar(2),l.addSelf(b);l.divideScalar(y),g.addSelf(u[p].position),g.multiplyScalar(y-3),g.addSelf(a),g.addSelf(l.multiplyScalar(2)),g.divideScalar(y),r[p].position=g}}e.vertices=r,e.faces=i,e.faceVertexUvs[0]=s,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlbase:function(e){return e=e.split("/"),e.pop(),e.length<1?"":e.join("/")+"/"},initMaterials:function(e,t,n){e.materials=[];for(var r=0;r<t.length;++r)e.materials[r]=THREE.Loader.prototype.createMaterial(t[r],n)},hasNormals:function(e){var t,n,r=e.materials.length;for(n=0;n<r;n++)if(t=e.materials[n],t instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e,t){var r=new Image;r.onload=function(){if(!n(this.width)||!n(this.height)){var t=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),r=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}else e.image=this;e.needsUpdate=!0},r.src=t}function i(e,n,i,s,o,u){var a=document.createElement("canvas");e[n]=new THREE.Texture(a),e[n].sourceFile=i,s&&(e[n].repeat.set(s[0],s[1]),s[0]!=1&&(e[n].wrapS=THREE.RepeatWrapping),s[1]!=1&&(e[n].wrapT=THREE.RepeatWrapping)),o&&e[n].offset.set(o[0],o[1]),u&&(s={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},s[u[0]]!==void 0&&(e[n].wrapS=s[u[0]]),s[u[1]]!==void 0&&(e[n].wrapT=s[u[1]])),r(e[n],t+"/"+i)}function s(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var o,u,a;u="MeshLambertMaterial",o={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe},e.shading&&(e.shading=="Phong"?u="MeshPhongMaterial":e.shading=="Basic"&&(u="MeshBasicMaterial")),e.blending&&(e.blending=="Additive"?o.blending=THREE.AdditiveBlending:e.blending=="Subtractive"?o.blending=THREE.SubtractiveBlending:e.blending=="Multiply"&&(o.blending=THREE.MultiplyBlending));if(e.transparent!==void 0||e.opacity<1)o.transparent=e.transparent;e.depthTest!==void 0&&(o.depthTest=e.depthTest),e.vertexColors!==void 0&&(e.vertexColors=="face"?o.vertexColors=THREE.FaceColors:e.vertexColors&&(o.vertexColors=THREE.VertexColors)),e.colorDiffuse?o.color=s(e.colorDiffuse):e.DbgColor&&(o.color=e.DbgColor),e.colorSpecular&&(o.specular=s(e.colorSpecular)),e.colorAmbient&&(o.ambient=s(e.colorAmbient)),e.transparency&&(o.opacity=e.transparency),e.specularCoef&&(o.shininess=e.specularCoef),e.mapDiffuse&&t&&i(o,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap),e.mapLight&&t&&i(o,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap),e.mapNormal&&t&&i(o,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap),e.mapSpecular&&t&&i(o,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap);if(e.mapNormal){var f=THREE.ShaderUtils.lib.normal,l=THREE.UniformsUtils.clone(f.uniforms),c=o.color;u=o.specular,a=o.ambient;var h=o.shininess;l.tNormal.texture=o.normalMap,e.mapNormalFactor&&(l.uNormalScale.value=e.mapNormalFactor),o.map&&(l.tDiffuse.texture=o.map,l.enableDiffuse.value=!0),o.specularMap&&(l.tSpecular.texture=o.specularMap,l.enableSpecular.value=!0),o.lightMap&&(l.tAO.texture=o.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(c),l.uSpecularColor.value.setHex(u),l.uAmbientColor.value.setHex(a),l.uShininess.value=h,o.opacity&&(l.uOpacity.value=o.opacity),o=new THREE.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:l,lights:!0,fog:!0})}else o=new THREE[u](o);return o}},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype,THREE.BinaryLoader.prototype.load=function(e,t,n,r){e instanceof Object&&(console.warn("DEPRECATED: BinaryLoader( parameters ) is now BinaryLoader( url, callback, texturePath, binaryPath )."),r=e,e=r.model,t=r.callback,n=r.texture_path,r=r.bin_path);var n=n?n:this.extractUrlbase(e),r=r?r:this.extractUrlbase(e),i=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,n,r,i)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,n,r,i,s){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200||o.status==0)try{var u=JSON.parse(o.responseText);u.metadata===void 0||u.metadata.formatVersion===void 0||u.metadata.formatVersion!==3?console.error("Deprecated file format."):e.loadAjaxBuffers(u,n,i,r,s)}catch(l){console.error(l),console.warn("DEPRECATED: ["+t+"] seems to be using old model format")}else console.error("Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,n,r,i){var s=new XMLHttpRequest,o=n+"/"+e.buffers,u=0;s.onreadystatechange=function(){s.readyState==4?s.status==200||s.status==0?THREE.BinaryLoader.prototype.createBinModel(s.response,t,r,e.materials):console.error("Couldn't load ["+o+"] ["+s.status+"]"):s.readyState==3?i&&(u==0&&(u=s.getResponseHeader("Content-Length")),i({total:u,loaded:s.responseText.length})):s.readyState==2&&(u=s.getResponseHeader("Content-Length"))},s.open("GET",o,!0),s.responseType="arraybuffer",s.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,n,r){var i=function(t){function n(e){return e%4?4-e%4:0}function i(e,t){return(new Uint8Array(e,t,1))[0]}function s(e,t){return(new Uint32Array(e,t,1))[0]}function o(t,n){var r,i,s,o,u,f,l,c,h=new Uint32Array(e,n,3*t);for(r=0;r<t;r++){i=h[r*3],s=h[r*3+1],o=h[r*3+2],u=y[i*2],i=y[i*2+1],f=y[s*2],l=y[s*2+1],s=y[o*2],c=y[o*2+1],o=p.faceVertexUvs[0];var d=[];d.push(new THREE.UV(u,i)),d.push(new THREE.UV(f,l)),d.push(new THREE.UV(s,c)),o.push(d)}}function u(t,n){var r,i,s,o,u,f,l,c,h,d,v=new Uint32Array(e,n,4*t);for(r=0;r<t;r++){i=v[r*4],s=v[r*4+1],o=v[r*4+2],u=v[r*4+3],f=y[i*2],i=y[i*2+1],l=y[s*2],h=y[s*2+1],c=y[o*2],d=y[o*2+1],o=y[u*2],s=y[u*2+1],u=p.faceVertexUvs[0];var m=[];m.push(new THREE.UV(f,i)),m.push(new THREE.UV(l,h)),m.push(new THREE.UV(c,d)),m.push(new THREE.UV(o,s)),u.push(m)}}function f(t,n,r){for(var i,s,o,u,n=new Uint32Array(e,n,3*t),f=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*3],s=n[r*3+1],o=n[r*3+2],u=f[r],p.faces.push(new THREE.Face3(i,s,o,null,null,u))}function l(t,n,r){for(var i,s,o,u,f,n=new Uint32Array(e,n,4*t),l=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[r*4],s=n[r*4+1],o=n[r*4+2],u=n[r*4+3],f=l[r],p.faces.push(new THREE.Face4(i,s,o,u,null,null,f))}function c(t,n,r,i){for(var s,o,u,f,l,c,h,n=new Uint32Array(e,n,3*t),r=new Uint32Array(e,r,3*t),d=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*3],o=n[i*3+1],u=n[i*3+2],l=r[i*3],c=r[i*3+1],h=r[i*3+2],f=d[i];var v=g[c*3],m=g[c*3+1];c=g[c*3+2];var y=g[h*3],b=g[h*3+1];h=g[h*3+2],p.faces.push(new THREE.Face3(s,o,u,[new THREE.Vector3(g[l*3],g[l*3+1],g[l*3+2]),new THREE.Vector3(v,m,c),new THREE.Vector3(y,b,h)],null,f))}}function h(t,n,r,i){for(var s,o,u,f,l,c,h,d,v,n=new Uint32Array(e,n,4*t),r=new Uint32Array(e,r,4*t),m=new Uint16Array(e,i,t),i=0;i<t;i++){s=n[i*4],o=n[i*4+1],u=n[i*4+2],f=n[i*4+3],c=r[i*4],h=r[i*4+1],d=r[i*4+2],v=r[i*4+3],l=m[i];var y=g[h*3],b=g[h*3+1];h=g[h*3+2];var w=g[d*3],E=g[d*3+1];d=g[d*3+2];var S=g[v*3],x=g[v*3+1];v=g[v*3+2],p.faces.push(new THREE.Face4(s,o,u,f,[new THREE.Vector3(g[c*3],g[c*3+1],g[c*3+2]),new THREE.Vector3(y,b,h),new THREE.Vector3(w,E,d),new THREE.Vector3(S,x,v)],null,l))}}var p=this,v=0,m,g=[],y=[],b,w,E,S,x,T;THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(p,r,t),m={signature:function(e,t,n){for(var e=new Uint8Array(e,t,n),r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r}(e,v,12),header_bytes:i(e,v+12),vertex_coordinate_bytes:i(e,v+13),normal_coordinate_bytes:i(e,v+14),uv_coordinate_bytes:i(e,v+15),vertex_index_bytes:i(e,v+16),normal_index_bytes:i(e,v+17),uv_index_bytes:i(e,v+18),material_index_bytes:i(e,v+19),nvertices:s(e,v+20),nnormals:s(e,v+20+4),nuvs:s(e,v+20+8),ntri_flat:s(e,v+20+12),ntri_smooth:s(e,v+20+16),ntri_flat_uv:s(e,v+20+20),ntri_smooth_uv:s(e,v+20+24),nquad_flat:s(e,v+20+28),nquad_smooth:s(e,v+20+32),nquad_flat_uv:s(e,v+20+36),nquad_smooth_uv:s(e,v+20+40)},m.signature!=="Three.js 003"&&console.warn("DEPRECATED: binary model seems to be using old format"),v+=m.header_bytes,t=m.vertex_index_bytes*3+m.material_index_bytes,T=m.vertex_index_bytes*4+m.material_index_bytes,b=m.ntri_flat*t,w=m.ntri_smooth*(t+m.normal_index_bytes*3),E=m.ntri_flat_uv*(t+m.uv_index_bytes*3),S=m.ntri_smooth_uv*(t+m.normal_index_bytes*3+m.uv_index_bytes*3),x=m.nquad_flat*T,t=m.nquad_smooth*(T+m.normal_index_bytes*4),T=m.nquad_flat_uv*(T+m.uv_index_bytes*4),v+=function(t){var n=m.nvertices,t=new Float32Array(e,t,n*3),r,i,s,o;for(r=0;r<n;r++)i=t[r*3],s=t[r*3+1],o=t[r*3+2],p.vertices.push(new THREE.Vertex(new THREE.Vector3(i,s,o)));return n*3*Float32Array.BYTES_PER_ELEMENT}(v),v+=function(t){var n=m.nnormals;if(n){var t=new Int8Array(e,t,n*3),r,i,s,o;for(r=0;r<n;r++)i=t[r*3],s=t[r*3+1],o=t[r*3+2],g.push(i/127,s/127,o/127)}return n*3*Int8Array.BYTES_PER_ELEMENT}(v),v+=n(m.nnormals*3),v+=function(t){var n=m.nuvs;if(n){var t=new Float32Array(e,t,n*2),r,i,s;for(r=0;r<n;r++)i=t[r*2],s=t[r*2+1],y.push(i,s)}return n*2*Float32Array.BYTES_PER_ELEMENT}(v),b=v+b+n(m.ntri_flat*2),w=b+w+n(m.ntri_smooth*2),E=w+E+n(m.ntri_flat_uv*2),S=E+S+n(m.ntri_smooth_uv*2),x=S+x+n(m.nquad_flat*2),t=x+t+n(m.nquad_smooth*2),T=t+T+n(m.nquad_flat_uv*2),function(e){var t=m.ntri_flat_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3;f(t,e,n+t*Uint32Array.BYTES_PER_ELEMENT*3),o(t,n)}}(w),function(e){var t=m.ntri_smooth_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3,r=n+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,n,r+t*Uint32Array.BYTES_PER_ELEMENT*3),o(t,r)}}(E),function(e){var t=m.nquad_flat_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4;l(t,e,n+t*Uint32Array.BYTES_PER_ELEMENT*4),u(t,n)}}(t),function(e){var t=m.nquad_smooth_uv;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4,r=n+t*Uint32Array.BYTES_PER_ELEMENT*4;h(t,e,n,r+t*Uint32Array.BYTES_PER_ELEMENT*4),u(t,r)}}(T),function(e){var t=m.ntri_flat;t&&f(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*3)}(v),function(e){var t=m.ntri_smooth;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,n,n+t*Uint32Array.BYTES_PER_ELEMENT*3)}}(b),function(e){var t=m.nquad_flat;t&&l(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*4)}(S),function(e){var t=m.nquad_smooth;if(t){var n=e+t*Uint32Array.BYTES_PER_ELEMENT*4;h(t,e,n,n+t*Uint32Array.BYTES_PER_ELEMENT*4)}}(x),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};i.prototype=new THREE.Geometry,i.prototype.constructor=i,t(new i(n))},THREE.ColladaLoader=function(){function e(e,r,i){U=e,r=r||X,i!==void 0&&(e=i.split("/"),e.pop(),et=e.length<1?"":e.join("/")+"/"),$=t("//dae:library_images/dae:image",o,"image"),G=t("//dae:library_materials/dae:material",T,"material"),Y=t("//dae:library_effects/dae:effect",A,"effect"),Q=t("//dae:library_geometries/dae:geometry",m,"geometry"),K=t("//dae:library_controllers/dae:controller",u,"controller"),J=t("//dae:library_animations/dae:animation",M,"animation"),Z=t(".//dae:library_visual_scenes/dae:visual_scene",l,"visual_scene"),tt=[],nt=[],(e=U.evaluate(".//dae:scene/dae:instance_visual_scene",U,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(e=e.getAttribute("url").replace(/^#/,""),W=Z[e]):W=null,z=new THREE.Object3D;for(e=0;e<W.nodes.length;e++)z.add(s(W.nodes[e]));n();for(var a in J);return a={scene:z,morphs:tt,skins:nt,dae:{images:$,materials:G,effects:Y,geometries:Q,controllers:K,animations:J,visualScenes:Z,scene:W}},r&&r(a),a}function t(e,t,n){for(var e=U.evaluate(e,U,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r={},i=e.iterateNext(),s=0;i;)i=(new t).parse(i),i.id.length==0&&(i.id=n+s++),r[i.id]=i,i=e.iterateNext();return r}function n(){var e=1e6,t=-e,n=0,r;for(r in J)for(var i=J[r],s=0;s<i.sampler.length;s++){var o=i.sampler[s];o.create(),e=Math.min(e,o.startTime),t=Math.max(t,o.endTime),n=Math.max(n,o.input.length)}return{start:e,end:t,frames:n}}function r(e,t,n,i){e.world=e.world||new THREE.Matrix4,e.world.copy(e.matrix);if(e.channels&&e.channels.length){var s=e.channels[0].sampler.output[n];s instanceof THREE.Matrix4&&e.world.copy(s)}i&&e.world.multiply(i,e.world),t.push(e);for(i=0;i<e.nodes.length;i++)r(e.nodes[i],t,n,e.world)}function i(e,t,i){var s=K[t.url];if(!s||!s.skin)console.log("ColladaLoader: Could not find skin controller.");else if(!t.skeleton||!t.skeleton.length)console.log("ColladaLoader: Could not find the skeleton for the skin. ");else{var o=n(),t=W.getChildById(t.skeleton[0],!0)||W.getChildBySid(t.skeleton[0],!0),u,a,f,l,c=new THREE.Vector3,h;for(u=0;u<e.vertices.length;u++)s.skin.bindShapeMatrix.multiplyVector3(e.vertices[u].position);for(i=0;i<o.frames;i++){var p=[],d=[];for(u=0;u<e.vertices.length;u++)d.push(new THREE.Vertex(new THREE.Vector3));r(t,p,i),u=p,a=s.skin;for(l=0;l<u.length;l++)if(f=u[l],h=-1,f.type=="JOINT"){for(var v=0;v<a.joints.length;v++)if(f.sid==a.joints[v]){h=v;break}if(!(h>=0))throw"ColladaLoader: Could not find joint '"+f.sid+"'.";v=a.invBindMatrices[h],f.invBindMatrix=v,f.skinningMatrix=new THREE.Matrix4,f.skinningMatrix.multiply(f.world,v),f.weights=[];for(v=0;v<a.weights.length;v++)for(var m=0;m<a.weights[v].length;m++){var g=a.weights[v][m];g.joint==h&&f.weights.push(g)}}for(u=0;u<p.length;u++)if(p[u].type=="JOINT")for(a=0;a<p[u].weights.length;a++)f=p[u].weights[a],l=f.index,f=f.weight,h=e.vertices[l],l=d[l],c.x=h.position.x,c.y=h.position.y,c.z=h.position.z,p[u].skinningMatrix.multiplyVector3(c),l.position.x+=c.x*f,l.position.y+=c.y*f,l.position.z+=c.z*f;e.morphTargets.push({name:"target_"+i,vertices:d})}}}function s(e){var t=new THREE.Object3D,n,r,o,u;for(o=0;o<e.controllers.length;o++){var a=K[e.controllers[o].url];switch(a.type){case"skin":if(Q[a.skin.source]){var f=new v;f.url=a.skin.source,f.instance_material=e.controllers[o].instance_material,e.geometries.push(f),n=e.controllers[o]}else K[a.skin.source]&&(r=a=K[a.skin.source],a.morph&&Q[a.morph.source])&&(f=new v,f.url=a.morph.source,f.instance_material=e.controllers[o].instance_material,e.geometries.push(f));break;case"morph":Q[a.morph.source]&&(f=new v,f.url=a.morph.source,f.instance_material=e.controllers[o].instance_material,e.geometries.push(f),r=e.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}for(o=0;o<e.geometries.length;o++){var a=e.geometries[o],f=a.instance_material,a=Q[a.url],l={},c=0,h;if(a&&a.mesh&&a.mesh.primitives){t.name.length==0&&(t.name=a.id);if(f)for(u=0;u<f.length;u++){h=f[u];var d=Y[G[h.target].instance_effect.url].shader;d.material.opacity=d.material.opacity?d.material.opacity:1,h=l[h.symbol]=d.material,c++}f=h||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading}),a=a.mesh.geometry3js;if(c>1){f=new THREE.MeshFaceMaterial;for(u=0;u<a.faces.length;u++)c=a.faces[u],c.materials=[l[c.daeMaterial]]}if(n!==void 0)i(a,n),f.morphTargets=!0,f=new THREE.SkinnedMesh(a,f),f.skeleton=n.skeleton,f.skinController=K[n.url],f.skinInstanceController=n,f.name="skin_"+nt.length,nt.push(f);else if(r!==void 0){u=a,l=r instanceof p?K[r.url]:r;if(!l||!l.morph)console.log("could not find morph controller!");else{l=l.morph;for(c=0;c<l.targets.length;c++)if(d=Q[l.targets[c]],d.mesh&&d.mesh.primitives&&d.mesh.primitives.length)d=d.mesh.primitives[0].geometry,d.vertices.length===u.vertices.length&&u.morphTargets.push({name:"target_1",vertices:d.vertices});u.morphTargets.push({name:"target_Z",vertices:u.vertices})}f.morphTargets=!0,f=new THREE.Mesh(a,f),f.name="morph_"+tt.length,tt.push(f)}else f=new THREE.Mesh(a,f);e.geometries.length>1?t.add(f):t=f}}t.name=e.id||"",e.matrix.decompose(t.position,t.rotation,t.scale);for(o=0;o<e.nodes.length;o++)t.add(s(e.nodes[o],e));return t}function o(){this.init_from=this.id=""}function u(){this.type=this.name=this.id="",this.morph=this.skin=null}function a(){this.weights=this.targets=this.source=this.method=null}function f(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function l(){this.name=this.id="",this.nodes=[],this.scene=new THREE.Object3D}function c(){this.sid=this.name=this.id="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function h(){this.type=this.sid="",this.data=[],this.matrix=new THREE.Matrix4}function p(){this.url="",this.skeleton=[],this.instance_material=[]}function d(){this.target=this.symbol=""}function v(){this.url="",this.instance_material=[]}function m(){this.id="",this.mesh=null}function g(e){this.geometry=e.id,this.primitives=[],this.geometry3js=this.vertices=null}function y(){}function b(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function w(){this.source="",this.stride=this.count=0,this.params=[]}function E(){this.input={}}function S(){this.semantic="",this.offset=0,this.source="",this.set=0}function x(e){this.id=e,this.type=null}function T(){this.name=this.id="",this.instance_effect=null}function N(){this.color=new THREE.Color(0),this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texcoord=this.texture=null}function C(e,t){this.type=e,this.effect=t,this.material=null}function k(e){this.effect=e,this.format=this.init_from=null}function L(e){this.effect=e,this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function A(){this.name=this.id="",this.sampler=this.surface=this.shader=null}function O(){this.url=""}function M(){this.name=this.id="",this.source={},this.sampler=[],this.channel=[]}function _(e){this.animation=e,this.target=this.source="",this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function D(e){this.id="",this.animation=e,this.inputs=[],this.endTime=this.startTime=this.interpolation=this.output=this.input=null,this.duration=0}function P(e){var t=e.getAttribute("id");return V[t]!=void 0?V[t]:(V[t]=(new x(t)).parse(e),V[t])}function H(e){return e=="dae"?"http://www.collada.org/2005/11/COLLADASchema":null}function B(e){for(var e=F(e),t=[],n=0;n<e.length;n++)t.push(parseFloat(e[n]));return t}function j(e){for(var e=F(e),t=[],n=0;n<e.length;n++)t.push(parseInt(e[n],10));return t}function F(e){return e.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/)}function I(e,t,n){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):n}function q(e,t){if(e===void 0){for(var n="0.";n.length<t+2;)n+="0";return n}t=t||2,n=e.toString().split(".");for(n[1]=n.length>1?n[1].substr(0,t):"0";n[1].length<t;)n[1]+="0";return n.join(".")}function R(e,t){var n="";return n+=q(e.x,t)+",",n+=q(e.y,t)+",",n+=q(e.z,t),n}var U=null,z=null,W,X=null,V={},$={},J={},K={},Q={},G={},Y={},Z,et,tt,nt,rt=THREE.SmoothShading;return o.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.nodeName=="init_from"&&(this.init_from=n.textContent)}return this},u.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"skin":this.skin=(new f).parse(n),this.type=n.nodeName;break;case"morph":this.morph=(new a).parse(n),this.type=n.nodeName}}return this},a.prototype.parse=function(e){var t={},n=[],r;this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,"");for(r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(i.nodeType==1)switch(i.nodeName){case"source":i=(new x).parse(i),t[i.id]=i;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(r=0;r<n.length;r++)switch(e=n[r],i=t[e.source],e.semantic){case"MORPH_TARGET":this.targets=i.read();break;case"MORPH_WEIGHT":this.weights=i.read()}return this},a.prototype.parseInputs=function(e){for(var t=[],n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType==1)switch(r.nodeName){case"input":t.push((new S).parse(r))}}return t},f.prototype.parse=function(e){var t={},n,r;this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(s.nodeType==1)switch(s.nodeName){case"bind_shape_matrix":s=B(s.textContent),this.bindShapeMatrix=new THREE.Matrix4,this.bindShapeMatrix.set(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15]);break;case"source":s=(new x).parse(s),t[s.id]=s;break;case"joints":n=s;break;case"vertex_weights":r=s;break;default:console.log(s.nodeName)}}return this.parseJoints(n,t),this.parseWeights(r,t),this},f.prototype.parseJoints=function(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType==1)switch(r.nodeName){case"input":var r=(new S).parse(r),i=t[r.source];r.semantic=="JOINT"?this.joints=i.read():r.semantic=="INV_BIND_MATRIX"&&(this.invBindMatrices=i.read())}}},f.prototype.parseWeights=function(e,t){for(var n,r,i=[],s=0;s<e.childNodes.length;s++){var o=e.childNodes[s];if(o.nodeType==1)switch(o.nodeName){case"input":i.push((new S).parse(o));break;case"v":n=j(o.textContent);break;case"vcount":r=j(o.textContent)}}for(s=o=0;s<r.length;s++){for(var u=r[s],a=[],f=0;f<u;f++){for(var l={},c=0;c<i.length;c++){var h=i[c],p=n[o+h.offset];switch(h.semantic){case"JOINT":l.joint=p;break;case"WEIGHT":l.weight=t[h.source].data[p]}}a.push(l),o+=i.length}for(f=0;f<a.length;f++)a[f].index=s;this.weights.push(a)}},l.prototype.getChildById=function(e,t){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(e,t);if(r)return r}return null},l.prototype.getChildBySid=function(e,t){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(e,t);if(r)return r}return null},l.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"node":this.nodes.push((new c).parse(n))}}return this},c.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t],r=n.target.split("/");r.shift();var i=r.shift(),s=i.indexOf(".")>=0,o=i.indexOf("(")>=0,u;if(s)r=i.split("."),i=r.shift(),r.shift();else if(o){u=i.split("("),i=u.shift();for(r=0;r<u.length;r++)u[r]=parseInt(u[r].replace(/\)/,""))}if(i==e)return n.info={sid:i,dotSyntax:s,arrSyntax:o,arrIndices:u},n}return null},c.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(e,t);if(r)return r}return null},c.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(e,t);if(r)return r}return null},c.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},c.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.type=this.type=="JOINT"?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var n=0;n<e.childNodes.length;n++)if(t=e.childNodes[n],t.nodeType==1)switch(t.nodeName){case"node":this.nodes.push((new c).parse(t));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new p).parse(t));break;case"instance_geometry":this.geometries.push((new v).parse(t));break;case"instance_light":break;case"instance_node":t=t.getAttribute("url").replace(/^#/,""),(t=U.evaluate(".//dae:library_nodes//dae:node[@id='"+t+"']",U,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new c).parse(t));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new h).parse(t));break;case"extra":break;default:console.log(t.nodeName)}e=[],n=1e6,t=-1e6;for(var r in J)for(var i=J[r],s=0;s<i.channel.length;s++){var o=i.channel[s],u=i.sampler[s];r=o.target.split("/")[0],r==this.id&&(u.create(),o.sampler=u,n=Math.min(n,u.startTime),t=Math.max(t,u.endTime),e.push(o))}e.length&&(this.startTime=n,this.endTime=t);if((this.channels=e)&&this.channels.length){r=1e7;for(e=0;e<this.channels.length;e++){n=this.channels[e].sampler;for(t=0;t<n.input.length-1;t++)r=Math.min(r,n.input[t+1]-n.input[t])}n=[];for(e=this.startTime;e<this.endTime;e+=r){t=e;for(var i={},a=s=void 0,s=0;s<this.channels.length;s++)a=this.channels[s],i[a.sid]=a;o=new THREE.Matrix4;for(s=0;s<this.transforms.length;s++)if(u=this.transforms[s],a=i[u.sid],a!==void 0){for(var f=a.sampler,l,a=0;a<f.input.length-1;a++)if(f.input[a+1]>t){l=f.output[a];break}o=l!==void 0?l instanceof THREE.Matrix4?o.multiply(o,l):o.multiply(o,u.matrix):o.multiply(o,u.matrix)}else o=o.multiply(o,u.matrix);t=o,n.push({time:e,pos:[t.n14,t.n24,t.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=n}return this.updateMatrix(),this},c.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.matrix.multiply(this.matrix,this.transforms[e].matrix)},h.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=B(e.textContent),this.updateMatrix(),this},h.prototype.updateMatrix=function(){var e=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":e=this.data[3]*(Math.PI/180),this.matrix.setRotationAxis(new THREE.Vector3(this.data[0],this.data[1],this.data[2]),e);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix},p.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"skeleton":this.skeleton.push(n.textContent.replace(/^#/,""));break;case"bind_material":if(n=U.evaluate(".//dae:instance_material",n,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null))for(var r=n.iterateNext();r;)this.instance_material.push((new d).parse(r)),r=n.iterateNext()}}return this},d.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},v.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1&&n.nodeName=="bind_material"){if(e=U.evaluate(".//dae:instance_material",n,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null))for(t=e.iterateNext();t;)this.instance_material.push((new d).parse(t)),t=e.iterateNext();break}}return this},m.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"mesh":this.mesh=(new g(this)).parse(n)}}return this},g.prototype.parse=function(e){function t(e,t){var n=R(e.position);return i[n]===void 0&&(i[n]={v:e,index:t}),i[n]}this.primitives=[];var n;for(n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"source":P(r);break;case"vertices":this.vertices=(new E).parse(r);break;case"triangles":this.primitives.push((new b).parse(r));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new y).parse(r))}}var i={};this.geometry3js=new THREE.Geometry,r=V[this.vertices.input.POSITION.source].data;for(e=n=0;n<r.length;n+=3,e++){var s=new THREE.Vertex(new THREE.Vector3(r[n],r[n+1],r[n+2]));t(s,e),this.geometry3js.vertices.push(s)}for(n=0;n<this.primitives.length;n++)e=this.primitives[n],e.setVertices(this.vertices),this.handlePrimitive(e,this.geometry3js,i);return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.computeVertexNormals(),this.geometry3js.computeBoundingBox(),this},g.prototype.handlePrimitive=function(e,t,n){var r=0,i,s,o=e.p,u=e.inputs,a,f,l,c,h=0,p=3,d=[];for(i=0;i<u.length;i++)switch(a=u[i],a.semantic){case"TEXCOORD":d.push(a.set)}for(;r<o.length;){var v=[],m=[],g={},y=[];e.vcount&&(p=e.vcount[h++]);for(i=0;i<p;i++)for(s=0;s<u.length;s++)switch(a=u[s],c=V[a.source],f=o[r+i*u.length+a.offset],l=c.accessor.params.length,l*=f,a.semantic){case"VERTEX":a=R(t.vertices[f].position),v.push(n[a].index);break;case"NORMAL":m.push(new THREE.Vector3(c.data[l],c.data[l+1],c.data[l+2]));break;case"TEXCOORD":g[a.set]===void 0&&(g[a.set]=[]),g[a.set].push(new THREE.UV(c.data[l],c.data[l+1]));break;case"COLOR":y.push((new THREE.Color).setRGB(c.data[l],c.data[l+1],c.data[l+2]))}var b;p==3?b=new THREE.Face3(v[0],v[1],v[2],[m[0],m[1],m[2]],y.length?y:new THREE.Color):p==4&&(b=new THREE.Face4(v[0],v[1],v[2],v[3],[m[0],m[1],m[2],m[3]],y.length?y:new THREE.Color)),b.daeMaterial=e.material,t.faces.push(b);for(s=0;s<d.length;s++)i=g[d[s]],t.faceVertexUvs[s].push([i[0],i[1],i[2]]);r+=u.length*p}},y.prototype=new b,y.prototype.constructor=y,b.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},b.prototype.parse=function(e){this.inputs=[],this.material=e.getAttribute("material"),this.count=I(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"input":this.inputs.push((new S).parse(e.childNodes[t]));break;case"vcount":this.vcount=j(n.textContent);break;case"p":this.p=j(n.textContent)}}return this},w.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=I(e,"count",0),this.stride=I(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeName=="param"){var r={};r.name=n.getAttribute("name"),r.type=n.getAttribute("type"),this.params.push(r)}}return this},E.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeName=="input"){var n=(new S).parse(e.childNodes[t]);this.input[n.semantic]=n}return this},S.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=I(e,"set",-1),this.offset=I(e,"offset",0),this.semantic=="TEXCOORD"&&this.set<0&&(this.set=0),this},x.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];switch(n.nodeName){case"bool_array":for(var r=F(n.textContent),i=[],s=0;s<r.length;s++)i.push(r[s]=="true"||r[s]=="1"?!0:!1);this.data=i,this.type=n.nodeName;break;case"float_array":this.data=B(n.textContent),this.type=n.nodeName;break;case"int_array":this.data=j(n.textContent),this.type=n.nodeName;break;case"IDREF_array":case"Name_array":this.data=F(n.textContent),this.type=n.nodeName;break;case"technique_common":for(r=0;r<n.childNodes.length;r++)if(n.childNodes[r].nodeName=="accessor"){this.accessor=(new w).parse(n.childNodes[r]);break}}}return this},x.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(t=0;t<this.data.length;t+=16){var n=this.data.slice(t,t+16),r=new THREE.Matrix4;r.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]),e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},T.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeName=="instance_effect"){this.instance_effect=(new O).parse(e.childNodes[t]);break}return this},N.prototype.isColor=function(){return this.texture==null},N.prototype.isTexture=function(){return this.texture!=null},N.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"color":n=B(n.textContent),this.color=new THREE.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"texture":this.texture=n.getAttribute("texture"),this.texcoord=n.getAttribute("texcoord")}}return this},C.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[n.nodeName]=(new N).parse(n);break;case"shininess":case"reflectivity":case"transparency":var r;r=U.evaluate(".//dae:float",n,H,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var i=r.iterateNext(),s=[];i;)s.push(i),i=r.iterateNext();r=s,r.length>0&&(this[n.nodeName]=parseFloat(r[0].textContent))}}return this.create(),this},C.prototype.create=function(){var e={},t=this.transparency!==void 0&&this.transparency<1,n;for(n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":var r=this[n];r instanceof N&&(r.isTexture()?this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(r=$[this.effect.surface.init_from])&&(e.map=THREE.ImageUtils.loadTexture(et+r.init_from),e.map.wrapS=THREE.RepeatWrapping,e.map.wrapT=THREE.RepeatWrapping,e.map.repeat.x=1,e.map.repeat.y=-1):n=="diffuse"?e.color=r.color.getHex():t||(e[n]=r.color.getHex()));break;case"shininess":case"reflectivity":e[n]=this[n];break;case"transparency":t&&(e.transparent=!0,e.opacity=this[n],t=!0)}return e.shading=rt,this.material=new THREE.MeshLambertMaterial(e)},k.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"init_from":this.init_from=n.textContent;break;case"format":this.format=n.textContent;break;default:console.log("unhandled Surface prop: "+n.nodeName)}}return this},L.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"source":this.source=n.textContent;break;case"minfilter":this.minfilter=n.textContent;break;case"magfilter":this.magfilter=n.textContent;break;case"mipfilter":this.mipfilter=n.textContent;break;case"wrap_s":this.wrap_s=n.textContent;break;case"wrap_t":this.wrap_t=n.textContent;break;default:console.log("unhandled Sampler2D prop: "+n.nodeName)}}return this},A.prototype.create=function(){if(this.shader==null)return null},A.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(n))}}return this},A.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType==1)switch(r.nodeName){case"surface":this.surface=(new k(this)).parse(r),this.surface.sid=t;break;case"sampler2D":this.sampler=(new L(this)).parse(r),this.sampler.sid=t;break;case"extra":break;default:console.log(r.nodeName)}}},A.prototype.parseProfileCOMMON=function(e){for(var t,n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(r.nodeType==1)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"extra":break;default:console.log(r.nodeName)}}return t},A.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new C(n.nodeName,this)).parse(n)}}},O.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},M.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"source":n=(new x).parse(n),this.source[n.id]=n;break;case"sampler":this.sampler.push((new D(this)).parse(n));break;case"channel":this.channel.push((new _(this)).parse(n))}}return this},_.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/");t.shift();var e=t.shift(),n=e.indexOf(".")>=0,r=e.indexOf("(")>=0,i,s;if(n)t=e.split("."),e=t.shift(),s=t.shift();else if(r){i=e.split("("),e=i.shift();for(t=0;t<i.length;t++)i[t]=parseInt(i[t].replace(/\)/,""))}return this.sid=e,this.dotSyntax=n,this.arrSyntax=r,this.arrIndices=i,this.member=s,this},D.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeType==1)switch(n.nodeName){case"input":this.inputs.push((new S).parse(n))}}return this},D.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],n=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=n.read();break;case"OUTPUT":this.output=n.read();break;case"INTERPOLATION":this.interpolation=n.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=1e8,this.endTime=-1e8;for(e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},{load:function(t,n){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null),t+="?rnd="+Math.random();var r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("text/xml"),r.onreadystatechange=function(){r.readyState==4&&(r.status==0||r.status==200)&&(X=n,e(r.responseXML,void 0,t))},r.open("GET",t,!0),r.send(null)}else alert("Don't know how to parse XML!")},parse:e,setPreferredShading:function(e){rt=e},applySkin:i,geometries:Q}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.supr=THREE.Loader.prototype,THREE.JSONLoader.prototype.load=function(e,t,n){e instanceof Object&&(console.warn("DEPRECATED: JSONLoader( parameters ) is now JSONLoader( url, callback, texturePath )."),n=e,e=n.model,t=n.callback,n=n.texture_path),n=n?n:this.extractUrlbase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState==4)if(s.status==200||s.status==0)try{var u=JSON.parse(s.responseText);e.createModel(u,n,r),e.onLoadComplete()}catch(l){console.error(l),console.warn("DEPRECATED: ["+t+"] seems to be using old model format")}else console.error("Couldn't load ["+t+"] ["+s.status+"]");else s.readyState==3?i&&(o==0&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState==2&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.overrideMimeType("text/plain; charset=x-user-defined"),s.setRequestHeader("Content-Type","text/plain"),s.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,n){var r=new THREE.Geometry,i=e.scale!==void 0?1/e.scale:1;this.initMaterials(r,e.materials,n),function(t){if(e.metadata===void 0||e.metadata.formatVersion===void 0||e.metadata.formatVersion!==3)console.error("Deprecated file format.");else{var n,i,s,o,u,f,l,c,h,p,v,m,g,y,b=e.faces;f=e.vertices;var w=e.normals,E=e.colors,S=0;for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&S++;for(n=0;n<S;n++)r.faceUvs[n]=[],r.faceVertexUvs[n]=[];o=0;for(u=f.length;o<u;)l=new THREE.Vertex,l.position.x=f[o++]*t,l.position.y=f[o++]*t,l.position.z=f[o++]*t,r.vertices.push(l);o=0;for(u=b.length;o<u;){t=b[o++],f=t&1,s=t&2,n=t&4,i=t&8,c=t&16,l=t&32,p=t&64,t&=128,f?(v=new THREE.Face4,v.a=b[o++],v.b=b[o++],v.c=b[o++],v.d=b[o++],f=4):(v=new THREE.Face3,v.a=b[o++],v.b=b[o++],v.c=b[o++],f=3),s&&(s=b[o++],v.materialIndex=s),s=r.faces.length;if(n)for(n=0;n<S;n++)m=e.uvs[n],h=b[o++],y=m[h*2],h=m[h*2+1],r.faceUvs[n][s]=new THREE.UV(y,h);if(i)for(n=0;n<S;n++){m=e.uvs[n],g=[];for(i=0;i<f;i++)h=b[o++],y=m[h*2],h=m[h*2+1],g[i]=new THREE.UV(y,h);r.faceVertexUvs[n][s]=g}c&&(c=b[o++]*3,i=new THREE.Vector3,i.x=w[c++],i.y=w[c++],i.z=w[c],v.normal=i);if(l)for(n=0;n<f;n++)c=b[o++]*3,i=new THREE.Vector3,i.x=w[c++],i.y=w[c++],i.z=w[c],v.vertexNormals.push(i);p&&(l=b[o++],l=new THREE.Color(E[l]),v.color=l);if(t)for(n=0;n<f;n++)l=b[o++],l=new THREE.Color(E[l]),v.vertexColors.push(l);r.faces.push(v)}}}(i),function(){var t,n,i,s;if(e.skinWeights){t=0;for(n=e.skinWeights.length;t<n;t+=2)i=e.skinWeights[t],s=e.skinWeights[t+1],r.skinWeights.push(new THREE.Vector4(i,s,0,0))}if(e.skinIndices){t=0;for(n=e.skinIndices.length;t<n;t+=2)i=e.skinIndices[t],s=e.skinIndices[t+1],r.skinIndices.push(new THREE.Vector4(i,s,0,0))}r.bones=e.bones,r.animation=e.animation}(),function(t){if(e.morphTargets!==void 0){var n,i,s,o,u,f,l,c,h;n=0;for(i=e.morphTargets.length;n<i;n++){r.morphTargets[n]={},r.morphTargets[n].name=e.morphTargets[n].name,r.morphTargets[n].vertices=[],c=r.morphTargets[n].vertices,h=e.morphTargets[n].vertices,s=0;for(o=h.length;s<o;s+=3)u=h[s]*t,f=h[s+1]*t,l=h[s+2]*t,c.push(new THREE.Vertex(new THREE.Vector3(u,f,l)))}}if(e.morphColors!==void 0){n=0;for(i=e.morphColors.length;n<i;n++){r.morphColors[n]={},r.morphColors[n].name=e.morphColors[n].name,r.morphColors[n].colors=[],o=r.morphColors[n].colors,u=e.morphColors[n].colors,t=0;for(s=u.length;t<s;t+=3)f=new THREE.Color(16755200),f.setRGB(u[t],u[t+1],u[t+2]),o.push(f)}}}(i),r.computeCentroids(),r.computeFaceNormals(),this.hasNormals(r)&&r.computeTangents(),t(r)},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==4)if(r.status==200||r.status==0)try{var i=JSON.parse(r.responseText);i.metadata===void 0||i.metadata.formatVersion===void 0||i.metadata.formatVersion!==3?console.error("Deprecated file format."):n.createScene(i,t,e)}catch(s){console.error(s),console.warn("DEPRECATED: ["+e+"] seems to be using old model format")}else console.error("Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.overrideMimeType("text/plain; charset=x-user-defined"),r.setRequestHeader("Content-Type","text/plain"),r.send(null)},THREE.SceneLoader.prototype.createScene=function(e,t,n){function r(e,t){return t=="relativeToHTML"?e:f+"/"+e}function i(){var e;for(h in A.objects)if(!H.objects[h])if(g=A.objects[h],g.geometry!==void 0){if(N=H.geometries[g.geometry]){e=!1;for(j=0;j<g.materials.length;j++)L=H.materials[g.materials[j]],e=L instanceof THREE.ShaderMaterial;e&&N.computeTangents(),w=g.position,E=g.rotation,S=g.quaternion,x=g.scale,S=0,L.length==0&&(L=new THREE.MeshFaceMaterial),L.length>1&&(L=new THREE.MeshFaceMaterial),e=new THREE.Mesh(N,L),e.name=h,e.position.set(w[0],w[1],w[2]),S?(e.quaternion.set(S[0],S[1],S[2],S[3]),e.useQuaternion=!0):e.rotation.set(E[0],E[1],E[2]),e.scale.set(x[0],x[1],x[2]),e.visible=g.visible,H.scene.add(e),H.objects[h]=e;if(g.meshCollider){var t=THREE.CollisionUtils.MeshColliderWBox(e);H.scene.collisions.colliders.push(t)}g.castsShadow&&(t=new THREE.ShadowVolume(N),H.scene.add(t),t.position=e.position,t.rotation=e.rotation,t.scale=e.scale),g.trigger&&g.trigger.toLowerCase()!="none"&&(t={type:g.trigger,object:g},H.triggers[e.name]=t)}}else w=g.position,E=g.rotation,S=g.quaternion,x=g.scale,S=0,e=new THREE.Object3D,e.name=h,e.position.set(w[0],w[1],w[2]),S?(e.quaternion.set(S[0],S[1],S[2],S[3]),e.useQuaternion=!0):e.rotation.set(E[0],E[1],E[2]),e.scale.set(x[0],x[1],x[2]),e.visible=g.visible!==void 0?g.visible:!1,H.scene.add(e),H.objects[h]=e,H.empties[h]=e,g.trigger&&g.trigger.toLowerCase()!="none"&&(t={type:g.trigger,object:g},H.triggers[e.name]=t)}function s(e){return function(t){H.geometries[e]=t,i(),M-=1,a.onLoadComplete(),u()}}function o(e){return function(t){H.geometries[e]=t}}function u(){a.callbackProgress({totalModels:D,totalTextures:P,loadedModels:D-M,loadedTextures:P-_},H),a.onLoadProgress(),M==0&&_==0&&t(H)}var a=this,f=THREE.Loader.prototype.extractUrlbase(n),l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H;A=e,n=new THREE.BinaryLoader,O=new THREE.JSONLoader,_=M=0,H={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}},e=!1;for(h in A.objects)if(g=A.objects[h],g.meshCollider){e=!0;break}e&&(H.scene.collisions=new THREE.CollisionSystem);if(A.transform){e=A.transform.position,y=A.transform.rotation;var B=A.transform.scale;e&&H.scene.position.set(e[0],e[1],e[2]),y&&H.scene.rotation.set(y[0],y[1],y[2]),B&&H.scene.scale.set(B[0],B[1],B[2]),(e||y||B)&&H.scene.updateMatrix()}e=function(){_-=1,u(),a.onLoadComplete()};for(d in A.cameras)y=A.cameras[d],y.type=="perspective"?C=new THREE.PerspectiveCamera(y.fov,y.aspect,y.near,y.far):y.type=="ortho"&&(C=new THREE.OrthographicCamera(y.left,y.right,y.top,y.bottom,y.near,y.far)),w=y.position,y=y.target,C.position.set(w[0],w[1],w[2]),C.target=new THREE.Vector3(y[0],y[1],y[2]),H.cameras[d]=C;for(p in A.lights)y=A.lights[p],d=y.color!==void 0?y.color:16777215,C=y.intensity!==void 0?y.intensity:1,y.type=="directional"?(w=y.direction,b=new THREE.DirectionalLight(d,C),b.position.set(w[0],w[1],w[2]),b.position.normalize()):y.type=="point"?(w=y.position,b=y.distance,b=new THREE.PointLight(d,C,b),b.position.set(w[0],w[1],w[2])):y.type=="ambient"&&(b=new THREE.AmbientLight(d)),H.scene.add(b),H.lights[p]=b;for(v in A.fogs)p=A.fogs[v],p.type=="linear"?k=new THREE.Fog(0,p.near,p.far):p.type=="exp2"&&(k=new THREE.FogExp2(0,p.density)),y=p.color,k.color.setRGB(y[0],y[1],y[2]),H.fogs[v]=k;H.cameras&&A.defaults.camera&&(H.currentCamera=H.cameras[A.defaults.camera]),H.fogs&&A.defaults.fog&&(H.scene.fog=H.fogs[A.defaults.fog]),y=A.defaults.bgcolor,H.bgColor=new THREE.Color,H.bgColor.setRGB(y[0],y[1],y[2]),H.bgColorAlpha=A.defaults.bgalpha;for(l in A.geometries)if(v=A.geometries[l],v.type=="bin_mesh"||v.type=="ascii_mesh")M+=1,a.onLoadStart();D=M;for(l in A.geometries)v=A.geometries[l],v.type=="cube"?(N=new THREE.CubeGeometry(v.width,v.height,v.depth,v.segmentsWidth,v.segmentsHeight,v.segmentsDepth,null,v.flipped,v.sides),H.geometries[l]=N):v.type=="plane"?(N=new THREE.PlaneGeometry(v.width,v.height,v.segmentsWidth,v.segmentsHeight),H.geometries[l]=N):v.type=="sphere"?(N=new THREE.SphereGeometry(v.radius,v.segmentsWidth,v.segmentsHeight),H.geometries[l]=N):v.type=="cylinder"?(N=new THREE.CylinderGeometry(v.topRad,v.botRad,v.height,v.radSegs,v.heightSegs),H.geometries[l]=N):v.type=="torus"?(N=new THREE.TorusGeometry(v.radius,v.tube,v.segmentsR,v.segmentsT),H.geometries[l]=N):v.type=="icosahedron"?(N=new THREE.IcosahedronGeometry(v.subdivisions),H.geometries[l]=N):v.type=="bin_mesh"?n.load(r(v.url,A.urlBaseType),s(l)):v.type=="ascii_mesh"?O.load(r(v.url,A.urlBaseType),s(l)):v.type=="embedded_mesh"&&(v=A.embeds[v.id])&&O.createModel(v,o(l),"");for(m in A.textures)if(l=A.textures[m],l.url instanceof Array){_+=l.url.length;for(v=0;v<l.url.length;v++)a.onLoadStart()}else _+=1,a.onLoadStart();P=_;for(m in A.textures){l=A.textures[m],l.mapping!=void 0&&THREE[l.mapping]!=void 0&&(l.mapping=new THREE[l.mapping]);if(l.url instanceof Array){v=[];for(var j=0;j<l.url.length;j++)v[j]=r(l.url[j],A.urlBaseType);v=THREE.ImageUtils.loadTextureCube(v,l.mapping,e)}else v=THREE.ImageUtils.loadTexture(r(l.url,A.urlBaseType),l.mapping,e),THREE[l.minFilter]!=void 0&&(v.minFilter=THREE[l.minFilter]),THREE[l.magFilter]!=void 0&&(v.magFilter=THREE[l.magFilter]),l.repeat&&(v.repeat.set(l.repeat[0],l.repeat[1]),l.repeat[0]!=1&&(v.wrapS=THREE.RepeatWrapping),l.repeat[1]!=1&&(v.wrapT=THREE.RepeatWrapping)),l.offset&&v.offset.set(l.offset[0],l.offset[1]),l.wrap&&(k={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},k[l.wrap[0]]!==void 0&&(v.wrapS=k[l.wrap[0]]),k[l.wrap[1]]!==void 0&&(v.wrapT=k[l.wrap[1]]));H.textures[m]=v}for(c in A.materials){m=A.materials[c];for(T in m.parameters)T=="envMap"||T=="map"||T=="lightMap"?m.parameters[T]=H.textures[m.parameters[T]]:T=="shading"?m.parameters[T]=m.parameters[T]=="flat"?THREE.FlatShading:THREE.SmoothShading:T=="blending"?m.parameters[T]=THREE[m.parameters[T]]?THREE[m.parameters[T]]:THREE.NormalBlending:T=="combine"?m.parameters[T]=m.parameters[T]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation:T=="vertexColors"&&(m.parameters[T]=="face"?m.parameters[T]=THREE.FaceColors:m.parameters[T]&&(m.parameters[T]=THREE.VertexColors));m.parameters.opacity!==void 0&&m.parameters.opacity<1&&(m.parameters.transparent=!0),m.parameters.normalMap?(l=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(l.uniforms),v=m.parameters.color,k=m.parameters.specular,n=m.parameters.ambient,O=m.parameters.shininess,e.tNormal.texture=H.textures[m.parameters.normalMap],m.parameters.normalMapFactor&&(e.uNormalScale.value=m.parameters.normalMapFactor),m.parameters.map&&(e.tDiffuse.texture=m.parameters.map,e.enableDiffuse.value=!0),m.parameters.lightMap&&(e.tAO.texture=m.parameters.lightMap,e.enableAO.value=!0),m.parameters.specularMap&&(e.tSpecular.texture=H.textures[m.parameters.specularMap],e.enableSpecular.value=!0),e.uDiffuseColor.value.setHex(v),e.uSpecularColor.value.setHex(k),e.uAmbientColor.value.setHex(n),e.uShininess.value=O,m.parameters.opacity&&(e.uOpacity.value=m.parameters.opacity),m=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:e,lights:!0,fog:!0})):m=new THREE[m.type](m.parameters),H.materials[c]=m}i(),a.callbackSync(H),u()},THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype=new THREE.UTF8Loader,THREE.UTF8Loader.prototype.constructor=THREE.UTF8Loader,THREE.UTF8Loader.prototype.load=function(e,t,n){e instanceof Object&&(console.warn("DEPRECATED: UTF8Loader( parameters ) is now UTF8Loader( url, callback, metaData )."),n=e,e=n.model,t=n.callback,n={scale:n.scale,offsetX:n.offsetX,offsetY:n.offsetY,offsetZ:n.offsetZ});var r=new XMLHttpRequest,i=n.scale!==void 0?n.scale:1,s=n.offsetX!==void 0?n.offsetX:0,o=n.offsetY!==void 0?n.offsetY:0,u=n.offsetZ!==void 0?n.offsetZ:0;r.onreadystatechange=function(){r.readyState==4?r.status==200||r.status==0?THREE.UTF8Loader.prototype.createModel(r.responseText,t,i,s,o,u):alert("Couldn't load ["+e+"] ["+r.status+"]"):r.readyState!=3&&r.readyState==2&&r.getResponseHeader("Content-Length")},r.open("GET",e,!0),r.send(null)},THREE.UTF8Loader.prototype.decompressMesh=function(e){var t=e.charCodeAt(0);t>=57344&&(t-=2048),t++;for(var n=new Float32Array(8*t),r=1,i=0;i<8;i++){for(var s=0,o=0;o<t;++o){var u=e.charCodeAt(o+r);s+=u>>1^-(u&1),n[8*o+i]=s}r+=t}t=e.length-r,s=new Uint16Array(t);for(i=o=0;i<t;i++)u=e.charCodeAt(i+r),s[i]=o-u,u==0&&o++;return[n,s]},THREE.UTF8Loader.prototype.createModel=function(e,t,n,r,i,s){var o=function(){var t=this;t.materials=[],THREE.Geometry.call(this);var o=THREE.UTF8Loader.prototype.decompressMesh(e),u=[],l=[];(function(e,o,u){for(var a,l,h,p=e.length;u<p;u+=o)a=e[u],l=e[u+1],h=e[u+2],a=a/16383*n,l=l/16383*n,h=h/16383*n,a+=r,l+=i,h+=s,t.vertices.push(new THREE.Vertex(new THREE.Vector3(a,l,h)))})(o[0],8,0),function(e,t,n){for(var r,i,s=e.length;n<s;n+=t)r=e[n],i=e[n+1],r/=1023,i/=1023,l.push(r,1-i)}(o[0],8,3),function(e,t,n){for(var r,i,s,o=e.length;n<o;n+=t)r=e[n],i=e[n+1],s=e[n+2],r=(r-512)/511,i=(i-512)/511,s=(s-512)/511,u.push(r,i,s)}(o[0],8,5),function(e){var n,r,i,s,o,a,f,h,p,d=e.length;for(n=0;n<d;n+=3){r=e[n],i=e[n+1],s=e[n+2],o=t,h=r,p=i,a=s,f=r;var v=i,m=s,g=o.materials[0],y=u[v*3],b=u[v*3+1],v=u[v*3+2],w=u[m*3],E=u[m*3+1],m=u[m*3+2];f=new THREE.Vector3(u[f*3],u[f*3+1],u[f*3+2]),v=new THREE.Vector3(y,b,v),m=new THREE.Vector3(w,E,m),o.faces.push(new THREE.Face3(h,p,a,[f,v,m],null,g)),o=l[r*2],r=l[r*2+1],a=l[i*2],f=l[i*2+1],h=l[s*2],p=l[s*2+1],s=t.faceVertexUvs[0],i=a,a=f,f=[],f.push(new THREE.UV(o,r)),f.push(new THREE.UV(i,a)),f.push(new THREE.UV(h,p)),s.push(f)}}(o[1]),this.computeCentroids(),this.computeFaceNormals()};o.prototype=new THREE.Geometry,o.prototype.constructor=o,t(new o)},THREE.Axes=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vertex),e.vertices.push(new THREE.Vertex(new THREE.Vector3(0,100,0)));var t=new THREE.CylinderGeometry(0,5,25,5,1),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680}));n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16711680})),n.position.x=100,n.rotation.z=-Math.PI/2,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280})),this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:65280})),n.position.y=100,this.add(n),n=new THREE.Line(e,new THREE.LineBasicMaterial({color:255})),n.rotation.x=Math.PI/2,this.add(n),n=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:255})),n.position.z=100,n.rotation.x=Math.PI/2,this.add(n)},THREE.Axes.prototype=new THREE.Object3D,THREE.Axes.prototype.constructor=THREE.Axes,THREE.MarchingCubes=function(e,t){THREE.Object3D.call(this),this.material=t,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.vlist=new Float32Array(36),this.nlist=new Float32Array(36),this.firstDraw=!0,this.maxCount=4096,this.count=0,this.hasNormal=this.hasPos=!1,this.positionArray=new Float32Array(this.maxCount*3),this.normalArray=new Float32Array(this.maxCount*3)},this.lerp=function(e,t,n){return e+(t-e)*n},this.VIntX=function(e,t,n,r,i,s,o,u,a,f){i=(i-a)/(f-a),a=this.normal_cache,t[r]=s+i*this.delta,t[r+1]=o,t[r+2]=u,n[r]=this.lerp(a[e],a[e+3],i),n[r+1]=this.lerp(a[e+1],a[e+4],i),n[r+2]=this.lerp(a[e+2],a[e+5],i)},this.VIntY=function(e,t,n,r,i,s,o,u,a,f){i=(i-a)/(f-a),a=this.normal_cache,t[r]=s,t[r+1]=o+i*this.delta,t[r+2]=u,t=e+this.yd*3,n[r]=this.lerp(a[e],a[t],i),n[r+1]=this.lerp(a[e+1],a[t+1],i),n[r+2]=this.lerp(a[e+2],a[t+2],i)},this.VIntZ=function(e,t,n,r,i,s,o,u,a,f){i=(i-a)/(f-a),a=this.normal_cache,t[r]=s,t[r+1]=o,t[r+2]=u+i*this.delta,t=e+this.zd*3,n[r]=this.lerp(a[e],a[t],i),n[r+1]=this.lerp(a[e+1],a[t+1],i),n[r+2]=this.lerp(a[e+2],a[t+2],i)},this.compNorm=function(e){var t=e*3;this.normal_cache[t]===0&&(this.normal_cache[t]=this.field[e-1]-this.field[e+1],this.normal_cache[t+1]=this.field[e-this.yd]-this.field[e+this.yd],this.normal_cache[t+2]=this.field[e-this.zd]-this.field[e+this.zd])},this.polygonize=function(e,t,n,r,i,s){var o=r+1,u=r+this.yd,a=r+this.zd,f=o+this.yd,l=o+this.zd,c=r+this.yd+this.zd,h=o+this.yd+this.zd,p=0,d=this.field[r],v=this.field[o],m=this.field[u],g=this.field[f],y=this.field[a],b=this.field[l],w=this.field[c],E=this.field[h];d<i&&(p|=1),v<i&&(p|=2),m<i&&(p|=8),g<i&&(p|=4),y<i&&(p|=16),b<i&&(p|=32),w<i&&(p|=128),E<i&&(p|=64);var S=THREE.edgeTable[p];if(S===0)return 0;var x=this.delta,T=e+x,N=t+x,x=n+x;S&1&&(this.compNorm(r),this.compNorm(o),this.VIntX(r*3,this.vlist,this.nlist,0,i,e,t,n,d,v)),S&2&&(this.compNorm(o),this.compNorm(f),this.VIntY(o*3,this.vlist,this.nlist,3,i,T,t,n,v,g)),S&4&&(this.compNorm(u),this.compNorm(f),this.VIntX(u*3,this.vlist,this.nlist,6,i,e,N,n,m,g)),S&8&&(this.compNorm(r),this.compNorm(u),this.VIntY(r*3,this.vlist,this.nlist,9,i,e,t,n,d,m)),S&16&&(this.compNorm(a),this.compNorm(l),this.VIntX(a*3,this.vlist,this.nlist,12,i,e,t,x,y,b)),S&32&&(this.compNorm(l),this.compNorm(h),this.VIntY(l*3,this.vlist,this.nlist,15,i,T,t,x,b,E)),S&64&&(this.compNorm(c),this.compNorm(h),this.VIntX(c*3,this.vlist,this.nlist,18,i,e,N,x,w,E)),S&128&&(this.compNorm(a),this.compNorm(c),this.VIntY(a*3,this.vlist,this.nlist,21,i,e,t,x,y,w)),S&256&&(this.compNorm(r),this.compNorm(a),this.VIntZ(r*3,this.vlist,this.nlist,24,i,e,t,n,d,y)),S&512&&(this.compNorm(o),this.compNorm(l),this.VIntZ(o*3,this.vlist,this.nlist,27,i,T,t,n,v,b)),S&1024&&(this.compNorm(f),this.compNorm(h),this.VIntZ(f*3,this.vlist,this.nlist,30,i,T,N,n,g,E)),S&2048&&(this.compNorm(u),this.compNorm(c),this.VIntZ(u*3,this.vlist,this.nlist,33,i,e,N,n,m,w)),p<<=4;for(i=r=0;THREE.triTable[p+i]!=-1;)e=p+i,t=e+1,n=e+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[e],3*THREE.triTable[t],3*THREE.triTable[n],s),i+=3,r++;return r},this.posnormtriv=function(e,t,n,r,i,s){var o=this.count*3;this.positionArray[o]=e[n],this.positionArray[o+1]=e[n+1],this.positionArray[o+2]=e[n+2],this.positionArray[o+3]=e[r],this.positionArray[o+4]=e[r+1],this.positionArray[o+5]=e[r+2],this.positionArray[o+6]=e[i],this.positionArray[o+7]=e[i+1],this.positionArray[o+8]=e[i+2],this.normalArray[o]=t[n],this.normalArray[o+1]=t[n+1],this.normalArray[o+2]=t[n+2],this.normalArray[o+3]=t[r],this.normalArray[o+4]=t[r+1],this.normalArray[o+5]=t[r+2],this.normalArray[o+6]=t[i],this.normalArray[o+7]=t[i+1],this.normalArray[o+8]=t[i+2],this.hasNormal=this.hasPos=!0,this.count+=3,this.count>=this.maxCount-3&&s(this)},this.begin=function(){this.count=0,this.hasNormal=this.hasPos=!1},this.end=function(e){if(this.count!==0){for(var t=this.count*3;t<this.positionArray.length;t++)this.positionArray[t]=0;e(this)}},this.addBall=function(e,t,n,r,i){var s=this.size*Math.sqrt(r/i),o=n*this.size,u=t*this.size,a=e*this.size,f=Math.floor(o-s);f<1&&(f=1),o=Math.floor(o+s),o>this.size-1&&(o=this.size-1);var l=Math.floor(u-s);l<1&&(l=1),u=Math.floor(u+s),u>this.size-1&&(u=this.size-1);var c=Math.floor(a-s);c<1&&(c=1),s=Math.floor(a+s),s>this.size-1&&(s=this.size-1);for(var h,p,d,v,m,g;f<o;f++){a=this.size2*f,p=f/this.size-n,m=p*p;for(p=l;p<u;p++){d=a+this.size*p,h=p/this.size-t,g=h*h;for(h=c;h<s;h++)v=h/this.size-e,v=r/(1e-6+v*v+g+m)-i,v>0&&(this.field[d+h]+=v)}}},this.addPlaneX=function(e,t){var n,r,i,s,o,u=this.size,a=this.yd,f=this.zd,l=this.field,c=u*Math.sqrt(e/t);c>u&&(c=u);for(n=0;n<c;n++)if(r=n/u,r*=r,s=e/(1e-4+r)-t,s>0)for(r=0;r<u;r++){o=n+r*a;for(i=0;i<u;i++)l[f*i+o]+=s}},this.addPlaneY=function(e,t){var n,r,i,s,o,u,a=this.size,f=this.yd,l=this.zd,c=this.field,h=a*Math.sqrt(e/t);h>a&&(h=a);for(r=0;r<h;r++)if(n=r/a,n*=n,s=e/(1e-4+n)-t,s>0){o=r*f;for(n=0;n<a;n++){u=o+n;for(i=0;i<a;i++)c[l*i+u]+=s}}},this.addPlaneZ=function(e,t){var n,r,i,s,o,u,a=this.size,f=this.yd,l=this.zd,c=this.field,h=a*Math.sqrt(e/t);h>a&&(h=a);for(i=0;i<h;i++)if(n=i/a,n*=n,s=e/(1e-4+n)-t,s>0){o=l*i;for(r=0;r<a;r++){u=o+r*f;for(n=0;n<a;n++)c[u+n]+=s}}},this.reset=function(){var e;for(e=0;e<this.size3;e++)this.normal_cache[e*3]=0,this.field[e]=0},this.render=function(e){this.begin();var t,n,r,i,s,o,u,a,f,l=this.size-2;for(i=1;i<l;i++){f=this.size2*i,u=(i-this.halfsize)/this.halfsize;for(r=1;r<l;r++){a=f+this.size*r,o=(r-this.halfsize)/this.halfsize;for(n=1;n<l;n++)s=(n-this.halfsize)/this.halfsize,t=a+n,this.polygonize(s,o,u,t,this.isolation,e)}}this.end(e)},this.generateGeometry=function(){var e=0,t=new THREE.Geometry,n=[];return this.render(function(r){var i,s,o,u,f,l,h,p;for(i=0;i<r.count;i++)h=i*3,f=h+1,p=h+2,s=r.positionArray[h],o=r.positionArray[f],u=r.positionArray[p],l=new THREE.Vector3(s,o,u),s=r.normalArray[h],o=r.normalArray[f],u=r.normalArray[p],h=new THREE.Vector3(s,o,u),h.normalize(),f=new THREE.Vertex(l),t.vertices.push(f),n.push(h);l=r.count/3;for(i=0;i<l;i++)h=(e+i)*3,f=h+1,p=h+2,s=n[h],o=n[f],u=n[p],h=new THREE.Face3(h,f,p,[s,o,u]),t.faces.push(h);e+=l,r.count=0}),t},this.init(e)},THREE.MarchingCubes.prototype=new THREE.Object3D,THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes,THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),THREE.WebGLRenderer&&(THREE.AnaglyphWebGLRenderer=function(e){THREE.WebGLRenderer.call(this,e),this.autoUpdateScene=!1;var t=this,n=this.setSize,r=this.render,i=new THREE.PerspectiveCamera,s=new THREE.PerspectiveCamera,o=new THREE.Matrix4,u=new THREE.Matrix4,a,f,l,c;i.matrixAutoUpdate=s.matrixAutoUpdate=!1;var e={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},h=new THREE.WebGLRenderTarget(512,512,e),p=new THREE.WebGLRenderTarget(512,512,e),d=new THREE.PerspectiveCamera(53,1,1,1e4);d.position.z=2;var e=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:h},mapRight:{type:"t",value:1,texture:p}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"}),v=new THREE.Scene;v.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),e)),v.add(d),this.setSize=function(e,r){n.call(t,e,r),h.width=e,h.height=r,p.width=e,p.height=r},this.render=function(e,n){e.updateMatrixWorld();if(a!==n.aspect||f!==n.near||l!==n.far||c!==n.fov){a=n.aspect,f=n.near,l=n.far,c=n.fov;var y=n.projectionMatrix.clone(),b=125/30*.5,w=b*f/125,E=f*Math.tan(c*Math.PI/360),S;o.n14=b,u.n14=-b,b=-E*a+w,S=E*a+w,y.n11=2*f/(S-b),y.n13=(S+b)/(S-b),i.projectionMatrix.copy(y),b=-E*a-w,S=E*a-w,y.n11=2*f/(S-b),y.n13=(S+b)/(S-b),s.projectionMatrix.copy(y)}i.matrixWorld.copy(n.matrixWorld).multiplySelf(u),i.position.copy(n.position),i.near=n.near,i.far=n.far,r.call(t,e,i,h,!0),s.matrixWorld.copy(n.matrixWorld).multiplySelf(o),s.position.copy(n.position),s.near=n.near,s.far=n.far,r.call(t,e,s,p,!0),v.updateMatrixWorld(),r.call(t,v,d)}}),THREE.WebGLRenderer&&(THREE.CrosseyedWebGLRenderer=function(e){THREE.WebGLRenderer.call(this,e),this.autoClear=!1;var t=this,n=this.setSize,r=this.render,i,s,o=new THREE.PerspectiveCamera;o.target=new THREE.Vector3(0,0,0);var u=new THREE.PerspectiveCamera;u.target=new THREE.Vector3(0,0,0),t.separation=10,e&&e.separation!==void 0&&(t.separation=e.separation),this.setSize=function(e,r){n.call(t,e,r),i=e/2,s=r},this.render=function(e,n){this.clear(),o.fov=n.fov,o.aspect=.5*n.aspect,o.near=n.near,o.far=n.far,o.updateProjectionMatrix(),o.position.copy(n.position),o.target.copy(n.target),o.translateX(t.separation),o.lookAt(o.target),u.projectionMatrix=o.projectionMatrix,u.position.copy(n.position),u.target.copy(n.target),u.translateX(-t.separation),u.lookAt(u.target),this.setViewport(0,0,i,s),r.call(t,e,o),this.setViewport(i,0,i,s),r.call(t,e,u,!1)}});