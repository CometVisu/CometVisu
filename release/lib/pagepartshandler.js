/* pagepartshandler.js (c) 2010-2015 by Christian Mayer [CometVisu at ChristianMayer dot de]
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 3 of the License, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA
 * 
 * @module PagePartsHandler
 * @title  CometVisu templateengine
 */

define(["jquery"],function(e){return function(){var n=this;this.navbars={top:{dynamic:!1},left:{dynamic:!1},right:{dynamic:!1},bottom:{dynamic:!1}},this.updateTopNavigation=function(t){t===undefined&&(t=this);var n=e("#main .page").eq(t.getIndex()).attr("id").split("_"),r="id_",i="<a href=\"javascript:templateEngine.scrollToPage('"+r+"')\">"+e("#"+r+" h1").text()+"</a>";for(var s=1;s<n.length;s++)r+=n[s]+"_",e("#"+r).hasClass("page")&&(i+="<span> &#x25ba; </span><a href=\"javascript:templateEngine.scrollToPage('"+r+"')\">"+e("#"+r+" h1").text()+"</a>");e(".nav_path").html(i),templateEngine.handleResize()},this.navbarSetSize=function(t,n){var r=n+(isFinite(n)?"px":"");switch(t){case"left":e("#navbarLeft").css({width:r});break;case"right":e("#centerContainer").css("padding-right",r),e("#navbarRight").css({width:r,"margin-right":"-"+r})}},this.getNavbarsVisibility=function(e){if(templateEngine.currentPageNavbarVisibility==null){var t=templateEngine.widgetDataGet(e.attr("id"));e==null&&(e=templateEngine.currentPage);if(e==null||t==null)return{top:"true",bottom:"true",left:"true",right:"true"};var n=t.shownavbar!=undefined?t.shownavbar:{top:"inherit",bottom:"inherit",left:"inherit",right:"inherit"};for(var r in n)n[r]==undefined&&(n[r]="inherit");if(t!=null){var i=templateEngine.getParentPage(e);while(i!=null){var s=!1;for(var r in n)if(n[r]=="inherit"){s=!0;break}if(!s)break;var o=templateEngine.widgetDataGet(i.attr("id"));if(o.shownavbar!=undefined)for(var r in n)n[r]=="inherit"&&(n[r]=o.shownavbar[r],n[r]==undefined&&(n[r]="inherit"));i=templateEngine.getParentPage(i)}}for(var r in n)if(n[r]==undefined||n[r]=="inherit")n[r]="true";templateEngine.currentPageNavbarVisibility=n}return templateEngine.currentPageNavbarVisibility},this.updatePageParts=function(t,r){var i=!0,s=!0,o=n.getNavbarsVisibility(t),u=templateEngine.widgetDataGet(t.attr("id"));if(u!=null){if(u.showtopnavigation!=undefined)i=u.showtopnavigation!="false";else{var a=templateEngine.getParentPage(t);while(a!=null){var f=templateEngine.widgetDataGet(a.attr("id"));if(f.showtopnavigation!=undefined){i=f.showtopnavigation!="false";break}a=templateEngine.getParentPage(a)}}if(u.showfooter!=undefined)s=u.showfooter!="false";else{var a=templateEngine.getParentPage(t);while(a!=null){var f=templateEngine.widgetDataGet(a.attr("id"));if(f.showfooter!=undefined){s=f.showfooter!="false";break}a=templateEngine.getParentPage(a)}}}i?e("#top").css("display")=="none"&&(e("#top, #top > *").css("display","block"),n.removeInactiveNavbars(t.attr("id"))):e("#top").css("display")!="none"&&(e("#top").css("display","none"),n.removeInactiveNavbars(t.attr("id"))),s?e("#bottom").css("display")=="none"&&(e("#bottom").css("display","block"),n.removeInactiveNavbars(t.attr("id"))):e("#bottom").css("display")!="none"&&(e("#bottom").css("display","none"),n.removeInactiveNavbars(t.attr("id"))),["Left","Top","Right","Bottom"].forEach(function(i){var s=i.toLowerCase(),u=e("#navbar"+i),a=u.css("display"),f=u[0].classList.contains("loading");if(o[s]=="true"){if(a=="none"||f)n.fadeNavbar(i,"in",r),n.removeInactiveNavbars(t.attr("id"))}else(a!="none"||f)&&n.fadeNavbar(i,"out",r)})},this.fadeNavbar=function(t,n,r){r=r!==undefined?r:templateEngine.main_scroll.getConf().speed;var i={},s={},o=e("#navbar"+t),u=t.toLowerCase(),a=function(){};switch(n){case"in":o.css("display")=="none"&&(i.display="block"),s[u]=0;switch(t){case"Top":case"Bottom":i[u]=-o.height();break;case"Left":case"Right":i[u]=-o.width()}break;case"out":a=function(){o.css("display","none")};switch(t){case"Top":case"Bottom":s[u]=-o.height();break;case"Left":case"Right":s[u]=-o.width()}}o.css(i),r==0?(o.css(s),a()):o.animate(s,r,templateEngine.main_scroll.getConf().easing,a)},this.initializeNavbars=function(t){n.removeInactiveNavbars(t);var r=[e("#id_").get(0)];if(t!="id_"){var i=t.split("_");i.pop(),i[0]="";for(var s=0;s<i.length;s++){var o=e("#id"+i.slice(0,s+1).join("_")+"_.page","#pages");o.size()==1&&r.push(o.get(0))}}var u=1;e(r).each(function(t){var n=e(this).attr("id"),i=e("#"+n+"top_navbar"),s=templateEngine.widgetDataGet(n+"top_navbar"),o=e("#"+n+"right_navbar"),a=templateEngine.widgetDataGet(n+"right_navbar"),f=e("#"+n+"bottom_navbar"),l=templateEngine.widgetDataGet(n+"bottom_navbar"),c=e("#"+n+"left_navbar"),h=templateEngine.widgetDataGet(n+"left_navbar");i.size()>0&&(s.scope==undefined||s.scope<0||r.length-u<=s.scope?i.addClass("navbarActive"):i.removeClass("navbarActive")),o.size()>0&&(a.scope==undefined||a.scope<0||r.length-u<=a.scope?o.addClass("navbarActive"):o.removeClass("navbarActive")),f.size()>0&&(l.scope==undefined||l.scope<0||r.length-u<=l.scope?f.addClass("navbarActive"):f.removeClass("navbarActive")),c.size()>0&&(h.scope==undefined||h.scope<0||r.length-u<=h.scope?c.addClass("navbarActive"):c.removeClass("navbarActive")),u++})},this.removeInactiveNavbars=function(t){e(".navbar.navbarActive").each(function(n){var r=this.id.split("_");r=r.slice(0,r.length-2).join("_");var i=new RegExp("^"+r+".*","i");r!=t&&!i.test(t)&&e(this).removeClass("navbarActive")})}}});