/*
 * Modified version by Christian Mayer (c) 2011 to avoid the originally used
 * namespace
 */

/*
 * Poly2Tri Copyright (c) 2009-2010, Poly2Tri Contributors
 * http://code.google.com/p/poly2tri/
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of Poly2Tri nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without specific
 *   prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

poly2tri={},poly2tri.Point=function(){this.x=null,this.y=null,arguments.length==0?(this.x=0,this.y=0):arguments.length==2?(this.x=arguments[0],this.y=arguments[1]):alert("Invalid poly2tri.Point constructor call!"),this.edge_list=[]},poly2tri.Point.prototype.set_zero=function(){this.x=0,this.y=0},poly2tri.Point.prototype.set=function(e,t){this.x=e,this.y=t},poly2tri.Point.prototype.negate=function(){this.x=-this.x,this.y=-this.y},poly2tri.Point.prototype.add=function(e){this.x+=e.x,this.y+=e.y},poly2tri.Point.prototype.sub=function(e){this.x-=e.x,this.y-=e.y},poly2tri.Point.prototype.mul=function(e){this.x*=e,this.y*=e},poly2tri.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},poly2tri.Point.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},poly2tri.Point.prototype.equals=function(e){return poly2tri.equals(this,e)},poly2tri.negate=function(e){return new poly2tri.Point(-e.x,-e.y)},poly2tri.cmp=function(e,t){return e.y==t.y?e.x-t.x:e.y-t.y},poly2tri.add=function(e,t){return new poly2tri.Point(e.x+t.x,e.y+t.y)},poly2tri.sub=function(e,t){return new poly2tri.Point(e.x-t.x,e.y-t.y)},poly2tri.mul=function(e,t){return new poly2tri.Point(e*t.x,e*t.y)},poly2tri.equals=function(e,t){return e.x==t.x&&e.y==t.y},poly2tri.dot=function(e,t){return e.x*t.x+e.y*t.y},poly2tri.cross=function(){var e=!1,t=!1;return arguments.length==2?(typeof arguments[0]=="number"&&(e=!0),typeof (arguments[1]=="number")&&(t=!0),e?t?arguments[0].x*arguments[1].y-arguments[0].y*arguments[1].x:new poly2tri.Point(arguments[1]*arguments[0].y,-arguments[1]*arguments[0].x):t?new poly2tri.Point(-arguments[0]*arguments[1].y,arguments[0]*arguments[1].x):arguments[0]*arguments[1]):(alert("Invalid poly2tri.cross call!"),undefined)},poly2tri.Edge=function(){this.p=null,this.q=null,arguments.length==2?arguments[0].y>arguments[1].y?(this.q=arguments[0],this.p=arguments[1]):arguments[0].y==arguments[1].y?arguments[0].x>arguments[1].x?(this.q=arguments[0],this.p=arguments[1]):arguments[0].x==arguments[1].x?alert("Invalid poly2tri.edge constructor call: repeated points!"):(this.p=arguments[0],this.q=arguments[1]):(this.p=arguments[0],this.q=arguments[1]):alert("Invalid poly2tri.Edge constructor call!"),this.q.edge_list.push(this)},poly2tri.Triangle=function(e,t,n){this.points_=[null,null,null],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1],arguments.length==3&&(this.points_[0]=e,this.points_[1]=t,this.points_[2]=n)},poly2tri.Triangle.prototype.GetPoint=function(e){return this.points_[e]},poly2tri.Triangle.prototype.GetNeighbor=function(e){return this.neighbors_[e]},poly2tri.Triangle.prototype.ContainsP=function(){var e=!0;for(var t=0;t<arguments.length;++t)e=e&&(arguments[t].equals(this.points_[0])||arguments[t].equals(this.points_[1])||arguments[t].equals(this.points_[2]));return e},poly2tri.Triangle.prototype.ContainsE=function(){var e=!0;for(var t=0;t<arguments.length;++t)e=e&&this.ContainsP(arguments[t].p,arguments[t].q);return e},poly2tri.Triangle.prototype.IsInterior=function(){return arguments.length==0?this.interior_:(this.interior_=arguments[0],this.interior_)},poly2tri.Triangle.prototype.MarkNeighbor=function(){var e;if(arguments.length==3){var t=arguments[0],n=arguments[1];e=arguments[2],t.equals(this.points_[2])&&n.equals(this.points_[1])||t.equals(this.points_[1])&&n.equals(this.points_[2])?this.neighbors_[0]=e:t.equals(this.points_[0])&&n.equals(this.points_[2])||t.equals(this.points_[2])&&n.equals(this.points_[0])?this.neighbors_[1]=e:t.equals(this.points_[0])&&n.equals(this.points_[1])||t.equals(this.points_[1])&&n.equals(this.points_[0])?this.neighbors_[2]=e:alert("Invalid poly2tri.Triangle.MarkNeighbor call (1)!")}else arguments.length==1?(e=arguments[0],e.ContainsP(this.points_[1],this.points_[2])?(this.neighbors_[0]=e,e.MarkNeighbor(this.points_[1],this.points_[2],this)):e.ContainsP(this.points_[0],this.points_[2])?(this.neighbors_[1]=e,e.MarkNeighbor(this.points_[0],this.points_[2],this)):e.ContainsP(this.points_[0],this.points_[1])&&(this.neighbors_[2]=e,e.MarkNeighbor(this.points_[0],this.points_[1],this))):alert("Invalid poly2tri.Triangle.MarkNeighbor call! (2)")},poly2tri.Triangle.prototype.ClearNeigbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},poly2tri.Triangle.prototype.ClearDelunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},poly2tri.Triangle.prototype.PointCW=function(e){return e.equals(this.points_[0])?this.points_[2]:e.equals(this.points_[1])?this.points_[0]:e.equals(this.points_[2])?this.points_[1]:null},poly2tri.Triangle.prototype.PointCCW=function(e){return e.equals(this.points_[0])?this.points_[1]:e.equals(this.points_[1])?this.points_[2]:e.equals(this.points_[2])?this.points_[0]:null},poly2tri.Triangle.prototype.NeighborCW=function(e){return e.equals(this.points_[0])?this.neighbors_[1]:e.equals(this.points_[1])?this.neighbors_[2]:this.neighbors_[0]},poly2tri.Triangle.prototype.NeighborCCW=function(e){return e.equals(this.points_[0])?this.neighbors_[2]:e.equals(this.points_[1])?this.neighbors_[0]:this.neighbors_[1]},poly2tri.Triangle.prototype.GetConstrainedEdgeCW=function(e){return e.equals(this.points_[0])?this.constrained_edge[1]:e.equals(this.points_[1])?this.constrained_edge[2]:this.constrained_edge[0]},poly2tri.Triangle.prototype.GetConstrainedEdgeCCW=function(e){return e.equals(this.points_[0])?this.constrained_edge[2]:e.equals(this.points_[1])?this.constrained_edge[0]:this.constrained_edge[1]},poly2tri.Triangle.prototype.SetConstrainedEdgeCW=function(e,t){e.equals(this.points_[0])?this.constrained_edge[1]=t:e.equals(this.points_[1])?this.constrained_edge[2]=t:this.constrained_edge[0]=t},poly2tri.Triangle.prototype.SetConstrainedEdgeCCW=function(e,t){e.equals(this.points_[0])?this.constrained_edge[2]=t:e.equals(this.points_[1])?this.constrained_edge[0]=t:this.constrained_edge[1]=t},poly2tri.Triangle.prototype.GetDelaunayEdgeCW=function(e){return e.equals(this.points_[0])?this.delaunay_edge[1]:e.equals(this.points_[1])?this.delaunay_edge[2]:this.delaunay_edge[0]},poly2tri.Triangle.prototype.GetDelaunayEdgeCCW=function(e){return e.equals(this.points_[0])?this.delaunay_edge[2]:e.equals(this.points_[1])?this.delaunay_edge[0]:this.delaunay_edge[1]},poly2tri.Triangle.prototype.SetDelaunayEdgeCW=function(e,t){e.equals(this.points_[0])?this.delaunay_edge[1]=t:e.equals(this.points_[1])?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},poly2tri.Triangle.prototype.SetDelaunayEdgeCCW=function(e,t){e.equals(this.points_[0])?this.delaunay_edge[2]=t:e.equals(this.points_[1])?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},poly2tri.Triangle.prototype.NeighborAcross=function(e){return e.equals(this.points_[0])?this.neighbors_[0]:e.equals(this.points_[1])?this.neighbors_[1]:this.neighbors_[2]},poly2tri.Triangle.prototype.OppositePoint=function(e,t){var n=e.PointCW(t);return this.PointCW(n)},poly2tri.Triangle.prototype.Legalize=function(){if(arguments.length==1)this.Legalize(this.points_[0],arguments[0]);else if(arguments.length==2){var e=arguments[0],t=arguments[1];e.equals(this.points_[0])?(this.points_[1]=this.points_[0],this.points_[0]=this.points_[2],this.points_[2]=t):e.equals(this.points_[1])?(this.points_[2]=this.points_[1],this.points_[1]=this.points_[0],this.points_[0]=t):e.equals(this.points_[2])?(this.points_[0]=this.points_[2],this.points_[2]=this.points_[1],this.points_[1]=t):alert("Invalid poly2tri.Triangle.Legalize call!")}else alert("Invalid poly2tri.Triangle.Legalize call!")},poly2tri.Triangle.prototype.Index=function(e){return e.equals(this.points_[0])?0:e.equals(this.points_[1])?1:e.equals(this.points_[2])?2:-1},poly2tri.Triangle.prototype.EdgeIndex=function(e,t){if(e.equals(this.points_[0])){if(t.equals(this.points_[1]))return 2;if(t.equals(this.points_[2]))return 1}else if(e.equals(this.points_[1])){if(t.equals(this.points_[2]))return 0;if(t.equals(this.points_[0]))return 2}else if(e.equals(this.points_[2])){if(t.equals(this.points_[0]))return 1;if(t.equals(this.points_[1]))return 0}return-1},poly2tri.Triangle.prototype.MarkConstrainedEdge=function(){if(arguments.length==1)typeof arguments[0]=="number"?this.constrained_edge[arguments[0]]=!0:this.MarkConstrainedEdge(arguments[0].p,arguments[0].q);else if(arguments.length==2){var e=arguments[0],t=arguments[1];if(t.equals(this.points_[0])&&e.equals(this.points_[1])||t.equals(this.points_[1])&&e.equals(this.points_[0]))this.constrained_edge[2]=!0;else if(t.equals(this.points_[0])&&e.equals(this.points_[2])||t.equals(this.points_[2])&&e.equals(this.points_[0]))this.constrained_edge[1]=!0;else if(t.equals(this.points_[1])&&e.equals(this.points_[2])||t.equals(this.points_[2])&&e.equals(this.points_[1]))this.constrained_edge[0]=!0}else alert("Invalid poly2tri.Triangle.MarkConstrainedEdge call!")},poly2tri.PI_3div4=3*Math.PI/4,poly2tri.PI_2=Math.PI/2,poly2tri.EPSILON=1e-12,poly2tri.kAlpha=.3,poly2tri.Orientation={CW:1,CCW:-1,COLLINEAR:0},poly2tri.Orient2d=function(e,t,n){var r=(e.x-n.x)*(t.y-n.y),i=(e.y-n.y)*(t.x-n.x),s=r-i;return s>-poly2tri.EPSILON&&s<poly2tri.EPSILON?poly2tri.Orientation.COLLINEAR:s>0?poly2tri.Orientation.CCW:poly2tri.Orientation.CW},poly2tri.InScanArea=function(e,t,n,r){var i=r.x,s=r.y,o=e.x-i,u=e.y-s,a=t.x-i,f=t.y-s,l=o*f,c=a*u,h=l-c;if(h<=poly2tri.EPSILON)return!1;var p=n.x-i,d=n.y-s,v=p*u,m=o*d,g=v-m;return g<=poly2tri.EPSILON?!1:!0},poly2tri.Node=function(){this.point=null,this.triangle=null,this.next=null,this.prev=null,this.value=0,arguments.length==1?(this.point=arguments[0],this.value=this.point.x):arguments.length==2?(this.point=arguments[0],this.triangle=arguments[1],this.value=this.point.x):alert("Invalid poly2tri.Node constructor call!")},poly2tri.AdvancingFront=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e},poly2tri.AdvancingFront.prototype.head=function(){return this.head_},poly2tri.AdvancingFront.prototype.set_head=function(e){this.head_=e},poly2tri.AdvancingFront.prototype.tail=function(){return this.tail_},poly2tri.AdvancingFront.prototype.set_tail=function(e){this.tail_=e},poly2tri.AdvancingFront.prototype.search=function(){return this.search_node_},poly2tri.AdvancingFront.prototype.set_search=function(e){this.search_node_=e},poly2tri.AdvancingFront.prototype.FindSearchNode=function(e){return this.search_node_},poly2tri.AdvancingFront.prototype.LocateNode=function(e){var t=this.search_node_;if(e<t.value){while((t=t.prev)!=null)if(e>=t.value)return this.search_node_=t,t}else while((t=t.next)!=null)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},poly2tri.AdvancingFront.prototype.LocatePoint=function(e){var t=e.x,n=this.FindSearchNode(t),r=n.point.x;if(t==r){if(n.prev&&e.equals(n.prev.point))n=n.prev;else if(n.next&&e.equals(n.next.point))n=n.next;else if(!e.equals(n.point))return alert("Invalid poly2tri.AdvancingFront.LocatePoint call!"),null}else if(t<r){while((n=n.prev)!=null)if(e.equals(n.point))break}else while((n=n.next)!=null)if(e.equals(n.point))break;return n!=null&&(this.search_node_=n),n},poly2tri.Basin=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1},poly2tri.Basin.prototype.Clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1},poly2tri.EdgeEvent=function(){this.constrained_edge=null,this.right=!1},poly2tri.SweepContext=function(e){this.triangles_=[],this.map_=[],this.points_=e,this.edge_list=[],this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new poly2tri.Basin,this.edge_event=new poly2tri.EdgeEvent,this.InitEdges(this.points_)},poly2tri.SweepContext.prototype.AddHole=function(e){this.InitEdges(e);for(var t in e)this.points_.push(e[t])},poly2tri.SweepContext.prototype.front=function(){return this.front_},poly2tri.SweepContext.prototype.point_count=function(){return this.points_.length},poly2tri.SweepContext.prototype.head=function(){return this.head_},poly2tri.SweepContext.prototype.set_head=function(e){this.head_=e},poly2tri.SweepContext.prototype.tail=function(){return this.tail_},poly2tri.SweepContext.prototype.set_tail=function(e){this.tail_=e},poly2tri.SweepContext.prototype.GetTriangles=function(){return this.triangles_},poly2tri.SweepContext.prototype.GetMap=function(){return this.map_},poly2tri.SweepContext.prototype.InitTriangulation=function(){var e=this.points_[0].x,t=this.points_[0].x,n=this.points_[0].y,r=this.points_[0].y;for(var i in this.points_){var s=this.points_[i];s.x>e&&(e=s.x),s.x<t&&(t=s.x),s.y>n&&(n=s.y),s.y<r&&(r=s.y)}var o=poly2tri.kAlpha*(e-t),u=poly2tri.kAlpha*(n-r);this.head_=new poly2tri.Point(e+o,r-u),this.tail_=new poly2tri.Point(t-u,r-u),this.points_.sort(poly2tri.cmp)},poly2tri.SweepContext.prototype.InitEdges=function(e){for(var t=0;t<e.length;++t)this.edge_list.push(new poly2tri.Edge(e[t],e[(t+1)%e.length]))},poly2tri.SweepContext.prototype.GetPoint=function(e){return this.points_[e]},poly2tri.SweepContext.prototype.AddToMap=function(e){this.map_.push(e)},poly2tri.SweepContext.prototype.LocateNode=function(e){return this.front_.LocateNode(e.x)},poly2tri.SweepContext.prototype.CreateAdvancingFront=function(){var e,t,n,r=new poly2tri.Triangle(this.points_[0],this.tail_,this.head_);this.map_.push(r),e=new poly2tri.Node(r.GetPoint(1),r),t=new poly2tri.Node(r.GetPoint(0),r),n=new poly2tri.Node(r.GetPoint(2)),this.front_=new poly2tri.AdvancingFront(e,n),e.next=t,t.next=n,t.prev=e,n.prev=t},poly2tri.SweepContext.prototype.RemoveNode=function(e){},poly2tri.SweepContext.prototype.MapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(e.GetNeighbor(t)==null){var n=this.front_.LocatePoint(e.PointCW(e.GetPoint(t)));n!=null&&(n.triangle=e)}},poly2tri.SweepContext.prototype.RemoveFromMap=function(e){for(var t in this.map_)if(this.map_[t]==e){delete this.map_[t];break}},poly2tri.SweepContext.prototype.MeshClean=function(e){if(e!=null&&!e.IsInterior()){e.IsInterior(!0),this.triangles_.push(e);for(var t=0;t<3;++t)e.constrained_edge[t]||this.MeshClean(e.GetNeighbor(t))}},poly2tri.sweep={},poly2tri.sweep.Triangulate=function(e){e.InitTriangulation(),e.CreateAdvancingFront(),poly2tri.sweep.SweepPoints(e),poly2tri.sweep.FinalizationPolygon(e)},poly2tri.sweep.SweepPoints=function(e){for(var t=1;t<e.point_count();++t){var n=e.GetPoint(t),r=poly2tri.sweep.PointEvent(e,n);for(var i=0;i<n.edge_list.length;++i)poly2tri.sweep.EdgeEvent(e,n.edge_list[i],r)}},poly2tri.sweep.FinalizationPolygon=function(e){var t=e.front().head().next.triangle,n=e.front().head().next.point;while(!t.GetConstrainedEdgeCW(n))t=t.NeighborCCW(n);e.MeshClean(t)},poly2tri.sweep.PointEvent=function(e,t){var n=e.LocateNode(t),r=poly2tri.sweep.NewFrontTriangle(e,t,n);return t.x<=n.point.x+poly2tri.EPSILON&&poly2tri.sweep.Fill(e,n),poly2tri.sweep.FillAdvancingFront(e,r),r},poly2tri.sweep.EdgeEvent=function(){var e;if(arguments.length==3){e=arguments[0];var t=arguments[1],n=arguments[2];e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x;if(poly2tri.sweep.IsEdgeSideOfTriangle(n.triangle,t.p,t.q))return;poly2tri.sweep.FillEdgeEvent(e,t,n),poly2tri.sweep.EdgeEvent(e,t.p,t.q,n.triangle,t.q)}else if(arguments.length==5){e=arguments[0];var r=arguments[1],i=arguments[2],s=arguments[3],o=arguments[4];if(poly2tri.sweep.IsEdgeSideOfTriangle(s,r,i))return;var u=s.PointCCW(o),a=poly2tri.Orient2d(i,u,r);if(a==poly2tri.Orientation.COLLINEAR){alert("poly2tri.sweep.EdgeEvent: Collinear not supported!");return}var f=s.PointCW(o),l=poly2tri.Orient2d(i,f,r);if(l==poly2tri.Orientation.COLLINEAR){alert("poly2tri.sweep.EdgeEvent: Collinear not supported!");return}a==l?(a==poly2tri.Orientation.CW?s=s.NeighborCCW(o):s=s.NeighborCW(o),poly2tri.sweep.EdgeEvent(e,r,i,s,o)):poly2tri.sweep.FlipEdgeEvent(e,r,i,s,o)}else alert("Invalid poly2tri.sweep.EdgeEvent call!")},poly2tri.sweep.IsEdgeSideOfTriangle=function(e,t,n){var r=e.EdgeIndex(t,n);if(r!=-1){e.MarkConstrainedEdge(r);var i=e.GetNeighbor(r);return i!=null&&i.MarkConstrainedEdge(t,n),!0}return!1},poly2tri.sweep.NewFrontTriangle=function(e,t,n){var r=new poly2tri.Triangle(t,n.point,n.next.point);r.MarkNeighbor(n.triangle),e.AddToMap(r);var i=new poly2tri.Node(t);return i.next=n.next,i.prev=n,n.next.prev=i,n.next=i,poly2tri.sweep.Legalize(e,r)||e.MapTriangleToNodes(r),i},poly2tri.sweep.Fill=function(e,t){var n=new poly2tri.Triangle(t.prev.point,t.point,t.next.point);n.MarkNeighbor(t.prev.triangle),n.MarkNeighbor(t.triangle),e.AddToMap(n),t.prev.next=t.next,t.next.prev=t.prev,poly2tri.sweep.Legalize(e,n)||e.MapTriangleToNodes(n)},poly2tri.sweep.FillAdvancingFront=function(e,t){var n=t.next,r;while(n.next!=null){r=poly2tri.sweep.HoleAngle(n);if(r>poly2tri.PI_2||r<-poly2tri.PI_2)break;poly2tri.sweep.Fill(e,n),n=n.next}n=t.prev;while(n.prev!=null){r=poly2tri.sweep.HoleAngle(n);if(r>poly2tri.PI_2||r<-poly2tri.PI_2)break;poly2tri.sweep.Fill(e,n),n=n.prev}t.next!=null&&t.next.next!=null&&(r=poly2tri.sweep.BasinAngle(t),r<poly2tri.PI_3div4&&poly2tri.sweep.FillBasin(e,t))},poly2tri.sweep.BasinAngle=function(e){var t=e.point.x-e.next.next.point.x,n=e.point.y-e.next.next.point.y;return Math.atan2(n,t)},poly2tri.sweep.HoleAngle=function(e){var t=e.next.point.x-e.point.x,n=e.next.point.y-e.point.y,r=e.prev.point.x-e.point.x,i=e.prev.point.y-e.point.y;return Math.atan2(t*i-n*r,t*r+n*i)},poly2tri.sweep.Legalize=function(e,t){for(var n=0;n<3;++n){if(t.delaunay_edge[n])continue;var r=t.GetNeighbor(n);if(r!=null){var i=t.GetPoint(n),s=r.OppositePoint(t,i),o=r.Index(s);if(r.constrained_edge[o]||r.delaunay_edge[o]){t.constrained_edge[n]=r.constrained_edge[o];continue}var u=poly2tri.sweep.Incircle(i,t.PointCCW(i),t.PointCW(i),s);if(u){t.delaunay_edge[n]=!0,r.delaunay_edge[o]=!0,poly2tri.sweep.RotateTrianglePair(t,i,r,s);var a=!poly2tri.sweep.Legalize(e,t);return a&&e.MapTriangleToNodes(t),a=!poly2tri.sweep.Legalize(e,r),a&&e.MapTriangleToNodes(r),t.delaunay_edge[n]=!1,r.delaunay_edge[o]=!1,!0}}}return!1},poly2tri.sweep.Incircle=function(e,t,n,r){var i=e.x-r.x,s=e.y-r.y,o=t.x-r.x,u=t.y-r.y,a=i*u,f=o*s,l=a-f;if(l<=0)return!1;var c=n.x-r.x,h=n.y-r.y,p=c*s,d=i*h,v=p-d;if(v<=0)return!1;var m=o*h,g=c*u,y=i*i+s*s,b=o*o+u*u,w=c*c+h*h,E=y*(m-g)+b*v+w*l;return E>0},poly2tri.sweep.RotateTrianglePair=function(e,t,n,r){var i,s,o,u;i=e.NeighborCCW(t),s=e.NeighborCW(t),o=n.NeighborCCW(r),u=n.NeighborCW(r);var a,f,l,c;a=e.GetConstrainedEdgeCCW(t),f=e.GetConstrainedEdgeCW(t),l=n.GetConstrainedEdgeCCW(r),c=n.GetConstrainedEdgeCW(r);var h,p,d,v;h=e.GetDelaunayEdgeCCW(t),p=e.GetDelaunayEdgeCW(t),d=n.GetDelaunayEdgeCCW(r),v=n.GetDelaunayEdgeCW(r),e.Legalize(t,r),n.Legalize(r,t),n.SetDelaunayEdgeCCW(t,h),e.SetDelaunayEdgeCW(t,p),e.SetDelaunayEdgeCCW(r,d),n.SetDelaunayEdgeCW(r,v),n.SetConstrainedEdgeCCW(t,a),e.SetConstrainedEdgeCW(t,f),e.SetConstrainedEdgeCCW(r,l),n.SetConstrainedEdgeCW(r,c),e.ClearNeigbors(),n.ClearNeigbors(),i&&n.MarkNeighbor(i),s&&e.MarkNeighbor(s),o&&e.MarkNeighbor(o),u&&n.MarkNeighbor(u),e.MarkNeighbor(n)},poly2tri.sweep.FillBasin=function(e,t){poly2tri.Orient2d(t.point,t.next.point,t.next.next.point)==poly2tri.Orientation.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;while(e.basin.bottom_node.next!=null&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node==e.basin.left_node)return;e.basin.right_node=e.basin.bottom_node;while(e.basin.right_node.next!=null&&e.basin.right_node.point.y<e.basin.right_node.next.point.y)e.basin.right_node=e.basin.right_node.next;if(e.basin.right_node==e.basin.bottom_node)return;e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,poly2tri.sweep.FillBasinReq(e,e.basin.bottom_node)},poly2tri.sweep.FillBasinReq=function(e,t){if(poly2tri.sweep.IsShallow(e,t))return;poly2tri.sweep.Fill(e,t);var n;if(t.prev==e.basin.left_node&&t.next==e.basin.right_node)return;if(t.prev==e.basin.left_node){n=poly2tri.Orient2d(t.point,t.next.point,t.next.next.point);if(n==poly2tri.Orientation.CW)return;t=t.next}else if(t.next==e.basin.right_node){n=poly2tri.Orient2d(t.point,t.prev.point,t.prev.prev.point);if(n==poly2tri.Orientation.CCW)return;t=t.prev}else t.prev.point.y<t.next.point.y?t=t.prev:t=t.next;poly2tri.sweep.FillBasinReq(e,t)},poly2tri.sweep.IsShallow=function(e,t){var n;return e.basin.left_highest?n=e.basin.left_node.point.y-t.point.y:n=e.basin.right_node.point.y-t.point.y,e.basin.width>n?!0:!1},poly2tri.sweep.FillEdgeEvent=function(e,t,n){e.edge_event.right?poly2tri.sweep.FillRightAboveEdgeEvent(e,t,n):poly2tri.sweep.FillLeftAboveEdgeEvent(e,t,n)},poly2tri.sweep.FillRightAboveEdgeEvent=function(e,t,n){while(n.next.point.x<t.p.x)poly2tri.Orient2d(t.q,n.next.point,t.p)==poly2tri.Orientation.CCW?poly2tri.sweep.FillRightBelowEdgeEvent(e,t,n):n=n.next},poly2tri.sweep.FillRightBelowEdgeEvent=function(e,t,n){n.point.x<t.p.x&&(poly2tri.Orient2d(n.point,n.next.point,n.next.next.point)==poly2tri.Orientation.CCW?poly2tri.sweep.FillRightConcaveEdgeEvent(e,t,n):(poly2tri.sweep.FillRightConvexEdgeEvent(e,t,n),poly2tri.sweep.FillRightBelowEdgeEvent(e,t,n)))},poly2tri.sweep.FillRightConcaveEdgeEvent=function(e,t,n){poly2tri.sweep.Fill(e,n.next),n.next.point!=t.p&&poly2tri.Orient2d(t.q,n.next.point,t.p)==poly2tri.Orientation.CCW&&poly2tri.Orient2d(n.point,n.next.point,n.next.next.point)==poly2tri.Orientation.CCW&&poly2tri.sweep.FillRightConcaveEdgeEvent(e,t,n)},poly2tri.sweep.FillRightConvexEdgeEvent=function(e,t,n){poly2tri.Orient2d(n.next.point,n.next.next.point,n.next.next.next.point)==poly2tri.Orientation.CCW?poly2tri.sweep.FillRightConcaveEdgeEvent(e,t,n.next):poly2tri.Orient2d(t.q,n.next.next.point,t.p)==poly2tri.Orientation.CCW&&poly2tri.sweep.FillRightConvexEdgeEvent(e,t,n.next)},poly2tri.sweep.FillLeftAboveEdgeEvent=function(e,t,n){while(n.prev.point.x>t.p.x)poly2tri.Orient2d(t.q,n.prev.point,t.p)==poly2tri.Orientation.CW?poly2tri.sweep.FillLeftBelowEdgeEvent(e,t,n):n=n.prev},poly2tri.sweep.FillLeftBelowEdgeEvent=function(e,t,n){n.point.x>t.p.x&&(poly2tri.Orient2d(n.point,n.prev.point,n.prev.prev.point)==poly2tri.Orientation.CW?poly2tri.sweep.FillLeftConcaveEdgeEvent(e,t,n):(poly2tri.sweep.FillLeftConvexEdgeEvent(e,t,n),poly2tri.sweep.FillLeftBelowEdgeEvent(e,t,n)))},poly2tri.sweep.FillLeftConvexEdgeEvent=function(e,t,n){poly2tri.Orient2d(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)==poly2tri.Orientation.CW?poly2tri.sweep.FillLeftConcaveEdgeEvent(e,t,n.prev):poly2tri.Orient2d(t.q,n.prev.prev.point,t.p)==poly2tri.Orientation.CW&&poly2tri.sweep.FillLeftConvexEdgeEvent(e,t,n.prev)},poly2tri.sweep.FillLeftConcaveEdgeEvent=function(e,t,n){poly2tri.sweep.Fill(e,n.prev),n.prev.point!=t.p&&poly2tri.Orient2d(t.q,n.prev.point,t.p)==poly2tri.Orientation.CW&&poly2tri.Orient2d(n.point,n.prev.point,n.prev.prev.point)==poly2tri.Orientation.CW&&poly2tri.sweep.FillLeftConcaveEdgeEvent(e,t,n)},poly2tri.sweep.FlipEdgeEvent=function(e,t,n,r,i){var s=r.NeighborAcross(i);if(s==null){alert("[BUG:FIXME] FLIP failed due to missing triangle!");return}var o=s.OppositePoint(r,i);if(poly2tri.InScanArea(i,r.PointCCW(i),r.PointCW(i),o)){poly2tri.sweep.RotateTrianglePair(r,i,s,o),e.MapTriangleToNodes(r),e.MapTriangleToNodes(s);if(i==n&&o==t)n==e.edge_event.constrained_edge.q&&t==e.edge_event.constrained_edge.p&&(r.MarkConstrainedEdge(t,n),s.MarkConstrainedEdge(t,n),poly2tri.sweep.Legalize(e,r),poly2tri.sweep.Legalize(e,s));else{var u=poly2tri.Orient2d(n,o,t);r=poly2tri.sweep.NextFlipTriangle(e,u,r,s,i,o),poly2tri.sweep.FlipEdgeEvent(e,t,n,r,i)}}else{var a=poly2tri.sweep.NextFlipPoint(t,n,s,o);poly2tri.sweep.FlipScanEdgeEvent(e,t,n,r,s,a),poly2tri.sweep.EdgeEvent(e,t,n,r,i)}},poly2tri.sweep.NextFlipTriangle=function(e,t,n,r,i,s){var o;return t==poly2tri.Orientation.CCW?(o=r.EdgeIndex(i,s),r.delaunay_edge[o]=!0,poly2tri.sweep.Legalize(e,r),r.ClearDelunayEdges(),n):(o=n.EdgeIndex(i,s),n.delaunay_edge[o]=!0,poly2tri.sweep.Legalize(e,n),n.ClearDelunayEdges(),r)},poly2tri.sweep.NextFlipPoint=function(e,t,n,r){var i=poly2tri.Orient2d(t,r,e);return i==poly2tri.Orientation.CW?n.PointCCW(r):i==poly2tri.Orientation.CCW?n.PointCW(r):(alert("[Unsupported] poly2tri.sweep.NextFlipPoint: opposing point on constrained edge!"),undefined)},poly2tri.sweep.FlipScanEdgeEvent=function(e,t,n,r,i,s){var o=i.NeighborAcross(s);if(o==null){alert("[BUG:FIXME] FLIP failed due to missing triangle");return}var u=o.OppositePoint(i,s);if(poly2tri.InScanArea(n,r.PointCCW(n),r.PointCW(n),u))poly2tri.sweep.FlipEdgeEvent(e,n,u,o,u);else{var a=NextFlipPoint(t,n,o,u);poly2tri.sweep.FlipScanEdgeEvent(e,t,n,r,o,a)}};