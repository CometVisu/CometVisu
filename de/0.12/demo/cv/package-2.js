!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.tree.FileSystem":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.container.Composite":{},"qx.ui.basic.Atom":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.upload.MDragUpload",{construct:function(){this.setDroppable(!0);this.getBounds()?this._applyStartDragListeners():this.addListenerOnce("appear",function(){this._applyStartDragListeners()},this);var e=this._getLayout();e instanceof qx.ui.layout.Grow||e instanceof qx.ui.layout.Canvas||this.addListener("resize",this.__P_52_0,this)},properties:{uploadMode:{check:"Boolean",init:!1,apply:"__P_52_1"},uploadHint:{check:"String",init:""}},statics:{onHtml5Drop:function(e){e.preventDefault();this.getFiles(e).forEach(this.uploadFile,this)},uploadFile:function(e,t){var i;cv.ui.manager.model.FileItem.isConfigFile(e.name)?i=new cv.ui.manager.model.FileItem("."):cv.ui.manager.tree.FileSystem.isAccepted(e.type)&&(i=new cv.ui.manager.model.FileItem("media"));if(i){i.set({type:"dir"});var n=new cv.ui.manager.upload.UploadMgr;if(t)n.replaceFile(e,t);else{n.setFolder(i);n.uploadFile(e)}}},hasDroppableFile:function(e){return this.getFiles(e).length>0},getFiles:function(e){var t,i,n,a=[];if(e.dataTransfer.items)for(t=0,i=e.dataTransfer.items.length;t<i;t++){var r=e.dataTransfer.items[t];if("file"===r.kind&&cv.ui.manager.tree.FileSystem.isAccepted(r.type)){n=r.getAsFile();a.push(n)}}else for(t=0,i=e.dataTransfer.files.length;t<i;t++){n=e.dataTransfer.files[t];cv.ui.manager.tree.FileSystem.isAccepted(n.type)&&a.push(n)}return a}},members:{__P_52_2:null,_boundOnStop:null,__P_52_0:function(){var e=this.getBounds();this.getChildControl("upload-overlay").setUserBounds(e.left,e.top,e.width,e.height);this.getChildControl("upload-dropbox").setUserBounds(e.left,e.top,e.width,e.height)},_createMDragUploadChildControlImpl:function(e){var t,i=this.getBounds(),n=this._getLayout();switch(e){case"upload-overlay":(t=new qx.ui.container.Composite).setZIndex(1e6);t.exclude();n instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!i||t.setUserBounds(i.left,i.top,i.width,i.height);this._add(t);this.getChildControl("upload-dropbox").bind("visibility",t,"visibility");break;case"upload-dropbox":(t=new qx.ui.container.Composite(new qx.ui.layout.Grow)).setBackgroundColor("rgba(32, 32, 32, 0.9)");t.setZIndex(1e3);var a=new qx.ui.basic.Atom(this.getUploadHint(),cv.theme.dark.Images.getIcon("upload",32));a.set({iconPosition:"top",rich:!0,center:!0});a.getChildControl("label").setWrap(!0);t.setAnonymous(!0);t.add(a);t.exclude();n instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!i||t.setUserBounds(i.left,i.top,i.width,i.height);this._add(t)}return t},_onStopDragging:function(e){e.preventDefault();this.setUploadMode(!1);document.removeEventListener("dragend",this._boundOnStop,!1)},_applyStartDragListeners:function(){this.getContentElement().getDomElement().addEventListener("dragenter",function(e){this._isDroppable?this._isDroppable(e.dataTransfer.items)&&this.setUploadMode(!0):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&this.setUploadMode(!0)}.bind(this),!1);this.getChildControl("upload-overlay").getBounds()?this._applyDragListeners():this.getChildControl("upload-overlay").addListenerOnce("appear",function(){this._applyDragListeners()},this)},_applyDragListeners:function(){var e=this.getChildControl("upload-overlay").getContentElement().getDomElement();if(e){e.addEventListener("dragexit",function(){this.setUploadMode(!1)}.bind(this),!1);e.addEventListener("dragover",function(e){e.preventDefault();var t=!1;this._isDroppable?t=this._isDroppable(e.dataTransfer.items):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&(t=!0);this.setUploadMode(t)}.bind(this),!1);this._boundOnStop=this._onStopDragging.bind(this);e.addEventListener("dragleave",this._boundOnStop,!1);e.addEventListener("dragend",function(){this.setUploadMode(!1)}.bind(this),!1);document.addEventListener("dragend",this._boundOnStop,!1);this._onDrop?e.addEventListener("drop",this._onDrop.bind(this),!1):e.addEventListener("drop",function(e){cv.ui.manager.upload.MDragUpload.onHtml5Drop(e);this._onStopDragging(e)}.bind(this),!1)}else var t=this.getChildControl("upload-overlay").addListener("visibility",function(e){if("visible"===e.getData()){this._applyDragListeners();this.getChildControl("upload-overlay").removeListenerById(t)}},this)},__P_52_1:function(e){if(!0===e){this.getChildControl("upload-dropbox").show();if(this.hasChildControl("empty-info")&&this.getChildControl("empty-info").isVisible()){this.getChildControl("empty-info").exclude();this.__P_52_2=!0}else this.__P_52_2=!1}else{this.getChildControl("upload-dropbox").exclude();!0===this.__P_52_2&&this.getChildControl("empty-info").show()}}}});cv.ui.manager.upload.MDragUpload.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.Timer":{},"cv.ui.manager.tree.VirtualFsItem":{},"qx.ui.tree.VirtualTree":{},"cv.ui.manager.model.Preferences":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.FileSystem",{extend:qx.ui.core.Widget,include:[cv.ui.manager.upload.MDragUpload],construct:function(e){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this.setRootFolder(e);qx.event.message.Bus.subscribe("cv.manager.tree.enable",this._onEnableTree,this)},statics:{MIMETYPES:{"text/xml":"xml","application/xml":"xml","text/javascript":"js","application/x-httpd-php":"php","text/css":"css","image/png":"png","image/svg+xml":"svg","text/plain":""},getMimetypeFromSuffix:function(e){return Object.keys(this.MIMETYPES).find(function(t){return this.MIMETYPES[t]===e},this)},isAccepted:function(e){return Object.prototype.hasOwnProperty.call(this.MIMETYPES,e)}},events:{changeSelection:"qx.event.type.Data"},properties:{rootFolder:{check:"cv.ui.manager.model.FileItem",apply:"_applyRootFolder"},selectedNode:{check:"cv.ui.manager.model.FileItem",apply:"_applySelectedNode",nullable:!0}},members:{__P_49_0:null,__P_49_1:500,__P_49_2:!1,_replacementManager:null,reload:function(){var e=this.getChildControl("tree"),t=e.getOpenNodes().map(function(e){return e.getFullPath()}),i=e.getModel();i.reload(function(){this.getChildControl("tree").refresh();i.setOpen(!0);t.forEach(this.openPath,this)},this)},openPath:function(e){var t=this.getChildControl("tree").getModel();if("."===e)t.setOpen(!0);else{t.setOpen(!0);t.openPath(e)}},refresh:function(){this.getChildControl("tree").refresh()},_applyRootFolder:function(e){if(e){var t=this.getChildControl("tree");t.setModel(e);e.load(function(){t.setHideRoot(!0)},this)}},_applySelectedNode:function(e){var t=this.getChildControl("tree"),i=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();i.configure(e);e&&t.setContextMenu(i)},setSelection:function(e){this.getChildControl("tree").getSelection().replace([e])},_onDblTapTreeSelection:function(){var e=this.getSelectedNode();if(e){this.__P_49_0&&this.__P_49_0.stop();"file"===e.getType()&&this.fireDataEvent("changeSelection",{node:e,mode:"dbltap"})}},_onChangeTreeSelection:function(){this.__P_49_0&&this.__P_49_0.stop();if(!0!==this.__P_49_2){var e=this.getChildControl("tree"),t=e.getSelection();if(t.length>0){var i=t.getItem(0);this.setSelectedNode(i);"file"===i.getType()?this.__P_49_0=qx.event.Timer.once(function(){this.fireDataEvent("changeSelection",{node:this.getSelectedNode(),mode:"tap"});this.__P_49_0=null},this,this.__P_49_1):this.fireDataEvent("changeSelection",{node:i,mode:"tap"})}else{e.resetContextMenu();this.resetSelectedNode()}}},_onFsItemRightClick:function(e){var t=this.getChildControl("tree"),i=e.getTarget();if(i instanceof cv.ui.manager.tree.VirtualFsItem){var n=i.getModel();if(n){this.__P_49_2=!0;t.getSelection().replace([n]);this.setSelectedNode(n);this.fireDataEvent("changeSelection",{node:n,mode:"contextmenu"});this.__P_49_2=!1}}},_onEnableTree:function(e){this.getChildControl("tree").setEnabled(e.getData())},_createChildControlImpl:function(e){var t;switch(e){case"tree":(t=new qx.ui.tree.VirtualTree(null,"name","children")).set({selectionMode:"single",minWidth:250,showTopLevelOpenCloseIcons:!0});cv.ui.manager.model.Preferences.getInstance().bind("quickPreview",t,"openMode",{converter:function(e){return e?"tap":"dbltap"}});t.setDelegate({createItem:function(){var e=new cv.ui.manager.tree.VirtualFsItem;e.addListener("dbltap",this._onDblTapTreeSelection,this);e.addListener("contextmenu",this._onFsItemRightClick,this);return e}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i);e.bindPropertyReverse("open","open",null,t,i);e.bindProperty("open","open",null,t,i);e.bindProperty("readable","enabled",null,t,i);e.bindProperty("icon","icon",null,t,i);e.bindProperty("editing","editing",null,t,i)}});t.getSelection().addListener("change",this._onChangeTreeSelection,this);this._add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.tree.FileSystem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.tree.enable",this._onEnableTree,this);this._disposeObjects("_dateFormat","_timeFormat","_replacementManager")}});cv.ui.manager.tree.FileSystem.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.data.Array":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.data.controller.List":{construct:!0},"cv.ui.manager.model.Message":{},"cv.ui.manager.snackbar.Message":{},"qx.ui.form.List":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Controller",{extend:qx.ui.core.Widget,type:"singleton",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox(8));this.initMessages(new qx.data.Array);qx.event.message.Bus.subscribe("cv.manager.msg.snackbar",this._onMessage,this);this._listController=new qx.data.controller.List(this.getMessages(),this.getChildControl("list"));this._initDelegate()},statics:{info:function(e){var t=new cv.ui.manager.model.Message;t.set({title:e});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)},error:function(e){var t=new cv.ui.manager.model.Message;"object"===_typeof(e)&&Object.prototype.hasOwnProperty.call(e,"statusText")&&(e=e.statusText);t.set({title:e,type:"error",sticky:!0});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)}},properties:{appearance:{refine:!0,init:"cv-snackbar"},messages:{check:"qx.data.Array",deferredInit:!0,event:"changeMessages"}},members:{_listController:null,_onMessage:function(e){var t=e.getData();if(t instanceof cv.ui.manager.model.Message){this.getMessages().push(t);this.show()}},_onCloseMessage:function(e){var t=e.getData();this.getMessages().remove(t);0===this.getMessages().length&&this.exclude()},_initDelegate:function(){this._listController.setDelegate({createItem:function(){var e=new cv.ui.manager.snackbar.Message;e.addListener("close",this._onCloseMessage,this);return e}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i)}})},_createChildControlImpl:function(e){var t;switch(e){case"list":t=new qx.ui.form.List;this._add(t,{flex:1})}return t||cv.ui.manager.snackbar.Controller.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.msg.snackbar",this._onMessage,this);this._disposeObjects("_listController")}});cv.ui.manager.snackbar.Controller.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.control.MFileEventHandler",{construct:function(){this._disableFileEvents||qx.event.message.Bus.subscribe("cv.manager.file",this._handleFileEvent,this)},members:{_disableFileEvents:!1},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.file",this._handleFileEvent,this)}});cv.ui.manager.control.MFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.control.IFileEventHandler",{members:{_handleFileEvent:function(e){}}});cv.ui.manager.control.IFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.marshal.MEventBubbling":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"qx.data.Array":{construct:!0},"qx.locale.Manager":{construct:!0},"cv.theme.dark.Images":{},"cv.ui.manager.snackbar.Controller":{},"cv.io.rest.Client":{},"qx.util.LibraryManager":{},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.FileItem",{extend:qx.core.Object,include:[qx.data.marshal.MEventBubbling,cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.control.IFileEventHandler],construct:function(e,t,i,n){qx.core.Object.constructor.call(this);this.initChildren(new qx.data.Array);n&&this.setFakeChildren(n);if(t){t.endsWith("/")||(t+="/");this.__P_41_0=t}e&&this.setName(e);i&&this.setParent(i);qx.locale.Manager.getInstance().addListener("changeLocale",this._onChangeLocale,this)},statics:{ROOT:null,_fakeIconFile:null,_hiddenConfigFakeFile:null,_acceptedFiles:{".":"*.xml",media:"*.js,*.jpg,*.gif,*.png,*.conf,*.svg,*.md,*.rst,*,css,*.txt"},isConfigFile:function(e){return/visu_config.*\.xml/.test(e)},getConfigName:function(e){var t=/visu_config_?([^.]+)\.xml/.exec(e);return t?t[1]:null},getIconFile:function(){this._fakeIconFile||(this._fakeIconFile=new cv.ui.manager.model.FileItem("CometVisu-Icons","",cv.ui.manager.model.FileItem.ROOT).set({type:"file",overrideIcon:!0,writeable:!1,readable:!0,open:!0,loaded:!0,hasChildren:!1,fake:!0,icon:cv.theme.dark.Images.getIcon("icons",18)}));return this._fakeIconFile},getHiddenConfigFile:function(){this._hiddenConfigFakeFile||(this._hiddenConfigFakeFile=new cv.ui.manager.model.FileItem("hidden.php","",cv.ui.manager.model.FileItem.ROOT).set({hasChildren:!1,loaded:!0,readable:!0,writeable:!0,overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),type:"file",fake:!0,displayName:qx.locale.Manager.tr("Hidden configuration")}));return this._hiddenConfigFakeFile},getAcceptedFiles:function(e){return this._acceptedFiles[e.getFullPath()]}},properties:{open:{check:"Boolean",event:"changeOpen",apply:"_onOpen",init:!1},loaded:{check:"Boolean",event:"changeLoaded",init:!1},loading:{check:"Boolean",event:"changeLoading",init:!1},parent:{event:"changeParent",init:null},children:{check:"qx.data.Array",event:"changeChildren",apply:"_applyEventPropagation",deferredInit:!0},fakeChildren:{check:"Array",nullable:!0},displayName:{check:"String",init:"",event:"changeDisplayName"},fake:{check:"Boolean",init:!1,event:"changeFake"},overrideIcon:{check:"Boolean",init:!1},icon:{check:"String",nullable:!0,event:"changeIcon"},hash:{check:"Number",nullable:!0},editing:{check:"Boolean",init:!1,event:"changeEditing"},special:{check:"String",nullable:!0,event:"changeSpecial"},temporary:{check:"Boolean",init:!1,event:"changeTemporary"},valid:{check:"Boolean",init:!0,event:"changeValid"},hasWarnings:{check:"Boolean",init:!1,event:"changeHasWarnings"},content:{check:"String",nullable:!0},modified:{check:"Boolean",init:!1,event:"changeModified"},hasChildren:{check:"Boolean",event:"changeHasChildren",apply:"_applyHasChildren",init:!1},name:{check:"String",event:"changeName",init:"",apply:"_applyName"},type:{check:["dir","file"],transform:"_toLowerCase",nullable:!0,apply:"_maintainIcon"},parentFolder:{check:"String",nullable:!0},readable:{check:"Boolean",init:!1,event:"changeReadable"},writeable:{check:"Boolean",init:!1,event:"changeWriteable"},mounted:{check:"Boolean",init:!1,event:"changeMounted"},trash:{check:"Boolean",init:!1,event:"changeTrash"},inTrash:{check:"Boolean",init:!1,event:"changeInTrash"}},members:{__P_41_0:null,__P_41_1:null,__P_41_2:null,_toLowerCase:function(e){return e.toLowerCase()},isRelated:function(e){return this.getFullPath()===e},_handleFileEvent:function(e){if(!this.isFake()){var t=e.getData();switch(t.action){case"moved":this.reload();break;case"added":"dir"===this.getType()&&t.path.startsWith(this.getFullPath())&&this.reload();break;case"deleted":if(t.path===this.getFullPath())this.dispose();else if("dir"===this.getType()&&t.path.startsWith(this.getFullPath())){var i=this.getChildren();i.some(function(e){if(e.getFullPath()===t.path){i.remove(e);this.removeRelatedBindings(e);return!0}return!1},this)}}}},_applyName:function(e,t){this.__P_41_1=null;!e||null!==this.getDisplayName()&&this.getDisplayName()!==t||this.setDisplayName(e)},getPath:function(){if(!this.__P_41_0){var e=this.getParentFolder();e?e.endsWith("/")||(e+="/"):e="";this.__P_41_0=e}return this.__P_41_0},_onOpen:function(e){!this.isLoaded()&&e&&this.load();this._maintainIcon()},_maintainIcon:function(){this.isOverrideIcon()||("file"===this.getType()?this.setIcon(cv.theme.dark.Images.getIcon("file",18)):this.isTrash()?this.setIcon(cv.theme.dark.Images.getIcon("trash",18)):this.isOpen()?this.setIcon(cv.theme.dark.Images.getIcon("folder-open",18)):this.isMounted()?this.setIcon(cv.theme.dark.Images.getIcon("mounted-folder",18)):this.setIcon(cv.theme.dark.Images.getIcon("folder",18)))},isConfigFile:function(){return cv.ui.manager.model.FileItem.isConfigFile(this.getName())},_applyHasChildren:function(e){!0===e&&0===this.getChildren().length&&this.getChildren().push(new cv.ui.manager.model.FileItem(""))},unload:function(){this.setLoaded(!1);this.setLoading(!1);this.getChildren().removeAll().forEach(function(e){this.removeRelatedBindings(e)},this)},reload:function(e,t){this.unload();return this.load(e,t)},addChild:function(e){var t=e.getParent();if(t!==this){t.getChildren().remove(e);t.removeRelatedBindings(e)}e.setParent(this);"dir"===e.getType()&&e.isMounted()||this.bind("mounted",e,"mounted");this.getChildren().push(e)},_onGet:function(e){var t=this.getChildren();t.removeAll().forEach(function(e){this.removeRelatedBindings(e)},this);e&&e.forEach(function(e){var i=new cv.ui.manager.model.FileItem(null,null,this);if(Object.prototype.hasOwnProperty.call(e,"children")){var n=e.children;delete e.children;if(n.length>0){i.getChildren().replace(n);i.setLoaded(!0)}}i.set(e);t.push(i)},this);this.getFakeChildren()&&t.append(this.getFakeChildren());this.sortElements();this.setLoaded(!0);this.__P_41_2&&this.__P_41_2();this.setLoading(!1)},_onError:function(e){this.error(e);cv.ui.manager.snackbar.Controller.error(e);this.getChildren().removeAll().forEach(function(e){this.removeRelatedBindings(e)},this);this.setLoaded(!0);this.__P_41_2&&this.__P_41_2();this.setLoading(!1)},load:function(e,t){if("file"!==this.getType())if(this.isFake()){this.setLoaded(!0);this.getFakeChildren()&&this.getChildren().append(this.getFakeChildren())}else if(this.isLoading())e&&this.addListenerOnce("changeLoading",e,t);else if(this.isLoaded())e&&e.apply(t);else{this.setLoading(!0);e&&(this.__P_41_2=e.bind(t||this));cv.io.rest.Client.getFsClient().readSync({path:this.getFullPath()},function(e,t){e?this._onError(e):this._onGet(t)},this)}else this.setLoaded(!0)},getFullPath:function(){this.__P_41_1||(this.__P_41_1=this.getPath()+this.getName());return this.__P_41_1},getBusTopic:function(){return"cv.manager.fs."+this.getFullPath().replace(/\//g,".")},getUri:function(){return"cv://"+this.getFullPath()},getServerPath:function(){return this.isMounted()?qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/"+this.getFullPath():qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/config/"+this.getFullPath()},sortElements:function(){this.getChildren().sort(function(e,t){return"dir"===e.getType()?"dir"===t.getType()?e.isTrash()?1:t.isTrash()?-1:e.getName().localeCompare(t.getName()):-1:"dir"===t.getType()?1:e.getName().localeCompare(t.getName())})},openPath:function(e){var t=qx.lang.Type.isArray(e)?e:e.split("/"),i=t.shift();this.getChildren().some(function(e){if(e.getName()===i){e.load(function(){e.setOpen(!0);t.length>0&&e.openPath(t)},this);return!0}return!1},this)},_onChangeLocale:function(){var e=this.getDisplayName();e&&e.translate&&this.setDisplayName(e.translate())}},destruct:function(){this.__P_41_1=null}});cv.ui.manager.model.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"com.zenesis.qx.upload.UploadMgr":{construct:!0,require:!0},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"qxl.dialog.Dialog":{},"qx.lang.Json":{},"qx.event.message.Bus":{},"com.zenesis.qx.upload.File":{},"com.zenesis.qx.upload.UploadButton":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.upload.UploadMgr",{extend:com.zenesis.qx.upload.UploadMgr,construct:function(e,t){com.zenesis.qx.upload.UploadMgr.constructor.call(this,e,t);this._init()},statics:{LAST_ID:0},properties:{multiple:{refine:!0,init:!1},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_updateUploadUrl"},filename:{check:"String",nullable:!0},force:{check:"Boolean",init:!1}},members:{_updateUploadUrl:function(){var e=this.getFolder(),t=e?e.getFullPath():".",i=cv.io.rest.Client.getBaseUrl()+"/fs?type=file&path="+t;this.setUploadUrl(i)},_init:function(){this.addListener("addFile",function(e){var t=e.getData(),i=this.getFilename();i&&t.setParam("filename",i);this.isForce()&&t.setParam("force",!0);var n=t.addListener("changeProgress",function(e){var t=e.getTarget(),i=e.getData();this.debug("Upload "+t.getFilename()+": "+i+" / "+t.getSize()+" - "+Math.round(i/t.getSize()*100)+"%")},this),a=t.addListener("changeState",function(e){var t=e.getData(),i=e.getTarget();if("uploading"===t)this.debug(i.getFilename()+" (Uploading...)");else if("uploaded"===t){this.debug(i.getFilename()+" (Complete)");if(200!==i.getStatus())switch(i.getStatus()){case 406:this.isForce()?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Replacing the file failed.")):qxl.dialog.Dialog.confirm(qx.locale.Manager.tr("This file already exists, do you want to replace it?"),function(e){e&&this.forceUpload(i)},this,qx.locale.Manager.tr("File already exists"));break;case 403:cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Uploading this file is not allowed here."));break;default:var r=i.getResponse();try{r=qx.lang.Json.parse(r).message}catch(e){}this.error(r);cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("File upload stopped with an error: %1",r))}else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("File has been uploaded"));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"uploaded",path:this.getFolder().getFullPath()+"/"+i.getFilename()})}}else"cancelled"===t&&this.debug(i.getFilename()+" (Cancelled)");if("uploaded"===t||"cancelled"===t){i.removeListenerById(n);i.removeListenerById(a)}},this)},this)},_getUniqueFileId:function(){return++cv.ui.manager.upload.UploadMgr.LAST_ID},forceUpload:function(e){this.setForce(!0);var t=new com.zenesis.qx.upload.File(e.getBrowserObject(),e.getFilename(),e.getId());t.set({size:e.getSize(),uploadWidget:e.getUploadWidget()});t.setParam("force",!0);this.getUploadHandler()._addFile(t);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},uploadFile:function(e){var t="upload-"+this._getUniqueFileId(),i=void 0!==e.name?e.name:e.fileName,n=new com.zenesis.qx.upload.File(e,i,t),a=void 0!==e.size?e.size:e.fileSize;n.setSize(a);this.isForce()&&n.setParam("force",!0);n.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(n);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},replaceFile:function(e,t){this.setFolder(t.getParent());var i="upload-"+this._getUniqueFileId(),n=t.getName(),a=new com.zenesis.qx.upload.File(e,n,i);a.setParam("force",!0);a.setParam("filename",n);var r=void 0!==e.size?e.size:e.fileSize;a.setSize(r);a.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(a);this.getAutoUpload()&&this.getUploadHandler().beginUploads()}}});cv.ui.manager.upload.UploadMgr.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menu.Menu":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.util.format.DateFormat":{construct:!0},"qx.locale.Date":{construct:!0},"cv.ui.manager.model.BackupFolder":{},"qx.ui.menu.Separator":{},"qx.ui.menu.Button":{},"cv.ui.manager.control.FileHandlerRegistry":{},"qx.event.message.Bus":{},"cv.ui.manager.model.CompareFiles":{},"cv.ui.manager.dialog.Prompt":{},"cv.ui.manager.control.FileController":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"cv.ui.manager.upload.UploadMgr":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.FileItem",{extend:qx.ui.menu.Menu,construct:function(e,t){qx.ui.menu.Menu.constructor.call(this);this._noCompare=!0===t;this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this._init();this._dateFormat=new qx.util.format.DateFormat(qx.locale.Date.getDateFormat("medium"));this._timeFormat=new qx.util.format.DateFormat(qx.locale.Date.getTimeFormat("medium"));e&&this.configure(e);this.addListener("appear",function(){this.setActive(!0)});this.addListener("disappear",function(){this.setActive(!1)})},properties:{appearance:{refine:!0,init:"cv-file-contextmenu"},active:{check:"Boolean",init:!1}},members:{_commandGroup:null,_selectedNode:null,_dateFormat:null,_timeFormat:null,_renameDialog:null,_noCompare:!1,configure:function(e){this._selectedNode=e;if(e){var t="dir"===e.getType(),i=t?e:e.getParent(),n=!1;(i&&i.getFullPath().startsWith("backup")||e.getFullPath().startsWith("backup"))&&(n=!0);if(t){this.getChildControl("new-file-button").set({enabled:!(!i||n)&&i.isWriteable(),visibility:"visible"});this.getChildControl("new-folder-button").set({enabled:!(!i||n)&&i.isWriteable(),visibility:"visible"})}else{this.getChildControl("new-file-button").exclude();this.getChildControl("new-folder-button").exclude()}this.getChildControl("clone-file-button").setVisibility(e.isConfigFile()&&!n?"visible":"excluded");this.getChildControl("delete-button").setLabel(e.isTrash()?this.tr("Clear"):this.tr("Delete"));if(!this._noCompare){var a=this.getChildControl("compare-menu");a.removeAll();if(n)this.getChildControl("compare-with-button").exclude();else{this.getChildControl("compare-with-button").show();var r=cv.ui.manager.model.BackupFolder.getInstance().getBackupFiles(e);this.getChildControl("compare-with-button").setEnabled(r.length>0);r.sort(function(e,t){return t.date.getTime()-e.date.getTime()});var o=null;r.forEach(function(e){var t=this._dateFormat.format(e.date);if(o!==t){null!==o&&a.add(new qx.ui.menu.Separator);var i=new qx.ui.menu.Button(t);i.setEnabled(!1);a.add(i);o=t}var n=new qx.ui.menu.Button(this.tr("Backup from %1",this._timeFormat.format(e.date)));n.setUserData("file",e.file);n.addListener("execute",this._onCompareWith,this);a.add(n)},this)}}var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e),l=this.getChildControl("open-with-menu");l.removeAll();if(n)this.getChildControl("open-with-button").exclude();else{this.getChildControl("open-with-button").show();var c=cv.ui.manager.control.FileHandlerRegistry.getInstance().getAllFileHandlers(e);this.getChildControl("open-with-button").setEnabled(c.length>1);c.sort(function(e,t){return e.Clazz.constructor.TITLE.toString().localeCompare(t.Clazz.constructor.TITLE.toString())});c.forEach(function(e){var t=new qx.ui.menu.Button(e.Clazz.constructor.TITLE,e.Clazz.constructor.ICON);t.setAppearance("open-with-button");s.Clazz.classname===e.Clazz.classname&&t.addState("default");t.setUserData("handlerId",e.Clazz.classname);t.addListener("execute",this._onOpenWith,this);l.add(t)},this)}this.getChildControl("validate-config-button").setVisibility(!e.isConfigFile()||e.isMounted()||n?"excluded":"visible");if(t||n)this.getChildControl("replace-button").exclude();else{this.getChildControl("replace-button").show();this._replacementManager.setFilename(e.getName());this._replacementManager.setFolder(e.getParent())}["delete-button","replace-button","rename-button"].forEach(function(t){this.getChildControl(t).setEnabled(!e.isFake()&&e.isWriteable()&&(!n||"delete-button"===t))},this);this.getChildControl("download-button").setEnabled(!e.isFake()&&"file"===e.getType());this.getChildControl("restore-button").setVisibility(e.isInTrash()||n?"visible":"excluded")}else{this.getChildControl("delete-button").set({label:this.tr("Delete"),enabled:!1});this.getChildControl("replace-button").exclude();this.getChildControl("download-button").setEnabled(!1);this.getChildControl("restore-button").exclude()}},_init:function(){this._noNew||this.add(this.getChildControl("new-file-button"));this.add(this.getChildControl("clone-file-button"));this._noNew||this.add(this.getChildControl("new-folder-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("open-button"));this.add(this.getChildControl("open-with-button"));this._noCompare||this.add(this.getChildControl("compare-with-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("rename-button"));this.add(this.getChildControl("delete-button"));this.add(this.getChildControl("restore-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("download-button"));var e=new qx.ui.menu.Separator,t=this.getChildControl("replace-button");this.add(e);this.add(t);t.bind("visibility",e,"visibility");e=new qx.ui.menu.Separator;(t=this.getChildControl("validate-config-button")).bind("visibility",e,"visibility");this.add(e);this.add(t)},_onCompareWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("file");qx.event.message.Bus.dispatchByName("cv.manager.compareFiles",new cv.ui.manager.model.CompareFiles(t,this._selectedNode))}},_onOpenWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this._selectedNode,handler:t})}},_onRename:function(){if(this._selectedNode&&this.isActive()){this._renameDialog||(this._renameDialog=new cv.ui.manager.dialog.Prompt({message:this.tr("New name"),callback:function(e){e&&e!==this._selectedNode.getName()&&cv.ui.manager.control.FileController.getInstance().rename(this._selectedNode,e)},context:this,value:this._selectedNode.getName(),caption:this.tr("Rename file"),filter:/[\w\d_\-\.\s]/}));this._renameDialog.show()}},_onDownload:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().download(this._selectedNode)},_onRestore:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().restore(this._selectedNode)},_onValidate:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().validate(this._selectedNode)},_onClone:function(){this._selectedNode&&this.isActive()&&qx.event.message.Bus.dispatchByName("cv.manager.action.clone",{file:this._selectedNode})},_createChildControlImpl:function(e){var t;switch(e){case"new-file-button":(t=new qx.ui.menu.Button(this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18))).addListener("execute",function(){this._selectedNode.isConfigFile()?qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",this._selectedNode.getParent()):qx.event.message.Bus.dispatchByName("cv.manager.action.new-file","dir"===this._selectedNode.getType()?this._selectedNode:this._selectedNode.getParent())},this);break;case"clone-file-button":(t=new qx.ui.menu.Button(this.tr("Clone file"),cv.theme.dark.Images.getIcon("clone-file",18))).exclude();t.addListener("execute",this._onClone,this);break;case"new-folder-button":(t=new qx.ui.menu.Button(this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder","dir"===this._selectedNode.getType()?this._selectedNode:this._selectedNode.getParent())},this);break;case"rename-button":(t=new qx.ui.menu.Button(this.tr("Rename"),cv.theme.dark.Images.getIcon("rename",18))).addListener("execute",this._onRename,this);break;case"delete-button":(t=new qx.ui.menu.Button(this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.delete",this._selectedNode)},this);break;case"download-button":(t=new qx.ui.menu.Button(this.tr("Download"),cv.theme.dark.Images.getIcon("download",18))).addListener("execute",this._onDownload,this);break;case"open-button":(t=new qx.ui.menu.Button(this.tr("Open"),cv.theme.dark.Images.getIcon("open",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.open",this._selectedNode)},this);break;case"restore-button":(t=new qx.ui.menu.Button(this.tr("Restore"),cv.theme.dark.Images.getIcon("trash",18))).exclude();t.addListener("execute",this._onRestore,this);break;case"validate-config-button":(t=new qx.ui.menu.Button(this.tr("Validate"),cv.theme.dark.Images.getIcon("validate",18))).exclude();t.addListener("execute",this._onValidate,this);break;case"replace-button":(t=new com.zenesis.qx.upload.UploadMenuButton(this.tr("Replace"),cv.theme.dark.Images.getIcon("upload",18))).exclude();this._replacementManager=new cv.ui.manager.upload.UploadMgr;this._replacementManager.setForce(!0);this._replacementManager.addWidget(t);break;case"compare-menu":t=new qx.ui.menu.Menu;break;case"compare-with-button":t=new qx.ui.menu.Button(this.tr("Compare with..."),cv.theme.dark.Images.getIcon("compare",18),null,this.getChildControl("compare-menu"));break;case"open-with-button":t=new qx.ui.menu.Button(this.tr("Open with..."),cv.theme.dark.Images.getIcon("open-with",18),null,this.getChildControl("open-with-menu"));break;case"open-with-menu":t=new qx.ui.menu.Menu}return t||cv.ui.manager.contextmenu.FileItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._commandGroup=null;this._renameDialog=null;this._disposeObjects("_dateFormat","_timeFormat")}});cv.ui.manager.contextmenu.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.contextmenu.FileItem":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.GlobalFileItem",{extend:cv.ui.manager.contextmenu.FileItem,type:"singleton"});cv.ui.manager.contextmenu.GlobalFileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.tree.VirtualTreeItem":{require:!0},"qx.event.message.Bus":{},"cv.ui.manager.control.FileController":{},"qx.ui.form.TextField":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.VirtualFsItem",{extend:qx.ui.tree.VirtualTreeItem,properties:{appearance:{refine:!0,init:"fs-tree-item"},editing:{check:"Boolean",init:!1,apply:"_applyEditing"},name:{check:"String",init:"",event:"changeName"},temporary:{check:"Boolean",init:!1,apply:"_applyTemporary"},status:{check:["valid","error"],nullable:!0,apply:"_applyStatus"}},members:{_applyEditing:function(e,t){if(e!==t){var i=this.getChildControl("edit");if(e){i.setValue(this.getLabel());i.show();qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!1)}else{qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!0);i.exclude();i.getValue()!==this.getName()&&cv.ui.manager.control.FileController.getInstance().rename(this.getModel(),i.getValue())}}},_applyTemporary:function(e){e?this.addState("temporary"):this.removeState("temporary")},_applyModel:function(e,t){cv.ui.manager.tree.VirtualFsItem.prototype._applyModel.base.call(this,e,t);t&&t.removeRelatedBindings(this);if(e){if(e.isTrash())this.setLabel(this.tr("Trash"));else{e.bind("name",this,"label");e.bind("valid",this,"status",{converter:function(e){return!0===e?"valid":"error"}})}e.bind("temporary",this,"temporary");if("dir"===e.getType()){this.setDroppable(!0);this.addListener("drop",this._onDrop,this)}else{this.setDroppable(!1);this.removeListener("drop",this._onDrop,this)}}},_applyStatus:function(e){var t=this.getChildControl("icon");if(e)switch(e){case"valid":t.removeState("error");break;case"error":t.addState("error")}},_onDrop:function(e){this.info(e.getRelatedTarget())},__P_51_0:function(){this.getChildControl("edit").setValue(this.getName());this.setEditing(!1)},_onKeypress:function(e){"Enter"===e.getKeyIdentifier()?this.setEditing(!1):"Esc"===e.getKeyIdentifier()&&this.__P_51_0()},_createChildControlImpl:function(e){var t;switch(e){case"edit":(t=new qx.ui.form.TextField).addListener("keypress",this._onKeypress,this);t.exclude();t.addListener("changeVisibility",function(e){"visible"===e.getData()?this.getChildControl("label").exclude():this.getChildControl("label").show()},this);t.addListener("blur",function(){this.setEditing(!1)},this);this._add(t)}return t||cv.ui.manager.tree.VirtualFsItem.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.tree.VirtualFsItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.bom.Storage":{},"qx.util.Serializer":{},"cv.report.Record":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Preferences",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._restorePreferences()},properties:{defaultConfigEditor:{check:["source","xml"],init:"source",event:"changeDefaultConfigEditor",apply:"_savePreferences"},quickPreview:{check:"Boolean",init:!1,event:"changeQuickPreview",apply:"_savePreferences"},expertMode:{check:"Boolean",init:!1,event:"changeExpertMode",apply:"_savePreferences"},startViewMode:{check:["list","preview"],init:"preview",event:"changeStartViewMode",apply:"_savePreferences"}},members:{_skipSaving:!1,_savePreferences:function(){if(!this._skipSaving){var e=qx.bom.Storage.getLocal(),t=qx.util.Serializer.toNativeObject(this);e.setItem("preferences",t);cv.report.Record.record(cv.report.Record.STORAGE,"preferences",t)}},_restorePreferences:function(){var e=qx.bom.Storage.getLocal();this.set(e.getItem("preferences"))},setPreferences:function(e,t){t&&(this._skipSaving=!0);this.set(e);this._skipSaving=!1}}});cv.ui.manager.model.Preferences.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Message",{extend:qx.core.Object,properties:{title:{check:"String",init:"",event:"changeTitle"},content:{check:"String",init:"",event:"changeContent"},type:{check:["alert","hint","warning","error"],nullable:!0,event:"changeType"},sticky:{check:"Boolean",init:!1,event:"changeSticky"}}});cv.ui.manager.model.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.event.Timer":{},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Message",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this.addListener("appear",this._onAppear,this)},events:{close:"qx.event.type.Data"},properties:{appearance:{refine:!0,init:"cv-snackbar-msg"},model:{check:"cv.ui.manager.model.Message",nullable:!0,apply:"_applyModel"},timeout:{check:"Number",init:5e3,apply:"_applyTimeout"},type:{check:["alert","hint","warning","error"],nullable:!0,apply:"_applyType"}},members:{_timer:null,_applyModel:function(e,t){if(t){t.removeRelatedBindings(this);t.removeRelatedBindings(this.getChildControl("content"))}if(e){e.bind("title",this.getChildControl("content"),"value");e.bind("type",this,"type");e.bind("sticky",this,"timeout",{converter:function(e){return e?0:5e3}});this.getChildControl("close")}},_applyType:function(e){e?this.setDecorator(this.getAppearance()+"-"+e):this.setDecorator(this.getAppearance())},_applyTimeout:function(e){if(this._timer){this._timer.stop();0===e&&(this._timer=null)}},_onAppear:function(){var e=this.getTimeout();this._timer&&this._timer.stop();e>0&&(this._timer=qx.event.Timer.once(this.close,this,e))},close:function(){this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":t=new qx.ui.basic.Image;this._addAt(t,0);break;case"content":(t=new qx.ui.basic.Label).set({rich:!0,wrap:!0});this._addAt(t,1,{flex:1});break;case"close":(t=new qx.ui.basic.Image(cv.theme.dark.Images.getIcon("close",15))).addListener("tap",this.close,this);this._addAt(t,2)}return t||cv.ui.manager.snackbar.Message.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_timer")}});cv.ui.manager.snackbar.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.FileItem":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.BackupFolder",{extend:cv.ui.manager.model.FileItem,type:"singleton",construct:function(){cv.ui.manager.model.FileItem.constructor.call(this,"backup");this.load();qx.event.message.Bus.subscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)},members:{_onFilesSystemMessage:function(e){if(/^cv\.manager\.fs\.visu_config.*\.xml$/.test(e.getName())){var t=e.getData();["contentChanged","fsContentChanged"].includes(t.type)&&this.reload()}},getBackupFiles:function(e){var t=[];if("file"===e.getType()){var i=e.getFullPath().split("/");i.pop();var n=i.join("/"),a=e.getName().split("."),r=a.pop(),o=a.join("."),s=new RegExp(n+o+"-([\\d]{14})\\."+r);this.getChildren().forEach(function(e){var i=s.exec(e.getFullPath().replace("backup/",""));i&&t.push({date:new Date(parseInt(i[1].substring(0,4)),parseInt(i[1].substring(4,6))-1,parseInt(i[1].substring(6,8)),parseInt(i[1].substring(8,10)),parseInt(i[1].substring(10,12)),parseInt(i[1].substring(12,14))),file:e})},this)}return t}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)}});cv.ui.manager.model.BackupFolder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.viewer.Image":{construct:!0},"cv.ui.manager.viewer.Config":{construct:!0},"cv.ui.manager.viewer.Icons":{construct:!0},"cv.ui.manager.viewer.Folder":{construct:!0},"cv.ui.manager.Start":{construct:!0},"cv.ui.manager.editor.Source":{construct:!0},"cv.ui.manager.editor.Tree":{construct:!0},"cv.ui.manager.model.CompareFiles":{construct:!0},"cv.ui.manager.editor.Diff":{construct:!0},"cv.ui.manager.editor.Config":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileHandlerRegistry",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_30_0={};this.__P_30_1=[];this.registerFileHandler(new RegExp("\\.("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i"),cv.ui.manager.viewer.Image,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Config.SUPPORTED_FILES,cv.ui.manager.viewer.Config,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Icons.SUPPORTED_FILES,cv.ui.manager.viewer.Icons,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Folder.SUPPORTED_FILES,cv.ui.manager.viewer.Folder,{type:"view"});this.registerFileHandler(null,cv.ui.manager.Start,{type:"view"});this.registerFileHandler(cv.ui.manager.editor.Source.SUPPORTED_FILES,cv.ui.manager.editor.Source,{type:"edit"});this.registerFileHandler(cv.ui.manager.editor.Tree.SUPPORTED_FILES,cv.ui.manager.editor.Tree,{preview:!1,type:"edit"});this.registerFileHandler(cv.ui.manager.model.CompareFiles,cv.ui.manager.editor.Diff,{type:"view"});this.registerFileHandler("hidden.php",cv.ui.manager.editor.Config,{type:"edit"});cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this);this._onChangesDefaultConfigEditor()},members:{__P_30_0:null,__P_30_1:null,registerFileHandler:function(e,t,i){var n=Object.assign({Clazz:t,instance:null},i||{});if(qx.Class.isClass(e)){n.instanceOf=e;n.selectorId="instanceOf:"+e.classname;n.priority=0}else if(qx.lang.Type.isRegExp(e)){n.regex=e;n.selectorId="regex:"+e.toString();n.priority=4}else if(qx.lang.Type.isFunction(e)){n.selectorId="function:"+e.name;n.priority=3;n.function=e}else if(qx.lang.Type.isString(e))if(e.includes("/")){n.fullPath=e;n.selectorId="fullPath:"+e;n.priority=1}else{n.fileName=e;n.selectorId="fileName:"+e;n.priority=2}else{n.selectorId="none";n.priority=10}this.__P_30_0[t.classname]=n},getFileHandler:function(e,t){var i=[];if(!(e instanceof cv.ui.manager.model.CompareFiles)){var n;Object.keys(this.__P_30_1).some(function(i){if(this.__P_30_1[i].regex.test(e.getFullPath())&&(!e.isTemporary()||!this.__P_30_1[i].noTemporaryFiles)&&(e.isWriteable()||!this.__P_30_1[i].noReadOnlyFiles))if(t){var a=this.getFileHandlerById(this.__P_30_1[i].clazz.classname);a.type===t&&(n=a)}else n=this.getFileHandlerById(this.__P_30_1[i].clazz.classname);return!!n},this);if(n)return n}Object.keys(this.__P_30_0).forEach(function(n){var a=this.__P_30_0[n];!this.__P_30_2(a,e)||t&&a.type!==t||i.push(a)},this);if(0===i.length)return e.isFake()||1!==e.getDisplayName().split(".").length?null:this.getFileHandlerById("cv.ui.manager.editor.Source");if(1===i.length)return i[0];i.sort(function(e,t){return e.priority-t.priority});return i[0]},getFileHandlerById:function(e){return this.__P_30_0[e]},hasFileHandler:function(e,t){return Object.keys(this.__P_30_0).some(function(i){var n=this.__P_30_0[i];return this.__P_30_2(n,e)&&(!t||n.type===t)},this)},setDefault:function(e,t,i,n){this.__P_30_1[e.toString()]={regex:e,clazz:t,noTemporaryFiles:i,noReadOnlyFiles:n}},_onChangesDefaultConfigEditor:function(){switch(cv.ui.manager.model.Preferences.getInstance().getDefaultConfigEditor()){case"source":this.setDefault(cv.ui.manager.editor.Source.DEFAULT_FOR,cv.ui.manager.editor.Source);break;case"xml":this.setDefault(cv.ui.manager.editor.Tree.SUPPORTED_FILES,cv.ui.manager.editor.Tree)}},__P_30_2:function(e,t){return(!0!==e.noTemporaryFiles||!t.isTemporary())&&(!(!0===e.noReadOnlyFiles&&!t.isWriteable())&&(!(!e.fileName||t.getName()!==e.fileName)||(!(!e.fullPath||t.getFullPath()!==e.fullPath)||(!(!e.regex||!e.regex.test(t.getFullPath().toLowerCase()))||(!!(e.instanceOf&&t instanceof e.instanceOf)||!(!e.function||!e.function(t)))))))},getAllFileHandlers:function(e,t){return Object.keys(this.__P_30_0).filter(function(i){return this.__P_30_2(this.__P_30_0[i],e)&&(!t||this.__P_30_0[i].type===t)},this).map(function(e){return this.__P_30_0[e]},this)}},destruct:function(){Object.keys(this.__P_30_0).forEach(function(e){if(this.__P_30_0[e].instance){this.__P_30_0[e].instance.dispose();this.__P_30_0[e].instance=null}},this);cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this)}});cv.ui.manager.control.FileHandlerRegistry.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.CompareFiles",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setOriginalFile(e);this.setModifiedFile(t)},properties:{originalFile:{check:"cv.ui.manager.model.FileItem",event:"changeOriginal"},modifiedFile:{check:"cv.ui.manager.model.FileItem",event:"changeModifiedFile",apply:"_applyModifiedFile"},permanent:{check:"Boolean",init:!0},name:{check:"String",init:"",event:"changeName"},type:{check:"String",init:"file"},modified:{check:"Boolean",init:!1,event:"changeModified"}},members:{isRelated:function(e){return this.getOriginalFile().getFullPath()===e||this.getModifiedFile().getFullPath()===e},isConfigFile:function(){return this.getModifiedFile().isConfigFile()},getFullPath:function(){return this.getOriginalFile().getFullPath()},_applyModifiedFile:function(){this.setName(qx.locale.Manager.tr("Diff: %1",this.getModifiedFile().getName()))},getParent:function(){return this.getModifiedFile().getParent()},isWriteable:function(){return this.getModifiedFile().isWriteable()},isTrash:function(){return this.getModifiedFile().isTrash()},isInTrash:function(){return this.getModifiedFile().isInTrash()},isFake:function(){return this.getModifiedFile().isFake()},isTemporary:function(){return this.getModifiedFile().isTemporary()||this.getOriginalFile().isTemporary()},isMounted:function(){return this.getModifiedFile().isMounted()||this.getOriginalFile().isMounted()},getUri:function(){return"cv://"+this.getOriginalFile().getFullPath()+"+"+this.getModifiedFile().getFullPath()}}});cv.ui.manager.model.CompareFiles.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Prompt":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.Prompt",{extend:qxl.dialog.Prompt,members:{_createWidgetContent:function(){cv.ui.manager.dialog.Prompt.prototype._createWidgetContent.base.call(this);this._textField.setLiveUpdate(!0)}}});cv.ui.manager.dialog.Prompt.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"qx.event.message.Bus":{},"qxl.dialog.Dialog":{},"cv.ui.manager.editor.Worker":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileController",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_29_0=cv.io.rest.Client.getFsClient()},members:{__P_29_0:null,rename:function(e,t){var i=e.getPath()||"";i.length>0&&!i.endsWith("/")&&(i+="/");i+=t;e.isTemporary()?this.__P_29_0.createSync({path:i,type:e.getType()},function(i){if(i)cv.ui.manager.snackbar.Controller.error(i);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been created',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been created',e.getDisplayName()));e.resetTemporary();e.resetModified();e.setName(t);e.reload()}},this):e.getFullPath()!==i&&this.__P_29_0.moveSync({src:e.getFullPath(),target:i},function(i){if(i)cv.ui.manager.snackbar.Controller.error(i);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been renamed',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been renamed',e.getDisplayName()));e.setName(t);e.resetModified();e.reload()}e.resetEditing()},this)},move:function(e,t){this.__P_29_0.moveSync({src:e.getFullPath(),target:t},function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been moved',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been moved',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"moved",path:e.getFullPath()})}},this)},restore:function(e){if(e.isInTrash()){var t=e.getFullPath().replace(".trash/","");this.__P_29_1(e,t)}else if("file"===e.getType()&&!e.isTemporary()){var i=/^\/?backup\/visu_config(.*)-[0-9]{14}\.xml$/.exec(e.getFullPath());if(i){var n="visu_config"+i[1]+".xml",a=null;e.getParent().getParent().getChildren().some(function(e){if(e.getFullPath()===n){a=e;return!0}return!1});this.__P_29_0.readSync({path:e.getFullPath()},function(t,i){t?cv.ui.manager.snackbar.Controller.error(t):a?this.__P_29_0.updateSync({path:a.getFullPath(),hash:"ignore"},i,function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()));a.resetModified();a.resetTemporary();qx.event.message.Bus.dispatchByName(a.getBusTopic(),{type:"fsContentChanged",data:i,source:this})}},this):this.__P_29_0.createSync({path:n,hash:"ignore"},i,function(t){t?cv.ui.manager.snackbar.Controller.error(t):cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()))},this)},this)}}},__P_29_1:function(e,t){this.__P_29_0.moveSync({src:e.getFullPath(),target:t},function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been restored',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been restored',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"restored",path:e.getFullPath()})}},this)},delete:function(e,t,i){if(e.isTemporary())t&&t.apply(i,!0);else if(e){var n;n=e.isTrash()?qx.locale.Manager.tr("Do you really want to clear the trash?"):e.isInTrash()?"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1" from the trash?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1" from the trash?',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1"?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1"?',e.getDisplayName());qxl.dialog.Dialog.confirm(n,function(n){n?this.__P_29_2(e,t,i):t&&t.apply(i,!1)},this,qx.locale.Manager.tr("Confirm deletion"))}},__P_29_2:function(e,t,i){this.__P_29_0.deleteSync({path:e.getFullPath(),force:e.isTrash()},null,function(n){if(n){cv.ui.manager.snackbar.Controller.error(n);t&&t.apply(i,!1)}else{var a;a=e.isTrash()?qx.locale.Manager.tr("Trash has been cleared"):e.isInTrash()?"file"===this.getType()?qx.locale.Manager.tr('File "%1" has been removed from trash',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been removed from trash',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('File "%1" has been deleted',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been deleted',e.getDisplayName());cv.ui.manager.snackbar.Controller.info(a);t&&t.apply(i,!0);qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:e.getFullPath()})}},this)},download:function(e){if("file"===e.getType()){var t=document.createElement("a");t.setAttribute("href",cv.io.rest.Client.getBaseUrl()+"/fs?download=true&path="+e.getFullPath());t.style.display="none";document.body.appendChild(t);t.click();document.body.removeChild(t)}},validate:function(e){e.isConfigFile()?this.__P_29_3(e):this.info("no validation available for file: "+e.getFullPath())},__P_29_3:function(e){var t=qxl.dialog.Dialog.alert(qx.locale.Manager.tr("Validating %1",e.getFullPath()));cv.ui.manager.editor.Worker.getInstance().validateConfig(e).then(function(i){t.close();if(!0===i){e.setValid(!0);cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has no errors!",e.getFullPath()))}else{e.setValid(!1);qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:e,handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}});cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.trn("%1 error found in %2!","%1 errors found in %2!",i.length,i.length,e.getFullPath()))}})}},destruct:function(){this.__P_29_0=null}});cv.ui.manager.control.FileController.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.editor.IEditor",{properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_loadFile"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},statics:{TITLE:""},members:{save:function(){},getCurrentContent:function(){}}});cv.ui.manager.editor.IEditor.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.IActionHandler",{members:{canHandleAction:function(e){},handleAction:function(e,t){},configureButton:function(e,t){},unConfigureButton:function(e,t){}}});cv.ui.manager.IActionHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.ui.container.Scroll":{},"qx.ui.basic.Atom":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.AbstractViewer",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},members:{canHandleAction:function(){return!1},handleAction:function(){},configureButton:function(e){},unConfigureButton:function(e){},save:function(){},getCurrentContent:function(){},_applyFile:function(e,t){},_createChildControlImpl:function(e){var t;switch(e){case"scroll":t=new qx.ui.container.Scroll;this._add(t);break;case"image":t=new qx.ui.basic.Atom;this.getChildControl("scroll").add(t);t.getChildControl("icon").addListener("resize",this._scaleImage,this)}return t||cv.ui.manager.viewer.AbstractViewer.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.viewer.AbstractViewer.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.ResourceManager":{},"qx.io.ImageLoader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Image",{extend:cv.ui.manager.viewer.AbstractViewer,properties:{appearance:{refine:!0,init:"image-viewer"}},statics:{SUPPORTED_FILES:["jpg","jpeg","png","gif","svg"],TITLE:qx.locale.Manager.tr("Show image"),ICON:cv.theme.dark.Images.getIcon("image",18),getImageData:function(e){var t=qx.util.ResourceManager.getInstance().getData(e);return t?{width:t[0],height:t[1],aspectRatio:t[0]/t[1]}:(t=qx.io.ImageLoader.getSize(e))&&t.width&&t.height?Object.assign({aspectRatio:t.width/t.height},t):null}},members:{_applyFile:function(e){var t=this.getChildControl("image");if(e){t.setIcon(e.getServerPath());t.setLabel(e.getFullPath());cv.ui.manager.viewer.Image.getImageData(e.getServerPath())?this._scaleImage():t.getChildControl("icon").addListenerOnce("loaded",this._scaleImage,this);this.addListener("resize",this._scaleImage,this)}else{t.resetIcon();t.resetLabel();this.removeListener("resize",this._scaleImage,this)}},_scaleImage:function(){var e=this.getBounds();if(e){var t=this.getFile();if(t){var i=this.getChildControl("image").getChildControl("icon"),n=cv.ui.manager.viewer.Image.getImageData(t.getServerPath()),a=e.height-40,r=e.width-20,o=Math.round(1/n.aspectRatio*r);if(o>a){o=a;r=Math.round(n.aspectRatio*a)}i.set({width:r,height:o,scale:!0})}}else this.addListenerOnce("appear",this._scaleImage,this)}}});cv.ui.manager.viewer.Image.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.event.message.Bus":{},"cv.ui.manager.model.FileItem":{},"qx.util.Uri":{},"qx.util.LibraryManager":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.embed.Iframe":{},"qx.ui.basic.Atom":{},"qx.event.Timer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Config",{extend:cv.ui.manager.viewer.AbstractViewer,construct:function(){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{appearance:{refine:!0,init:"config-viewer"},target:{check:["iframe","window"],init:"window"},external:{refine:!0,init:!0},connectToWindow:{check:"Boolean",init:!1,apply:"_applyConnectToWindow"}},statics:{SUPPORTED_FILES:/^(demo|\.)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Config viewer"),ICON:cv.theme.dark.Images.getIcon("preview",18)},members:{_windowRef:null,_source:null,_reloading:!1,_applyConnectToWindow:function(e){this.setExternal(!e)},_applyFile:function(e,t){t&&t.isConfigFile()&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e)if(e.isConfigFile()){var i=cv.ui.manager.model.FileItem.getConfigName(e.getFullPath()),n=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/..")+"?config="+(i||"");if("iframe"===this.getTarget()){n+="&preview=1&libraryCheck=false";var a=this.getChildControl("iframe");this._source=n;this.getChildControl("loading").show();a.setSource(n);a.show();var r=this.getChildControl("hint",!0);r&&r.isVisible()&&r.exclude()}else{this._source=n;var o=window.open(n,i);if(!this.isConnectToWindow()){this._onClose();return}this._windowRef=o;this._windowRef.onbeforeunload=this._onClose.bind(this);this.getChildControl("hint").show();var s=this.getChildControl("iframe",!0);s&&s.isVisible()&&s.exclude()}qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else{cv.ui.manager.snackbar.Controller.error(this.tr("%1 is no configuration file",e.getFullPath()));this._source=null}else{if(this.hasChildControl("iframe")){this.getChildControl("iframe").resetSource();this.getChildControl("iframe").exclude()}this.hasChildControl("hint")&&this.getChildControl("hint").exclude();this._windowRef&&this._windowRef.close()}},_onChange:function(e){var t=this;if("contentChanged"===e.getData().type)if(this.hasChildControl("iframe")){var i=this.getChildControl("iframe"),n=i.getDocument().location.href.startsWith(this._source)?i.getDocument().location.href:this._source;if(n&&"about:blank"!==n){this._reloading=!0;this.getChildControl("loading").show();i.addListenerOnce("load",function(){t._reloading=!1;i.setSource(n)},this)}i.setSource("about:blank")}else this._windowRef&&this._windowRef.reload()},_onClose:function(){if(this._windowRef){qx.event.message.Bus.dispatchByName("cv.manager.action.close",this.getFile());this._windowRef=null}this.resetFile()},openPage:function(e,t){if(this.hasChildControl("iframe")){var i=this.getChildControl("iframe").getContentElement().getDomElement();if(i&&i.contentWindow.cv){var n=i.contentWindow.cv.TemplateEngine.getInstance(),a=t?n.getPageIdByPath(e,t):e;n.scrollToPage(a,0)}}},setHighlightWidget:function(e){if(this.hasChildControl("iframe")){var t=this.getChildControl("iframe").getContentElement().getDomElement();if(t&&t.contentWindow.cv){t.contentWindow.cv.TemplateEngine.getInstance().setHighlightedWidget(e)}}},_createChildControlImpl:function(e){var t,i=this;switch(e){case"iframe":(t=new qx.ui.embed.Iframe).exclude();t.addListener("load",function(){i.hasChildControl("loading")&&!i._reloading&&i.getChildControl("loading").exclude()},this);this.getChildControl("scroll").add(t);break;case"hint":(t=new qx.ui.basic.Atom(this.tr("This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window."))).set({center:!0,font:"title"});t.addListener("tap",function(){this._windowRef&&this._windowRef.focus()},this);this.getChildControl("scroll").add(t);break;case"loading":(t=new qx.ui.basic.Atom(this.tr("Loading..."),cv.theme.dark.Images.getIcon("reload",64))).set({center:!0,font:"title",iconPosition:"top",backgroundColor:"rgba(0,0,0,0.2)"});t.addListener("appear",function(){qx.event.Timer.once(function(){t.exclude()},i,5e3)});t.exclude();this._add(t)}return t||cv.ui.manager.viewer.Config.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._windowRef=null}});cv.ui.manager.viewer.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.core.ISingleSelection":{require:!0},"qx.ui.form.IModelSelection":{require:!0},"qx.ui.core.MSingleSelectionHandling":{require:!0},"qx.ui.core.MRemoteChildrenHandling":{require:!0},"qx.ui.form.MModelSelection":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.viewer.Image":{construct:!0},"qx.data.Array":{construct:!0},"qx.ui.layout.VBox":{construct:!0},"cv.ui.manager.model.FileItem":{construct:!0},"cv.theme.dark.Images":{construct:!0,usage:"dynamic",require:!0},"qx.util.Function":{construct:!0},"qx.locale.Manager":{require:!0},"cv.ui.manager.form.FileListItem":{},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.message.Bus":{},"qx.data.controller.List":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.TextField":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.layout.Flow":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Folder",{extend:cv.ui.manager.viewer.AbstractViewer,implement:[qx.ui.core.ISingleSelection,qx.ui.form.IModelSelection],include:[qx.ui.core.MSingleSelectionHandling,qx.ui.core.MRemoteChildrenHandling,qx.ui.form.MModelSelection,cv.ui.manager.control.MFileEventHandler],construct:function(e){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);cv.ui.manager.model.Preferences.getInstance().bind("startViewMode",this,"viewMode");this._isImageRegex=new RegExp("\\.("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i");this.initModel(new qx.data.Array);this._setLayout(new qx.ui.layout.VBox(8));this._newItem=new cv.ui.manager.model.FileItem("new","new",null).set({fake:!0,type:"file",loaded:!0,icon:cv.theme.dark.Images.getIcon("upload"),displayName:this.tr("Upload file"),special:"add-file"});this._debouncedOnFilter=qx.util.Function.debounce(this._onFilter,500,!1);e||this._createChildControl("toolbar");this._createChildControl("filter")},statics:{SUPPORTED_FILES:function(e){return"dir"===e.getType()},TITLE:qx.locale.Manager.tr("Show folder"),ICON:cv.theme.dark.Images.getIcon("folder",18)},events:{addItem:"qx.event.type.Data",removeItem:"qx.event.type.Data"},properties:{model:{check:"qx.data.Array",deferredInit:!0},permanentFilter:{check:"Function",nullable:!0,apply:"_onFilter"},showTextFilter:{check:"Boolean",init:!0,apply:"_applyShowTextFilter"},labelConverter:{check:"Function",nullable:!0},disableScrolling:{check:"Boolean",init:!1,apply:"_applyDisableScrolling"},viewMode:{check:["list","preview"],init:"list",event:"changeViewMode"}},members:{_controller:null,_isImageRegex:null,_newItem:null,_getItems:function(){return this.getChildControl("list").getChildren()},_isAllowEmptySelection:function(){return!0},_defaultLabelConverter:function(e){if("list"===this.getViewMode())return e;var t=e.split(".");t.length>1&&t.pop();return t.join(".")},_getDelegate:function(){var e=this.getLabelConverter(),t={converter:e||this._defaultLabelConverter.bind(this)};return{createItem:function(){return new cv.ui.manager.form.FileListItem},configureItem:function(e){e.addListener("dbltap",this._onDblTap,this);e.addListener("contextmenu",this._onFsItemRightClick,this);e.addListener("action",this._onFsItemRightClick,this);e.setShowFileActions(!0);this.bind("viewMode",e,"viewMode")}.bind(this),bindItem:function(e,i,n){e.bindProperty("","model",null,i,n);e.bindProperty("displayName","label",t,i,n);e.bindProperty("icon","icon",{converter:function(e,t){if("file"===t.getType()&&this._isImageRegex.test(t.getName()))return t.getServerPath();if(!e)return null;var i=e.split("/");3===i.length&&i.pop();return i.join("/")}.bind(this)},i,n)}.bind(this)}},_onFsItemRightClick:function(e){var t=e.getCurrentTarget().getModel();if("add-file"!==t.getSpecial()){var i=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();i.configure(t);e.getCurrentTarget().setContextMenu(i);i.openAtPointer(e);e.getBubbles()&&e.stop()}else{e.preventDefault();e.getBubbles()&&e.stopPropagation()}},_onDblTap:function(e){var t=e.getCurrentTarget().getModel();"add-file"===t.getSpecial()||qx.event.message.Bus.dispatchByName("cv.manager.open",t)},_applyFile:function(e,t){if(t){t.removeRelatedBindings(this);this.resetModel()}if(e){var i=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,i);this._controller.setDelegate(this._getDelegate())}e.bind("children",this,"model");var n=this.getModel();this._newItem.setParent(e);n.addListener("change",function(){this.getChildControl("filter").getValue()||this.getPermanentFilter()?this._onFilter():this._controller.setModel(n)},this);this._controller.setModel(n);e.load()}else{this._controller&&this._controller.resetModel();this._newItem.resetParent()}},_handleFileEvent:function(e){var t=this.getFile(),i=e.getData();switch(i.action){case"moved":t.reload();break;case"added":case"uploaded":case"created":i.path.startsWith(t.getFullPath())&&t.reload();break;case"deleted":var n;t&&(i.path===t.getFullPath()?this.dispose():i.path.startsWith(t.getFullPath())&&(n=t.getChildren()).some(function(e){if(e.getFullPath()===i.path){n.remove(e);this.removeRelatedBindings(e);return!0}return!1},this));(n=this.getModel()).some(function(e){if(e.getFullPath()===i.path){n.remove(e);this.removeRelatedBindings(e);return!0}return!1},this)}},_applyShowTextFilter:function(e){this.getChildControl("filter").setVisibility(e?"visible":"excluded")},_onFilter:function(){if(this._controller){var e=this.getChildControl("filter").getValue(),t=this.getPermanentFilter(),i=this.getModel().filter(function(i){return(!t||t(i))&&(!e||i.getName().includes(e))});this._controller.setModel(i)}},getChildrenContainer:function(){return this.getChildControl("list")},_onAddChild:function(e){this.fireDataEvent("addItem",e.getData())},_onRemoveChild:function(e){this.fireDataEvent("removeItem",e.getData())},_onFileEvent:function(e){e.getData().action},_applyDisableScrolling:function(e){if(e){this.getChildControl("scroll").exclude();this._addAt(this.getChildControl("list"),1,{flex:1})}else{var t=this.getChildControl("scroll");t.show();t.add(this.getChildControl("list"));this._addAt(t,1,{flex:1})}},_createChildControlImpl:function(e){var t;switch(e){case"toolbar":t=new cv.ui.manager.ToolBar(null,["new-file","new-folder","upload","reload"]);this.bind("file",t,"folder");t.addListener("reload",function(){this.getFile().reload()},this);this._addAt(t,0);break;case"filter":(t=new qx.ui.form.TextField).set({placeholder:this.tr("Filter by name..."),liveUpdate:!0,margin:8});this.isShowTextFilter()||t.exclude();t.addListener("changeValue",this._debouncedOnFilter,this);this._addAt(t,1);break;case"scroll":t=new qx.ui.container.Scroll;this._addAt(t,2,{flex:1});break;case"list":(t=new qx.ui.container.Composite(new qx.ui.layout.Flow(8,8))).addListener("addChildWidget",this._onAddChild,this);t.addListener("removeChildWidget",this._onRemoveChild,this);this.isDisableScrolling()?this._addAt(t,1,{flex:1}):this.getChildControl("scroll").add(t)}return t||cv.ui.manager.viewer.Folder.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_controller");this._isImageRegex=null;cv.ui.manager.model.Preferences.getInstance().removeRelatedBindings(this)}});cv.ui.manager.viewer.Folder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.Folder":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.core.IconAtom":{},"qx.data.controller.List":{},"cv.IconConfig":{},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Icons",{extend:cv.ui.manager.viewer.Folder,construct:function(){this._disableFileEvents=!0;cv.ui.manager.viewer.Folder.constructor.call(this,!0)},statics:{SUPPORTED_FILES:/^CometVisu-Icons$/i,TITLE:qx.locale.Manager.tr("Show icons"),ICON:cv.theme.dark.Images.getIcon("icons",18)},members:{_getDelegate:function(){return{createItem:function(){return new cv.ui.manager.core.IconAtom},bindItem:function(e,t,i){e.bindProperty("","label",null,t,i)}}},_onFilter:function(){var e=this.getChildControl("filter").getValue(),t=this.getModel().filter(function(t){return t.includes(e)});this._controller.setModel(t)},_applyFile:function(e,t){if(e){var i=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,i);this._controller.setDelegate(this._getDelegate())}var n=this.getModel();Object.keys(cv.IconConfig.DB).filter(function(e){var t=cv.IconConfig.DB[e];return t["*"]&&t["*"]["*"]&&qx.lang.Type.isFunction(t["*"]["*"]["*"])}).forEach(function(e){n.push(e)},this);this.getChildControl("filter").getValue()||this.getPermanentFilter()?this._onFilter():this._controller.setModel(n)}else this._controller&&this._controller.resetModel()}}});cv.ui.manager.viewer.Icons.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.VBox":{construct:!0},"cv.theme.dark.Images":{},"cv.ui.manager.model.Preferences":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.toolbar.ToolBar":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.RadioButton":{},"qx.ui.form.RadioGroup":{},"qx.ui.basic.Atom":{},"qx.ui.layout.HBox":{},"cv.ui.manager.ToolBar":{},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.viewer.Folder":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Start",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox);this._configRegex=/^visu_config_?([^.]+)?\.xml$/;["toolbar","configs-title","configs-toolbar","configs","demo-configs-title","demo-configs","media-title","media-toolbar","media","misc-title","misc"].forEach(this._createChildControl,this)},properties:{file:{check:"cv.ui.manager.model.FileItem",apply:"_loadRoot",event:"changeFile"},appearance:{refine:!0,init:"cv-start"},selectedItem:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applySelectedItem"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},members:{_configRegex:null,_ignoreSelectionChanges:!1,_previewButton:null,_listButton:null,_radioGroup:null,save:function(){},getCurrentContent:function(){},canHandleAction:function(){return!1},handleAction:function(){},configureButton:function(e){},unConfigureButton:function(e){},_loadRoot:function(e){this.getChildControl("configs").setFile(e);var t=0;e&&e.load(function(){e.getChildren().some(function(e){if("media"===e.getName()){this.getChildControl("media").setFile(e);this.getChildControl("media-toolbar").setFolder(e);t++}else if("demo"===e.getName()){this.getChildControl("demo-configs").setFile(e);t++}return 2===t},this)},this)},_onChangeSelection:function(e){if(!1===this._ignoreSelectionChanges){var t=e.getTarget(),i=e.getData();this._ignoreSelectionChanges=!0;["configs","demo-configs","media"].forEach(function(e){var i=this.getChildControl(e);i!==t&&i.resetSelection()},this);this._ignoreSelectionChanges=!1;i.length>0&&this.setSelectedItem(i[0].getModel())}},_applySelectedItem:function(){},_onToggleExpand:function(e){var t=this.getChildControl(e.getTarget().getUserData("control"));if("visible"===t.getVisibility()){t.exclude();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-down",18))}else{t.show();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-up",18))}},_onChangeViewMode:function(){switch(cv.ui.manager.model.Preferences.getInstance().getStartViewMode()){case"list":this._radioGroup.setSelection([this._listButton]);break;case"preview":this._radioGroup.setSelection([this._previewButton])}},_createChildControlImpl:function(e){var t;switch(e){case"scroll-container":t=new qx.ui.container.Scroll;this._add(t,{flex:1});break;case"content":t=new qx.ui.container.Composite(new qx.ui.layout.VBox(8));this.getChildControl("scroll-container").add(t);break;case"toolbar":t=new qx.ui.toolbar.ToolBar;var i=new qx.ui.toolbar.Part,n=this._listButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("listViewMode",22));n.setUserData("mode","list");n.set({show:"icon",toolTipText:this.tr("List mode")});var a=this._previewButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("previewMode",22));a.setUserData("mode","preview");a.set({show:"icon",toolTipText:this.tr("Preview mode")});i.add(n);i.add(a);t.add(i);this._radioGroup=new qx.ui.form.RadioGroup(n,a);this._onChangeViewMode();this._radioGroup.addListener("changeSelection",function(e){var t=e.getData()[0];cv.ui.manager.model.Preferences.getInstance().setStartViewMode(t.getUserData("mode"))},this);cv.ui.manager.model.Preferences.getInstance().addListener("changeStartViewMode",this._onChangeViewMode,this);this._add(t);break;case"configs-title":(t=new qx.ui.basic.Atom(this.tr("Configurations"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","configs");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("configs-header").add(t);break;case"configs-header":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox)).getContentElement().setAttribute("data-section","configs");this.getChildControl("content").add(t);break;case"configs-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-config-file","upload","reload"])).setFolder(cv.ui.manager.model.FileItem.ROOT);t.addListener("reload",function(){cv.ui.manager.model.FileItem.ROOT.reload()},this);this.getChildControl("configs-header").add(t);break;case"configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){var t=this._configRegex.exec(e.getName());return!(!t||t[1]&&t[1].endsWith("temp"))}.bind(this),labelConverter:function(e,t){if(t.isFake())return e;var i=cv.ui.manager.model.FileItem.getConfigName(e);return i||"<Default>"},file:cv.ui.manager.model.FileItem.ROOT,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"demo-configs-title":(t=new qx.ui.basic.Atom(this.tr("Demo configurations"),cv.theme.dark.Images.getIcon("drop-down",18))).setUserData("control","demo-configs");t.getContentElement().setAttribute("data-section","demo");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"demo-configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){return this._configRegex.test(e.getName())}.bind(this),labelConverter:function(e){var t=cv.ui.manager.model.FileItem.getConfigName(e);return t||"<Default>"},disableScrolling:!0});t.exclude();t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"media-title":(t=new qx.ui.basic.Atom(this.tr("Media files"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","media");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("media-header").add(t);break;case"media-header":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox)).getContentElement().setAttribute("data-section","media");this.getChildControl("content").add(t);break;case"media-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-file","upload","reload"])).addListener("reload",function(){t.getFolder().reload()},this);this.getChildControl("media-header").add(t);break;case"media":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"misc-title":(t=new qx.ui.basic.Atom(this.tr("Miscellaneous"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","misc");t.getContentElement().setAttribute("data-section","misc");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"misc":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});this.__P_25_0(t);this.getChildControl("content").add(t,{flex:1})}return t||cv.ui.manager.Start.prototype._createChildControlImpl.base.call(this,e)},__P_25_0:function(e){if(cv.ui.manager.model.FileItem.ROOT.isLoaded()){var t=[cv.ui.manager.model.FileItem.getIconFile()];cv.ui.manager.model.FileItem.ROOT.getChildren().some(function(e){if("hidden.php"===e.getFullPath()){e.set({overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),displayName:qx.locale.Manager.tr("Hidden configuration"),fake:!0});t.unshift(e);return!0}return!1});var i=new cv.ui.manager.model.FileItem("fake","fake",cv.ui.manager.model.FileItem.ROOT,t).set({fake:!0,type:"dir",loaded:!0});e.setFile(i);e.addListener("changeSelection",this._onChangeSelection,this)}else cv.ui.manager.model.FileItem.ROOT.addListenerOnce("changeLoaded",function(){this.__P_25_0(e)},this)}},destruct:function(){this._configRegex=null;cv.ui.manager.model.Preferences.getInstance().removeListener("changeStartViewMode",this._onChangeViewMode,this);this._disposeObjects("_previewButton","_listButton","_radioGroup")}});cv.ui.manager.Start.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.io.rest.Client":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"qx.lang.Function":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.AbstractEditor",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._initClient();this._nativePasteSupported=document.queryCommandSupported("paste")},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,apply:"_loadFile",event:"changeFile"},content:{nullable:!0,event:"changeContent",apply:"_applyContent"},handlerOptions:{check:"Map",nullable:!0,apply:"_applyHandlerOptions"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},statics:{CLIPBOARD:null},members:{_handledActions:null,_nativePasteSupported:!1,canHandleAction:function(e){return!("save"===e&&this.getFile()&&!this.getFile().isWriteable())&&(this._handledActions&&this._handledActions.includes(e))},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"save":this.save()}},configureButton:function(e){},unConfigureButton:function(e){},_initClient:function(){this._client=cv.io.rest.Client.getFsClient()},_applyHandlerOptions:function(){},_loadFile:function(e,t){t&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e&&"file"===e.getType()){null!==e.getContent()?this.setContent(e.getContent()):this._loadFromFs();qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else this.resetContent()},_loadFromFs:function(){this._client.readSync({path:this.getFile().getFullPath()},function(e,t){if(e)cv.ui.manager.snackbar.Controller.error(e);else{t instanceof XMLDocument&&(t=(new XMLSerializer).serializeToString(t));this.setContent(t)}},this)},_onChange:function(e){var t=e.getData();"fsContentChanged"===t.type&&t.source!==this&&this.setContent(t.data)},_applyContent:function(){},getCurrentContent:function(){},_handleSaveResponse:function(e,t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{var i="created"===e?this.tr("File has been created"):this.tr("File has been saved");cv.ui.manager.snackbar.Controller.info(i);this._onSaved();var n=this.getFile();if(n){n.resetContent();qx.event.message.Bus.dispatchByName(n.getBusTopic(),{type:e,file:n,data:this.getCurrentContent(),source:this})}}},save:function(e,t){var i=this.getFile();i.isModified()&&(i.isTemporary()?this._client.createSync({path:i.getFullPath(),hash:t||i.getHash(),type:"file"},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"created"),this):this._client.updateSync({path:i.getFullPath(),hash:t||i.getHash()},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"contentChanged"),this))},_onSaved:function(){var e=this.getFile();if(e){e.resetModified();e.resetTemporary()}},showErrors:function(e,t){},showDecorations:function(e,t){}},destruct:function(){this._client&&(this._client=null)}});cv.ui.manager.editor.AbstractEditor.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.core.FocusHandler":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.Uri":{},"qx.util.LibraryManager":{},"qx.util.DynamicScriptLoader":{},"cv.ui.manager.editor.completion.Config":{},"cv.ui.manager.model.Schema":{},"cv.ui.manager.editor.completion.CometVisu":{},"qx.log.Logger":{},"cv.ui.manager.editor.Worker":{},"cv.Version":{},"qx.io.request.Xhr":{},"qx.util.ResourceManager":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qxl.dialog.Dialog":{},"qx.xml.Document":{},"cv.util.ConfigUpgrader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Source",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save","cut","copy","paste","undo","redo"];this.getContentElement().setAttribute("contentEditable","true");this.set({droppable:!1,focusable:!0});this.addListener("dragover",function(e){e.preventDefault();e.dataTransfer.effectAllowed="none";e.dataTransfer.dropEffect="none"});this.addListener("drop",function(e){e.preventDefault()});this.addListener("appear",function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!1)});this.addListener("disappear",function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)});this._draw();this._initWorker();this._currentDecorations=[];this.bind("file.writeable",this,"selectable")},statics:{TITLE:qx.locale.Manager.tr("Texteditor"),COUNTER:0,MONACO_EXTENSION_REGEX:null,SUPPORTED_FILES:function(e){var t="string"==typeof e?e:e.getFullPath().toLowerCase();if(window.monaco&&window.monaco.languages){if(!cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX){var i=[];monaco.languages.getLanguages().forEach(function(e){e.extensions&&e.extensions.forEach(function(e){e=e.replace(/\./g,"\\.");-1===i.indexOf(e)&&i.push(e)})});cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX=new RegExp("("+i.join("|")+")$")}return cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX.test(t)}return/\.(xml|html|php|css|js|svg|json|md|yaml|conf|ts|rst|py|txt)$/i.test(t)},DEFAULT_FOR:/^(demo|\.)?\/?visu_config.*\.xml/,ICON:cv.theme.dark.Images.getIcon("text",18),load:function(e,t){var i=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/.."),n=new qx.util.DynamicScriptLoader([i+"node_modules/monaco-editor/min/vs/loader.js","manager/xml.js"]);n.addListener("ready",function(){window.require.config({paths:{vs:i+"node_modules/monaco-editor/min/vs"}});window.require.config({"vs/nls":{availableLanguages:{"*":"en"!==qx.locale.Manager.getInstance().getLanguage()?qx.locale.Manager.getInstance().getLanguage():""}}});var n="?"+Math.random();window.require(["xml!./resource/visu_config.xsd"+n,"xml!*./resource/manager/completion-libs/qooxdoo.d.ts","vs/editor/editor.main"],function(i,n){this.__P_32_0=i;e.apply(t);window.monaco.languages.typescript.javascriptDefaults.addExtraLib(n,"qooxdoo.d.ts");var a=new cv.ui.manager.editor.completion.Config(cv.ui.manager.model.Schema.getInstance("visu_config.xsd")),r=new cv.ui.manager.editor.completion.CometVisu;window.monaco.languages.registerCompletionItemProvider("xml",a.getProvider());window.monaco.languages.registerCompletionItemProvider("javascript",r.getProvider())}.bind(this))},this);n.addListener("failed",function(e){qx.log.Logger.error(this,e.getData())},this);n.start()}},members:{__P_32_0:null,_editor:null,_workerWrapper:null,_currentDecorations:null,_configClient:null,_onDidChangeContentGuard:0,_initWorker:function(){this._workerWrapper=cv.ui.manager.editor.Worker.getInstance();this._workerWrapper.setEditor(this)},_getDefaultModelOptions:function(){return{tabSize:2,indentSize:2,insertSpaces:!0}},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.create(e,{suggestOnTriggerCharacters:!0,folding:!0,autoIndent:!0,automaticLayout:!0,dragAndDrop:!0,formatOnPaste:!0,formatOnType:!0,renderValidationDecorations:"on",minimap:{enabled:!0},theme:"vs-dark"});var t=cv.Version.VERSION.split("-")[0],i=new qx.io.request.Xhr(qx.util.ResourceManager.getInstance().toUri("hidden-schema.json"));i.set({method:"GET",accept:"application/json"});i.addListenerOnce("success",function(e){var i=e.getTarget().getResponse();window.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[{uri:"https://www.cometvisu.org/CometVisu/schemas/"+t+"/hidden-schema.json",fileMatch:["hidden.php"],schema:i}]})},this);i.send();this.getFile()&&this._loadFile(this.getFile());this._editor.onDidChangeModelContent(this._onContentChanged.bind(this))}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"cut":this._editor.trigger("external","editor.action.clipboardCutAction");this._nativePasteSupported||(cv.ui.manager.editor.AbstractEditor.CLIPBOARD=this._editor.getModel().getValueInRange(this._editor.getSelection()));break;case"copy":this._editor.trigger("external","editor.action.clipboardCopyAction");this._nativePasteSupported||(cv.ui.manager.editor.AbstractEditor.CLIPBOARD=this._editor.getModel().getValueInRange(this._editor.getSelection()));break;case"paste":this._nativePasteSupported?this._editor.trigger("external","editor.action.clipboardPasteAction"):this._paste();break;case"undo":case"redo":this._editor.trigger("external",e);break;default:cv.ui.manager.editor.Source.prototype.handleAction.base.call(this,e)}},_paste:function(){if(cv.ui.manager.editor.AbstractEditor.CLIPBOARD){var e={identifier:{major:1,minor:1},range:this._editor.getSelection(),text:cv.ui.manager.editor.AbstractEditor.CLIPBOARD,forceMoveMarkers:!0};this._editor.executeEdits("clipboard",[e])}},_loadFile:function(e,t){t&&this._workerWrapper&&this._workerWrapper.close(t);this._editor&&(e&&"file"===e.getType()&&this.isSupported(e)?cv.ui.manager.editor.Source.prototype._loadFile.base.call(this,e,t):cv.ui.manager.editor.Source.prototype._loadFile.base.call(this,null,t))},_loadFromFs:function(){if("hidden.php"===this.getFile().getName()){if(!this._configClient){this._configClient=cv.io.rest.Client.getConfigClient();this._configClient.addListener("getSuccess",function(e){this.setContent(JSON.stringify(e.getData(),null,2))},this);this._configClient.addListener("updateSuccess",this._onSaved,this)}this._configClient.get({section:"*",key:"*"})}else cv.ui.manager.editor.Source.prototype._loadFromFs.base.call(this)},save:function(e,t){"hidden.php"===this.getFile().getName()?this.getFile().isValid()?this.getFile().getHasWarnings()?qxl.dialog.Dialog.confirm(this.tr("Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?"),function(e){e&&this.__P_32_1()},this,qx.locale.Manager.tr("Confirm saving with warnings")):this.__P_32_1():cv.ui.manager.snackbar.Controller.error(this.tr("Hidden config is invalid, please correct the errors")):cv.ui.manager.editor.Source.prototype.save.base.call(this,e,t)},__P_32_1:function(){this._configClient.saveSync(null,JSON.parse(this.getCurrentContent()),function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}},this)},_applyContent:function(e){var t=this.getFile();if(t){var i=this._editor.getModel();this._workerWrapper&&this._workerWrapper.open(t,e);var n=monaco.Uri.parse(t.getUri()),a=window.monaco.editor.getModel(n);if(!a){qx.xml.Document.isXmlDocument(e)?e=e.documentElement.outerHTML:"object"===_typeof(e)&&(e=JSON.stringify(e,null,2));(a=window.monaco.editor.createModel(e,this._getLanguage(t),n)).onDidChangeDecorations(function(e){var i=!1,r=!1;monaco.editor.getModelMarkers({owner:a.getLanguageId(),resource:n}).some(function(e){e.severity===monaco.MarkerSeverity.Warning?r=!0:e.severity===monaco.MarkerSeverity.Error&&(i=!0);return r&&i},this);t.setValid(!i);t.setHasWarnings(r)})}if(i!==a){a.updateOptions(this._getDefaultModelOptions());this._editor.setModel(a)}else this._editor.setValue(e);this._editor.updateOptions({readOnly:!t.isWriteable()});this._processHandlerOptions(e)}},_processHandlerOptions:function(e){var t=this.getHandlerOptions()||{};if(Object.prototype.hasOwnProperty.call(t,"upgradeVersion")&&!0===t.upgradeVersion&&e){var i=this._upgradeConfig(e),n=_slicedToArray(i,2),a=n[0],r=n[1];a?this.error(a):this._editor.setValue(this._convertToString(r))}},_convertToString:function(e){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+e.documentElement.outerHTML},_upgradeConfig:function(e){if(this.getFile()){if(this.getFile().isWriteable()){return(new cv.util.ConfigUpgrader).upgrade(e)}cv.ui.manager.snackbar.Controller.error(this.tr('"%1" is not writable. Upgrading not possible.',this.getFile().getFullPath()))}return[null,"",[]]},getCurrentContent:function(){return this._editor.getValue()},_onContentChanged:function(){this._workerWrapper&&this._workerWrapper.contentChanged(this.getFile(),this._editor.getValue())},isSupported:function(e){var t=e.getName().split("."),i=t.length>1?t.pop():"txt",n="."+i;return monaco.languages.getLanguages().some(function(e){return e.id===i||e.extensions&&e.extensions.indexOf(n)>=0})},showErrors:function(e,t){var i=[],n=this._editor.getModel();if(n){var a=-1;t&&t.forEach(function(e){t=e.line,(a<0||a>t)&&(a=t);var t;i.push({severity:window.monaco.MarkerSeverity.Error,startLineNumber:e.line,endLineNumber:e.line,message:e.message,startColumn:e.startColumn,endColumn:e.endColumn})});if(this.getFile().getFullPath()===e){window.monaco.editor.setModelMarkers(n,n.getLanguageId(),i);var r=this.getHandlerOptions();r&&r.jumpToError&&0===this._editor.getScrollTop()&&this._editor.revealLineInCenter(a)}}},showDecorations:function(e,t){this.getFile().getFullPath()===e&&this._editor.deltaDecorations(this._currentDecorations[e],t);this._currentDecorations[e]=t},_getLanguage:function(e){if("hidden.php"===e.getName())return"json";var t=e.getName().split(".").pop();switch(t){case"svg":return"xml";case"js":return"javascript";case"md":return"markdown";default:if(!t)return"txt";var i="."+t;monaco.languages.getLanguages().some(function(e){return e.id===t||e.extensions&&e.extensions.indexOf(i)>=0})||(t="txt");return t}}},destruct:function(){this._workerWrapper=null;if(this._editor){this._editor.dispose();this._editor=null}this._configClient=null;qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)}});cv.ui.manager.editor.Source.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",require:!0},"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"cv.ui.manager.model.Schema":{construct:!0},"qx.data.Array":{construct:!0},"qx.core.Init":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.bom.Viewport":{},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.model.ElementChange":{},"cv.ui.manager.editor.Worker":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.layout.Canvas":{},"qx.ui.layout.VBox":{},"cv.ui.manager.viewer.Config":{},"qx.ui.basic.Atom":{},"qx.ui.toolbar.Button":{},"qx.ui.form.CheckBox":{},"qx.ui.toolbar.ToolBar":{},"qx.ui.form.TextField":{},"qx.util.Function":{},"qx.ui.tree.VirtualTree":{},"qx.bom.client.Device":{require:!0},"cv.ui.manager.tree.VirtualElementItem":{},"qxl.dialog.Dialog":{},"qx.ui.core.Widget":{},"qx.ui.decoration.Decorator":{},"cv.ui.manager.contextmenu.ConfigElement":{},"qx.ui.core.DragDropCursor":{},"qx.event.Timer":{},"cv.ui.manager.snackbar.Controller":{},"cv.ui.manager.form.ElementForm":{},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.model.XmlElement":{},"cv.ui.manager.editor.data.Provider":{},"qx.ui.form.ListItem":{},"qx.core.ValidationError":{},"cv.ui.manager.dialog.ValidationError":{},"cv.ui.manager.Main":{},"qx.event.message.Bus":{},"qx.xml.Document":{},"qx.xml.String":{},"qx.ui.core.FocusHandler":{},"cv.ui.manager.dialog.BigAlert":{}},environment:{provided:[],required:{"device.touch":{className:"qx.bom.client.Device"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Tree",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){var e=this;cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this._handledActions=["save","cut","copy","paste","undo","redo","help"];this._initWorker();this._schema=cv.ui.manager.model.Schema.getInstance("visu_config.xsd");this._schema.onLoaded(function(){this.setReady(!0);this._draw()},this);this.__P_33_0=[];this.__P_33_1=new qx.data.Array;this.__P_33_1.addListener("changeLength",function(t){if(0===t.getData())e.setPreviewState("synced");else{var i=e.__P_33_1.some(function(e){return e.hasChildrenModified()});e.setPreviewState(i?"structureChanged":"changed")}},this);this.initUnDos(new qx.data.Array);this.initReDos(new qx.data.Array);this.__P_33_2={};qx.core.Init.getApplication().getRoot().addListener("keyup",this._onElementKeyUp,this);this.addListener("resize",this._maintainPreviewVisibility,this)},statics:{SUPPORTED_FILES:/^(demo|\.)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Xml-editor"),ICON:cv.theme.dark.Images.getIcon("xml",18),Allowed:{NONE:0,BEFORE:1,AFTER:2,INSIDE:4,FIRST_CHILD:8}},properties:{appearance:{refine:!0,init:"tree-editor"},expert:{check:"Boolean",init:!1},ready:{refine:!0,init:!1},selected:{check:"cv.ui.manager.model.XmlElement",nullable:!0,event:"changeSelected",apply:"_applySelected"},clipboard:{check:"cv.ui.manager.model.XmlElement",nullable:!0,event:"changeClipboard",apply:"_applyClipboard"},unDos:{check:"qx.data.Array",deferredInit:!0},reDos:{check:"qx.data.Array",deferredInit:!0},autoRefreshPreview:{check:"Boolean",init:!1},previewState:{check:["synced","changed","structureChanged"],init:"synced",event:"previewStateChanged",apply:"_updateHighlightWidget"},showPreview:{check:"Boolean",init:!0,apply:"_applyShowPreview",event:"showPreviewChanged"},dragging:{check:"Boolean",init:!1,event:"changeDragging"}},members:{_schema:null,__P_33_0:null,__P_33_1:null,_workerWrapper:null,__P_33_3:!1,__P_33_2:null,__P_33_4:null,__P_33_5:0,isPreviewSynced:function(){return"synced"===this.getPreviewState()},_applyHandlerOptions:function(){this._maintainPreviewVisibility()},_maintainPreviewVisibility:function(){var e=this.getHandlerOptions(),t=qx.bom.Viewport.getWidth()>800&&(!e||!e.noPreview);if(t){var i=this.__P_33_6();i.isTemporary()||i.isWriteable()?i.isTemporary()&&!cv.ui.manager.model.FileItem.ROOT.isWriteable()&&(t=!1):t=!1}this.setShowPreview(t)},_applyShowPreview:function(e){this.getChildControl("right").setVisibility(e?"visible":"excluded");if(e){this.getChildControl("left").clearLayoutProperties();this.getChildControl("left").updateLayoutProperties()}else{var t=this.getHandlerOptions();t&&t.noStretch||this.getChildControl("left").setLayoutProperties({flex:1})}var i=this.getFile();if(e&&i){var n=this.getChildControl("preview");i.isWriteable()?n.getFile()||n.setFile(this.__P_33_6()):n.setFile(i);this._updatePreview()}},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"undo":this.__P_33_3||this.undo();break;case"redo":this.__P_33_3||this.redo();break;case"cut":this._onCut();break;case"copy":this._onCopy();break;case"paste":this._onPaste();break;case"help":this.__P_33_3||this._showHelp();break;default:cv.ui.manager.editor.Tree.prototype.handleAction.base.call(this,e)}},configureButton:function(e,t){var i=this;switch(e){case"undo":this.__P_33_2[e]=this.getUnDos().addListener("changeLength",function(){var e=i.getUnDos().length;if(e>0){t.setEnabled(!0);t.setToolTipText(i.tr("Undo: %1",i.getUnDos().getItem(e-1).getTitle()))}else{t.setEnabled(!1);t.resetToolTipText()}},this);t.setEnabled(this.getUnDos().length>0);break;case"redo":this.__P_33_2[e]=this.getReDos().addListener("changeLength",function(){var e=i.getReDos().length;if(e>0){t.setEnabled(!0);t.setToolTipText(i.tr("Undo: %1",i.getReDos().getItem(e-1).getTitle()))}else{t.setEnabled(!1);t.resetToolTipText()}},this);t.setEnabled(this.getReDos().length>0);break;case"cut":this.bind("selected",t,"enabled",{converter:function(e){return!!e&&!e.isDeletable()}});break;case"copy":this.bind("selected",t,"enabled",{converter:function(e){return!!e}});break;case"paste":this.bind("clipboard",t,"enabled",{converter:function(e){return!!e}})}},unConfigureButton:function(e,t){switch(e){case"undo":if(this.__P_33_2[e]){this.getUnDos().removeListenerById(this.__P_33_2[e]);delete this.__P_33_2[e]}t.setEnabled(!1);break;case"redo":if(this.__P_33_2[e]){this.getReDos().removeListenerById(this.__P_33_2[e]);delete this.__P_33_2[e]}t.setEnabled(!1);break;case"paste":case"cut":case"copy":this.removeRelatedBindings(t)}},addUndo:function(e){e instanceof cv.ui.manager.model.ElementChange&&this.getUnDos().push(e)},undo:function(){var e=this.getUnDos();if(e.length>0){var t=e.pop();if(t.undo())this.getReDos().push(t);else{this.error("could not undo "+t.getTitle());e.push(t)}}},redo:function(){var e=this.getReDos();if(e.length>0){var t=e.pop();if(t.redo())this.getUnDos().push(t);else{this.error("could not redo "+t.getTitle());e.push(t)}}},clearUnDosReDos:function(){this.getUnDos().removeAll().forEach(function(e){return e.dispose()});this.clearReDos()},clearReDos:function(){this.getReDos().removeAll().forEach(function(e){return e.dispose()})},_applyClipboard:function(e){try{e?navigator.clipboard.writeText(e.getNode().outerHTML):navigator.clipboard.writeText("")}catch(t){cv.ui.manager.editor.AbstractEditor.CLIPBOARD=e?e.getNode().outerHTML:""}},_initWorker:function(){this._workerWrapper=cv.ui.manager.editor.Worker.getInstance()},showErrors:function(e,t){},showDecorations:function(e,t){},_loadFile:function(e,t){t&&this._workerWrapper&&this._workerWrapper.close(t);if(e&&"file"===e.getType()&&this.isSupported(e))cv.ui.manager.editor.Tree.prototype._loadFile.base.call(this,e,t);else{cv.ui.manager.editor.Tree.prototype._loadFile.base.call(this,null,t);this.hasChildControl("preview")&&this.getChildControl("preview").resetFile();this.resetPreviewState()}},_createChildControlImpl:function(e,t){var i,n=this;switch(e){case"splitpane":i=new qx.ui.container.Composite(new qx.ui.layout.HBox);this._add(i);break;case"left":i=new qx.ui.container.Composite(new qx.ui.layout.Canvas);this.getChildControl("splitpane").addAt(i,0);break;case"right":i=new qx.ui.container.Composite(new qx.ui.layout.VBox);this.isShowPreview()||i.exclude();this.getChildControl("splitpane").addAt(i,1,{flex:1});break;case"preview":(i=new cv.ui.manager.viewer.Config).set({target:"iframe",minWidth:600});this.getChildControl("right").addAt(i,1,{flex:1});break;case"preview-sync-hint":var a=this.tr("Preview shows the current state of the edited configuration."),r=this.tr("Preview is out of sync. Click here to refresh."),o=this.tr("Preview is out of sync. Highlighting of the currently selected tree element is deactivated until you refresh the preview. Click here to refresh.");(i=new qx.ui.basic.Atom(a,cv.theme.dark.Images.getIcon("valid",16))).setRich(!0);i.getChildControl("label").setWrap(!0);i.addListener("tap",function(){!n.isPreviewSynced()&&n.isShowPreview()&&n._updatePreview()},this);this.getChildControl("right").addAt(i,0);this.addListener("previewStateChanged",function(e){switch(e.getData()){case"synced":i.set({label:a,icon:cv.theme.dark.Images.getIcon("valid",16)});i.getChildControl("icon").removeState("error");i.getChildControl("icon").removeState("warning");break;case"changed":i.set({label:r,icon:cv.theme.dark.Images.getIcon("out-of-sync",16)});i.getChildControl("icon").removeState("error");i.getChildControl("icon").addState("warning");break;case"structureChanged":i.set({label:o,icon:cv.theme.dark.Images.getIcon("out-of-sync",16)});i.getChildControl("icon").addState("error");i.getChildControl("icon").removeState("warning")}},this);break;case"edit-button":(i=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("edit",24))).setEnabled(!1);i.addListener("execute",this._onEdit,this);this.bind("file.writeable",i,"icon",{converter:function(e){return e?cv.theme.dark.Images.getIcon("edit",16):cv.theme.dark.Images.getIcon("view",16)}});this.getChildControl("toolbar").add(i);break;case"delete-button":(i=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("delete",16))).setEnabled(!1);i.addListener("execute",this._onDelete,this);this.getChildControl("toolbar").add(i);break;case"toggle-expert":(i=new qx.ui.form.CheckBox(this.tr("Expertview"))).addListener("changeValue",function(e){this.setExpert(e.getData())},this);this.getChildControl("toolbar").add(i);break;case"refresh-preview":(i=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("reload",16))).setToolTipText(this.tr("Reload preview"));i.addListener("execute",this._updatePreview,this);this.bind("showPreview",i,"visibility",{converter:function(e){return e?"visible":"hidden"}});this.bind("previewState",i,"enabled",{converter:function(e){return"synced"!==e}});this.getChildControl("toolbar").add(i);break;case"toolbar":i=new qx.ui.toolbar.ToolBar;this.getChildControl("left").add(i,{top:0,left:0,right:0});break;case"searchbar-container":i=new qx.ui.container.Composite(new qx.ui.layout.HBox);this.getChildControl("left").add(i,{top:36,left:0,right:0});break;case"searchbar":(i=new qx.ui.form.TextField).set({liveUpdate:!0,placeholder:this.tr("Search..."),margin:8});i.addListener("changeValue",qx.util.Function.debounce(this._onSearch,250),this);i.addListener("keyup",function(e){switch(e.getKeyIdentifier()){case"Enter":case"Down":this._showNextResult();break;case"Up":this._showPreviousResult()}e.stopPropagation()},this);this.getChildControl("searchbar-container").add(i,{flex:1});break;case"tree":(i=new qx.ui.tree.VirtualTree(null,"displayName","children")).set({selectionMode:"single",width:350,openMode:"none",itemHeight:qx.core.Environment.get("device.touch")?40:20});this.bind("file.writeable",i,"droppable");this.bind("file.writeable",i,"draggable");this._initDragDrop(i);i.setDelegate({createItem:function(){var e=new cv.ui.manager.tree.VirtualElementItem;qx.core.Environment.get("device.touch")?e.addListener("action",this._onContextMenuAction,this):e.addListener("contextmenu",this._onContextMenu,this);e.addListener("dbltap",this._onEdit,this);return e}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i);e.bindProperty("displayName","label",null,t,i);e.bindProperty("name","name",null,t,i);e.bindPropertyReverse("open","open",null,t,i);e.bindProperty("open","open",null,t,i);e.bindProperty("showEditButton","editable",null,t,i);e.bindProperty("sortable","sortable",null,t,i);e.bindProperty("icon","icon",null,t,i);e.bindProperty("status","status",null,t,i);e.bindProperty("invalidMessage","toolTipText",null,t,i);e.bindProperty("dragging","dragging",null,t,i)}});i.getSelection().addListener("change",this._onChangeTreeSelection,this);this.getChildControl("left").add(i,{top:72,left:0,right:0,bottom:0});break;case"add-button":(i=new qx.ui.basic.Atom(null,cv.theme.dark.Images.getIcon("add",32))).setDraggable(!0);i.setMarginLeft(-16);i.setZIndex(20);this.addListener("changeDragging",function(e){i.setLayoutProperties({bottom:16,left:e.getData()?-1e3:"50%"})},this);i.setAppearance("round-button");i.addListener("pointerover",function(){return i.addState("hovered")});i.addListener("pointerout",function(){return i.removeState("hovered")});i.addListener("tap",function(){n.getSelected()?n._onCreate(n.getSelected(),"inside"):qxl.dialog.Dialog.alert(n.tr("Please create a new Element either by dragging this button to the place where the new element should be inserted or by selecting an element and pressing this button to insert a new child to this element."))},this);this.getChildControl("left").add(i,{bottom:16,left:"50%"});break;case"drag-indicator":(i=new qx.ui.core.Widget).setDecorator((new qx.ui.decoration.Decorator).set({widthTop:1,styleTop:"solid",colorTop:"white"}));i.setHeight(0);i.setOpacity(.5);i.setZIndex(100);i.setDroppable(!0);i.setLayoutProperties({left:-1e3,top:-1e3});qx.core.Init.getApplication().getRoot().add(i);break;case"context-menu":(i=new cv.ui.manager.contextmenu.ConfigElement(this)).addListener("action",this._onContextMenuAction,this)}return i||cv.ui.manager.editor.Tree.prototype._createChildControlImpl.base.call(this,e)},_onContextMenu:function(e){var t=e.getCurrentTarget();if(t instanceof cv.ui.manager.tree.VirtualElementItem){var i=t.getModel();this.getChildControl("tree").getSelection().replace([i]);this.setSelected(i);var n=this.getChildControl("context-menu");n.setElement(i);n.openAtPointer(e)}e.getBubbles()&&e.stop()},_onContextMenuAction:function(e){var t=e.getData();if(this.canHandleAction(t.action))this.handleAction(t.action);else switch(t.action){case"view":case"edit":this._onEdit(null,t.element);break;case"delete":this._onDelete(null,t.element);break;case"create":this._onCreate(t.element,"inside");break;default:this.error("unhandled context menu action",t.action)}},_onChangeTreeSelection:function(e){var t=e.getData();1===t.added.length?this.setSelected(t.added[0]):this.resetSelected()},openByQuerySelector:function(e,t){var i=this;return new Promise(function(n,a){var r=i.getChildControl("tree").getModel().getNode().querySelector(e);if(r){i.__P_33_4=[r];i.__P_33_5=0;i.__P_33_7();t&&i._onEdit();n(!0)}else n(!1)})},_onSearch:function(e){var t=e.getData();this.__P_33_4=[];this.__P_33_5=0;if(t.length>2){var i=this.getChildControl("tree").getModel().getNode();this.__P_33_4=Array.from(i.querySelectorAll("*")).filter(function(e){return e.tagName.startsWith(t)||e.hasAttribute("name")&&e.getAttribute("name").startsWith(t)});this.__P_33_7()}},_showNextResult:function(){if(this.__P_33_4&&this.__P_33_4.length>this.__P_33_5+1){this.__P_33_5++;this.__P_33_7()}},_showPreviousResult:function(){if(this.__P_33_4&&this.__P_33_5>0){this.__P_33_5--;this.__P_33_7()}},__P_33_7:function(){if(this.__P_33_4.length>this.__P_33_5){var e=this.__P_33_4[this.__P_33_5],t=this.getChildControl("tree");if(e.$$widget){t.openNodeAndParents(e.$$widget);t.getSelection().replace([e.$$widget])}else{for(var i=e,n=[];i&&!i.$$widget;)(i=i.parentElement)&&n.push(i);if(i&&i.$$widget){i.$$widget.load();for(var a=n.length-1;a>=0;a--){var r=n[a].$$widget;r&&r.load()}if(e.$$widget){t.openNodeAndParents(e.$$widget);t.getSelection().replace([e.$$widget])}}}}},_initDragDrop:function(e){var t;e.addListener("dragstart",function(e){var i,n=e.getDragTarget();if(n instanceof cv.ui.manager.tree.VirtualElementItem){(i=n.getModel()).setDragging(!0);if(!i.isEditable()||!i.isDeletable()){e.preventDefault();e.stopPropagation();return}e.addAction("copy");i.isDeletable()&&e.addAction("move");e.addType("cv/tree-element");e.addData("cv/tree-element",i);t=i}this.setDragging(!0)},this);var i=this.getChildControl("add-button");i.addListener("dragstart",function(e){e.addAction("copy");e.addType("cv/new-tree-element");this.setDragging(!0)},this);var n=cv.ui.manager.editor.Tree.Allowed,a={mode:0,target:null};e.addListener("dragover",function(t){var i,r=this,o=t.getCurrentAction();t.supportsType("cv/tree-element")&&(i=t.getData("cv/tree-element"));var l="copy"===o&&!i&&t.supportsType("cv/new-tree-element"),c=t.getTarget();if(c!==s){if("copy"!==o&&c&&c instanceof cv.ui.manager.tree.VirtualElementItem){if(c.getModel()===i){this.debug("dropping on same element forbidden");a.mode=n.NONE;t.preventDefault();return}if(i&&i.isAncestor(c.getModel())){this.debug("moving inside own subtree forbidden");a.mode=n.NONE;t.preventDefault();return}}if(c===e){var d=e.getPane().getLayers()[0].getContentLocation();if(d&&t.getDocumentTop()-d.bottom<=20){var u=document.elementFromPoint(Math.round((d.left+d.right)/2),d.bottom-20);if(c=qx.ui.core.Widget.getWidgetByElement(u))for(;c.isAnonymous();)c=c.getLayoutParent()}else c=null;if(!c||c===e){a.mode=n.NONE;t.preventDefault();this.debug("drop target not found");return}}if(l||i){var h=c.getModel(),g=h.getParent();a.target=h;if(g){var m=g.getSchemaElement();if(l){var f=m.getAllowedElements();if(Object.keys(f).length>0){var p=g.getAddableChildren();if(p.length>0)if(m.areChildrenSortable())a.mode=n.BEFORE|n.AFTER;else{var _=n.NONE,v=m.getAllowedElementsSorting();p.some(function(e){return!!((_|=r.__P_33_8(v,e,h.getName()))&n.BEFORE&&_&n.AFTER)});a.mode=_}}else{t.preventDefault();a.mode=n.NONE;this.debug("no children allowed here")}}else if(m.isChildElementAllowed(i.getName()))m.areChildrenSortable()?a.mode=n.BEFORE|n.AFTER:a.mode=this.__P_33_8(m.getAllowedElementsSorting(),i.getName(),h.getName());else{a.mode=n.NONE;this.debug("not allowed as child element of",g.getName())}}else a.mode=n.NONE;if(l?Object.keys(h.getSchemaElement().getAllowedElements(!0)).length>0:h.getSchemaElement().isChildElementAllowed(i.getName())){a.mode|=n.INSIDE;if(h.getSchemaElement().areChildrenSortable())a.mode|=n.FIRST_CHILD;else{var b=h.getSchemaElement().getFirstLevelElementSorting();if(b)if(i){var x=b[i.getName()];if(void 0!==x)if(0===x||0===h.getChildren().length)a.mode|=n.FIRST_CHILD;else{b[h.getChildren().getItem(0).getName()]>=x&&(a.mode|=n.FIRST_CHILD)}}else if(h.getChildren().length>0){var C=b[h.getChildren().getItem(0).getName()];void 0!==C&&C>0&&(a.mode|=n.FIRST_CHILD)}else Object.keys(b).length>0&&(a.mode|=n.FIRST_CHILD)}}if(a.mode===n.NONE){t.preventDefault();this.debug("dropping not accepted here")}}else{this.debug("drop not allowed here, no drag element");a.mode=n.NONE;t.preventDefault()}}else this.debug("dragging over indicator")},this);var r,o,s=this.getChildControl("drag-indicator");e.addListener("dragleave",function(e){if(r){r.stop();r=null}},this);var l=e.getPane(),c=function(t){var i=-1e3,c=-1e3,d="",u=t.getManager().getCursor();u||(u=qx.ui.core.DragDropCursor.getInstance());"touch"===t._native.pointerType&&(u.hasState("touch")||u.addState("touch"));if(a.mode!==n.NONE){var h=document.elementFromPoint(t.getDocumentLeft(),t.getDocumentTop()),g=qx.ui.core.Widget.getWidgetByElement(h),m=!1;if(!g)return;for(;g.isAnonymous();)g=g.getLayoutParent();var f=g.getContentLocation(),p=f.left;if(g instanceof cv.ui.manager.tree.VirtualElementItem){p=g._getChildren()[0].getWidth()+g.getPaddingLeft();s.setWidth(g.getBounds().width-p);a.target&&g.getModel()!==a.target&&(m=!0);o=g}else{if(g===s)return;if(g===l){var _=o.getContentLocation();if(t.getDocumentTop()-_.bottom<=20&&a.mode&n.AFTER){i=o._getChildren()[0].getWidth()+o.getPaddingLeft();c=_.bottom;d="after"}m=!0}else m=!0}if(!m)if(t.getDocumentTop()-f.top<=5){if(r){r.stop();r=null}if(a.mode&n.BEFORE){i=p;c=f.top;d="before"}else if(a.mode&n.INSIDE){i=-1e3;c=-1e3;d="inside"}}else if(f.bottom-t.getDocumentTop()<=5){if(a.target&&!a.target.isOpen()){if(a.mode&n.AFTER){i=p;c=f.bottom;d="after"}else if(a.mode&n.INSIDE){i=-1e3;c=-1e3;d="inside"}}else if(a.mode&n.FIRST_CHILD){i=p+19;s.setWidth(s.getWidth()-19);c=f.bottom;d="first-child"}else this.debug("not allowed as first child");if(r){r.stop();r=null}}else if(a.target&&a.target.isOpen()){if(a.mode&n.FIRST_CHILD){if("first-child"!==s.getUserData("position")){i=p+19;s.setWidth(s.getWidth()-19)}c=f.bottom;d="first-child"}}else{s.setDomPosition(-1e3,-1e3);a.mode&n.INSIDE&&(d="inside");r||(r=qx.event.Timer.once(function(){a.target&&e.openNode(a.target)},this,1e3))}}s.setDomPosition(i,c);s.setUserData("position",d);if(!d&&u.getAction()){s.setUserData("action",t.getCurrentAction());u.resetAction();console.assert(i<0);console.assert(c<0)}else if(d&&!u.getAction()&&u.getAction()!==s.getUserData("action")){u.setAction(s.getUserData("action"));s.setUserData("action",null)}};e.addListener("drag",c,this);i.addListener("drag",c,this);var d=function(e){var t=e.getCurrentAction(),i=e.supportsType("cv/tree-element")?e.getData("cv/tree-element"):null;"copy"===t&&(i?i=i.clone():t="add");var r=i?i.getDisplayName():"new",o=a.target;if("move"!==t||i!==o)switch(s.getUserData("position")){case"after":if(a.mode&n.AFTER){this.debug(t,r,"after",o.getDisplayName());switch(t){case"move":i.moveAfter(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved after "%2"',r,o.getDisplayName()));break;case"copy":i.insertAfter(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied after "%2"',r,o.getDisplayName()));break;case"add":this._onCreate(o,s.getUserData("position"))}}else this.debug("NOT ALLOWED",t,r,"after",o.getDisplayName());break;case"before":if(a.mode&n.BEFORE){this.debug(t,r,"before",o.getDisplayName());switch(t){case"move":i.moveBefore(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved before "%2"',r,o.getDisplayName()));break;case"copy":i.insertBefore(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied before "%2"',r,o.getDisplayName()));break;case"add":this._onCreate(o,s.getUserData("position"))}}else this.debug("NOT ALLOWED",t,r,"after",o.getDisplayName());break;case"first-child":if(a.mode&n.FIRST_CHILD){this.debug(t,r,"into",o.getDisplayName(),"as first child");switch(t){case"move":i.moveBefore(o.getChildren().getItem(0))&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved into "%2" as first child',r,o.getDisplayName()));break;case"copy":i.insertBefore(o.getChildren().getItem(0))&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied into "%2" as first child',r,o.getDisplayName()));break;case"add":this._onCreate(o,s.getUserData("position"))}}else this.debug("NOT ALLOWED",r,"into",o.getDisplayName()+" as first child");break;case"inside":if(a.mode&n.INSIDE){this.debug(t,r,"into",o.getDisplayName(),"as child");switch(t){case"move":i.moveInside(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved into "%2"',r,o.getDisplayName()));break;case"copy":o.insertChild(i,-1,!1,"added")&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied into "%2"',r,o.getDisplayName()));break;case"add":this._onCreate(o,s.getUserData("position"))}}else this.debug("NOT ALLOWED",r,"into",o.getDisplayName(),"as child")}}.bind(this);e.addListener("drop",d,this);s.addListener("drop",d,this);var u=function(e){s.setDomPosition(-1e3,-1e3);s.resetUserData();if(r){r.stop();r=null}if(t){t.resetDragging();t=null}a.target=null;a.mode=0;var i=e.getManager().getCursor();i||(i=qx.ui.core.DragDropCursor.getInstance());i.hasState("touch")&&i.removeState("touch");this.setDragging(!1)};e.addListener("dragend",u,this);i.addListener("dragend",u,this)},_onCreate:function(e,t,i){var n=this,a="inside"===t||"first-child"===t?e:e.getParent(),r=a.getSchemaElement(),o=a.getAddableChildren(!1);if(o.length>0){var s=a.getChildren();if(!r.areChildrenSortable()&&"inside"!==t&&s.length>0){var l=r.getFirstLevelElementSorting(),c=0,d=0;if("before"===t){d=l[e.getName()];var u=s.indexOf(e);if(u>0){for(var h=!1,g=u-1;g>=0;g--){var m=s.getItem(g);if(!m.getName().startsWith("#")&&m.getName()!==e.getName()){c=l[m.getName()];h=!0;break}}h||(c=d)}}else if("after"===t){c=l[e.getName()];var f=s.indexOf(e);if(f<s.length-1){for(var p=!1,_=f;_<s.length;_++){var v=s.getItem(_);if(!v.getName().startsWith("#")&&v.getName()!==e.getName()){d=l[v.getName()];p=!0;break}}p||(d=c)}else d=c+1}else if("first-child"===t){var b=s.getItem(0);d=l[b.getName()]}o=o.filter(function(e){return Object.prototype.hasOwnProperty.call(l,e)&&l[e]<=d&&l[e]>=c})}}if(o.length>0){this.__P_33_3=!0;(o.length>1?new cv.ui.manager.form.ElementForm({allowCancel:!0,context:this,message:this.tr("<p style='font-weight:bold'>Choose element</p><p>Several possible element can be created at this position, please select one to proceed.</p>"),formData:{type:{type:"SelectBox",label:this.tr("Choose element"),help:this.tr("Please choose the element you want to add here."),options:o.sort(function(e,t){return e.startsWith("#")&&!t.startsWith("#")?1:!e.startsWith("#")&&t.startsWith("#")?-1:e.localeCompare(t)}).map(function(e){return{label:e,value:e}}),validation:{required:!0}}}}).show().promise():Promise.resolve({type:o[0]})).then(function(i){if(i){var o,s=i.type,l=e.getNode().ownerDocument,c=!1;switch(s){case"#comment":o=l.createComment("");break;case"#text":o=l.createTextNode("");break;case"#cdata-section":o=l.createCDATASection("");break;default:o=l.createElement(s);c=!0}var d=r.getSchemaElementForElementName(s);c&&function e(t,i){var n=i.getRequiredElements();if(n.length>1&&!i.areChildrenSortable()){var a=i.getAllowedElementsSorting();n.sort(cv.ui.manager.model.schema.Element.sortChildNodes(a))}n.forEach(function(n){var a=l.createElement(n);t.appendChild(a);e(a,i.getSchemaElementForElementName(n))});if(i.isTextContentRequired()){var r=l.createTextNode("-");t.appendChild(r)}}(o,d);var u=new cv.ui.manager.model.XmlElement(o,d,e.getEditor(),a);u.load();var h=Promise.resolve(!0);u.isShowEditButton()&&(h=n._onEdit(null,u,!0));h.then(function(i){if(i){switch(t){case"before":u.insertBefore(e);break;case"after":u.insertAfter(e);break;case"inside":e.insertChild(u,-1,!1,"added");break;case"first-child":e.insertChild(u,0,!1,"added")}n.getChildControl("tree").openNodeAndParents(u);n.getChildControl("tree").setSelection([u])}},n).catch(function(e){return n.error(e)})}})}},__P_33_8:function(e,t,i,n){if(e){var a=e[t];a="string"==typeof a?a.split(".").map(function(e){return/^\d+$/.test(e)?parseInt(e):e}):[a];var r=e[i];r="string"==typeof r?r.split(".").map(function(e){return/^\d+$/.test(e)?parseInt(e):e}):[r];for(var o=Math.min(o||1,a.length,r.length),s=0;s<o;s++){if(a[s]===r[s])return cv.ui.manager.editor.Tree.Allowed.BEFORE|cv.ui.manager.editor.Tree.Allowed.AFTER;if(a[s]-1===r[s])return cv.ui.manager.editor.Tree.Allowed.AFTER;if(a[s]+1===r[s])return cv.ui.manager.editor.Tree.Allowed.BEFORE}}return cv.ui.manager.editor.Tree.Allowed.NONE},__P_33_9:function(e,t,i){var n=this,a=cv.ui.manager.editor.data.Provider.get(e);if(a){"function"==typeof a.getLive?t.options=a.getLive(i):a.data?t.options=a.data:this.error("misconfigured provider found for "+e);t.type=a.userInputAllowed?"VirtualComboBox":"VirtualSelectBox"}else if(["mapping","styling"].includes(e.split("@").pop())){var r=e.split("@").pop(),o=this.getChildControl("tree").getModel().getNode();t.type="SelectBox";t.options=[];o.querySelectorAll("meta > "+r+"s > "+r).forEach(function(e){var i=e.getAttribute("name");t.options.push({label:i,value:i})})}if(t.type.endsWith("SelectBox")){delete t.placeholder;t.validation.required||(t.options instanceof Promise?t.options.then(function(e){Array.isArray(e)&&e.unshift({label:" - "+n.tr("not set")+" - ",value:""})}).catch(function(){}):t.options.unshift({label:" - "+this.tr("not set")+" - ",value:""}))}},__P_33_10:function(e,t){var i=t.getDocumentation(),n={type:"TextField",label:t.getName(),placeholder:" - "+this.tr("not set")+" - ",help:i.join("<br/>"),enabled:e.isEditable(),value:e.getAttribute(t.getName())||t.getDefaultValue(),validation:{required:!t.isOptional(),validator:function(e){e instanceof qx.ui.form.ListItem&&(e=e.getModel().getValue());if(!t.isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}};switch(t.getTypeString()){case"boolean":n.type="CheckBox";n.value=""===n.value||null===n.value||void 0===n.value?null:"true"===n.value;delete n.placeholder;break;case"string":var a=t.getEnumeration();if(a.length>0){n.type="SelectBox";delete n.placeholder;n.options=[];a.forEach(function(e){n.options.push({label:e,value:e})});t.isOptional()&&n.options.unshift({label:" - "+this.tr("not set")+" - ",value:""})}else this.__P_33_9(e.getName()+"@"+t.getName(),n,e.getNode())}return n},_onEdit:function(e,t,i){var n,a,r=this;if(!this.getFile()||!this.getFile().isWriteable())return null;if(!t){if(!this.getSelected())return null;t=this.getSelected()}if(!t.getShowEditButton())return null;t.load();var o={},s=t.getSchemaElement();if(i){n=this.tr("Create new %1 element",t.getName());a=this.tr("Please edit the attributes of the new %1 element, that will be added to the chosen position.",t.getName())}else{n=this.tr("Edit element attributes");a=t.isEditable()?this.tr("Edit %1",t.getName()):this.tr("Show %1",t.getName())}if(t.getNode().nodeType===Node.ELEMENT_NODE){var l=s.getAllowedAttributes();Object.keys(l).forEach(function(e){var i=l[e];if(!r.getExpert()){if(i.getAppinfo().includes("level:expert"))return}o[e]=r.__P_33_10(t,i)});if(s.isChildElementAllowed("*")){var c=new DOMParser,d="custom"===t.getNode().nodeName?"#innerHTML":"#outerHTML";if(i){n=this.tr("Create new %1 element",t.getName());a=this.tr("Please edit the content of the new %1 element, that will be added to the chosen position.",t.getName())}else n="#outerHTML"===d?this.tr("Edit element and content"):this.tr("Edit element content");o[d]={type:"TextArea",label:"",lines:5,autoSize:!0,width:Math.min(qx.bom.Viewport.getWidth(),500),enabled:t.isEditable(),value:"#outerHTML"===d?t.getNode().outerHTML:t.getNode().innerHTML,validation:{validator:function(e){if(e){if(c.parseFromString(e,"text/xml").getElementsByTagName("parsererror").length>0)throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}}}}}else if(t.getNode().nodeType===Node.TEXT_NODE||t.getNode().nodeType===Node.COMMENT_NODE||t.getNode().nodeType===Node.CDATA_SECTION_NODE){n=this.tr("Edit text content",t.getName());a="";var u=t.getNode().nodeName,h=s.getDocumentation();o[u]={type:"TextArea",label:"",lines:1,autoSize:!0,width:Math.min(qx.bom.Viewport.getWidth(),500),placeholder:this.tr("not set"),help:h.join("<br/>"),enabled:t.isEditable(),value:t.getTextContent(),validation:{validator:function(e){e instanceof qx.ui.form.ListItem&&(e=e.getModel().getValue());if(!s.isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}};if(t.isTextNode()&&"status"===t.getParent().getName()){var g=t.getParent().getAttribute("type");if(("html"===g||"xml"===g)&&t.getNode().nodeType===Node.TEXT_NODE){t.convertTextNodeType(Node.CDATA_SECTION_NODE);var m=t.getNode().nodeName;o[m]=o[u];delete o[u];u=m}}this.__P_33_9(t.getParent().getName()+"@"+t.getName(),o[u],t.getNode())}this.__P_33_3=!0;var f=new cv.ui.manager.form.ElementForm({allowCancel:!0,context:this,caption:n,message:a,formData:o,minWidth:Math.min(qx.bom.Viewport.getWidth(),400),maxWidth:qx.bom.Viewport.getWidth()}).show();return f.promise().then(function(e){if(e&&t.isEditable()){t.setAttributes(e);r.clearReDos();Object.prototype.hasOwnProperty.call(e,"#outerHTML")||Object.prototype.hasOwnProperty.call(e,"#innerHTML")||t.validate()}r.__P_33_3=!1;f.destroy();return e})},_onDelete:function(e,t){t||(t=this.getSelected());if(t&&t.isDeletable()){t.remove();this.clearReDos();return t}return null},_onCut:function(){if(this.__P_33_3)document.execCommand("cut");else{var e=this._onDelete();e&&this.setClipboard(e)}},_onCopy:function(){if(this.__P_33_3)document.execCommand("copy");else{var e=this.getSelected();if(e){var t=e.clone();this.setClipboard(t)}}},_onPaste:function(){var e=this.getSelected(),t=this.getClipboard();e&&t&&e.insertChild(t,-1,!1,"added")&&this.resetClipboard()},updateModified:function(e){var t=this.__P_33_0.indexOf(e),i=this.__P_33_1.indexOf(e);if(e.$$removed){t>=0&&this.__P_33_0.splice(t,1);i>=0&&this.__P_33_1.splice(t,1)}else if(e.isModified()){-1===t&&this.__P_33_0.push(e);-1===i&&this.__P_33_1.push(e)}else{t>=0&&this.__P_33_0.splice(t,1);i>=0&&this.__P_33_1.splice(t,1)}this.getFile().setModified(this.__P_33_0.length>0);this._onContentChanged()},_draw:function(){var e=this.getChildControl("toolbar");this._createChildControl("searchbar");this.hasChildControl("add-button")||this._createChildControl("add-button");e.addSeparator();this._createChildControl("edit-button");this._createChildControl("delete-button");this._createChildControl("toggle-expert");e.addSpacer();this._createChildControl("refresh-preview");this.hasChildControl("tree")||this._createChildControl("tree");this.hasChildControl("right")||this._createChildControl("right");this.hasChildControl("preview-sync-hint")||this._createChildControl("preview-sync-hint");this.hasChildControl("preview")||this._createChildControl("preview")},_applySelected:function(e,t){t&&t.removeRelatedBindings(this.getChildControl("delete-button"));if(e){this.getChildControl("edit-button").setEnabled(e.getShowEditButton());this.getFile().isWriteable()&&e.bind("deletable",this.getChildControl("delete-button"),"enabled")}else{this.getChildControl("edit-button").setEnabled(!1);this.getChildControl("delete-button").setEnabled(!1)}this._updateHighlightWidget()},_updateHighlightWidget:function(){var e=this.getSelected();if(this.isShowPreview()){var t=this.getChildControl("preview");if("structureChanged"!==this.getPreviewState()&&e){for(var i=[],n=e.getNode();n&&"pages"!==n.nodeName;){"page"===n.nodeName&&i.unshift(n.getAttribute("name"));n=n.parentNode}i.length>0&&t.openPage(i.pop(),i.join("/"));t.setHighlightWidget(e.getWidgetPath())}else t.setHighlightWidget(null)}},_onElementKeyUp:function(e){this.getSelected()&&this.isVisible()&&"Enter"===e.getKeyIdentifier()&&(this.__P_33_3||this._onEdit())},_applyContent:function(e){var t=this,i=this.getChildControl("tree"),n=this.getFile();this._updatePreview(null,null,!0);if(e&&n){if(this._workerWrapper){this._workerWrapper.open(n,e,null,{validate:!1,initialValidation:!0,modified:!1});this._workerWrapper.validateXmlConfig(e).then(function(i){if(!0===i){t.info(n.getPath()+" is a valid config file");t.__P_33_11(e)}else{var a=new cv.ui.manager.dialog.ValidationError(n,e,i);a.addListener("action",function(n){switch(n.getData()){case"proceed":t.__P_33_11(e,i);break;case"open-source":var r=t.getFile();cv.ui.manager.Main.getInstance().closeFile(r);qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:r.getFullPath(),handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}});break;case"cancel":cv.ui.manager.Main.getInstance().closeFile(t.getFile())}a.hide();a.destroy()},t);a.show()}})}}else{i.resetModel();this.hasChildControl("add-button")&&this.getChildControl("add-button").setEnabled(!1)}},__P_33_6:function(){var e;cv.ui.manager.model.FileItem.ROOT.getChildren().some(function(t){if("visu_config_previewtemp.xml"===t.getName()){e=t;return!0}return!1});e||(e=new cv.ui.manager.model.FileItem("visu_config_previewtemp.xml","/",this.getFile().getParent())).setTemporary(!0);return e},__P_33_11:function(e,t){var i=this,n=this.getChildControl("tree"),a=this.getFile();if(a){var r=qx.xml.Document.fromString(e),o=this._schema.getElementNode(r.documentElement.nodeName),s=new cv.ui.manager.model.XmlElement(r.documentElement,o,this);s.setEditable(a.getWriteable());s.load();n.setModel(s);if(this.hasChildControl("add-button")){this.getChildControl("add-button").setVisibility(a.getWriteable()?"visible":"excluded");n.setContentPaddingBottom(a.getWriteable()?80:0)}if(this.isShowPreview()){var l=this.getChildControl("preview");a.isWriteable()?l.getFile()||l.setFile(this.__P_33_6()):l.setFile(a);this._updatePreview(null,e);l.isVisible()||l.show()}a.isTemporary()&&this._onContentChanged();t&&t.forEach(function(e){if(e.path&&e.path.startsWith("/pages")){for(var t=s,a=e.path.substr(1).split("/");a.length>0;){var r=a.shift(),o=/^([^[]+)\[(\d+)\]$/.exec(r);if(!o){i.error("patch segment format error: "+r);t=null;break}if(!(t=t.getChildren().getItem(parseInt(o[2]))))break;try{t.load()}catch(e){i.error("Error loading "+t.getName()+": "+e.toString());t=null;break}}if(t){t.setValid(!1);t.validate(!1);n.openNodeAndParents(t)}}})}},_onContentChanged:function(){var e=this.getCurrentContent();this._workerWrapper&&this._workerWrapper.contentChanged(this.getFile(),e);this.isAutoRefreshPreview()&&this.isShowPreview()&&this._updatePreview(null,e)},_updatePreview:function(e,t,i){var n=this,a=this.getChildControl("preview").getFile();if(a){if(t||i){if(!0===i){this.getChildControl("preview").hide();return}}else t=this.getCurrentContent(!0);this.getChildControl("preview").show();a.isTemporary()?this._client.createSync({path:a.getFullPath(),hash:"ignore"},t,function(e){if(e){n.setShowPreview(!1);n.error(e);cv.ui.manager.snackbar.Controller.error(n.tr("Disabling preview because the preview file could not be created."))}else{qx.event.message.Bus.dispatchByName(a.getBusTopic(),{type:"contentChanged",file:a,data:t,source:n});n.__P_33_1.removeAll();n.resetPreviewState();a.resetTemporary()}},this):this._client.updateSync({path:a.getFullPath(),hash:"ignore"},t,function(e){if(e)cv.ui.manager.snackbar.Controller.error(e);else{qx.event.message.Bus.dispatchByName(a.getBusTopic(),{type:"contentChanged",file:a,data:t,source:n});n.__P_33_1.removeAll();n.resetPreviewState()}},this)}},getCurrentContent:function(e){var t=this.getChildControl("tree");if(t.getModel()){var i=t.getModel().getNode();return e?(new XMLSerializer).serializeToString(i.ownerDocument):'<?xml version="1.0" encoding="UTF-8"?>\n'+this._prettify(i,0)}return null},_prettify:function(e,t,i){var n=Array(t).fill("  ").join("");if(e.nodeType===Node.TEXT_NODE)return e.textContent.trim()?(i?"":n)+qx.xml.String.escape(e.textContent)+(i?"":"\n"):"";if(e.nodeType===Node.COMMENT_NODE)return(i?"":n)+"\x3c!--".concat(e.textContent,"--\x3e ").concat(i?"":"\n");if(e.nodeType===Node.CDATA_SECTION_NODE)return(i?"":n)+"<![CDATA[".concat(e.textContent,"]]> ").concat(i?"":"\n");if(!e.tagName)return this._prettify(e.firstChild,t);for(var a=(i?"":n)+"<".concat(e.tagName),r=0;r<e.attributes.length;r++)a+=" ".concat(e.attributes[r].name,'="').concat(e.attributes[r].value,'"');if(0===e.childNodes.length)return a+" />"+(i?"":"\n");a+=">";var o=Array.prototype.some.call(e.childNodes,function(e){return e.nodeType===Node.TEXT_NODE&&e.textContent.trim()});i||o||(a+="\n");for(var s=0;s<e.childNodes.length;s++)a+=this._prettify(e.childNodes[s],t+1,o);return a+(o||i?"":n)+"</".concat(e.tagName,">")+(i?"":"\n")},_onSaved:function(){cv.ui.manager.editor.Tree.prototype._onSaved.base.call(this);this.__P_33_0.forEach(function(e){return e.onSaved()});this.__P_33_0=[];this.clearUnDosReDos()},isSupported:function(e){return cv.ui.manager.editor.Tree.SUPPORTED_FILES.test(e.getName())},_showHelp:function(){var e=qx.ui.core.FocusHandler.getInstance().getFocusedWidget(),t={caption:this.tr("Help"),modal:!0,image:"qxl.dialog.icon.info",minWidth:Math.min(600,qx.bom.Viewport.getWidth()),maxHeight:qx.bom.Viewport.getHeight(),message:""};e===this.getChildControl("searchbar")?t.message=this.tr("<h3>Search for elements</h3><p>You can search for element names (tag names or content of name attribute) by typing a search value here. All elements whose tag name or name-attribute start with the search term will be found</p><p>Search will start automatically when the search term is at least 2 characters long.</p><p>The first found element will be opened and selected in the element tree. You can jump to the next found element with 'Enter' or the 'Down' key. Accordingly you can jump the the previous found element with the 'Up' key.</p>"):t.message=this.tr("<h3>CometVisu XML-Editor - a brief introduction</h3><p>The CometVisu XMl-Editor shows the content of a CometVisu config file in a tree-like structure. You can traverse through the tree by opening/closing elements with a click on the expand icon.</p><p>The Xml-Editor will make sure that you do not create an invalid configuration file. If you experience a change that has not been accepted / or is not allowed that is most likely due to avoid an invalid configuration.</p><h4>Editing attributes</h4><p>The elements attributes can be edited by double clicking on it or selecting an element and clicking on the 'edit'-button in the toolbar above the tree of by right-clicking on the element and the 'edit'-button in the context menu</p><h4>Editing elements</h4><p>The elements in the tree support re-ordering via drag & drop. You can also cut/copy or paste them. You can add new elements by starting a drag in the round + button on the bottom of the tree, or by right clicking on an element and choosing the 'add child'-button.</p><p>You can delete elements by the delete buttons in the toolbar</p><h4>Expert view</h4><p>Some attributes are hidden in the editing dialog, because they provide access to settings that usually are not needed that often. You can access these attributes by toggling to the 'Expertview'-button in the toolbar directly above the tree.</p><h4>Config preview</h4><p>An preview of the edited config file is shown on the right part of the screen. The preview will not automatically refresh after you have changed something. You can refresh is manually by clicking the most right button in the toolbar.</p>");new cv.ui.manager.dialog.BigAlert(t).show()}},destruct:function(){this._schema=null;this._workerWrapper=null;this._disposeArray("__P_33_0","__P_33_1");qx.core.Init.getApplication().getRoot().removeListener("keyup",this._onElementKeyUp,this)}});cv.ui.manager.editor.Tree.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.Source":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.model.CompareFiles":{},"cv.ui.manager.model.FileItem":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"cv.ui.manager.Main":{},"qxl.dialog.Dialog":{},"qx.bom.Viewport":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Diff",{extend:cv.ui.manager.editor.Source,construct:function(){cv.ui.manager.editor.Source.constructor.call(this)},statics:{COUNTER:0,TITLE:qx.locale.Manager.tr("File compare"),ICON:cv.theme.dark.Images.getIcon("compare",18)},properties:{originalContent:{check:"String",init:"",apply:"_applyContent"},modifiedContent:{check:"String",init:"",apply:"_applyContent"},editable:{check:"Boolean",init:!1,apply:"_applyEditable"}},members:{_applyEditable:function(e){this._editor&&this._editor.updateOptions({readOnly:!e})},_initWorker:function(){},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.createDiffEditor(e,{folding:!0,autoIndent:!0,automaticLayout:!0,theme:"vs-dark",readOnly:!this.getEditable()});this.getFile()&&this._loadFile(this.getFile())}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},_applyContent:function(){var e=this.getOriginalContent(),t=this.getModifiedContent();if(e&&t){var i=this.getFile(),n=i instanceof cv.ui.manager.model.CompareFiles?i.getOriginalFile():i,a=i instanceof cv.ui.manager.model.CompareFiles?i.getModifiedFile():i,r=window.monaco.editor.createModel(e,this._getLanguage(n));r.updateOptions(this._getDefaultModelOptions());var o=window.monaco.editor.createModel(t,this._getLanguage(a));o.updateOptions(this._getDefaultModelOptions());this._editor.setModel({original:r,modified:o})}},getCurrentContent:function(){return this._editor.getModifiedEditor().getValue()},clear:function(){this._editor.getModel().original.dispose();this._editor.getModel().modified.dispose()},save:function(e){var t=this.getHandlerOptions();this.getFile()instanceof cv.ui.manager.model.FileItem&&Object.prototype.hasOwnProperty.call(t,"upgradeVersion")&&!0===t.upgradeVersion&&cv.ui.manager.editor.Diff.prototype.save.base.call(this,e,"ignore")},_loadFile:function(e,t){t&&t instanceof cv.ui.manager.model.FileItem&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(this._editor){var i=this.getHandlerOptions();if(e&&e instanceof cv.ui.manager.model.FileItem&&Object.prototype.hasOwnProperty.call(i,"upgradeVersion")&&!0===i.upgradeVersion){if(!e.isWriteable()){cv.ui.manager.snackbar.Controller.error(this.tr('"%1" is not writable. Upgrading not possible.',this.getFile().getFullPath()));cv.ui.manager.Main.getInstance().closeFile(e);return}qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this);this.setEditable(e.isWriteable());this._client.readSync({path:e.getFullPath()},function(t,i){if(t)cv.ui.manager.snackbar.Controller.error(t);else{this.setOriginalContent(i);var n=this._upgradeConfig(i),a=_slicedToArray(n,3),r=a[0],o=a[1],s=a[2];if(r){qxl.dialog.Dialog.error(r);qx.event.message.Bus.dispatchByName("cv.manager.action.close")}else{this.setModifiedContent(this._convertToString(o));var l=s.length>0?"<div>"+qx.locale.Manager.tr("The following changes have been made")+"</div><ul><li>"+s.join("</li><li>")+"</li></ul><div>"+qx.locale.Manager.tr("You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.")+"</div>":"<div><strong>"+qx.locale.Manager.tr("No changes have been made")+"</strong></div>",c="<h3>"+qx.locale.Manager.tr("Config file has been upgraded to the current library version.").translate().toString()+"</h3>"+l+"<div>"+qx.locale.Manager.tr('Click "Apply" if you want to save the changes and reload the browser.')+"</div><div>"+qx.locale.Manager.tr('Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.')+"</div>";qxl.dialog.Dialog.confirm(c,function(e){e&&this.save(function(){window.location.hash="";window.location.reload()})},this,qx.locale.Manager.tr("Upgrade successful")).set({width:Math.min(qx.bom.Viewport.getWidth(),600),yesButtonLabel:qx.locale.Manager.tr("Apply"),noButtonLabel:qx.locale.Manager.tr("Check")});e.setModified(!0)}}},this)}else if(e&&e instanceof cv.ui.manager.model.CompareFiles&&this.isSupported(e.getModifiedFile())){this.resetEditable();this._client.readSync({path:e.getModifiedFile().getFullPath()},function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setModifiedContent(t)},this);this._client.readSync({path:e.getOriginalFile().getFullPath()},function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setOriginalContent(t)},this)}else{this.resetOriginalContent();this.resetModifiedContent()}}}}});cv.ui.manager.editor.Diff.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.locale.Manager":{require:!0},"cv.io.rest.Client":{},"cv.ui.manager.model.config.Section":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"qx.data.Array":{},"cv.ui.manager.form.SectionListItem":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Config",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save"];this._setLayout(new qx.ui.layout.VBox(8));this._createChildControl("list");this._createChildControl("add-section")},statics:{TITLE:qx.locale.Manager.tr("Hidden configuration")},properties:{appearance:{refine:!0,init:"cv-editor-config"}},members:{_model:null,_listController:null,__P_31_0:0,_initClient:function(){this._client=cv.io.rest.Client.getConfigClient();this._client.addListener("getSuccess",this._onModelValueChange,this);this._client.addListener("updateSuccess",this._onSaved,this)},_loadFile:function(e){e&&this._client.get({section:"*",key:"*"})},_onModelValueChange:function(e){this.getFile()&&this.setContent(e.getData())},_applyContent:function(e){var t=this._listController.getModel();t.removeAll();this.__P_31_0=Object.keys(e).length;Object.keys(e).forEach(function(i){var n=new cv.ui.manager.model.config.Section(i);Object.keys(e[i]).forEach(function(t){n.addOption(t,e[i][t])},this);t.push(n)},this);this.__P_31_1()},getCurrentContent:function(){return this.getContent()},_onDeleteSection:function(e){if(this.getFile()&&this.getFile().isWriteable()){var t=e.getData();this._listController.getModel().remove(t);this.__P_31_1()}},__P_31_1:function(){var e=this.getFile();if(this.__P_31_0===this._listController.getModel().length){var t=this.getChildControl("list").getChildren().some(function(e){return e.isModified()},this);e.setModified(t)}else e.setModified(!0)},save:function(){if(this.getFile()&&this.getFile().isWriteable()){var e=[],t=!0;this._listController.getModel().forEach(function(i){var n=i.getName();if(e.includes(n)){t=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Section name duplicate: "%1".',n))}else e.push(n);var a=[];i.getOptions().forEach(function(e){var i=e.getKey();if(a.includes(i)){t=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Option key duplicate: "%1" in section "%2".',i,n))}else a.push(i)},this)},this);if(t){var i={};this._listController.getModel().forEach(function(e){var t={};e.getOptions().forEach(function(e){t[e.getKey()]=e.getValue()});i[e.getName()]=t},this);this._client.saveSync(null,i,function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}},this)}else cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Section is invalid and has not been saved."))}else cv.ui.manager.snackbar.Controller.info(this.tr("Hidden configuration file (hidden.php) not writeable"))},_createChildControlImpl:function(e){var t;switch(e){case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(new qx.data.Array,t);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.SectionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteSection,this);e.addListener("changeModified",this.__P_31_1,this)}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i);this.bind("file.writeable",t,"readOnly",{converter:function(e){return!e}})}.bind(this)});this._add(t,{flex:1});break;case"buttons":t=new qx.ui.container.Composite(new qx.ui.layout.HBox(8));this._add(t);break;case"add-section":(t=new qx.ui.form.Button(this.tr("Add section"))).addListener("execute",function(){this._listController.getModel().push(new cv.ui.manager.model.config.Section(""));this.__P_31_1()},this);this.bind("file.writeable",t,"visibility",{converter:function(e){return e?"visible":"excluded"}});this.getChildControl("buttons").add(t)}return t||cv.ui.manager.editor.Config.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_model","_listController")}});cv.ui.manager.editor.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.data.FileWorker":{construct:!0},"qx.xml.Document":{},"qx.log.Logger":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Worker",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._files={};this._worker=cv.data.FileWorker.getInstance();this._worker.addListener("message",this._onMessage,this)},properties:{editor:{check:"cv.ui.manager.editor.AbstractEditor",nullable:!0}},members:{_worker:null,_files:null,open:function(e,t,i,n){this._worker.postMessage(["openFile",{path:e.getFullPath(),code:qx.xml.Document.isXmlDocument(t)?t.documentElement.outerHTML:t,schema:i},n]);this._files[e.getFullPath()]=e},close:function(e){this._worker.postMessage(["closeFile",{path:e.getFullPath()}]);delete this._files[e.getFullPath()]},contentChanged:function(e,t){this._worker.postMessage(["contentChange",{path:e.getFullPath(),code:t}])},validateConfig:function(e){if(e.isConfigFile())return this._worker.validateConfig(e.getServerPath());qx.log.Logger.error(this,e.getFullPath()+" is no configuration file");return!0},validateXmlConfig:function(e){return this._worker.validateXmlConfig(e)},_onMessage:function(e){var t=e.getData().topic,i=e.getData().data,n=e.getData().path,a=this._files[n];if(a||"validationResult"===t){var r=this.getEditor();switch(t){case"modified":a.isTemporary()||a.setModified(i.modified);a.setHash(i.currentHash);break;case"hash":a.setHash(i);break;case"errors":a.setValid(!i||0===i.length);r&&r.showErrors(n,i);break;case"decorations":r&&r.showDecorations(n,i)}}else qx.log.Logger.error(this,"no file found for path "+n+" ignoring worker message for topic "+t)}},destruct:function(){this._worker.terminate();this._worker=null}});cv.ui.manager.editor.Worker.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.tree.FileSystem":{},"qxl.dialog.Dialog":{},"qx.lang.String":{},"qx.event.message.Bus":{},"cv.ui.manager.viewer.Image":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.theme.dark.Images":{},"qx.ui.basic.Atom":{},"qx.ui.basic.Label":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{},"cv.ui.manager.control.FileController":{},"qx.event.type.Tap":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileListItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],include:[cv.ui.manager.upload.MDragUpload],construct:function(e,t,i){qx.ui.core.Widget.constructor.call(this,e,t);var n=new qx.ui.layout.Canvas;n.setDesktop(!0);this._setLayout(n);i&&this.setModel(i);this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this);cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._maintainFileActions,this);this.setUploadHint(this.tr("Drop the file here to replace the content."))},events:{action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0,check:"cv.ui.manager.model.FileItem"},showFileActions:{check:"Boolean",init:!1,apply:"_maintainFileActions"},label:{nullable:!0,check:"String",event:"changeLabel"},icon:{check:"String",nullable:!0,themeable:!0,event:"changeIcon"},gap:{check:"Integer",nullable:!1,event:"changeGap",themeable:!0,init:4},show:{init:"both",check:["both","label","icon"],themeable:!0,inheritable:!0,event:"changeShow"},iconPosition:{init:"left",check:["top","right","bottom","left","top-left","bottom-left","top-right","bottom-right"],themeable:!0,event:"changeIconPosition"},center:{init:!1,check:"Boolean",themeable:!0,event:"changeCenter"},acceptUpload:{init:null,nullable:!0,check:"String"},viewMode:{check:["list","preview"],init:"preview",apply:"_applyViewMode"}},members:{_uploadManager:null,_forwardStates:{focused:!0,selected:!0,dragover:!0,hovered:!0},_applyViewMode:function(){switch(this.getViewMode()){case"list":this.addState("list");this.getChildControl("atom").setLayoutProperties({left:10,top:0,bottom:0,right:null});this.getChildControl("bottom-bar").setLayoutProperties({top:0,bottom:0,right:0,left:null});break;case"preview":this.removeState("list");this.getChildControl("atom").setLayoutProperties({left:0,top:0,bottom:34,right:0});this.getChildControl("bottom-bar").setLayoutProperties({left:0,bottom:0,right:0,top:null})}},_onPointerOver:function(){this.addState("hovered")},_onPointerOut:function(){this.removeState("hovered")},_isDroppable:function(e){if(1===e.length){return"add-file"===this.getModel().getSpecial()||cv.ui.manager.tree.FileSystem.getMimetypeFromSuffix(this.getModel().getName().split(".").pop())===e[0].type}return!1},_onDrop:function(e){e.preventDefault();"add-file"===this.getModel().getSpecial()?cv.ui.manager.upload.MDragUpload.uploadFile(cv.ui.manager.upload.MDragUpload.getFiles(e)[0]):qxl.dialog.Dialog.confirm(this.tr("Do you really want to replace the '%1' with the uploaded files content?",this.getModel().getName()),function(t){if(t){var i=cv.ui.manager.upload.MDragUpload.getFiles(e)[0];cv.ui.manager.upload.MDragUpload.uploadFile(i,this.getModel())}},this);this._onStopDragging(e)},_applyModel:function(e){if(e&&"file"===e.getType()){var t=this.getChildControl("file-type");if(!e.isFake()){var i=e.getName();this.getChildControl("atom").setToolTipText(this.tr('Double click to open "%1"',i));var n=i.split(".").pop();if(n.length<=4){var a=!1;switch(n){case"xml":t.setValue("</>");a=!0;break;case"js":n=qx.lang.String.firstUp(n);case"css":case"conf":t.setValue(n);a=!0}a&&"preview"===this.getViewMode()?t.show():t.exclude()}else t.exclude()}}else{this.getChildControl("file-type").exclude();this.getChildControl("atom").resetToolTipText()}this._maintainFileActions()},_onOpenWith:function(e){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this.getModel(),handler:t})},_applyIcon:function(e,t){cv.ui.manager.form.FileListItem.prototype._applyIcon.base.call(this,e,t);if(e&&!e.startsWith("@")){var i=this.getChildControl("atom").getChildControl("icon");cv.ui.manager.viewer.Image.getImageData(e)?this.__P_37_0():i.addListenerOnce("loaded",this.__P_37_0,this)}},_maintainFileActions:function(){var e=this.getModel();if(this.isShowFileActions()&&e){this.getChildControl("download-button").setVisibility("dir"===e.getType()||e.isFake()?"excluded":"visible");this.getChildControl("action-button").setVisibility(e.isFake()?"excluded":"visible");var t=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"edit"),i=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"view"),n=this.getChildControl("open-button"),a=this.getChildControl("edit-button");if(e.isWriteable()&&t){a.setUserData("handlerId",t.Clazz.classname);a.set({icon:t.Clazz.ICON||cv.theme.dark.Images.getIcon("edit",18),enabled:!0,toolTipText:t.Clazz.TITLE?t.Clazz.TITLE.translate().toString():""});a.show()}else a.exclude();if(i){n.setUserData("handlerId",i.Clazz.classname);n.set({icon:i.Clazz.ICON||cv.theme.dark.Images.getIcon("preview",18),enabled:!0,toolTipText:i.Clazz.TITLE?i.Clazz.TITLE.translate().toString():""});n.show()}else n.exclude();this.getChildControl("action-button");this.getChildControl("bottom-bar").show()}else this.getChildControl("bottom-bar").exclude()},__P_37_0:function(){var e=cv.ui.manager.viewer.Image.getImageData(this.getIcon()),t=this.getChildControl("atom").getChildControl("icon"),i=t.getSizeHint(),n=i.width,a=Math.round(1/e.aspectRatio*n),r=[0,0,0,0];if(a>i.height){a=i.height;n=Math.round(e.aspectRatio*a);r[1]=Math.round((i.width-n)/2);r[3]=r[1]}else{r[0]=Math.round((i.height-a)/2);r[2]=r[0]}t.setPadding(r)},_maintainFileTypePosition:function(){var e=this.getChildControl("atom").getChildControl("icon").getBounds(),t=Math.round(e.top+e.height/2);this.getChildControl("file-type").setLayoutProperties({left:e.left,top:t,right:e.left+e.width,bottom:t+18})},_createChildControlImpl:function(e){var t;switch(e){case"atom":t=new qx.ui.basic.Atom;["label","icon","gap","iconPosition","show","center"].forEach(function(e){this.bind(e,t,e)},this);t.setAnonymous(!0);this._add(t,{top:0,left:0,right:0,bottom:34});break;case"file-type":(t=new qx.ui.basic.Label).set({zIndex:100,anonymous:!0,font:"title",textAlign:"center",textColor:"background-main",minWidth:70});var i=this.getChildControl("atom").getChildControl("icon");i.bind("visibility",t,"visibility");i.addListener("resize",this._maintainFileTypePosition,this);this._add(t,{width:"100%"});break;case"bottom-bar":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox(4,"center"))).setAnonymous(!0);this._add(t,{left:0,bottom:0,right:0});break;case"download-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("download",18))).setToolTipText(this.tr("Download file"));t.addListener("execute",function(){cv.ui.manager.control.FileController.getInstance().download(this.getModel())},this);this.getChildControl("bottom-bar").add(t);break;case"action-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("menu",18))).setToolTipText(this.tr("Other file actions"));this.getChildControl("bottom-bar").add(t);t.addListener("tap",function(e){this.fireEvent("action",qx.event.type.Tap,[e.getNativeEvent(),this,e.getTarget(),!1,!0])},this);break;case"open-button":case"edit-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("preview",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this.getModel(),handler:t.getUserData("handlerId")})},this);this.getChildControl("bottom-bar").add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.form.FileListItem.prototype._createChildControlImpl.base.call(this,e)},capture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.prototype.capture.base.call(this)},releaseCapture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.prototype.releaseCapture.base.call(this)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this);this._disposeObjects("_uploadManager");cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._maintainFileActions,this)}});cv.ui.manager.form.FileListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.toolbar.ToolBar":{construct:!0,require:!0},"cv.ui.manager.MenuBar":{construct:!0},"cv.ui.manager.upload.UploadMgr":{},"cv.ui.manager.control.FileController":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.MenuButton":{},"cv.theme.dark.Images":{},"cv.ui.manager.model.FileItem":{},"qx.event.message.Bus":{},"qx.ui.toolbar.Button":{},"qx.locale.Manager":{},"qx.ui.core.Spacer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.ToolBar",{extend:qx.ui.toolbar.ToolBar,construct:function(e,t){qx.ui.toolbar.ToolBar.constructor.call(this);t&&(this.__P_26_0=t);this._menuBar=cv.ui.manager.MenuBar.getInstance();this._menuButtonConfig=this._menuBar.getButtonConfiguration();this._uploadManager=e;this._init()},events:{reload:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-toolbar"},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFolder",event:"changeFolder"},file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"}},members:{_menuButtonConfig:null,_uploadManager:null,_menuBar:null,__P_26_0:null,__P_26_1:function(e){return null===this.__P_26_0||this.__P_26_0.includes(e)},_init:function(){this._uploadManager||(this._uploadManager=new cv.ui.manager.upload.UploadMgr);var e,t=cv.ui.manager.control.FileController.getInstance(),i=new qx.ui.toolbar.Part;i.set({marginLeft:0});this.add(i);if(this.__P_26_1("new-menu")){e=new qx.ui.toolbar.MenuButton(null,cv.theme.dark.Images.getIcon("new-file",15),this._menuBar.getChildControl("new-menu"));this.bind("folder.writeable",e,"enabled");i.add(e)}else{if(this.__P_26_1("new-config-file")){e=this._createButton("new-config-file",cv.theme.dark.Images.getIcon("new-file",15));this.bind("folder.writeable",e,"enabled");this.bind("folder",e,"visibility",{converter:function(e){return e===cv.ui.manager.model.FileItem.ROOT?"visible":"excluded"}});e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",this.getFolder())},this);i.add(e)}else if(this.__P_26_1("new-file")){e=this._createButton("new-file",null,!0);this.bind("folder.writeable",e,"enabled");e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-file",this.getFolder())},this);i.add(e)}if(this.__P_26_1("new-folder")){e=this._createButton("new-folder",cv.theme.dark.Images.getIcon("new-folder",15),!0);this.bind("folder.writeable",e,"enabled");e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder",this.getFolder())},this);i.add(e)}}if(this.__P_26_1("upload")){var n=this._createButton("upload");this._uploadManager.addWidget(n);this.bind("folder.writeable",n,"enabled");i.add(n)}if(this.__P_26_1("delete")){var a=this._createButton("delete");a.addListener("execute",function(){t.delete(this.getFile())},this);this.bind("file",a,"enabled",{converter:function(e){return!!e&&e.isWriteable()&&!e.isFake()}});this.add(a)}if(this.__P_26_1("download")){var r=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("download",15));r.setAppearance("cv-toolbar-button");r.setToolTipText(qx.locale.Manager.tr("Download"));r.addListener("execute",function(){t.download(this.getFile())},this);this.bind("file",r,"enabled",{converter:function(e){return!!e&&"file"===e.getType()&&!e.isFake()}});i.add(r)}if(this.__P_26_1("validate")){var o=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("validate",15));o.setAppearance("cv-toolbar-button");o.setToolTipText(qx.locale.Manager.tr("Validate"));o.addListener("execute",function(){t.validate(this.getFile())},this);this.bind("file",o,"enabled",{converter:function(e){return!!e&&e.isConfigFile()}});this.add(o)}if(this.__P_26_1("reload")){var s=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("reload",15));s.setAppearance("cv-toolbar-button");s.setToolTipText(qx.locale.Manager.tr("Reload"));s.addListener("execute",function(){this.fireEvent("reload")},this);this.add(new qx.ui.core.Spacer,{flex:1});this.add(s)}},_createButton:function(e,t,i){var n=this._menuButtonConfig[e].args,a=new qx.ui.toolbar.Button(null,t||n[1].replace(/\/[0-9]+$/,"/15"),i?null:n[2]);a.setAppearance("cv-toolbar-button");a.setToolTipText(n[0]);return a},_applyFile:function(){},_applyFolder:function(e){this._uploadManager&&(e?this._uploadManager.setFolder(e):this._uploadManager.resetFolder())}},destruct:function(){this._menuButtonConfig=null;this._uploadManager=null;this.__P_26_2=null}});cv.ui.manager.ToolBar.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.basic.Atom":{require:!0},"cv.ui.manager.viewer.SvgIcon":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.IconAtom",{extend:qx.ui.basic.Atom,properties:{appearance:{refine:!0,init:"cv-icon"}},members:{_applyLabel:function(e){cv.ui.manager.core.IconAtom.prototype._applyLabel.base.call(this,e);this.getChildControl("icon").setName(e)},_handleIcon:function(){this.getChildControl("icon").getName()&&"label"!==this.getShow()?this._showChildControl("icon"):this._excludeChildControl("icon")},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new cv.ui.manager.viewer.SvgIcon).setAnonymous(!0);this._addAt(t,0)}return t||cv.ui.manager.core.IconAtom.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.core.IconAtom.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.editor.data.Provider":{construct:!0},"qx.xml.Document":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.Config",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_34_0={};this._schema=e;this._dataProvider=cv.ui.manager.editor.data.Provider.getInstance()},members:{__P_34_0:null,__P_34_1:null,_dataProvider:null,getLastOpenedTag:function(e){var t=e.match(/<\/*(?=\S*)([a-zA-Z-]+)/g);if(!t)return null;for(var i=[],n=t.length-1;n>=0;n--)if(0===t[n].indexOf("</"))i.push(t[n].substring("</".length));else{var a=e.lastIndexOf(t[n]),r=t[n].substring("<".length);if(-1===e.indexOf("/>",a)){if(!i.length||i[i.length-1]!==r){var o=(e=e.substring(a)).indexOf("<")>e.indexOf(">"),s=!1,l=null;if(o){var c=/([\w\-_\.\d]+)="[^"]*$/.exec(e);s=!!c;l=c?c[1]:null}var d=/<[\w-_\d]+$/.test(e);return{tagName:r,currentAttribute:l,filteredElementSearch:d,isAttributeSearch:!d&&o&&!s,isContentSearch:s,text:e}}i.splice(i.length-1,1)}e=e.substring(0,a)}return null},findElements:function(e,t,i,n,a){var r=!0===a?this.__P_34_1:this.__P_34_0;if(t in r)return r[t];if(i<n)return null;e||(e=this._schema.getElementNode("pages"));void 0===n&&(n=1);var o=e.getAllowedElements();if(t in o){this.__P_34_0[t]=o[t];return o[t]}for(var s in o)if((!0===a||"meta"!==s)&&i>n){var l=this.findElements(o[s],t,i,n+1);if(l){r[t]=l;return l}}return null},isItemAvailable:function(e,t,i){if((t=t||"1")&&"unbounded"===t)return!0;for(var n=0,a=0;a<i.length;a++)i[a]===e&&n++;return 0===n||parseInt(t)>n},getElementString:function(e,t,i){var n=t+i+e.getName()+" ",a=e.getAllowedAttributes();Object.getOwnPropertyNames(a).forEach(function(e){var t=a[e];t.isOptional||(n+=e+'="'+(t.getDefaultValue()?t.getDefaultValue():"")+'" ')});var r=e.getRequiredElements(),o=e.getAllowedContent();if(o._text||r.length>0||!!o._grouping){n=n.trim()+">";var s=0;r.forEach(function(i){var a=this.findElements(e,i,1,0);if(a){n+="\n    "+this.getElementString(a,t+"    ","<")+">";s++}},this);s>0&&(n+="\n"+t);n+="</"+e.getName()}else n=n.trim()+"/";return n},getAvailableElements:function(e,t){var i=[],n=e.getAllowedElements();if(!n)return[];Object.getOwnPropertyNames(n).filter(function(e){return!e.startsWith("#")}).forEach(function(e){var a=n[e];this.isItemAvailable(a.getName(),a.getBounds().max,t)&&i.push({label:a.getName(),insertText:this.getElementString(a,"",""),kind:window.monaco.languages.CompletionItemKind.Field,detail:a.getType(),documentation:a.getDocumentation().join("\n")})},this);return i},getAvailableAttributes:function(e,t){var i=[],n=e.getAllowedAttributes();Object.getOwnPropertyNames(n).forEach(function(e){var a=n[e];-1===t.indexOf(a.name)&&i.push({label:a.getName(),insertText:a.getName()+'=""',kind:window.monaco.languages.CompletionItemKind.Property,detail:a.getTypeString(),documentation:a.getDocumentation().join("\n")})},this);return i},getProvider:function(){return{triggerCharacters:["<",'"'],provideCompletionItems:function(e,t){for(var i,n,a=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),r=e.getValue(),o=r.indexOf("</meta>"),s=o>0?r.substring(0,o):r,l=[],c=[],d={},u=/<mapping name="([^"]+)"/gm;null!==(i=u.exec(s));)l.push(i[1]);u=/<styling name="([^"]+)"/gm;for(;null!==(i=u.exec(s));)c.push(i[1]);var h=s.indexOf("<templates>");if(h>=0){s.substring(h+11,s.indexOf("</templates>")-12).replace(/(?:\r\n|\r|\n)/g,"").split("</template>").forEach(function(e){for(var t=/<template name="([^"]+)"/.exec(e),i=[],a=/{{{?\s*([\w\d]+)\s*}?}}/gm;null!==(n=a.exec(e));)i.push(n[1]);d[t[1]]=i},this)}var g,m=this.getLastOpenedTag(a),f=[],p=[],_=[],v=m&&m.isAttributeSearch,b=m&&m.isContentSearch,x=m&&m.filteredElementSearch;if(m){(g=m.text.split(" ")).shift();var C=a;g.length&&(C=C.substring(0,C.length-g.join(" ").length)+">");for(var y,w=qx.xml.Document.fromString(C).lastElementChild,q=!1;w&&"parsererror"!==w.tagName.toLowerCase();){f.push(w.tagName);p.push(w.attributes);if(w.tagName===m.tagName){q=!0;if(m.isAttributeSearch&&w.outerHTML===m.text){var I=w.attributes;for(y=0;y<I.length;y++)_.push(I[y].nodeName)}else{var E=w.children;for(y=0;y<E.length;y++)"parsererror"!==E[y].tagName.toLowerCase()&&_.push(E[y].tagName)}break}w=w.lastElementChild}if(!q&&(v||b)){(g=m.text.split(" ")).shift();g.forEach(function(e){_.push(e.split("=").shift())})}}var P,S=[],k=f[f.length-1];if(b){if("pages"===m.tagName&&"design"===m.currentAttribute)return this._dataProvider.getDesigns().then(function(e){return{suggestions:e}});if("address"===m.tagName&&"transform"===m.currentAttribute)return{suggestions:this._dataProvider.getTransforms()};if("plugin"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getPlugins()};if("icon"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getIcons("monaco",{cache:!1},r)};if("influx"===m.tagName){if("measurement"===m.currentAttribute)return this._dataProvider.getInfluxDBs().then(function(e){return{suggestions:e}});if("field"===m.currentAttribute&&(P=/measurement="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBFields(P[1]).then(function(e){return{suggestions:e}})}else if("tag"!==m.tagName||"key"!==m.currentAttribute&&"value"!==m.currentAttribute||!f.includes("influx")){if("template"===m.tagName&&"name"===m.currentAttribute&&f.includes("meta"))return{suggestions:S=Object.keys(d).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)};if("value"===m.tagName&&"name"===m.currentAttribute&&!f.includes("meta")&&f.includes("template")){Object.keys(d).forEach(function(e){d[e].forEach(function(t){S.push({label:t,insertText:t,detail:qx.locale.Manager.tr("Variable from template %1",e),kind:window.monaco.languages.CompletionItemKind.Variable})},this)},this);return{suggestions:S}}if("mapping"===m.currentAttribute)return{suggestions:S=l.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)};if("styling"===m.currentAttribute)return{suggestions:S=c.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)}}else{var T=p[f.indexOf("influx")].getNamedItem("measurement");if(T){if("key"===m.currentAttribute)return this._dataProvider.getInfluxDBTags(T.value).then(function(e){return{suggestions:e}});if("value"===m.currentAttribute&&(P=/key="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBValues(T.value,P[1]).then(function(e){return{suggestions:e}})}}k=m.tagName}else if(!v&&x)k=f[f.length-2];else if("address"===m.tagName&&null===m.currentAttribute)return this._dataProvider.getAddresses("monaco").then(function(e){return{suggestions:e}});if("rrd"===k)return this._dataProvider.getRrds("monaco").then(function(e){return{suggestions:e}});if("file"===k&&!v&&!b&&f.includes("files")){var F=(P=/type="([^"]+)"/.exec(m.text))?P[1]:null;return this._dataProvider.getMediaFiles(F).then(function(e){return{suggestions:e}})}var D=this.findElements(this._schema.getElementNode("pages"),k,f.length,f.includes("meta"));if(b){var A=_[_.length-1];if(D&&A in D.getAllowedAttributes()){var O=D.getAllowedAttributes()[A],M=O.getTypeString();O.getEnumeration().forEach(function(e){S.push({label:e,kind:window.monaco.languages.CompletionItemKind.Value,detail:M,documentation:O.getDocumentation().join("\n")})})}}else v?S=D?this.getAvailableAttributes(D,_):[]:m&&m.text.endsWith("</")?S.push({label:m.tagName,kind:window.monaco.languages.CompletionItemKind.Field}):S=D?this.getAvailableElements(D,_):[];return{suggestions:S}}.bind(this)}}},destruct:function(){this.__P_34_0=null;this._schema=null;this._dataProvider=null}});cv.ui.manager.editor.completion.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.util.ResourceManager":{},"qx.io.request.Xhr":{},"qx.xml.Document":{},"cv.ui.manager.model.schema.Element":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Schema",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);if(!e||!e.match(/\.xsd$/))throw new Error("no, empty or invalid filename given, can not instantiate without one");this.__filename=e;this.__P_43_0={};this.__P_43_1={};this.__P_43_2={};this._cacheXSD()},statics:{__P_43_3:{},getInstance:function(e){Object.prototype.hasOwnProperty.call(this.__P_43_3,e)||(this.__P_43_3[e]=new cv.ui.manager.model.Schema(qx.util.ResourceManager.getInstance().toUri(e)));return this.__P_43_3[e]}},properties:{loaded:{check:"Boolean",init:!1,event:"changeLoaded"}},members:{__filename:null,__P_43_4:null,__P_43_0:null,__P_43_1:null,__P_43_2:null,__P_43_5:null,__P_43_6:null,_widgetNames:null,onLoaded:function(e,t){this.isLoaded()?e.call(t):this.addListenerOnce("changeLoaded",e,t)},_cacheXSD:function(){var e=new qx.io.request.Xhr(this.__filename);e.set({accept:"application/xml"});e.addListenerOnce("success",function(e){var t=e.getTarget().getResponse();t&&"string"==typeof t&&(t=qx.xml.Document.fromString(t));this.__P_43_4=t;this._parseXSD()},this);e.send()},_parseXSD:function(){var e=this;this.__P_43_4.querySelectorAll("schema > element").forEach(function(t){var i=t.getAttribute("name");e.__P_43_0[i]=new cv.ui.manager.model.schema.Element(t,e)});this.setLoaded(!0)},getElementNode:function(e){if(Object.prototype.hasOwnProperty.call(this.__P_43_0,e))return this.__P_43_0[e];throw new Error("schema/xsd appears to be invalid, element "+e+" not allowed on root level")},getReferencedNode:function(e,t){if(Object.prototype.hasOwnProperty.call(this.__P_43_1,e)&&Object.prototype.hasOwnProperty.call(this.__P_43_1[e],t))return this.__P_43_1[e][t];var i="schema > "+e+'[name="'+t+'"]',n=this.__P_43_4.querySelector(i);if(!n)throw new Error("schema/xsd appears to be invalid, reference "+e+'"'+t+'" can not be found');n.hasAttribute("ref")&&(n=this.getReferencedNode(e,n.getAttribute("ref")));Object.prototype.hasOwnProperty.call(this.__P_43_1,e)||(this.__P_43_1[e]={});this.__P_43_1[e][t]=n;return n},getTypeNode:function(e,t){if(Object.prototype.hasOwnProperty.call(this.__P_43_2,e)&&Object.prototype.hasOwnProperty.call(this.__P_43_2[e],t))return this.__P_43_2[e][t];var i=this.__P_43_4.querySelector(e+'Type[name="'+t+'"]');if(!i)throw new Error("schema/xsd appears to be invalid, "+e+'Type "'+t+'" can not be found');void 0===this.__P_43_2[e]&&(this.__P_43_2[e]={});this.__P_43_2[e][t]=i;return i},getTextNodeSchemaElement:function(){if(null===this.__P_43_5){var e=this.__P_43_4.createElement("element");e.setAttribute("name","#text");e.setAttribute("type","xsd:string");this.__P_43_5=new cv.ui.manager.model.schema.Element(e,this)}return this.__P_43_5},getCommentNodeSchemaElement:function(){if(null===this.__P_43_6){var e=this.__P_43_4.createElement("element");e.setAttribute("name","#comment");e.setAttribute("type","xsd:string");e.setAttribute("minOccurs","0");e.setAttribute("maxOccurs","unbounded");this.__P_43_6=new cv.ui.manager.model.schema.Element(e,this)}return this.__P_43_6},getSchemaDOM:function(){return this.__P_43_4},getWidgetNames:function(){if(!this._widgetNames){var e=this.getElementNode("pages").getSchemaElementForElementName("page");this._widgetNames=Object.keys(e.getAllowedElements()).filter(function(e){return!e.startsWith("#")&&"layout"!==e})}return this._widgetNames}},destruct:function(){this.__P_43_4=null;this._disposeObjects("__P_43_6","__P_43_5");this._disposeMap("__P_43_0");this.__P_43_1=null;this.__P_43_2=null;this._widgetNames=null}});cv.ui.manager.model.Schema.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.Version":{},"cv.io.rest.Client":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.CometVisu",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this)},members:{TEMPLATES:null,getTemplates:function(){if(!this.TEMPLATES){this.TEMPLATES=[{filterText:"cvclass",label:"CometVisu-Class",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu class.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.$0", {\n  extend: qx.core.Object,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvwidget",label:"CometVisu-Widget",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a widget.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.ui.structure.pure.$0", {\n  extend: cv.ui.structure.AbstractWidget,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvinterface",label:"CometVisu-Interface",kind:window.monaco.languages.CompletionItemKind.Interface,detail:"A generic CometVisu Interface.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Interface.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmixin",label:"CometVisu-Mixin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu Mixin.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Mixin.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmembers",label:"CometVisu-Class members",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes members section.",insertText:"  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvproperties",label:"CometVisu-Class properties",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes properties section.",insertText:"  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvstatics",label:"CometVisu-Class statics",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"statics section.",insertText:"  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvevents",label:"CometVisu-Class events",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"events section.",insertText:"  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvconstructor",label:"Constructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"constructor.",insertText:"  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvdestructor",label:"Destructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"destructor.",insertText:"  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this.base(arguments);\n    $0\n  }\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace}];return new Promise(function(e,t){cv.io.rest.Client.getFsClient().readSync({path:"demo/templates/Plugin.js"},function(i,n){if(i)t(i);else{this.TEMPLATES.push({filterText:"cvplugin",label:"CometVisu-Plugin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a plugin.",insertText:n.replace("###SINCE###",cv.Version.VERSION.replace("-dev","")+" ($CURRENT_YEAR)"),insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace});e(this.TEMPLATES)}},this)}.bind(this))}return Promise.resolve(this.TEMPLATES)},getProvider:function(){return{triggerCharacters:["cv"],provideCompletionItems:function(){return this.getTemplates().then(function(e){return{suggestions:e}})}.bind(this)}}}});cv.ui.manager.editor.completion.CometVisu.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.ElementChange",{extend:qx.core.Object,construct:function(e,t,i,n){qx.core.Object.constructor.call(this);this.setTitle(e);this.setElement(t);this.setChanges(i);this.setChangeType(n||"content")},properties:{element:{check:"cv.ui.manager.model.XmlElement"},title:{check:"String"},changes:{check:"Array"},changeType:{check:["content","created","deleted","moved"],init:["content"]}},members:{undo:function(){var e,t=this.getElement(),i=!1;if(!t.isDisposed())switch(this.getChangeType()){case"content":this.getChanges().forEach(function(e){e instanceof cv.ui.manager.model.ElementChange?e.undo():t.setAttribute(e.attribute,e.old)});t.updateModified();i=!0;break;case"deleted":(e=this.getChanges()[0]).parent&&(i=e.parent.insertChild(e.child,e.index,!0));break;case"created":if((e=this.getChanges()[0]).child){e.child.remove(!0);i=!0}break;case"moved":i=(e=this.getChanges()[0]).child.moveTo(e.oldParent,e.oldIndex,!0)}return i},redo:function(){var e,t=this.getElement(),i=!1;if(!t.isDisposed())switch(this.getChangeType()){case"content":this.getChanges().forEach(function(e){e instanceof cv.ui.manager.model.ElementChange?e.redo():t.setAttribute(e.attribute,e.value)});t.updateModified();i=!0;break;case"deleted":if(t){t.remove(!0);i=!0}break;case"created":(e=this.getChanges()[0]).parent&&(i=e.parent.insertChild(e.child,e.index,!0));break;case"moved":i=(e=this.getChanges()[0]).child.moveTo(e.parent,e.index,!0)}return i}}});cv.ui.manager.model.ElementChange.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",construct:!0,require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.ui.tree.VirtualTreeItem":{construct:!0,require:!0},"qx.bom.client.Device":{construct:!0,require:!0},"cv.ui.manager.basic.Image":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.basic.Atom":{},"cv.theme.dark.Images":{},"qx.ui.form.MenuButton":{},"cv.ui.manager.contextmenu.ConfigElement":{},"qx.ui.core.Spacer":{}},environment:{provided:[],required:{"device.touch":{construct:!0,className:"qx.bom.client.Device"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.VirtualElementItem",{extend:qx.ui.tree.VirtualTreeItem,construct:function(e){qx.ui.tree.VirtualTreeItem.constructor.call(this,e);qx.core.Environment.get("device.touch")&&this.addState("touch")},properties:{appearance:{refine:!0,init:"element-tree-item"},name:{check:"String",init:"",event:"changeName",apply:"_applyName"},temporary:{check:"Boolean",init:!1,apply:"_applyTemporary"},status:{check:["valid","error","comment"],nullable:!0,apply:"_applyStatus"},editable:{check:"Boolean",init:!1},sortable:{check:"Boolean",init:!1,apply:"_applySortable"},droppable:{refine:!0,init:!0},dragging:{check:"Boolean",init:!1,apply:"_applyDragging"}},events:{edit:"qx.event.type.Data",action:"qx.event.type.Data"},members:{_forwardStates:{selected:!0,touch:!0},__P_50_0:!1,_applyName:function(e){this.getContentElement().setAttribute("data-nodename",e)},_applyDragging:function(e){e?this.addState("drag"):this.removeState("drag")},_applyModel:function(e){if(qx.core.Environment.get("device.touch"))if(e){var t=this.getChildControl("menu-button");t.show();var i=t.getMenu();i.setEditor(e.getEditor());i.setElement(e)}else this.getChildControl("menu-button").hide();else this.hasChildControl("menu-button")&&this.getChildControl("menu-button").exclude()},_applyTemporary:function(e){e?this.addState("temporary"):this.removeState("temporary")},_applySortable:function(e){e?this.getChildControl("move-button").show():this.getChildControl("move-button").hide()},_applyStatus:function(e,t){var i=this.getChildControl("icon"),n=this.getChildControl("label");if(t){i.removeState(t);n.removeState(t)}if(e){i.addState(e);n.addState(e)}},_addWidgets:function(){cv.ui.manager.tree.VirtualElementItem.prototype._addWidgets.base.call(this);var e=this.getChildControl("open",!0);e&&qx.core.Environment.get("device.touch")&&e.getContentElement().addClass("touch-tree-open-icon")},_createChildControlImpl:function(e,t){var i,n=this;switch(e){case"icon":i=(new cv.ui.manager.basic.Image).set({forceScale:!0,alignY:"middle",anonymous:!0,source:this.getIcon(),maxWidth:22,maxHeight:22});break;case"buttons":(i=new qx.ui.container.Composite(new qx.ui.layout.HBox(8))).setAnonymous(!0);break;case"move-button":(i=new qx.ui.basic.Atom("",cv.theme.dark.Images.getIcon("drag-handle",qx.core.Environment.get("device.touch")?36:18))).setToolTipText(this.tr("Drag to move"));i.setAnonymous(!0);i.setShow("icon");this.getChildControl("buttons").addAt(i,0);break;case"menu-button":(i=new qx.ui.form.MenuButton("",cv.theme.dark.Images.getIcon("menu",qx.core.Environment.get("device.touch")?24:14),new cv.ui.manager.contextmenu.ConfigElement)).getMenu().addListener("action",function(e){n.fireDataEvent("action",e.getData())});this.getChildControl("buttons").addAt(i,1)}return i||cv.ui.manager.tree.VirtualElementItem.prototype._createChildControlImpl.base.call(this,e)},addLabel:function(e){var t=this.getChildControl("label");this.__P_50_0&&this._remove(t);e?this.setLabel(e):t.setValue(this.getLabel());this._add(t);this._add(new qx.ui.core.Spacer,{flex:1});var i=this.getChildControl("buttons");this._add(i);this.__P_50_0=!0}}});cv.ui.manager.tree.VirtualElementItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menu.Menu":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"cv.ui.manager.model.XmlElement":{},"cv.theme.dark.Images":{},"qx.ui.menu.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.ConfigElement",{extend:qx.ui.menu.Menu,construct:function(e){qx.ui.menu.Menu.constructor.call(this);e&&this.setEditor(e);this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this._init()},events:{action:"qx.event.type.Data"},properties:{element:{check:"cv.ui.manager.model.XmlElement",nullable:!0,apply:"_applyElement"},editor:{check:"cv.ui.manager.editor.Tree",nullable:!0,apply:"_applyEditor"}},members:{_commandGroup:null,_applyEditor:function(e,t){t&&t.removeListener("changeClipboard",this._maintainClipboardButtons,this);e&&e.addListener("changeClipboard",this._maintainClipboardButtons,this)},_applyElement:function(e,t){var i=this;if(t){t.removeRelatedBindings(this.getChildControl("delete-button"));t.removeRelatedBindings(this.getChildControl("cut-button"))}if(e){var n=e.isEditable();this.getChildControl("copy-button").setEnabled(!0);if(n){e.bind("deletable",this.getChildControl("delete-button"),"enabled");e.bind("deletable",this.getChildControl("cut-button"),"enabled");this.getChildControl("view-button").exclude();this.getChildControl("edit-button").show();this.getChildControl("edit-button").setEnabled(e.getShowEditButton());var a=e.getAddableChildren(!0);this.getChildControl("create-button").setEnabled(a.length>0)}else{this.getChildControl("delete-button").setEnabled(!1);this.getChildControl("cut-button").setEnabled(!1);this.getChildControl("create-button").setEnabled(!1);this.getChildControl("view-button").show();this.getChildControl("view-button").setEnabled(e.getShowEditButton());this.getChildControl("edit-button").exclude()}}else["edit","delete","cut","copy","paste","create"].forEach(function(e){return i.getChildControl(e+"-button").setEnabled(!1)});this._maintainClipboardButtons()},_init:function(){var e=this;["view","edit","delete"].forEach(function(t){return e.add(e.getChildControl(t+"-button"))});this.addSeparator();["cut","copy","paste"].forEach(function(t){return e.add(e.getChildControl(t+"-button"))});this.addSeparator();this.add(this.getChildControl("create-button"))},_maintainClipboardButtons:function(){var e=this.getEditor().getClipboard(),t=this.getElement(),i=!!t&&t.isEditable()&&e instanceof cv.ui.manager.model.XmlElement;if(i){i=t.getAddableChildren(!0).includes(e.getName())&&t.isChildAllowedAtPosition(e,Number.POSITIVE_INFINITY)}this.getChildControl("paste-button").setEnabled(i)},_createChildControlImpl:function(e,t){var i;switch(e){case"view-button":(i=this.__P_28_0("view",this.tr("View"),cv.theme.dark.Images.getIcon("view",18))).exclude();break;case"edit-button":i=this.__P_28_0("edit",this.tr("Edit"),cv.theme.dark.Images.getIcon("edit",18));break;case"delete-button":i=this.__P_28_0("delete",this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18));break;case"cut-button":i=this.__P_28_0("cut",this.tr("Cut"),cv.theme.dark.Images.getIcon("cut",18));break;case"copy-button":i=this.__P_28_0("copy",this.tr("Copy"),cv.theme.dark.Images.getIcon("copy",18));break;case"paste-button":i=this.__P_28_0("paste",this.tr("Paste"),cv.theme.dark.Images.getIcon("paste",18));break;case"create-menu":i=new qx.ui.menu.Menu;break;case"create-button":i=this.__P_28_0("create",this.tr("Add child"),cv.theme.dark.Images.getIcon("add",18))}return i||cv.ui.manager.contextmenu.ConfigElement.prototype._createChildControlImpl.base.call(this,e)},__P_28_0:function(e,t,i,n,a){var r=new qx.ui.menu.Button(t,i,n,a);r.addListener("execute",function(){this.fireDataEvent("action",{action:e,element:this.getElement()})},this);return r}},destruct:function(){this._commandGroup=null}});cv.ui.manager.contextmenu.ConfigElement.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();o=e.done;return e},e:function(e){s=!0;r=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}!function(){var $$dbClassInfo={dependsOn:{"qx.core.Environment":{defer:"load",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Form":{require:!0},"qx.data.marshal.Json":{},"qx.ui.form.Form":{},"qx.data.controller.Object":{},"qx.ui.form.TextArea":{},"qx.ui.form.TextField":{},"cv.ui.manager.form.SourceCodeField":{},"qx.ui.form.DateField":{},"qx.ui.form.PasswordField":{},"qx.ui.form.ComboBox":{},"qx.ui.form.ListItem":{},"qx.ui.form.VirtualComboBox":{},"cv.ui.manager.form.Option":{},"qx.data.Array":{},"cv.ui.manager.form.ListItem":{},"qx.ui.form.SelectBox":{},"qx.data.controller.List":{},"cv.ui.manager.form.VirtualSelectBox":{},"qx.ui.form.RadioGroup":{},"qx.ui.form.RadioButton":{},"cv.ui.manager.form.CheckBox":{},"qx.ui.form.Spinner":{},"qx.util.format.NumberFormat":{},"qx.util.Validate":{},"qx.ui.form.validation.AsyncValidator":{},"qx.lang.Type":{},"qx.locale.Manager":{},"cv.ui.manager.form.ElementFormRenderer":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.event.Timer":{},"qx.util.Serializer":{}},environment:{provided:[],required:{"module.objectid":{}}}};qx.Bootstrap.executePendingDefers($$dbClassInfo);qx.Class.define("cv.ui.manager.form.ElementForm",{extend:qxl.dialog.Form,properties:{labelColumnWidth:{refine:!0,init:300},useBlocker:{refine:!0,init:!0},blockerOpacity:{refine:!0,init:.9},blockerColor:{refine:!0,init:"#585858"}},members:{__P_36_0:null,__P_36_1:null,_rootListenerId:null,_applyFormData:function _applyFormData(formData,old){var _this=this,firstWidget;this.__P_36_0={map:{},inverse:{}};if(this._formController)try{this.getModel().removeAllBindings();this._formController.dispose()}catch(e){}if(this._form)try{this._form.getValidationManager().removeAllBindings();this._form.dispose()}catch(e){}this._formContainer.removeAll();if(formData){if(this.getModel()){this.getModel().removeAllBindings();this.getModel().dispose()}var modelData={},_iterator=_createForOfIteratorHelper(Object.getOwnPropertyNames(formData)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){for(var key=_step.value,_i=0,mappedKey=key.replaceAll(/[-_\.#]+([a-z])/g,function(e,t){return t.toUpperCase()})+_i++;Object.prototype.hasOwnProperty.call(modelData,mappedKey);)mappedKey=mappedKey.substr(0,mappedKey.length-1)+_i++;if(mappedKey!==key){this.__P_36_0.map[mappedKey]=key;this.__P_36_0.inverse[key]=mappedKey}modelData[mappedKey]=void 0!==formData[key].value?formData[key].value:null}}catch(e){_iterator.e(e)}finally{_iterator.f()}var model=qx.data.marshal.Json.createModel(modelData);this.setModel(model);this._form=new qx.ui.form.Form;if(!0===qx.core.Environment.get("module.objectid")){this._form.setQxObjectId("form");this.addOwnedQxObject(this._form)}this._formController=new qx.data.controller.Object(model);this._onFormReady(this._form);var i=0,atom,_iterator2=_createForOfIteratorHelper(Object.getOwnPropertyNames(formData)),_step2;try{var _loop=function _loop(){var key=_step2.value,mappedKey=_this.__P_36_0.inverse[key],fieldData=formData[key],formElement=null,elementModel=null,elementModelReady=null;switch(fieldData.type.toLowerCase()){case"groupheader":_this._form.addGroupHeader(fieldData.value);break;case"textarea":formElement=new qx.ui.form.TextArea;formElement.setMinimalLineHeight(fieldData.lines);if(!0===fieldData.autoSize){formElement.setAutoSize(!0);formElement.setMinHeight(16*fieldData.lines)}else formElement.setHeight(16*fieldData.lines);formElement.setLiveUpdate(!0);break;case"textfield":formElement=new qx.ui.form.TextField;fieldData.maxLength&&formElement.setMaxLength(fieldData.maxLength);formElement.setLiveUpdate(!0);break;case"sourceeditor":formElement=new cv.ui.manager.form.SourceCodeField("",fieldData.language);if(!0===fieldData.autoSize){formElement.setAutoSize(!0);formElement.setMinHeight(16*fieldData.lines)}else formElement.setHeight(16*fieldData.lines);break;case"datefield":case"date":formElement=new qx.ui.form.DateField;fieldData.dateFormat&&formElement.setDateFormat(fieldData.dateFormat);break;case"passwordfield":case"password":formElement=new qx.ui.form.PasswordField;formElement.getContentElement().setAttribute("autocomplete","password");break;case"combobox":formElement=new qx.ui.form.ComboBox;var parseComboOptions=function(e){Array.isArray(e)?e.forEach(function(e){var t=new qx.ui.form.ListItem(e.label,e.icon);formElement.add(t)}):"object"===_typeof(e)&&Object.keys(e).forEach(function(t){var i=new qx.ui.form.ListItem(t);i.set({anonymous:!0,appearance:"optiongroup"});formElement.add(i);e[t].forEach(function(e){var t=new qx.ui.form.ListItem(e.label,e.icon,e.value);formElement.add(t)})})};if(fieldData.options instanceof Promise){formElement.setPlaceholder(_this.tr("Loading..."));elementModelReady=fieldData.options.then(function(e){formElement.setPlaceholder(fieldData.placeholder);parseComboOptions(e);return!0},_this).catch(function(e){_this.error(e);formElement.setPlaceholder(_this.tr("Possible values could no be retrieved, please check browser console for error details"))},_this)}else parseComboOptions(fieldData.options);break;case"virtualcombobox":formElement=new qx.ui.form.VirtualComboBox;formElement.set({iconPath:"icon",labelPath:"value"});fieldData.validation&&formElement.getChildControl("textfield").setLiveUpdate(!0);var selection=formElement.getChildControl("dropdown").getSelection();selection.addListener("change",function(e){var t=selection.getItem(0);t&&t instanceof cv.ui.manager.form.Option?this.__P_36_1=t.getHints():this.__P_36_1=null},_this);elementModel=new qx.data.Array;var parseVComboOptions=function(e){Array.isArray(e)?e.forEach(function(e){elementModel.push(new cv.ui.manager.form.Option(e.label+(e.value?" (".concat(e.value,")"):""),e.icon,e.value,e.hints))}):"object"===_typeof(e)&&Object.keys(e).forEach(function(t){var i=new cv.ui.manager.form.Option(t);i.setType("group");elementModel.push(i);e[t].forEach(function(e){elementModel.push(new cv.ui.manager.form.Option(e.label+(e.value?" (".concat(e.value,")"):""),e.icon,e.value,e.hints))})})};if(fieldData.options instanceof Promise){formElement.setPlaceholder(_this.tr("Loading..."));fieldData.options.then(function(e){formElement.setPlaceholder(fieldData.placeholder);parseVComboOptions(e)},_this).catch(function(e){_this.error(e);formElement.setPlaceholder(_this.tr("Possible values could no be retrieved, please check browser console for error details"))},_this)}else parseVComboOptions(fieldData.options);formElement.setDelegate({createItem:function(){return new cv.ui.manager.form.ListItem},bindItem:function(e,t,i){e.bindProperty("icon","icon",null,t,i);e.bindProperty("label","label",null,t,i);e.bindProperty("type","appearance",{converter:function(e){switch(e){case"state":return"state-option";case"error":return"error-option";case"group":return"optiongroup";default:return"listitem"}}},t,i);e.bindProperty("type","anonymous",{converter:function(e){return"group"===e}},t,i)}});formElement.setModel(elementModel);break;case"selectbox":formElement=new qx.ui.form.SelectBox;if(fieldData.options instanceof Promise){atom=formElement.getChildControl("atom");atom.setLabel(_this.tr("Loading..."));atom.addState("loading");elementModelReady=fieldData.options.then(function(e){var t=formElement.getChildControl("atom");t.resetLabel();t.removeState("loading");new qx.data.controller.List(qx.data.marshal.Json.createModel(e),formElement,"label");return!0},_this).catch(function(e){_this.error(e);var t=formElement.getChildControl("atom");t.setLabel(_this.tr("Possible values could no be retrieved, please check browser console for error details"));t.removeState("loading");t.addState("error")},_this)}else new qx.data.controller.List(qx.data.marshal.Json.createModel(fieldData.options),formElement,"label");break;case"virtualselectbox":formElement=new cv.ui.manager.form.VirtualSelectBox;elementModel=new qx.data.Array;if(fieldData.options)if(fieldData.options instanceof Promise){atom=formElement.getChildControl("atom");atom.setLabel(_this.tr("Loading..."));atom.addState("loading");elementModelReady=fieldData.options.then(function(e){var t=formElement.getChildControl("atom");t.resetLabel();t.removeState("loading");e.forEach(function(e){elementModel.push(new cv.ui.manager.form.Option(e.label,e.icon,e.value))});return!0}).catch(function(e){_this.error(e);var t=formElement.getChildControl("atom");t.setLabel(_this.tr("Possible values could no be retrieved, please check browser console for error details"));t.removeState("loading");t.addState("error")},_this)}else fieldData.options.forEach(function(e){elementModel.push(new cv.ui.manager.form.Option(e.label,e.icon,e.value))});formElement.setDelegate({createItem:function(){return new cv.ui.manager.form.ListItem},bindItem:function(e,t,i){e.bindDefaultProperties(t,i);e.bindProperty("value","model",null,t,i)}});formElement.set({labelPath:"label",iconPath:"icon",iconOptions:{converter:function(e){return"function"==typeof e?e().trim():e}},model:elementModel});break;case"radiogroup":formElement=new qx.ui.form.RadioGroup;fieldData.orientation&&formElement.setUserData("orientation",fieldData.orientation);fieldData.options.forEach(function(e){var t=new qx.ui.form.RadioButton(e.label);t.setUserData("value",void 0!==e.value?e.value:e.label);formElement.add(t)},_this);break;case"label":formElement=new qx.ui.form.TextField;formElement.setUserData("excluded",!0);break;case"checkbox":formElement=new cv.ui.manager.form.CheckBox;formElement.setTriState(!0);break;case"spinner":formElement=new qx.ui.form.Spinner;fieldData.min&&formElement.setMinimum(fieldData.min);fieldData.max&&formElement.setMaximum(fieldData.max);fieldData.step&&formElement.setSingleStep(fieldData.step);if(fieldData.fractionsDigits){var fd=fieldData.fractionsDigits,nf=new qx.util.format.NumberFormat;fd.min&&nf.setMinimumFractionDigits(fd.min);fd.max&&nf.setMaximumFractionDigits(fd.max);formElement.setNumberFormat(nf)}break;default:_this.error("Invalid form field type:"+fieldData.type)}formElement.setUserData("key",key);formElement.setUserData("mappedKey",mappedKey);0===i&&(firstWidget=formElement);i++;if("string"==typeof fieldData.type){var options=null,reverseOptions=null,bidirectional=!0,handled=!1;switch(fieldData.type.toLowerCase()){case"textarea":case"textfield":case"passwordfield":case"combobox":case"virtualcombobox":case"datefield":case"spinner":case"sourceeditor":reverseOptions={converter:function(e){this.getValidationManager().validate();return e}.bind(_this._form)};break;case"virtualselectbox":options={converter:function(e){if("string"==typeof e){var t;this.getModel().some(function(i){if(i.getValue()===e){t=i;return!0}return!1});return t}return e}.bind(formElement)};reverseOptions={converter:function(e){this.getValidationManager().validate();return e?e.getValue():null}.bind(_this._form)};break;case"checkbox":break;case"selectbox":_this._formController.addTarget(formElement,"selection",mappedKey,!0,{converter:function(e){var t=null,i=this.getSelectables();i.some(function(i){if(i.getModel().getValue()===e){t=i;return!0}return!1},this);return t?[t]:[i[0]]}.bind(formElement)},{converter:function(e){return e[0].getModel().getValue()}});handled=!0;break;case"radiogroup":options={converter:function(e){var t=this.getSelectables(),i=[];e&&t.forEach(function(t){t.getUserData("value")===e&&(i=[t])},this);return i}.bind(formElement)};reverseOptions={converter:function(e){return e[0].getUserData("value")}}}handled||(elementModelReady?elementModelReady.then(function(){_this._formController.addTarget(formElement,"value",mappedKey,bidirectional,options,reverseOptions)}):_this._formController.addTarget(formElement,"value",mappedKey,bidirectional,options,reverseOptions))}var validator=null;if(formElement&&fieldData.validation){fieldData.validation.required&&formElement.setRequired(!0);if(fieldData.validation.validator){validator=fieldData.validation.validator;"string"==typeof validator?qx.util.Validate[validator]?validator=qx.util.Validate[validator]():"/"===validator.charAt(0)?validator=qx.util.Validate.regExp(new RegExp(validator.substr(1,validator.length-2)),fieldData.validation.errorMessage):_this.error("Invalid string validator."):validator instanceof qx.ui.form.validation.AsyncValidator||"function"==typeof validator||_this.error("Invalid validator.")}if(qx.lang.Type.isString(fieldData.validation.proxy)&&qx.lang.Type.isString(fieldData.validation.method)){var proxy=fieldData.validation.proxy.replace(/;\n/g,"");try{eval("proxy = "+proxy+";")}catch(e){_this.warn("Invalid proxy name")}if("function"==typeof proxy){var method=fieldData.validation.method,message=fieldData.validation.invalidMessage,validationFunc=function(e,t){if(!e.__P_36_2){e.__P_36_2=!0;proxy(method,[t],function(t){e.setValid(t,message||qx.locale.Manager.tr("Value is invalid"));e.__P_36_2=!1})}};validator=new qx.ui.form.validation.AsyncValidator(validationFunc)}}}void 0!==fieldData.width&&formElement.setWidth(fieldData.width);void 0!==fieldData.placeholder&&formElement.setPlaceholder(fieldData.placeholder);void 0!==fieldData.enabled&&formElement.setEnabled(fieldData.enabled);void 0!==fieldData.help&&formElement.setUserData("help",fieldData.help);if(qx.lang.Type.isObject(fieldData.events))for(var type in fieldData.events)try{var func=eval("("+fieldData.events[type]+")");if(!qx.lang.Type.isFunction(func))throw new Error;formElement.addListener(type,func,formElement)}catch(e){_this.warn("Invalid '"+type+"' event handler for form element '"+key+"'.")}var label=fieldData.label;_this._form.add(formElement,label,validator);if(!0===qx.core.Environment.get("module.objectid")){formElement.setQxObjectId(key);_this._form.addOwnedQxObject(formElement)}};for(_iterator2.s();!(_step2=_iterator2.n()).done;)_loop()}catch(e){_iterator2.e(e)}finally{_iterator2.f()}var view=new cv.ui.manager.form.ElementFormRenderer(this._form);view.getLayout().setColumnFlex(0,0);view.getLayout().setColumnMaxWidth(0,this.getLabelColumnWidth());view.getLayout().setColumnFlex(1,1);view.getLayout().set({spacingX:8});view.setAllowGrowX(!0);var scroll=new qx.ui.container.Scroll(view);scroll.setMaxHeight(qx.bom.Document.getHeight()-132);this._rootListenerId=qx.core.Init.getApplication().getRoot().addListener("resize",function(){scroll.setMaxHeight(qx.bom.Document.getHeight()-132)});view.bind("width",scroll,"width");view.bind("height",scroll,"height");this._formContainer.add(scroll);this._form.getValidationManager().validate();firstWidget&&qx.event.Timer.once(function(){firstWidget.focus()},this,200)}},_handleOk:function(){var e=this;this.hide();if(this.getCallback()){var t=qx.util.Serializer.toNativeObject(this.getModel());Object.keys(this.__P_36_0.map).forEach(function(i){if(Object.prototype.hasOwnProperty.call(t,i)){t[e.__P_36_0.map[i]]=t[i];delete t[i]}});this.__P_36_1&&Object.keys(this.__P_36_1).forEach(function(i){return t[i]=e.__P_36_1[i]});this.getCallback().call(this.getContext(),t)}this.resetCallback()}},destruct:function(){if(this._rootListenerId){qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);this._rootListenerId=null}}});cv.ui.manager.form.ElementForm.$$dbClassInfo=$$dbClassInfo}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Base",{extend:qx.core.Object,type:"abstract",construct:function(e,t){qx.core.Object.constructor.call(this);this.setNode(e);this.setSchema(t);this._bounds={min:void 0,max:void 0};this._allowedElements={};this._sortedContent=[];this._subGroupings=[]},properties:{type:{check:"String",init:"unknown"},elementsHaveOrder:{check:"Boolean",init:!1},schema:{check:"cv.ui.manager.model.Schema",nullable:!1},node:{check:"Node",nullable:!1},subGroupings:{check:"Array"}},members:{_bounds:null,_regexCache:null,_allowedElements:null,_sortedContent:null,_subGroupings:null,parse:function(){var e=this.getNode(),t=e.hasAttribute("minOccurs")?e.getAttribute("minOccurs"):1,i=e.hasAttribute("maxOccurs")?e.getAttribute("maxOccurs"):1;this._bounds={min:parseInt(t),max:"unbounded"===i?Number.POSITIVE_INFINITY:parseInt(i)}},isElementAllowed:function(e){if(void 0!==this._allowedElements[e])return!0;for(var t=0;t<this._subGroupings.length;++t)if(!0===this._subGroupings[t].isElementAllowed(e))return!0;return!1},getSchemaElementForElementName:function(e){if(void 0!==this._allowedElements[e])return this._allowedElements[e];for(var t=0;t<this._subGroupings.length;++t)if(!0===this._subGroupings[t].isElementAllowed(e))return this._subGroupings[t].getSchemaElementForElementName(e)},getRequiredElements:function(){if(0===this._bounds.min)return[];for(var e=[],t=0,i=Object.entries(this._allowedElements);t<i.length;t++){var n=_slicedToArray(i[t],2),a=n[0],r=n[1];if(r.getBounds().min>0)for(var o=0;o<r.getBounds().min;++o)e.push(a)}this._subGroupings.forEach(function(t){var i=t.getRequiredElements();if(i.length>0)for(var n=0;n<i.length;++n)e.push(i[n])});return e},getAllowedElements:function(){for(var e={},t=0,i=Object.entries(this._allowedElements);t<i.length;t++){var n=_slicedToArray(i[t],2),a=n[0],r=n[1];e[a]=r}this._subGroupings.forEach(function(t){Object.assign(e,t.getAllowedElements())});return e},getAllowedElementsSorting:function(e){return{}},getRegex:function(e,t){return""},hasMultiLevelBounds:function(){return this._subGroupings.length>0},getBounds:function(){return this._bounds},getBoundsForElementName:function(e){return this._bounds},regexFromString:function(e,t){void 0===t&&(t="");return new RegExp(e,t)}}});cv.ui.manager.model.schema.Base.$$dbClassInfo=e}();function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.locale.Manager":{construct:!0},"cv.ui.manager.model.schema.DocumentationMapping":{}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.model.schema.MAnnotation",{construct:function(){this.__P_47_0=new RegExp(":ref:[`'](.+?)[`']","g");this.__P_47_1="de"===qx.locale.Manager.getInstance().getLanguage()?"de":"en"},members:{__P_47_2:null,__P_47_0:null,__P_47_1:null,__P_47_3:null,__P_47_4:function(e,t){var i=[],n=e.ownerDocument,a=n.createNSResolver(n.documentElement),r=n.evaluate(t,e,a,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);try{for(var o=r.iterateNext();o;){i.push(o.textContent);o=r.iterateNext()}}catch(e){this.error("Error: Document tree modified during iteration "+e)}return i},getAppinfo:function(){if(null!==this.__P_47_2)return this.__P_47_2;var e=this.getNode(),t=this.__P_47_4(e,"xsd:annotation/xsd:appinfo"),i=this.getType();if("element"===i)0===e.querySelectorAll(":scope > complexType").length&&t.push.apply(t,_toConsumableArray(this.__P_47_4(this._type,"xsd:annotation/xsd:appinfo")));else if("attribute"===i&&e.hasAttribute("ref")){var n=e.getAttribute("ref"),a=this.getSchema().getReferencedNode("attribute",n);t.push.apply(t,_toConsumableArray(this.__P_47_4(a,"xsd:annotation/xsd:appinfo")))}this.__P_47_2=t;return t},getDocumentation:function(){var e=this;if(null!==this.__P_47_3)return this.__P_47_3;var t=this.getNode(),i="xsd:annotation/xsd:documentation[@xml:lang='"+qx.locale.Manager.getInstance().getLanguage()+"']",n=this.__P_47_4(t,i),a=this.getType();if("element"===a){if(0===t.querySelectorAll(":scope > complexType").length){var r;(r=n).push.apply(r,_toConsumableArray(this.__P_47_4(this._type,i)))}}else if("attribute"===a&&t.hasAttribute("ref")){var o,s=t.getAttribute("ref"),l=this.getSchema().getReferencedNode("attribute",s);(o=n).push.apply(o,_toConsumableArray(this.__P_47_4(l,i)));n=n.map(function(t){return e.createDocumentationWebLinks(t)})}this.__P_47_3=n;return n},createDocumentationWebLinks:function(e){var t=this.__P_47_1;return e.replace(this.__P_47_0,function(e,i){var n=i.match(/^(.*?) *<([^<]*)>$/),a=n?n[1]:i,r=n?n[2]:i;return'<a class="doclink" target="_blank" href="'+cv.ui.manager.model.schema.DocumentationMapping.MAP._base+t+cv.ui.manager.model.schema.DocumentationMapping.MAP[r]+'">'+a+"</a>"})}},destruct:function(){this.__P_47_2=null;this.__P_47_3=null;this.__P_47_0=null}});cv.ui.manager.model.schema.MAnnotation.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.MAnnotation":{require:!0},"cv.ui.manager.model.schema.SimpleType":{},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{},"cv.ui.manager.model.schema.Group":{},"cv.ui.manager.model.schema.Any":{},"cv.ui.manager.model.schema.Attribute":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Element",{extend:cv.ui.manager.model.schema.Base,include:cv.ui.manager.model.schema.MAnnotation,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},statics:{getElementName:function(e,t){if(e.hasAttribute("name"))return e.getAttribute("name");if(e.hasAttribute("ref")){var i=e.getAttribute("ref"),n=t.getReferencedNode("element",i);if(1!==n.length)throw new Error("schema/xsd appears to be invalid, can not find element "+i);return n.getAttribute("name")}return"unknown"},getTypeNode:function(e,t){var i;e.hasAttribute("type")?i=e.getAttribute("type").match(/^xsd:/)?e:t.getTypeNode("complex",e.getAttribute("type")):e.hasAttribute("ref")||(i=e.querySelector(":scope > complexType"));return i},sortChildNodes:function(e){return function(t,i){var n=e[t.name],a=e[i.name];if(void 0===n||void 0===a)return 0;if(n===a)return 0;"string"!=typeof n&&(n=n.toString());"string"!=typeof a&&(a=a.toString());for(var r=n.split("."),o=a.split("."),s=0;s<r.length;++s){if(r[s]<o[s])return-1;if(r[s]>o[s])return 1}return 0}}},properties:{type:{refine:!0,init:"element"},name:{check:"String",init:""},defaultValue:{check:"String",nullable:!0},sortable:{check:"Boolean",init:!1,event:"changeSortable"},mixed:{check:"Boolean",init:!1}},members:{__P_46_0:!1,__P_46_1:null,__P_46_2:null,__P_46_3:null,_type:null,parse:function(){cv.ui.manager.model.schema.Element.prototype.parse.base.call(this);var e=this.getNode(),t=this.getSchema();this._type=cv.ui.manager.model.schema.Element.getTypeNode(e,t);this.setName(cv.ui.manager.model.schema.Element.getElementName(e,t));e.hasAttribute("default")&&this.setDefaultValue(e.getAttribute("default"));this.setMixed(this._type.hasAttribute("mixed")&&"true"===this._type.getAttribute("mixed"))},getAllowedContent:function(){if(null!==this.__P_46_1)return this.__P_46_1;var e=this.getSchema(),t={_grouping:void 0,_text:!1};if(this._type.querySelectorAll(":scope > simpleContent").length>0)t._text=new cv.ui.manager.model.schema.SimpleType(this._type.querySelector(":scope > simpleContent"),e);else if(this._type.querySelectorAll("complexType > choice, complexType> sequence, complexType > group").length>0){var i=this._type.querySelector("complexType > choice, complexType > sequence, complexType > group");switch(i.nodeName){case"xsd:choice":case"choice":t._grouping=new cv.ui.manager.model.schema.Choice(i,e);break;case"xsd:sequence":case"sequence":t._grouping=new cv.ui.manager.model.schema.Sequence(i,e);break;case"xsd:group":case"group":t._grouping=new cv.ui.manager.model.schema.Group(i,e);break;case"xsd:any":case"any":t._grouping=new cv.ui.manager.model.schema.Any(i,e)}}else{if(!this._type.hasAttribute("type")||!this._type.getAttribute("type").match(/^xsd:/)){this.__P_46_1=t;return t}t._text=new cv.ui.manager.model.schema.SimpleType(this._type,e)}Array.from(this._type.querySelectorAll(":scope > element")).forEach(function(i){var n=new cv.ui.manager.model.schema.Element(i,e);t[n.getName()]=n});this.__P_46_1=t;return t},getAllowedAttributes:function(){var e=this;if(null===this.__P_46_2){var t={},i=Array.from(this._type.querySelectorAll(":scope > attribute, :scope > simpleContent > extension > attribute"));Array.from(this._type.querySelectorAll(":scope > attributeGroup, :scope > simpleContent > extension > attributeGroup")).forEach(function(t){var n={};n=t.hasAttribute("ref")?e.getSchema().getReferencedNode("attributeGroup",t.getAttribute("ref")):t;Array.from(n.querySelectorAll(":scope > attribute")).forEach(function(e){i.push(e)})});i.forEach(function(i){var n=new cv.ui.manager.model.schema.Attribute(i,e.getSchema());t[n.getName()]=n});this.__P_46_2=t}return this.__P_46_2},areChildrenSortable:function(){var e=this.getAllowedContent();return void 0===e._grouping||!e._grouping.getElementsHaveOrder()},getRequiredElements:function(){var e=this.getAllowedContent();return void 0!==e._grouping?e._grouping.getRequiredElements():[]},getAllowedElements:function(e){var t=this.getAllowedContent(),i={};void 0!==t._grouping&&Object.assign(i,t._grouping.getAllowedElements());var n=!1;if(this.isMixed())i["#text"]=this.getSchema().getTextNodeSchemaElement();else if(t._text&&void 0===t._grouping){i["#text"]=t._text;n=!0}n||e||(i["#comment"]=this.getSchema().getCommentNodeSchemaElement());return i},getAllowedElementsSorting:function(){var e=this.getAllowedContent();if(void 0!==e._grouping)return e._grouping.getAllowedElementsSorting()},getFirstLevelElementSorting:function(){var e=this.getAllowedElementsSorting();e&&Object.keys(e).forEach(function(t){var i=e[t];"string"==typeof i&&(i=parseInt(i.split(".")[0]));e[t]=i});return e},getChildBounds:function(){var e=this.getAllowedContent();if(void 0!==e._grouping&&!0!==e._grouping.hasMultiLevelBounds())return e._grouping.getBounds()},getBoundsForElementName:function(e){return this.getAllowedContent()._grouping.getBoundsForElementName(e)},isTextContentAllowed:function(){if(this.isMixed())return!0;var e=this.getAllowedContent();return void 0!==e._text&&!1!==e._text},isTextContentRequired:function(){return!!this.isTextContentAllowed()&&(!this.isMixed()&&!this.getAllowedContent()._text.isValueValid(""))},isChildElementAllowed:function(e){if("#text"===e||"#cdata-section"===e)return this.isTextContentAllowed();if("#comment"===e)return!0;var t=this.getAllowedContent();return void 0!==t._grouping&&t._grouping.isElementAllowed(e)},getSchemaElementForElementName:function(e){var t=this.getAllowedContent();if("#text"===e||"#cdata-section"===e){if(!1===this.isTextContentAllowed())return;if(!this.__P_46_3){var i=this.getSchema().getSchemaDOM().createElement("element");i.setAttribute("name","#text");i.setAttribute("type","xsd:string");this.__P_46_3=new cv.ui.manager.model.schema.Element(i,this.getSchema());t._text?this.__P_46_3.getAllowedContent()._text=t._text:this.isMixed()&&(this.__P_46_3.getAllowedContent._text=this.getSchema().getTextNodeSchemaElement())}return this.__P_46_3}return"#comment"===e?this.getSchema().getCommentNodeSchemaElement():void 0!==t._grouping&&t._grouping.isElementAllowed(e)?t._grouping.getSchemaElementForElementName(e):void 0},getSchemaDOM:function(){return this.getSchema().getSchemaDOM()},isValueValid:function(e){return!1!==this.isTextContentAllowed()&&(!!this.isMixed()||this.getAllowedContent()._text.isValueValid(e))},getRegex:function(e,t){void 0!==e&&void 0!==e||(e="");var i="(";t&&(i+="?:");i+=this.getName()+e+")";var n="",a="",r=this.getBounds();void 0!==r.min&&(n=r.min);void 0!==r.max&&r.max!==Number.POSITIVE_INFINITY&&(a=r.max);""===n&&""===a||(i+="{"+n+","+a+"}");return i},getChildrenRegex:function(e,t){void 0!==e&&void 0!==e||(e="");var i=this.getAllowedContent();return void 0===i._grouping?"^":i._grouping.getRegex(e,t)}},destruct:function(){this._disposeMap("__P_46_2");this._disposeMap("__P_46_1");this._disposeObjects("__P_46_3")}});cv.ui.manager.model.schema.Element.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();o=e.done;return e},e:function(e){s=!0;r=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.marshal.MEventBubbling":{require:!0},"qx.data.Array":{construct:!0},"cv.theme.dark.Images":{},"cv.IconHandler":{},"cv.ui.manager.model.ElementChange":{},"qx.locale.Manager":{},"qx.core.ValidationError":{},"qx.lang.String":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.XmlElement",{extend:qx.core.Object,include:[qx.data.marshal.MEventBubbling],construct:function(e,t,i,n){qx.core.Object.constructor.call(this);this._node=e;var a=new qx.data.Array;if(e){this._node.$$widget=this;this.initName(e.nodeName);this.setSchemaElement(t);this.hasChildren()&&a.push(new cv.ui.manager.model.XmlElement);i&&this.setEditor(i);n&&this.setParent(n);this._maintainIcon();this._maintainStatus()}else this.initName("#temp");this.initChildren(a);this._initialAttributes=new Map;this.bind("editor.file.writeable",this,"editable")},statics:{entityMap:{"&":"&amp;",'"':"&quot;","'":"&#39;","`":"&#x60;"}},properties:{editor:{check:"cv.ui.manager.editor.Tree",nullable:!0,event:"changeEditor"},schemaElement:{check:"cv.ui.manager.model.schema.Element",apply:"_applySchemaElement"},name:{check:"String",deferredInit:!0,event:"changeName",apply:"_updateDisplayName"},displayName:{check:"String",init:"",event:"changeDisplayName"},open:{check:"Boolean",event:"changeOpen",init:!1,apply:"_onOpen"},loaded:{check:"Boolean",event:"changeLoaded",init:!1},children:{check:"qx.data.Array",event:"changeChildren",apply:"_applyEventPropagation",deferredInit:!0},textContent:{check:"String",nullable:!0,apply:"_applyTextContent",event:"changeTextContent",validate:"_validateTextContent"},temporary:{check:"Boolean",init:!1,event:"changeTemporary"},valid:{check:"Boolean",init:!0,event:"changeValid",apply:"_applyValid"},invalidMessage:{check:"String",init:"",event:"changeInvalidMessage"},status:{check:["error","valid","comment"],init:"valid",event:"changeStatus"},editable:{check:"Boolean",init:!0,event:"changeEditable",apply:"_applyEditable"},sortable:{check:"Boolean",init:!0,event:"changeSortable"},deletable:{check:"Boolean",init:!0,event:"changeDeletable"},modified:{check:"Boolean",init:!1,apply:"_applyModified"},showEditButton:{check:"Boolean",init:!0,event:"changeShowEditButton"},parent:{check:"cv.ui.manager.model.XmlElement",nullable:!0},icon:{check:"String",nullable:!0,event:"changeIcon"},dragging:{check:"Boolean",init:!1,event:"changeDragging"}},members:{_node:null,_schema:null,_schemaElement:null,_initialAttributes:null,_initialChildNames:null,_initialTextContent:null,__P_44_0:!1,__P_44_1:null,_maintainStatus:function(){this._node.nodeType===Node.COMMENT_NODE?this.setStatus("comment"):this.isValid()?this.setStatus("valid"):this.setStatus("error")},_applyValid:function(e){this._maintainStatus();e&&this.resetInvalidMessage()},convertTextNodeType:function(e){if(this.isTextNode()&&this._node.nodeType!==e&&(e===Node.TEXT_NODE||e===Node.CDATA_SECTION_NODE)){var t=this.getText(),i=this._node,n=e===Node.CDATA_SECTION_NODE?this._node.ownerDocument.createCDATASection(t):this._node.ownerDocument.createTextNode(t);i.parentNode&&i.parentNode.replaceChild(n,i);this._node=n;this.setName(this._node.nodeName);this.load(!0)}},_maintainIcon:function(){if(this._node){if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this.setIcon(cv.theme.dark.Images.getIcon("text-fields",18));return}if(this._node.nodeType===Node.COMMENT_NODE){this.setIcon(cv.theme.dark.Images.getIcon("comment-fields",18));return}if("icon"===this.getName()&&this.getAttribute("name")&&-1===this.getAttribute("name").indexOf("{{")){var e=cv.IconHandler.getInstance().getIconSource(this.getAttribute("name"),"tree-icon");e?this.setIcon(e):this.setIcon(cv.theme.dark.Images.getIcon("image",18));return}}this.isOpen()?this.setIcon(cv.theme.dark.Images.getIcon("folder-open",18)):this.setIcon(cv.theme.dark.Images.getIcon("folder",18))},_applyEditable:function(){this._updateShowEditButton();this.updateDeletable()},_updateShowEditButton:function(){var e=this.getSchemaElement();this.setShowEditButton(e.isTextContentAllowed()&&this.getName().startsWith("#")||Object.keys(e.getAllowedAttributes()).length>0||e.isChildElementAllowed("*"))},updateDeletable:function(){var e=this;if(this.isEditable()){var t=this.getParent();if(this.isTextNode())if(this.getSchemaElement().isTextContentRequired()){var i=t.getChildren().filter(function(e){return e.isTextNode()}).length;this.setDeletable(i>1)}else this.setDeletable(!0);else{var n=!1;if(t){var a=t.getSchemaElement();if(a.getRequiredElements().includes(this.getName())){var r=a.getBoundsForElementName(this.getName());if(r){var o=t.getChildren().filter(function(t){return t.getName()===e.getName()}).length;n=r.min<=o-1}else n=!0}else n=!0}else n=!0;this.setDeletable(n)}}else this.setDeletable(!1)},getNode:function(){return this._node},remove:function(e){var t=this.getParent();if(t){var i=[{index:t.getChildren().indexOf(this),parent:t,child:this}];this._node.remove();t.getChildren().remove(this);var n=this.getEditor();this.$$removed=!0;n&&n.updateModified(this);t.updateModified();if(!e&&n){var a=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Remove %1",this.getDisplayName()),this,i,"deleted");n.addUndo(a)}}},isAncestor:function(e){for(var t=e.getParent();t;){if(t===this)return!0;t=t.getParent()}return!1},_move:function(e,t,i){if(this.isAncestor(e))return!1;if(e===this)return!1;var n=this.getParent(),a=n.getChildren(),r="inside"===t?e:e.getParent(),o=r.getChildren(),s=[{oldIndex:a.indexOf(this),oldParent:n,parent:r,child:this,index:o.indexOf(e)+("after"===t?1:0)}];if("inside"===t&&r.getSchemaElement().isChildElementAllowed(this.getName())||r.isChildAllowedAtPosition(this,s[0].index)){a.remove(this);this.getNode().remove();r===n&&(s[0].index=o.indexOf(e)+("after"===t?1:0));r.insertChild(this,s[0].index,!0,"moved");if(!i){var l=this.getEditor();if(l){var c=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Move %1",this.getDisplayName()),this,s,"moved");l.addUndo(c)}}return!0}return!1},moveTo:function(e,t,i){if(this.isAncestor(e))return!1;var n=this.getParent(),a=n.getChildren(),r=[{oldIndex:a.indexOf(this),oldParent:n,parent:e,child:this,index:t}],o=e===n&&t<a.length?a.getItem(t):null;if(e.isChildAllowedAtPosition(this,t)){a.remove(this);this.getNode().remove();if(o){t=a.indexOf(o);r[0].index=t}e.insertChild(this,t,!0,"moved");if(!i){var s=this.getEditor();if(s){var l=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Move %1",this.getDisplayName()),this,r,"moved");s.addUndo(l)}}return!0}return!1},moveAfter:function(e,t){return this._move(e,"after",t)},moveBefore:function(e,t){return this._move(e,"before",t)},moveInside:function(e,t){return this._move(e,"inside",t)},insertAfter:function(e,t){var i=e.getParent(),n=i.getChildren().indexOf(e)+1;return i.insertChild(this,n,t,"added")},insertBefore:function(e,t){var i=e.getParent(),n=i.getChildren().indexOf(e);return i.insertChild(this,n,t,"added")},getAddableChildren:function(e){if(!this.__P_44_1)if(this.getName().startsWith("#"))this.__P_44_1=[];else{var t=this.getSchemaElement(),i=t.getAllowedElements(),n=[],a={};this.isLoaded()||this.load();this.getChildren().forEach(function(e){Object.prototype.hasOwnProperty.call(a,e.getName())||(a[e.getName()]=0);a[e.getName()]++});Object.keys(i).forEach(function(i){if(!0!==e||"#comment"!==i)if("#text"!==i&&"#cdata-section"!==i){var r=t.getBoundsForElementName(i),o=Object.prototype.hasOwnProperty.call(a,i)?a[i]:0;r&&r.max>o&&n.push(i)}else if(t.isTextContentAllowed())if(t.isMixed()){var s=0,l=0;Object.keys(a).forEach(function(e){"#text"===e||"#cdata-section"===e?s+=a[e]:l+=a[e]});s<=l&&n.push(i)}else Object.prototype.hasOwnProperty.call(a,"#text")||Object.prototype.hasOwnProperty.call(a,"#cdata-section")||n.push(i)});this.__P_44_1=n}return this.__P_44_1},isChildAllowedAtPosition:function(e,t){var i=this.getSchemaElement(),n=e instanceof cv.ui.manager.model.XmlElement?e.getName():e;if(!i.isChildElementAllowed(n)){this.debug(n,"is not allowed as child of",this.getName());return!1}if(i.areChildrenSortable())return!0;var a=i.getFirstLevelElementSorting();this.isLoaded()||this.load();var r=this.getChildren();if(0===r.length)return!0;var o=t;o=r.length>t?a[r.getItem(t).getName()]:r.length;var s,l=a[n];if(o===l||l>=r.length)return!0;if(t>0)for(var c=Math.min(t,r.length)-1;c>=0;c--)if(r.getItem(c).getName()!==n){s=r.getItem(c).getName();break}s&&(o=a[s]);if(!(o+1>=l)){this.debug(n,"is not allowed as child of",this.getName());return!1}return!0},findPositionForChild:function(e){var t=this.getSchemaElement();if(t.isChildElementAllowed(e.getName())){this.isLoaded()||this.load();if(t.areChildrenSortable())return this.getChildren().length;var i=t.getFirstLevelElementSorting();if(i&&Object.prototype.hasOwnProperty.call(i,e.getName())){var n=i[e.getName()],a=n;this.getChildren().some(function(e,t){if(i[e.getName()]>n){a=t;return!0}return!1})||(a=this.getChildren().length);return a}}return-1},insertChild:function(e,t,i,n){this.isLoaded()||this.load();var a=this.getChildren(),r=!1;if(-1===t&&-1===(t=this.findPositionForChild(e)))return!1;if(this.isChildAllowedAtPosition(e,t))if(t>=a.length){this._node.appendChild(e.getNode());a.push(e);r=!0}else if(0===t){this._node.insertBefore(e.getNode(),this._node.childNodes[0]);a.unshift(e);r=!0}else{var o=a.getItem(t);if(o){o.getNode().before(e.getNode());a.insertBefore(o,e);r=!0}}if(r){var s=this.getEditor();e.setParent(this);if(e.$$removed){delete e.$$removed;s&&s.updateModified(e);e.updateModified()}else if(!n||"added"===n){e.$$added=!0;e.updateModified()}this.updateModified();1===a.length&&this.setOpen(!0);if(!i&&s){var l=[{index:t,parent:this,child:e}],c=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Add %1",this.getDisplayName()),this,l,"created");s.addUndo(c)}}return r},_validateTextContent:function(e){if(!this.__P_44_0){if(!this._node)throw new qx.core.ValidationError(qx.locale.Manager.tr("Text content not allowed here"));if(!this.getSchemaElement().isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("Invalid text content: '%1'",e))}},validate:function(e){var t=this,i=this.getSchemaElement();if(this.isTextNode()){this.getParent().validate(!1);this.setValid(i.isValueValid(this.getText()))}else if(this.isElement()){for(var n=i.getAllowedAttributes(),a=[],r=0;r<this._node.attributes.length;r++){var o=this._node.attributes.item(r);Object.prototype.hasOwnProperty.call(n,o.name)?n[o.name].isValueValid(o.value)||a.push({attribute:o.name,error:qx.locale.Manager.tr("Invalid value")}):a.push({attribute:o.name,error:qx.locale.Manager.tr("Attribute '%1' not allowed",o.name)})}Object.keys(n).filter(function(e){return!n[e].isOptional()}).forEach(function(e){t._node.hasAttribute(e)||a.push({attribute:e,error:qx.locale.Manager.tr("Attribute '%1' is required but missing",e)})});if(i.isTextContentRequired()){this.getChildren().some(function(e){return e.isTextNode()&&""!==e.getNode().nodeValue.trim()})||a.push({attribute:"#text",error:qx.locale.Manager.tr("Text content is missing")})}i.isTextContentAllowed()&&this.getChildren().forEach(function(e){if(e.isTextNode()){e.load();e.setValid(i.isValueValid(e.getText()));e.isValid()||e.setInvalidMessage(qx.locale.Manager.tr("Text content is invalid"))}});this.setInvalidMessage(a.map(function(e){return e.error}).join("<br/>"));this.setValid(0===a.length)}},isTextNode:function(){return"#text"===this.getName()||"#cdata-section"===this.getName()},_applyTextContent:function(e){if(!this.__P_44_0&&this._node)if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.COMMENT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this._node.nodeValue=e;this._updateDisplayName()}else this._node.nodeType===Node.ELEMENT_NODE&&(this._node.textContent=e)},getText:function(){return this.getTextContent()},setText:function(e,t){var i=!1,n=e,a="";if(this.getSchemaElement().isTextContentAllowed()){a=this.getTextContent();if(this.getSchemaElement().isValueValid(e)){if(a!==e){this.setTextContent(e);i=!0}}else this.error("'"+e+"' is no valid text content for a '"+this.getName()+"' element")}else this.error("text content is not allowed for a '"+this.getName()+"' element");return{changed:i,attribute:t||"#text",value:n,old:a}},getAttribute:function(e){return this._node.getAttribute(e)},setAttribute:function(e,t){if(this._node.nodeType===Node.ELEMENT_NODE){var i=this.getSchemaElement().getAllowedAttributes()[e],n=!1,a=t,r=this._node.hasAttribute(e)?this._node.getAttribute(e):"";if(i){a=t=(t=null===t||void 0===t?"":""+t).replace(/[&"'`]/g,function(e){return cv.ui.manager.model.XmlElement.entityMap[e]});if(i.isValueValid(t)){if(r!==t){if(t&&t!==i.getDefaultValue())this._node.setAttribute(e,t);else{this._node.removeAttribute(e);a=""}if("name"===e){this._updateDisplayName();"icon"===this.getName()&&this._maintainIcon()}n=!0}}else this.error("'"+t+"' is not allowed for attribute '"+e+"'")}else this.error("'"+e+"' is no allowed attribute for a '"+this.getName()+"' element");return{changed:n,attribute:e,value:a,old:r}}if(this._node.nodeType===Node.TEXT_NODE&&"#text"===e||this._node.nodeType===Node.CDATA_SECTION_NODE&&"#cdata-section"===e)return this.setText(t,e);if(this._node.nodeType===Node.COMMENT_NODE&&"#comment"===e){var o=this.getTextContent(),s=t!==o;this.setTextContent(t);return{changed:s,attribute:e,value:t,old:o}}return null},isRequired:function(){var e=this.getParent();if(e){return e.getSchemaElement().getRequiredElements().includes(this.getName())}return!0},setAttributes:function(e){var t,i=this,n=[],a=[],r="#text"===this.getName()||"#cdata-section"===this.getName(),o=this.getParent();Object.keys(e).forEach(function(s){if(r&&!s.startsWith("#"))(t=o.setAttribute(s,e[s])).changed&&a.push(t);else if("#outerHTML"===s||"#innerHTML"===s){if(i.getSchemaElement().isChildElementAllowed("*")){var l=(new DOMParser).parseFromString(e[s],"text/xml");if(0===l.getElementsByTagName("parsererror").length){var c="#outerHTML"===s?i._node.outerHTML:i._node.innerHTML,d=l.documentElement;if("#outerHTML"===s){var u=i._node;u.parentNode.replaceChild(d,u);i._node=d;i.setName(i._node.nodeName)}else i._node.innerHTML=e[s];n.push({changed:!0,attribute:s,value:e[s],old:c});i.load(!0)}}else if("#innerHTML"===s&&!e[s]){var h=i._node.innerHTML;i._node.innerHTML=e[s];n.push({changed:!0,attribute:s,value:e[s],old:h});i.load(!0)}}else(t=i.setAttribute(s,e[s])).changed&&n.push(t)});var s=this.getEditor();if(s&&n.length>0){if(a.length>0){var l=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Change %1",o.getDisplayName()),o,a);n.push(l);o.updateModified()}s.addUndo(new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Change %1",this.getDisplayName()),this,n))}this.updateModified()},_applySchemaElement:function(e){e.bind("sortable",this,"sortable",{converter:function(e){return this.isEditable()&&e}.bind(this)});this._updateShowEditButton()},_onOpen:function(e){e&&!this.isLoaded()&&this.load();this._maintainIcon()},_applyModified:function(){this._updateDisplayName()},_updateDisplayName:function(){var e=this.getName();if(this._node)if(this._node.nodeType===Node.ELEMENT_NODE){if(this._node.hasAttribute("name")){e+=' "'+this._node.getAttribute("name")+'"'}else if("pages"===this.getName()&&this._node.hasAttribute("design")){e+=' "'+this._node.getAttribute("design")+'"'}}else if((this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE||this._node.nodeType===Node.COMMENT_NODE)&&this._node.nodeValue.trim()){var t=this._node.nodeValue.trim();t.length>26&&(t=t.substring(0,26)+"...");e=t}this.isModified()&&(e+=" *");this.setDisplayName(e)},hasChildren:function(){if(this._node.nodeType===Node.ELEMENT_NODE&&this._node&&this._node.hasChildNodes())for(var e=0;e<this._node.childNodes.length;e++){var t=this._node.childNodes.item(e);if(t.nodeType===Node.ELEMENT_NODE||(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)&&""!==t.nodeValue.trim())return!0}return!1},load:function(e){if(!this.isLoaded()||e){this.__P_44_0=!0;var t=this.getChildren();t.removeListener("change",this._syncChildNodes,this);t.removeAll();if(this._node)if(this._node.nodeType===Node.ELEMENT_NODE){var i=this.getSchemaElement();this._initialChildNames=[];for(var n=0;n<this._node.childNodes.length;n++){var a=this._node.childNodes.item(n),r=i.getSchemaElementForElementName(a.nodeName);if(r){if(a.nodeType===Node.ELEMENT_NODE){var o=new cv.ui.manager.model.XmlElement(a,r,this.getEditor(),this);t.push(o);this._initialChildNames.push(a.nodeName)}else if(a.nodeType===Node.TEXT_NODE||a.nodeType===Node.CDATA_SECTION_NODE){if(a.nodeValue.trim()){var s=new cv.ui.manager.model.XmlElement(a,i,this.getEditor(),this);i.isMixed()&&s.setSortable(!0);t.push(s);a.nodeValue.trim()&&this._initialChildNames.push(a.nodeName)}}else if(a.nodeType===Node.COMMENT_NODE&&a.nodeValue){var l=new cv.ui.manager.model.XmlElement(a,r,this.getEditor(),this);l.setSortable(!1);t.push(l);a.nodeValue.trim()&&this._initialChildNames.push(a.nodeName)}}else if(a.nodeType===Node.ELEMENT_NODE)if(i.isChildElementAllowed(a.nodeName)){var c=new cv.ui.manager.model.XmlElement(a,i,this.getEditor(),this);i.isMixed()&&c.setSortable(!0);t.push(c);this._initialChildNames.push(a.nodeName)}else{this.setValid(!1);var d=this.getInvalidMessage();d=(d?d+"<br/>":"")+qx.locale.Manager.tr("Child element '%1' not allowed.",a.nodeName);this.setInvalidMessage(d);this.setValid(!1)}}this._initialAttributes.clear();for(var u=0;u<this._node.attributes.length;u++){var h=this._node.attributes.item(u);this._initialAttributes.set(h.name,h.value)}}else if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.COMMENT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this._initialTextContent=this._node.nodeValue;try{this.setTextContent(this._node.nodeValue)}catch(e){this.appendInvalidMessage(e.toString())}}this.setLoaded(!0);t.addListener("change",this._syncChildNodes,this);this._updateChildrenDeletableFlags();this.__P_44_0=!1}},appendInvalidMessage:function(e){if(e){var t=this.getInvalidMessage();this.setInvalidMessage(t?t+"<br/>"+e:e)}},updateModified:function(){if(this.$$added)this.setModified(!0);else if(this._node.nodeType===Node.ELEMENT_NODE){var e=this._initialAttributes,t=this._currentChildNames();if(this._node.attributes.length!==e.size)this.setModified(!0);else if(t.length!==this._initialChildNames.length||t.join("")!==this._initialChildNames.join(""))this.setModified(!0);else{var i,n=!1,a=_createForOfIteratorHelper(e);try{for(a.s();!(i=a.n()).done;){var r=_slicedToArray(i.value,2),o=r[0],s=r[1];if(!this._node.hasAttribute(o)||this._node.getAttribute(o)!==s){n=!0;break}}}catch(e){a.e(e)}finally{a.f()}this.setModified(n)}}else this._node.nodeType!==Node.TEXT_NODE&&this._node.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||this.setModified(this._initialTextContent!==this.getTextContent());var l=this.getEditor();l&&l.updateModified(this)},hasChildrenModified:function(){if(this._node.nodeType===Node.ELEMENT_NODE&&this.isLoaded()){var e=this._currentChildNames();return this.isModified()&&(e.length!==this._initialChildNames.length||e.join("")!==this._initialChildNames.join(""))}return!1},onSaved:function(){if(this._node.nodeType===Node.ELEMENT_NODE){this._initialAttributes.clear();for(var e=0;e<this._node.attributes.length;e++){var t=this._node.attributes.item(e);this._initialAttributes.set(t.name,t.value)}this._initialChildNames=this._currentChildNames()}else this._node.nodeType!==Node.TEXT_NODE&&this._node.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||(this._initialTextContent=this._node.nodeValue);this.$$added&&delete this.$$added;this.setModified(!1)},isElement:function(){return this._node.nodeType===Node.ELEMENT_NODE},_currentChildNames:function(){for(var e=[],t=0;t<this._node.childNodes.length;t++){var i=this._node.childNodes.item(t);i.nodeType===Node.ELEMENT_NODE?e.push(i.nodeName):i.nodeType!==Node.TEXT_NODE&&i.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||!i.nodeValue.trim()||e.push(i.nodeName)}return e},_syncChildNodes:function(e){this.__P_44_1=null;this._updateChildrenDeletableFlags()},_updateChildrenDeletableFlags:function(){this.isEditable()&&this.getChildren().forEach(function(e){(e.isElement()||e.isTextNode())&&e.updateDeletable()})},getWidgetPath:function(){if("#comment"===this.getName())return"";for(var e=this.getSchemaElement().getSchema().getWidgetNames(),t=this;t&&!e.includes(t.getName());)t=t.getParent();if(!t)return"";if("navbar"===t.getName())return"navbar"+qx.lang.String.firstUp(t.getAttribute("position"));for(var i=[],n=t;n;){var a=n.getParent();if("pages"===a.getName()){i.unshift("id");break}var r=a.getChildren().filter(function(e){return e.getNode().nodeType===Node.ELEMENT_NODE&&"layout"!==e.getName()}).indexOf(n);i.unshift(r);n=a}"page"===t.getName()&&i.push("");return i.join("_")},clone:function(){return new cv.ui.manager.model.XmlElement(this._node.cloneNode(!0),this.getSchemaElement(),this.getEditor())}},destruct:function(){this._node=null;this._schema=null;this._initialAttributes=null;this.__P_44_1=null;this._disposeObjects("_schemaElement")}});cv.ui.manager.model.XmlElement.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"qx.lang.Function":{},"qx.log.Logger":{},"qx.lang.Type":{},"qx.io.request.Xhr":{},"cv.TemplateEngine":{},"cv.Transform":{},"qx.locale.Manager":{},"qx.io.PartLoader":{},"cv.IconHandler":{},"cv.IconConfig":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.data.Provider",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_35_0={};this._client=cv.io.rest.Client.getDataProviderClient()},statics:{Config:{address:{"#text":{cache:!0,userInputAllowed:!0,grouped:!0,method:"getAddresses"}},rrd:{"#text":{cache:!0,userInputAllowed:!0,method:"getRrds"}},influx:{measurement:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBs"},field:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBFields"}},tag:{key:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBTags"},value:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBValues"}},icon:{name:{cache:!1,live:!0,userInputAllowed:!1,method:"getIcons"}},plugin:{name:{cache:!0,userInputAllowed:!1,method:"getPlugins"}},pages:{design:{method:"getDesigns",cache:!0,userInputAllowed:!1}},"*":{rrd:{method:"getRrds",cache:!0,userInputAllowed:!0},ga:{method:"getAddresses",cache:!0,userInputAllowed:!0,grouped:!0},transform:{method:"getTransforms",cache:!0,userInputAllowed:!1}}},get:function(e){var t=cv.ui.manager.editor.data.Provider.getInstance(),i=e.split("@"),n=_slicedToArray(i,2),a=n[0],r=n[1],o=null;this.Config[a]&&this.Config[a][r]?o=this.Config[a][r]:this.Config["*"][r]&&(o=this.Config["*"][r]);if(o){var s={};if(o.live)s.getLive=qx.lang.Function.curry(t[o.method],"dp",o).bind(t);else{for(var l=arguments.length,c=new Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];c.unshift(o);c.unshift("dp");s.data=t[o.method].apply(t,c)}return Object.assign(s,o)}return null}},members:{__P_35_0:null,_getFromCache:function(e){return this.__P_35_0[e]},__P_35_1:function(e){e?delete this.__P_35_0[e]:this.__P_35_0={}},_addToCache:function(e,t){this.__P_35_0[e]=t},getDesigns:function(e,t){t||(t={cache:!0});return this.__P_35_2("designs","designsSync",null,[],"dp"===e?function(e){return e.map(function(e){return{label:e,value:e}})}:function(e){return e.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})},this,t.cache)},__P_35_2:function(e,t,i,n,a,r,o){var s=o?this._getFromCache(e):null;return s?Promise.resolve(a.call(r||this,s)):new Promise(function(s,l){var c=function(t,i){if(t)l(t);else if("string"==typeof i&&i.startsWith("Error:")){qx.log.Logger.error(this,i);s(a.call(r||this,[]))}else{o&&this._addToCache(e,i);s(a.call(r||this,i))}};if(n){n.push(c);n.push(this)}else n=[c,this];qx.lang.Type.isString(t)?this._client[t].apply(i||this._client,n):qx.lang.Type.isFunction(t)&&t.apply(i,n)}.bind(this))},__P_35_3:function(e,t,i,n){var a=n?this._getFromCache(e):null;if(a){t&&(a=t.call(i||this,a));return Promise.resolve(a)}return new Promise(function(a,r){var o=this,s=new qx.io.request.Xhr(e),l=cv.TemplateEngine.getClient();l&&l.authorize(s);s.set({accept:"application/json"});s.addListener("success",function(r){var s=r.getTarget().getResponse();n&&o._addToCache(e,s);t&&(s=t.call(i||o,s));a(s)},this);s.addListener("statusError",r,this);s.send()}.bind(this))},getAddresses:function(e,t){var i=cv.TemplateEngine.getClient();t||(t={cache:!0});return i&&i.hasProvider("addresses")?this.__P_35_3(i.getProviderUrl("addresses"),i.getProviderConvertFunction("addresses",e),i,t.cache):this.__P_35_2("addresses","addressesSync",null,[],"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},getRrds:function(e,t){var i=cv.TemplateEngine.getClient();t||(t={cache:!0});return i&&i.hasProvider("rrd")?this.__P_35_3(i.getProviderUrl("rrd"),i.getProviderConvertFunction("rrd",e),i,t.cache):this.__P_35_2("rrds","rrdsSync",null,[],"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},getInfluxDBs:function(e,t,i){var n=this.__P_35_4(i,!1);return this.__P_35_2("influxdbs","influxdbsSync",null,n,"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},__P_35_4:function(e,t){var i=[];e.hasAttribute("authentication")&&i.push({auth:e.getAttribute("authentication")});if(t){for(var n=e;"influx"!==n.nodeName;)if(void 0===(n=n.parentElement))throw new Error;i.push({measurement:e.getAttribute("measurement")})}return i},getInfluxDBFields:function(e,t,i){try{var n=this.__P_35_4(i,!0);return this.__P_35_2("influxdbfields|"+n.measurement+"|"+n.auth,"influxdbfieldsSync",null,n,"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)}catch(e){return[]}},__P_35_5:function(e,t,i,n){try{var a=this.__P_35_4(i,!0);return this.__P_35_2("influxdbtags|"+a.measurement+"|"+a.auth,"influxdbtagsSync",null,a,n,this,t.cache)}catch(e){return[]}},getInfluxDBTags:function(e,t,i){return this.__P_35_5(e,t,i,function(t){return"monaco"===e?Object.keys(t).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}):Object.keys(t).map(function(e){return{value:e,label:e}})})},getInfluxDBValues:function(e,t,i,n){return this.__P_35_5(e,t,i,function(t){return null!==t&&i.attributes.key in t?"monaco"===e?t[n].map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}):t[n].map(function(e){return{label:e,value:e}}):[]})},_parseDpResponseForMonaco:function(e){return this.__P_35_6(e,"monaco")},_parseDpResponseForEditor:function(e){return this.__P_35_6(e,"dp")},__P_35_6:function(e,t){var i=[];if(t&&"monaco"!==t){if("dp"===t)return e||[]}else e.forEach(function(e){i.push({label:e.label,insertText:e.value,kind:window.monaco.languages.CompletionItemKind.EnumMember})},this);return i},getMediaFiles:function(e,t,i){var n=cv.io.rest.Client.getFsClient();return this.__P_35_2("media",n.readSync,n,[{path:"media",recursive:!0}],function(e){return e.filter(function(e){return!i||e.name.endsWith("."+i)}).map(function(e){var t=e.parentFolder+e.name;return{label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember}})},this,t.cache)},getTransforms:function(e,t){e||(e="monaco");var i="transforms|"+e,n=!t||!0===t.cache,a=n?this._getFromCache(i):null;if(a)return a;var r=[];Object.keys(cv.Transform.registry).forEach(function(t){var i,n=cv.Transform.registry[t];if("dp"===e)i={label:n.name+" ["+t+"]",value:t};else{i={label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember};n.lname&&Object.prototype.hasOwnProperty.call(n.lname,qx.locale.Manager.getInstance().getLanguage())&&(i.detail=n.lname[qx.locale.Manager.getInstance().getLanguage()])}r.push(i)},this);n&&this._addToCache(i,r);return r},getPlugins:function(e,t){e||(e="monaco");var i=!t||!0===t.cache,n="plugins|"+e,a=i?this._getFromCache(n):null;if(a)return a;var r=[],o=qx.io.PartLoader.getInstance().getParts();Object.keys(o).forEach(function(t){if(t.startsWith("plugin-")){var i=t.substring(7);"dp"===e?r.push({label:i,value:i}):r.push({label:i,insertText:i,kind:window.monaco.languages.CompletionItemKind.EnumMember})}},this);i&&this._addToCache(n,r);return r},getIcons:function(e,t,i){e||(e="monaco");var n,a=!t||!0===t.cache,r="icons|"+e,o=a?this._getFromCache(r):null;if(o)return o;var s=cv.IconHandler.getInstance();"monaco"===e?n=Object.keys(cv.IconConfig.DB).filter(function(e){return!i||"config"!==cv.IconConfig.DB[e].source}).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}):"dp"===e&&(n=Object.keys(cv.IconConfig.DB).filter(function(e){return!i||"config"!==cv.IconConfig.DB[e].source}).map(function(e){return{label:e,value:e,icon:s.getIconSource(e)}}));if(i)if(i instanceof Element)i.ownerDocument.querySelectorAll("pages > meta > icons > icon-definition").forEach(function(t){var i=t.getAttribute("name");"monaco"===e?n.push({label:i,insertText:i,kind:window.monaco.languages.CompletionItemKind.EnumMember}):"dp"===e&&n.push({label:i,value:i,icon:t.getAttribute("uri")})});else if("string"==typeof i){var l=i.match(/<icon-definition.+>/gm),c=document.createElement("template");l.forEach(function(t){c.innerHTML=t;var i=c.content.firstElementChild,a=i.getAttribute("name");"monaco"===e?n.push({label:a,insertText:a,kind:window.monaco.languages.CompletionItemKind.EnumMember}):"dp"===e&&n.push({label:a,value:a,icon:i.getAttribute("uri")})})}a&&this._addToCache(r,n);return n}},destruct:function(){this.__P_35_0=null}});cv.ui.manager.editor.data.Provider.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Dialog":{construct:!0,require:!0},"cv.ui.manager.editor.Source":{construct:!0},"qx.ui.container.Composite":{},"qx.ui.layout.VBox":{},"qx.bom.Viewport":{},"qx.ui.basic.Label":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.xml.String":{},"qx.ui.form.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.ValidationError",{extend:qxl.dialog.Dialog,construct:function(e,t,i,n){var a=this;this._file=e;this._content=t.split("\n");this._errors=i;qxl.dialog.Dialog.constructor.call(this,Object.assign(n||{},{useBlocker:!0}));this.addListener("appear",function(){window.monaco?a.highlight():cv.ui.manager.editor.Source.load(a.highlight,a)})},events:{action:"qx.event.type.Data"},members:{_content:null,_errors:null,_rootListenerId:null,_file:null,highlight:function(){Array.from(document.querySelectorAll("pre.highlight")).forEach(function(e){monaco.editor.colorizeElement(e,{theme:"vs-dark"})})},_createWidgetContent:function(){var e=this,t=this._createDialogContainer(),i=new qx.ui.container.Composite(new qx.ui.layout.VBox(10));t.add(i);var n=this.tr('<h3>Config Errors</h3><p>The validation of "%1" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because it can break the file completely. Please open this file in the text editor and fix the errors there. Only proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>',this._file.getFullPath()),a=this.tr("<p>You can choose between the following options:<ul>    <li><b>Cancel</b> - Close this editor</li>    <li><b>Proceed</b> - Open the defective file in this editor</li>    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li></ul></p>"),r={rich:!0,width:Math.min(qx.bom.Viewport.getWidth()-32,750),allowGrowX:!0},o=new qx.ui.basic.Label(n);o.set(r);i.add(o);var s=new qx.ui.container.Composite(new qx.ui.layout.VBox(0)),l=new qx.ui.container.Scroll(s);l.set({padding:[0,0,8,8],decorator:"cv-editor-config-section"});l.setMinHeight(100);l.setHeight(Math.min(300,qx.bom.Document.getHeight()-340));this._rootListenerId=qx.core.Init.getApplication().getRoot().addListener("resize",function(){l.setHeight(Math.min(300,qx.bom.Document.getHeight()-340))});i.add(l,{flex:1});var c=new Map;this._errors.forEach(function(t){var i,n=t.line+t.element+t.attribute;if(c.has(n))i=c.get(n);else{for(var a=[],o=Math.max(0,t.line-3),l=Math.min(e._content.length-1,t.line+2),d=Number.POSITIVE_INFINITY,u=o;u<l;u++){var h=e._content[u],g=h.search(/\S|$/);g<d&&g>=0&&(d=g);a.push([u+1,h.trimRight()])}d===Number.POSITIVE_INFINITY&&(d=0);a=a.map(function(e){return e[0]+": "+qx.xml.String.escape(e[1].substr(d))});var m=e.tr("Line %1",t.line);(i=new qx.ui.basic.Label("<h4>".concat(m,'</h4><pre class="highlight" style="background-color: black; padding: 8px;" data-lang="text/xml">').concat(a.join("\n"),"</pre>"))).set(r);c.set(n,i);s.add(i)}t.message.startsWith("[facet")||i.setValue(i.getValue()+"<p>".concat(t.message,"</p>"))},this);var d=new qx.ui.basic.Label(a);d.set(r);i.add(d);var u=this._createButtonPane(),h=new qx.ui.form.Button(this.tr("Cancel"));h.addListener("execute",function(){return e.fireDataEvent("action","cancel")},this);var g=new qx.ui.form.Button(this.tr("Proceed"));g.addListener("execute",function(){return e.fireDataEvent("action","proceed")},this);var m=new qx.ui.form.Button(this.tr("Open in text editor"));m.addListener("execute",function(){return e.fireDataEvent("action","open-source")},this);u.add(h);u.add(g);u.add(m);t.add(u);this.add(t)}},destruct:function(){this._content=null;this._errors=null;this._file=null;if(this._rootListenerId){qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);this._rootListenerId=null}}});cv.ui.manager.dialog.ValidationError.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"iconfont.material.Load":{construct:!0},"cv.ui.manager.model.BackupFolder":{construct:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.control.ActionDispatcher":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.ui.tooltip.Manager":{construct:!0},"qx.core.Init":{},"qx.bom.element.Style":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"cv.ui.manager.model.FileItem":{},"cv.util.ConfigLoader":{},"qxl.dialog.Confirm":{},"cv.ui.manager.model.Preferences":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.ui.manager.editor.AbstractEditor":{},"cv.ui.manager.core.GlobalState":{},"cv.ui.manager.model.OpenFile":{},"cv.ui.manager.editor.IEditor":{},"cv.ui.manager.Start":{},"cv.ui.manager.model.CompareFiles":{},"qx.dom.Element":{},"qx.theme.manager.Meta":{},"cv.theme.Dark":{},"qx.ui.command.Group":{},"qx.ui.command.Command":{},"cv.ui.manager.control.FileController":{},"cv.ui.manager.dialog.Prompt":{},"qx.ui.root.Inline":{},"qx.ui.layout.Canvas":{},"qx.ui.container.Composite":{},"qx.ui.layout.Dock":{},"cv.ui.manager.MenuBar":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.splitpane.Pane":{},"cv.theme.dark.Images":{},"cv.ui.manager.tree.FileSystem":{},"qx.ui.layout.VBox":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.FileTabItem":{},"qx.ui.container.Stack":{},"qx.bom.Viewport":{},"cv.Version":{},"cv.ui.manager.dialog.BigAlert":{},"qx.util.DeferredCall":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Main",{extend:qx.core.Object,type:"singleton",include:[cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.IActionHandler,cv.ui.manager.control.IFileEventHandler],construct:function(){var e=this;qx.core.Object.constructor.call(this);iconfont.material.Load;cv.ui.manager.model.BackupFolder.getInstance();this._checkEnvironment();this.initOpenFiles(new qx.data.Array);this.__P_23_0=cv.ui.manager.control.ActionDispatcher.getInstance();this.__P_23_0.setMain(this);this.__P_23_1();this._draw();qx.event.message.Bus.subscribe("cv.manager.*",this._onManagerEvent,this);qx.ui.tooltip.Manager.getInstance();window.addEventListener("beforeunload",function(t){e._onBeforeUnload(t)})},statics:{ROOT:null},properties:{openFiles:{check:"qx.data.Array",deferredInit:!0},writeableFolder:{check:"Boolean",init:!1,event:"changeWriteableFolder"},currentFolder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentFolder",event:"changeCurrentFolder"},currentSelection:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentSelection",event:"changeCurrentSelection"},deleteableSelection:{check:"Boolean",init:!1,event:"changeDeleteableSelection"},renameableSelection:{check:"Boolean",init:!1,event:"changeRenameableSelection"},visible:{check:"Boolean",init:!0,event:"changeVisible",apply:"_applyVisible"}},members:{__P_23_2:null,__P_23_3:null,_pane:null,_tree:null,_stack:null,_oldCommandGroup:null,_managerCommands:null,_mainContent:null,_openFilesController:null,_hiddenConfigFakeFile:null,__P_23_0:null,_applyVisible:function(e){var t=qx.core.Init.getApplication().getCommandManager();if(e){t.setActive(this._managerCommands);qx.bom.element.Style.set(this.__P_23_4(),"display","block")}else{t.setActive(this._oldCommandGroup);qx.bom.element.Style.set(this.__P_23_4(),"display","none")}},_checkEnvironment:function(){cv.io.rest.Client.getFsClient().checkEnvironmentSync(function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):t&&t.forEach(function(e){var t=!1;switch(e.entity){case".":if(0==(1&e.state))cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder does not exists"));else if(0==(2&e.state)){cv.ui.manager.model.FileItem.ROOT.setReadable(!1);t=!0;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not readable"))}else if(0==(4&e.state)){cv.ui.manager.model.FileItem.ROOT.setWriteable(!1);t=!0;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not writeable"))}if(t){var i=this.__P_23_0.getFocusedWidget();this.__P_23_0.resetFocusedWidget();this.__P_23_0.setFocusedWidget(i)}break;case"backup":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("backup folder is not writeable"));break;case"media":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("media folder is not writeable"));break;case"hidden.php":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Hidden configuration file (hidden.php) not writeable"))}},this)},this)},canHandleAction:function(e){if("delete"===e&&this.getCurrentSelection()&&!this.getCurrentSelection().isWriteable())return!1;var t=["close","quit","about"];if(this.getCurrentFolder().isWriteable()){t.push("new-file");t.push("new-folder");t.push("delete");t.push("upload");t.push("clone")}cv.ui.manager.model.FileItem.ROOT.isWriteable()&&t.push("new-config-file");return t.includes(e)},_doClose:function(){if(document.querySelector("#main.loading")){var e=new cv.util.ConfigLoader,t=qx.core.Init.getApplication();e.load(t.bootstrap,t)}this.setVisible(!1)},handleAction:function(e,t){var i;switch(e){case"close":t?this.closeFile(t):this.closeCurrentFile();break;case"quit":if((i=this.getOpenFiles().filter(function(e){return e.getFile().isModified()})).length>0){var n=new qxl.dialog.Confirm({message:qx.locale.Manager.tr("You have files opened with unsaved changes, you should save them now."),callback:function(e){e&&i.forEach(function(e){e.save()});n.dispose();this._doClose()},context:this,caption:qx.locale.Manager.tr("Unsaved changes"),yesButtonLabel:qx.locale.Manager.tr("Save & quit"),noButtonLabel:qx.locale.Manager.tr("Quit without saving"),useBlocker:!0});n.show()}else this._doClose();break;case"new-file":this._onCreate("file",null,t);break;case"new-config-file":cv.io.rest.Client.getFsClient().readSync({path:"demo/templates/visu_config.xml"},function(e,t){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load config template")):this._onCreate("config",t,cv.ui.manager.model.FileItem.ROOT)},this);break;case"clone":cv.io.rest.Client.getFsClient().readSync({path:t.file.getFullPath()},function(e,i){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load file content")):t.file.isConfigFile()?this._onCreate("config",i,cv.ui.manager.model.FileItem.ROOT):this._onCreate("file",i)},this);break;case"new-folder":this._onCreate("dir",null,t);break;case"delete":this._onDelete(t);break;case"upload":break;case"about":this._showAbout();break;default:this.warn(e+" handling is not implemented yet!")}},_onBeforeUnload:function(e){if(this.getOpenFiles().filter(function(e){return e.getFile().isModified()}).length>0){e.preventDefault();e.returnValue=""}else delete e.returnValue},configureButton:function(e){},unConfigureButton:function(e){},_handleFileEvent:function(e){var t=e.getData();if("deleted"===t.action){this.getOpenFiles().copy().some(function(e){e.getFile().isRelated(t.path)&&this.closeFile(e);return!1},this);this.getCurrentFolder()&&this.getCurrentFolder().getFullPath()===t.path&&this.resetCurrentFolder()}else this.warn("unhandled file event",t.action);this._tree.refresh()},__P_23_5:function(e){var t=null,i=null;cv.ui.manager.model.FileItem.ROOT.getChildren().some(function(n){if("demo"===n.getName())i=n;else if(n.getName()===e){t=n;return!0}return!1});if(!t&&i){e.startsWith("demo/")&&(e=e.substr(5));i.getChildren().some(function(i){if(i.getName()===e){t=i;return!0}return!1})}return t},_onManagerEvent:function(e){var t=e.getData();switch(e.getName()){case"cv.manager.compareFiles":this.openFile(t,!1);break;case"cv.manager.openWith":"string"==typeof t.file&&(t.file=this.__P_23_5(t.file));this.openFile(t.file||this.getCurrentSelection(),!1,t.handler,null,t.handlerOptions);break;case"cv.manager.open":"string"==typeof t&&(t=this.__P_23_5(t));this.openFile(t||this.getCurrentSelection(),!1)}},_onChangeTreeSelection:function(e){var t=e.getData();(cv.ui.manager.model.Preferences.getInstance().isQuickPreview()&&"tap"===t.mode||"dbltap"===t.mode)&&this.__P_23_6(t.node,t.mode);var i=t.node;if(i){"file"===t.node.getType()?this.setCurrentFolder(t.node.getParent()):this.setCurrentFolder(i);this.setCurrentSelection(i)}else{this.resetCurrentFolder();this.resetCurrentSelection()}},__P_23_6:function(e,t){e&&("file"===e.getType()?this.openFile(e,"tap"===t):"dbltap"===t&&e.setEditing(!0))},_applyCurrentFolder:function(e,t){t&&t.removeRelatedBindings(this);e?e.bind("writeable",this,"writeableFolder"):this.resetWriteableFolder()},_applyCurrentSelection:function(e,t){t&&t.removeRelatedBindings(this);if(e){e.bind("writeable",this,"deleteableSelection");e.bind("inTrash",this,"renameableSelection",{converter:function(e){return!e}})}else this.resetDeleteableSelection()},_onChangeFileSelection:function(){var e=this._openFilesController.getSelection();if(e.length>0){var t,i=e.getItem(0),n=i.getFile(),a=i.getHandlerId();(t=a?cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(a):cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(n)).instance||(t.instance=new t.Clazz);t.instance.isReady()?t.instance.setFile(n):t.instance.addListenerOnce("changeReady",function(){t.instance.setFile(n)},this);this._stack.indexOf(t.instance)<0&&this._stack.add(t.instance);t.instance instanceof cv.ui.manager.editor.AbstractEditor&&t.instance.setHandlerOptions(i.getHandlerOptions());this._stack.setSelection([t.instance]);this.__P_23_0.setFocusedWidget(t.instance);cv.ui.manager.core.GlobalState.getInstance().setOpenedFocusedFile(n)}else cv.ui.manager.core.GlobalState.getInstance().resetOpenedFocusedFile()},openFile:function(e,t,i,n,a){var r,o,s=this.getOpenFiles();if(i){(o=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(i)).instance||(o.instance=new o.Clazz);if(o.instance.isExternal()){o.instance.setFile(e);return}}else{if(!(o=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,n))){cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr('Cannot open file: "%1"',e.getName()));return}i=o.Clazz.classname}var l=s.some(function(t){if(t.getFile()===e&&i===t.getHandlerId()){r=t;return!0}return!1});r||(r=new cv.ui.manager.model.OpenFile(e,i));a?r.setHandlerOptions(a):r.resetHandlerOptions();if(!0===t){if(!r.isPermanent()){if(null!==this.__P_23_2&&s.getItem(this.__P_23_2)&&!s.getItem(this.__P_23_2).isPermanent())s.setItem(this.__P_23_2,r);else{this.__P_23_2=s.length;s.push(r)}r.setPermanent(!1)}}else{l||null!==this.__P_23_2&&s.indexOf(r)===this.__P_23_2||s.push(r);r.setPermanent(!0);this.__P_23_2=null}this._openFilesController.getTarget().setModelSelection([r])},checkUnsavedChanged:function(e){var t=this;if(e instanceof cv.ui.manager.model.FileItem){if(!this.getOpenFiles().some(function(t){if(t.getFile().getFullPath()===e.getFullPath()){e=t;return!0}return!1}))return!1}var i=e.getFile();if(i.isModified()){var n=qx.locale.Manager.tr("This file has unsaved changes that will be lost when you close it without saving.");i.isTemporary()&&(n=qx.locale.Manager.tr("This file has not been saved on the backend yet. It will be lost when you close it without saving."));var a=new qxl.dialog.Confirm({message:n,callback:function(n){if(!0===n){e.save();t.closeFile(e,!0)}else if(!1===n){i.resetModified();i.isTemporary()&&qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:i.getFullPath()});t.closeFile(e,!0)}a.dispose()},context:this,caption:qx.locale.Manager.tr("Unsaved changes"),yesButtonLabel:qx.locale.Manager.tr("Save & close"),noButtonLabel:qx.locale.Manager.tr("Discard & close"),noButtonIcon:"qxl.dialog.icon.delete",useBlocker:!0,allowCancel:!0});a.show();return!0}return!1},closeFile:function(e,t){if(e instanceof cv.ui.manager.model.FileItem){if(!this.getOpenFiles().some(function(t){if(t.getFile().getFullPath()===e.getFullPath()){e=t;return!0}return!1}))return}if(e&&e.isCloseable()){var i=e.getFile();if(t||!this.checkUnsavedChanged(e)){e instanceof cv.ui.manager.model.OpenFile&&e.resetPermanent();var n=this._openFilesController.getSelection(),a=-1,r=this.getOpenFiles();n.length>0&&n.getItem(0)===e&&(a=r.indexOf(e));r.remove(e);var o=this._stack.getSelection()[0];!qx.Class.hasInterface(o.constructor,cv.ui.manager.editor.IEditor)||o instanceof cv.ui.manager.Start||o.resetFile();if(0===this.getOpenFiles().length){this._stack.resetSelection();this.__P_23_0.resetFocusedWidget();this.__P_23_2=null}a>0?this._openFilesController.getSelection().replace(r.getItem(a-1)):0===a&&r.length>0&&this._openFilesController.getSelection().replace(r.getItem(0));if(i instanceof cv.ui.manager.model.CompareFiles){var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(i);s.instance.clear();if(0===r.filter(function(e){return e.getFile()instanceof cv.ui.manager.model.CompareFiles}).length){s.instance.destroy();s.instance=null}}else if(window.monaco&&"cv.ui.manager.editor.Source"===e.getHandlerId()){var l=window.monaco.editor.getModel(i.getUri());l&&l.dispose()}}}},closeCurrentFile:function(){var e=this._openFilesController.getSelection().length>0?this._openFilesController.getSelection().getItem(0):null;e&&this.closeFile(e)},_onCloseFile:function(e){this.closeFile(e.getData())},__P_23_4:function(){if(!this.__P_23_3){this.__P_23_3=qx.dom.Element.create("div",{id:"manager",style:"position: absolute; top: 0; left: 0; right: 0; bottom: 0;"});qx.dom.Element.insertEnd(this.__P_23_3,document.body);qx.theme.manager.Meta.getInstance().setTheme(cv.theme.Dark)}return this.__P_23_3},__P_23_1:function(){var e=this._managerCommands=new qx.ui.command.Group;e.add("save",new qx.ui.command.Command("Ctrl+S"));e.add("save-as",new qx.ui.command.Command("Ctrl+Shift+S"));e.add("new-file",new qx.ui.command.Command("Ctrl+N"));e.add("new-folder",new qx.ui.command.Command("Ctrl+Shift+N"));e.add("quit",new qx.ui.command.Command("Ctrl+Q"));var t=new qx.ui.command.Command("F2");e.add("rename",t);this.bind("renameableSelection",t,"enabled");e.add("undo",new qx.ui.command.Command("Ctrl+Z"));e.add("redo",new qx.ui.command.Command("Ctrl+Y"));e.add("cut",new qx.ui.command.Command("Ctrl+X"));e.add("copy",new qx.ui.command.Command("Ctrl+C"));e.add("paste",new qx.ui.command.Command("Ctrl+V"));e.add("help",new qx.ui.command.Command("F1"));var i=qx.core.Init.getApplication().getCommandManager();this._oldCommandGroup=i.getActive();i.add(e);i.setActive(e)},_onDelete:function(e){var t=e||this.getCurrentSelection();t&&cv.ui.manager.control.FileController.getInstance().delete(t)},_onChangeStackSelection:function(e){var t=[];e.getData().forEach(function(e){var i=this.getOpenFiles().toArray().find(function(t){return t.getFile()===e.getFile()&&t.getHandlerId()===e.classname});i&&t.push(i)},this);this._openFilesController.getSelection().replace(t)},__P_23_7:function(e,t,i,n,a){var r=new cv.ui.manager.dialog.Prompt({message:e,callback:t||null,context:i||null,value:n||null,caption:a||"",filter:/[\w\d_\-\.\s]/});r.show();return r},_onCreate:function(e,t,i){var n=i||this.getCurrentFolder();if(n){var a,r;if("config"===e){a=qx.locale.Manager.tr('Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)');r=qx.locale.Manager.tr("A configuration with this name already exists.")}else if("file"===e){a=qx.locale.Manager.tr("Please enter the file name.");r=qx.locale.Manager.tr("A file with this name already exists.")}else{a=qx.locale.Manager.tr("Please enter the folder name.");r=qx.locale.Manager.tr("A folder with this name already exists.")}this.__P_23_7(a,function i(o){if(o){var s=o;if("config"===e){var l=/visu[_-]config[_-]([\w\d_-]+)(\.xml)?/.exec(o);l&&(o=l[1]);s="visu_config_"+o+".xml"}if(n.getChildren().some(function(t){return t.getName()===s&&t.getType()===e},this)){cv.ui.manager.snackbar.Controller.error(r);this.__P_23_7(a,i,this,o)}else{var c=new cv.ui.manager.model.FileItem(s,n.getFullPath(),n);c.set({type:"config"===e?"file":e,readable:!0,writeable:!0,loaded:!0,modified:!0,temporary:!0,parentFolder:n.getFullPath(),content:t||""});"dir"===e&&cv.io.rest.Client.getFsClient().createSync({path:c.getFullPath(),type:e},null,function(e){if(e)cv.ui.manager.snackbar.Controller.error(e);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("Folder has been created"));c.set({modified:!1,temporary:!1});qx.event.message.Bus.dispatchByName(c.getBusTopic(),{type:"created",file:c,data:"",source:this})}},this);n.addChild(c);n.sortElements();this._tree.refresh();this._tree.setSelection(c);"dir"!==e&&this.openFile(c,!1,null,"edit")}}},this)}},__P_23_8:function(e){for(;e&&1===e.nodeType;){if("on"===e.getAttribute("qxDroppable"))return e;e=e.parentNode}return null},_draw:function(){var e=this.__P_23_4(),t=new qx.ui.root.Inline(e,!0,!0);this.bind("visible",t,"visibility",{converter:function(e){return e?"visible":"excluded"}});t.addListenerOnce("appear",function(){var e=t.getContentElement().getDomElement();e.addEventListener("drop",function(e){this.__P_23_8(e.target)||e.preventDefault()}.bind(this));e.addEventListener("dragover",function(e){this.__P_23_8(e.target)||e.preventDefault()}.bind(this))},this);qx.core.Init.getApplication().setRoot(t);t.setLayout(new qx.ui.layout.Canvas);var i=cv.ui.manager.snackbar.Controller.getInstance();t.add(i,{bottom:10,left:200});function n(){var e=t.getBounds();i.setLayoutProperties({bottom:10,left:Math.round(e.width/2)-150});i.setMaxHeight(e.height-40)}t.addListener("resize",n,this);t.addListener("appear",n,this);window.addEventListener("resize",function(){e.style.height=window.innerHeight+"px"});var a=new qx.ui.container.Composite(new qx.ui.layout.Dock);t.add(a,{edge:0});var r=cv.ui.manager.MenuBar.getInstance();a.add(r,{edge:"north"});var o=r.getButton("upload"),s=new cv.ui.manager.upload.UploadMgr(o);this.bind("currentFolder",s,"folder");this._pane=new qx.ui.splitpane.Pane;a.add(this._pane,{edge:"center"});var l=cv.ui.manager.model.FileItem.ROOT=new cv.ui.manager.model.FileItem("."),c=cv.ui.manager.model.FileItem.getIconFile();l.set({overrideIcon:!0,writeable:!0,readable:!0,open:!0,fakeChildren:[c],icon:cv.theme.dark.Images.getIcon("home",18)});this.setCurrentFolder(l);this._tree=new cv.ui.manager.tree.FileSystem(l);this._tree.addListener("changeSelection",this._onChangeTreeSelection,this);var d=new qx.ui.container.Composite(new qx.ui.layout.VBox),u=new cv.ui.manager.ToolBar(s);this.bind("currentFolder",u,"folder");this.bind("currentSelection",u,"file");u.addListener("reload",this._tree.reload,this._tree);var h=r.getButtonConfiguration();this.bind("writeableFolder",h["new-file"].args[2],"enabled");this.bind("writeableFolder",h["new-folder"].args[2],"enabled");d.add(u);d.add(this._tree,{flex:1});this._pane.add(d,0);cv.ui.manager.model.Preferences.getInstance().bind("expertMode",d,"visibility",{converter:function(e){return e?"visible":"excluded"}});this._mainContent=new qx.ui.container.Composite(new qx.ui.layout.VBox);var g=new qx.ui.form.List(!0);g.setAppearance("open-files-tabs");this._openFilesController=new qx.data.controller.List(this.getOpenFiles(),g,"file.name");this._openFilesController.setDelegate({createItem:function(){var e=new cv.ui.manager.form.FileTabItem;e.addListener("close",this._onCloseFile,this);return e}.bind(this),bindItem:function(e,t,i){e.bindDefaultProperties(t,i);e.bindProperty("file.permanent","permanent",null,t,i);e.bindProperty("file.modified","modified",null,t,i);e.bindProperty("icon","icon",null,t,i);e.bindProperty("closeable","closeable",null,t,i)}});g.addListener("changeSelection",this._onChangeFileSelection,this);this._mainContent.add(g);this._stack=new qx.ui.container.Stack;this._stack.addListener("changeSelection",this._onChangeStackSelection,this);this._mainContent.add(this._stack,{flex:1});this._pane.add(this._mainContent,1);var m=new cv.ui.manager.model.OpenFile(l,"cv.ui.manager.Start");m.setCloseable(!1);this.getOpenFiles().push(m);g.setModelSelection([m])},_showAbout:function(){var e={caption:qx.locale.Manager.tr("About"),modal:!0,minWidth:Math.min(500,qx.bom.Viewport.getWidth()),maxHeight:qx.bom.Viewport.getHeight(),message:'\n<div class="about-cv">\n <img src="resource/icons/comet_icon_128x128_ff8000.png" width="128" height="128"/>\n <h2>CometVisu '.concat(cv.Version.VERSION,'</h2>\n <div class="info">\n   <label for="date">').concat(qx.locale.Manager.tr("Build date"),': </label><span id="date">').concat(cv.Version.DATE,'</span><br/>\n   <label for="build">').concat(qx.locale.Manager.tr("Build revision"),': </label><span id="build">').concat(cv.Version.REV,'</span><br/>\n   <label for="lib-version">').concat(qx.locale.Manager.tr("Library version"),': </label><span id="lib-version">').concat(cv.Version.LIBRARY_VERSION,"</span>\n </div>\n</div>")};new cv.ui.manager.dialog.BigAlert(e).show()}},destruct:function(){this._disposeObjects("_pane","_tree","_stack","_mainContent","_openFilesController");var e=qx.core.Init.getApplication();e.getCommandManager().setActive(this._oldCommandGroup);this._oldCommandGroup=null;new qx.util.DeferredCall(function(){e.resetRoot()}).schedule();document.body.removeChild(this.__P_23_3);this.__P_23_3=null;this.__P_23_0=null;qx.event.message.Bus.unsubscribe("cv.manager.*",this._onManagerEvent,this);delete cv.ui.manager.Main.$$instance}});cv.ui.manager.Main.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Alert":{require:!0},"qx.ui.basic.Image":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.BigAlert",{extend:qxl.dialog.Alert,members:{_hbox:null,_applyImage:function(e,t){if(!this._image){this._image=(new qx.ui.basic.Image).set({scale:!0,height:32,width:32});this._hbox.addAt(this._image,0)}this._image.setSource(e);this._image.setVisibility(e?"visible":"excluded")},_createWidgetContent:function(){var e=this._createDialogContainer();this.add(e);var t=this._hbox=new qx.ui.container.Composite(new qx.ui.layout.HBox(10)),i=new qx.ui.container.Scroll(t);i.setMaxHeight(qx.bom.Document.getHeight()-132);qx.core.Init.getApplication().getRoot().addListener("resize",function(){i.setMaxHeight(qx.bom.Document.getHeight()-132)},this);e.add(i);t.bind("width",i,"width");t.bind("height",i,"height");var n=this.getImage();if(n){this._image=new qx.ui.basic.Image(n).set({scale:!0,height:32,width:32});t.add(this._image)}this._message=new qx.ui.basic.Label;this._message.setRich(!0);this._message.setWidth(200);this._message.setAllowStretchX(!0);t.addAt(this._message,1,{flex:1});var a=this._createButtonPane(),r=this._createOkButton();a.add(r);e.add(a)}},destruct:function(){this._disposeObjects("_hbox")}});cv.ui.manager.dialog.BigAlert.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.model.config.Option":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Section",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.setName(e);this.initOptions(new qx.data.Array)},properties:{name:{check:"String",event:"changeName",init:""},options:{check:"qx.data.Array",deferredInit:!0,event:"changeOptions"}},members:{addOption:function(e,t){var i=this.getOptions();i.some(function(i){if(i.getKey()===e){i.setValue(t);return!0}return!1},this)||i.push(new cv.ui.manager.model.config.Option(e,t))}}});cv.ui.manager.model.config.Section.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.Grid":{construct:!0},"cv.ui.manager.model.config.Option":{},"qx.ui.basic.Label":{},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.OptionListItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.SectionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);var e=new qx.ui.layout.Grid(8,8);e.setColumnFlex(1,1);e.setColumnAlign(0,"left","top");this._setLayout(e);this._createChildControl("section-title");this._createChildControl("list");this._createChildControl("delete")},properties:{appearance:{refine:!0,init:"cv-editor-config-section"},model:{check:"cv.ui.manager.model.config.Section",nullable:!1,apply:"_applyModel"},modified:{check:"Boolean",init:!1,event:"changeModified"},readOnly:{check:"Boolean",init:!1,event:"changeReadOnly"}},events:{delete:"qx.event.type.Data"},members:{_listController:null,_originalName:null,_originalOptions:null,_applyModel:function(e,t){var i=this.getChildControl("name");this.__P_39_0(t);if(e){e.bind("name",i,"value");this._originalName=e.getName();this._originalOptions={};e.getOptions().forEach(function(e){e.addListener("change",this.__P_39_1,this);this._originalOptions[e.getKey()]=e.getValue()},this);i.bind("value",e,"name");e.addListener("changeName",this.__P_39_1,this);e.bind("options",this._listController,"model");if(0===e.getOptions().length){var n=new cv.ui.manager.model.config.Option("","");e.getOptions().push(n)}}else{this._originalName=null;this._originalOptions=null}},__P_39_0:function(e){if(e){var t=this.getChildControl("name");this._listController&&e.removeRelatedBindings(this._listController);e.removeListener("changeName",this.__P_39_1,this);e.removeRelatedBindings(t);t.removeRelatedBindings(e);e.getOptions().forEach(function(e){e.removeListener("change",this.__P_39_1,this)},this)}},__P_39_1:function(){if(this._originalName===this.getModel().getName())if(Object.keys(this._originalOptions).length===this.getModel().getOptions().length){var e=this.getModel().getOptions().some(function(e){return!Object.prototype.hasOwnProperty.call(this._originalOptions,e.getKey())||this._originalOptions[e.getKey()]!==e.getValue()},this);this.setModified(e)}else this.setModified(!0);else this.setModified(!0)},_onDeleteOption:function(e){var t=e.getData();if(1===this.getModel().getOptions().length){t.resetKey();t.resetValue()}else{var i=this.getModel().getOptions().remove(t);i&&i.removeListener("change",this.__P_39_1,this)}this.__P_39_1()},_onAddOption:function(){var e=new cv.ui.manager.model.config.Option("","");e.addListener("change",this.__P_39_1,this);this.getModel().getOptions().push(e);this.__P_39_1()},_createChildControlImpl:function(e){var t;switch(e){case"section-title":t=new qx.ui.basic.Label(this.tr("Section"));this._add(t,{row:0,column:0});break;case"name":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this.bind("readOnly",t,"readOnly");this._add(t,{row:0,column:1});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete section"));t.addListener("execute",function(){this.fireDataEvent("delete",this.getModel())},this);this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t,{row:0,column:2});break;case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(null,t);this._listController.setNullValueTitle("header");this._listController.setAllowNull(!0);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.OptionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteOption,this);e.addListener("add",this._onAddOption,this);this.bind("readOnly",e,"readOnly")}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i)}});this._add(t,{row:1,column:1})}return t||cv.ui.manager.form.SectionListItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_listController")}});cv.ui.manager.form.SectionListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menubar.MenuBar":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.ui.core.Spacer":{},"qx.ui.form.RadioGroup":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"qx.ui.menu.RadioButton":{},"qx.ui.menu.CheckBox":{},"cv.ui.manager.model.Preferences":{},"qx.ui.menu.Button":{},"qx.lang.Type":{},"qx.event.message.Bus":{},"qx.ui.menu.Separator":{},"qx.ui.basic.Label":{},"qx.ui.menubar.Button":{},"qx.ui.menu.Menu":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.MenuBar",{extend:qx.ui.menubar.MenuBar,type:"singleton",construct:function(){qx.ui.menubar.MenuBar.constructor.call(this);this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this.__P_24_0={};this._draw()},members:{_commandGroup:null,__P_24_0:null,__P_24_1:null,__P_24_2:null,_draw:function(){this._createChildControl("file");this._createChildControl("edit");this._createChildControl("preferences");this.add(new qx.ui.core.Spacer,{flex:1});this._createChildControl("title");this.add(new qx.ui.core.Spacer,{flex:1});this._createChildControl("help");var e=new qx.ui.form.RadioGroup;this.__P_24_1={"new-file":{menu:"new-menu",args:[this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18),this._commandGroup.get("new-file")],enabled:!0},"new-folder":{menu:"new-menu",args:[this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18),this._commandGroup.get("new-folder")],enabled:!0,separator:"after"},"new-config-file":{menu:"new-menu",args:[this.tr("New config file")],enabled:!0},upload:{menu:"file-menu",clazz:com.zenesis.qx.upload.UploadMenuButton,args:[this.tr("Upload file"),cv.theme.dark.Images.getIcon("upload",18)],enabled:!0,separator:"before"},save:{menu:"file-menu",args:[this.tr("Save"),cv.theme.dark.Images.getIcon("save",18),this._commandGroup.get("save")],enabled:!1,separator:"before"},"save-as":{menu:"file-menu",args:[this.tr("Save as..."),null,this._commandGroup.get("save-as")],enabled:!1},delete:{args:[this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18),this._commandGroup.get("delete")],enabled:!1,hidden:!0},quit:{menu:"file-menu",args:[this.tr("Quit"),cv.theme.dark.Images.getIcon("quit",18),this._commandGroup.get("quit")],enabled:!0,separator:"before"},undo:{menu:"edit-menu",args:[this.tr("Undo"),cv.theme.dark.Images.getIcon("undo",18),this._commandGroup.get("undo")],enabled:!0},redo:{menu:"edit-menu",args:[this.tr("Redo"),cv.theme.dark.Images.getIcon("redo",18),this._commandGroup.get("redo")],enabled:!0},cut:{menu:"edit-menu",args:[this.tr("Cut"),cv.theme.dark.Images.getIcon("cut",18),this._commandGroup.get("cut")],enabled:!1,separator:"before"},copy:{menu:"edit-menu",args:[this.tr("Copy"),cv.theme.dark.Images.getIcon("copy",18),this._commandGroup.get("copy")],enabled:!1},paste:{menu:"edit-menu",args:[this.tr("Paste"),cv.theme.dark.Images.getIcon("paste",18),this._commandGroup.get("paste")],enabled:!1},"source-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use text editor")],general:!0,enabled:!0,properties:{model:"source",group:e}},"xml-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use xml editor")],general:!0,enabled:!0,properties:{model:"xml",group:e}},"quick-preview":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Enable quick preview")],general:!0,enabled:!0,separator:"before"},"expert-mode":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Expert mode")],general:!0,enabled:!0},help:{menu:"help-menu",args:[this.tr("Help"),cv.theme.dark.Images.getIcon("help",18),this._commandGroup.get("help")],enabled:!1},about:{menu:"help-menu",args:[this.tr("About")],enabled:!1}};this.maintainButtons();var t=cv.ui.manager.model.Preferences.getInstance();t.bind("defaultConfigEditor",e,"modelSelection",{converter:function(e){return[e]}});e.getModelSelection().addListener("change",function(){t.setDefaultConfigEditor(e.getModelSelection().getItem(0))},this);this.__P_24_3("quick-preview","quickPreview");this.__P_24_3("expert-mode","expertMode")},__P_24_3:function(e,t){var i=this.getButton(e),n=cv.ui.manager.model.Preferences.getInstance();n.bind(t,i,"value");i.bind("value",n,t)},maintainButtons:function(e){if(e){e=Object.merge(this.__P_24_1,e);this.__P_24_2=e}else e=this.__P_24_1;Object.keys(e).forEach(function(t){var i,n=e[t];if(Object.prototype.hasOwnProperty.call(this.__P_24_0,t))i=this.__P_24_0[t];else{var a=n.args[0],r=n.args[1],o=n.args[2],s=n.clazz||qx.ui.menu.Button;if(qx.lang.Type.isString(o)||!o){i=new s(a,r);o&&i.getChildControl("shortcut").setValue(o)}else(i=new s(a,r,o)).bind("enabled",o,"enabled");i.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action."+t)},this);if(!n.hidden){var l=this.getChildControl(n.menu);if(!l)throw new Error("no menu named "+n.menu+" found!");"before"===n.separator&&l.add(new qx.ui.menu.Separator);l.add(i);"after"===n.separator&&l.add(new qx.ui.menu.Separator)}this.__P_24_0[t]=i;Object.prototype.hasOwnProperty.call(n,"onAfterCreate")&&n.onAfterCreate(i)}i.setEnabled(n.enabled);n.properties&&i.set(n.properties)},this)},getButton:function(e){return this.__P_24_0[e]},getButtonConfiguration:function(){return this.__P_24_2||this.__P_24_1},_createChildControlImpl:function(e){var t;switch(e){case"title":t=new qx.ui.basic.Label(this.tr("CometVisu Manager"));this.add(t);break;case"file":t=new qx.ui.menubar.Button(this.tr("File"),null,this.getChildControl("file-menu"));this.add(t);break;case"edit":t=new qx.ui.menubar.Button(this.tr("Edit"),null,this.getChildControl("edit-menu"));this.add(t);break;case"help":t=new qx.ui.menubar.Button(this.tr("Help"),null,this.getChildControl("help-menu"));this.add(t);break;case"about":t=new qx.ui.menubar.Button(this.tr("About"),null,this.getChildControl("help-menu"));this.add(t);break;case"new":t=new qx.ui.menu.Button(this.tr("New"),null,null,this.getChildControl("new-menu"));break;case"preferences":t=new qx.ui.menubar.Button(this.tr("Preferences"),null,this.getChildControl("preferences-menu"));this.add(t);break;case"new-menu":t=new qx.ui.menu.Menu;break;case"file-menu":(t=new qx.ui.menu.Menu).add(this.getChildControl("new"));break;case"edit-menu":case"preferences-menu":case"help-menu":t=new qx.ui.menu.Menu}return t||cv.ui.manager.MenuBar.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._commandGroup=null}});cv.ui.manager.MenuBar.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.util.ResourceManager":{},"cv.svg.Element":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.SvgIcon",{extend:qx.ui.core.Widget,construct:function(e){qx.ui.core.Widget.constructor.call(this);e&&this.setName(e)},properties:{name:{check:"String",nullable:!0,apply:"_applyName"},appearance:{refine:!0,init:"cv-svg-icon"}},members:{__P_53_0:null,__P_53_1:null,_applyName:function(e){if(e){this.__P_53_0||(this.__P_53_0=qx.util.ResourceManager.getInstance().toUri("icons/knx-uf-iconset.svg"));if(!this.__P_53_1.getDomElement()){this.__P_53_1.addListenerOnce("appear",function(){this._applyName(e)},this);return}this.__P_53_1.getDomElement().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.__P_53_0+"#kuf-"+e)}else this.__P_53_1.removeAttribute("xlink:href")},_createContentElement:function(){var e=new cv.svg.Element("svg");this.__P_53_1=new cv.svg.Element("use");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");e.add(this.__P_53_1);return e}},destruct:function(){this.__P_53_1=null}});cv.ui.manager.viewer.SvgIcon.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",usage:"dynamic",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.util.ResourceManager":{},"qx.util.AliasManager":{},"qx.theme.manager.Color":{},"qx.html.Image":{},"qx.io.ImageLoader":{},"qx.lang.String":{},"qx.bom.client.Css":{require:!0},"qx.html.Element":{},"qx.html.Label":{},"qx.bom.client.Engine":{require:!0},"qx.bom.client.Browser":{require:!0},"qx.bom.element.Decoration":{},"qx.lang.Type":{},"qx.bom.AnimationFrame":{},"qx.theme.manager.Font":{},"qx.lang.Object":{},"qx.theme.manager.Decoration":{},"qx.ui.core.queue.Layout":{}},environment:{provided:[],required:{"css.alphaimageloaderneeded":{className:"qx.bom.client.Css"},"engine.name":{className:"qx.bom.client.Engine",load:!0},"engine.version":{className:"qx.bom.client.Engine"},"browser.documentmode":{className:"qx.bom.client.Browser"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.basic.Image",{extend:qx.ui.core.Widget,construct:function(e){this.__P_27_0={};qx.ui.core.Widget.constructor.call(this);e&&this.setSource(e)},properties:{source:{check:"String",init:null,nullable:!0,event:"changeSource",apply:"_applySource",themeable:!0,transform:"_transformSource"},scale:{check:"Boolean",init:!1,event:"changeScale",themeable:!0,apply:"_applyScale"},forceScale:{check:"Boolean",init:!1},forceRatio:{init:"auto",check:["disabled","height","width","auto"],apply:"_applyDimension"},allowScaleUp:{init:!1,check:"Boolean",apply:"_applyDimension"},appearance:{refine:!0,init:"image"},allowShrinkX:{refine:!0,init:!1},allowShrinkY:{refine:!0,init:!1},allowGrowX:{refine:!0,init:!1},allowGrowY:{refine:!0,init:!1}},events:{loadingFailed:"qx.event.type.Event",loaded:"qx.event.type.Event",aborted:"qx.event.type.Event"},statics:{PLACEHOLDER_IMAGE:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},members:{__P_27_1:null,__P_27_2:null,__P_27_3:null,__P_27_0:null,__P_27_4:null,__P_27_5:null,__P_27_6:0,_transformSource:function(e){if(e&&e.startsWith("resource/")){if(qx.util.ResourceManager.getInstance().has(e.substring("resource/".length)))return e.substring("resource/".length)}return e},_onChangeTheme:function(){cv.ui.manager.basic.Image.prototype._onChangeTheme.base.call(this);this._styleSource()},getContentElement:function(){return this.__P_27_7()},_createContentElement:function(){return this.__P_27_7()},_getContentHint:function(){return{width:this.__P_27_1||0,height:this.__P_27_2||0}},_applyDecorator:function(e,t){cv.ui.manager.basic.Image.prototype._applyDecorator.base.call(this,e,t);var i=this.getSource();i=qx.util.AliasManager.getInstance().resolve(i);var n=this.getContentElement();this.__P_27_5&&(n=n.getChild(0));this.__P_27_8(n,i)},_applyTextColor:function(e){if("font"===this.__P_27_9()){var t=this.getContentElement();this.__P_27_5&&(t=t.getChild(0));e?t.setStyle("color",qx.theme.manager.Color.getInstance().resolve(e)):t.removeStyle("color")}},_applyPadding:function(e,t,i){cv.ui.manager.basic.Image.prototype._applyPadding.base.call(this,e,t,i);var n=this.getContentElement();this.__P_27_5?n.getChild(0).setStyles({top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0}):"font"===this.__P_27_9()?n.setStyles({top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0}):n instanceof qx.html.Image&&n.setPadding(this.getPaddingLeft()||0,this.getPaddingTop()||0)},renderLayout:function(e,t,i,n){cv.ui.manager.basic.Image.prototype.renderLayout.base.call(this,e,t,i,n);var a=this.getContentElement();this.__P_27_5&&a.getChild(0).setStyles({width:i-(this.getPaddingLeft()||0)-(this.getPaddingRight()||0),height:n-(this.getPaddingTop()||0)-(this.getPaddingBottom()||0),top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0})},_applyEnabled:function(e,t){cv.ui.manager.basic.Image.prototype._applyEnabled.base.call(this,e,t);this.getSource()&&this._styleSource()},_applySource:function(e,t){t&&qx.io.ImageLoader.isLoading(t)&&qx.io.ImageLoader.abort(t);this._styleSource()},_applyScale:function(e){this._styleSource()},__P_27_10:function(e){this.__P_27_3=e},__P_27_9:function(){if(null===this.__P_27_3){var e=this.getSource();if(e&&qx.lang.String.startsWith(e,"@"))this.__P_27_3="font";else if(e&&e.startsWith("<svg"))this.__P_27_3="svg";else{var t=!1;null!==e&&(t=e.endsWith(".png"));this.getScale()&&t&&qx.core.Environment.get("css.alphaimageloaderneeded")?this.__P_27_3="alphaScaled":this.getScale()||this.getForceScale()?this.__P_27_3="scaled":this.__P_27_3="nonScaled"}}return this.__P_27_3},__P_27_11:function(e){var t,i,n=qx.html.Image;switch(e){case"svg":n=qx.html.Element;i="div";break;case"font":n=qx.html.Label;t=!0;i="div";break;case"alphaScaled":t=!0;i="div";break;case"nonScaled":t=!1;i="div";break;default:t=!0;i="img"}var a=new n(i);a.connectWidget(this);a.setStyles({overflowX:"hidden",overflowY:"hidden",boxSizing:"border-box"});if("font"===e)a.setRich(!0);else if("svg"!==e){a.setScale(t);if(qx.core.Environment.get("css.alphaimageloaderneeded")){var r=this.__P_27_5=new qx.html.Element("div");a.connectWidget(this);r.setStyle("position","absolute");r.add(a);return r}}return a},__P_27_7:function(){if(this.$$disposed)return null;var e=this.__P_27_9();this.__P_27_0[e]||(this.__P_27_0[e]=this.__P_27_11(e));var t=this.__P_27_0[e];this.__P_27_4||(this.__P_27_4=t);return t},_styleSource:function(){var e=qx.util.AliasManager.getInstance(),t=qx.util.ResourceManager.getInstance(),i=e.resolve(this.getSource()),n=this.getContentElement();this.__P_27_5&&(n=n.getChild(0));if(i){this.__P_27_13(i);if("mshtml"==qx.core.Environment.get("engine.name")&&(parseInt(qx.core.Environment.get("engine.version"),10)<9||qx.core.Environment.get("browser.documentmode")<9)){var a=this.getScale()?"scale":"no-repeat";n.tagNameHint=qx.bom.element.Decoration.getTagName(a,i)}var r=this.__P_27_14();if(t.isFontUri(i)){this.__P_27_15(r,i);var o=this.getTextColor();qx.lang.Type.isString(o)&&this._applyTextColor(o,null)}else if(i&&i.startsWith("<svg"))this.__P_27_15(r,i);else if(t.has(i)){var s=t.findHighResolutionSource(i);if(s){var l=t.getImageWidth(i),c=t.getImageHeight(i);this.setWidth(l);this.setHeight(c);var d=l+"px, "+c+"px";this.__P_27_4.setStyle("background-size",d);this.setSource(s);i=s}this.__P_27_15(r,i);this.__P_27_16()}else if(qx.io.ImageLoader.isLoaded(i)){this.__P_27_17(r,i);this.__P_27_16()}else this.__P_27_18(r,i)}else this.__P_27_12(n)},__P_27_16:function(){this.__P_27_6++;qx.bom.AnimationFrame.request(function(e){e===this.__P_27_6?this.fireEvent("loaded"):this.fireEvent("aborted")}.bind(this,this.__P_27_6))},__P_27_14:function(){var e=this.__P_27_4;this.__P_27_5&&(e=e.getChild(0));return e},__P_27_13:qx.core.Environment.select("engine.name",{mshtml:function(e){var t=qx.core.Environment.get("css.alphaimageloaderneeded"),i=e.endsWith(".png"),n=e.startsWith("@"),a=e.startsWith("<svg"),r=this.getScale()||this.getForceScale();n?this.__P_27_10("font"):a?this.__P_27_10("svg"):t&&i?r&&"alphaScaled"!==this.__P_27_9()?this.__P_27_10("alphaScaled"):r||"nonScaled"===this.__P_27_9()||this.__P_27_10("nonScaled"):r&&"scaled"!==this.__P_27_9()?this.__P_27_10("scaled"):r||"nonScaled"===this.__P_27_9()||this.__P_27_10("nonScaled");this.__P_27_19(this.__P_27_7())},default:function(e){var t=e&&qx.lang.String.startsWith(e,"@"),i=e.startsWith("<svg"),n=this.getScale()||this.getForceScale();t?this.__P_27_10("font"):i?this.__P_27_10("svg"):n&&"scaled"!==this.__P_27_9()?this.__P_27_10("scaled"):n||"nonScaled"===this.__P_27_9()||this.__P_27_10("nonScaled");this.__P_27_19(this.__P_27_7())}}),__P_27_19:function(e){var t=this.__P_27_4;if(t!==e&&null!==t){var i={},n=t.getAllStyles();if(n)for(var a in n)i[a]=n[a];"font"!==this.__P_27_9()&&"svg"!==this.__P_27_9()||delete i.backgroundImage;var r=this.getBounds();if(null!==r){i.width=r.width+"px";i.height=r.height+"px"}var o=this.getInsets();i.left=parseInt(t.getStyle("left")||o.left)+"px";i.top=parseInt(t.getStyle("top")||o.top)+"px";i.zIndex=10;var s=this.__P_27_5?e.getChild(0):e;s.setStyles(i,!0);s.setSelectable(this.getSelectable());t.isVisible()?e.isVisible()||e.show():e.hide();t.isIncluded()?e.isIncluded()||e.include():e.exclude();var l=t.getParent();if(l){var c=l.getChildren().indexOf(t);l.removeAt(c);l.addAt(e,c)}var d=s.getNodeName();s.setSource?s.setSource(null):s.setValue?s.setValue(""):s.removeAll();var u=this.__P_27_14();s.tagNameHint=d;s.setAttribute("class",u.getAttribute("class"));qx.html.Element.flush();var h=u.getDomElement(),g=e.getDomElement();(t.getListeners()||[]).forEach(function(t){e.addListener(t.type,t.handler,t.self,t.capture)});if(h&&g){var m=h.$$hash;h.$$hash=g.$$hash;g.$$hash=m}this.__P_27_4=e}},__P_27_15:function(e,t){var i=qx.util.ResourceManager.getInstance(),n=i.isFontUri(t),a=t.startsWith("<svg");if(!this.getEnabled()){var r=t.replace(/\.([a-z]+)$/,"-disabled.$1");if(!n&&i.has(r)){t=r;this.addState("replacement")}else this.removeState("replacement")}if(n||a||e.getSource()!==t)if(n){this.getScale()&&parseInt(t.split("/")[2],10)&&this.setScale(!1);var o,s;if(this.getScale()){var l=this.getSizeHint();o=this.getWidth()||l.width;s=this.getHeight()||l.height}else{var c=qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]),d=parseInt(t.split("/")[2]||c.getSize(),10);o=i.getImageWidth(t)||d;s=i.getImageHeight(t)||d}this.__P_27_20(o,s);this.__P_27_8(e,t)}else if(a){this.__P_27_8(e,t);this.__P_27_20(40,40)}else{this.__P_27_8(e,t);this.__P_27_20(i.getImageWidth(t),i.getImageHeight(t))}},_applyDimension:function(){cv.ui.manager.basic.Image.prototype._applyDimension.base.call(this);if(this.getSource()&&qx.lang.String.startsWith(this.getSource(),"@")){var e=this.getContentElement();if(e)if(this.getScale()){var t=this.getSizeHint(),i=this.getWidth()||t.width||40,n=this.getHeight()||t.height||40;e.setStyle("fontSize",(i>n?n:i)+"px")}else{var a=qx.theme.manager.Font.getInstance().resolve(this.getSource().match(/@([^/]+)/)[1]);e.setStyle("fontSize",a.getSize()+"px")}}else this.__P_27_20()},__P_27_17:function(e,t){var i=qx.io.ImageLoader;this.__P_27_8(e,t);var n=i.getWidth(t),a=i.getHeight(t);this.__P_27_20(n,a)},__P_27_18:function(e,t){var i=qx.io.ImageLoader;i.isFailed(t)?this.__P_27_12(e):i.load(t,this.__P_27_21,this)},__P_27_12:function(e){null!==e&&(e instanceof qx.html.Image?e.resetSource():e instanceof qx.html.Label?e.resetValue():e.removeAll())},__P_27_8:function(e,t){var i=t&&qx.lang.String.startsWith(t,"@");if(t&&qx.lang.String.startsWith(t,"<svg")){var n=new qx.html.Element("svg");n.useMarkup(t);e.removeAll();e.add(n)}else{if(i){var a=t.split("/"),r=t;a.length>2&&(r=a[0]+"/"+a[1]);var o=qx.util.ResourceManager.getInstance(),s=qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]),l=qx.lang.Object.clone(s.getStyles());delete l.color;e.setStyles(l);e.setStyle("font");e.setStyle("display","table-cell");e.setStyle("verticalAlign","middle");e.setStyle("textAlign","center");if(this.getScale())e.setStyle("fontSize",(this.__P_27_1>this.__P_27_2?this.__P_27_2:this.__P_27_1)+"px");else{var c=parseInt(a[2]||qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]).getSize());e.setStyle("fontSize",c+"px")}var d=o.getData(r);if(d)e.setValue(String.fromCharCode(d[2]));else{var u=parseInt(qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)\/(.*)$/)[2]),16);e.setValue(String.fromCharCode(u))}return}if("div"===e.getNodeName()){var h=qx.theme.manager.Decoration.getInstance().resolve(this.getDecorator());if(h){var g=h.getStartColor()&&h.getEndColor(),m=h.getBackgroundImage();if(g||m){var f=this.getScale()?"scale":"no-repeat",p=qx.bom.element.Decoration.getAttributes(t,f),_=h.getStyles(!0),v={backgroundImage:p.style.backgroundImage,backgroundPosition:p.style.backgroundPosition||"0 0",backgroundRepeat:p.style.backgroundRepeat||"no-repeat"};if(m){v.backgroundPosition+=","+_["background-position"]||"0 0";v.backgroundRepeat+=", "+h.getBackgroundRepeat()}if(g){v.backgroundPosition+=", 0 0";v.backgroundRepeat+=", no-repeat"}v.backgroundImage+=","+(_["background-image"]||_.background);e.setStyles(v);return}}else e.setSource&&e.setSource(null)}}e.setSource&&e.setSource(t)},__P_27_21:function(e,t){if(!0!==this.$$disposed)if(e===qx.util.AliasManager.getInstance().resolve(this.getSource())){if(t.failed){this.warn("Image could not be loaded: "+e);this.fireEvent("loadingFailed")}else{if(t.aborted){this.fireEvent("aborted");return}this.fireEvent("loaded")}this.__P_27_17(this.__P_27_14(),e)}else this.fireEvent("aborted")},__P_27_20:function(e,t){void 0===e&&(e=this.__P_27_1);void 0===t&&(t=this.__P_27_2);this._recalc(e,t)&&qx.ui.core.queue.Layout.add(this)},_recalc:function(e,t){var i=this.getMaxWidth(),n=this.getMaxHeight(),a=this.getMinWidth(),r=this.getMinHeight(),o=e,s=t,l=t/e;switch(this.getForceRatio()){case"height":null!==n&&s>n?o=(s=n)/l:s<r&&(o=(s=r)/l);s<n&&this.isAllowScaleUp()&&(o=(s=n)/l);break;case"width":null!==i&&o>i?s=(o=i)*l:o<a&&(s=(o=a)*l);o<i&&this.isAllowScaleUp()&&(s=(o=i)*l);break;case"auto":case"bestfit":null!==i&&o>i?s=(o=i)*l:o<a&&(s=(o=a)*l);o<i&&this.isAllowScaleUp()&&(s=(o=i)*l);null!==n&&s>n&&(o=(s=n)/l)}o=Math.round(o);s=Math.round(s);if(o!=this.__P_27_1||s!=this.__P_27_2){this.__P_27_1=o;this.__P_27_2=s;return!0}return!1}},destruct:function(){for(var e in this.__P_27_0)Object.prototype.hasOwnProperty.call(this.__P_27_0,e)&&this.__P_27_0[e].disconnectWidget(this);delete this.__P_27_4;this.__P_27_5&&delete this.__P_27_5;this._disposeMap("__P_27_0")}});cv.ui.manager.basic.Image.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IStringForm":{require:!0},"qx.ui.form.IForm":{require:!0},"qx.ui.form.MForm":{require:!0},"cv.ui.manager.editor.Source":{},"qx.ui.core.queue.Layout":{},"qx.ui.core.queue.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.SourceCodeField",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IStringForm,qx.ui.form.IForm],include:[qx.ui.form.MForm],construct:function(e,t){qx.ui.core.Widget.constructor.call(this);this._init();t&&this.setType(t);e&&this.setValue(e)},events:{changeValue:"qx.event.type.Data"},properties:{type:{check:"String",init:"xml",apply:"_applyType"},focusable:{refine:!0,init:!0},autoSize:{check:"Boolean",init:!1,apply:"_autoSize"}},members:{_editor:null,__P_40_0:null,__P_40_1:null,_hasBeenEdited:!1,_applyType:function(e){if(e&&this.__P_40_0){this.setValue(this.__P_40_0);this.__P_40_0=null}},_autoSize:function(){if(this._editor&&this.isAutoSize()){var e=19*(this._editor.getModel().getLineCount()+1);this._setAreaHeight(e)}},setValue:function(e){this._hasBeenEdited||(this._editor&&this.getType()?this._editor.setValue(e):this.__P_40_0=e);this._autoSize()},resetValue:function(){this._editor&&this._editor.setValue("")},getValue:function(){return this._editor?this._editor.getValue():this.__P_40_0?this.__P_40_0:""},_init:function(){var e=this;if(window.monaco){var t=this.getContentElement().getDomElement();if(t){this._editor=window.monaco.editor.create(t,{suggestOnTriggerCharacters:!0,folding:!0,autoIndent:!0,automaticLayout:!0,dragAndDrop:!0,formatOnPaste:!0,formatOnType:!0,renderValidationDecorations:"on",minimap:{enabled:!1},theme:"vs-dark"});if(this.getType()){var i=this._editor.getModel(),n=monaco.Uri.parse("cv://SourceCode."+this.getType()),a=window.monaco.editor.getModel(n);a?a.setValue(this.__P_40_0):a=window.monaco.editor.createModel(this.__P_40_0,this.getType(),n);if(i!==a){a.updateOptions({tabSize:2,indentSize:2,insertSpaces:!0});this._editor.setModel(a)}}this.__P_40_0&&(this.__P_40_0=null);this._editor.onDidChangeModelContent(this._onContentChange.bind(this))}else this.addListenerOnce("appear",function(){e._init()},this)}else cv.ui.manager.editor.Source.load(this._init,this)},_onContentChange:function(){this._hasBeenEdited=!0;this.fireDataEvent("changeValue",this._editor.getValue());this._autoSize()},getFocusElement:function(){var e=this.getContentElement();return e||null},_setAreaHeight:function(e){if(this.__P_40_1!==e){this.__P_40_1=e;qx.ui.core.queue.Layout.add(this);qx.ui.core.queue.Manager.flush();this._editor&&this._editor.layout()}},_getContentHint:function(){var e=cv.ui.manager.form.SourceCodeField.prototype._getContentHint.base.call(this);this.isAutoSize()&&(e.height=this.__P_40_1||e.height);return e}},destruct:function(){this._hasBeenEdited=!1;if(this._editor){this._editor.dispose();this._editor=null}}});cv.ui.manager.form.SourceCodeField.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.Option",{extend:qx.core.Object,construct:function(e,t,i,n){qx.core.Object.constructor.call(this);e&&this.setLabel(e);t&&this.setIcon(t);i&&this.setValue(i);n&&this.setHints(n)},properties:{type:{check:["default","group","state","error"],init:"default",event:"changeType"},label:{check:"String",event:"changeLabel"},icon:{event:"changeIcon",nullable:!0},value:{check:"String",event:"changeValue",nullable:!0},hints:{check:"Object",nullable:!0}}});cv.ui.manager.form.Option.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.ListItem":{require:!0},"cv.ui.manager.basic.Image":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.ListItem",{extend:qx.ui.form.ListItem,members:{_createChildControlImpl:function(e,t){var i;switch(e){case"icon":(i=new cv.ui.manager.basic.Image(this.getIcon())).set({anonymous:!0,scale:!0,maxHeight:64});this._addAt(i,0);null!==this.getIcon()&&"label"!==this.getShow()||i.exclude()}return i||cv.ui.manager.form.ListItem.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.form.ListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.VirtualSelectBox":{require:!0},"cv.ui.manager.form.ListItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.VirtualSelectBox",{extend:qx.ui.form.VirtualSelectBox,members:{_createChildControlImpl:function(e,t){var i;switch(e){case"atom":(i=new cv.ui.manager.form.ListItem("")).setCenter(!1);i.setAnonymous(!0);this._add(i,{flex:1})}return i||cv.ui.manager.form.VirtualSelectBox.prototype._createChildControlImpl.base.call(this,e,t)}}});cv.ui.manager.form.VirtualSelectBox.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.CheckBox":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.CheckBox",{extend:qx.ui.form.CheckBox,members:{_onExecute:function(e){this.isTriState()?!0===this.getValue()?this.setValue(!1):!1===this.getValue()?this.setValue(null):this.setValue(!0):this.toggleValue()},_applyValue:function(e,t){cv.ui.manager.form.CheckBox.prototype._applyValue.base.call(this,e,t);null===e?this.setLabel(" - "+this.tr("not set")+" - "):this.setLabel("")}}});cv.ui.manager.form.CheckBox.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.FormRenderer":{require:!0},"qx.ui.form.RadioGroup":{},"qx.ui.basic.Label":{},"qx.ui.menu.Separator":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.ElementFormRenderer",{extend:qxl.dialog.FormRenderer,members:{addItems:function(e,t,i){if(null!==i){this._add(this._createHeader(i),{row:this._row,column:0,colSpan:2});this._row++}for(var n=0;n<e.length;n++){var a=e[n],r=void 0,o=void 0;r=a instanceof qx.ui.form.RadioGroup?"horizontal"===a.getUserData("orientation")?this._createHBoxForRadioGroup(a):this._createWidgetForRadioGroup(a):a;if(t[n]&&a.getUserData("excluded")){(o=new qx.ui.basic.Label(t[n])).setRich(!0);this._add(o,{row:this._row,column:0,colSpan:2})}else if(t[n]){(o=this._createLabel(t[n],a)).setRich(!0);this._add(o,{row:this._row,column:0});this._add(r,{row:this._row,column:1})}else this._add(r,{row:this._row,column:0,colSpan:2});this._row++;if(a.getUserData("help")){(o=new qx.ui.basic.Label(a.getUserData("help"))).setRich(!0);o.setAppearance("helptext");this._add(o,{row:this._row,column:1});this._row++}this._add(new qx.ui.menu.Separator,{row:this._row,column:0,colSpan:2});this._row++;0===n&&r.focus()}}}});cv.ui.manager.form.ElementFormRenderer.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.DocumentationMapping",{type:"static",statics:{MAP:{_base:"https://www.cometvisu.org/CometVisu/",address:"/0.13/manual/#address",audio:"/0.13/manual/#audio",bashrc:"/0.13/manual/#bashrc",break:"/0.13/manual/#break",clock:"/0.13/manual/#clock",colorchooser:"/0.13/manual/#colorchooser","custom-css":"/0.13/manual/#custom-css","custom-cssrules":"/0.13/manual/#custom-cssrules","custom-plugins":"/0.13/manual/#custom-plugins",customizing:"/0.13/manual/#customizing","cv-installation-in-terminal":"/0.13/manual/#cv-installation-in-terminal",designtoggle:"/0.13/manual/#designtoggle",diagram:"/0.13/manual/#diagram","diagram-influx":"/0.13/manual/#diagram-influx","diagram-info":"/0.13/manual/#diagram-info",docker:"/0.13/manual/#docker","docker-openhab-installation":"/0.13/manual/#docker-openhab-installation",dockerenvironment:"/0.13/manual/#dockerenvironment",editor:"/0.13/manual/#editor",enablecache:"/0.13/manual/#enablecache",flavour:"/0.13/manual/#flavour",format:"/0.13/manual/#format",gauge:"/0.13/manual/#gauge",group:"/0.13/manual/#group","hidden-config":"/0.13/manual/#hidden-config",image:"/0.13/manual/#image",imagetrigger:"/0.13/manual/#imagetrigger",include:"/0.13/manual/#include",info:"/0.13/manual/#info",infoaction:"/0.13/manual/#infoaction",infotrigger:"/0.13/manual/#infotrigger","install-no-pakets":"/0.13/manual/#install-no-pakets",layout:"/0.13/manual/#layout",line:"/0.13/manual/#line",link:"/0.13/manual/#link",log:"/0.13/manual/#log","long-polling":"/0.13/manual/#long-polling",manager:"/0.13/manual/#manager",mapping:"/0.13/manual/#mapping",multitrigger:"/0.13/manual/#multitrigger",navbar:"/0.13/manual/#navbar","nodered-installation-in-terminal":"/0.13/manual/#nodered-installation-in-terminal",notificationcenterbadge:"/0.13/manual/#notificationcenterbadge",notifications:"/0.13/manual/#notifications","openhab-plugin":"/0.13/manual/#openhab-plugin",openweathermap:"/0.13/manual/#openweathermap",page:"/0.13/manual/#page",pagejump:"/0.13/manual/#pagejump",powerspectrum:"/0.13/manual/#powerspectrum",pushbutton:"/0.13/manual/#pushbutton",refresh:"/0.13/manual/#refresh",reload:"/0.13/manual/#reload",reporterrors:"/0.13/manual/#reporterrors",reporting:"/0.13/manual/#reporting",rgb:"/0.13/manual/#rgb",roundbar:"/0.13/manual/#roundbar","rpi-tutorial-cometvisu-in-docker":"/0.13/manual/#rpi-tutorial-cometvisu-in-docker","rrd-introduction":"/0.13/manual/#rrd-introduction","size-attributes":"/0.13/manual/#size-attributes",slide:"/0.13/manual/#slide",speech:"/0.13/manual/#speech",sse:"/0.13/manual/#sse",strftime:"/0.13/manual/#strftime",styling:"/0.13/manual/#styling",switch:"/0.13/manual/#switch","system-voraussetzungen":"/0.13/manual/#system-voraussetzungen",text:"/0.13/manual/#text",timberwolf:"/0.13/manual/#timberwolf","timberwolf-portainer":"/0.13/manual/#timberwolf-portainer",timeout:"/0.13/manual/#timeout",toggle:"/0.13/manual/#toggle",tr064:"/0.13/manual/#tr064",trigger:"/0.13/manual/#trigger",tutorials:"/0.13/manual/#tutorials",urltrigger:"/0.13/manual/#urltrigger",video:"/0.13/manual/#video","visu-config-details":"/0.13/manual/#visu-config-details",web:"/0.13/manual/#web","wgplugin-info":"/0.13/manual/#wgplugin-info",widgets:"/0.13/manual/#widgets",worker:"/0.13/manual/#worker","xml-format":"/0.13/manual/#xml-format","xml-format-files":"/0.13/manual/#xml-format-files","xml-format-header":"/0.13/manual/#xml-format-header","xml-format-icons":"/0.13/manual/#xml-format-icons","xml-format-mappings":"/0.13/manual/#xml-format-mappings","xml-format-pages":"/0.13/manual/#xml-format-pages","xml-format-plugins":"/0.13/manual/#xml-format-plugins","xml-format-statusbar":"/0.13/manual/#xml-format-statusbar","xml-format-stylings":"/0.13/manual/#xml-format-stylings","xml-format-templates":"/0.13/manual/#xml-format-templates"}}});cv.ui.manager.model.schema.DocumentationMapping.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.SimpleType",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.__P_48_0=[];this.__P_48_1=[];this.__P_48_2={};this.__P_48_3=[];this.parse()},properties:{type:{refine:!0,init:"simpleType"},optional:{check:"Boolean",init:!1},baseType:{check:"String",nullable:!0}},members:{__P_48_1:null,__P_48_0:null,__P_48_3:null,__P_48_2:null,parse:function(){var e=this.getNode();this.setOptional("required"===e.getAttribute("use"));this.__P_48_4(e)},__P_48_4:function(e){var t=this,i=this.getSchema();if(e.hasAttribute("ref")){var n=e.getAttribute("ref");if(!(e=i.getReferencedNode("attribute",n)))throw new Error("schema/xsd appears to be invalid, can not find element "+n)}if(e.hasAttribute("type")){var a=e.getAttribute("type");if(a.match(/^xsd:/))this.setBaseType(a);else{var r=i.getReferencedNode("simpleType",a);this.__P_48_4(r)}this.setOptional("required"!==e.getAttribute("use"))}else{Array.from(e.querySelectorAll(":scope > restriction, :scope > extension, :scope > simpleType > restriction, :scope > simpleType > extension")).forEach(function(e){var n=e.getAttribute("base");if(n.match(/^xsd:/))t.setBaseType(n);else{var a=i.getReferencedNode("simpleType",n);t.__P_48_4(a)}Array.from(e.querySelectorAll(":scope > pattern")).forEach(function(e){t.__P_48_1.push(e.getAttribute("value"))});Array.from(e.querySelectorAll(":scope > enumeration")).forEach(function(e){t.__P_48_0.push(e.getAttribute("value"))})});this.getBaseType()||this.setBaseType("xsd:anyType");this.__P_48_3.push(this.getBaseType())}},isValueValid:function(e){var t=this,i=this.getBaseType(),n=this.getSchema();if(!i)throw new Error("something is wrong, do not have a baseType for type");if(""===e)return this.isOptional();if(-1===i.search(/^xsd:/)){var a=n.getTypeNode("simple",i);return new cv.ui.manager.model.schema.SimpleType(a,n).isValueValid(e)}switch(i){case"xsd:string":case"xsd:anyURI":case"xsd:anyType":if("string"!=typeof e)return!1;break;case"xsd:decimal":if(!e.match(/^[-+]?[0-9]*(\.[0-9]+)?$/))return!1;break;case"xsd:unsignedByte":case"xsd:nonNegativeInteger":if(!e.match(/^[+]?[0-9]+$/))return!1;break;case"xsd:integer":if(!e.match(/^[-+]?[0-9]+$/))return!1;break;case"xsd:float":if(!e.match(/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/))return!1;break;case"xsd:boolean":if(!e.match(/^(true|false|0|1)$/))return!1;break;default:throw new Error("not implemented baseType "+i)}if(this.__P_48_0.length>0&&!this.__P_48_0.includes(e))return!1;if(this.__P_48_1.length>0){var r=!0;this.__P_48_1.forEach(function(i){if(!Object.prototype.hasOwnProperty.call(t.__P_48_2,i)){for(var n=[],a=0,o=i.indexOf("|",a);o<i.length&&!(o<0);){for(var s=!0,l=o;l>=a&&"]"!==i[l];l--)"["===i[l]&&(s=!1);s&&n.push([a,o-a]);a=o+1;o=i.indexOf("|",a);if(n.length>100){t.error("too many branchIndices");break}}i.length>a&&n.push([a,i.length-a]);var c=n.map(function(e){return"^".concat(i.substr(e[0],e[1]).replace(/\\([\s\S])|(\$)/g,"\\$1$2"),"$")});t.__P_48_2[i]=t.regexFromString(c.join("|"))}!1===t.__P_48_2[i].test(e)&&(r=!1)},this);if(!1===r)return!1}return!0},getEnumeration:function(){return"xsd:boolean"===this.getBaseType()?["true","false"]:this.__P_48_0}},destruct:function(){this.__P_48_2=null}});cv.ui.manager.model.schema.SimpleType.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.model.schema.Sequence":{},"cv.ui.manager.model.schema.Group":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Choice",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"choice"}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Choice.prototype.parse.base.call(this);var t=this.getNode(),i=this.getSchema();Array.from(t.querySelectorAll(":scope > element")).forEach(function(t){var n=new cv.ui.manager.model.schema.Element(t,i);n.setSortable(!0);e._allowedElements[n.getName()]=n});this._allowedElements["#comment"]=this.getSchema().getCommentNodeSchemaElement();Array.from(t.querySelectorAll(":scope > choice")).forEach(function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Choice(t,i))});Array.from(t.querySelectorAll(":scope > sequence")).forEach(function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Sequence(t,i))});Array.from(t.querySelectorAll(":scope > group")).forEach(function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Group(t,i))})},getRequiredElements:function(){return[]},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var i="(";t&&(i+="?:");for(var n=[],a=0,r=Object.values(this._allowedElements);a<r.length;a++){var o=r[a];n.push(o.getRegex(e,t))}this._subGroupings.forEach(function(i){n.push(i.getRegex(e,t))});i+=n.join("|");i+=")";i+="{";var s=this.getBounds();i+=void 0===s.min?1:s.min;i+=",";s.max!==Number.POSITIVE_INFINITY&&(i+=void 0===s.max?1:s.max);i+="}";this._regexCache=i;return i},getBoundsForElementName:function(e){if(!0===this.isElementAllowed(e))return this.getBounds()},getAllowedElementsSorting:function(e){var t={};Object.keys(this._allowedElements).forEach(function(i){var n=this._allowedElements[i],a="x";void 0!==e&&(a=e+"."+a);if("element"===n.getType())t[n.getName()]=a;else{var r=n.getAllowedElementsSorting(a);Object.assign(t,r)}},this);this._subGroupings.forEach(function(i,n){var a="x";void 0!==e&&(a=e+"."+a);if("element"===i.getType())t[i.getName()]=a;else{var r=i.getAllowedElementsSorting(a);Object.assign(t,r)}},this);return t}}});cv.ui.manager.model.schema.Choice.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Group":{},"cv.ui.manager.model.schema.Any":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Sequence",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"sequence"},elementsHaveOrder:{refine:!0,init:!0}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Sequence.prototype.parse.base.call(this);var t=this.getSchema();Array.from(this.getNode().children).forEach(function(i){var n;switch(i.nodeName){case"xsd:element":case"element":(n=new cv.ui.manager.model.schema.Element(i,t)).setSortable(!1);e._allowedElements[n.getName()]=n;break;case"xsd:choice":case"choice":n=new cv.ui.manager.model.schema.Choice(i,t);e._subGroupings.push(n);break;case"xsd:sequence":case"sequence":n=new cv.ui.manager.model.schema.Sequence(i,t);e._subGroupings.push(n);break;case"xsd:group":case"group":n=new cv.ui.manager.model.schema.Group(i,t);e._subGroupings.push(n);break;case"xsd:any":case"any":n=new cv.ui.manager.model.schema.Any(i,t);e._subGroupings.push(n)}e._sortedContent.push(n)});this._allowedElements["#comment"]=this.getSchema().getCommentNodeSchemaElement()},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var i="(";t&&(i+="?:");var n=[];this._sortedContent.forEach(function(i){n.push(i.getRegex(e,t))});i+=n.join("");i+=")";i+="{";var a=this.getBounds();i+=void 0===a.min?1:a.min;i+=",";a.max!==Number.POSITIVE_INFINITY&&(i+=void 0===a.max?1:a.max);i+="}";this._regexCache=i;return i},getBoundsForElementName:function(e){if(void 0!==this._allowedElements[e]){var t=this._allowedElements[e].getBounds(),i=this.getBounds(),n={min:1,max:1};Object.prototype.hasOwnProperty.call(t,"min")&&(n.min=t.min);Object.prototype.hasOwnProperty.call(i,"min")&&!isNaN(i.min)&&(n.min*=i.min);if(t.max===Number.POSITIVE_INFINITY||i.max===Number.POSITIVE_INFINITY)n.max=Number.POSITIVE_INFINITY;else{Object.prototype.hasOwnProperty.call(t,"max")&&(n.max=t.max);Object.prototype.hasOwnProperty.call(i,"max")&&!isNaN(i.max)&&(n.max*=i.max)}return n}for(var a,r,o=0;o<this._subGroupings.length;++o)if(void 0!==(r=this._subGroupings[o].getBoundsForElementName(e))){a=r;break}return a},getAllowedElementsSorting:function(e){var t={};this._sortedContent.forEach(function(i,n){var a=n;void 0!==e&&(a=e+"."+n);if("element"===i.getType())t[i.getName()]=a;else{var r=i.getAllowedElementsSorting(a);Object.assign(t,r)}});return t}}});cv.ui.manager.model.schema.Sequence.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Group",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"group"}},members:{parse:function(){cv.ui.manager.model.schema.Group.prototype.parse.base.call(this);var e=this.getSchema(),t=this.getNode();t.hasAttribute("ref")&&(t=e.getReferencedNode("group",t.getAttribute("ref")));var i=t.querySelector(":scope > choice");i?this._subGroupings.push(new cv.ui.manager.model.schema.Choice(i,e)):(i=t.querySelector(":scope > sequence"))&&this._subGroupings.push(new cv.ui.manager.model.schema.Sequence(i,e))},getAllowedElements:function(){return this._subGroupings[0].getAllowedElements()},getAllowedElementsSorting:function(e){var t={},i=this.getAllowedElements();Object.keys(i).forEach(function(n){var a=i[n],r="x";void 0!==e&&(r=e+"."+r);if("element"===a.getType())t[a.getName()]=r;else{var o=a.getAllowedElementsSorting(r);Object.assign(t,o)}},this);return t},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var i="(";this._subGroupings.forEach(function(n){i="(";t&&(i+="?:");i+=n.getRegex(e,t)+")"});i+="{";var n=this.getBounds();i+=void 0===n.min?1:n.min;i+=",";n.max!==Number.POSITIVE_INFINITY&&(i+=void 0===n.max?1:n.max);i+="}";this._regexCache=i;return i},getBoundsForElementName:function(e){return this._subGroupings[0].getBoundsForElementName(e)}}});cv.ui.manager.model.schema.Group.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Any",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"any"}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Any.prototype.parse.base.call(this);var t=this.getSchema(),i=this.getNode();i.hasAttribute("ref")&&(i=t.getReferencedNode("group",i.getAttribute("ref")));i.querySelectorAll(":scope > choice").forEach(function(i){e._subGroupings.push(new cv.ui.manager.model.schema.Choice(i,t))});i.querySelectorAll(":scope > sequence").forEach(function(i){e._subGroupings.push(new cv.ui.manager.model.schema.Sequence(i,t))});this._subGroupings.length>0&&(this._subGroupings=[this._subGroupings[0]])},isElementAllowed:function(e){return!0},getSchemaElementForElementName:function(e){},getRequiredElements:function(){return[]},getAllowedElements:function(){return{}},getRegex:function(e,t){return".*"},hasMultiLevelBounds:function(){return!0},getBoundsForElementName:function(e){return this._bounds}}});cv.ui.manager.model.schema.Any.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.MAnnotation":{require:!0},"cv.ui.manager.model.schema.SimpleType":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Attribute",{extend:cv.ui.manager.model.schema.Base,include:cv.ui.manager.model.schema.MAnnotation,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},statics:{getAttributeName:function(e,t){if(e.hasAttribute("name"))return e.getAttribute("name");if(e.hasAttribute("ref")){var i=e.getAttribute("ref"),n=t.getReferencedNode("attribute",i);if(!n)throw new Error("schema/xsd appears to be invalid, can not find element "+i);return n.getAttribute("name")}return"unknown"}},properties:{type:{refine:!0,init:"attribute"},name:{check:"String",init:""},optional:{check:"Boolean",init:!1},defaultValue:{check:"String",nullable:!0}},members:{_type:null,parse:function(){var e=this.getNode(),t=this.getSchema();this._type=new cv.ui.manager.model.schema.SimpleType(e,t);this.setName(cv.ui.manager.model.schema.Attribute.getAttributeName(e,t));e.hasAttribute("default")&&this.setDefaultValue(e.getAttribute("default"));this.setOptional("required"!==e.getAttribute("use"))},isValueValid:function(e){return""===(e=null===e||void 0===e?"":""+e)?this.isOptional():this._type.isValueValid(e)},getTypeString:function(){var e=this._type.getBaseType();return e.match(/xsd\:/)?e.replace(/xsd\:/,""):this.tr("complex type, please see documentation")},getEnumeration:function(){return this._type.getEnumeration()}},destruct:function(){this.__P_45_0=null;this.__P_45_1=null}});cv.ui.manager.model.schema.Attribute.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.MenuBar":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.ActionDispatcher",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)},properties:{focusedWidget:{check:"cv.ui.manager.IActionHandler",nullable:!0,apply:"_applyFocusedWidget"},main:{check:"cv.ui.manager.Main",nullable:!0}},members:{updateBarButtons:function(){var e,t=this.getFocusedWidget(),i=cv.ui.manager.MenuBar.getInstance(),n=i.getButtonConfiguration();Object.keys(n).forEach(function(a){if(e=i.getButton(a)){e.setEnabled(n[a].general||this.hasHandler(a));t&&t.configureButton(a,e)}},this)},_applyFocusedWidget:function(e,t){if(t){var i,n=cv.ui.manager.MenuBar.getInstance(),a=n.getButtonConfiguration();Object.keys(a).forEach(function(e){(i=n.getButton(e))&&t.unConfigureButton(e,i)},this)}this.updateBarButtons()},hasHandler:function(e){return!!this._getHandler(e)},_getHandler:function(e){var t=this.getFocusedWidget(),i=this.getMain();return t&&t.canHandleAction(e)?t:i&&i.canHandleAction(e)?i:null},_onAction:function(e){var t=e.getName().split(".").pop(),i=this._getHandler(t);i?i.handleAction(t,e.getData()):this.warn("no action handler found for action: "+t)}},destruct:function(){qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)}});cv.ui.manager.control.ActionDispatcher.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"cv.ui.manager.control.ActionDispatcher":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.GlobalState",{extend:qx.core.Object,type:"singleton",properties:{openedFocusedFile:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeOpenedFocusedFile",apply:"_applyFile"}},members:{_applyFile:function(){cv.ui.manager.control.ActionDispatcher.getInstance().updateBarButtons()}}});cv.ui.manager.core.GlobalState.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.control.FileHandlerRegistry":{},"qx.Interface":{},"cv.ui.manager.editor.IEditor":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.OpenFile",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);e&&this.setFile(e);t&&this.setHandlerId(t)},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeFile",apply:"_applyFile"},handlerId:{check:"!!qx.Class.getByName(value)",nullable:!0,apply:"_maintainIcon"},handlerOptions:{check:"Map",nullable:!0},permanent:{check:"Boolean",init:!1,event:"changePermanent"},icon:{check:"String",init:"",event:"changeIcon"},closeable:{check:"Boolean",init:!0,event:"changeCloseable"}},members:{__P_42_0:null,_applyFile:function(e,t){if(t){t.removeListener("changeModified",this._maintainPermanent,this);t.removeRelatedBindings(this);this.__P_42_0=null}e&&e.addListener("changeModified",this._maintainPermanent,this);this._maintainIcon()},_maintainIcon:function(){var e=this.getFile();if(this.getHandlerId()&&e){var t=qx.Class.getByName(this.getHandlerId());if(t&&t.ICON){this.setIcon(t.ICON);if(this.__P_42_0){e.removeBinding(this.__P_42_0);this.__P_42_0=null}}else this.__P_42_0=e.bind("icon",this,"icon")}else this.resetIcon()},_maintainPermanent:function(){this.getFile().isModified()&&!this.isPermanent()&&this.setPermanent(!0)},save:function(e,t){var i,n=this.getFile(),a=this.getHandlerId();i=a?cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(a):cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(n);n.isModified()&&i&&i.instance&&qx.Interface.objectImplements(i.instance,cv.ui.manager.editor.IEditor)&&i.instance.save(e,t)}}});cv.ui.manager.model.OpenFile.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileTabItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox);this._createChildControl("icon");this._createChildControl("label");this._createChildControl("close");this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this)},events:{close:"qx.event.type.Data",action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"open-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0},label:{check:"String",nullable:!0,transform:"_transformFilename",event:"changeLabel",apply:"_applyLabel"},icon:{check:"String",nullable:!0,apply:"_applyIcon"},permanent:{check:"Boolean",init:!1,apply:"_applyPermanent"},modified:{check:"Boolean",init:!1,apply:"_applyLabel"},closeable:{check:"Boolean",init:!0,apply:"_applyCloseable"},writeable:{check:"Boolean",init:!0,apply:"_applyLabel"}},members:{_forwardStates:{focused:!0,hovered:!0,selected:!0,dragover:!0},_onPointerOver:function(){this.addState("hovered")},_transformFilename:function(e){return"."===e?"":e},_onPointerOut:function(){this.removeState("hovered")},_applyPermanent:function(e){this.setFont(e?"default":"italic")},_applyCloseable:function(e){this.getChildControl("close").setVisibility(e?"visible":"excluded")},_applyModel:function(e,t){t&&t.removeRelatedBindings(this);e&&e.bind("file.writeable",this,"writeable")},_applyIcon:function(e){var t=this.getChildControl("icon");t.setSource(e);e?t.show():t.exclude()},_applyLabel:function(){var e=this.getChildControl("label");if(this.getLabel()){var t=this.getLabel();if(this.isWriteable()||this.getModel().getFile().isFake()&&"hidden.php"!==this.getModel().getFile().getName())this.resetToolTipText();else{t+=" !";this.setToolTipText(this.tr("This file is not writeable"))}this.isModified()&&(t+=" *");e.setValue(t);e.show()}else{e.exclude();this.resetToolTipText()}},_onClose:function(){this.isCloseable()&&this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new qx.ui.basic.Image).setAppearance("open-file-item/icon");t.setAnonymous(!0);t.exclude();this._addAt(t,0);break;case"label":(t=new qx.ui.basic.Label).setAppearance("open-file-item/label");t.setAnonymous(!0);this._addAt(t,1);break;case"close":(t=new qx.ui.basic.Image("decoration/tabview/close.gif")).setAppearance("open-file-item/close");this.isCloseable()?t.addListener("tap",this._onClose,this):t.exclude();this._addAt(t,2)}return t||cv.ui.manager.form.FileTabItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this)}});cv.ui.manager.form.FileTabItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Option",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setKey(e);this.setValue(t)},events:{change:"qx.event.type.Event"},properties:{key:{check:"String",init:"",event:"changeKey",apply:"_applyChange"},value:{check:"String",init:"",event:"changeValue",apply:"_applyChange"}},members:{_applyChange:function(){this.fireEvent("change")}}});cv.ui.manager.model.config.Option.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.OptionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this._createChildControl("key");this._createChildControl("value");this._createChildControl("key-title");this._createChildControl("value-title");this._createChildControl("delete");this._createChildControl("add")},properties:{appearance:{refine:!0,init:"cv-editor-config-option"},model:{check:"cv.ui.manager.model.config.Option",nullable:!0,apply:"_applyModel"},readOnly:{check:"Boolean",init:!1,event:"changeReadOnly"}},events:{delete:"qx.event.type.Data",add:"qx.event.type.Event"},members:{setLabel:function(e){},setIcon:function(){},_applyModel:function(e,t){var i=this.getChildControl("key"),n=this.getChildControl("value"),a=this.getChildControl("key-title"),r=this.getChildControl("value-title");this.__P_38_0(t);if(e){e.bind("key",i,"value");e.bind("value",n,"value");i.bind("value",e,"key");n.bind("value",e,"value");i.show();n.show();a.exclude();r.exclude();this.getChildControl("delete").show();this.getChildControl("add").show()}else{i.exclude();n.exclude();a.show();r.show();this.getChildControl("delete").hide();this.getChildControl("add").hide()}},__P_38_0:function(e){if(e){var t=this.getChildControl("key"),i=this.getChildControl("value");if(e){e.removeRelatedBindings(t);e.removeRelatedBindings(i);t.removeRelatedBindings(e);i.removeRelatedBindings(e)}}},_createChildControlImpl:function(e){var t;switch(e){case"key":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this.bind("readOnly",t,"readOnly");this._add(t,{width:"40%"});break;case"value":(t=new qx.ui.form.TextField).set({liveUpdate:!0});this.bind("readOnly",t,"readOnly");this._add(t,{width:"40%"});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete option"));t.addListener("execute",function(){this.fireDataEvent("delete",this.getModel())},this);this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t);break;case"add":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("add",18))).setToolTipText(this.tr("Add option"));t.addListener("execute",function(){this.fireEvent("add")},this);this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t);break;case"key-title":(t=new qx.ui.basic.Label(this.tr("Key"))).exclude();this._add(t,{width:"40%"});break;case"value-title":(t=new qx.ui.basic.Label(this.tr("Value"))).exclude();this._add(t,{width:"40%"})}return t||cv.ui.manager.form.OptionListItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this.__P_38_0(this.getModel())}});cv.ui.manager.form.OptionListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.basic.Icon",{extend:qx.ui.core.Widget});cv.ui.manager.basic.Icon.$$dbClassInfo=e}();qx.$$packageData[2]={locales:{},resources:{},translations:{en:{},de:{"Hidden configuration":"Versteckte Konfiguration","Replacing the file failed.":"Das Ersetzen der Datei ist fehlgeschlagen.","This file already exists, do you want to replace it?":"Diese Datei existiert bereits, möchten Sie sie überschreiben?","File already exists":"Diese Datei existiert bereits","Uploading this file is not allowed here.":"Das Hochladen der Datei ist an dieser Stelle nicht erleubt.","File upload stopped with an error: %1":"Das Hochladen der Datei wurde mit einem Fehler beendet: %1","File has been uploaded":"Die Datei wurde hochgeladen",Clear:"Leeren",Delete:"Löschen","Backup from %1":"Sicherung vom %1","New name":"Neuer Name","Rename file":"Datei umbenennen","New file":"Neue Datei","Clone file":"Datei duplizieren","New folder":"Neuer Ordner",Rename:"Umbenennen",Download:"Herunterladen",Open:"Öffnen",Restore:"Wiederherstellen",Validate:"Prüfen",Replace:"Ersetzen","Compare with...":"Vergleichen mit...","Open with...":"Öffnen mit...",Trash:"Papierkorb","Diff: %1":"Vergleich: %1",'File "%1" has been created':'Datei "%1" wurde angelegt','Folder "%1" has been created':'Ordner "%1" wurde angelegt','File "%1" has been renamed':'Datei "%1" wurde umbenannt','Folder "%1" has been renamed':'Ordner "%1" wurde umbenannt','File "%1" has been moved':'Datei "%1" wurde verschoben','Folder "%1" has been moved':'Ordner "%1" wurde verschoben',"%1 has been restored":"%1 wurde wieder hergestellt",'File "%1" has been restored':'Datei "%1" wurde wieder hergestellt','Folder "%1" has been restored':'Ordner "%1" wurde wieder hergestellt',"Do you really want to clear the trash?":"Mächten Sie den Papirtkorb wirklich leeren?",'Do you really want to delete file "%1" from the trash?':'Möchten Sie die Datei "%1" wirklich aus dem Papierkorb löschen?','Do you really want to delete folder "%1" from the trash?':'Möchten Sie den Ordner "%1" wirklich aus dem Papierkorb löschen?','Do you really want to delete file "%1"?':'Möchten Sie die Datei "%1" wirklich löschen?','Do you really want to delete folder "%1"?':'Möchten Sie den Ordner "%1" wirklich löschen?',"Confirm deletion":"Löschen bestätigen","Trash has been cleared":"Der Papierkorb wurde geleert",'File "%1" has been removed from trash':'Datei "%1" wurde aus dem Papierkorb gelöscht','Folder "%1" has been removed from trash':'Ornder "%1" wurde aus dem Papierkorb gelöscht','File "%1" has been deleted':'Datei "%1" wurde gelöscht','Folder "%1" has been deleted':'Ordner "%1" wurde gelöscht',"Validating %1":"Prüfe %1","%1 has no errors!":"%1 hat keine Fehler!","%1 error found in %2!":"%1 Fehler gefunden in %2!","%1 errors found in %2!":"%1 Fehler gefunden in %2!","Show image":"Bild anzeigen","Config viewer":"Konfiguration anzeigen","%1 is no configuration file":"%1 ist keine Konfigurationsdatei","This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window.":"Diese Konfiguration wurde in einem anderen Fenster geöffnet. Wenn Sie diese Datei schließen, wird das Fenster ebenfalls geschlossen. Klicken zu hier, um zu dem Fenster zu gelangen.","Loading...":"Lade...","Upload file":"Datei hochladen","Show folder":"Ordner anzeigen","Filter by name...":"Nach Namen filtern...","Show icons":"Icons anzeigen","List mode":"Listenansicht","Preview mode":"Vorschau-Modus",Configurations:"Konfigurationen","Demo configurations":"Demo Konfigurationen","Media files":"Mediendateien",Miscellaneous:"Sonstiges","File has been created":"Datei wurde erstellt","File has been saved":"Datei wurde gespeichert",Texteditor:"Texteditor","Hidden config is invalid, please correct the errors":"Die versteckte Konfiguration ist ungültig, bitte beheben Sie die Fehler","Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?":"Die versteckte Konfiguration enthält eventuell Fehler! Es wird empfohlen die Warnungen zu beheben, bevor gespeichert wird. Trotzdem speichern?","Confirm saving with warnings":"Speichen trotz Warnungen bestätigen","Saving hidden config failed with error %1 (%2)":"Das Speichern der versteckten Konfiguration ist fehlgeschlagen: %1 (%2)","Hidden config has been saved":"Die Verstackte Konfiguration wurde gespeichert",'"%1" is not writable. Upgrading not possible.':'"%1" ist nicht speicherbar. Upgrade kann nicht durchgeführt werden.',"Xml-editor":"XML-Editor","Undo: %1":"Rückgängig: %1","Preview shows the current state of the edited configuration.":"Die Vorschau zeigt den aktuellen Stand der Konfiguration an.","Preview is out of sync. Click here to refresh.":"Die Vorschau zeigt nicht mehr den aktuellen Zustand der Konfiguration an. Klicken Sie hier, um die Vorschau zu aktualisieren.","Preview is out of sync. Highlighting of the currently selected tree element is deactivated until you refresh the preview. Click here to refresh.":"Die Vorschau zeigt nicht mehr den aktuellen Zustand der Konfiguration an. Das Hervorheben des gerade selektierten Elements ist deaktiviert bis die Vorschau aktualisiert wurde. Klicken Sie hier, um die Vorschau zu aktualisieren.",Expertview:"Expertenansicht","Reload preview":"Vorschau aktualisieren","Search...":"Suchen...","Please create a new Element either by dragging this button to the place where the new element should be inserted or by selecting an element and pressing this button to insert a new child to this element.":"Bitte erzeugen Sie ein neues Element indem Sie diesen Button auf die Stelle an der das neue Element platziert werden soll ziehen oder indem Sie ein Element auswählen und über einen Klick auf diesen Button ein neues Element als Kind-Element der Selektion anlegen.",'"%1" has been moved after "%2"':'"%1" wurde hinter "%2" verschoben','"%1" has been copied after "%2"':'"%1" wurde hinter "%2" kopiert','"%1" has been moved before "%2"':'"%1" wurde vor "%2" verschoben','"%1" has been copied before "%2"':'"%1" wurde vor "%2" kopiert','"%1" has been moved into "%2" as first child':'"%1" wurde als erstes Element in "%2" verschoben','"%1" has been copied into "%2" as first child':'"%1" wurde als erstes Element in "%2" kopiert','"%1" has been moved into "%2"':'"%1" wurde in "%2" verschoben','"%1" has been copied into "%2"':'"%1" wurde in "%2" kopiert',"<p style='font-weight:bold'>Choose element</p><p>Several possible element can be created at this position, please select one to proceed.</p>":"<p style='font-weight:bold'>Element wählen</p><p>Verschiedene Elemente können an dieser Stelle eingefügt werden, bitte wählen sie eines aus.</p>","Choose element":"Element wählen","Please choose the element you want to add here.":"Bitte wählen sie das Element, welches hinzugefügt werden soll.","not set":"nicht angegeben","This is not a valid value.":"Dies ist kein gültiger Wert.","Create new %1 element":"Erzeuge neues %1 Element","Please edit the attributes of the new %1 element, that will be added to the chosen position.":"Bitte bearbeiten Sie die Attribute des neuen %1 Elements, welches an der gewünschten Stelle erzeugt wird.","Edit element attributes":"Element Attribute bearbeiten","Edit %1":"Bearbeite %1","Show %1":"Zeige %1","Please edit the content of the new %1 element, that will be added to the chosen position.":"Bitte bearbeiten Sie den Inhalt des neuen %1 Elements, welches an der gewünschten Stelle erzeugt wird.","Edit element and content":"Element und Inhalt bearbeiten","Edit element content":"Elementinhalt bearbeiten","Edit text content":"Textinhalt bearbeiten","Disabling preview because the preview file could not be created.":"Vorschau wurde deaktiviert, weil die Vorschaudatei nicht erzeugt werden konnte.",Help:"Hilfe","<h3>Search for elements</h3><p>You can search for element names (tag names or content of name attribute) by typing a search value here. All elements whose tag name or name-attribute start with the search term will be found</p><p>Search will start automatically when the search term is at least 2 characters long.</p><p>The first found element will be opened and selected in the element tree. You can jump to the next found element with 'Enter' or the 'Down' key. Accordingly you can jump the the previous found element with the 'Up' key.</p>":"<h3>Suche nach Elementen</h3><p>Sie können nach Elementen suchen (Tag-Namen oder Name-Attribut) indem Sie hier einen Suchbegriff eingeben. Es werden alle Elemente gefunden deren Tag-Name oder 'name'-Attribut mit dem Suchbegriff beginnen.</p><p>Die Suche startet automatisch, wenn der Suchbegriff mindestens 2 Zeichen lang ist.</p><p>Das erste gefunden Element wird im Baum angezeigt. Mit der 'enter' oder der 'Pfeil runter'-Taste kann man zum nächsten Suchergebnis springen. Mit der 'Pfeil rauf'-Taste entsprechend zum vorherigen Suchergebnis.</p>","<h3>CometVisu XML-Editor - a brief introduction</h3><p>The CometVisu XMl-Editor shows the content of a CometVisu config file in a tree-like structure. You can traverse through the tree by opening/closing elements with a click on the expand icon.</p><p>The Xml-Editor will make sure that you do not create an invalid configuration file. If you experience a change that has not been accepted / or is not allowed that is most likely due to avoid an invalid configuration.</p><h4>Editing attributes</h4><p>The elements attributes can be edited by double clicking on it or selecting an element and clicking on the 'edit'-button in the toolbar above the tree of by right-clicking on the element and the 'edit'-button in the context menu</p><h4>Editing elements</h4><p>The elements in the tree support re-ordering via drag & drop. You can also cut/copy or paste them. You can add new elements by starting a drag in the round + button on the bottom of the tree, or by right clicking on an element and choosing the 'add child'-button.</p><p>You can delete elements by the delete buttons in the toolbar</p><h4>Expert view</h4><p>Some attributes are hidden in the editing dialog, because they provide access to settings that usually are not needed that often. You can access these attributes by toggling to the 'Expertview'-button in the toolbar directly above the tree.</p><h4>Config preview</h4><p>An preview of the edited config file is shown on the right part of the screen. The preview will not automatically refresh after you have changed something. You can refresh is manually by clicking the most right button in the toolbar.</p>":"<h3>CometVisu XML-Editor - eine kurze Einführung</h3><p>Der CometVisu XML-Editor stellt eine CometVisu-Konfigurationsdatei in einer Baumstruktur dar. Man kann die Elemente durch einen Klick auf das kleine Dreieck-Icon öffnen/schließen.</p><p>Der XML-Editor stellt sicher, dass keine ungültige Konfiguration erzeugt werden kann. Falls einige Änderungen nicht möglich sind, dann ist das diesem Umstand geschuldet.</p><h4>Attribute bearbeiten</h4><p>Die Attribute eines Elements können bearbeitet werden, indem man einen Doppelklick auf dem Element ausführt. Alternativ stehen im Kontextmenü (öffnen mit rechter Maustaste) und in der Symbolleiste direkt über dem Baum \"Bearbeiten\"-Buttons zur Verfügung .</p><h4>Element bearbeiten</h4><p>Die Elemente im Baum unterstützen eine Umsortierung via Drag&Drop. Sie können ebenfalls ausgeschnitten, kopiert und eingefügt werden. Neue Elemente können hinzugefügt werden, indem man auf den '+'-Button unter dem Baum klickt (Maustaste gedrückt halten) und diesen dann an die Stelle zieht, an der man das neuen Element einfügen möchte. Alternativ steht über das Kontextmenü ein 'Kind-Element einfügen'-Button zur Verfügung.</p><p>Selektierte Elemente können über die Symbolleiste und das Kontextmenü gelöscht werden.</p><h4>Expertenansicht</h4><p>Normalerweise sind einige Attribute nicht sichtbar im Editier-Dialog. Über den 'Expertansicht'-Button in der Symbolleiste kann man diese freischalten.</p><h4>Vorschau</h4><p>Auf der rechten Seite wird eine Vorschau der Konfiguration gezeigt. Diese aktualisiert sich nicht automatisch. Über den Button in der Symbolleiste ganz rechts, kann man die Vorschau aktualisieren.</p>","File compare":"Datei vergleichen","The following changes have been made":"Die folgendenen Änderungen wurden vorgenommen","You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.":"Sie können die Änderungen im Editor überprüfen. Die linke Seite zeigt den Inhalt vor der Aktualisierung, die rechte Seite nachher.","No changes have been made":"Es wurden keine Änderungen vorgenommen","Config file has been upgraded to the current library version.":"Die Konfigurations-Datei wurde auf die aktuelle Version aktualisiert.",'Click "Apply" if you want to save the changes and reload the browser.':'Klicken Sie "Anwenden", wenn Sie die Änderungen speichern und die aktualisierte Konfigurations-Datei laden möchten.','Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.':'Klicken Sie "Prüfen", wenn Sie die Änderungen überprüfen möchten. In diesem Fall müssen Sie selbst die Datei speichern und den Browser neu laden, damit die Änderungen wirksam werden.',"Upgrade successful":"Aktualisierung erfolgreich",Apply:"Anwenden",Check:"Prüfen","Hidden configuration file (hidden.php) not writeable":"Die versteckte Konfiguration (hidden.php) ist nicht beschreibbar",'Section name duplicate: "%1".':'Doppelter Sektionsname: "%1".','Option key duplicate: "%1" in section "%2".':'Doppelter Optionsname "%1" in Sektion "%2".',"Section is invalid and has not been saved.":"Diese Sektion ist ungültig und wurde nicht gespeichert.","Add section":"Sektion hinzufügen","Drop the file here to replace the content.":"Lassen Sie die Datei hier fallen um den Inhalt zu ersetzen.","Do you really want to replace the '%1' with the uploaded files content?":"Möchten Sie wirklich '%1' mit der hochgeladenen Datei ersetzen?",'Double click to open "%1"':'Doppelklick zum Öffnen von "%1"',"Download file":"Datei herunterladen","Other file actions":"Andere Datei-Aktionen",Reload:"Neu laden","Variable from template %1":"Variable aus Template %1","Drag to move":"Klicken & Ziehen zum Verschieben",View:"Ansehen",Edit:"Bearbeiten",Cut:"Ausschneiden",Copy:"Kopieren",Paste:"Einfügen","Add child":"Kind-Element einfügen","Possible values could no be retrieved, please check browser console for error details":"Die möglichen Werte konnten nicht geladen werden. Details zum Fehler können in der Browser-Konsole nachgelesen werden","Value is invalid":"Wert ist ungültig","Remove %1":"Lösche %1","Move %1":"Verschiebe %1","Add %1":"Erzeuge %1","Invalid text content: '%1'":"Ungültiger Textinhalt: '%1'","Text content not allowed here":"Kein Text-Inhalt erlaubt","Invalid value":"Ungültiger Wert","Attribute '%1' not allowed":"Attribut '%1' ist nicht erlaubt","Attribute '%1' is required but missing":"Attribut '%1' fehlt","Text content is missing":"Fehlender Textinhalt","Text content is invalid":"Textinhalt ist ungültig","Change %1":"Ändere %1","Child element '%1' not allowed.":"Kind-Element '%1' ist nicht erlaubt.",'<h3>Config Errors</h3><p>The validation of "%1" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because it can break the file completely. Please open this file in the text editor and fix the errors there. Only proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>':'<h3>Fehler in der Konfiguration</h3><p>Die Überprüfung von "%1" hat Fehler gefunden. Es wird NICHT empfohlen, diese Datei im XML-Editor zu bearbeiten, weil die Möglichkeit besteht, dass sie dadurch unbrauchbar wird. Bitte öffnen Sie die Datei im Texteditor und beheben Sie die Fehler dort. Fahren Sie nur fort, wenn Sie wissen was Sie tun.</p>',"<p>You can choose between the following options:<ul>    <li><b>Cancel</b> - Close this editor</li>    <li><b>Proceed</b> - Open the defective file in this editor</li>    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li></ul></p>":"<p>Sie können zwischen folgenden Optionen wählen:<ul>    <li><b>Abbrechen</b> - Diesen Editor schließen</li>    <li><b>Fortfahren</b> - Ungültige Datei in diesem Editor öffnen</li>    <li><b>Öffnen in Text-Editor</b> - Diesen Editor schließen und die ungültige Datei im Text-Editor öffnen</li></ul></p>","Line %1":"Zeile %1",Cancel:"Abbruch",Proceed:"Fortfahren","Open in text editor":"Im Text-Editor öffnen","config folder does not exists":"config Ordner existiert nicht","config folder is not readable":"config Ordner kann nicht gelesen werden","config folder is not writeable":"config Ordner ist nicht beschreibbar","backup folder is not writeable":"backup Ordner ist nicht beschreibbar","media folder is not writeable":"media Ordner ist nicht beschreibbar","You have files opened with unsaved changes, you should save them now.":"Sie haben Dateien mit ungespeicherten Änderungen geöffnet, Sie sollten diese jetzt speichern.","Unsaved changes":"Nicht gespeicherte Änderungen","Save & quit":"Speichern & beenden","Quit without saving":"Beenden ohne zu speichern","Cannot load config template":"Template für Konfigurationsdatei kann nicht geladen werden","Cannot load file content":"Dateiinhalt kann nicht geladen werden",'Cannot open file: "%1"':'Datei "%1" kann nicht geöffnet werden',"This file has unsaved changes that will be lost when you close it without saving.":"Diese Datei enthält ungespeicherte Änderungen, die verloren gehen, wenn Sie sie ohne zu speichern schließen.","This file has not been saved on the backend yet. It will be lost when you close it without saving.":"Diese Datei wurde noch nicht gespeichert. Sie wird verloren gehen, wenn Sie sie ohne zu speichern schließen.","Save & close":"Speichern & schließen","Discard & close":"Verwerfen & schließen",'Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)':'Bitte geben Sie den Namen der neuen Konfiguraton (ohne "visu_config_" am Anfang und ".xml" am Ende) ein',"A configuration with this name already exists.":"Eine Konfigurationsdatei mit diesem Namen existiert bereits.","Please enter the file name.":"Bitte geben Sie den Dateinamen ein.","A file with this name already exists.":"Eine Datei mit diesem Namen exisitert bereits.","Please enter the folder name.":"Bitte geben Sie den Namen des Ordners ein.","A folder with this name already exists.":"Eine Ordner mit diesem Namen exisitert bereits.","Folder has been created":"Verzeichnis wurde erstellt",About:"Über","Build date":"Erzeugt am","Build revision":"Revision","Library version":"Library-Version",Section:"Sektion","Delete section":"Sektion löschen","New config file":"Neue Konfigurationsdatei",Save:"Speichern","Save as...":"Speichern unter...",Quit:"Beenden",Undo:"Rückgängig",Redo:"Wiederholen","Use text editor":"Texteditor benutzen","Use xml editor":"XML-Editor benutzen","Enable quick preview":"Schnellvorschau aktivieren","Expert mode":"Expertenansicht","CometVisu Manager":"CometVisu Manager",File:"Datei",New:"Neu",Preferences:"Einstellungen","complex type, please see documentation":"Komplexer Typ, bitte in der Dokumentation nachschauen","This file is not writeable":"Diese Datei ist nicht änderbar","Delete option":"Option löschen","Add option":"Option hinzufügen",Key:"Schlüssel",Value:"Wert"}}};
//# sourceMappingURL=package-2.js.map