!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.IActionHandler",{members:{canHandleAction:function(e){},handleAction:function(e,t){}}});cv.ui.manager.IActionHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.control.MFileEventHandler",{construct:function(){this._disableFileEvents||qx.event.message.Bus.subscribe("cv.manager.file",this._handleFileEvent,this)},members:{_disableFileEvents:!1},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.file",this._handleFileEvent,this)}});cv.ui.manager.control.MFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.control.IFileEventHandler",{members:{_handleFileEvent:function(e){}}});cv.ui.manager.control.IFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"iconfont.material.Load":{construct:!0},"cv.ui.manager.model.BackupFolder":{construct:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.control.ActionDispatcher":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.ui.tooltip.Manager":{construct:!0},"qx.core.Init":{},"qx.bom.element.Style":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.model.Preferences":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.ui.manager.editor.AbstractEditor":{},"cv.ui.manager.core.GlobalState":{},"cv.ui.manager.model.OpenFile":{},"dialog.Dialog":{},"cv.ui.manager.editor.IEditor":{},"cv.ui.manager.model.CompareFiles":{},"qx.dom.Element":{},"qx.theme.manager.Meta":{},"cv.theme.Dark":{},"qx.ui.command.Group":{},"qx.ui.command.Command":{},"cv.ui.manager.control.FileController":{},"dialog.Prompt":{},"qx.ui.root.Inline":{},"qx.ui.layout.Canvas":{},"qx.ui.container.Composite":{},"qx.ui.layout.Dock":{},"cv.ui.manager.MenuBar":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.splitpane.Pane":{},"cv.theme.dark.Images":{},"cv.ui.manager.tree.FileSystem":{},"qx.ui.layout.VBox":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.FileTabItem":{},"qx.ui.container.Stack":{},"qx.util.DeferredCall":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Main",{extend:qx.core.Object,type:"singleton",include:[cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.IActionHandler,cv.ui.manager.control.IFileEventHandler],construct:function(){qx.core.Object.constructor.call(this);iconfont.material.Load;cv.ui.manager.model.BackupFolder.getInstance();this._checkEnvironment();this.initOpenFiles(new qx.data.Array);this.__P_24_0=cv.ui.manager.control.ActionDispatcher.getInstance();this.__P_24_0.setMain(this);this.__P_24_1();this._draw();qx.event.message.Bus.subscribe("cv.manager.*",this._onManagerEvent,this);qx.ui.tooltip.Manager.getInstance()},statics:{ROOT:null},properties:{openFiles:{check:"qx.data.Array",deferredInit:!0},writeableFolder:{check:"Boolean",init:!1,event:"changeWriteableFolder"},currentFolder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentFolder",event:"changeCurrentFolder"},currentSelection:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentSelection",event:"changeCurrentSelection"},deleteableSelection:{check:"Boolean",init:!1,event:"changeDeleteableSelection"},renameableSelection:{check:"Boolean",init:!1,event:"changeRenameableSelection"},visible:{check:"Boolean",init:!0,event:"changeVisible",apply:"_applyVisible"}},members:{__P_24_2:null,__P_24_3:null,_pane:null,_tree:null,_stack:null,_oldCommandGroup:null,_managerCommands:null,_mainContent:null,_openFilesController:null,_hiddenConfigFakeFile:null,__P_24_0:null,_applyVisible:function(e){var t=qx.core.Init.getApplication().getCommandManager();if(e){t.setActive(this._managerCommands);qx.bom.element.Style.set(this.__P_24_4(),"display","block")}else{t.setActive(this._oldCommandGroup);qx.bom.element.Style.set(this.__P_24_4(),"display","none")}},_checkEnvironment:function(){cv.io.rest.Client.getFsClient().checkEnvironmentSync(function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):t&&t.forEach(function(e){switch(e.entity){case".":0==(1&e.state)?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder does not exists")):0==(2&e.state)?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not readable")):0==(4&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not writeable"));break;case"backup":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("backup folder is not writeable"));break;case"media":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("media folder is not writeable"));break;case"hidden.php":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Hidden configuration file (hidden.php) not writeable"))}},this)},this)},canHandleAction:function(e){return!("delete"===e&&this.getCurrentSelection()&&!this.getCurrentSelection().isWriteable())&&["close","quit","new-file","new-config-file","new-folder","delete","upload","clone"].includes(e)},handleAction:function(e,t){switch(e){case"close":t?this.closeFile(t):this.closeCurrentFile();break;case"quit":this.setVisible(!1);break;case"new-file":this._onCreate("file",null,t);break;case"new-config-file":cv.io.rest.Client.getFsClient().readSync({path:".templates/visu_config.xml"},function(e,t){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load config template")):this._onCreate("config",t,cv.ui.manager.model.FileItem.ROOT)},this);break;case"clone":cv.io.rest.Client.getFsClient().readSync({path:t.file.getFullPath()},function(e,i){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load file content")):t.file.isConfigFile()?this._onCreate("config",i,cv.ui.manager.model.FileItem.ROOT):this._onCreate("file",i)},this);break;case"new-folder":this._onCreate("dir",null,t);break;case"delete":this._onDelete(t);break;case"upload":break;default:this.warn(e+" handling is not implemented yet!")}},_handleFileEvent:function(e){var t=e.getData();if("deleted"===t.action){this.getOpenFiles().copy().some(function(e){e.getFile().isRelated(t.path)&&this.closeFile(e)},this);this.getCurrentFolder()&&this.getCurrentFolder().getFullPath()===t.path&&this.resetCurrentFolder()}else this.warn("unhandled file event",t.action)},__P_24_5:function(e){var t=null,i=null;cv.ui.manager.model.FileItem.ROOT.getChildren().some(function(n){if("demo"===n.getName())i=n;else if(n.getName()===e){t=n;return!0}});!t&&i&&i.getChildren().some(function(i){if(i.getName()===e){t=i;return!0}});return t},_onManagerEvent:function(e){var t=e.getData();switch(e.getName()){case"cv.manager.compareFiles":this.openFile(t,!1);break;case"cv.manager.openWith":"string"==typeof t.file&&(t.file=this.__P_24_5(t.file));this.openFile(t.file||this.getCurrentSelection(),!1,t.handler,null,t.handlerOptions);break;case"cv.manager.open":"string"==typeof t&&(t=this.__P_24_5(t));this.openFile(t||this.getCurrentSelection(),!1)}},_onChangeTreeSelection:function(e){var t=e.getData();(cv.ui.manager.model.Preferences.getInstance().isQuickPreview()&&"tap"===t.mode||"dbltap"===t.mode)&&this.__P_24_6(t.node,t.mode);var i=t.node;if(i){"file"===t.node.getType()?this.setCurrentFolder(t.node.getParent()):this.setCurrentFolder(i);this.setCurrentSelection(i)}else{this.resetCurrentFolder();this.resetCurrentSelection()}},__P_24_6:function(e,t){e&&("file"===e.getType()?this.openFile(e,"tap"===t):"dbltap"===t&&e.setEditing(!0))},_applyCurrentFolder:function(e,t){t&&t.removeRelatedBindings(this);e?e.bind("writeable",this,"writeableFolder"):this.resetWriteableFolder()},_applyCurrentSelection:function(e,t){t&&t.removeRelatedBindings(this);if(e){e.bind("writeable",this,"deleteableSelection");e.bind("inTrash",this,"renameableSelection",{converter:function(e){return!e}})}else this.resetDeleteableSelection()},_onChangeFileSelection:function(){var e=this._openFilesController.getSelection();if(e.length>0){var t,i=e.getItem(0),n=i.getFile(),a=i.getHandlerId();if((t=a?cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(a):cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(n)).instance)t.instance.setFile(n);else{t.instance=new t.Clazz;t.instance.setFile(n)}this._stack.indexOf(t.instance)<0&&this._stack.add(t.instance);t.instance instanceof cv.ui.manager.editor.AbstractEditor&&t.instance.setHandlerOptions(i.getHandlerOptions());this._stack.setSelection([t.instance]);this.__P_24_0.setFocusedWidget(t.instance);cv.ui.manager.core.GlobalState.getInstance().setOpenedFocusedFile(n)}else cv.ui.manager.core.GlobalState.getInstance().resetOpenedFocusedFile()},openFile:function(e,t,i,n,a){var r,o=this.getOpenFiles();if(i){(s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(i)).instance||(s.instance=new s.Clazz);if(s.instance.isExternal()){s.instance.setFile(e);return}}else{var s;if(!(s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,n))){cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr('Cannot open file: "%1"',e.getName()));return}i=s.Clazz.classname}var l=o.some(function(t){if(t.getFile()===e&&i===t.getHandlerId()){r=t;return!0}});r||(r=new cv.ui.manager.model.OpenFile(e,i));a?r.setHandlerOptions(a):r.resetHandlerOptions();if(!0===t){if(!r.isPermanent()){if(null!==this.__P_24_2&&o.getItem(this.__P_24_2)&&!o.getItem(this.__P_24_2).isPermanent())o.setItem(this.__P_24_2,r);else{this.__P_24_2=o.length;o.push(r)}r.setPermanent(!1)}}else{l||null!==this.__P_24_2&&o.indexOf(r)===this.__P_24_2||o.push(r);r.setPermanent(!0);this.__P_24_2=null}this._openFilesController.getTarget().setModelSelection([r])},closeFile:function(e,t){if(e instanceof cv.ui.manager.model.FileItem){if(!this.getOpenFiles().some(function(t){if(t.getFile().getFullPath()===e.getFullPath()){e=t;return!0}}))return}if(e.isCloseable()){var i=e.getFile();if(!i.isModified()||t){e instanceof cv.ui.manager.model.OpenFile&&e.resetPermanent();var n=this._openFilesController.getSelection(),a=-1,r=this.getOpenFiles();n.length>0&&n.getItem(0)===e&&(a=r.indexOf(e));r.remove(e);var o=this._stack.getSelection()[0];qx.Class.hasInterface(o.constructor,cv.ui.manager.editor.IEditor)&&o.resetFile();if(0===this.getOpenFiles().length){this._stack.resetSelection();this.__P_24_0.resetFocusedWidget();this.__P_24_2=null}a>0?this._openFilesController.getSelection().replace(r.getItem(a-1)):0===a&&r.length>0&&this._openFilesController.getSelection().replace(r.getItem(0));if(i instanceof cv.ui.manager.model.CompareFiles){var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(i);s.instance.clear();if(0===r.filter(function(e){return e.getFile()instanceof cv.ui.manager.model.CompareFiles}).length){s.instance.destroy();s.instance=null}}else if(window.monaco&&"cv.ui.manager.editor.Source"===e.getHandlerId()){var l=window.monaco.editor.getModel(i.getUri());l&&l.dispose()}}else{var c=qx.locale.Manager.tr("This file has unsaved changes that will be lost when you close it. Do you really want to close the file?");i.isTemporary()&&(c=qx.locale.Manager.tr("This file has not been saved on the backend yet. It will be lost when you close it. Do you really want to close the file?"));dialog.Dialog.confirm(c,function(t){if(t){this.closeFile(e,!0);i.isTemporary()&&qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:i.getFullPath()})}},this,qx.locale.Manager.tr("Unsaved changes"))}}},closeCurrentFile:function(){var e=this._openFilesController.getSelection().length>0?this._openFilesController.getSelection().getItem(0):null;e&&this.closeFile(e)},_onCloseFile:function(e){this.closeFile(e.getData())},__P_24_4:function(){if(!this.__P_24_3){this.__P_24_3=qx.dom.Element.create("div",{id:"manager",style:"position: absolute; top: 0; left: 0; right: 0; bottom: 0;"});qx.dom.Element.insertEnd(this.__P_24_3,document.body);qx.theme.manager.Meta.getInstance().setTheme(cv.theme.Dark)}return this.__P_24_3},__P_24_1:function(){var e=this._managerCommands=new qx.ui.command.Group;e.add("save",new qx.ui.command.Command("Ctrl+S"));e.add("save-as",new qx.ui.command.Command("Ctrl+Shift+S"));e.add("new-file",new qx.ui.command.Command("Ctrl+N"));e.add("new-folder",new qx.ui.command.Command("Ctrl+Shift+N"));e.add("quit",new qx.ui.command.Command("Ctrl+Q"));var t=new qx.ui.command.Command("F2");e.add("rename",t);this.bind("renameableSelection",t,"enabled");var i=qx.core.Init.getApplication().getCommandManager();this._oldCommandGroup=i.getActive();i.add(e);i.setActive(e)},_onDelete:function(e){var t=e||this.getCurrentSelection();t&&cv.ui.manager.control.FileController.getInstance().delete(t)},_onChangeStackSelection:function(e){var t=[];e.getData().forEach(function(e){var i=this.getOpenFiles().toArray().find(function(t){return t.getFile()===e.getFile()&&t.getHandlerId()===e.classname});i&&t.push(i)},this);this._openFilesController.getSelection().replace(t)},__P_24_7:function(e,t,i,n,a){var r=new dialog.Prompt({message:e,callback:t||null,context:i||null,value:n||null,caption:a||"",filter:/[\w\d_\-\.\s]/});r.show();return r},_onCreate:function(e,t,i){var n=i||this.getCurrentFolder();if(n){var a,r;if("config"===e){a=qx.locale.Manager.tr('Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)');r=qx.locale.Manager.tr("A configuration with this name already exists.")}else if("file"===e){a=qx.locale.Manager.tr("Please enter the file name.");r=qx.locale.Manager.tr("A file with this name already exists.")}else{a=qx.locale.Manager.tr("Please enter the folder name.");r=qx.locale.Manager.tr("A folder with this name already exists.")}this.__P_24_7(a,function i(o){if(o){var s=o;if("config"===e){var l=/visu[_-]config[_-]([\w\d_-]+)(\.xml)?/.exec(o);l&&(o=l[1]);s="visu_config_"+o+".xml"}if(n.getChildren().some(function(t){if(t.getName()===s&&t.getType()===e)return!0},this)){cv.ui.manager.snackbar.Controller.error(r);this.__P_24_7(a,i,this,o)}else{var c=new cv.ui.manager.model.FileItem(s,n.getFullPath(),n);c.set({type:"config"===e?"file":e,readable:!0,writeable:!0,loaded:!0,modified:!0,temporary:!0,parentFolder:n.getFullPath(),content:t||""});"dir"===e&&cv.io.rest.Client.getFsClient().createSync({path:c.getFullPath(),type:e},null,function(e){if(e)cv.ui.manager.snackbar.Controller.error(e);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("Folder has been created"));c.set({modified:!1,temporary:!1});qx.event.message.Bus.dispatchByName(c.getBusTopic(),{type:"created",file:c,data:"",source:this})}},this);n.addChild(c);n.sortElements();this._tree.refresh();this._tree.setSelection(c);"dir"!==e&&this.openFile(c,!1,null,"edit")}}},this)}},__P_24_8:function(e){for(;e&&1===e.nodeType;){if("on"===e.getAttribute("qxDroppable"))return e;e=e.parentNode}return null},_draw:function(){var e=this.__P_24_4(),t=new qx.ui.root.Inline(e,!0,!0);this.bind("visible",t,"visibility",{converter:function(e){return e?"visible":"excluded"}});t.addListenerOnce("appear",function(){var e=t.getContentElement().getDomElement();e.addEventListener("drop",function(e){this.__P_24_8(e.target)||e.preventDefault()}.bind(this));e.addEventListener("dragover",function(e){this.__P_24_8(e.target)||e.preventDefault()}.bind(this))},this);qx.core.Init.getApplication().setRoot(t);t.setLayout(new qx.ui.layout.Canvas);var i=cv.ui.manager.snackbar.Controller.getInstance();t.add(i,{bottom:10,left:200});function n(){var e=t.getBounds();i.setLayoutProperties({bottom:10,left:Math.round(e.width/2)-150});i.setMaxHeight(e.height-40)}t.addListener("resize",n,this);t.addListener("appear",n,this);window.addEventListener("resize",function(){e.style.height=window.innerHeight+"px"});var a=new qx.ui.container.Composite(new qx.ui.layout.Dock);t.add(a,{edge:0});var r=cv.ui.manager.MenuBar.getInstance();a.add(r,{edge:"north"});var o=r.getButton("upload"),s=new cv.ui.manager.upload.UploadMgr(o);this.bind("currentFolder",s,"folder");this._pane=new qx.ui.splitpane.Pane;a.add(this._pane,{edge:"center"});var l=cv.ui.manager.model.FileItem.ROOT=new cv.ui.manager.model.FileItem("."),c=cv.ui.manager.model.FileItem.getIconFile();l.set({overrideIcon:!0,writeable:!0,readable:!0,open:!0,fakeChildren:[c],icon:cv.theme.dark.Images.getIcon("home",18)});this.setCurrentFolder(l);this._tree=new cv.ui.manager.tree.FileSystem(l);this._tree.addListener("changeSelection",this._onChangeTreeSelection,this);var d=new qx.ui.container.Composite(new qx.ui.layout.VBox),u=new cv.ui.manager.ToolBar(s);this.bind("currentFolder",u,"folder");this.bind("currentSelection",u,"file");u.addListener("reload",this._tree.reload,this._tree);var h=r.getButtonConfiguration();this.bind("writeableFolder",h["new-file"].args[2],"enabled");this.bind("writeableFolder",h["new-folder"].args[2],"enabled");d.add(u);d.add(this._tree,{flex:1});this._pane.add(d,0);cv.ui.manager.model.Preferences.getInstance().bind("expertMode",d,"visibility",{converter:function(e){return e?"visible":"excluded"}});this._mainContent=new qx.ui.container.Composite(new qx.ui.layout.VBox);var g=new qx.ui.form.List(!0);g.setAppearance("open-files-tabs");this._openFilesController=new qx.data.controller.List(this.getOpenFiles(),g,"file.name");this._openFilesController.setDelegate({createItem:function(){var e=new cv.ui.manager.form.FileTabItem;e.addListener("close",this._onCloseFile,this);return e}.bind(this),bindItem:function(e,t,i){e.bindDefaultProperties(t,i);e.bindProperty("file.permanent","permanent",null,t,i);e.bindProperty("file.modified","modified",null,t,i);e.bindProperty("icon","icon",null,t,i);e.bindProperty("closeable","closeable",null,t,i)}});g.addListener("changeSelection",this._onChangeFileSelection,this);this._mainContent.add(g);this._stack=new qx.ui.container.Stack;this._stack.addListener("changeSelection",this._onChangeStackSelection,this);this._mainContent.add(this._stack,{flex:1});this._pane.add(this._mainContent,1);var m=new cv.ui.manager.model.OpenFile(l,"cv.ui.manager.Start");m.setCloseable(!1);this.getOpenFiles().push(m);g.setModelSelection([m])}},destruct:function(){this._disposeObjects("_pane","_tree","_stack","_mainContent","_openFilesController");var e=qx.core.Init.getApplication();e.getCommandManager().setActive(this._oldCommandGroup);this._oldCommandGroup=null;new qx.util.DeferredCall(function(){e.resetRoot()}).schedule();document.body.removeChild(this.__P_24_3);this.__P_24_3=null;this.__P_24_0=null;qx.event.message.Bus.unsubscribe("cv.manager.*",this._onManagerEvent,this);delete cv.ui.manager.Main.$$instance}});cv.ui.manager.Main.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.marshal.MEventBubbling":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"qx.data.Array":{construct:!0},"cv.theme.dark.Images":{},"qx.locale.Manager":{},"cv.ui.manager.snackbar.Controller":{},"cv.io.rest.Client":{},"qx.util.LibraryManager":{},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.FileItem",{extend:qx.core.Object,include:[qx.data.marshal.MEventBubbling,cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.control.IFileEventHandler],construct:function(e,t,i,n){qx.core.Object.constructor.call(this);this.initChildren(new qx.data.Array);n&&this.setFakeChildren(n);if(t){t.endsWith("/")||(t+="/");this.__P_38_0=t}e&&this.setName(e);i&&this.setParent(i)},statics:{ROOT:null,_fakeIconFile:null,_hiddenConfigFakeFile:null,_acceptedFiles:{".":"*.xml",media:"*.js,*.jpg,*.gif,*.png,*.conf,*.svg,*.md,*.rst,*,css,*.txt"},isConfigFile:function(e){return/visu_config.*\.xml/.test(e)},getConfigName:function(e){var t=/visu_config_?([^.]+)\.xml/.exec(e);return t?t[1]:null},getIconFile:function(){this._fakeIconFile||(this._fakeIconFile=new cv.ui.manager.model.FileItem("CometVisu-Icons","",cv.ui.manager.model.FileItem.ROOT).set({type:"file",overrideIcon:!0,writeable:!1,readable:!0,open:!0,loaded:!0,hasChildren:!1,fake:!0,icon:cv.theme.dark.Images.getIcon("icons",18)}));return this._fakeIconFile},getHiddenConfigFile:function(){this._hiddenConfigFakeFile||(this._hiddenConfigFakeFile=new cv.ui.manager.model.FileItem("hidden.php","",cv.ui.manager.model.FileItem.ROOT).set({hasChildren:!1,loaded:!0,readable:!0,writeable:!0,overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),type:"file",fake:!0,displayName:qx.locale.Manager.tr("Hidden configuration")}));return this._hiddenConfigFakeFile},getAcceptedFiles:function(e){return this._acceptedFiles[e.getFullPath()]}},properties:{open:{check:"Boolean",event:"changeOpen",apply:"_onOpen",init:!1},loaded:{check:"Boolean",event:"changeLoaded",init:!1},loading:{check:"Boolean",event:"changeLoading",init:!1},parent:{event:"changeParent",init:null},children:{check:"qx.data.Array",event:"changeChildren",apply:"_applyEventPropagation",deferredInit:!0},fakeChildren:{check:"Array",nullable:!0},displayName:{check:"String",init:"",event:"changeDisplayName"},fake:{check:"Boolean",init:!1,event:"changeFake"},overrideIcon:{check:"Boolean",init:!1},icon:{check:"String",nullable:!0,event:"changeIcon"},hash:{check:"Number",nullable:!0},editing:{check:"Boolean",init:!1,event:"changeEditing"},special:{check:"String",nullable:!0,event:"changeSpecial"},temporary:{check:"Boolean",init:!1,event:"changeTemporary"},valid:{check:"Boolean",init:!0,event:"changeValid"},hasWarnings:{check:"Boolean",init:!1,event:"changeHasWarnings"},content:{check:"String",nullable:!0},modified:{check:"Boolean",init:!1,event:"changeModified"},hasChildren:{check:"Boolean",event:"changeHasChildren",apply:"_applyHasChildren",init:!1},name:{check:"String",event:"changeName",init:"",apply:"_applyName"},type:{check:["dir","file"],transform:"_toLowerCase",nullable:!0,apply:"_maintainIcon"},parentFolder:{check:"String",nullable:!0},readable:{check:"Boolean",init:!1,event:"changeReadable"},writeable:{check:"Boolean",init:!1,event:"changeWriteable"},mounted:{check:"Boolean",init:!1,event:"changeMounted"},trash:{check:"Boolean",init:!1,event:"changeTrash"},inTrash:{check:"Boolean",init:!1,event:"changeInTrash"}},members:{__P_38_0:null,__P_38_1:null,__P_38_2:null,_toLowerCase:function(e){return e.toLowerCase()},isRelated:function(e){return this.getFullPath()===e},_handleFileEvent:function(e){if(!this.isFake()){var t=e.getData();switch(t.action){case"moved":this.reload();break;case"added":"dir"===this.getType()&&t.path.startsWith(this.getFullPath())&&this.reload();break;case"deleted":if(t.path===this.getFullPath())this.dispose();else if("dir"===this.getType()&&t.path.startsWith(this.getFullPath())){var i=this.getChildren();i.some(function(e){if(e.getFullPath()===t.path){i.remove(e);this.removeRelatedBindings(e);return!0}},this)}}}},_applyName:function(e,t){this.__P_38_1=null;!e||null!==this.getDisplayName()&&this.getDisplayName()!==t||this.setDisplayName(e)},getPath:function(){if(!this.__P_38_0){var e=this.getParentFolder();e?e.endsWith("/")||(e+="/"):e="";this.__P_38_0=e}return this.__P_38_0},_onOpen:function(e){!this.isLoaded()&&e&&this.load();this._maintainIcon()},_maintainIcon:function(){this.isOverrideIcon()||("file"===this.getType()?this.setIcon(cv.theme.dark.Images.getIcon("file",18)):this.isTrash()?this.setIcon(cv.theme.dark.Images.getIcon("trash",18)):this.isOpen()?this.setIcon(cv.theme.dark.Images.getIcon("folder-open",18)):this.isMounted()?this.setIcon(cv.theme.dark.Images.getIcon("mounted-folder",18)):this.setIcon(cv.theme.dark.Images.getIcon("folder",18)))},isConfigFile:function(){return cv.ui.manager.model.FileItem.isConfigFile(this.getName())},_applyHasChildren:function(e){!0===e&&0===this.getChildren().length&&this.getChildren().push(new cv.ui.manager.model.FileItem(""))},unload:function(){this.setLoaded(!1);this.setLoading(!1);this.getChildren().removeAll().forEach(function(e){this.removeRelatedBindings(e)},this)},reload:function(e,t){this.unload();return this.load(e,t)},addChild:function(e){var t=e.getParent();if(t!==this){t.getChildren().remove(e);t.removeRelatedBindings(e)}e.setParent(this);"dir"===e.getType()&&e.isMounted()||this.bind("mounted",e,"mounted");this.getChildren().push(e)},_onGet:function(e){var t=this.getChildren();t.removeAll().forEach(function(e){this.removeRelatedBindings(e)},this);e&&e.forEach(function(e){var i=new cv.ui.manager.model.FileItem(null,null,this);if(e.hasOwnProperty("children")){var n=e.children;delete e.children;if(n.length>0){i.getChildren().replace(n);i.setLoaded(!0)}}i.set(e);t.push(i)},this);this.getFakeChildren()&&t.append(this.getFakeChildren());this.sortElements();this.setLoaded(!0);this.__P_38_2&&this.__P_38_2();this.setLoading(!1)},_onError:function(e){console.error(e);cv.ui.manager.snackbar.Controller.error(e);this.getChildren().removeAll().forEach(function(e){this.removeRelatedBindings(e)},this);this.setLoaded(!0);this.__P_38_2&&this.__P_38_2();this.setLoading(!1)},load:function(e,t){if("file"!==this.getType())if(this.isFake()){this.setLoaded(!0);this.getFakeChildren()&&this.getChildren().append(this.getFakeChildren())}else if(this.isLoading())e&&this.addListenerOnce("changeLoading",e,t);else if(this.isLoaded())e&&e.apply(t);else{this.setLoading(!0);e&&(this.__P_38_2=e.bind(t||this));cv.io.rest.Client.getFsClient().readSync({path:this.getFullPath()},function(e,t){e?this._onError(e):this._onGet(t)},this)}else this.setLoaded(!0)},getFullPath:function(){this.__P_38_1||(this.__P_38_1=this.getPath()+this.getName());return this.__P_38_1},getBusTopic:function(){return"cv.manager.fs."+this.getFullPath().replace(/\//g,".")},getUri:function(){return"cv://"+this.getFullPath()},getServerPath:function(){return qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/config/"+this.getFullPath()},sortElements:function(){this.getChildren().sort(function(e,t){return"dir"===e.getType()?"dir"===t.getType()?e.isTrash()?1:t.isTrash()?-1:e.getName().localeCompare(t.getName()):-1:"dir"===t.getType()?1:e.getName().localeCompare(t.getName())})},openPath:function(e){var t=qx.lang.Type.isArray(e)?e:e.split("/"),i=t.shift();this.getChildren().some(function(e){if(e.getName()===i){e.load(function(){e.setOpen(!0);t.length>0&&e.openPath(t)},this);return!0}},this)}},destruct:function(){this.__P_38_1=null}});cv.ui.manager.model.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.FileItem":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.BackupFolder",{extend:cv.ui.manager.model.FileItem,type:"singleton",construct:function(){cv.ui.manager.model.FileItem.constructor.call(this,"backup");this.load();qx.event.message.Bus.subscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)},members:{_onFilesSystemMessage:function(e){if(/^cv\.manager\.fs\.visu_config.*\.xml$/.test(e.getName())){var t=e.getData();["contentChanged","fsContentChanged"].includes(t.type)&&this.reload()}},getBackupFiles:function(e){var t=[];if("file"===e.getType()){var i=e.getFullPath().split("/");i.pop();var n=i.join("/"),a=e.getName().split("."),r=a.pop(),o=a.join("."),s=new RegExp(n+o+"-([\\d]{14})\\."+r);this.getChildren().filter(function(e){var i=s.exec(e.getFullPath().replace("backup/",""));i&&t.push({date:new Date(parseInt(i[1].substring(0,4)),parseInt(i[1].substring(4,6))-1,parseInt(i[1].substring(6,8)),parseInt(i[1].substring(8,10)),parseInt(i[1].substring(10,12)),parseInt(i[1].substring(12,14))),file:e})},this)}return t}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)}});cv.ui.manager.model.BackupFolder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.MenuBar":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.ActionDispatcher",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)},properties:{focusedWidget:{check:"cv.ui.manager.IActionHandler",nullable:!0,apply:"updateBarButtons"},main:{check:"cv.ui.manager.Main",nullable:!0}},members:{updateBarButtons:function(){var e,t=cv.ui.manager.MenuBar.getInstance(),i=t.getButtonConfiguration();Object.keys(i).forEach(function(n){(e=t.getButton(n))&&e.setEnabled(i[n].general||this.hasHandler(n))},this)},hasHandler:function(e){return!!this._getHandler(e)},_getHandler:function(e){var t=this.getFocusedWidget(),i=this.getMain();return t&&t.canHandleAction(e)?t:i&&i.canHandleAction(e)?i:void 0},_onAction:function(e){var t=e.getName().split(".").pop(),i=this._getHandler(t);i?i.handleAction(t,e.getData()):this.warn("no action handler found for action: "+t)}},destruct:function(){qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)}});cv.ui.manager.control.ActionDispatcher.$$dbClassInfo=e}();function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.data.Array":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.data.controller.List":{construct:!0},"cv.ui.manager.model.Message":{},"cv.ui.manager.snackbar.Message":{},"qx.ui.form.List":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Controller",{extend:qx.ui.core.Widget,type:"singleton",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox(8));this.initMessages(new qx.data.Array);qx.event.message.Bus.subscribe("cv.manager.msg.snackbar",this._onMessage,this);this._listController=new qx.data.controller.List(this.getMessages(),this.getChildControl("list"));this._initDelegate()},statics:{info:function(e){var t=new cv.ui.manager.model.Message;t.set({title:e});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)},error:function(e){var t=new cv.ui.manager.model.Message;"object"===_typeof(e)&&e.hasOwnProperty("statusText")&&(e=e.statusText);t.set({title:e,type:"error",sticky:!0});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)}},properties:{appearance:{refine:!0,init:"cv-snackbar"},messages:{check:"qx.data.Array",deferredInit:!0,event:"changeMessages"}},members:{_listController:null,_onMessage:function(e){var t=e.getData();if(t instanceof cv.ui.manager.model.Message){this.getMessages().push(t);this.show()}},_onCloseMessage:function(e){var t=e.getData();this.getMessages().remove(t);0===this.getMessages().length&&this.exclude()},_initDelegate:function(){this._listController.setDelegate({createItem:function(){var e=new cv.ui.manager.snackbar.Message;e.addListener("close",this._onCloseMessage,this);return e}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i)}})},_createChildControlImpl:function(e){var t;switch(e){case"list":t=new qx.ui.form.List;this._add(t,{flex:1})}return t||cv.ui.manager.snackbar.Controller.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.msg.snackbar",this._onMessage,this);this._disposeObjects("_listController")}});cv.ui.manager.snackbar.Controller.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.bom.Storage":{},"qx.util.Serializer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Preferences",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._restorePreferences()},properties:{defaultConfigEditor:{check:["source","xml"],init:"source",event:"changeDefaultConfigEditor",apply:"_savePreferences"},quickPreview:{check:"Boolean",init:!1,event:"changeQuickPreview",apply:"_savePreferences"},expertMode:{check:"Boolean",init:!1,event:"changeExpertMode",apply:"_savePreferences"},startViewMode:{check:["list","preview"],init:"preview",event:"changeStartViewMode",apply:"_savePreferences"}},members:{_savePreferences:function(){qx.bom.Storage.getLocal().setItem("preferences",qx.util.Serializer.toNativeObject(this))},_restorePreferences:function(){var e=qx.bom.Storage.getLocal();this.set(e.getItem("preferences"))}}});cv.ui.manager.model.Preferences.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.viewer.Image":{construct:!0},"cv.ui.manager.viewer.Config":{construct:!0},"cv.ui.manager.viewer.Icons":{construct:!0},"cv.ui.manager.viewer.Folder":{construct:!0},"cv.ui.manager.Start":{construct:!0},"cv.ui.manager.editor.Source":{construct:!0},"cv.ui.manager.editor.Xml":{construct:!0},"cv.ui.manager.model.CompareFiles":{construct:!0},"cv.ui.manager.editor.Diff":{construct:!0},"cv.ui.manager.editor.Config":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileHandlerRegistry",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_29_0={};this.__P_29_1=[];this.registerFileHandler(new RegExp(".("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i"),cv.ui.manager.viewer.Image,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Config.SUPPORTED_FILES,cv.ui.manager.viewer.Config,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Icons.SUPPORTED_FILES,cv.ui.manager.viewer.Icons,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Folder.SUPPORTED_FILES,cv.ui.manager.viewer.Folder,{type:"view"});this.registerFileHandler(null,cv.ui.manager.Start,{type:"view"});this.registerFileHandler(cv.ui.manager.editor.Source.SUPPORTED_FILES,cv.ui.manager.editor.Source,{type:"edit"});this.registerFileHandler(cv.ui.manager.editor.Xml.SUPPORTED_FILES,cv.ui.manager.editor.Xml,{preview:!1,type:"edit",noTemporaryFiles:!0,noReadOnlyFiles:!0});this.registerFileHandler(cv.ui.manager.model.CompareFiles,cv.ui.manager.editor.Diff,{type:"view"});this.registerFileHandler("hidden.php",cv.ui.manager.editor.Config,{type:"edit"});cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this);this._onChangesDefaultConfigEditor()},members:{__P_29_0:null,__P_29_1:null,registerFileHandler:function(e,t,i){var n=Object.assign({Clazz:t,instance:null},i||{});if(qx.Class.isClass(e)){n.instanceOf=e;n.selectorId="instanceOf:"+e.classname;n.priority=0}else if(qx.lang.Type.isRegExp(e)){n.regex=e;n.selectorId="regex:"+e.toString();n.priority=4}else if(qx.lang.Type.isFunction(e)){n.selectorId="function:"+e.name;n.priority=3;n.function=e}else if(qx.lang.Type.isString(e))if(e.includes("/")){n.fullPath=e;n.selectorId="fullPath:"+e;n.priority=1}else{n.fileName=e;n.selectorId="fileName:"+e;n.priority=2}else{n.selectorId="none";n.priority=10}this.__P_29_0[t.classname]=n},getFileHandler:function(e,t){var i=[];if(!(e instanceof cv.ui.manager.model.CompareFiles)){var n;Object.keys(this.__P_29_1).some(function(i){if(this.__P_29_1[i].regex.test(e.getFullPath())&&(!e.isTemporary()||!this.__P_29_1[i].noTemporaryFiles)&&(e.isWriteable()||!this.__P_29_1[i].noReadOnlyFiles)){if(t){var a=this.getFileHandlerById(this.__P_29_1[i].clazz.classname);a.type===t&&(n=a)}else n=this.getFileHandlerById(this.__P_29_1[i].clazz.classname);return!!n}},this);if(n)return n}Object.keys(this.__P_29_0).forEach(function(n){var a=this.__P_29_0[n];!this.__P_29_2(a,e)||t&&a.type!==t||i.push(a)},this);if(0===i.length)return e.isFake()||1!==e.getDisplayName().split(".").length?null:this.getFileHandlerById("cv.ui.manager.editor.Source");if(1===i.length)return i[0];i.sort(function(e,t){return e.priority-t.priority});return i[0]},getFileHandlerById:function(e){return this.__P_29_0[e]},hasFileHandler:function(e,t){return Object.keys(this.__P_29_0).some(function(i){var n=this.__P_29_0[i];return this.__P_29_2(n,e)&&(!t||n.type===t)},this)},setDefault:function(e,t,i,n){this.__P_29_1[e.toString()]={regex:e,clazz:t,noTemporaryFiles:i,noReadOnlyFiles:n}},_onChangesDefaultConfigEditor:function(){switch(cv.ui.manager.model.Preferences.getInstance().getDefaultConfigEditor()){case"source":this.setDefault(cv.ui.manager.editor.Source.DEFAULT_FOR,cv.ui.manager.editor.Source);break;case"xml":this.setDefault(cv.ui.manager.editor.Xml.SUPPORTED_FILES,cv.ui.manager.editor.Xml,!0,!0)}},__P_29_2:function(e,t){return(!0!==e.noTemporaryFiles||!t.isTemporary())&&(!(!0===e.noReadOnlyFiles&&!t.isWriteable())&&(!(!e.fileName||t.getName()!==e.fileName)||(!(!e.fullPath||t.getFullPath()!==e.fullPath)||(!(!e.regex||!e.regex.test(t.getFullPath().toLowerCase()))||(!!(e.instanceOf&&t instanceof e.instanceOf)||!(!e.function||!e.function(t)))))))},getAllFileHandlers:function(e,t){return Object.keys(this.__P_29_0).filter(function(i){return this.__P_29_2(this.__P_29_0[i],e)&&(!t||this.__P_29_0[i].type===t)},this).map(function(e){return this.__P_29_0[e]},this)}},destruct:function(){Object.keys(this.__P_29_0).forEach(function(e){if(this.__P_29_0[e].instance){this.__P_29_0[e].instance.dispose();this.__P_29_0[e].instance=null}},this);cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this)}});cv.ui.manager.control.FileHandlerRegistry.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.editor.IEditor",{properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_loadFile"},external:{check:"Boolean",init:!1}},statics:{TITLE:""},members:{save:function(){},getCurrentContent:function(){}}});cv.ui.manager.editor.IEditor.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.io.rest.Client":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"qx.lang.Function":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.AbstractEditor",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._initClient()},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,apply:"_loadFile"},content:{nullable:!0,event:"changeContent",apply:"_applyContent"},handlerOptions:{check:"Map",nullable:!0},external:{check:"Boolean",init:!1}},members:{_handledActions:null,canHandleAction:function(e){return!("save"===e&&this.getFile()&&!this.getFile().isWriteable())&&(this._handledActions&&this._handledActions.includes(e))},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"save":this.save()}},_initClient:function(){this._client=cv.io.rest.Client.getFsClient()},_loadFile:function(e,t){t&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e&&"file"===e.getType()){null!==e.getContent()?this.setContent(e.getContent()):this._loadFromFs();qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else this.resetContent()},_loadFromFs:function(){this._client.readSync({path:this.getFile().getFullPath()},function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setContent(t)},this)},_onChange:function(e){var t=e.getData();"fsContentChanged"===t.type&&t.source!==this&&this.setContent(t.data)},_applyContent:function(){},getCurrentContent:function(){},_handleSaveResponse:function(e,t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{var i=this.getFile(),n="created"===e?this.tr("File has been created"):this.tr("File has been saved");cv.ui.manager.snackbar.Controller.info(n);this._onSaved();qx.event.message.Bus.dispatchByName(i.getBusTopic(),{type:e,file:i,data:this.getCurrentContent(),source:this})}},save:function(e,t){var i=this.getFile();i.isModified()&&(i.isTemporary()?this._client.createSync({path:i.getFullPath(),hash:t||i.getHash(),type:"file"},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"created"),this):this._client.updateSync({path:i.getFullPath(),hash:t||i.getHash()},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"contentChanged"),this))},_onSaved:function(){var e=this.getFile();e.resetModified();e.resetTemporary()}},destruct:function(){this._client&&(this._client=null)}});cv.ui.manager.editor.AbstractEditor.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"cv.ui.manager.control.ActionDispatcher":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.GlobalState",{extend:qx.core.Object,type:"singleton",properties:{openedFocusedFile:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeOpenedFocusedFile",apply:"_applyFile"}},members:{_applyFile:function(){cv.ui.manager.control.ActionDispatcher.getInstance().updateBarButtons()}}});cv.ui.manager.core.GlobalState.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.OpenFile",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);e&&this.setFile(e);t&&this.setHandlerId(t)},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeFile",apply:"_applyFile"},handlerId:{check:"!!qx.Class.getByName(value)",nullable:!0,apply:"_maintainIcon"},handlerOptions:{check:"Map",nullable:!0},permanent:{check:"Boolean",init:!1,event:"changePermanent"},icon:{check:"String",init:"",event:"changeIcon"},closeable:{check:"Boolean",init:!0,event:"changeCloseable"}},members:{__P_39_0:null,_applyFile:function(e,t){if(t){t.removeListener("changeModified",this._maintainPermanent,this);t.removeRelatedBindings(this);this.__P_39_0=null}e&&e.addListener("changeModified",this._maintainPermanent,this);this._maintainIcon()},_maintainIcon:function(){var e=this.getFile();if(this.getHandlerId()&&e){var t=qx.Class.getByName(this.getHandlerId());if(t&&t.ICON){this.setIcon(t.ICON);if(this.__P_39_0){e.removeBinding(this.__P_39_0);this.__P_39_0=null}}else this.__P_39_0=e.bind("icon",this,"icon")}else this.resetIcon()},_maintainPermanent:function(){this.getFile().isModified()&&!this.isPermanent()&&this.setPermanent(!0)}}});cv.ui.manager.model.OpenFile.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.CompareFiles",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setOriginalFile(e);this.setModifiedFile(t)},properties:{originalFile:{check:"cv.ui.manager.model.FileItem",event:"changeOriginal"},modifiedFile:{check:"cv.ui.manager.model.FileItem",event:"changeModifiedFile",apply:"_applyModifiedFile"},permanent:{check:"Boolean",init:!0},name:{check:"String",init:"",event:"changeName"},type:{check:"String",init:"file"},modified:{check:"Boolean",init:!1,event:"changeModified"}},members:{isRelated:function(e){return this.getOriginalFile().getFullPath()===e||this.getModifiedFile().getFullPath()===e},isConfigFile:function(){return this.getModifiedFile().isConfigFile()},getFullPath:function(){return this.getOriginalFile().getFullPath()},_applyModifiedFile:function(){this.setName(qx.locale.Manager.tr("Diff: %1",this.getModifiedFile().getName()))},getParent:function(){return this.getModifiedFile().getParent()},isWriteable:function(){return this.getModifiedFile().isWriteable()},isTrash:function(){return this.getModifiedFile().isTrash()},isInTrash:function(){return this.getModifiedFile().isInTrash()},isFake:function(){return this.getModifiedFile().isFake()},isTemporary:function(){return this.getModifiedFile().isTemporary()||this.getOriginalFile().isTemporary()},isMounted:function(){return this.getModifiedFile().isMounted()||this.getOriginalFile().isMounted()},getUri:function(){return"cv://"+this.getOriginalFile().getFullPath()+"+"+this.getModifiedFile().getFullPath()}}});cv.ui.manager.model.CompareFiles.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"qx.event.message.Bus":{},"dialog.Dialog":{},"cv.ui.manager.editor.Worker":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileController",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_28_0=cv.io.rest.Client.getFsClient()},members:{__P_28_0:null,rename:function(e,t){var i=e.getPath()||"";i.length>0&&!i.endsWith("/")&&(i+="/");i+=t;e.isTemporary()?this.__P_28_0.createSync({path:i,type:e.getType()},function(i){if(i)cv.ui.manager.snackbar.Controller.error(i);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been created',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been created',e.getDisplayName()));e.resetTemporary();e.resetModified();e.setName(t);e.reload()}},this):e.getFullPath()!==i&&this.__P_28_0.moveSync({src:e.getFullPath(),target:i},function(i){if(i)cv.ui.manager.snackbar.Controller.error(i);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been renamed',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been renamed',e.getDisplayName()));e.setName(t);e.resetModified();e.reload()}e.resetEditing()},this)},move:function(e,t){this.__P_28_0.moveSync({src:e.getFullPath(),target:t},function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been moved',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been moved',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"moved",path:e.getFullPath()})}},this)},restore:function(e){if(e.isInTrash()){var t=e.getFullPath().replace(".trash/","");this.__P_28_1(e,t)}else if("file"===e.getType()&&!e.isTemporary()){var i=/^\/?backup\/visu_config(.*)-[0-9]{14}\.xml$/.exec(e.getFullPath());if(i){var n="visu_config"+i[1]+".xml",a=null;e.getParent().getParent().getChildren().some(function(e){if(e.getFullPath()===n){a=e;return!0}});this.__P_28_0.readSync({path:e.getFullPath()},function(t,i){t?cv.ui.manager.snackbar.Controller.error(t):a?this.__P_28_0.updateSync({path:a.getFullPath(),hash:"ignore"},i,function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()));a.resetModified();a.resetTemporary();qx.event.message.Bus.dispatchByName(a.getBusTopic(),{type:"fsContentChanged",data:i,source:this})}},this):this.__P_28_0.createSync({path:n,hash:"ignore"},i,function(t){t?cv.ui.manager.snackbar.Controller.error(t):cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()))},this)},this)}}},__P_28_1:function(e,t){this.__P_28_0.moveSync({src:e.getFullPath(),target:t},function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been restored',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been restored',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"restored",path:e.getFullPath()})}},this)},delete:function(e,t,i){if(e.isTemporary())t&&t.apply(i,!0);else if(e){var n;n=e.isTrash()?qx.locale.Manager.tr("Do you really want to clear the trash?"):e.isInTrash()?"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1" from the trash?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1" from the trash?',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1"?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1"?',e.getDisplayName());dialog.Dialog.confirm(n,function(n){n?this.__P_28_2(e,t,i):t&&t.apply(i,!1)},this,qx.locale.Manager.tr("Confirm deletion"))}},__P_28_2:function(e,t,i){this.__P_28_0.deleteSync({path:e.getFullPath(),force:e.isTrash()},null,function(n){if(n){cv.ui.manager.snackbar.Controller.error(n);t&&t.apply(i,!1)}else{var a;a=e.isTrash()?qx.locale.Manager.tr("Trash has been cleared"):e.isInTrash()?"file"===this.getType()?qx.locale.Manager.tr('File "%1" has been removed from trash',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been removed from trash',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('File "%1" has been deleted',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been deleted',e.getDisplayName());cv.ui.manager.snackbar.Controller.info(a);t&&t.apply(i,!0);qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:e.getFullPath()})}},this)},download:function(e){if("file"===e.getType()){var t=document.createElement("a");t.setAttribute("href",cv.io.rest.Client.getBaseUrl()+"/fs?download=true&path="+e.getFullPath());t.style.display="none";document.body.appendChild(t);t.click();document.body.removeChild(t)}},validate:function(e){e.isConfigFile()?this.__P_28_3(e):this.info("no validation available for file: "+e.getFullPath())},__P_28_3:function(e){var t=dialog.Dialog.alert(qx.locale.Manager.tr("Validating %1",e.getFullPath()));cv.ui.manager.editor.Worker.getInstance().validateConfig(e).then(function(i){t.close();if(!0===i){e.setValid(!0);cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has no errors!",e.getFullPath()))}else{e.setValid(!1);qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:e,handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}});cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.trn("%1 error found in %2!","%1 errors found in %2!",i.length,i.length,e.getFullPath()))}}.bind(this))}},destruct:function(){this.__P_28_0=null}});cv.ui.manager.control.FileController.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menubar.MenuBar":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.ui.core.Spacer":{},"qx.ui.form.RadioGroup":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"qx.ui.menu.RadioButton":{},"qx.ui.menu.CheckBox":{},"cv.ui.manager.model.Preferences":{},"qx.ui.menu.Button":{},"qx.lang.Type":{},"qx.event.message.Bus":{},"qx.ui.menu.Separator":{},"qx.ui.basic.Label":{},"qx.ui.menubar.Button":{},"qx.ui.menu.Menu":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.MenuBar",{extend:qx.ui.menubar.MenuBar,type:"singleton",construct:function(){qx.ui.menubar.MenuBar.constructor.call(this);this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this.__P_25_0={};this._draw()},members:{_commandGroup:null,__P_25_0:null,__P_25_1:null,__P_25_2:null,_draw:function(){this._createChildControl("file");this._createChildControl("edit");this._createChildControl("preferences");this.add(new qx.ui.core.Spacer,{flex:1});this._createChildControl("title");this.add(new qx.ui.core.Spacer,{flex:1});var e=new qx.ui.form.RadioGroup;this.__P_25_1={"new-file":{menu:"new-menu",args:[this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18),this._commandGroup.get("new-file")],enabled:!0},"new-folder":{menu:"new-menu",args:[this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18),this._commandGroup.get("new-folder")],enabled:!0,separator:"after"},"new-config-file":{menu:"new-menu",args:[this.tr("New config file")],enabled:!0},upload:{menu:"file-menu",clazz:com.zenesis.qx.upload.UploadMenuButton,args:[this.tr("Upload file"),cv.theme.dark.Images.getIcon("upload",18)],enabled:!0,separator:"before"},save:{menu:"file-menu",args:[this.tr("Save"),cv.theme.dark.Images.getIcon("save",18),this._commandGroup.get("save")],enabled:!1,separator:"before"},"save-as":{menu:"file-menu",args:[this.tr("Save as..."),null,this._commandGroup.get("save-as")],enabled:!1},delete:{args:[this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18),this._commandGroup.get("delete")],enabled:!1,hidden:!0},quit:{menu:"file-menu",args:[this.tr("Quit"),cv.theme.dark.Images.getIcon("quit",18),this._commandGroup.get("quit")],enabled:!0,separator:"before"},undo:{menu:"edit-menu",args:[this.tr("Undo"),cv.theme.dark.Images.getIcon("undo",18),this.tr("Ctrl+Z")],enabled:!0},redo:{menu:"edit-menu",args:[this.tr("Redo"),cv.theme.dark.Images.getIcon("redo",18),this.tr("Ctrl+Y")],enabled:!0},cut:{menu:"edit-menu",args:[this.tr("Cut"),null,this.tr("Ctrl+X")],enabled:!1,separator:"before"},copy:{menu:"edit-menu",args:[this.tr("Copy"),null,this.tr("Ctrl+C")],enabled:!1},paste:{menu:"edit-menu",args:[this.tr("Paste"),null,this.tr("Ctrl+V")],enabled:!1},"source-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use text editor")],general:!0,enabled:!0,properties:{model:"source",group:e}},"xml-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use xml editor")],general:!0,enabled:!0,properties:{model:"xml",group:e}},"quick-preview":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Enable quick preview")],general:!0,enabled:!0,separator:"before"},"expert-mode":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Expert mode")],general:!0,enabled:!0}};this.maintainButtons();var t=cv.ui.manager.model.Preferences.getInstance();t.bind("defaultConfigEditor",e,"modelSelection",{converter:function(e){return[e]}});e.getModelSelection().addListener("change",function(){t.setDefaultConfigEditor(e.getModelSelection().getItem(0))},this);this.__P_25_3("quick-preview","quickPreview");this.__P_25_3("expert-mode","expertMode")},__P_25_3:function(e,t){var i=this.getButton(e),n=cv.ui.manager.model.Preferences.getInstance();n.bind(t,i,"value");i.bind("value",n,t)},maintainButtons:function(e){if(e){e=Object.merge(this.__P_25_1,e);this.__P_25_2=e}else e=this.__P_25_1;Object.keys(e).forEach(function(t){var i,n=e[t];if(this.__P_25_0.hasOwnProperty(t))i=this.__P_25_0[t];else{var a=n.args[0],r=n.args[1],o=n.args[2],s=n.clazz||qx.ui.menu.Button;if(qx.lang.Type.isString(o)||!o){i=new s(a,r);o&&i.getChildControl("shortcut").setValue(o)}else i=new s(a,r,o);i.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action."+t)},this);if(!n.hidden){var l=this.getChildControl(n.menu);if(!l)throw new Error("no menu named "+n.menu+" found!");"before"===n.separator&&l.add(new qx.ui.menu.Separator);l.add(i);"after"===n.separator&&l.add(new qx.ui.menu.Separator)}this.__P_25_0[t]=i;n.hasOwnProperty("onAfterCreate")&&n.onAfterCreate(i)}i.setEnabled(n.enabled);n.properties&&i.set(n.properties)},this)},getButton:function(e){return this.__P_25_0[e]},getButtonConfiguration:function(){return this.__P_25_2||this.__P_25_1},_createChildControlImpl:function(e){var t;switch(e){case"title":t=new qx.ui.basic.Label(this.tr("CometVisu Manager"));this.add(t);break;case"file":t=new qx.ui.menubar.Button(this.tr("File"),null,this.getChildControl("file-menu"));this.add(t);break;case"edit":t=new qx.ui.menubar.Button(this.tr("Edit"),null,this.getChildControl("edit-menu"));this.add(t);break;case"new":t=new qx.ui.menu.Button(this.tr("New"),null,null,this.getChildControl("new-menu"));break;case"preferences":t=new qx.ui.menubar.Button(this.tr("Preferences"),null,this.getChildControl("preferences-menu"));this.add(t);break;case"new-menu":t=new qx.ui.menu.Menu;break;case"file-menu":(t=new qx.ui.menu.Menu).add(this.getChildControl("new"));break;case"edit-menu":case"preferences-menu":t=new qx.ui.menu.Menu}return t||cv.ui.manager.MenuBar.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._commandGroup=null}});cv.ui.manager.MenuBar.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"com.zenesis.qx.upload.UploadMgr":{construct:!0,require:!0},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"dialog.Dialog":{},"qx.lang.Json":{},"qx.event.message.Bus":{},"com.zenesis.qx.upload.File":{},"com.zenesis.qx.upload.UploadButton":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.upload.UploadMgr",{extend:com.zenesis.qx.upload.UploadMgr,construct:function(e,t){com.zenesis.qx.upload.UploadMgr.constructor.call(this,e,t);this._init()},statics:{LAST_ID:0},properties:{multiple:{refine:!0,init:!1},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_updateUploadUrl"},filename:{check:"String",nullable:!0},force:{check:"Boolean",init:!1}},members:{_updateUploadUrl:function(){var e=this.getFolder(),t=e?e.getFullPath():".",i=cv.io.rest.Client.getBaseUrl()+"/fs?type=file&path="+t;this.setUploadUrl(i)},_init:function(){this.addListener("addFile",function(e){var t=e.getData(),i=this.getFilename();i&&t.setParam("filename",i);this.isForce()&&t.setParam("force",!0);var n=t.addListener("changeProgress",function(e){var t=e.getTarget(),i=e.getData();this.debug("Upload "+t.getFilename()+": "+i+" / "+t.getSize()+" - "+Math.round(i/t.getSize()*100)+"%")},this),a=t.addListener("changeState",function(e){var t=e.getData(),i=e.getTarget();if("uploading"===t)this.debug(i.getFilename()+" (Uploading...)");else if("uploaded"===t){this.debug(i.getFilename()+" (Complete)");if(200!==i.getStatus())switch(i.getStatus()){case 406:this.isForce()?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Replacing the file failed.")):dialog.Dialog.confirm(qx.locale.Manager.tr("This file already exists, do you want to replace it?"),function(e){e&&this.forceUpload(i)},this,qx.locale.Manager.tr("File already exists"));break;case 403:cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Uploading this file is not allowed here."));break;default:var r=i.getResponse();try{r=qx.lang.Json.parse(r).message}catch(e){}this.error(r);cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("File upload stopped with an error: %1",r))}else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("File has been uploaded"));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"uploaded",path:this.getFolder().getFullPath()+"/"+i.getFilename()})}}else"cancelled"===t&&this.debug(i.getFilename()+" (Cancelled)");if("uploaded"===t||"cancelled"===t){i.removeListenerById(n);i.removeListenerById(a)}},this)},this)},_getUniqueFileId:function(){return++cv.ui.manager.upload.UploadMgr.LAST_ID},forceUpload:function(e){this.setForce(!0);var t=new com.zenesis.qx.upload.File(e.getBrowserObject(),e.getFilename(),e.getId());t.set({size:e.getSize(),uploadWidget:e.getUploadWidget()});t.setParam("force",!0);this.getUploadHandler()._addFile(t);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},uploadFile:function(e){var t="upload-"+this._getUniqueFileId(),i=void 0!==e.name?e.name:e.fileName,n=new com.zenesis.qx.upload.File(e,i,t),a=void 0!==e.size?e.size:e.fileSize;n.setSize(a);this.isForce()&&n.setParam("force",!0);n.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(n);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},replaceFile:function(e,t){this.setFolder(t.getParent());var i="upload-"+this._getUniqueFileId(),n=t.getName(),a=new com.zenesis.qx.upload.File(e,n,i);a.setParam("force",!0);a.setParam("filename",n);var r=void 0!==e.size?e.size:e.fileSize;a.setSize(r);a.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(a);this.getAutoUpload()&&this.getUploadHandler().beginUploads()}}});cv.ui.manager.upload.UploadMgr.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.tree.FileSystem":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.container.Composite":{},"qx.ui.basic.Atom":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.upload.MDragUpload",{construct:function(){this.setDroppable(!0);this.getBounds()?this._applyStartDragListeners():this.addListenerOnce("appear",function(){this._applyStartDragListeners()},this);var e=this._getLayout();e instanceof qx.ui.layout.Grow||e instanceof qx.ui.layout.Canvas||this.addListener("resize",this.__P_42_0,this)},properties:{uploadMode:{check:"Boolean",init:!1,apply:"__P_42_1"},uploadHint:{check:"String",init:""}},statics:{onHtml5Drop:function(e){e.preventDefault();this.getFiles(e).forEach(this.uploadFile,this)},uploadFile:function(e,t){var i;cv.ui.manager.model.FileItem.isConfigFile(e.name)?i=new cv.ui.manager.model.FileItem("."):cv.ui.manager.tree.FileSystem.isAccepted(e.type)&&(i=new cv.ui.manager.model.FileItem("media"));if(i){i.set({type:"dir"});var n=new cv.ui.manager.upload.UploadMgr;if(t)n.replaceFile(e,t);else{n.setFolder(i);n.uploadFile(e)}}},hasDroppableFile:function(e){return this.getFiles(e).length>0},getFiles:function(e){var t,i,n,a=[];if(e.dataTransfer.items)for(t=0,i=e.dataTransfer.items.length;t<i;t++){var r=e.dataTransfer.items[t];if("file"===r.kind&&cv.ui.manager.tree.FileSystem.isAccepted(r.type)){n=r.getAsFile();a.push(n)}}else for(t=0,i=e.dataTransfer.files.length;t<i;t++){n=e.dataTransfer.files[t];cv.ui.manager.tree.FileSystem.isAccepted(n.type)&&a.push(n)}return a}},members:{__P_42_2:null,_boundOnStop:null,__P_42_0:function(){var e=this.getBounds();this.getChildControl("upload-overlay").setUserBounds(e.left,e.top,e.width,e.height);this.getChildControl("upload-dropbox").setUserBounds(e.left,e.top,e.width,e.height)},_createMDragUploadChildControlImpl:function(e){var t,i=this.getBounds(),n=this._getLayout();switch(e){case"upload-overlay":(t=new qx.ui.container.Composite).setZIndex(1e6);t.exclude();n instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!i||t.setUserBounds(i.left,i.top,i.width,i.height);this._add(t);this.getChildControl("upload-dropbox").bind("visibility",t,"visibility");break;case"upload-dropbox":(t=new qx.ui.container.Composite(new qx.ui.layout.Grow)).setBackgroundColor("rgba(32, 32, 32, 0.9)");t.setZIndex(1e3);var a=new qx.ui.basic.Atom(this.getUploadHint(),cv.theme.dark.Images.getIcon("upload",32));a.set({iconPosition:"top",rich:!0,center:!0});a.getChildControl("label").setWrap(!0);t.setAnonymous(!0);t.add(a);t.exclude();n instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!i||t.setUserBounds(i.left,i.top,i.width,i.height);this._add(t)}return t},_onStopDragging:function(e){e.preventDefault();this.setUploadMode(!1);document.removeEventListener("dragend",this._boundOnStop,!1)},_applyStartDragListeners:function(){this.getContentElement().getDomElement().addEventListener("dragenter",function(e){this._isDroppable?this._isDroppable(e.dataTransfer.items)&&this.setUploadMode(!0):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&this.setUploadMode(!0)}.bind(this),!1);this.getChildControl("upload-overlay").getBounds()?this._applyDragListeners():this.getChildControl("upload-overlay").addListenerOnce("appear",function(){this._applyDragListeners()},this)},_applyDragListeners:function(){var e=this.getChildControl("upload-overlay").getContentElement().getDomElement();if(e){e.addEventListener("dragexit",function(){this.setUploadMode(!1)}.bind(this),!1);e.addEventListener("dragover",function(e){e.preventDefault();var t=!1;this._isDroppable?t=this._isDroppable(e.dataTransfer.items):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&(t=!0);this.setUploadMode(t)}.bind(this),!1);this._boundOnStop=this._onStopDragging.bind(this);e.addEventListener("dragleave",this._boundOnStop,!1);e.addEventListener("dragend",function(){this.setUploadMode(!1)}.bind(this),!1);document.addEventListener("dragend",this._boundOnStop,!1);this._onDrop?e.addEventListener("drop",this._onDrop.bind(this),!1):e.addEventListener("drop",function(e){cv.ui.manager.upload.MDragUpload.onHtml5Drop(e);this._onStopDragging(e)}.bind(this),!1)}else var t=this.getChildControl("upload-overlay").addListener("visibility",function(e){if("visible"===e.getData()){this._applyDragListeners();this.getChildControl("upload-overlay").removeListenerById(t)}},this)},__P_42_1:function(e){if(!0===e){this.getChildControl("upload-dropbox").show();if(this.hasChildControl("empty-info")&&this.getChildControl("empty-info").isVisible()){this.getChildControl("empty-info").exclude();this.__P_42_2=!0}else this.__P_42_2=!1}else{this.getChildControl("upload-dropbox").exclude();!0===this.__P_42_2&&this.getChildControl("empty-info").show()}}}});cv.ui.manager.upload.MDragUpload.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.Timer":{},"cv.ui.manager.tree.VirtualFsItem":{},"qx.ui.tree.VirtualTree":{},"cv.ui.manager.model.Preferences":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.FileSystem",{extend:qx.ui.core.Widget,include:[cv.ui.manager.upload.MDragUpload],construct:function(e){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this.setRootFolder(e);qx.event.message.Bus.subscribe("cv.manager.tree.enable",this._onEnableTree,this)},statics:{MIMETYPES:{"text/xml":"xml","application/xml":"xml","text/javascript":"js","application/x-httpd-php":"php","text/css":"css","image/png":"png","image/svg+xml":"svg","text/plain":""},getMimetypeFromSuffix:function(e){return Object.keys(this.MIMETYPES).find(function(t){return this.MIMETYPES[t]===e},this)},isAccepted:function(e){return this.MIMETYPES.hasOwnProperty(e)}},events:{changeSelection:"qx.event.type.Data"},properties:{rootFolder:{check:"cv.ui.manager.model.FileItem",apply:"_applyRootFolder"},selectedNode:{check:"cv.ui.manager.model.FileItem",apply:"_applySelectedNode",nullable:!0}},members:{__P_40_0:null,__P_40_1:500,__P_40_2:!1,_replacementManager:null,reload:function(){var e=this.getChildControl("tree"),t=e.getOpenNodes().map(function(e){return e.getFullPath()}),i=e.getModel();i.reload(function(){this.getChildControl("tree").refresh();i.setOpen(!0);t.forEach(this.openPath,this)},this)},openPath:function(e){var t=this.getChildControl("tree").getModel();if("."===e)t.setOpen(!0);else{t.setOpen(!0);t.openPath(e)}},refresh:function(){this.getChildControl("tree").refresh()},_applyRootFolder:function(e){if(e){var t=this.getChildControl("tree");t.setModel(e);e.load(function(){t.setHideRoot(!0)},this)}},_applySelectedNode:function(e){var t=this.getChildControl("tree"),i=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();i.configure(e);e&&t.setContextMenu(i)},setSelection:function(e){this.getChildControl("tree").getSelection().replace([e])},_onDblTapTreeSelection:function(){var e=this.getSelectedNode();if(e){this.__P_40_0&&this.__P_40_0.stop();"file"===e.getType()&&this.fireDataEvent("changeSelection",{node:e,mode:"dbltap"})}},_onChangeTreeSelection:function(){this.__P_40_0&&this.__P_40_0.stop();if(!0!==this.__P_40_2){var e=this.getChildControl("tree"),t=e.getSelection();if(t.length>0){var i=t.getItem(0);this.setSelectedNode(i);"file"===i.getType()?this.__P_40_0=qx.event.Timer.once(function(){this.fireDataEvent("changeSelection",{node:this.getSelectedNode(),mode:"tap"});this.__P_40_0=null},this,this.__P_40_1):this.fireDataEvent("changeSelection",{node:i,mode:"tap"})}else{e.resetContextMenu();this.resetSelectedNode()}}},_onFsItemRightClick:function(e){var t=this.getChildControl("tree"),i=e.getTarget();if(i instanceof cv.ui.manager.tree.VirtualFsItem){var n=i.getModel();if(n){this.__P_40_2=!0;t.getSelection().replace([n]);this.setSelectedNode(n);this.fireDataEvent("changeSelection",{node:n,mode:"contextmenu"});this.__P_40_2=!1}}},_onEnableTree:function(e){this.getChildControl("tree").setEnabled(e.getData())},_createChildControlImpl:function(e){var t;switch(e){case"tree":(t=new qx.ui.tree.VirtualTree(null,"name","children")).set({selectionMode:"single",minWidth:250});cv.ui.manager.model.Preferences.getInstance().bind("quickPreview",t,"openMode",{converter:function(e){return e?"tap":"dbltap"}});t.setDelegate({createItem:function(){var e=new cv.ui.manager.tree.VirtualFsItem;e.addListener("dbltap",this._onDblTapTreeSelection,this);e.addListener("contextmenu",this._onFsItemRightClick,this);return e}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i);e.bindPropertyReverse("open","open",null,t,i);e.bindProperty("open","open",null,t,i);e.bindProperty("readable","enabled",null,t,i);e.bindProperty("icon","icon",null,t,i);e.bindProperty("editing","editing",null,t,i)}});t.getSelection().addListener("change",this._onChangeTreeSelection,this);this._add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.tree.FileSystem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.tree.enable",this._onEnableTree,this);this._disposeObjects("_dateFormat","_timeFormat","_replacementManager")}});cv.ui.manager.tree.FileSystem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.toolbar.ToolBar":{construct:!0,require:!0},"cv.ui.manager.MenuBar":{construct:!0},"cv.ui.manager.upload.UploadMgr":{},"cv.ui.manager.control.FileController":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.MenuButton":{},"cv.theme.dark.Images":{},"cv.ui.manager.model.FileItem":{},"qx.event.message.Bus":{},"qx.ui.toolbar.Button":{},"qx.locale.Manager":{},"qx.ui.core.Spacer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.ToolBar",{extend:qx.ui.toolbar.ToolBar,construct:function(e,t){qx.ui.toolbar.ToolBar.constructor.call(this);t&&(this.__P_27_0=t);this._menuBar=cv.ui.manager.MenuBar.getInstance();this._menuButtonConfig=this._menuBar.getButtonConfiguration();this._uploadManager=e;this._init()},events:{reload:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-toolbar"},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFolder",event:"changeFolder"},file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"}},members:{_menuButtonConfig:null,_uploadManager:null,_menuBar:null,__P_27_0:null,__P_27_1:function(e){return null===this.__P_27_0||this.__P_27_0.includes(e)},_init:function(){this._uploadManager||(this._uploadManager=new cv.ui.manager.upload.UploadMgr);var e,t=cv.ui.manager.control.FileController.getInstance(),i=new qx.ui.toolbar.Part;i.set({marginLeft:0});this.add(i);if(this.__P_27_1("new-menu")){e=new qx.ui.toolbar.MenuButton(null,cv.theme.dark.Images.getIcon("new-file",15),this._menuBar.getChildControl("new-menu"));this.bind("folder.writeable",e,"enabled");i.add(e)}else{if(this.__P_27_1("new-config-file")){e=this._createButton("new-config-file",cv.theme.dark.Images.getIcon("new-file",15));this.bind("folder.writeable",e,"enabled");this.bind("folder",e,"visibility",{converter:function(e){return e===cv.ui.manager.model.FileItem.ROOT?"visible":"excluded"}});e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",this.getFolder())},this);i.add(e)}else if(this.__P_27_1("new-file")){e=this._createButton("new-file",null,!0);this.bind("folder.writeable",e,"enabled");e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-file",this.getFolder())},this);i.add(e)}if(this.__P_27_1("new-folder")){e=this._createButton("new-folder",cv.theme.dark.Images.getIcon("new-folder",15),!0);this.bind("folder.writeable",e,"enabled");e.addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder",this.getFolder())},this);i.add(e)}}if(this.__P_27_1("upload")){var n=this._createButton("upload");this._uploadManager.addWidget(n);this.bind("folder.writeable",n,"enabled");i.add(n)}if(this.__P_27_1("delete")){var a=this._createButton("delete");a.addListener("execute",function(){t.delete(this.getFile())},this);this.bind("file",a,"enabled",{converter:function(e){return!!e&&e.isWriteable()&&!e.isFake()}});this.add(a)}if(this.__P_27_1("download")){var r=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("download",15));r.setAppearance("cv-toolbar-button");r.setToolTipText(qx.locale.Manager.tr("Download"));r.addListener("execute",function(){t.download(this.getFile())},this);this.bind("file",r,"enabled",{converter:function(e){return!!e&&"file"===e.getType()&&!e.isFake()}});i.add(r)}if(this.__P_27_1("validate")){var o=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("validate",15));o.setAppearance("cv-toolbar-button");o.setToolTipText(qx.locale.Manager.tr("Validate"));o.addListener("execute",function(){t.validate(this.getFile())},this);this.bind("file",o,"enabled",{converter:function(e){return!!e&&e.isConfigFile()}});this.add(o)}if(this.__P_27_1("reload")){var s=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("reload",15));s.setAppearance("cv-toolbar-button");s.setToolTipText(qx.locale.Manager.tr("Reload"));s.addListener("execute",function(){this.fireEvent("reload")},this);this.add(new qx.ui.core.Spacer,{flex:1});this.add(s)}},_createButton:function(e,t,i){var n=this._menuButtonConfig[e].args,a=new qx.ui.toolbar.Button(null,t||n[1].replace(/\/[0-9]+$/,"/15"),i?null:n[2]);a.setAppearance("cv-toolbar-button");a.setToolTipText(n[0]);return a},_applyFile:function(){},_applyFolder:function(e){this._uploadManager&&(e?this._uploadManager.setFolder(e):this._uploadManager.resetFolder())}},destruct:function(){this._menuButtonConfig=null;this._uploadManager=null;this.__P_27_2=null}});cv.ui.manager.ToolBar.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileTabItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox);this._createChildControl("icon");this._createChildControl("label");this._createChildControl("close");this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this)},events:{close:"qx.event.type.Data",action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"open-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0},label:{check:"String",nullable:!0,transform:"_transformFilename",event:"changeLabel",apply:"_applyLabel"},icon:{check:"String",nullable:!0,apply:"_applyIcon"},permanent:{check:"Boolean",init:!1,apply:"_applyPermanent"},modified:{check:"Boolean",init:!1,apply:"_applyLabel"},closeable:{check:"Boolean",init:!0,apply:"_applyCloseable"},writeable:{check:"Boolean",init:!0,apply:"_applyLabel"}},members:{_forwardStates:{focused:!0,hovered:!0,selected:!0,dragover:!0},_onPointerOver:function(){this.addState("hovered")},_transformFilename:function(e){return"."===e?"":e},_onPointerOut:function(){this.removeState("hovered")},_applyPermanent:function(e){this.setFont(e?"default":"italic")},_applyCloseable:function(e){this.getChildControl("close").setVisibility(e?"visible":"excluded")},_applyModel:function(e,t){t&&t.removeRelatedBindings(this);e&&e.bind("file.writeable",this,"writeable")},_applyIcon:function(e){var t=this.getChildControl("icon");t.setSource(e);e?t.show():t.exclude()},_applyLabel:function(){var e=this.getChildControl("label");if(this.getLabel()){var t=this.getLabel();if(this.isWriteable()||this.getModel().getFile().isFake())this.resetToolTipText();else{t+=" !";this.setToolTipText(this.tr("This file is not writeable"))}this.isModified()&&(t+=" *");e.setValue(t);e.show()}else{e.exclude();this.resetToolTipText()}},_onClose:function(){this.isCloseable()&&this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new qx.ui.basic.Image).setAppearance("open-file-item/icon");t.setAnonymous(!0);t.exclude();this._addAt(t,0);break;case"label":(t=new qx.ui.basic.Label).setAppearance("open-file-item/label");t.setAnonymous(!0);this._addAt(t,1);break;case"close":(t=new qx.ui.basic.Image("decoration/tabview/close.gif")).setAppearance("open-file-item/close");this.isCloseable()?t.addListener("tap",this._onClose,this):t.exclude();this._addAt(t,2)}return t||cv.ui.manager.form.FileTabItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this)}});cv.ui.manager.form.FileTabItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Message",{extend:qx.core.Object,properties:{title:{check:"String",init:"",event:"changeTitle"},content:{check:"String",init:"",event:"changeContent"},type:{check:["alert","hint","warning","error"],nullable:!0,event:"changeType"},sticky:{check:"Boolean",init:!1,event:"changeSticky"}}});cv.ui.manager.model.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.event.Timer":{},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Message",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this.addListener("appear",this._onAppear,this)},events:{close:"qx.event.type.Data"},properties:{appearance:{refine:!0,init:"cv-snackbar-msg"},model:{check:"cv.ui.manager.model.Message",nullable:!0,apply:"_applyModel"},timeout:{check:"Number",init:5e3,apply:"_applyTimeout"},type:{check:["alert","hint","warning","error"],nullable:!0,apply:"_applyType"}},members:{_timer:null,_applyModel:function(e,t){if(t){t.removeRelatedBindings(this);t.removeRelatedBindings(this.getChildControl("content"))}if(e){e.bind("title",this.getChildControl("content"),"value");e.bind("type",this,"type");e.bind("sticky",this,"timeout",{converter:function(e){return e?0:5e3}});this.getChildControl("close")}},_applyType:function(e){e?this.setDecorator(this.getAppearance()+"-"+e):this.setDecorator(this.getAppearance())},_applyTimeout:function(e){if(this._timer){this._timer.stop();0===e&&(this._timer=null)}},_onAppear:function(){var e=this.getTimeout();this._timer&&this._timer.stop();e>0&&(this._timer=qx.event.Timer.once(this.close,this,e))},close:function(){this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":t=new qx.ui.basic.Image;this._addAt(t,0);break;case"content":t=new qx.ui.basic.Label;this._addAt(t,1,{flex:1});break;case"close":(t=new qx.ui.basic.Image(cv.theme.dark.Images.getIcon("close",15))).addListener("tap",this.close,this);this._addAt(t,2)}return t||cv.ui.manager.snackbar.Message.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_timer")}});cv.ui.manager.snackbar.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.ui.container.Scroll":{},"qx.ui.basic.Atom":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.AbstractViewer",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"},external:{check:"Boolean",init:!1}},members:{canHandleAction:function(){return!1},handleAction:function(){},save:function(){},getCurrentContent:function(){},_applyFile:function(e,t){},_createChildControlImpl:function(e){var t;switch(e){case"scroll":t=new qx.ui.container.Scroll;this._add(t);break;case"image":t=new qx.ui.basic.Atom;this.getChildControl("scroll").add(t);t.getChildControl("icon").addListener("resize",this._scaleImage,this)}return t||cv.ui.manager.viewer.AbstractViewer.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.viewer.AbstractViewer.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.ResourceManager":{},"qx.io.ImageLoader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Image",{extend:cv.ui.manager.viewer.AbstractViewer,properties:{appearance:{refine:!0,init:"image-viewer"}},statics:{SUPPORTED_FILES:["jpg","jpeg","png","gif","svg"],TITLE:qx.locale.Manager.tr("Show image"),ICON:cv.theme.dark.Images.getIcon("image",18),getImageData:function(e){var t=qx.util.ResourceManager.getInstance().getData(e);return t?{width:t[0],height:t[1],aspectRatio:t[0]/t[1]}:(t=qx.io.ImageLoader.getSize(e))&&t.width&&t.height?Object.assign({aspectRatio:t.width/t.height},t):null}},members:{_applyFile:function(e){var t=this.getChildControl("image");if(e){t.setIcon(e.getServerPath());t.setLabel(e.getFullPath());cv.ui.manager.viewer.Image.getImageData(e.getServerPath())?this._scaleImage():t.getChildControl("icon").addListenerOnce("loaded",this._scaleImage,this);this.addListener("resize",this._scaleImage,this)}else{t.resetIcon();t.resetLabel();this.removeListener("resize",this._scaleImage,this)}},_scaleImage:function(){var e=this.getBounds();if(e){var t=this.getFile();if(t){var i=this.getChildControl("image").getChildControl("icon"),n=cv.ui.manager.viewer.Image.getImageData(t.getServerPath()),a=e.height-40,r=e.width-20,o=Math.round(1/n.aspectRatio*r);if(o>a){o=a;r=Math.round(n.aspectRatio*a)}i.set({width:r,height:o,scale:!0})}}else this.addListenerOnce("appear",this._scaleImage,this)}}});cv.ui.manager.viewer.Image.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.event.message.Bus":{},"cv.ui.manager.model.FileItem":{},"qx.util.Uri":{},"qx.util.LibraryManager":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.embed.Iframe":{},"qx.ui.basic.Atom":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Config",{extend:cv.ui.manager.viewer.AbstractViewer,construct:function(){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{appearance:{refine:!0,init:"config-viewer"},target:{check:["iframe","window"],init:"window"},external:{refine:!0,init:!0},connectToWindow:{check:"Boolean",init:!1,apply:"_applyConnectToWindow"}},statics:{SUPPORTED_FILES:/^(demo)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Config viewer"),ICON:cv.theme.dark.Images.getIcon("preview",18)},members:{_windowRef:null,_applyConnectToWindow:function(e){this.setExternal(!e)},_applyFile:function(e,t){t&&t.isConfigFile()&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e)if(e.isConfigFile()){var i=cv.ui.manager.model.FileItem.getConfigName(e.getFullPath()),n=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/..")+"?config="+(i||"");if("iframe"===this.getTarget()){n+="&preview=1";var a=this.getChildControl("iframe");a.setSource(n);a.show();var r=this.getChildControl("hint",!0);r&&r.isVisible()&&r.exclude()}else{var o=window.open(n,i);if(!this.isConnectToWindow()){this._onClose();return}this._windowRef=o;this._windowRef.onbeforeunload=this._onClose.bind(this);this.getChildControl("hint").show();var s=this.getChildControl("iframe",!0);s&&s.isVisible()&&s.exclude()}qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else cv.ui.manager.snackbar.Controller.error(this.tr("%1 is no configuration file",e.getFullPath()));else{this.hasChildControl("iframe")&&this.getChildControl("iframe").exclude();this.hasChildControl("hint")&&this.getChildControl("hint").exclude();this._windowRef&&this._windowRef.close()}},_onChange:function(e){"contentChanged"===e.getData().type&&(this.hasChildControl("iframe")?this.getChildControl("iframe").reload():this._windowRef&&this._windowRef.reload())},_onClose:function(){if(this._windowRef){console.log(this,"close",this.getFile().getFullPath());qx.event.message.Bus.dispatchByName("cv.manager.action.close",this.getFile())}},_createChildControlImpl:function(e){var t;switch(e){case"iframe":(t=new qx.ui.embed.Iframe).exclude();this.getChildControl("scroll").add(t);break;case"hint":(t=new qx.ui.basic.Atom(this.tr("This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window."))).set({center:!0,font:"title"});t.addListener("tap",function(){this._windowRef&&this._windowRef.focus()},this);this.getChildControl("scroll").add(t)}return t||cv.ui.manager.viewer.Config.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._windowRef=null}});cv.ui.manager.viewer.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.core.IMultiSelection":{require:!0},"qx.ui.form.IModelSelection":{require:!0},"qx.ui.core.MMultiSelectionHandling":{require:!0},"qx.ui.core.MRemoteChildrenHandling":{require:!0},"qx.ui.form.MModelSelection":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.viewer.Image":{construct:!0},"qx.data.Array":{construct:!0},"qx.ui.layout.VBox":{construct:!0},"cv.ui.manager.model.FileItem":{construct:!0},"cv.theme.dark.Images":{construct:!0,usage:"dynamic",require:!0},"qx.util.Function":{construct:!0},"qx.locale.Manager":{require:!0},"qx.ui.core.selection.ScrollArea":{require:!0},"cv.ui.manager.form.FileListItem":{},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.message.Bus":{},"qx.data.controller.List":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.TextField":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.layout.Flow":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Folder",{extend:cv.ui.manager.viewer.AbstractViewer,implement:[qx.ui.core.IMultiSelection,qx.ui.form.IModelSelection],include:[qx.ui.core.MMultiSelectionHandling,qx.ui.core.MRemoteChildrenHandling,qx.ui.form.MModelSelection,cv.ui.manager.control.MFileEventHandler],construct:function(e){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);cv.ui.manager.model.Preferences.getInstance().bind("startViewMode",this,"viewMode");this._isImageRegex=new RegExp(".("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i");this.initModel(new qx.data.Array);this._setLayout(new qx.ui.layout.VBox(8));this._newItem=new cv.ui.manager.model.FileItem("new","new",null).set({fake:!0,type:"file",loaded:!0,icon:cv.theme.dark.Images.getIcon("upload"),displayName:this.tr("Upload file"),special:"add-file"});this._debouncedOnFilter=qx.util.Function.debounce(this._onFilter,500,!1);e||this._createChildControl("toolbar");this._createChildControl("filter")},statics:{SUPPORTED_FILES:function(e){return"dir"===e.getType()},TITLE:qx.locale.Manager.tr("Show folder"),ICON:cv.theme.dark.Images.getIcon("folder",18)},events:{addItem:"qx.event.type.Data",removeItem:"qx.event.type.Data"},properties:{model:{check:"qx.data.Array",deferredInit:!0},permanentFilter:{check:"Function",nullable:!0,apply:"_onFilter"},showTextFilter:{check:"Boolean",init:!0,apply:"_applyShowTextFilter"},labelConverter:{check:"Function",nullable:!0},disableScrolling:{check:"Boolean",init:!1,apply:"_applyDisableScrolling"},viewMode:{check:["list","preview"],init:"list",event:"changeViewMode"}},members:{_controller:null,_isImageRegex:null,_newItem:null,SELECTION_MANAGER:qx.ui.core.selection.ScrollArea,_defaultLabelConverter:function(e){if("list"===this.getViewMode())return e;var t=e.split(".");t.length>1&&t.pop();return t.join(".")},_getDelegate:function(){var e=this.getLabelConverter(),t={converter:e||this._defaultLabelConverter.bind(this)};return{createItem:function(){return new cv.ui.manager.form.FileListItem},configureItem:function(e){e.addListener("dbltap",this._onDblTap,this);e.addListener("contextmenu",this._onFsItemRightClick,this);e.addListener("action",this._onFsItemRightClick,this);e.setShowFileActions(!0);this.bind("viewMode",e,"viewMode")}.bind(this),bindItem:function(e,i,n){e.bindProperty("","model",null,i,n);e.bindProperty("displayName","label",t,i,n);e.bindProperty("icon","icon",{converter:function(e,t){if("file"===t.getType()&&this._isImageRegex.test(t.getName()))return t.getServerPath();if(!e)return null;var i=e.split("/");3===i.length&&i.pop();return i.join("/")}.bind(this)},i,n)}.bind(this)}},_onFsItemRightClick:function(e){var t=e.getCurrentTarget().getModel();if("add-file"!==t.getSpecial()){var i=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();i.configure(t);e.getCurrentTarget().setContextMenu(i);i.openAtPointer(e);e.getBubbles()&&e.stop()}else{e.preventDefault();e.getBubbles()&&e.stopPropagation()}},_onDblTap:function(e){var t=e.getCurrentTarget().getModel();"add-file"===t.getSpecial()||qx.event.message.Bus.dispatchByName("cv.manager.open",t)},_applyFile:function(e,t){if(t){t.removeRelatedBindings(this);this.resetModel()}if(e){var i=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,i);this._controller.setDelegate(this._getDelegate())}e.bind("children",this,"model");var n=this.getModel();this._newItem.setParent(e);n.addListener("change",function(){this.getChildControl("filter").getValue()||this.getPermanentFilter()?this._onFilter():this._controller.setModel(n)},this);this._controller.setModel(n);e.load()}else{this._controller&&this._controller.resetModel();this._newItem.resetParent()}},_handleFileEvent:function(e){var t=this.getFile(),i=e.getData();switch(i.action){case"moved":t.reload();break;case"added":case"uploaded":case"created":i.path.startsWith(t.getFullPath())&&t.reload();break;case"deleted":if(t)if(i.path===t.getFullPath())this.dispose();else if(i.path.startsWith(t.getFullPath())){(n=t.getChildren()).some(function(e){if(e.getFullPath()===i.path){n.remove(e);this.removeRelatedBindings(e);return!0}},this)}var n;(n=this.getModel()).some(function(e){if(e.getFullPath()===i.path){n.remove(e);this.removeRelatedBindings(e);return!0}},this)}},_applyShowTextFilter:function(e){this.getChildControl("filter").setVisibility(e?"visible":"excluded")},_onFilter:function(){if(this._controller){var e=this.getChildControl("filter").getValue(),t=this.getPermanentFilter(),i=this.getModel().filter(function(i){return(!t||t(i))&&(!e||i.getName().includes(e))});this._controller.setModel(i)}},getChildrenContainer:function(){return this.getChildControl("list")},_onAddChild:function(e){this.fireDataEvent("addItem",e.getData())},_onRemoveChild:function(e){this.fireDataEvent("removeItem",e.getData())},_onFileEvent:function(e){e.getData().action},_applyDisableScrolling:function(e){if(e){this.getChildControl("scroll").exclude();this._addAt(this.getChildControl("list"),1,{flex:1})}else{var t=this.getChildControl("scroll");t.show();t.add(this.getChildControl("list"));this._addAt(t,1,{flex:1})}},_createChildControlImpl:function(e){var t;switch(e){case"toolbar":t=new cv.ui.manager.ToolBar(null,["new-file","new-folder","upload","reload"]);this.bind("file",t,"folder");t.addListener("reload",function(){this.getFile().reload()},this);this._addAt(t,0);break;case"filter":(t=new qx.ui.form.TextField).set({placeholder:this.tr("Filter by name..."),liveUpdate:!0,margin:8});this.isShowTextFilter()||t.exclude();t.addListener("changeValue",this._debouncedOnFilter,this);this._addAt(t,1);break;case"scroll":t=new qx.ui.container.Scroll;this._addAt(t,2,{flex:1});break;case"list":(t=new qx.ui.container.Composite(new qx.ui.layout.Flow(8,8))).addListener("addChildWidget",this._onAddChild,this);t.addListener("removeChildWidget",this._onRemoveChild,this);this.isDisableScrolling()?this._addAt(t,1,{flex:1}):this.getChildControl("scroll").add(t)}return t||cv.ui.manager.viewer.Folder.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_controller");this._isImageRegex=null;cv.ui.manager.model.Preferences.getInstance().removeRelatedBindings(this)}});cv.ui.manager.viewer.Folder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.Folder":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.core.IconAtom":{},"qx.data.controller.List":{},"cv.IconConfig":{},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Icons",{extend:cv.ui.manager.viewer.Folder,construct:function(){this._disableFileEvents=!0;cv.ui.manager.viewer.Folder.constructor.call(this,!0)},statics:{SUPPORTED_FILES:/^CometVisu-Icons$/i,TITLE:qx.locale.Manager.tr("Show icons"),ICON:cv.theme.dark.Images.getIcon("icons",18)},members:{_getDelegate:function(){return{createItem:function(){return new cv.ui.manager.core.IconAtom},bindItem:function(e,t,i){e.bindProperty("","label",null,t,i)}}},_onFilter:function(){var e=this.getChildControl("filter").getValue(),t=this.getModel().filter(function(t){return t.includes(e)});this._controller.setModel(t)},_applyFile:function(e,t){if(e){var i=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,i);this._controller.setDelegate(this._getDelegate())}var n=this.getModel();Object.keys(cv.IconConfig.DB).filter(function(e){var t=cv.IconConfig.DB[e];return t["*"]&&t["*"]["*"]&&qx.lang.Type.isFunction(t["*"]["*"]["*"])}).forEach(function(e){n.push(e)},this);this.getChildControl("filter").getValue()||this.getPermanentFilter()?this._onFilter():this._controller.setModel(n)}else this._controller&&this._controller.resetModel()}}});cv.ui.manager.viewer.Icons.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.VBox":{construct:!0},"cv.theme.dark.Images":{},"cv.ui.manager.model.Preferences":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.toolbar.ToolBar":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.RadioButton":{},"qx.ui.form.RadioGroup":{},"qx.ui.basic.Atom":{},"qx.ui.layout.HBox":{},"cv.ui.manager.ToolBar":{},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.viewer.Folder":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Start",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox);this._configRegex=/^visu_config_?([^.]+)?\.xml$/;["toolbar","configs-title","configs-toolbar","configs","demo-configs-title","demo-configs","media-title","media-toolbar","media","misc-title","misc"].forEach(this._createChildControl,this)},properties:{file:{check:"cv.ui.manager.model.FileItem",apply:"_loadRoot",event:"changeFile"},appearance:{refine:!0,init:"cv-start"},selectedItem:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applySelectedItem"},external:{check:"Boolean",init:!1}},members:{_configRegex:null,_ignoreSelectionChanges:!1,_previewButton:null,_listButton:null,_radioGroup:null,save:function(){},getCurrentContent:function(){},canHandleAction:function(){return!1},handleAction:function(){},_loadRoot:function(e){this.getChildControl("configs").setFile(e);var t=0;e.load(function(){e.getChildren().some(function(e){if("media"===e.getName()){this.getChildControl("media").setFile(e);this.getChildControl("media-toolbar").setFolder(e);t++}else if("demo"===e.getName()){this.getChildControl("demo-configs").setFile(e);t++}return 2===t},this)},this)},_onChangeSelection:function(e){if(!1===this._ignoreSelectionChanges){var t=e.getTarget(),i=e.getData();this._ignoreSelectionChanges=!0;["configs","demo-configs","media"].forEach(function(e){var i=this.getChildControl(e);i!==t&&i.resetSelection()},this);this._ignoreSelectionChanges=!1;i.length>0&&this.setSelectedItem(i[0].getModel())}},_applySelectedItem:function(){},_onToggleExpand:function(e){var t=this.getChildControl(e.getTarget().getUserData("control"));if("visible"===t.getVisibility()){t.exclude();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-down",18))}else{t.show();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-up",18))}},_onChangeViewMode:function(){switch(cv.ui.manager.model.Preferences.getInstance().getStartViewMode()){case"list":this._radioGroup.setSelection([this._listButton]);break;case"preview":this._radioGroup.setSelection([this._previewButton])}},_createChildControlImpl:function(e){var t;switch(e){case"scroll-container":t=new qx.ui.container.Scroll;this._add(t,{flex:1});break;case"content":t=new qx.ui.container.Composite(new qx.ui.layout.VBox(8));this.getChildControl("scroll-container").add(t);break;case"toolbar":t=new qx.ui.toolbar.ToolBar;var i=new qx.ui.toolbar.Part,n=this._listButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("listViewMode",22));n.setUserData("mode","list");n.set({show:"icon",toolTipText:this.tr("List mode")});var a=this._previewButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("previewMode",22));a.setUserData("mode","preview");a.set({show:"icon",toolTipText:this.tr("Preview mode")});i.add(n);i.add(a);t.add(i);this._radioGroup=new qx.ui.form.RadioGroup(n,a);this._onChangeViewMode();this._radioGroup.addListener("changeSelection",function(e){var t=e.getData()[0];cv.ui.manager.model.Preferences.getInstance().setStartViewMode(t.getUserData("mode"))},this);cv.ui.manager.model.Preferences.getInstance().addListener("changeStartViewMode",this._onChangeViewMode,this);this._add(t);break;case"configs-title":(t=new qx.ui.basic.Atom(this.tr("Configurations"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","configs");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("configs-header").add(t);break;case"configs-header":t=new qx.ui.container.Composite(new qx.ui.layout.HBox);this.getChildControl("content").add(t);break;case"configs-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-config-file","upload","reload"])).setFolder(cv.ui.manager.model.FileItem.ROOT);t.addListener("reload",function(){cv.ui.manager.model.FileItem.ROOT.reload()},this);this.getChildControl("configs-header").add(t);break;case"configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){var t=this._configRegex.exec(e.getName());return!(!t||t[1]&&t[1].endsWith("temp"))}.bind(this),labelConverter:function(e,t){if(t.isFake())return e;var i=cv.ui.manager.model.FileItem.getConfigName(e);return i||"<Default>"},file:cv.ui.manager.model.FileItem.ROOT,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"demo-configs-title":(t=new qx.ui.basic.Atom(this.tr("Demo configurations"),cv.theme.dark.Images.getIcon("drop-down",18))).setUserData("control","demo-configs");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"demo-configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){return this._configRegex.test(e.getName())}.bind(this),labelConverter:function(e){var t=cv.ui.manager.model.FileItem.getConfigName(e);return t||"<Default>"},disableScrolling:!0});t.exclude();t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"media-title":(t=new qx.ui.basic.Atom(this.tr("Media files"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","media");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("media-header").add(t);break;case"media-header":t=new qx.ui.container.Composite(new qx.ui.layout.HBox);this.getChildControl("content").add(t);break;case"media-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-file","upload","reload"])).addListener("reload",function(){t.getFolder().reload()},this);this.getChildControl("media-header").add(t);break;case"media":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"misc-title":(t=new qx.ui.basic.Atom(this.tr("Miscellaneous"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","misc");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"misc":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});this.__P_26_0(t);this.getChildControl("content").add(t,{flex:1})}return t||cv.ui.manager.Start.prototype._createChildControlImpl.base.call(this,e)},__P_26_0:function(e){if(cv.ui.manager.model.FileItem.ROOT.isLoaded()){var t=[cv.ui.manager.model.FileItem.getIconFile()];cv.ui.manager.model.FileItem.ROOT.getChildren().some(function(e){if("hidden.php"===e.getFullPath()){e.set({overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),displayName:qx.locale.Manager.tr("Hidden configuration"),fake:!0});t.unshift(e);return!0}});var i=new cv.ui.manager.model.FileItem("fake","fake",cv.ui.manager.model.FileItem.ROOT,t).set({fake:!0,type:"dir",loaded:!0});e.setFile(i);e.addListener("changeSelection",this._onChangeSelection,this)}else cv.ui.manager.model.FileItem.ROOT.addListenerOnce("changeLoaded",function(){this.__P_26_0(e)},this)}},destruct:function(){this._configRegex=null;cv.ui.manager.model.Preferences.getInstance().removeListener("changeStartViewMode",this._onChangeViewMode,this);this._disposeObjects("_previewButton","_listButton","_radioGroup")}});cv.ui.manager.Start.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.util.LibraryManager":{construct:!0},"qx.ui.core.FocusHandler":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.Uri":{},"qx.util.DynamicScriptLoader":{},"cv.ui.manager.editor.completion.Config":{},"cv.ui.manager.editor.completion.CometVisu":{},"qx.log.Logger":{},"cv.ui.manager.editor.Worker":{},"cv.Version":{},"qx.io.request.Xhr":{},"qx.util.ResourceManager":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"dialog.Dialog":{},"qx.xml.Document":{},"cv.util.ConfigUpgrader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Source",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save","cut","copy","paste","undo","redo"];this._basePath=window.location.origin+window.location.pathname+qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/config/";this.getContentElement().setAttribute("contentEditable","true");this.set({droppable:!1,focusable:!0});this.addListener("dragover",function(e){e.preventDefault();e.dataTransfer.effectAllowed="none";e.dataTransfer.dropEffect="none"});this.addListener("drop",function(e){e.preventDefault()});this.addListener("appear",function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!1)});this.addListener("disappear",function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)});this._draw();this._initWorker();this._currentDecorations=[]},statics:{TITLE:qx.locale.Manager.tr("Texteditor"),COUNTER:0,MONACO_EXTENSION_REGEX:null,SUPPORTED_FILES:function(e){if(window.monaco&&window.monaco.languages){if(!cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX){var t=[];monaco.languages.getLanguages().forEach(function(e){e.extensions.forEach(function(e){e=e.replace(/\./g,"\\.");-1===t.indexOf(e)&&t.push(e)})});cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX=new RegExp("("+t.join("|")+")$")}return cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX.test(e.getFullPath().toLowerCase())}return/\.(xml|php|css|js|svg|json|md|yaml|conf|ts|rst|py|txt)$/i.test(e.getFullPath().toLowerCase())},DEFAULT_FOR:/^(demo)?\/?visu_config.*\.xml/,ICON:cv.theme.dark.Images.getIcon("text",18),load:function(e,t){window.documentationMappingPrefix="editor/";var i=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/.."),n=new qx.util.DynamicScriptLoader([i+"editor/dependencies/jquery.min.js",i+"editor/dependencies/jquery.xpath.min.js",i+"editor/lib/Messages.js",i+"editor/lib/Schema.js",i+"node_modules/monaco-editor/min/vs/loader.js","manager/xml.js"]);n.addListener("ready",function(){window.require.config({paths:{vs:i+"node_modules/monaco-editor/min/vs"}});window.require.config({"vs/nls":{availableLanguages:{"*":"en"!==qx.locale.Manager.getInstance().getLanguage()?qx.locale.Manager.getInstance().getLanguage():""}}});var n="?"+Math.random();window.require(["xml!./resource/visu_config.xsd"+n,"xml!*./resource/manager/completion-libs/qooxdoo.d.ts","vs/editor/editor.main"],function(i,n){this.__P_31_0=i;e.apply(t);window.monaco.languages.typescript.javascriptDefaults.addExtraLib(n,"qooxdoo.d.ts");var a=new window.Schema("visu_config.xsd",i),r=new cv.ui.manager.editor.completion.Config(a),o=new cv.ui.manager.editor.completion.CometVisu;window.monaco.languages.registerCompletionItemProvider("xml",r.getProvider());window.monaco.languages.registerCompletionItemProvider("javascript",o.getProvider())}.bind(this))},this);n.addListener("failed",function(e){qx.log.Logger.error(this,e.getData())},this);n.start()}},members:{__P_31_0:null,_editor:null,_basePath:null,_workerWrapper:null,_currentDecorations:null,_configClient:null,_onDidChangeContentGuard:0,_initWorker:function(){this._workerWrapper=cv.ui.manager.editor.Worker.getInstance();this._workerWrapper.setEditor(this)},_getDefaultModelOptions:function(){return{tabSize:2,indentSize:2,insertSpaces:!0}},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.create(e,{suggestOnTriggerCharacters:!0,folding:!0,autoIndent:!0,automaticLayout:!0,dragAndDrop:!0,formatOnPaste:!0,formatOnType:!0,renderValidationDecorations:"on",minimap:{enabled:!0},theme:"vs-dark"});var t=cv.Version.VERSION.split("-")[0],i=new qx.io.request.Xhr(qx.util.ResourceManager.getInstance().toUri("hidden-schema.json"));i.set({method:"GET",accept:"application/json"});i.addListenerOnce("success",function(e){var i=e.getTarget().getResponse();window.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[{uri:"https://www.cometvisu.org/CometVisu/schemas/"+t+"/hidden-schema.json",fileMatch:["hidden.php"],schema:i}]})},this);i.send();this.getFile()&&this._loadFile(this.getFile());this._editor.onDidChangeModelContent(this._onContentChanged.bind(this))}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},handleAction:function(e){if(this.canHandleAction(e)){var t;switch(e){case"cut":t=this._editor.getAction("editor.action.clipboardCutAction");break;case"copy":t=this._editor.getAction("editor.action.clipboardCopyAction");break;default:cv.ui.manager.editor.Source.prototype.handleAction.base.call(this,e)}t&&t.run()}},_loadFile:function(e,t){t&&this._workerWrapper&&this._workerWrapper.close(t);this._editor&&(e&&"file"===e.getType()&&this.isSupported(e)?cv.ui.manager.editor.Source.prototype._loadFile.base.call(this,e,t):cv.ui.manager.editor.Source.prototype._loadFile.base.call(this,null,t))},_loadFromFs:function(){if("hidden.php"===this.getFile().getName()){if(!this._configClient){this._configClient=cv.io.rest.Client.getConfigClient();this._configClient.addListener("getSuccess",function(e){this.setContent(JSON.stringify(e.getData(),null,2))},this);this._configClient.addListener("updateSuccess",this._onSaved,this)}this._configClient.get({section:"*",key:"*"})}else cv.ui.manager.editor.Source.prototype._loadFromFs.base.call(this)},save:function(e,t){"hidden.php"===this.getFile().getName()?this.getFile().isValid()?this.getFile().getHasWarnings()?dialog.Dialog.confirm(this.tr("Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?"),function(e){e&&this.__P_31_1()},this,qx.locale.Manager.tr("Confirm saving with warnings")):this.__P_31_1():cv.ui.manager.snackbar.Controller.error(this.tr("Hidden config is invalid, please correct the errors")):cv.ui.manager.editor.Source.prototype.save.base.call(this,e,t)},__P_31_1:function(){this._configClient.saveSync(null,JSON.parse(this.getCurrentContent()),function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}},this)},_applyContent:function(e){var t=this.getFile();if(t){var i=this._editor.getModel();this._workerWrapper&&this._workerWrapper.open(t,e);var n=window.monaco.editor.getModel(t.getUri());if(!n){qx.xml.Document.isXmlDocument(e)&&(e=e.documentElement.outerHTML);(n=window.monaco.editor.createModel(e,this._getLanguage(t),t.getUri())).onDidChangeDecorations(function(e){var i=!1,a=!1;monaco.editor.getModelMarkers({owner:n.getModeId(),resource:t.getUri()}).some(function(e){e.severity===monaco.MarkerSeverity.Warning?a=!0:e.severity===monaco.MarkerSeverity.Error&&(i=!0);return a&&i},this);t.setValid(!i);t.setHasWarnings(a)})}if(i!==n){n.updateOptions(this._getDefaultModelOptions());this._editor.setModel(n)}else this._editor.setValue(e);this._editor.updateOptions({readOnly:!t.isWriteable()});this._processHandlerOptions(e)}},_processHandlerOptions:function(e){var t=this.getHandlerOptions()||{};if(t.hasOwnProperty("upgradeVersion")&&!0===t.upgradeVersion&&e){var i=this._upgradeConfig(e),n=_slicedToArray(i,2),a=n[0],r=n[1];a?this.error(a):this._editor.setValue(this._convertToString(r))}},_convertToString:function(e){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+e.documentElement.outerHTML},_upgradeConfig:function(e){return(new cv.util.ConfigUpgrader).upgrade(e)},getCurrentContent:function(){return this._editor.getValue()},_onContentChanged:function(){this._workerWrapper&&this._workerWrapper.contentChanged(this.getFile(),this._editor.getValue())},isSupported:function(e){var t=e.getName().split("."),i=t.length>1?t.pop():"txt",n="."+i;return monaco.languages.getLanguages().some(function(e){return e.id===i||e.extensions.indexOf(n)>=0})},showErrors:function(e,t){var i=[],n=this._editor.getModel();if(n){var a=-1;if(t){var r=null;t.forEach(function(e){if(/.*\.xml:[\d]+:.+/.test(e)){if(null!==r){i.push({severity:window.monaco.MarkerSeverity.Error,startLineNumber:r.line,startColumn:1,endLineNumber:r.line,endColumn:n.getLineContent(r.line).length,message:r.message});s(r.line)}var t=e.split(":"),a=t.shift(),o=parseInt(t.shift()),l=/.+line ([\d]+) -+/.exec(t[t.length-1]);l&&(o=parseInt(l[1]));if(isNaN(o))return;s((r={line:o,message:t.slice(-2).join(":"),file:a}).line)}else r.message+="\n"+e});if(null!==r){i.push({severity:window.monaco.MarkerSeverity.Error,startLineNumber:r.line,startColumn:1,endLineNumber:r.line,endColumn:n.getLineContent(r.line).length,message:r.message});s(r.line)}}if(this.getFile().getFullPath()===e){window.monaco.editor.setModelMarkers(n,"",i);var o=this.getHandlerOptions();o&&o.jumpToError&&0===this._editor.getScrollTop()&&this._editor.revealLineInCenter(a)}}function s(e){(a<0||a>e)&&(a=e)}},showDecorations:function(e,t){this.getFile().getFullPath()===e&&this._editor.deltaDecorations(this._currentDecorations[e],t);this._currentDecorations[e]=t},_getLanguage:function(e){if("hidden.php"===e.getName())return"json";var t=e.getName().split(".").pop();switch(t){case"svg":return"xml";case"js":return"javascript";case"md":return"markdown";default:if(!t)return"txt";var i="."+t;monaco.languages.getLanguages().some(function(e){return e.id===t||e.extensions.indexOf(i)>=0})||(t="txt");return t}}},destruct:function(){this._workerWrapper=null;if(this._editor){this._editor.dispose();this._editor=null}this._configClient=null;qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)}});cv.ui.manager.editor.Source.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.util.Uri":{construct:!0},"qx.util.LibraryManager":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.ui.embed.Iframe":{},"qx.ui.basic.Atom":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Xml",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this._handledActions=["save"];this.__P_32_0=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/../editor/editor.html");this._draw()},statics:{SUPPORTED_FILES:/^(demo)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Xml-editor"),ICON:cv.theme.dark.Images.getIcon("xml",18)},members:{_currentContent:null,_iframe:null,_notWriteable:null,_draw:function(){},_loadFile:function(e){this._iframe&&this._iframe.destroy();if(e){var t=/.*visu_config_?(.*)\.xml/.exec(e.getName());if(t)if(e.isWriteable()){this._iframe=new qx.ui.embed.Iframe(qx.util.Uri.appendParamsToUrl(this.__P_32_0,"embed=1&config="+t[1])+"&demo="+("demo/"===e.getParentFolder()?"true":"false"));this._iframe.addListener("load",function(){this._iframe.getWindow().saveFromIframe=this.saveFromIframe.bind(this)},this);this._add(this._iframe)}else{if(!this._notWriteable){this._notWriteable=new qx.ui.basic.Atom(this.tr("The XML-Editor does not support files that are not writeable!"));this._notWriteable.set({center:!0,font:"title"});this._add(this._notWriteable)}this._notWriteable.show()}}},saveFromIframe:function(e,t,i){var n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>';e.forEach(function(e){n+=this._elemToXml(e,"")},this);this._currentContent=n;t||this._onContentChanged();this.save(t,i)},save:function(e,t){if(e){var i=this.getFile(),n=e.split("/").pop();(i.getParent().getChildren().some(function(e){return e.getName()===n})?this._client.updateSync:this._client.createSync)({path:i.getPath()+"/"+n,hash:"ignore",type:"file",force:!0},this.getCurrentContent(),function(e){t(e)},this)}else cv.ui.manager.editor.Xml.prototype.save.base.call(this,function(e){e||this._onSaved();t(e)}.bind(this),"ignore")},_elemToXml:function(e,t){var i="";if("#comment"===e.nodeName)i+="\n"+t+"\x3c!-- "+e.nodeValue+" --\x3e";else if("#text"===e.nodeName)i+=e.nodeValue;else{i+="\n"+t+"<"+e.nodeName;Object.keys(e.attributes).forEach(function(t){i+=" "+t+'="'+e.attributes[t]+'"'});if(e.nodeValue||0!==e.children.length){i+=">";"status"===e.nodeName&&"html"===e.attributes.type?i+="<![CDATA[\n"+t+"  "+e.nodeValue+"\n ]]>":e.nodeValue&&(i+=e.nodeValue);var n=[];e.children.forEach(function(e){n.push(this._elemToXml(e,t+"  "))},this);i+=n.join("");i+="\n"+t+"</"+e.nodeName+">"}else i+="/>"}return i},getCurrentContent:function(){return this._currentContent},_onContentChanged:function(){this.getFile().setModified(!0)},isSupported:function(e){return cv.ui.manager.editor.Xml.SUPPORTED_FILES.test(e.getName())&&e.isWriteable()}},destruct:function(){this._disposeObjects("_iframe","_notWriteable")}});cv.ui.manager.editor.Xml.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);return"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){i.push(o.value);if(t&&i.length===t)break}}catch(e){a=!0;r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.Source":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.model.CompareFiles":{},"cv.ui.manager.model.FileItem":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"dialog.Dialog":{},"qx.bom.Viewport":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Diff",{extend:cv.ui.manager.editor.Source,construct:function(){cv.ui.manager.editor.Source.constructor.call(this)},statics:{COUNTER:0,TITLE:qx.locale.Manager.tr("File compare"),ICON:cv.theme.dark.Images.getIcon("compare",18)},properties:{originalContent:{check:"String",init:"",apply:"_applyContent"},modifiedContent:{check:"String",init:"",apply:"_applyContent"},editable:{check:"Boolean",init:!1,apply:"_applyEditable"}},members:{_applyEditable:function(e){this._editor&&this._editor.updateOptions({readOnly:!e})},_initWorker:function(){},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.createDiffEditor(e,{folding:!0,autoIndent:!0,automaticLayout:!0,theme:"vs-dark",readOnly:!this.getEditable()});this.getFile()&&this._loadFile(this.getFile())}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},_applyContent:function(){var e=this.getOriginalContent(),t=this.getModifiedContent();if(e&&t){var i=this.getFile(),n=i instanceof cv.ui.manager.model.CompareFiles?i.getOriginalFile():i,a=i instanceof cv.ui.manager.model.CompareFiles?i.getModifiedFile():i,r=window.monaco.editor.createModel(e,this._getLanguage(n));r.updateOptions(this._getDefaultModelOptions());var o=window.monaco.editor.createModel(t,this._getLanguage(a));o.updateOptions(this._getDefaultModelOptions());this._editor.setModel({original:r,modified:o})}},getCurrentContent:function(){return this._editor.getModifiedEditor().getValue()},clear:function(){this._editor.getModel().original.dispose();this._editor.getModel().modified.dispose()},save:function(e){var t=this.getHandlerOptions();this.getFile()instanceof cv.ui.manager.model.FileItem&&t.hasOwnProperty("upgradeVersion")&&!0===t.upgradeVersion&&cv.ui.manager.editor.Diff.prototype.save.base.call(this,e,"ignore")},_loadFile:function(e,t){t&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(this._editor){var i=this.getHandlerOptions();if(e&&e instanceof cv.ui.manager.model.FileItem&&i.hasOwnProperty("upgradeVersion")&&!0===i.upgradeVersion){qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this);this.setEditable(e.isWriteable());this._client.readSync({path:e.getFullPath()},function(t,i){if(t)cv.ui.manager.snackbar.Controller.error(t);else{this.setOriginalContent(i);var n=this._upgradeConfig(i),a=_slicedToArray(n,3),r=a[0],o=a[1],s=a[2];if(r){dialog.Dialog.error(r);qx.event.message.Bus.dispatchByName("cv.manager.action.close")}else{this.setModifiedContent(this._convertToString(o));var l=s.length>0?"<div>"+qx.locale.Manager.tr("The following changes have been made")+"</div><ul><li>"+s.join("</li><li>")+"</li></ul><div>"+qx.locale.Manager.tr("You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.")+"</div>":"<div><strong>"+qx.locale.Manager.tr("No changes have been made")+"</strong></div>",c="<h3>"+qx.locale.Manager.tr("Config file has been upgraded to the current library version.").translate().toString()+"</h3>"+l+"<div>"+qx.locale.Manager.tr('Click "Apply" if you want to save the changes and reload the browser.')+"</div><div>"+qx.locale.Manager.tr('Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.')+"</div>";dialog.Dialog.confirm(c,function(e){e&&this.save(function(){window.location.reload()})},this,qx.locale.Manager.tr("Upgrade successful")).set({width:Math.min(qx.bom.Viewport.getWidth(),600),yesButtonLabel:qx.locale.Manager.tr("Apply"),noButtonLabel:qx.locale.Manager.tr("Check")});e.setModified(!0)}}},this)}else if(e&&e instanceof cv.ui.manager.model.CompareFiles&&this.isSupported(e.getModifiedFile())){this.resetEditable();this._client.readSync({path:e.getModifiedFile().getFullPath()},function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setModifiedContent(t)},this);this._client.readSync({path:e.getOriginalFile().getFullPath()},function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setOriginalContent(t)},this)}else{this.resetOriginalContent();this.resetModifiedContent()}}}}});cv.ui.manager.editor.Diff.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.locale.Manager":{require:!0},"cv.io.rest.Client":{},"cv.ui.manager.model.config.Section":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"qx.data.Array":{},"cv.ui.manager.form.SectionListItem":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Config",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save"];this._setLayout(new qx.ui.layout.VBox(8));this._createChildControl("list");this._createChildControl("add-section")},statics:{TITLE:qx.locale.Manager.tr("Hidden configuration")},properties:{appearance:{refine:!0,init:"cv-editor-config"}},members:{_model:null,_listController:null,__P_30_0:0,_initClient:function(){this._client=cv.io.rest.Client.getConfigClient();this._client.addListener("getSuccess",this._onModelValueChange,this);this._client.addListener("updateSuccess",this._onSaved,this)},_loadFile:function(e){e&&this._client.get({section:"*",key:"*"})},_onModelValueChange:function(e){this.getFile()&&this.setContent(e.getData())},_applyContent:function(e){var t=this._listController.getModel();t.removeAll();this.__P_30_0=Object.keys(e).length;Object.keys(e).forEach(function(i){var n=new cv.ui.manager.model.config.Section(i);Object.keys(e[i]).forEach(function(t){n.addOption(t,e[i][t])},this);t.push(n)},this);this.__P_30_1()},getCurrentContent:function(){return this.getContent()},_onDeleteSection:function(e){var t=e.getData();this._listController.getModel().remove(t);this.__P_30_1()},__P_30_1:function(){var e=this.getFile();if(this.__P_30_0===this._listController.getModel().length){var t=this.getChildControl("list").getChildren().some(function(e){return e.isModified()},this);e.setModified(t)}else e.setModified(!0)},save:function(){var e=[],t=!0;this._listController.getModel().forEach(function(i){var n=i.getName();if(e.includes(n)){t=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Section name duplicate: "%1".',n))}else e.push(n);var a=[];i.getOptions().forEach(function(e){var i=e.getKey();if(a.includes(i)){t=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Option key duplicate: "%1" in section "%2".',i,n))}else a.push(i)},this)},this);if(t){var i={};this._listController.getModel().forEach(function(e){var t={};e.getOptions().forEach(function(e){t[e.getKey()]=e.getValue()});i[e.getName()]=t},this);this._client.saveSync(null,i,function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}},this)}else cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Section is invalid and has not been saved."))},_createChildControlImpl:function(e){var t;switch(e){case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(new qx.data.Array,t);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.SectionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteSection,this);e.addListener("changeModified",this.__P_30_1,this)}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i)}});this._add(t,{flex:1});break;case"buttons":t=new qx.ui.container.Composite(new qx.ui.layout.HBox(8));this._add(t);break;case"add-section":(t=new qx.ui.form.Button(this.tr("Add section"))).addListener("execute",function(){this._listController.getModel().push(new cv.ui.manager.model.config.Section(""));this.__P_30_1()},this);this.getChildControl("buttons").add(t)}return t||cv.ui.manager.editor.Config.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_model","_listController")}});cv.ui.manager.editor.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.data.FileWorker":{construct:!0},"qx.xml.Document":{},"qx.log.Logger":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Worker",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._files={};this._worker=cv.data.FileWorker.getInstance();this._worker.addListener("message",this._onMessage,this)},properties:{editor:{check:"cv.ui.manager.editor.Source",nullable:!0}},members:{_worker:null,_files:null,open:function(e,t,i){this._worker.postMessage(["openFile",{path:e.getFullPath(),code:qx.xml.Document.isXmlDocument(t)?t.documentElement.outerHTML:t,schema:i}]);this._files[e.getFullPath()]=e},close:function(e){this._worker.postMessage(["closeFile",{path:e.getFullPath()}]);delete this._files[e.getFullPath()]},contentChanged:function(e,t){this._worker.postMessage(["contentChange",{path:e.getFullPath(),code:t}])},validateConfig:function(e){if(e.isConfigFile())return this._worker.validateConfig(e.getServerPath());qx.log.Logger.error(this,e.getFullPath()+" is no configuration file")},_onMessage:function(e){var t=e.getData().topic,i=e.getData().data,n=e.getData().path,a=this._files[n];if(a||"validationResult"===t){var r=this.getEditor();switch(t){case"modified":a.isTemporary()||a.setModified(i.modified);a.setHash(i.currentHash);break;case"errors":a.setValid(!i||0===i.length);r&&r.showErrors(n,i);break;case"decorations":r&&r.showDecorations(n,i)}}else qx.log.Logger.error(this,"no file found for path "+n+" ignoring worker message for topic "+t)}},destruct:function(){this._worker.terminate();this._worker=null}});cv.ui.manager.editor.Worker.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menu.Menu":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.util.format.DateFormat":{construct:!0},"qx.locale.Date":{construct:!0},"cv.ui.manager.model.BackupFolder":{},"qx.ui.menu.Separator":{},"qx.ui.menu.Button":{},"cv.ui.manager.control.FileHandlerRegistry":{},"qx.event.message.Bus":{},"cv.ui.manager.model.CompareFiles":{},"dialog.Prompt":{},"cv.ui.manager.control.FileController":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"cv.ui.manager.upload.UploadMgr":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.FileItem",{extend:qx.ui.menu.Menu,construct:function(e,t){qx.ui.menu.Menu.constructor.call(this);this._noCompare=!0===t;this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this._init();this._dateFormat=new qx.util.format.DateFormat(qx.locale.Date.getDateFormat("medium"));this._timeFormat=new qx.util.format.DateFormat(qx.locale.Date.getTimeFormat("medium"));e&&this.configure(e);this.addListener("appear",function(){this.setActive(!0)});this.addListener("disappear",function(){this.setActive(!1)})},properties:{appearance:{refine:!0,init:"cv-file-contextmenu"},active:{check:"Boolean",init:!1}},members:{_commandGroup:null,_selectedNode:null,_dateFormat:null,_timeFormat:null,_renameDialog:null,_noCompare:!1,configure:function(e){this._selectedNode=e;if(e){var t="dir"===e.getType(),i=t?e:e.getParent(),n=!1;(i&&i.getFullPath().startsWith("backup")||e.getFullPath().startsWith("backup"))&&(n=!0);if(t){this.getChildControl("new-file-button").set({enabled:!(!i||n)&&i.isWriteable(),visibility:"visible"});this.getChildControl("new-folder-button").set({enabled:!(!i||n)&&i.isWriteable(),visibility:"visible"})}else{this.getChildControl("new-file-button").exclude();this.getChildControl("new-folder-button").exclude()}this.getChildControl("clone-file-button").setVisibility(e.isConfigFile()&&!n?"visible":"excluded");this.getChildControl("delete-button").setLabel(e.isTrash()?this.tr("Clear"):this.tr("Delete"));if(!this._noCompare){var a=this.getChildControl("compare-menu");a.removeAll();if(n)this.getChildControl("compare-with-button").exclude();else{this.getChildControl("compare-with-button").show();var r=cv.ui.manager.model.BackupFolder.getInstance().getBackupFiles(e);this.getChildControl("compare-with-button").setEnabled(r.length>0);r.sort(function(e,t){return t.date.getTime()-e.date.getTime()});var o=null;r.forEach(function(e){var t=this._dateFormat.format(e.date);if(o!==t){null!==o&&a.add(new qx.ui.menu.Separator);var i=new qx.ui.menu.Button(t);i.setEnabled(!1);a.add(i);o=t}var n=new qx.ui.menu.Button(this.tr("Backup from %1",this._timeFormat.format(e.date)));n.setUserData("file",e.file);n.addListener("execute",this._onCompareWith,this);a.add(n)},this)}}var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e),l=this.getChildControl("open-with-menu");l.removeAll();if(n)this.getChildControl("open-with-button").exclude();else{this.getChildControl("open-with-button").show();var c=cv.ui.manager.control.FileHandlerRegistry.getInstance().getAllFileHandlers(e);this.getChildControl("open-with-button").setEnabled(c.length>1);c.sort(function(e,t){return e.Clazz.constructor.TITLE.toString().localeCompare(t.Clazz.constructor.TITLE.toString())});c.forEach(function(e){var t=new qx.ui.menu.Button(e.Clazz.constructor.TITLE,e.Clazz.constructor.ICON);t.setAppearance("open-with-button");s.Clazz.classname===e.Clazz.classname&&t.addState("default");t.setUserData("handlerId",e.Clazz.classname);t.addListener("execute",this._onOpenWith,this);l.add(t)},this)}this.getChildControl("validate-config-button").setVisibility(!e.isConfigFile()||e.isMounted()||n?"excluded":"visible");if(t||n)this.getChildControl("replace-button").exclude();else{this.getChildControl("replace-button").show();this._replacementManager.setFilename(e.getName());this._replacementManager.setFolder(e.getParent())}["delete-button","replace-button","rename-button"].forEach(function(t){this.getChildControl(t).setEnabled(!e.isFake()&&e.isWriteable()&&(!n||"delete-button"===t))},this);this.getChildControl("download-button").setEnabled(!e.isFake()&&"file"===e.getType());this.getChildControl("restore-button").setVisibility(e.isInTrash()||n?"visible":"excluded")}else{this.getChildControl("delete-button").set({label:this.tr("Delete"),enabled:!1});this.getChildControl("replace-button").exclude();this.getChildControl("download-button").setEnabled(!1);this.getChildControl("restore-button").exclude()}},_init:function(){this._noNew||this.add(this.getChildControl("new-file-button"));this.add(this.getChildControl("clone-file-button"));this._noNew||this.add(this.getChildControl("new-folder-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("open-button"));this.add(this.getChildControl("open-with-button"));this._noCompare||this.add(this.getChildControl("compare-with-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("rename-button"));this.add(this.getChildControl("delete-button"));this.add(this.getChildControl("restore-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("download-button"));var e=new qx.ui.menu.Separator,t=this.getChildControl("replace-button");this.add(e);this.add(t);t.bind("visibility",e,"visibility");e=new qx.ui.menu.Separator;(t=this.getChildControl("validate-config-button")).bind("visibility",e,"visibility");this.add(e);this.add(t)},_onCompareWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("file");qx.event.message.Bus.dispatchByName("cv.manager.compareFiles",new cv.ui.manager.model.CompareFiles(t,this._selectedNode))}},_onOpenWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this._selectedNode,handler:t})}},_onRename:function(){if(this._selectedNode&&!this._renameDialog&&this.isActive()){this._renameDialog=new dialog.Prompt({message:this.tr("New name"),callback:function(e){e&&e!==this._selectedNode.getName()&&cv.ui.manager.control.FileController.getInstance().rename(this._selectedNode,e)},context:this,value:this._selectedNode.getName(),caption:this.tr("Rename file"),filter:/[\w\d_\-\.\s]/});this._renameDialog.show()}},_onDownload:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().download(this._selectedNode)},_onRestore:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().restore(this._selectedNode)},_onValidate:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().validate(this._selectedNode)},_onClone:function(){this._selectedNode&&this.isActive()&&qx.event.message.Bus.dispatchByName("cv.manager.action.clone",{file:this._selectedNode})},_createChildControlImpl:function(e){var t;switch(e){case"new-file-button":(t=new qx.ui.menu.Button(this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18))).addListener("execute",function(){this._selectedNode.isConfigFile()?qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",this._selectedNode.getParent()):qx.event.message.Bus.dispatchByName("cv.manager.action.new-file","dir"===this._selectedNode.getType()?this._selectedNode:this._selectedNode.getParent())},this);break;case"clone-file-button":(t=new qx.ui.menu.Button(this.tr("Clone file"),cv.theme.dark.Images.getIcon("clone-file",18))).exclude();t.addListener("execute",this._onClone,this);break;case"new-folder-button":(t=new qx.ui.menu.Button(this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder","dir"===this._selectedNode.getType()?this._selectedNode:this._selectedNode.getParent())},this);break;case"rename-button":(t=new qx.ui.menu.Button(this.tr("Rename"),cv.theme.dark.Images.getIcon("rename",18))).addListener("execute",this._onRename,this);break;case"delete-button":(t=new qx.ui.menu.Button(this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.action.delete",this._selectedNode)},this);break;case"download-button":(t=new qx.ui.menu.Button(this.tr("Download"),cv.theme.dark.Images.getIcon("download",18))).addListener("execute",this._onDownload,this);break;case"open-button":(t=new qx.ui.menu.Button(this.tr("Open"),cv.theme.dark.Images.getIcon("open",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.open",this._selectedNode)},this);break;case"restore-button":(t=new qx.ui.menu.Button(this.tr("Restore"),cv.theme.dark.Images.getIcon("trash",18))).exclude();t.addListener("execute",this._onRestore,this);break;case"validate-config-button":(t=new qx.ui.menu.Button(this.tr("Validate"),cv.theme.dark.Images.getIcon("validate",18))).exclude();t.addListener("execute",this._onValidate,this);break;case"replace-button":(t=new com.zenesis.qx.upload.UploadMenuButton(this.tr("Replace"),cv.theme.dark.Images.getIcon("upload",18))).exclude();this._replacementManager=new cv.ui.manager.upload.UploadMgr;this._replacementManager.setForce(!0);this._replacementManager.addWidget(t);break;case"compare-menu":t=new qx.ui.menu.Menu;break;case"compare-with-button":t=new qx.ui.menu.Button(this.tr("Compare with..."),cv.theme.dark.Images.getIcon("compare",18),null,this.getChildControl("compare-menu"));break;case"open-with-button":t=new qx.ui.menu.Button(this.tr("Open with..."),cv.theme.dark.Images.getIcon("open-with",18),null,this.getChildControl("open-with-menu"));break;case"open-with-menu":t=new qx.ui.menu.Menu}return t||cv.ui.manager.contextmenu.FileItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._commandGroup=null;this._renameDialog=null;this._disposeObjects("_dateFormat","_timeFormat")}});cv.ui.manager.contextmenu.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.contextmenu.FileItem":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.GlobalFileItem",{extend:cv.ui.manager.contextmenu.FileItem,type:"singleton"});cv.ui.manager.contextmenu.GlobalFileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.tree.VirtualTreeItem":{require:!0},"qx.event.message.Bus":{},"cv.ui.manager.control.FileController":{},"qx.ui.form.TextField":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.VirtualFsItem",{extend:qx.ui.tree.VirtualTreeItem,properties:{appearance:{refine:!0,init:"fs-tree-item"},editing:{check:"Boolean",init:!1,apply:"_applyEditing"},name:{check:"String",init:"",event:"changeName"},temporary:{check:"Boolean",init:!1,apply:"_applyTemporary"},status:{check:["valid","error"],nullable:!0,apply:"_applyStatus"}},members:{_applyEditing:function(e,t){if(e!==t){var i=this.getChildControl("edit");if(e){i.setValue(this.getLabel());i.show();qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!1)}else{qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!0);i.exclude();i.getValue()!==this.getName()&&cv.ui.manager.control.FileController.getInstance().rename(this.getModel(),i.getValue())}}},_applyTemporary:function(e){e?this.addState("temporary"):this.removeState("temporary")},_applyModel:function(e,t){cv.ui.manager.tree.VirtualFsItem.prototype._applyModel.base.call(this,e,t);t&&t.removeRelatedBindings(this);if(e){if(e.isTrash())this.setLabel(this.tr("Trash"));else{e.bind("name",this,"label");e.bind("valid",this,"status",{converter:function(e){return!0===e?"valid":"error"}})}e.bind("temporary",this,"temporary");if("dir"===e.getType()){this.setDroppable(!0);this.addListener("drop",this._onDrop,this)}else{this.setDroppable(!1);this.removeListener("drop",this._onDrop,this)}}},_applyStatus:function(e){var t=this.getChildControl("icon");if(e)switch(e){case"valid":t.removeState("error");break;case"error":t.addState("error")}},_onDrop:function(e){console.log(e.getRelatedTarget())},__P_41_0:function(){this.getChildControl("edit").setValue(this.getName());this.setEditing(!1)},_onKeypress:function(e){"Enter"===e.getKeyIdentifier()?this.setEditing(!1):"Esc"===e.getKeyIdentifier()&&this.__P_41_0()},_createChildControlImpl:function(e){var t;switch(e){case"edit":(t=new qx.ui.form.TextField).addListener("keypress",this._onKeypress,this);t.exclude();t.addListener("changeVisibility",function(e){"visible"===e.getData()?this.getChildControl("label").exclude():this.getChildControl("label").show()},this);t.addListener("blur",function(){this.setEditing(!1)},this);this._add(t)}return t||cv.ui.manager.tree.VirtualFsItem.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.tree.VirtualFsItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.tree.FileSystem":{},"dialog.Dialog":{},"qx.lang.String":{},"qx.event.message.Bus":{},"cv.ui.manager.viewer.Image":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.theme.dark.Images":{},"qx.ui.basic.Atom":{},"qx.ui.basic.Label":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{},"cv.ui.manager.control.FileController":{},"qx.event.type.Tap":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileListItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],include:[cv.ui.manager.upload.MDragUpload],construct:function(e,t,i){qx.ui.core.Widget.constructor.call(this,e,t);var n=new qx.ui.layout.Canvas;n.setDesktop(!0);this._setLayout(n);i&&this.setModel(i);this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this);cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._maintainFileActions,this);this.setUploadHint(this.tr("Drop the file here to replace the content."))},events:{action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0,check:"cv.ui.manager.model.FileItem"},showFileActions:{check:"Boolean",init:!1,apply:"_maintainFileActions"},label:{nullable:!0,check:"String",event:"changeLabel"},icon:{check:"String",nullable:!0,themeable:!0,event:"changeIcon"},gap:{check:"Integer",nullable:!1,event:"changeGap",themeable:!0,init:4},show:{init:"both",check:["both","label","icon"],themeable:!0,inheritable:!0,event:"changeShow"},iconPosition:{init:"left",check:["top","right","bottom","left","top-left","bottom-left","top-right","bottom-right"],themeable:!0,event:"changeIconPosition"},center:{init:!1,check:"Boolean",themeable:!0,event:"changeCenter"},acceptUpload:{init:null,nullable:!0,check:"String"},viewMode:{check:["list","preview"],init:"preview",apply:"_applyViewMode"}},members:{_uploadManager:null,_forwardStates:{focused:!0,selected:!0,dragover:!0,hovered:!0},_applyViewMode:function(){switch(this.getViewMode()){case"list":this.addState("list");this.getChildControl("atom").setLayoutProperties({left:10,top:0,bottom:0,right:null});this.getChildControl("bottom-bar").setLayoutProperties({top:0,bottom:0,right:0,left:null});break;case"preview":this.removeState("list");this.getChildControl("atom").setLayoutProperties({left:0,top:0,bottom:34,right:0});this.getChildControl("bottom-bar").setLayoutProperties({left:0,bottom:0,right:0,top:null})}},_onPointerOver:function(){this.addState("hovered")},_onPointerOut:function(){this.removeState("hovered")},_isDroppable:function(e){if(1===e.length){return"add-file"===this.getModel().getSpecial()||cv.ui.manager.tree.FileSystem.getMimetypeFromSuffix(this.getModel().getName().split(".").pop())===e[0].type}return!1},_onDrop:function(e){e.preventDefault();"add-file"===this.getModel().getSpecial()?cv.ui.manager.upload.MDragUpload.uploadFile(cv.ui.manager.upload.MDragUpload.getFiles(e)[0]):dialog.Dialog.confirm(this.tr("Do you really want to replace the '%1' with the uploaded files content?",this.getModel().getName()),function(t){if(t){var i=cv.ui.manager.upload.MDragUpload.getFiles(e)[0];cv.ui.manager.upload.MDragUpload.uploadFile(i,this.getModel())}},this);this._onStopDragging(e)},_applyModel:function(e){if(e&&"file"===e.getType()){var t=this.getChildControl("file-type");if(!e.isFake()){var i=e.getName();this.getChildControl("atom").setToolTipText(this.tr('Double click to open "%1"',i));var n=i.split(".").pop();if(n.length<=4){var a=!1;switch(n){case"xml":t.setValue("</>");a=!0;break;case"js":n=qx.lang.String.firstUp(n);case"css":case"conf":t.setValue(n);a=!0}a&&"preview"===this.getViewMode()?t.show():t.exclude()}else t.exclude()}}else{this.getChildControl("file-type").exclude();this.getChildControl("atom").resetToolTipText()}this._maintainFileActions()},_onOpenWith:function(e){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this.getModel(),handler:t})},_applyIcon:function(e,t){cv.ui.manager.form.FileListItem.prototype._applyIcon.base.call(this,e,t);if(e&&!e.startsWith("@")){var i=this.getChildControl("atom").getChildControl("icon");cv.ui.manager.viewer.Image.getImageData(e)?this.__P_35_0():i.addListenerOnce("loaded",this.__P_35_0,this)}},_maintainFileActions:function(){var e=this.getModel();if(this.isShowFileActions()&&e){this.getChildControl("download-button").setVisibility("dir"===e.getType()||e.isFake()?"excluded":"visible");this.getChildControl("action-button").setVisibility(e.isFake()?"excluded":"visible");var t=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"edit"),i=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"view"),n=this.getChildControl("open-button"),a=this.getChildControl("edit-button");if(e.isWriteable()&&t){a.setUserData("handlerId",t.Clazz.classname);a.set({icon:t.Clazz.ICON||cv.theme.dark.Images.getIcon("edit",18),enabled:!0,toolTipText:t.Clazz.TITLE?t.Clazz.TITLE.translate().toString():""});a.show()}else a.exclude();if(i){n.setUserData("handlerId",i.Clazz.classname);n.set({icon:i.Clazz.ICON||cv.theme.dark.Images.getIcon("preview",18),enabled:!0,toolTipText:i.Clazz.TITLE?i.Clazz.TITLE.translate().toString():""});n.show()}else n.exclude();this.getChildControl("action-button");this.getChildControl("bottom-bar").show()}else this.getChildControl("bottom-bar").exclude()},__P_35_0:function(){var e=cv.ui.manager.viewer.Image.getImageData(this.getIcon()),t=this.getChildControl("atom").getChildControl("icon"),i=t.getSizeHint(),n=i.width,a=Math.round(1/e.aspectRatio*n),r=[0,0,0,0];if(a>i.height){a=i.height;n=Math.round(e.aspectRatio*a);r[1]=Math.round((i.width-n)/2);r[3]=r[1]}else{r[0]=Math.round((i.height-a)/2);r[2]=r[0]}t.setPadding(r)},_maintainFileTypePosition:function(){var e=this.getChildControl("atom").getChildControl("icon").getBounds(),t=Math.round(e.top+e.height/2);this.getChildControl("file-type").setLayoutProperties({left:e.left,top:t,right:e.left+e.width,bottom:t+18})},_createChildControlImpl:function(e){var t;switch(e){case"atom":t=new qx.ui.basic.Atom;["label","icon","gap","iconPosition","show","center"].forEach(function(e){this.bind(e,t,e)},this);t.setAnonymous(!0);this._add(t,{top:0,left:0,right:0,bottom:34});break;case"file-type":(t=new qx.ui.basic.Label).set({zIndex:100,anonymous:!0,font:"title",textAlign:"center",textColor:"background-main",minWidth:70});var i=this.getChildControl("atom").getChildControl("icon");i.bind("visibility",t,"visibility");i.addListener("resize",this._maintainFileTypePosition,this);this._add(t,{width:"100%"});break;case"bottom-bar":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox(4,"center"))).setAnonymous(!0);this._add(t,{left:0,bottom:0,right:0});break;case"download-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("download",18))).setToolTipText(this.tr("Download file"));t.addListener("execute",function(){cv.ui.manager.control.FileController.getInstance().download(this.getModel())},this);this.getChildControl("bottom-bar").add(t);break;case"action-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("menu",18))).setToolTipText(this.tr("Other file actions"));this.getChildControl("bottom-bar").add(t);t.addListener("tap",function(e){this.fireEvent("action",qx.event.type.Tap,[e.getNativeEvent(),this,e.getTarget(),!1,!0])},this);break;case"open-button":case"edit-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("preview",18))).addListener("execute",function(){qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this.getModel(),handler:t.getUserData("handlerId")})},this);this.getChildControl("bottom-bar").add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.form.FileListItem.prototype._createChildControlImpl.base.call(this,e)},capture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.prototype.capture.base.call(this)},releaseCapture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.prototype.releaseCapture.base.call(this)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this);this._disposeObjects("_uploadManager");cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._maintainFileActions,this)}});cv.ui.manager.form.FileListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.basic.Atom":{require:!0},"cv.ui.manager.viewer.SvgIcon":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.IconAtom",{extend:qx.ui.basic.Atom,properties:{appearance:{refine:!0,init:"cv-icon"}},members:{_applyLabel:function(e){cv.ui.manager.core.IconAtom.prototype._applyLabel.base.call(this,e);this.getChildControl("icon").setName(e)},_handleIcon:function(){this.getChildControl("icon").getName()&&"label"!==this.getShow()?this._showChildControl("icon"):this._excludeChildControl("icon")},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new cv.ui.manager.viewer.SvgIcon).setAnonymous(!0);this._addAt(t,0)}return t||cv.ui.manager.core.IconAtom.prototype._createChildControlImpl.base.call(this,e)}}});cv.ui.manager.core.IconAtom.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.editor.data.Provider":{construct:!0},"qx.xml.Document":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.Config",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.__P_33_0={};this._schemaNode=e;this._dataProvider=cv.ui.manager.editor.data.Provider.getInstance()},members:{__P_33_0:null,__P_33_1:null,_schemaNode:null,_dataProvider:null,getLastOpenedTag:function(e){var t=e.match(/<\/*(?=\S*)([a-zA-Z-]+)/g);if(t)for(var i=[],n=t.length-1;n>=0;n--)if(0===t[n].indexOf("</"))i.push(t[n].substring("</".length));else{var a=e.lastIndexOf(t[n]),r=t[n].substring("<".length);if(-1===e.indexOf("/>",a)){if(!i.length||i[i.length-1]!==r){var o=(e=e.substring(a)).indexOf("<")>e.indexOf(">"),s=!1,l=null;if(o){var c=/([\w\-_\.\d]+)="[^"]*$/.exec(e);s=!!c;l=c?c[1]:null}var d=/<[\w-_\d]+$/.test(e);return{tagName:r,currentAttribute:l,filteredElementSearch:d,isAttributeSearch:!d&&o&&!s,isContentSearch:s,text:e}}i.splice(i.length-1,1)}e=e.substring(0,a)}},findElements:function(e,t,i,n,a){var r=!0===a?this.__P_33_1:this.__P_33_0;if(t in r)return r[t];if(i<n)return null;e||(e=this._schemaNode.allowedRootElements.pages);void 0===n&&(n=1);var o=e.getAllowedElements();if(t in o){this.__P_33_0[t]=o[t];return o[t]}for(var s in o)if((!0===a||"meta"!==s)&&i>n){var l=this.findElements(o[s],t,i,n+1);if(l){r[t]=l;return l}}},isItemAvailable:function(e,t,i){if((t=t||"1")&&"unbounded"===t)return!0;for(var n=0,a=0;a<i.length;a++)i[a]===e&&n++;return 0===n||parseInt(t)>n},getElementString:function(e,t,i){var n=t+i+e.name+" ";Object.getOwnPropertyNames(e.allowedAttributes).forEach(function(t){var i=e.allowedAttributes[t];i.isOptional||(n+=t+'="'+(i.defaultValue?i.defaultValue:"")+'" ')});var a=e.getRequiredElements(),r=e.getAllowedContent();if(r._text||a.length>0||!!r._grouping){n=n.trim()+">";var o=0;a.forEach(function(i){var a=this.findElements(e,i,1,0);if(a){n+="\n    "+this.getElementString(a,t+"    ","<")+">";o++}},this);o>0&&(n+="\n"+t);n+="</"+e.name}else n=n.trim()+"/";return n},getAvailableElements:function(e,t){var i=[],n=e.getAllowedElements();if(!n)return[];Object.getOwnPropertyNames(n).forEach(function(e){var a=n[e];this.isItemAvailable(a.name,a.getBounds().max,t)&&i.push({label:a.name,insertText:this.getElementString(a,"",""),kind:window.monaco.languages.CompletionItemKind.Field,detail:a.type,documentation:a.getDocumentation().join("\n")})},this);return i},getAvailableAttributes:function(e,t){var i=[],n=e.allowedAttributes;Object.getOwnPropertyNames(n).forEach(function(e){var a=n[e];-1===t.indexOf(a.name)&&i.push({label:a.name,insertText:a.name+'=""',kind:window.monaco.languages.CompletionItemKind.Property,detail:a.getTypeString(),documentation:a.getDocumentation().join("\n")})},this);return i},getProvider:function(){return{triggerCharacters:["<",'"'],provideCompletionItems:function(e,t){for(var i,n,a=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),r=e.getValue(),o=r.indexOf("</meta>"),s=o>0?r.substring(0,o):r,l=[],c=[],d={},u=/<mapping name="([^"]+)"/gm;null!==(i=u.exec(s));)l.push(i[1]);u=/<styling name="([^"]+)"/gm;for(;null!==(i=u.exec(s));)c.push(i[1]);var h=s.indexOf("<templates>");if(h>=0){s.substring(h+11,s.indexOf("</templates>")-12).replace(/(?:\r\n|\r|\n)/g,"").split("</template>").forEach(function(e){for(var t=/<template name="([^"]+)"/.exec(e),i=[],a=/{{{?\s*([\w\d]+)\s*}?}}/gm;null!==(n=a.exec(e));)i.push(n[1]);d[t[1]]=i},this)}var g,m=this.getLastOpenedTag(a),f=[],p=[],_=[],v=m&&m.isAttributeSearch,b=m&&m.isContentSearch,C=m&&m.filteredElementSearch;if(m){(g=m.text.split(" ")).shift();var x=a;g.length&&(x=x.substring(0,x.length-g.join(" ").length)+">");for(var w,y=qx.xml.Document.fromString(x).lastElementChild,q=!1;y;){f.push(y.tagName);p.push(y.attributes);if(y.tagName===m.tagName){q=!0;if(m.isAttributeSearch&&y.outerHTML===m.text){var I=y.attributes;for(w=0;w<I.length;w++)_.push(I[w].nodeName)}else{var F=y.children;for(w=0;w<F.length;w++)"parsererror"!==F[w].tagName.toLowerCase()&&_.push(F[w].tagName)}break}y=y.lastElementChild}if(!q&&(v||b)){(g=m.text.split(" ")).shift();g.forEach(function(e){_.push(e.split("=").shift())})}}var k,P=[],S=f[f.length-1];if(b){if("pages"===m.tagName&&"design"===m.currentAttribute)return this._dataProvider.getDesigns().then(function(e){return{suggestions:e}});if("address"===m.tagName&&"transform"===m.currentAttribute)return{suggestions:this._dataProvider.getTransforms()};if("plugin"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getPlugins()};if("icon"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getIcons()};if("influx"===m.tagName){if("measurement"===m.currentAttribute)return this._dataProvider.getInfluxDBs().then(function(e){return{suggestions:e}});if("field"===m.currentAttribute&&(k=/measurement="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBFields(k[1]).then(function(e){return{suggestions:e}})}else if("tag"!==m.tagName||"key"!==m.currentAttribute&&"value"!==m.currentAttribute||!f.includes("influx")){if("template"===m.tagName&&"name"===m.currentAttribute&&f.includes("meta"))return{suggestions:P=Object.keys(d).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)};if("value"===m.tagName&&"name"===m.currentAttribute&&!f.includes("meta")&&f.includes("template")){Object.keys(d).forEach(function(e){d[e].forEach(function(t){P.push({label:t,insertText:t,detail:qx.locale.Manager.tr("Variable from template %1",e),kind:window.monaco.languages.CompletionItemKind.Variable})},this)},this);return{suggestions:P}}if("mapping"===m.currentAttribute)return{suggestions:P=l.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)};if("styling"===m.currentAttribute)return{suggestions:P=c.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}},this)}}else{var M=p[f.indexOf("influx")].getNamedItem("measurement");if(M){if("key"===m.currentAttribute)return this._dataProvider.getInfluxDBTags(M.value).then(function(e){return{suggestions:e}});if("value"===m.currentAttribute&&(k=/key="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBValues(M.value,k[1]).then(function(e){return{suggestions:e}})}}S=m.tagName}else!v&&C&&(S=f[f.length-2]);if("rrd"===S)return{suggestions:this._dataProvider.getRrds()};if("file"===S&&!v&&!b&&f.includes("files")){var T=(k=/type="([^"]+)"/.exec(m.text))?k[1]:null;return this._dataProvider.getMediaFiles(T).then(function(e){return{suggestions:e}})}var D=this.findElements(this._schemaNode.allowedRootElements.pages,S,f.length,f.includes("meta"));if(b){var O=_[_.length-1];if(D&&O in D.allowedAttributes){var B=D.allowedAttributes[O],E=B.getTypeString();B.getEnumeration().forEach(function(e){P.push({label:e,kind:window.monaco.languages.CompletionItemKind.Value,detail:E,documentation:B.getDocumentation().join("\n")})})}}else v?P=D?this.getAvailableAttributes(D,_):[]:m&&m.text.endsWith("</")?P.push({label:m.tagName,kind:window.monaco.languages.CompletionItemKind.Field}):P=D?this.getAvailableElements(D,_):[];return{suggestions:P}}.bind(this)}}},destruct:function(){this.__P_33_0=null;this._schemaNode=null;this._dataProvider=null}});cv.ui.manager.editor.completion.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.Version":{},"cv.io.rest.Client":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.CometVisu",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this)},members:{TEMPLATES:null,getTemplates:function(){if(!this.TEMPLATES){this.TEMPLATES=[{filterText:"cvclass",label:"CometVisu-Class",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu class.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.$0", {\n  extend: qx.core.Object,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvwidget",label:"CometVisu-Widget",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a widget.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.ui.structure.pure.$0", {\n  extend: cv.ui.structure.AbstractWidget,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvinterface",label:"CometVisu-Interface",kind:window.monaco.languages.CompletionItemKind.Interface,detail:"A generic CometVisu Interface.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Interface.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmixin",label:"CometVisu-Mixin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu Mixin.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Mixin.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmembers",label:"CometVisu-Class members",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes members section.",insertText:"  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvproperties",label:"CometVisu-Class properties",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes properties section.",insertText:"  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvstatics",label:"CometVisu-Class statics",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"statics section.",insertText:"  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvevents",label:"CometVisu-Class events",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"events section.",insertText:"  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvconstructor",label:"Constructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"constructor.",insertText:"  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvdestructor",label:"Destructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"destructor.",insertText:"  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this.base(arguments);\n    $0\n  }\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace}];return new Promise(function(e,t){cv.io.rest.Client.getFsClient().readSync({path:".templates/Plugin.js"},function(i,n){if(i)t(i);else{this.TEMPLATES.push({filterText:"cvplugin",label:"CometVisu-Plugin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a plugin.",insertText:n.replace("###SINCE###",cv.Version.VERSION.replace("-dev","")+" ($CURRENT_YEAR)"),insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace});e(this.TEMPLATES)}},this)}.bind(this))}return Promise.resolve(this.TEMPLATES)},getProvider:function(){return{triggerCharacters:["cv"],provideCompletionItems:function(){return this.getTemplates().then(function(e){return{suggestions:e}})}.bind(this)}}}});cv.ui.manager.editor.completion.CometVisu.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.model.config.Option":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Section",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.setName(e);this.initOptions(new qx.data.Array)},properties:{name:{check:"String",event:"changeName",init:""},options:{check:"qx.data.Array",deferredInit:!0,event:"changeOptions"}},members:{addOption:function(e,t){var i=this.getOptions();i.some(function(i){i.getKey()===e&&i.setValue(t)},this)||i.push(new cv.ui.manager.model.config.Option(e,t))}}});cv.ui.manager.model.config.Section.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.Grid":{construct:!0},"cv.ui.manager.model.config.Option":{},"qx.ui.basic.Label":{},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.OptionListItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.SectionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);var e=new qx.ui.layout.Grid(8,8);e.setColumnFlex(1,1);e.setColumnAlign(0,"left","top");this._setLayout(e);this._createChildControl("section-title");this._createChildControl("list");this._createChildControl("delete")},properties:{appearance:{refine:!0,init:"cv-editor-config-section"},model:{check:"cv.ui.manager.model.config.Section",nullable:!1,apply:"_applyModel"},modified:{check:"Boolean",init:!1,event:"changeModified"}},events:{delete:"qx.event.type.Data"},members:{_listController:null,_originalName:null,_originalOptions:null,_applyModel:function(e,t){var i=this.getChildControl("name");this.__P_37_0(t);if(e){e.bind("name",i,"value");this._originalName=e.getName();this._originalOptions={};e.getOptions().forEach(function(e){e.addListener("change",this.__P_37_1,this);this._originalOptions[e.getKey()]=e.getValue()},this);i.bind("value",e,"name");e.addListener("changeName",this.__P_37_1,this);e.bind("options",this._listController,"model");if(0===e.getOptions().length){var n=new cv.ui.manager.model.config.Option("","");e.getOptions().push(n)}}else{this._originalName=null;this._originalOptions=null}},__P_37_0:function(e){if(e){var t=this.getChildControl("name");this._listController&&e.removeRelatedBindings(this._listController);e.removeListener("changeName",this.__P_37_1,this);e.removeRelatedBindings(t);t.removeRelatedBindings(e);e.getOptions().forEach(function(e){e.removeListener("change",this.__P_37_1,this)},this)}},__P_37_1:function(){if(this._originalName===this.getModel().getName())if(Object.keys(this._originalOptions).length===this.getModel().getOptions().length){var e=this.getModel().getOptions().some(function(e){return!this._originalOptions.hasOwnProperty(e.getKey())||this._originalOptions[e.getKey()]!==e.getValue()},this);this.setModified(e)}else this.setModified(!0);else this.setModified(!0)},_onDeleteOption:function(e){var t=e.getData();if(1===this.getModel().getOptions().length){t.resetKey();t.resetValue()}else{var i=this.getModel().getOptions().remove(t);i&&i.removeListener("change",this.__P_37_1,this)}this.__P_37_1()},_onAddOption:function(){var e=new cv.ui.manager.model.config.Option("","");e.addListener("change",this.__P_37_1,this);this.getModel().getOptions().push(e);this.__P_37_1()},_createChildControlImpl:function(e){var t;switch(e){case"section-title":t=new qx.ui.basic.Label(this.tr("Section"));this._add(t,{row:0,column:0});break;case"name":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this._add(t,{row:0,column:1});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete section"));t.addListener("execute",function(){this.fireDataEvent("delete",this.getModel())},this);this._add(t,{row:0,column:2});break;case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(null,t);this._listController.setNullValueTitle("header");this._listController.setAllowNull(!0);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.OptionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteOption,this);e.addListener("add",this._onAddOption,this)}.bind(this),bindItem:function(e,t,i){e.bindProperty("","model",null,t,i)}});this._add(t,{row:1,column:1})}return t||cv.ui.manager.form.SectionListItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this._disposeObjects("_listController")}});cv.ui.manager.form.SectionListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.util.ResourceManager":{},"cv.svg.Element":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.SvgIcon",{extend:qx.ui.core.Widget,construct:function(e){qx.ui.core.Widget.constructor.call(this);e&&this.setName(e)},properties:{name:{check:"String",nullable:!0,apply:"_applyName"},appearance:{refine:!0,init:"cv-svg-icon"}},members:{__P_43_0:null,__P_43_1:null,_applyName:function(e){if(e){this.__P_43_0||(this.__P_43_0=qx.util.ResourceManager.getInstance().toUri("icon/knx-uf-iconset.svg"));if(!this.__P_43_1.getDomElement()){this.__P_43_1.addListenerOnce("appear",function(){this._applyName(e)},this);return}this.__P_43_1.getDomElement().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.__P_43_0+"#kuf-"+e)}else this.__P_43_1.removeAttribute("xlink:href")},_createContentElement:function(){var e=new cv.svg.Element("svg");this.__P_43_1=new cv.svg.Element("use");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");e.add(this.__P_43_1);return e}},destruct:function(){this.__P_43_1=null}});cv.ui.manager.viewer.SvgIcon.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"qx.lang.Type":{},"cv.Transform":{},"qx.locale.Manager":{},"qx.io.PartLoader":{},"cv.IconConfig":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.data.Provider",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_34_0={};this._client=cv.io.rest.Client.getDataProviderClient()},members:{__P_34_0:null,_getFromCache:function(e){return this.__P_34_0[e]},__P_34_1:function(e){e?delete this.__P_34_0[e]:this.__P_34_0={}},_addToCache:function(e,t){this.__P_34_0[e]=t},getDesigns:function(){return this.__P_34_2("designs","designsSync",null,[],function(e){return e.map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})},this)},__P_34_2:function(e,t,i,n,a,r){var o=this._getFromCache(e);return o?Promise.resolve(a.call(r||this,o)):new Promise(function(o,s){var l=function(t,i){if(t)s(t);else{this._addToCache(e,i);o(a.call(r||this,i))}};if(n){n.push(l);n.push(this)}else n=[l,this];qx.lang.Type.isString(t)?this._client[t].apply(i||this._client,n):qx.lang.Type.isFunction(t)&&t.apply(i,n)}.bind(this))},getRrds:function(){return this.__P_34_2("rrds","rrdsSync",null,[],this._parseDpResponse,this)},getInfluxDBs:function(){return this.__P_34_2("influxdbs","influxdbsSync",null,[],this._parseDpResponse,this)},getInfluxDBFields:function(e){return this.__P_34_2("influxdbfields|"+e,"influxdbfieldsSync",null,[{measurement:e}],this._parseDpResponse,this)},getInfluxDBTags:function(e){return this.__P_34_2("influxdbtags|"+e,"influxdbtagsSync",null,[{measurement:e}],function(e){return Object.keys(e).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})},this)},getInfluxDBValues:function(e,t){return this.__P_34_2("influxdbtags|"+e,"influxdbtagsSync",null,[{measurement:e}],function(e){var i=[];e[t].forEach(function(e){i.push({label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember})});return i},this)},_parseDpResponse:function(e){var t=[];e.forEach(function(e){t.push({label:e.label,insertText:e.value,kind:window.monaco.languages.CompletionItemKind.EnumMember})},this);return t},getMediaFiles:function(e){var t=cv.io.rest.Client.getFsClient();return this.__P_34_2("media",t.readSync,t,[{path:"media",recursive:!0}],function(t){return t.filter(function(t){return!e||t.name.endsWith("."+e)}).map(function(e){var t=e.parentFolder+e.name;return{label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember}})},this)},getTransforms:function(e){e||(e="monaco");var t="transforms|"+e,i=this._getFromCache(t);if(i)return i;var n=[];Object.keys(cv.Transform.registry).forEach(function(t){var i,a=cv.Transform.registry[t];if("dp"===e)i={label:a.name+" ["+t+"]",value:t};else{i={label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember};a.lname&&a.lname.hasOwnProperty(qx.locale.Manager.getInstance().getLanguage())&&(i.detail=a.lname[qx.locale.Manager.getInstance().getLanguage()])}n.push(i)},this);this._addToCache(t,n);return n},getPlugins:function(e){e||(e="monaco");var t="plugins|"+e,i=this._getFromCache(t);if(i)return i;var n=[],a=qx.io.PartLoader.getInstance().getParts();Object.keys(a).forEach(function(t){if(t.startsWith("plugin-")){var i=t.substring(7);"dp"===e?n.push({label:i,value:i}):n.push({label:i,insertText:i,kind:window.monaco.languages.CompletionItemKind.EnumMember})}},this);this._addToCache(t,n);return n},getIcons:function(e){e||(e="monaco");var t,i="icons|"+e,n=this._getFromCache(i);if(n)return n;"monaco"===e?t=Object.keys(cv.IconConfig.DB).map(function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}):"dp"===e&&(t=Object.keys(cv.IconConfig.DB).map(function(e){return{label:e,value:e}}));this._addToCache(i,t);return t}},destruct:function(){this.__P_34_0=null}});cv.ui.manager.editor.data.Provider.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Option",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setKey(e);this.setValue(t)},events:{change:"qx.event.type.Event"},properties:{key:{check:"String",init:"",event:"changeKey",apply:"_applyChange"},value:{check:"String",init:"",event:"changeValue",apply:"_applyChange"}},members:{_applyChange:function(){this.fireEvent("change")}}});cv.ui.manager.model.config.Option.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.OptionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this._createChildControl("key");this._createChildControl("value");this._createChildControl("key-title");this._createChildControl("value-title");this._createChildControl("delete");this._createChildControl("add")},properties:{appearance:{refine:!0,init:"cv-editor-config-option"},model:{check:"cv.ui.manager.model.config.Option",nullable:!0,apply:"_applyModel"}},events:{delete:"qx.event.type.Data",add:"qx.event.type.Event"},members:{setLabel:function(e){},setIcon:function(){},_applyModel:function(e,t){var i=this.getChildControl("key"),n=this.getChildControl("value"),a=this.getChildControl("key-title"),r=this.getChildControl("value-title");this.__P_36_0(t);if(e){e.bind("key",i,"value");e.bind("value",n,"value");i.bind("value",e,"key");n.bind("value",e,"value");i.show();n.show();a.exclude();r.exclude();this.getChildControl("delete").show();this.getChildControl("add").show()}else{i.exclude();n.exclude();a.show();r.show();this.getChildControl("delete").hide();this.getChildControl("add").hide()}},__P_36_0:function(e){if(e){var t=this.getChildControl("key"),i=this.getChildControl("value");if(e){e.removeRelatedBindings(t);e.removeRelatedBindings(i);t.removeRelatedBindings(e);i.removeRelatedBindings(e)}}},_createChildControlImpl:function(e){var t;switch(e){case"key":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this._add(t,{width:"40%"});break;case"value":(t=new qx.ui.form.TextField).set({liveUpdate:!0});this._add(t,{width:"40%"});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete option"));t.addListener("execute",function(){this.fireDataEvent("delete",this.getModel())},this);this._add(t);break;case"add":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("add",18))).setToolTipText(this.tr("Add option"));t.addListener("execute",function(){this.fireEvent("add")},this);this._add(t);break;case"key-title":(t=new qx.ui.basic.Label(this.tr("Key"))).exclude();this._add(t,{width:"40%"});break;case"value-title":(t=new qx.ui.basic.Label(this.tr("Value"))).exclude();this._add(t,{width:"40%"})}return t||cv.ui.manager.form.OptionListItem.prototype._createChildControlImpl.base.call(this,e)}},destruct:function(){this.__P_36_0(this.getModel())}});cv.ui.manager.form.OptionListItem.$$dbClassInfo=e}();qx.$$packageData[2]={locales:{},resources:{},translations:{en:{},de:{"config folder does not exists":"config Ordner existiert nicht","config folder is not readable":"config Ordner kann nicht gelesen werden","config folder is not writeable":"config Ordner ist nicht beschreibbar","backup folder is not writeable":"backup Ordner ist nicht beschreibbar","media folder is not writeable":"media Ordner ist nicht beschreibbar","Hidden configuration file (hidden.php) not writeable":"Die versteckte Konfiguration (hidden.php) ist nicht beschreibbar.","Cannot load config template":"Template für Konfigurationsdatei kann nicht geladen werden","Cannot load file content":"Dateiinhalt kann nicht geladen werden",'Cannot open file: "%1"':'Datei "%1" kann nicht geöffnet werden',"This file has unsaved changes that will be lost when you close it. Do you really want to close the file?":"Diese Datei enthält ungesicherte Änderungen, die verloren gehen, wenn Sie die Datei schließen. Möchten Sie die Datei wirklich schließen?","This file has not been saved on the backend yet. It will be lost when you close it. Do you really want to close the file?":"Diese Datei wurde noch nicht gespeichert. Sie wird verloren gehen, wenn Sie sie schließen. Möchten Sie die Datei wirklich schließen?","Unsaved changes":"Nicht gespeicherte Änderungen",'Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)':'Bitte geben Sie den Namen der neuen Konfiguraton (ohne "visu_config_" am Anfang und ".xml" am Ende) ein',"A configuration with this name already exists.":"Eine Konfigurationsdatei mit diesem Namen existiert bereits.","Please enter the file name.":"Bitte geben Sie den Dateinamen ein.","A file with this name already exists.":"Eine Datei mit diesem Namen exisitert bereits.","Please enter the folder name.":"Bitte geben Sie den Namen des Ordners ein.","A folder with this name already exists.":"Eine Ordner mit diesem Namen exisitert bereits.","Folder has been created":"Verzeichnis wurde erstellt","Hidden configuration":"Versteckte Konfiguration","File has been created":"Datei wurde erstellt","File has been saved":"Datei wurde gespeichert","Diff: %1":"Vergleich: %1",'File "%1" has been created':'Datei "%1" wurde angelegt','Folder "%1" has been created':'Ordner "%1" wurde angelegt','File "%1" has been renamed':'Datei "%1" wurde umbenannt','Folder "%1" has been renamed':'Ordner "%1" wurde umbenannt','File "%1" has been moved':'Datei "%1" wurde verschoben','Folder "%1" has been moved':'Ordner "%1" wurde verschoben',"%1 has been restored":"%1 wurde wieder hergestellt",'File "%1" has been restored':'Datei "%1" wurde wieder hergestellt','Folder "%1" has been restored':'Ordner "%1" wurde wieder hergestellt',"Do you really want to clear the trash?":"Mächten Sie den Papirtkorb wirklich leeren?",'Do you really want to delete file "%1" from the trash?':'Möchten Sie die Datei "%1" wirklich aus dem Papierkorb löschen?','Do you really want to delete folder "%1" from the trash?':'Möchten Sie den Ordner "%1" wirklich aus dem Papierkorb löschen?','Do you really want to delete file "%1"?':'Möchten Sie die Datei "%1" wirklich löschen?','Do you really want to delete folder "%1"?':'Möchten Sie den Ordner "%1" wirklich löschen?',"Confirm deletion":"Löschen bestätigen","Trash has been cleared":"Der Papierkorb wurde geleert",'File "%1" has been removed from trash':'Datei "%1" wurde aus dem Papierkorb gelöscht','Folder "%1" has been removed from trash':'Ornder "%1" wurde aus dem Papierkorb gelöscht','File "%1" has been deleted':'Datei "%1" wurde gelöscht','Folder "%1" has been deleted':'Ordner "%1" wurde gelöscht',"Validating %1":"Prüfe %1","%1 has no errors!":"%1 hat keine Fehler!","%1 error found in %2!":"%1 Fehler gefunden in %2!","%1 errors found in %2!":"%1 Fehler gefunden in %2!","New file":"Neue Datei","New folder":"Neuer Ordner","New config file":"Neue Konfigurationsdatei","Upload file":"Datei hochladen",Save:"Speichern","Save as...":"Speichern unter...",Delete:"Löschen",Quit:"Beenden",Undo:"Rückgängig","Ctrl+Z":"Strg+Z",Redo:"Wiederholen","Ctrl+Y":"Strg+Y",Cut:"Ausschneiden","Ctrl+X":"Strg+X",Copy:"Kopieren","Ctrl+C":"Strg+C",Paste:"Einfügen","Ctrl+V":"Strg+V","Use text editor":"Texteditor benutzen","Use xml editor":"XML-Editor benutzen","Enable quick preview":"Schnellvorschau aktivieren","Expert mode":"Expertenansicht","CometVisu Manager":"CometVisu Manager",File:"Datei",Edit:"Bearbeiten",New:"Neu",Preferences:"Einstellungen","Replacing the file failed.":"Das Ersetzen der Datei ist fehlgeschlagen.","This file already exists, do you want to replace it?":"Diese Datei existiert bereits, möchten Sie sie überschreiben?","File already exists":"Diese Datei existiert bereits","Uploading this file is not allowed here.":"Das Hochladen der Datei ist an dieser Stelle nicht erleubt.","File upload stopped with an error: %1":"Das Hochladen der Datei wurde mit einem Fehler beendet: %1","File has been uploaded":"Die Datei wurde hochgeladen",Download:"Herunterladen",Validate:"Prüfen",Reload:"Neu laden","This file is not writeable":"Diese Datei ist nicht änderbar","Show image":"Bild anzeigen","Config viewer":"Konfiguration anzeigen","%1 is no configuration file":"%1 ist keine Konfigurationsdatei","Show folder":"Ordner anzeigen","Filter by name...":"Nach Namen filtern...","Show icons":"Icons anzeigen","List mode":"Listenansicht","Preview mode":"Vorschau-Modus",Configurations:"Konfigurationen","Demo configurations":"Demo Konfigurationen","Media files":"Mediendateien",Miscellaneous:"Sonstiges",Texteditor:"Texteditor","Hidden config is invalid, please correct the errors":"Die versteckte Konfiguration ist ungültig, bitte beheben Sie die Fehler","Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?":"Die versteckte Konfiguration enthält eventuell Fehler! Es wird empfohlen die Warnungen zu beheben, bevor gespeichert wird. Trotzdem speichern?","Confirm saving with warnings":"Speichen trotz Warnungen bestätigen","Saving hidden config failed with error %1 (%2)":"Das Speichern der versteckten Konfiguration ist fehlgeschlagen: %1 (%2)","Hidden config has been saved":"Die Verstackte Konfiguration wurde gespeichert","Xml-editor":"XML-Editor","The XML-Editor does not support files that are not writeable!":"Der XML-Editor unterstützt keine Dateien, die nicht gespeichert werden können!","File compare":"Datei vergleichen","The following changes have been made":"Die folgendenen Änderungen wurden vorgenommen","You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.":"Sie können die Änderungen im Editor überprüfen. Die linke Seite zeigt den Inhalt vor der Aktualisierung, die rechte Seite nachher.","No changes have been made":"Es wurden keine Änderungen vorgenommen","Config file has been upgraded to the current library version.":"Die Konfigurations-Datei wurde auf die aktuelle Version aktualisiert.",'Click "Apply" if you want to save the changes and reload the browser.':'Klicken Sie "Anwenden", wenn Sie die Änderungen speichern und die aktualisierte Konfigurations-Datei laden möchten.','Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.':'Klicken Sie "Prüfen", wenn Sie die Änderungen überprüfen möchten. In diesem Fall müssen Sie selbst die Datei speichern und den Browser neu laden, damit die Änderungen wirksam werden.',"Upgrade successful":"Aktualisierung erfolgreich",Apply:"Anwenden",Check:"Prüfen",'Section name duplicate: "%1".':'Doppelter Sektionsname: "%1".','Option key duplicate: "%1" in section "%2".':'Doppelter Optionsname "%1" in Sektion "%2".',"Section is invalid and has not been saved.":"Diese Sektion ist ungültig und wurde nicht gespeichert.","Add section":"Sektion hinzufügen",Clear:"Leeren","Backup from %1":"Sicherung vom %1","New name":"Neuer Name","Rename file":"Datei umbenennen","Clone file":"Datei duplizieren",Rename:"Umbenennen",Open:"Öffnen",Restore:"Wiederherstellen",Replace:"Ersetzen","Compare with...":"Vergleichen mit...","Open with...":"Öffnen mit...",Trash:"Papierkorb","Drop the file here to replace the content.":"Lassen Sie die Datei hier fallen um den Inhalt zu ersetzen.","Do you really want to replace the '%1' with the uploaded files content?":"Möchten Sie wirklich '%1' mit der hochgeladenen Datei ersetzen?",'Double click to open "%1"':'Doppelklick zum Öffnen von "%1"',"Download file":"Datei herunterladen","Other file actions":"Andere Datei-Aktionen","Variable from template %1":"Variable aus Template %1",Section:"Sektion","Delete section":"Sektion löschen","Delete option":"Option löschen","Add option":"Option hinzufügen",Key:"Schlüssel",Value:"Wert"}}};
//# sourceMappingURL=package-2.js.map