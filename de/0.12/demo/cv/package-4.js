function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);return"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){r.push(s.value);if(e&&r.length===e)break}}catch(t){n=!0;o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){var t={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"cv.util.Function":{},"qx.util.ResourceManager":{},"cv.ui.PopupHandler":{},"cv.TemplateEngine":{},"cv.Transform":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(t);qx.Class.define("cv.plugins.Clock",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update],construct:function(t){t.value=new Date;this.__P_8_0=[];cv.ui.structure.AbstractWidget.constructor.call(this,t)},properties:{src:{check:"String"},srcPopup:{check:"String"},titlePopup:{check:"String"},hide24h:{check:"Boolean",init:!1},hide24hPopup:{check:"Boolean",init:!1},hideAMPM:{check:"Boolean",init:!1},hideAMPMPopup:{check:"Boolean",init:!1},hideDigits:{check:"Boolean",init:!1},hideDigitsPopup:{check:"Boolean",init:!1},hideSeconds:{check:"Boolean",init:!1},hideSecondsPopup:{check:"Boolean",init:!1},sendOnFinish:{check:"Boolean",init:!1}},statics:{parse:function(t,e,r,i){var n=cv.parser.WidgetParser.parseElement(this,t,e,r,i,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseFormat(t,e);cv.parser.WidgetParser.parseAddress(t,e);return n},getAttributeToPropertyMappings:function(){var t=function(t){return"true"===t};return{src:{default:"plugins/clock/clock_pure.svg"},src_popup:{target:"srcPopup",default:""},title_popup:{target:"titlePopup",default:""},hide_24h:{target:"hide24h",default:!1,transform:t},hide_24h_popup:{target:"hide24hPopup",default:!1,transform:t},hide_am_pm:{target:"hideAMPM",default:!1,transform:t},hide_am_pm_popup:{target:"hideAMPMPopup",default:!1,transform:t},hide_digits:{target:"hideDigits",default:!1,transform:t},hide_digits_popup:{target:"hideDigitsPopup",default:!1,transform:t},hide_seconds:{target:"hideSeconds",default:!1,transform:t},hide_seconds_popup:{target:"hideSecondsPopup",default:!1,transform:t},send_on_finish:{target:"sendOnFinish",default:!1,transform:t}}},getElements:function(t,e,r,i,n){for(var o,s={hour24:t.querySelector("#Hour24"),hour:t.querySelector("#Hour"),minute:t.querySelector("#Minute"),second:t.querySelector("#Second"),am:t.querySelector("#AM"),pm:t.querySelector("#PM"),digits:t.querySelector("#Digits")};null!==s.digits&&null!==(o=s.digits.querySelector("tspan"));)s.digits=o;var a=t.querySelector("#Hour24Group");e&&null!==a&&a.setAttribute("display","none");if(r){if(null!==s.am){s.am.setAttribute("display","none");s.am=null}if(null!==s.pm){s.pm.setAttribute("display","none");s.pm=null}}i&&null!==s.digits&&s.digits.setAttribute("display","none");n&&null!==s.second&&s.second.setAttribute("display","none");return s}},members:{__P_8_1:null,__P_8_0:null,__P_8_2:0,__P_8_3:null,_getInnerDomString:function(){return'<div class="actor" style="width:100%;height:100%"></div>'},_onDomReady:function(){var t=this;cv.plugins.Clock.prototype._onDomReady.base.call(this);this.__P_8_4=cv.util.Function.throttle(this.dragAction,250,{trailing:!0},this);var e=qx.util.ResourceManager.getInstance().toUri(this.getSrc()),r=this.getSrcPopup(),i=[window.fetch(e)];if(""!==r){r=qx.util.ResourceManager.getInstance().toUri(r);i.push(window.fetch(r))}Promise.all(i).then(function(t){var i=[];if(!t[0].ok)throw new Error('Not 2xx response for URI "'+e+'"');i.push(t[0].text());if(""!==r){if(!t[1].ok)throw new Error('Not 2xx response for popup URI "'+r+'"');i.push(t[1].text())}return Promise.all(i)}).then(function(e){var r=t.getActor();r.innerHTML=e[0];var i=r.firstElementChild;if(!i.getAttribute("viewBox")){var n=i.getAttribute("width")||300,o=i.getAttribute("height")||150;i.setAttribute("viewBox","0 0 "+n+" "+o)}i.setAttribute("width","100%");i.setAttribute("height","100%");t.__P_8_0=[cv.plugins.Clock.getElements(i,t.getHide24h(),t.getHideAMPM(),t.getHideDigits(),t.getHideSeconds())];if(e.length>1){var s=document.createElement("div"),a=t.getTitlePopup();s.setAttribute("style","width:100%;height:100%;position:absolute;");s.innerHTML=e[1];i.addEventListener("click",function(){cv.ui.PopupHandler.showPopup("clock",{title:a,content:s})});if(!(i=s.firstElementChild).getAttribute("viewBox")){var u=i.getAttribute("width")||300,c=i.getAttribute("height")||150;i.setAttribute("viewBox","0 0 "+u+" "+c)}i.setAttribute("width","100%");i.setAttribute("height","100%");t.__P_8_0.push(cv.plugins.Clock.getElements(i,t.getHide24hPopup(),t.getHideAMPMPopup(),t.getHideDigitsPopup(),t.getHideSecondsPopup()))}i.setAttribute("style","touch-action: none");var l=i.querySelector("#HotSpotHour");l&&l.addEventListener("pointerdown",t);var d=i.querySelector("#HotSpotMinute");d&&d.addEventListener("pointerdown",t);var p=i.querySelector("#HotSpotSecond");p&&p.addEventListener("pointerdown",t);t.__P_8_1=i;null!==t.__P_8_3&&t._updateHands()}).catch(function(e){t.error("There has been a problem with the reading of the clock SVG:",e)})},initListeners:function(){},_update:function(t,e,r){var i=r?e:this.defaultValueHandling(t,e);this.__P_8_3=i.split(":");this._updateHands()},handleEvent:function(t){var e=0,r=1,i=2,n=3;switch(t.type){case"pointerdown":switch(t.target.id){case"HotSpotHour":this.__P_8_2=r;break;case"HotSpotMinute":this.__P_8_2=i;break;case"HotSpotSecond":this.__P_8_2=n;break;default:this.__P_8_2=e;return}document.addEventListener("pointermove",this);document.addEventListener("pointerup",this);t.preventDefault();t.stopPropagation();break;case"pointermove":if(this.__P_8_2===e)return;t.preventDefault();t.stopPropagation();if(t.buttons>0){this.dragHelper(t);break}case"pointerup":case"pointercancel":this.dragHelper(t);this.__P_8_2=e;document.removeEventListener("pointermove",this);document.removeEventListener("pointerup",this)}this.getSendOnFinish()&&"pointerup"!==t.type||this.__P_8_4.call()},dragHelper:function(t){var e,r=1,i=2,n=3,o=this.__P_8_1.getScreenCTM(),s=(t.clientX-o.e)/o.a-60,a=60-(t.clientY-o.f)/o.d,u=(180*Math.atan2(s,a)/Math.PI+360)%360,c=this.getValue();switch(this.__P_8_2){case r:var l=c.getHours(),d=l>=12,p=Math.floor(u/30);e=u%30*2;if(l%12>9&&p<3)if(d){d=!1;c.setDate(c.getDate()+1)}else d=!0;else if(p>9&&l%12<3)if(d)d=!1;else{d=!0;c.setDate(c.getDate()-1)}c.setHours(p+12*d);c.setMinutes(e);break;case i:e=this.getHideSeconds()?Math.round(u/6):Math.floor(u/6);var h=c.getMinutes();h>45&&e<15?c.setHours(c.getHours()+1):e>45&&h<15&&c.setHours(c.getHours()-1);c.setMinutes(e);c.setSeconds(u%6*10);break;case n:var g=Math.round(u/6)%60,_=c.getSeconds();_>45&&g<15?c.setMinutes(c.getMinutes()+1):g>45&&_<15&&c.setMinutes(c.getMinutes()-1);c.setSeconds(g)}this.getHideSeconds()&&c.setSeconds(0);this.__P_8_3=[c.getHours(),c.getMinutes(),c.getSeconds()];this._updateHands()},dragAction:function(){var t=this.getAddress();for(var e in t)!0!==t[e].mode&&cv.TemplateEngine.getInstance().visu.write(e,cv.Transform.encode(t[e].transform,this.getValue()))},_updateHands:function(){var t=this,e=_slicedToArray(this.__P_8_3,3),r=e[0],i=e[1],n=e[2];this.__P_8_0.forEach(function(e){null!==e.hour&&e.hour.setAttribute("transform","rotate("+(r%12*360/12+30*i/60+30*n/60/60)+",0,0)");null!==e.minute&&e.minute.setAttribute("transform","rotate("+(6*i+6*n/60)+",0,0)");null!==e.second&&e.second.setAttribute("transform","rotate("+6*n+",0,0)");null!==e.hour24&&e.hour24.setAttribute("transform","rotate("+(r%24*360/24+15*i/60)+",0,0)");null!==e.am&&e.am.setAttribute("display",r<12?"":"none");null!==e.pm&&e.pm.setAttribute("display",r<12?"none":"");null!==e.digits&&(t.getHideSeconds()?e.digits.textContent=sprintf("%02d:%02d",r,i):e.digits.textContent=sprintf("%02d:%02d:%02d",r,i,n))})}},defer:function(t){cv.parser.WidgetParser.addHandler("clock",cv.plugins.Clock);cv.ui.structure.WidgetFactory.registerClass("clock",t)}});cv.plugins.Clock.$$dbClassInfo=t}();qx.$$packageData[4]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-4.js.map