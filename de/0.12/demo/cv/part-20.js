function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={dependsOn:{"qx.ui.root.Inline":{require:!0,defer:"runtime"},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.Config":{construct:!0},"cv.core.notifications.Router":{construct:!0},"cv.TemplateEngine":{construct:!0},"qx.dom.Element":{},"cv.ui.NotificationCenter":{},"cv.util.IconTools":{},"qx.ui.command.Command":{},"qx.event.Registration":{},"qx.theme.manager.Meta":{},"cv.theme.Dark":{},"qx.ui.layout.VBox":{},"cv.plugins.openhab.Settings":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.openhab.Openhab",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);if(!cv.Config.request.queryKey.hasOwnProperty("preview")){this.__notificationRouter=cv.core.notifications.Router.getInstance();var e=cv.TemplateEngine.getInstance().visu,t=e.getCurrentTransport&&e.getCurrentTransport();t&&t.subscribe("notifications",this._onNotification,this);cv.TemplateEngine.getInstance().executeWhenDomFinished(this._createSettings,this)}},members:{__notificationRouter:null,__settings:null,_openSettings:null,_createSettings:function(){var e=qx.dom.Element.create("section",{id:"qxsettings",html:"<div></div>"});qx.dom.Element.insertAfter(e,document.querySelector("#"+cv.ui.NotificationCenter.getInstance().getRootElementId()+" section.messages"));var t=qx.dom.Element.create("div",{html:cv.util.IconTools.svgKUF("edit_settings")(null,"width: 22px; height: 22px;"),style:"float: left;"});this._openSettings=new qx.ui.command.Command("Ctrl+S");this._openSettings.addListener("execute",function(){cv.ui.NotificationCenter.getInstance().show();this.__settings.show()},this);cv.TemplateEngine.getInstance().getCommands().add("open-settings",this._openSettings);qx.dom.Element.insertBegin(t,document.querySelector("#notification-center footer"));qx.event.Registration.addListener(t,"tap",function(){this.__settings.show()},this);qx.theme.manager.Meta.getInstance().setTheme(cv.theme.Dark);this._inline=new qx.ui.root.Inline(document.querySelector("#qxsettings > div"),!0,!1);this._inline.setLayout(new qx.ui.layout.VBox);this.__settings=new cv.plugins.openhab.Settings;this.__settings.exclude();this._inline.add(this.__settings,{flex:1})},_onNotification:function(e){e.data||this.error("invalid content received from SSE: ",e);var t="object"===_typeof(e.data)?e.data:JSON.parse(e.data);this.__notificationRouter.dispatchMessage(t.topic||"cv.backend",t)}},destruct:function(){this._disposeObjects("__settings","_openSettings");this.__notificationRouter=null},defer:function(e){e.getInstance()}});cv.plugins.openhab.Openhab.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.io.rest.Resource":{},"qx.data.store.Rest":{},"qx.util.Serializer":{},"qx.ui.form.TextField":{},"qx.ui.form.CheckBox":{},"cv.plugins.openhab.renderer.Single":{},"cv.Config":{},"qx.data.controller.Form":{},"qx.ui.basic.Label":{},"qx.ui.form.Form":{},"qx.ui.form.Button":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.openhab.Settings",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox);this.set({padding:10,backgroundColor:"rgba(216, 216, 216, 1.0)",textColor:"rgb(61, 61, 61)"});this.getBounds()?this.getContentElement().setStyle("text-shadow","none"):this.addListenerOnce("appear",function(){this.getContentElement().setStyle("text-shadow","none")},this);this.__servicePid="org.openhab.cometvisu";this.__uri="ui:cometvisu";this._initConfigRestClient()},properties:{modified:{check:"Boolean",init:!1,event:"changeModified"}},members:{__servicePid:null,__uri:null,__configDescriptionResource:null,__service:null,__configDescription:null,__inDom:!1,_store:null,__initialValues:null,_initStore:function(e){var t={get:{method:"GET",url:"/rest/services/"+e+"/config"},delete:{method:"DELETE",url:"/rest/services/"+e+"/config"},put:{method:"PUT",url:"/rest/services/"+e+"/config"}},n=this.__service=new qx.io.rest.Resource(t);this._store=new qx.data.store.Rest(n,"get",{configureRequest:function(e){e.setRequestHeader("Content-Type","application/json")},manipulateData:function(e){var t={};Object.getOwnPropertyNames(e).forEach(function(n){t[n.replace(/[\.>]/g,"_")]=e[n]});t.hasOwnProperty("autoDownload")||(t.autoDownload=!1);return t}});n.get();this._store.addListenerOnce("changeModel",function(){this.__initialValues=JSON.parse(qx.util.Serializer.toJson(this._store.getModel()))},this)},_saveConfig:function(){var e=qx.util.Serializer.toJson(this._store.getModel());e=e.replace(/icons_mapping_/g,"icons.mapping>");e=JSON.parse(e.replace("icons_enableMapping","icons>enableMapping"));this.__service.put(null,e);this.__service.addListenerOnce("putSuccess",this.close,this)},_initConfigRestClient:function(){var e={get:{method:"GET",url:"/rest/config-descriptions/"+this.__uri}},t=this.__configDescriptionResource=new qx.io.rest.Resource(e);t.addListener("getSuccess",function(e){this._createForm(e.getRequest().getResponse())},this);t.configureRequest(function(e){e.setRequestHeader("Content-Type","application/json")});t.get();this._initStore(this.__servicePid)},_createForm:function(e){this._createChildControl("title");var t=this.getChildControl("form");e.parameters.forEach(function(e){var n;switch(e.type){case"TEXT":n=new qx.ui.form.TextField;e.defaultValue&&n.setPlaceholder(e.defaultValue);break;case"BOOLEAN":(n=new qx.ui.form.CheckBox).setValue("true"===e.defaultValue)}e.readOnly&&n.setReadOnly(!0);e.required&&n.setRequired(!0);n.setToolTipText(e.description);n.addListener("changeValue",this._onFormFieldChange,this);t.add(n,e.label,null,e.name,null,e)},this);var n=new cv.plugins.openhab.renderer.Single(t);if(cv.Config.guessIfProxied()){n.setBottomText(this.tr("The CometVisu seems to be delivered by a proxied webserver. Changing configuration values might not have the expected effect. Please proceed only if you know what you are doing."));n.getChildControl("bottom-text").set({padding:10,textAlign:"center",font:"bold"})}n.addButton(this.getChildControl("cancel-button"));n.addButton(this.getChildControl("save-button"));this._addAt(n,1);var i=new qx.data.controller.Form(null,t);this._store.bind("model",i,"model");this.setModified(!1)},_onFormFieldChange:function(){var e=!1,t=this.getChildControl("form").getItems();Object.getOwnPropertyNames(t).some(function(n){if(this.__initialValues[n]!=t[n].getValue()){this.debug(n+" has changed from "+this.__initialValues[n]+" to "+t[n].getValue());e=!0;return!0}},this);this.setModified(e)},_createChildControlImpl:function(e,t){var n;switch(e){case"title":(n=new qx.ui.basic.Label(this.tr("openHAB backend settings"))).set({font:"bold",marginBottom:5,allowGrowX:!0,decorator:"window-caption"});this._addAt(n,0);break;case"form":n=new qx.ui.form.Form;break;case"cancel-button":(n=new qx.ui.form.Button(qx.locale.Manager.tr("Cancel"))).addListener("execute",this.close,this);break;case"save-button":(n=new qx.ui.form.Button(qx.locale.Manager.tr("Save"))).addListener("execute",this._saveConfig,this);this.bind("modified",n,"enabled")}return n||cv.plugins.openhab.Settings.prototype._createChildControlImpl.base.call(this,e,t)},close:function(){this.setVisibility("excluded")}},destruct:function(){this._disposeObjects("__configDescriptionResource","__service","__root","_store","_window")}});cv.plugins.openhab.Settings.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.renderer.AbstractRenderer":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.ui.container.Composite":{},"qx.ui.basic.Label":{},"qx.ui.layout.HBox":{},"qx.ui.form.CheckBox":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.openhab.renderer.Single",{extend:qx.ui.form.renderer.AbstractRenderer,construct:function(e){var t=new qx.ui.layout.VBox(6);this._setLayout(t);qx.ui.form.renderer.AbstractRenderer.constructor.call(this,e)},properties:{bottomText:{check:"String",nullable:!0,apply:"_applyBottomText"}},members:{_applyBottomText:function(e){var t=this.getChildControl("bottom-text");if(e){t.setValue(e);t.show()}else t.exclude()},_createChildControlImpl:function(e,t){var n;switch(e){case"content":n=new qx.ui.container.Composite(new qx.ui.layout.VBox(8));this._addAt(n,1);break;case"bottom-text":(n=new qx.ui.basic.Label(this.getBottomText())).set({rich:!0,wrap:!0});this._addAt(n,2);this.getBottomText()?n.show():n.exclude();break;case"button-container":var i=new qx.ui.layout.HBox;i.setAlignX("right");i.setSpacing(5);n=new qx.ui.container.Composite(i);this._addAt(n,3)}return n||cv.plugins.openhab.renderer.Single.prototype._createChildControlImpl.base.call(this,e,t)},addItems:function(e,t,n){null!==n&&this.getChildControl("content").add(this._createHeader(n));for(var i=this.getChildControl("content"),o=0;o<e.length;o++){var s=this._createLabel(t[o],e[o]),r=e[o];s.setBuddy(r);if(r instanceof qx.ui.form.CheckBox){var a=new qx.ui.container.Composite(new qx.ui.layout.HBox);a.add(s,{width:"50%"});a.add(r,{width:"50%"});i.add(a)}else{i.add(s);i.add(r)}this._connectVisibility(r,s);this._names.push({name:t[o],label:s,item:e[o]})}},addButton:function(e){this.getChildControl("button-container").add(e)},getLayout:function(){return this._getLayout()},_createLabel:function(e,t){var n=new qx.ui.basic.Label(this._createLabelText(e,t));this._labels.push(n);n.setRich(!0);n.setAppearance("form-renderer-label");return n},_createHeader:function(e){var t=new qx.ui.basic.Label(e);this._labels.push(t);t.setFont("bold");0!=this._row&&t.setMarginTop(10);t.setAlignX("left");return t}}});cv.plugins.openhab.renderer.Single.$$dbClassInfo=e}();
//# sourceMappingURL=part-20.js.map