if(!cv.util.ScriptLoader.isMarkedAsLoaded("plugins/openweathermap/owm_core.js")){var jOWM=jOWM||{};!function(e){e.fn.openweathermap=function(a,s){(a=e.extend({baseURL:"https://api.openweathermap.org/data/2.5/",detailItems:1,forecast24hItems:8,forecastDailyItems:4,showSunrise:"true",forecastToday:!0,units:"metric",type:"like",refresh:30,appid:"",description:""},a)).detailItems=parseInt(a.detailItems,10);a.detailItems<0&&(a.detailItems=0);a.detailItems>1&&(a.detailItems=1);a.forecast24hItems=parseInt(a.forecast24hItems,10);a.forecast24hItems<0&&(a.forecast24hItems=0);a.forecast24hItems>8&&(a.forecast24hItems=8);a.forecastDailyItems=parseInt(a.forecastDailyItems,10);a.forecastDailyItems<0&&(a.forecastDailyItems=0);a.forecastDailyItems>4&&(a.forecastDailyItems=4);"false"!==a.showSunrise&&(a.showSunrise="true");Date.ext.locales.de={a:["So","Mo","Di","Mi","Do","Fr","Sa"],A:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],b:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],B:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]};return this.each(function(s,r){$element=e(r);$element.hasClass("jowm")||$element.addClass("jowm");t(r,a)})};var t=function(t,l){var c=i(l),o=l.baseURL+"weather?"+c.join("&"),d=l.baseURL+"forecast/?"+c.join("&")+"&cnt=8",h=l.baseURL+"forecast/?"+c.join("&")+"&cnt=39";0===e("ul.detailed",e(t)).length&&e("<ul>").addClass("detailed").addClass("clearfix").appendTo(e(t).children(":first"));l.forecast24hItems>0&&0===e("ul.forecast",e(t)).length&&e("<ul>").addClass("forecast").addClass("clearfix").appendTo(e(t).children(":first"));l.forecastDailyItems>0&&0===e("ul.forecastDaily",e(t)).length&&e("<ul>").addClass("forecastDaily").addClass("clearfix").appendTo(e(t).children(":first"));n(l.baseURL+"weather?"+c.join("&"),function(i){if(200==i.cod){l.sunrise=i.sys.sunrise;l.sunset=i.sys.sunset;l.cityname=i.name;l.id=i.id;""===l.description?e("div.openweathermap_value").html("<p>"+l.cityname+"</p>"):"false"===l.description?e("div.openweathermap_value").parent().css("display","none"):e("div.openweathermap_value").html("<p>"+l.description+"</p>");a(t,o,l);l.forecast24hItems>0&&s(t,d,l);l.forecastDailyItems>0&&r(t,h,l)}else e(t).after("\x3c!-- Failed to fetch detailed weather data. --\x3e")})},a=function(t,a,s){e("ul.detailed",e(t)).html("");if(0!==s.detailItems){n(a,function(a){if(200==a.cod){$item=e("<li>");(a.dt<s.sunrise||a.dt>s.sunset)&&$item.addClass("night");$item.addClass("first");$item.addClass("last");$item.html(jOWM.theme("weatherDetailItem",a,s));$item.appendTo(e("ul.detailed",e(t)))}else e(t).after("\x3c!-- Failed to fetch detailed weather data. --\x3e")});if("true"===s.showSunrise){var r=function(e){var t=new Date(1e3*e.sunrise),a='<li class="sunrise-sunset"><div class="weather-forecast weather-sunrise clearfix" style="float: left;">';a+='<div class="weather-icon"></div>';a+='<div class="sunrise-sunset">'+t.strftime("%H:%M")+"</div> </div>";t=new Date(1e3*e.sunset);a+='<div class="weather-forecast weather-sunset clearfix" style="float: left;">';a+='<div class="weather-icon"></div>';return a+='<div class="sunrise-sunset">'+t.strftime("%H:%M")+"</div> </div></li>"}(s);$item=e(r);$item.appendTo(e("ul.detailed",e(t)))}}},s=function(t,a,s){e("ul.forecast",e(t)).html("");e("ul.forecast",e(t)).append('<div class="separationLine clearfix">');0!==s.forecast24hItems&&n(a,function(a){if(200==a.cod){var r=a.list;e.each(r,function(a,r){if(a<s.forecast24hItems){$item=e("<li>");(r.dt<s.sunrise||r.dt>s.sunset)&&$item.addClass("night");0===a&&$item.addClass("first");a===s.forecast24hItems-1&&$item.addClass("last");$item.html(jOWM.theme("weatherForecastItem",r,s));$item.appendTo(e("ul.forecast",e(t)))}})}else e(t).after("\x3c!-- Failed to fetch forecast weather data. --\x3e")})},r=function(t,a,s){e("ul.forecastDaily",e(t)).html("");e("ul.forecastDaily",e(t)).append('<div class="separationLine clearfix">');0!==s.forecastDailyItems&&n(a,function(a){if(200==a.cod){var r=function(t,a){var s,r,i,n=new Array,l=!1;e.each(t,function(e,c){var o=new Date(1e3*t[e].dt);o.locale=a.lang;if(o.getHours()<3){s=t[e].main.temp_min;r=t[e].main.temp_max;l=!0}else if(l){s>t[e].main.temp_min&&(s=t[e].main.temp_min);r<t[e].main.temp_max&&(r=t[e].main.temp_max);o.getHours()>10&&o.getHours()<14&&(i=t[e].weather);if(o.getHours()>=21){n.push({day:o.strftime("%a"),min_temp:s,max_temp:r,weather:i});l=!1}}});return n}(a.list,s),i='<li><div class="weather-forecast weather-thermo clearfix">';i+=' <div class="day">-</div>';i+=' <div class="weather-icon legend" ></div>';i+=' <div class="temperature high">max</div>';i+=' <div class="temperature low">min</div>';i+="</div></li>";$item=e("<li>");$item.append(i);$item.appendTo(e("ul.forecastDaily",e(t)));e.each(r,function(a,r){if(a<s.forecastDailyItems){$item=e("<li>");0===a&&$item.addClass("first");a===s.forecastDailyItems-1&&$item.addClass("last");$item.html(jOWM.theme("weatherForecastDailyItem",r,s));$item.appendTo(e("ul.forecastDaily",e(t)))}})}else e(t).after("\x3c!-- Failed to fetch forecast weather data. --\x3e")})};var i=function(e){var t=[];e.hasOwnProperty("lang")&&t.push("lang="+e.lang);if(e.hasOwnProperty("owID"))t.push("id="+e.owID);else if(e.hasOwnProperty("q"))t.push("q="+e.q);else if(e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")){t.push("lat="+e.lat);t.push("lon="+e.lon)}e.hasOwnProperty("units")&&t.push("units="+e.units);e.hasOwnProperty("type")&&t.push("type="+e.type);e.hasOwnProperty("appid")&&t.push("appid="+e.appid);return t},n=function(e,t){var a=new qx.io.request.Xhr(e);a.setAccept("application/json");a.addListener("success",function(e){var a=e.getTarget().getResponse();"string"==typeof a&&(a=JSON.parse(a));t(a)},this);a.addListener("error",function(t){console.log("error requesting",e,t.getData())},this);a.send()};jOWM.theme=function(e){var t=Array.prototype.slice.apply(arguments,[1]);return(jOWM.theme[e]||jOWM.theme.prototype[e]).apply(this,t)};jOWM.theme.prototype.weatherTemperature=function(e,t,a){a=a||"°";return parseFloat(e).toFixed(t)+a};jOWM.theme.prototype.weatherDetailItem=function(e,t){var a=e.weather[0],s=e.main;new Date(1e3*e.dt).locale=t.lang;var r='<div class="weather-detailed weather-'+a.id+' clearfix">';r+=' <div class="weather">';r+='  <span class="weather-icon" data-weather-text="'+a.description+'" data-weather-code="'+a.id+'"></span>';r+=" </div>";r+=' <div class="temperature">'+jOWM.theme("weatherTemperature",s.temp,1)+"</div>";return r+="</div>"};jOWM.theme.prototype.weatherForecastItem=function(e,t){var a=e.weather[0],s=e.main,r=new Date(1e3*e.dt);r.locale=t.lang;var i='<div class="weather-forecast weather-'+a.id+' clearfix">';i+=' <div class="day">'+r.strftime("%H:%M")+"</div>";i+=' <div class="weather-icon" data-weather-text="'+a.description+'" data-weather-code="'+a.id+'"></div>';i+=' <div class="temperature high">'+jOWM.theme("weatherTemperature",s.temp_max,0," °C")+"</div>";return i+="</div>"};jOWM.theme.prototype.weatherForecastDailyItem=function(e,t){var a=e.weather[0],s='<div class="weather-forecast weather-'+a.id+' ">';s+=' <div class="day">'+e.day+"</div>";s+=' <div class="weather-icon" data-weather-text="'+a.description+'" data-weather-code="'+a.id+'"></div>';s+=' <div class="temperature high">'+jOWM.theme("weatherTemperature",e.max_temp,0," °C")+"</div>";s+=' <div class="temperature low">'+jOWM.theme("weatherTemperature",e.min_temp,0," °C")+"</div>";return s+="</div>"}}(jQuery);cv.util.ScriptLoader.markAsLoaded("plugins/openweathermap/owm_core.js")}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Refresh":{require:!0},"cv.TemplateEngine":{construct:!0},"qx.event.message.Bus":{construct:!0},"cv.parser.WidgetParser":{defer:"runtime"},"qx.event.Timer":{},"cv.util.ScriptLoader":{defer:"runtime"},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.OpenweatherMap",{extend:cv.ui.structure.AbstractWidget,include:cv.ui.common.Refresh,construct:function(e){e.refresh=60*e.refresh;cv.ui.structure.AbstractWidget.constructor.call(this,e);this.__options={};Object.keys(e).forEach(function(t){e[t]&&(this.__options[t]=e[t])},this);cv.TemplateEngine.getInstance().isDomFinished()?this._refreshAction():qx.event.message.Bus.subscribe("setup.dom.finished",function(){this._refreshAction()},this)},statics:{parse:function(e,t,a,s){var r=cv.parser.WidgetParser.parseElement(this,e,t,a,s,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseRefresh(e,t);return r},getAttributeToPropertyMappings:function(){return{class:{target:"cssClass"},lang:{},owID:{},q:{},lat:{},lon:{},units:{},type:{},forecast24hItems:{},forecastDailyItems:{},detailItems:{},showSunrise:{},appid:{},description:{}}}},properties:{cssClass:{check:"String",nullable:!0},lang:{check:"String",nullable:!0},owID:{check:"String",nullable:!0},q:{check:"String",nullable:!0},lat:{check:"String",nullable:!0},lon:{check:"String",nullable:!0},units:{check:"String",nullable:!0},type:{check:"String",nullable:!0},forecast24hItems:{check:"String",nullable:!0},forecastDailyhItems:{check:"String",nullable:!0},showSunrise:{check:"String",nullable:!0},detailItems:{check:"String",nullable:!0},appid:{check:"String",nullable:!0},description:{check:"String",nullable:!0}},members:{__options:null,_getInnerDomString:function(){var e="widget clearfix text openweathermap";this.getCssClass()&&(e+=" "+this.getCssClass());return'<div class="'+e+'"><div id="owm_'+this.getPath()+'" class="openweathermap_value"></div></div>'},_setupRefreshAction:function(){this._timer=new qx.event.Timer(this.getRefresh());this._timer.addListener("interval",this._refreshAction,this);this._timer.start();this._refreshAction()},_refreshAction:function(){$(this.getDomElement()).openweathermap(this.__options)}},defer:function(e){var t=cv.util.ScriptLoader.getInstance();t.addStyles("plugins/openweathermap/owm_basic_style.css");t.addStyles("plugins/openweathermap/owm_weathericon.css");t.addScripts("plugins/openweathermap/owm_core.js");cv.parser.WidgetParser.addHandler("openweathermap",cv.plugins.OpenweatherMap);cv.ui.structure.WidgetFactory.registerClass("openweathermap",e)}});cv.plugins.OpenweatherMap.$$dbClassInfo=e}();
//# sourceMappingURL=part-11.js.map