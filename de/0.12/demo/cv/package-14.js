!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"qx.log.Logger":{},"cv.parser.WidgetParser":{defer:"runtime"},"cv.data.Model":{},"cv.TemplateEngine":{},"cv.core.notifications.SpeechHandler":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.Speech",{extend:qx.core.Object,include:cv.ui.common.Update,construct:function(e){this._initOnCreate=!0;qx.core.Object.constructor.call(this);this.set(e);this.__P_15_0={}},statics:{parse:function(e,t){if(window.speechSynthesis){var i=cv.parser.WidgetParser.makeAddressList(e,t);return cv.data.Model.getInstance().setWidgetData(t,{path:t,language:e.getAttribute("lang")?e.getAttribute("lang").toLowerCase():null,address:i,mapping:e.getAttribute("mapping"),repeatTimeout:e.getAttribute("repeat-timeout")?parseInt(e.getAttribute("repeat-timeout")):-1,$$type:"speech",$$initOnCacheLoad:!0})}qx.log.Logger.warn(this,"this browser does not support the Web Speech API")}},properties:{path:{check:"String"},$$type:{check:"String"},$$initOnCacheLoad:{check:"Boolean"},language:{check:"String"},mapping:{check:"String",init:""},repeatTimeout:{check:"Number",init:-1},parentWidget:{check:"cv.ui.structure.AbstractBasicWidget",init:null}},members:{__P_15_0:null,getDomString:function(){},_processIncomingValue:function(e,t){var i=this.applyTransform(e,t);return this.applyMapping(i)},handleUpdate:function(e,t){if(cv.TemplateEngine.getInstance().visu.getDataReceived())if(e&&0!==e.length){if("string"==typeof e&&"!"===e.substring(0,1))e=e.substring(1);else if(this.getRepeatTimeout()>=0&&this.__P_15_0[t]&&this.__P_15_0[t].text===e&&(0===this.getRepeatTimeout()||this.getRepeatTimeout()>=Math.round((Date.now()-this.__P_15_0[t].time)/1e3))){this.__P_15_0[t].time=Date.now();this.debug("skipping TTS because of repetition "+e);return}this.debug("changing lastSpeech from '%s' to '%s'",this.__P_15_0[t]?this.__P_15_0[t].text:"",e);this.__P_15_0[t]={text:e,time:Date.now()};cv.core.notifications.SpeechHandler.getInstance().say(e,this.getLanguage())}else this.debug("no text to speech given");else{this.__P_15_0[t]={text:e,time:Date.now()};this.debug("skipping initial TTS for "+e)}}},defer:function(e){cv.parser.WidgetParser.addHandler("speech",cv.plugins.Speech);cv.ui.structure.WidgetFactory.registerClass("speech",e)}});cv.plugins.Speech.$$dbClassInfo=e}();qx.$$packageData[14]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-14.js.map