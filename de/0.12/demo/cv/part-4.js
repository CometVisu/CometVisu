if(!cv.util.ScriptLoader.isMarkedAsLoaded("plugins/colorchooser/farbtastic/farbtastic.js")){!function(t){t.fn.farbtastic=function(e){t.farbtastic(this,e);return this};t.farbtastic=function(e,r){return(e=t(e).get(0)).farbtastic||(e.farbtastic=new t._farbtastic(e,r))};t._farbtastic=function(e,r){var s=this;t(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var i=t(".farbtastic",e);s.wheel=t(".wheel",e).get(0);s.radius=84;s.square=100;s.width=194;navigator.appVersion.match(/MSIE [0-6]\./)&&t("*",i).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2);t(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}});s.linkTo=function(e){"object"==typeof s.callback&&t(s.callback).unbind("keyup",s.updateValue);s.color=null;if("function"==typeof e)s.callback=e;else if("object"==typeof e||"string"==typeof e){s.callback=t(e);s.callback.bind("keyup",s.updateValue);s.callback.get(0).value&&s.setColor(s.callback.get(0).value)}return this};s.updateValue=function(t){this.value&&this.value!=s.color&&s.setColor(this.value)};s.setColor=function(t){var e=s.unpack(t);if(s.color!=t&&e){s.color=t;s.rgb=e;s.hsl=s.RGBToHSL(s.rgb);s.updateDisplay()}return this};s.setHSL=function(t){s.hsl=t;s.rgb=s.HSLToRGB(t);s.color=s.pack(s.rgb);s.updateDisplay();return this};s.widgetCoords=function(e){var r=t(s.wheel).offset();return{x:e.pageX-r.left-s.width/2,y:e.pageY-r.top-s.width/2}};s.mousedown=function(t){var e=s.widgetCoords(t);s.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>s.square;s.mousemove(t);return!1};s.touchconvert=function(t){return t=t.originalEvent.touches.item(0)};s.touchmove=function(t){s.mousemove(s.touchconvert(t));event.preventDefault();return!1};s.touchend=function(e){t(document).unbind("touchmove",s.touchmove);t(document).unbind("touchend",s.touchend);document.dragging=!1;e.preventDefault();return!1};s.mousemove=function(t){var e=s.widgetCoords(t);if(s.circleDrag){var r=Math.atan2(e.x,-e.y)/6.28;r<0&&(r+=1);s.setHSL([r,s.hsl[1],s.hsl[2]])}else{var i=Math.max(0,Math.min(1,-e.x/s.square+.5)),a=Math.max(0,Math.min(1,-e.y/s.square+.5));s.setHSL([s.hsl[0],i,a])}return!1};s.mouseup=function(){t(document).unbind("mousemove",s.mousemove);t(document).unbind("mouseup",s.mouseup);document.dragging=!1};s.updateDisplay=function(){var e=6.28*s.hsl[0];t(".h-marker",i).css({left:Math.round(Math.sin(e)*s.radius+s.width/2)+"px",top:Math.round(-Math.cos(e)*s.radius+s.width/2)+"px"});t(".sl-marker",i).css({left:Math.round(s.square*(.5-s.hsl[1])+s.width/2)+"px",top:Math.round(s.square*(.5-s.hsl[2])+s.width/2)+"px"});t(".color",i).css("backgroundColor",s.pack(s.HSLToRGB([s.hsl[0],1,.5])));if("object"==typeof s.callback){t(s.callback).css({backgroundColor:s.color,color:s.hsl[2]>.5?"#000":"#fff"});t(s.callback).each(function(){this.value&&this.value!=s.color&&(this.value=s.color)})}else"function"==typeof s.callback&&s.callback.call(s,s.color)};s.pack=function(t){var e=Math.round(255*t[0]),r=Math.round(255*t[1]),s=Math.round(255*t[2]);return"#"+(e<16?"0":"")+e.toString(16)+(r<16?"0":"")+r.toString(16)+(s<16?"0":"")+s.toString(16)};s.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0};s.HSLToRGB=function(t){var e,r,s=t[0],i=t[1],a=t[2];e=2*a-(r=a<=.5?a*(i+1):a+i-a*i);return[this.hueToRGB(e,r,s+.33333),this.hueToRGB(e,r,s),this.hueToRGB(e,r,s-.33333)]};s.hueToRGB=function(t,e,r){return 6*(r=r<0?r+1:r>1?r-1:r)<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(.66666-r)*6:t};s.RGBToHSL=function(t){var e,r,s,i,a,n,o=t[0],c=t[1],u=t[2];e=Math.min(o,Math.min(c,u));s=(r=Math.max(o,Math.max(c,u)))-e;a=0;(n=(e+r)/2)>0&&n<1&&(a=s/(n<.5?2*n:2-2*n));i=0;if(s>0){r==o&&r!=c&&(i+=(c-u)/s);r==c&&r!=u&&(i+=2+(u-o)/s);r==u&&r!=o&&(i+=4+(o-c)/s);i/=6}return[i,a,n]};t("*",i).mousedown(function(e){if(!document.dragging){t(document).bind("mousemove",s.mousemove).bind("mouseup",s.mouseup);document.dragging=!0}s.mousedown(e)});t("*",i).bind("touchstart",function(e){if(!document.dragging){t(document).bind("touchmove",s.touchmove).bind("touchend",s.touchend);document.dragging=!0}s.mousedown(s.touchconvert(e));e.preventDefault();return!1});s.setColor("#000000");r&&s.linkTo(r)}}(jQuery);cv.util.ScriptLoader.markAsLoaded("plugins/colorchooser/farbtastic/farbtastic.js")}!function(){var t={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{require:!0},"cv.ui.common.Update":{require:!0},"cv.ui.common.Operate":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"cv.TemplateEngine":{},"cv.data.Model":{},"cv.Transform":{},"qx.event.Timer":{},"cv.util.ScriptLoader":{defer:"runtime"},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(t);qx.Class.define("cv.plugins.ColorChooser",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update,cv.ui.common.Operate],statics:{parse:function(t,e,r,s){var i=cv.parser.WidgetParser.parseElement(this,t,e,r,s);cv.parser.WidgetParser.parseFormat(t,e);cv.parser.WidgetParser.parseAddress(t,e,this.makeAddressListFn);return i},makeAddressListFn:function(t,e,r,s){return[!0,s]}},properties:{valueR:{check:"Number",init:0},valueG:{check:"Number",init:0},valueB:{check:"Number",init:0},busR:{check:"Number",init:0},busG:{check:"Number",init:0},busB:{check:"Number",init:0},rateLimiter:{check:"Boolean",init:!1}},members:{__skipSending:!1,_onDomReady:function(){cv.plugins.ColorChooser.prototype._onDomReady.base.call(this);var t=$("#"+this.getPath()+" .actor");t.farbtastic(function(e){this.setValueR(100*parseInt(e.substring(1,3),16)/255);this.setValueG(100*parseInt(e.substring(3,5),16)/255);this.setValueB(100*parseInt(e.substring(5,7),16)/255);!1===this.getRateLimiter()&&!1===this.__skipSending&&this._rateLimitedSend(t)}.bind(this))},_rateLimitedSend:function(){var t,e=!1,r=this.getAddress(),s=this.getValueR(),i=this.getValueG(),a=this.getValueB(),n=this.getBusR(),o=this.getBusG(),c=this.getBusB(),u=cv.TemplateEngine.getInstance();for(var d in r)if(cv.data.Model.isWriteAddress(r[d]))switch(r[d][2]){case"r":if((t=cv.Transform.encode(r[d][0],s))!==cv.Transform.encode(r[d][0],n)){u.visu.write(d,t);e=!0}break;case"g":if((t=cv.Transform.encode(r[d][0],i))!==cv.Transform.encode(r[d][0],o)){u.visu.write(d,t);e=!0}break;case"b":if((t=cv.Transform.encode(r[d][0],a))!==cv.Transform.encode(r[d][0],c)){u.visu.write(d,t);e=!0}break;case"rgb":var l=[255*s/100,255*i/100,255*a/100],h=[255*n/100,255*o/100,255*c/100];t=cv.Transform.encode(r[d][0],l);var g=cv.Transform.encode(r[d][0],h);if(t[0]!==g[0]||t[1]!==g[1]||t[2]!==g[2]){u.visu.write(d,t.join(","));e=!0}}if(e){this.setBusR(this.getValueR());this.setBusG(this.getValueG());this.setBusB(this.getValueB());this.setRateLimiter(!0);this.__timer=qx.event.Timer.once(this._rateLimitedSend,this,250)}else this.setRateLimiter(!1)},_getInnerDomString:function(){return'<div class="actor"></div>'},_update:function(t,e){if(void 0!==t){var r=cv.Transform.decode(this.getAddress()[t][0],e),s=jQuery.farbtastic(this.getActor()),i=s.color||"#000000";switch(this.getAddress()[t][2]){case"r":this.setBusR(r);i=i.substring(0,1)+a(255*r/100)+i.substring(3);break;case"g":this.setBusG(r);i=i.substring(0,3)+a(255*r/100)+i.substring(5);break;case"b":this.setBusB(r);i=i.substring(0,5)+a(255*r/100)+i.substring(7);break;case"rgb":this.setBusR(r[0]);this.setBusG(r[1]);this.setBusB(r[2]);i=i.substring(0,1)+a(255*r[0]/100)+a(255*r[1]/100)+a(255*r[2]/100)+i.substring(7)}this.__skipSending=!0;if(this.__timer){this.__timer.stop();this.__timer=null;this.setRateLimiter(!1)}s.setColor(i);this.__skipSending=!1}function a(t){var e=parseInt(t).toString(16);return 1===e.length?"0"+e:e}}},defer:function(t){var e=cv.util.ScriptLoader.getInstance();e.addStyles("plugins/colorchooser/farbtastic/farbtastic.css");e.addScripts("plugins/colorchooser/farbtastic/farbtastic.js");cv.parser.WidgetParser.addHandler("colorchooser",t);cv.ui.structure.WidgetFactory.registerClass("colorchooser",t)},destruct:function(){this.__farbtastic=null}});cv.plugins.ColorChooser.$$dbClassInfo=t}();
//# sourceMappingURL=part-4.js.map