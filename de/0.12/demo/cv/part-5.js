!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{require:!0},"cv.ui.common.Refresh":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"qx.event.Timer":{},"qx.util.ResourceManager":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.CalendarList",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Refresh],properties:{width:{check:"String",init:""},height:{check:"String",init:""},src:{check:"String",init:"plugins/calendarlist/calendarlist.php"},days:{check:"Number",nullable:!0},maxquantity:{check:"Number",nullable:!0}},statics:{calendars:{},parse:function(e,t,r,a){var i=cv.parser.WidgetParser.parseElement(this,e,t,r,a,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseRefresh(e,t);this.calendars[t]=[];e.querySelectorAll("calendar").forEach(function(e){var r={type:e.getAttribute("type"),userid:e.getAttribute("userid"),magiccookie:e.hasAttribute("magiccookie")?e.getAttribute("magiccookie"):"",days:e.hasAttribute("days")?e.getAttribute("days"):i.days};this.calendars[t].push(r)},this);return i},getAttributeToPropertyMappings:function(){return{width:{transform:function(e){return e?"width:"+e+";":""}},height:{transform:function(e){return e?"height:"+e+";":""}},maxquantity:{transform:function(e){return e?parseInt(e):null}},days:{transform:function(e){return e?parseInt(e):null}}}}},members:{_getInnerDomString:function(){return'<div class="actor calendarListBody"><div class="calendarList_inline" id="calendarList'+this.getPath()+'" style="'+this.getHeight()+this.getWidth()+'"></div></div>'},_onDomReady:function(){cv.plugins.CalendarList.prototype._onDomReady.base.call(this);this.refreshAction()},_setupRefreshAction:function(){this._timer=new qx.event.Timer(this.getRefresh());this._timer.addListener("interval",this._refreshAction,this);this._timer.start()},_refreshAction:function(){var e=this.getActor(),t=this.getSrc(),r=this.getMaxquantity(),a=cv.plugins.CalendarList.calendars[this.getPath()];$(function(){$(e).calendarListlocal({src:qx.util.ResourceManager.getInstance().toUri(t),maxquantity:r,calendar:a})});return!1}},defer:function(e){cv.parser.WidgetParser.addHandler("calendarlist",e);cv.ui.structure.WidgetFactory.registerClass("calendarlist",e)}});!function(e){jQuery.fn.extend({calendarListlocal:function(t){t=jQuery.extend({src:"",days:30,html:"<span>{date}: {text}{where}</span>",wrapper:"li",dataType:"json",datetime:!0},t);return this.each(function(){var r=t,a=jQuery(this);if(""!==r.src){for(var i={maxquantity:r.maxquantity},n=0;n<r.calendar.length;n++){var s="type"+n,c="userid"+n,d="magiccookie"+n,l="days"+n;i["calendarname"+n]=n;i[s]=r.calendar[n].type;i[c]=r.calendar[n].userid;i[d]=r.calendar[n].magiccookie;i[l]=r.calendar[n].days}jQuery.ajax({url:r.src,type:"POST",data:i,dataType:r.dataType,error:function(t,i,n){console.log("C: #%s, Error: %s, calendarList: %s",e(a).attr("id"),n,r.src)},success:function(t){a.html("");for(var i,n,s=t.calendarList.calendarListEntries,c=s.length,d="",l=0;l<c;l++){var u=s[l],o=r.html;i="#FFFFFF";for(var h=0;h<r.calendar.length;h++)if(u.calendarName===h){i=!0===r.calendar[h].hasAttribute("color")?r.calendar[h].getAttribute("color"):"#FFFFFF";o="<span>"+(!0===r.calendar[h].hasAttribute("format")?r.calendar[h].getAttribute("format"):"{date}: {text}{where}")+"</span>"}d=u.StartDate;"00:00"!==u.StartTime&&(d=d+", "+u.StartTime);u.StartDate===u.EndDate&&u.StartTime===u.EndTime||(d+=" - ");u.StartDate!==u.EndDate?d=d+u.EndDate+", "+u.EndTime:u.StartTime!==u.EndTime&&(d+=u.EndTime);o=o.replace(/\{text\}/,u.description);n=""!==u.where?" ("+u.where+")":u.where;o=(o=o.replace(/\{where\}/,n)).replace(/\{date\}/,d);var g=e('<span style="color:'+i+'">').append(o).append("</span><br>");a.append(g)}}})}else console.log("calendarListlocal: no src URL")})}})}(jQuery);cv.plugins.CalendarList.$$dbClassInfo=e}();
//# sourceMappingURL=part-5.js.map