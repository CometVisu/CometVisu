!function(){var t={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"qx.util.ResourceManager":{},"cv.data.Model":{},"cv.TemplateEngine":{},"cv.Transform":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"},"cv.util.ScriptLoader":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(t);qx.Class.define("cv.plugins.Clock",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update],construct:function(t){t.value=new Date;cv.ui.structure.AbstractWidget.constructor.call(this,t)},statics:{parse:function(t,e,r,s){var i=cv.parser.WidgetParser.parseElement(this,t,e,r,s);cv.parser.WidgetParser.parseFormat(t,e);cv.parser.WidgetParser.parseAddress(t,e);return i}},members:{_getInnerDomString:function(){return'<div class="actor" style="width:200px; height: 200px"></div>'},_onDomReady:function(){var t=$(this.getActor());t.svg({loadURL:qx.util.ResourceManager.getInstance().toUri("plugins/clock/clock_pure.svg"),onLoad:function(e){$(e.root().getElementById("HotSpotHour")).draggable().bind("drag",{type:"hour",actor:t},this.dragHelper.bind(this)).bind("dragstop",{actor:t},this.dragAction.bind(this));$(e.root().getElementById("HotSpotMinute")).draggable().bind("drag",{type:"minute",actor:t},this.dragHelper.bind(this)).bind("dragstop",{actor:t},this.dragAction.bind(this));cv.plugins.Clock.prototype._onDomReady.base.call(this);Object.getOwnPropertyNames(this.getAddress()).filter(function(t){return cv.data.Model.isReadAddress(this.getAddress()[t])}.bind(this)).forEach(function(t){this._update(t,this.getValue().getHours()+":"+this.getValue().getMinutes()+":00",!0)},this)}.bind(this)})},initListeners:function(){},_update:function(t,e,r){var s=this.getDomElement(),i=r?e:this.defaultValueHandling(t,e),a=s.querySelector("svg"),n=i.split(":"),o=a.querySelector("#Hour"),u=a.querySelector("#Minute");if(void 0!==o&&void 0!==u){o.setAttribute("transform","rotate("+(n[0]%12*360/12+30*n[1]/60)+",50,50)");u.setAttribute("transform","rotate("+6*n[1]+",50,50)")}else console.error("Error: trying to update unknown clock SVG elements #Hour and/or #Minute")},dragHelper:function(t){var e,r=t.data.actor,s=r.find("svg"),i=t.originalEvent.pageX-s.offset().left-50,a=50-(t.originalEvent.pageY-s.offset().top),n=(180*Math.atan2(i,a)/Math.PI+360)%360,o=this.getValue();if("hour"===t.data.type){var u=o.getHours(),c=u>=12,d=Math.floor(n/30);e=n%30*2;if(u%12>9&&d<3)if(c){c=!1;o.setDate(o.getDate()+1)}else c=!0;else if(d>9&&u%12<3)if(c)c=!1;else{c=!0;o.setDate(o.getDate()-1)}o.setHours(d+12*c);o.setMinutes(e)}else{e=Math.round(n/6);var g=o.getMinutes();g>45&&e<15?o.setHours(o.getHours()+1):e>45&&g<15&&o.setHours(o.getHours()-1);o.setMinutes(e)}r.find("#Hour").attr("transform","rotate("+(o.getHours()%12*360/12+30*o.getMinutes()/60)+",50,50)");r.find("#Minute").attr("transform","rotate("+6*o.getMinutes()+",50,50)")},dragAction:function(){var t=this.getAddress();for(var e in t)!0!==t[e][1]&&cv.TemplateEngine.getInstance().visu.write(e,cv.Transform.encode(t[e][0],this.getValue()))}},defer:function(t){cv.parser.WidgetParser.addHandler("clock",cv.plugins.Clock);cv.ui.structure.WidgetFactory.registerClass("clock",t);cv.util.ScriptLoader.getInstance().addScripts(["resource/libs/jquery-ui.min.js","resource/libs/jquery.svg.min.js"],[0])}});cv.plugins.Clock.$$dbClassInfo=t}();
//# sourceMappingURL=part-6.js.map