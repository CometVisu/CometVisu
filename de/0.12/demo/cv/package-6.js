!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"qx.util.ResourceManager":{},"cv.data.Model":{},"cv.TemplateEngine":{},"cv.Transform":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"},"cv.util.ScriptLoader":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.Clock",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update],construct:function(e){e.value=new Date;cv.ui.structure.AbstractWidget.constructor.call(this,e)},statics:{parse:function(e,t,r,s){var i=cv.parser.WidgetParser.parseElement(this,e,t,r,s);cv.parser.WidgetParser.parseFormat(e,t);cv.parser.WidgetParser.parseAddress(e,t);return i}},members:{_getInnerDomString:function(){return'<div class="actor" style="width:200px; height: 200px"></div>'},_onDomReady:function(){var e=$(this.getActor());e.svg({loadURL:qx.util.ResourceManager.getInstance().toUri("plugins/clock/clock_pure.svg"),onLoad:function(t){$(t.root().getElementById("HotSpotHour")).draggable().bind("drag",{type:"hour",actor:e},this.dragHelper.bind(this)).bind("dragstop",{actor:e},this.dragAction.bind(this));$(t.root().getElementById("HotSpotMinute")).draggable().bind("drag",{type:"minute",actor:e},this.dragHelper.bind(this)).bind("dragstop",{actor:e},this.dragAction.bind(this));cv.plugins.Clock.prototype._onDomReady.base.call(this);Object.getOwnPropertyNames(this.getAddress()).filter(function(e){return cv.data.Model.isReadAddress(this.getAddress()[e])}.bind(this)).forEach(function(e){this._update(e,this.getValue().getHours()+":"+this.getValue().getMinutes()+":00",!0)},this)}.bind(this)})},initListeners:function(){},_update:function(e,t,r){var s=this.getDomElement(),i=r?t:this.defaultValueHandling(e,t),a=s.querySelector("svg"),n=i.split(":"),o=a.querySelector("#Hour"),c=a.querySelector("#Minute");if(void 0!==o&&void 0!==c){o.setAttribute("transform","rotate("+(n[0]%12*360/12+30*n[1]/60)+",50,50)");c.setAttribute("transform","rotate("+6*n[1]+",50,50)")}else console.error("Error: trying to update unknown clock SVG elements #Hour and/or #Minute")},dragHelper:function(e){var t,r=e.data.actor,s=r.find("svg"),i=e.originalEvent.pageX-s.offset().left-50,a=50-(e.originalEvent.pageY-s.offset().top),n=(180*Math.atan2(i,a)/Math.PI+360)%360,o=this.getValue();if("hour"===e.data.type){var c=o.getHours(),u=c>=12,d=Math.floor(n/30);t=n%30*2;if(c%12>9&&d<3)if(u){u=!1;o.setDate(o.getDate()+1)}else u=!0;else if(d>9&&c%12<3)if(u)u=!1;else{u=!0;o.setDate(o.getDate()-1)}o.setHours(d+12*u);o.setMinutes(t)}else{t=Math.round(n/6);var g=o.getMinutes();g>45&&t<15?o.setHours(o.getHours()+1):t>45&&g<15&&o.setHours(o.getHours()-1);o.setMinutes(t)}r.find("#Hour").attr("transform","rotate("+(o.getHours()%12*360/12+30*o.getMinutes()/60)+",50,50)");r.find("#Minute").attr("transform","rotate("+6*o.getMinutes()+",50,50)")},dragAction:function(){var e=this.getAddress();for(var t in e)!0!==e[t][1]&&cv.TemplateEngine.getInstance().visu.write(t,cv.Transform.encode(e[t][0],this.getValue()))}},defer:function(e){cv.parser.WidgetParser.addHandler("clock",cv.plugins.Clock);cv.ui.structure.WidgetFactory.registerClass("clock",e);cv.util.ScriptLoader.getInstance().addScripts(["resource/libs/jquery-ui.min.js","resource/libs/jquery.svg.min.js"],[0])}});cv.plugins.Clock.$$dbClassInfo=e}();qx.$$packageData[6]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-6.js.map