qx.$$packageData['1024']={"locales":{},"resources":{},"translations":{"de":{},"en":{}}};
qx.Part.$$notifyLoad("1024", function() {
(function(){var a='TR064_calllist',b='<audio preload="none">',c='audio_play',d='String',e='resource/plugins/tr064/soap.php?device=',f='type;date;nameOrCaller;tam',g='control_reload',h=';',j='',k='timer',l='tam',m='&uri=',n='interval',o='%26max=',p=': ',q='cv.plugins.tr064.CallList',r=' failed with content:',s='tr064ListRefreshed',t='</td>',u='phone_answering',v='nameOrCaller',w='resource/plugins/tr064/proxy.php?device=',x='phone_ring_out',y='phone_call_end_in',z='resource/plugins/tr064/tr064.css',A='update',B='initial',C="text/xml",D="calllist",E='*',F='text_question_mark',G='phone_call_in',H='</tr>',I='<div class="actor"><table class="TR064_calllist"><tr><td>Loading TR-064...</td></tr></table></div>',J='<source src="resource/plugins/tr064/proxy.php?device=',K='</audio>',L='date',M='</div>',N='ended',O='phone_ring_in',P=' failed with status ',Q='">',R='&location=upnp/control/x_contact&uri=urn:dslforum-org:service:X_AVM-DE_OnTel:1&fn=GetCallList',S='<xml/>',T='name',U='Error: reading URL "',V='type',W='qx.event.type.Event',X='phone_call_out',Y='getCallListURI',bq='<fail>',br="click",bs='%26sid=',bm='string',bn='phone_missed_in',bo='caller',bp='<td>',bu='Number',bv='<tr>',bw='Call',bx='TR-064 refreshCalllist() error:',bt='<div class="tam clickable">';qx.Class.define(q,{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Refresh,cv.ui.common.Update],statics:{parse:function(by,bC,bA,bz){var bB=cv.parser.WidgetParser.parseElement(this,by,bC,bA,bz,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseFormat(by,bC);cv.parser.WidgetParser.parseAddress(by,bC);cv.parser.WidgetParser.parseRefresh(by,bC);return bB;},getAttributeToPropertyMappings:function(){return {'device':{},'max':{transform:function(bD){return +bD;}},'columns':{'default':f},'TAM':{'default':u},'TAMColor':{'default':j},'TAMwait':{'default':g},'TAMwaitColor':{'default':j},'TAMplay':{'default':c},'TAMplayColor':{'default':j},'TAMstop':{'default':u},'TAMstopColor':{'default':j},'typeIncoming':{'default':G},'typeIncomingColor':{'default':j},'typeMissed':{'default':bn},'typeMissedColor':{'default':j},'typeOutgoing':{'default':X},'typeOutgoingColor':{'default':j},'typeActiveIncoming':{'default':O},'typeActiveIncomingColor':{'default':j},'typeRejectedIncoming':{'default':y},'typeRejectedIncomingColor':{'default':j},'typeActiveOutgoing':{'default':x},'typeActiveOutgoingColor':{'default':j},'typeUnknown':{'default':F},'typeUnknownColor':{'default':j}};}},events:{'tr064ListRefreshed':W},properties:{device:{check:d,init:j},max:{check:bu,init:0},columns:{check:d},TAM:{check:d},TAMColor:{check:d},TAMwait:{check:d},TAMwaitColor:{check:d},TAMplay:{check:d},TAMplayColor:{check:d},TAMstop:{check:d},TAMstopColor:{check:d},typeIncoming:{check:d},typeIncomingColor:{check:d},typeMissed:{check:d},typeMissedColor:{check:d},typeOutgoing:{check:d},typeOutgoingColor:{check:d},typeActiveIncoming:{check:d},typeActiveIncomingColor:{check:d},typeRejectedIncoming:{check:d},typeRejectedIncomingColor:{check:d},typeActiveOutgoing:{check:d},typeActiveOutgoingColor:{check:d},typeUnknown:{check:d},typeUnknownColor:{check:d}},members:{__ue:j,__uf:undefined,__ug:false,__uh:{},_getInnerDomString:function(){this.refreshCalllist(B);return I;},_setupRefreshAction:function(){this._timer=new qx.event.Timer(this.getRefresh());this._timer.addListener(n,function(){if(!this.__ug){this.refreshCalllist(k);};},this);this._timer.start();},_update:function(bF,bE){if(!this.__ug){this.refreshCalllist(A);};},_displayCalllist:function(){var self=this,bG=this.getDomElement().getElementsByClassName(a)[0],bJ=this.__ue?this.__ue.replace(/.*sid=/,j):j,bI=j,bK={'0':{name:this.getTypeUnknown(),color:this.getTypeUnknownColor()},'1':{name:this.getTypeIncoming(),color:this.getTypeIncomingColor()},'2':{name:this.getTypeMissed(),color:this.getTypeMissedColor()},'3':{name:this.getTypeOutgoing(),color:this.getTypeOutgoingColor()},'9':{name:this.getTypeActiveIncoming(),color:this.getTypeActiveIncomingColor()},'10':{name:this.getTypeRejectedIncoming(),color:this.getTypeRejectedIncomingColor()},'11':{name:this.getTypeActiveOutgoing(),color:this.getTypeActiveOutgoingColor()}};this.__uf.forEach(function(bN){var bL=j,bM=(bN.Type in bK)?bK[bN.Type]:bK[0];if(bN.Path){bL=b+J+self.getDevice()+m+bN.Path+bs+bJ+Q+K+bt+cv.IconHandler.getInstance().getIconText(self.getTAM(),E,E,self.getTAMColor())+M;};bI+=bv;self.getColumns().split(h).forEach(function(bO){switch(bO){case V:bI+=bp+cv.IconHandler.getInstance().getIconText(bM.name,E,E,bM.color)+t;break;case L:bI+=bp+bN.Date+t;break;case T:bI+=bp+bN.Name+t;break;case bo:bI+=bp+bN.Caller+t;break;case v:if(bN.Name!==j){bI+=bp+bN.Name+t;}else {bI+=bp+bN.Caller+t;};break;case l:bI+=bp+bL+t;break;};});bI+=H;});bG.innerHTML=bI;var bH=bG.getElementsByClassName(l);for(var i=0;i<bH.length;i++ ){bH[i].addEventListener(br,function(){self.__ui(this);});};},_getCallListURI:function(){var self=this,bP=e+this.getDevice()+R;window.fetch(bP).then(function(bQ){if(bQ.ok){return bQ.json();};console.error(U+bQ.url+P+bQ.status+p+bQ.statusText);self.__ue=bq;}).then(function(bR){if(typeof bR===bm){self.__ue=bR;self.refreshCalllist(Y);}else {console.error(U+bP+r,bR);self.__ue=bq;};});},refreshCalllist:function(bT){this.__ug=true;if(this.__ue===bq){return;};if(this.__ue===j){this._getCallListURI();return;};var self=this,bS=w+this.getDevice()+m+this.__ue+o+this.getMax();window.fetch(bS).then(function(bU){if(bU.ok){return bU.text();};console.error(U+bU.url+P+bU.status+p+bU.statusText);return S;}).then(function(bV){return (new window.DOMParser()).parseFromString(bV,C);}).then(function(cb){self.__uf=[];var bY=cb.getElementsByTagName(bw);for(var i=0;i<bY.length;i++ ){var bX=bY[i].children,ca={};for(var bW=0;bW<bX.length;bW++ ){ca[bX[bW].nodeName]=bX[bW].textContent;};self.__uf.push(ca);};self._displayCalllist();self.__ug=false;self.fireEvent(s);}).catch(function(cc){console.error(bx,cc);});},__ui:function(cf){var self=this,cd=cf.previousElementSibling;if(!this.__uh[cd]){cd.addEventListener(N,function(){self.__ul(cf);});this.__uh[cd]=true;};if(cd.readyState<4){this.__uj(cf);};if(cd.paused){var ce=cd.play();if(ce!==undefined){ce.then(function(){self.__uk(cf);}).catch(function(){});};}else {cd.pause();cd.currentTime=0;this.__ul(cf);};},__uj:function(cg){cg.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMwait(),E,E,this.getTAMwaitColor());},__uk:function(ch){ch.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMplay(),E,E,this.getTAMplayColor());},__ul:function(ci){ci.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMstop(),E,E,this.getTAMstopColor());}},defer:function(cj){var ck=cv.util.ScriptLoader.getInstance();ck.addStyles(z);cv.parser.WidgetParser.addHandler(D,cv.plugins.tr064.CallList);cv.ui.structure.WidgetFactory.registerClass(D,cj);}});})();
});