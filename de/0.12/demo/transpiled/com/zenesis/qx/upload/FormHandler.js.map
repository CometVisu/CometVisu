{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/qx_packages/johnspackman_UploadMgr_v1_0_5/source/class/com/zenesis/qx/upload/FormHandler.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "com",
    "zenesis",
    "upload",
    "AbstractHandler",
    "members",
    "addBlob",
    "filename",
    "blob",
    "params",
    "Error",
    "_createFile",
    "input",
    "id",
    "_getUniqueFileId",
    "value",
    "replace",
    "file",
    "File",
    "_doUpload",
    "iframe",
    "_createIframe",
    "getId",
    "form",
    "_createForm",
    "appendChild",
    "getBrowserObject",
    "self",
    "bom",
    "Event",
    "addNativeListener",
    "evt",
    "parentNode",
    "contentDocument",
    "body",
    "innerHTML",
    "e",
    "response",
    "_getIframeContent",
    "_onCompleted",
    "setTimeout",
    "removeChild",
    "submit",
    "_doCancel",
    "data",
    "getUserData",
    "document",
    "getElementById",
    "setAttribute",
    "doc",
    "contentWindow",
    "dom",
    "Element",
    "create",
    "src",
    "name",
    "element",
    "Style",
    "setStyles",
    "display",
    "enctype",
    "encoding",
    "action",
    "_getUploader",
    "getUploadUrl",
    "method",
    "target",
    "_getMergedParams",
    "el",
    "type",
    "FormHandler"
  ],
  "mappings": ";;;;;;;;;;;;;;;;AAAAA,EAAAA,EAAE,CAACC,SAAH,CAAaC,oBAAb,CAAkCC,aAAlC;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEAH,EAAAA,EAAE,CAACI,KAAH,CAASC,MAAT,CAAgB,mCAAhB,EAAqD;AACnDC,IAAAA,MAAM,EAAEC,GAAG,CAACC,OAAJ,CAAYR,EAAZ,CAAeS,MAAf,CAAsBC,eADqB;AAGnDC,IAAAA,OAAO,EAAE;AACP;AACJ;AACA;AACIC,MAAAA,OAAO,EAAE,iBAAUC,QAAV,EAAoBC,IAApB,EAA0BC,MAA1B,EAAkC;AAC3C,cAAM,IAAIC,KAAJ,CAAU,8CAAV,CAAN;AACC,OANM;;AAQP;AACJ;AACA;AACIC,MAAAA,WAAW,EAAE,qBAASC,KAAT,EAAgB;AAC3B,YAAIC,EAAE,GAAG,YAAY,KAAKC,gBAAL,EAArB;AAAA,YAA8CP,QAAQ,GAAGK,KAAK,CAACG,KAAN,CAAYC,OAAZ,CAAoB,WAApB,EAAiC,EAAjC,CAAzD;AAAA,YAA+FC,IAAI,GAAG,IAAIhB,GAAG,CAACC,OAAJ,CAAYR,EAAZ,CAAeS,MAAf,CAAsBe,IAA1B,CAClGN,KADkG,EAC3FL,QAD2F,EACjFM,EADiF,CAAtG;;AAEA,eAAOI,IAAP;AACD,OAfM;;AAiBP;AACJ;AACA;AACIE,MAAAA,SAAS,EAAE,mBAASF,IAAT,EAAe;AACxB,YAAIG,MAAM,GAAG,KAAKC,aAAL,CAAmBJ,IAAI,CAACK,KAAL,EAAnB,CAAb;AAAA,YAA+CC,IAAI,GAAG,KAAKC,WAAL,CAAiBJ,MAAjB,EAAyBH,IAAzB,CAAtD;;AAEAM,QAAAA,IAAI,CAACE,WAAL,CAAiBR,IAAI,CAACS,gBAAL,EAAjB;AAEA,YAAIC,IAAI,GAAG,IAAX;AAEAjC,QAAAA,EAAE,CAACkC,GAAH,CAAOC,KAAP,CAAaC,iBAAb,CAA+BV,MAA/B,EAAuC,MAAvC,EAA+C,UAASW,GAAT,EAAc;AAC3D;AACA;AACA,cAAI,CAACX,MAAM,CAACY,UAAZ,EACE,OAJyD,CAM3D;;AACA,cAAI;AACF,gBAAIZ,MAAM,CAACa,eAAP,IAA0Bb,MAAM,CAACa,eAAP,CAAuBC,IAAjD,IAAyDd,MAAM,CAACa,eAAP,CAAuBC,IAAvB,CAA4BC,SAA5B,IAAyC,OAAtG,EAA+G;AAC7G;AACA;AACA;AACA;AACA;AACD;AACF,WARD,CAQE,OAAOC,CAAP,EAAU,CACV;AACD,WAjB0D,CAmB3D;;;AAEA,cAAIC,QAAQ,GAAGV,IAAI,CAACW,iBAAL,CAAuBlB,MAAvB,CAAf;;AAEAO,UAAAA,IAAI,CAACY,YAAL,CAAkBtB,IAAlB,EAAwBoB,QAAxB,EAvB2D,CAyB3D;;;AACAG,UAAAA,UAAU,CAAC,YAAW;AACpBpB,YAAAA,MAAM,CAACY,UAAP,CAAkBS,WAAlB,CAA8BrB,MAA9B;AACAG,YAAAA,IAAI,CAACS,UAAL,CAAgBS,WAAhB,CAA4BlB,IAA5B;AACD,WAHS,EAGP,CAHO,CAAV;AAID,SA9BD;AA+BAA,QAAAA,IAAI,CAACmB,MAAL;AACD,OA3DM;;AA6DP;AACJ;AACA;AACIC,MAAAA,SAAS,EAAE,mBAAS1B,IAAT,EAAe;AACxB,YAAI2B,IAAI,GAAG3B,IAAI,CAAC4B,WAAL,CAAiB,mCAAjB,CAAX;AACA,YAAI,CAACD,IAAL,EACE;AACF,YAAIxB,MAAM,GAAG0B,QAAQ,CAACC,cAAT,CAAwB,mBAAmB9B,IAAI,CAACK,KAAL,EAA3C,CAAb;AAAA,YAAuEC,IAAI,GAAGuB,QAAQ,CAACC,cAAT,CAAwB,iBAChG9B,IAAI,CAACK,KAAL,EADwE,CAA9E;;AAGA,YAAIF,MAAM,IAAI,IAAd,EAAoB;AAClB;AACA;AACA;AACAA,UAAAA,MAAM,CAAC4B,YAAP,CAAoB,KAApB,EAA2B,mBAA3B;AACA5B,UAAAA,MAAM,CAACY,UAAP,CAAkBS,WAAlB,CAA8BrB,MAA9B;AACD;;AACD,YAAIG,IAAI,IAAI,IAAZ,EACEA,IAAI,CAACS,UAAL,CAAgBS,WAAhB,CAA4BlB,IAA5B;AACH,OAhFM;;AAkFP;AACJ;AACA;AACA;AACA;AACIe,MAAAA,iBAAiB,EAAE,2BAASlB,MAAT,EAAiB;AAClC,YAAI;AACF;AACA,cAAI6B,GAAG,GAAG7B,MAAM,CAACa,eAAP,GAAyBb,MAAM,CAACa,eAAhC,GAAkDb,MAAM,CAAC8B,aAAP,CAAqBJ,QAAjF;AAAA,cAA2FT,QAAQ,GAAGY,GAAG,CAACf,IAAJ,CAASC,SAA/G,CAFE,CAGF;;AACA,iBAAOE,QAAP;AACD,SALD,CAKE,OAAOD,CAAP,EAAU;AACV;AACA;AACA,iBAAO,IAAP;AACD;AACF,OAlGM;;AAoGP;AACJ;AACA;AACA;AACA;AACIf,MAAAA,aAAa,EAAE,uBAASR,EAAT,EAAa;AAC1B;AACA;AACA;AACA;AACA;AAEA,YAAIO,MAAM,GAAG1B,EAAE,CAACyD,GAAH,CAAOC,OAAP,CAAeC,MAAf,CAAsB,QAAtB,EAAgC;AAC3CC,UAAAA,GAAG,EAAE,mBADsC;AACjB;AACA;AAC1BC,UAAAA,IAAI,EAAE1C,EAHqC;AAI3CA,UAAAA,EAAE,EAAE,mBAAmBA;AAJoB,SAAhC,CAAb;AAOAnB,QAAAA,EAAE,CAACkC,GAAH,CAAO4B,OAAP,CAAeC,KAAf,CAAqBC,SAArB,CAA+BtC,MAA/B,EAAuC;AACrCuC,UAAAA,OAAO,EAAE;AAD4B,SAAvC;AAGAb,QAAAA,QAAQ,CAACZ,IAAT,CAAcT,WAAd,CAA0BL,MAA1B;AAEA,eAAOA,MAAP;AACD,OA7HM;;AA+HP;AACJ;AACA;AACA;AACA;AACII,MAAAA,WAAW,EAAE,qBAASJ,MAAT,EAAiBH,IAAjB,EAAuB;AAClC;AACA;AACA;AACA;AACA;AACA,YAAIM,IAAI,GAAG7B,EAAE,CAACyD,GAAH,CAAOC,OAAP,CAAeC,MAAf,CAAsB,MAAtB,EAA8B;AACvCO,UAAAA,OAAO,EAAE,qBAD8B;AAEvCC,UAAAA,QAAQ,EAAE,qBAF6B;AAGvCC,UAAAA,MAAM,EAAE,KAAKC,YAAL,GAAoBC,YAApB,EAH+B;AAIvCC,UAAAA,MAAM,EAAE,MAJ+B;AAKvCC,UAAAA,MAAM,EAAE9C,MAAM,CAACmC,IALwB;AAMvC1C,UAAAA,EAAE,EAAE,iBAAiBI,IAAI,CAACK,KAAL;AANkB,SAA9B,CAAX;AASA5B,QAAAA,EAAE,CAACkC,GAAH,CAAO4B,OAAP,CAAeC,KAAf,CAAqBC,SAArB,CAA+BnC,IAA/B,EAAqC;AACnCoC,UAAAA,OAAO,EAAE;AAD0B,SAArC;;AAGA,YAAIlD,MAAM,GAAG,KAAK0D,gBAAL,CAAsBlD,IAAtB,CAAb;;AACA,aAAM,IAAIsC,IAAV,IAAkB9C,MAAlB,EAA0B;AACxB,cAAI2D,EAAE,GAAG1E,EAAE,CAACyD,GAAH,CAAOC,OAAP,CAAeC,MAAf,CAAsB,OAAtB,EAA+B;AACtCgB,YAAAA,IAAI,EAAE,QADgC;AAEtCd,YAAAA,IAAI,EAAEA,IAFgC;AAGtCxC,YAAAA,KAAK,EAAEN,MAAM,CAAC8C,IAAD;AAHyB,WAA/B,CAAT;AAKAhC,UAAAA,IAAI,CAACE,WAAL,CAAiB2C,EAAjB;AACD;;AACDtB,QAAAA,QAAQ,CAACZ,IAAT,CAAcT,WAAd,CAA0BF,IAA1B;AAEA,eAAOA,IAAP;AACD;AAlKM;AAH0C,GAArD;AAhCAtB,EAAAA,GAAG,CAACC,OAAJ,CAAYR,EAAZ,CAAeS,MAAf,CAAsBmE,WAAtB,CAAkCzE,aAAlC,GAAkDA,aAAlD",
  "sourcesContent": [
    "/* ***********************************************************************\n\n   UploadMgr - provides an API for uploading one or multiple files\n   with progress feedback (on modern browsers), does not block the user \n   interface during uploads, supports cancelling uploads.\n\n   http://qooxdoo.org\n\n   Copyright:\n     2011 Zenesis Limited, http://www.zenesis.com\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     \n     This software is provided under the same licensing terms as Qooxdoo,\n     please see the LICENSE file in the Qooxdoo project's top-level directory \n     for details.\n     \n     Parts of this code is based on the work by Andrew Valums (andrew@valums.com)\n     and is covered by the GNU GPL and GNU LGPL2 licenses; please see\n     http://valums.com/ajax-upload/.\n\n   Authors:\n * John Spackman (john.spackman@zenesis.com)\n\n ************************************************************************/\n\n/**\n * Implementation of AbstractHandler that uses iframe and form DOM elements to\n * send the file.\n */\n\nqx.Class.define(\"com.zenesis.qx.upload.FormHandler\", {\n  extend: com.zenesis.qx.upload.AbstractHandler,\n\n  members: {\n    /*\n     * @Override\n     */\n    addBlob: function (filename, blob, params) {\n\t   throw new Error(\"addBlob is not supported in the FormHandler.\");\t\n    },\n\n    /*\n     * @Override\n     */\n    _createFile: function(input) {\n      var id = \"upload-\" + this._getUniqueFileId(), filename = input.value.replace(/.*(\\/|\\\\)/, \"\"), file = new com.zenesis.qx.upload.File(\n          input, filename, id);\n      return file;\n    },\n\n    /*\n     * @Override\n     */\n    _doUpload: function(file) {\n      var iframe = this._createIframe(file.getId()), form = this._createForm(iframe, file);\n\n      form.appendChild(file.getBrowserObject());\n\n      var self = this;\n\n      qx.bom.Event.addNativeListener(iframe, \"load\", function(evt) {\n        // when we remove iframe from dom the request stops, but in IE\n        // load event fires\n        if (!iframe.parentNode)\n          return;\n\n        // fixing Opera 10.53\n        try {\n          if (iframe.contentDocument && iframe.contentDocument.body && iframe.contentDocument.body.innerHTML == \"false\") {\n            // In Opera event is fired second time when body.innerHTML\n            // changed from false\n            // to server response approx. after 1 sec when we upload\n            // file with iframe\n            return;\n          }\n        } catch (e) {\n          // IE fix\n        }\n\n        // self.debug('iframe loaded');\n\n        var response = self._getIframeContent(iframe);\n\n        self._onCompleted(file, response);\n\n        // timeout added to fix busy state in FF3.6\n        setTimeout(function() {\n          iframe.parentNode.removeChild(iframe);\n          form.parentNode.removeChild(form);\n        }, 1);\n      });\n      form.submit();\n    },\n\n    /*\n     * @Override\n     */\n    _doCancel: function(file) {\n      var data = file.getUserData(\"com.zenesis.qx.upload.FormHandler\");\n      if (!data)\n        return;\n      var iframe = document.getElementById(\"upload-iframe-\" + file.getId()), form = document.getElementById(\"upload-form-\"\n          + file.getId());\n\n      if (iframe != null) {\n        // to cancel request set src to something else\n        // we use src=\"javascript:false;\" because it doesn't\n        // trigger ie6 prompt on https\n        iframe.setAttribute('src', 'javascript:false;');\n        iframe.parentNode.removeChild(iframe);\n      }\n      if (form != null)\n        form.parentNode.removeChild(form);\n    },\n\n    /**\n     * Returns text received by iframe from server.\n     * \n     * @return {String}\n     */\n    _getIframeContent: function(iframe) {\n      try {\n        // iframe.contentWindow.document - for IE<7\n        var doc = iframe.contentDocument ? iframe.contentDocument : iframe.contentWindow.document, response = doc.body.innerHTML;\n        // this.debug(\"response=\" + response);\n        return response;\n      } catch (e) {\n        // IE will throw an exception if the upload is cross domain and\n        // we try to access the iframe's content\n        return null;\n      }\n    },\n\n    /**\n     * Creates iframe with unique name\n     * \n     * @return {DOMElement} the iframe\n     */\n    _createIframe: function(id) {\n      // We can't use following code as the name attribute\n      // won't be properly registered in IE6, and new window\n      // on form submit will open\n      // var iframe = document.createElement('iframe');\n      // iframe.setAttribute('name', id);\n\n      var iframe = qx.dom.Element.create(\"iframe\", {\n        src: \"javascript:false;\", // src=\"javascript:false;\" removes ie6\n                                  // prompt on https\n        name: id,\n        id: \"upload-iframe-\" + id\n      });\n\n      qx.bom.element.Style.setStyles(iframe, {\n        display: 'none'\n      });\n      document.body.appendChild(iframe);\n\n      return iframe;\n    },\n\n    /**\n     * Creates form, that will be submitted to iframe\n     * \n     * @return {DOMElement} the form\n     */\n    _createForm: function(iframe, file) {\n      // We can't use the following code in IE6\n      // var form = document.createElement('form');\n      // form.setAttribute('method', 'post');\n      // form.setAttribute('enctype', 'multipart/form-data');\n      // Because in this case file won't be attached to request\n      var form = qx.dom.Element.create(\"form\", {\n        enctype: \"multipart/form-data\",\n        encoding: \"multipart/form-data\",\n        action: this._getUploader().getUploadUrl(),\n        method: \"POST\",\n        target: iframe.name,\n        id: \"upload-form-\" + file.getId()\n      });\n\n      qx.bom.element.Style.setStyles(form, {\n        display: 'none'\n      });\n      var params = this._getMergedParams(file);\n      for ( var name in params) {\n        var el = qx.dom.Element.create('input', {\n          type: \"hidden\",\n          name: name,\n          value: params[name]\n        });\n        form.appendChild(el);\n      }\n      document.body.appendChild(form);\n\n      return form;\n    }\n\n  }\n});\n"
  ]
}