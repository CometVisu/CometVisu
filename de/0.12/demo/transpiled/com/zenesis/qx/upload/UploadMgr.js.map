{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/qx_packages/johnspackman_UploadMgr_v1_0_5/source/class/com/zenesis/qx/upload/UploadMgr.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "include",
    "com",
    "zenesis",
    "upload",
    "MParameters",
    "construct",
    "widget",
    "uploadUrl",
    "__widgetsData",
    "addWidget",
    "setUploadUrl",
    "events",
    "properties",
    "check",
    "nullable",
    "init",
    "event",
    "autoUpload",
    "apply",
    "multiple",
    "directory",
    "inputNamePrefix",
    "requireMultipartFormData",
    "members",
    "__inputSerial",
    "__uploadHandler",
    "__uploadId",
    "appearId",
    "addListenerOnce",
    "evt",
    "data",
    "toHashCode",
    "container",
    "getContentElement",
    "setStyle",
    "getEnabled",
    "inputElement",
    "addAt",
    "_createInputElement",
    "__fixupSize",
    "keydownId",
    "Environment",
    "get",
    "addListener",
    "dom",
    "getDomElement",
    "click",
    "getData",
    "_removeInputElement",
    "hasMixin",
    "constructor",
    "MUploadButton",
    "bind",
    "removeWidget",
    "removeListener",
    "addBlob",
    "filename",
    "blob",
    "params",
    "getUploadHandler",
    "getAutoUpload",
    "beginUploads",
    "bounds",
    "getBounds",
    "setStyles",
    "width",
    "height",
    "_applyAutoUpload",
    "value",
    "oldValue",
    "_applyMultiple",
    "hash",
    "setMultiple",
    "_applyDirectory",
    "setDirectory",
    "_applyRequireMultipartFormData",
    "Error",
    "cancel",
    "file",
    "cancelAll",
    "name",
    "getInputNamePrefix",
    "Assert",
    "assertNull",
    "elem",
    "InputElement",
    "lang",
    "Function",
    "_onInputChange",
    "remove",
    "_resetInputElement",
    "getWidget",
    "addFile",
    "XhrHandler",
    "isSupported",
    "isRequireMultipartFormData",
    "FormHandler",
    "setUploadHandler",
    "handler",
    "allocateUploadId",
    "UploadMgr"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ***********************************************************************\n\n   UploadMgr - provides an API for uploading one or multiple files\n   with progress feedback (on modern browsers), does not block the user \n   interface during uploads, supports cancelling uploads.\n\n   http://qooxdoo.org\n\n   Copyright:\n     2011 Zenesis Limited, http://www.zenesis.com\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     \n     This software is provided under the same licensing terms as Qooxdoo,\n     please see the LICENSE file in the Qooxdoo project's top-level directory \n     for details.\n\n   Authors:\n * John Spackman (john.spackman@zenesis.com)\n\n ************************************************************************/\n\n/**\n * Manages uploading of files to the server; this class can use any suitable\n * widget to attach the input[type=file] to, provided the widget includes\n * com.zenesis.qx.upload.MUploadButton.\n * \n * Uploader will use XhrHandler to upload via XMLHttpRequest if supported or\n * will fall back to FormHandler.\n * \n * @require(qx.event.handler.Input)\n */\nqx.Class.define(\"com.zenesis.qx.upload.UploadMgr\", {\n  extend: qx.core.Object,\n  include: [ com.zenesis.qx.upload.MParameters ],\n\n  construct: function(widget, uploadUrl) {\n    this.base(arguments);\n    this.__widgetsData = {};\n    if (widget)\n      this.addWidget(widget);\n    if (uploadUrl)\n      this.setUploadUrl(uploadUrl);\n  },\n\n  events: {\n    /**\n     * Fired when a file is added to the queue; data is the\n     * com.zenesis.qx.upload.File\n     */\n    \"addFile\": \"qx.event.type.Data\",\n\n    /**\n     * Fired when a file starts to be uploaded; data is the\n     * com.zenesis.qx.upload.File\n     */\n    \"beginUpload\": \"qx.event.type.Data\",\n\n    /**\n     * Fired when a file has been uploaded; data is the\n     * com.zenesis.qx.upload.File\n     */\n    \"completeUpload\": \"qx.event.type.Data\",\n\n    /**\n     * Fired when a file upload has been cancelled; data is the\n     * com.zenesis.qx.upload.File\n     */\n    \"cancelUpload\": \"qx.event.type.Data\"\n  },\n\n  properties: {\n    /**\n     * The URL to upload to\n     */\n    uploadUrl: {\n      check: \"String\",\n      nullable: false,\n      init: \"\",\n      event: \"changeUploadUrl\"\n    },\n\n    /**\n     * Whether to automatically start uploading when a file is added\n     * (default=true)\n     */\n    autoUpload: {\n      check: \"Boolean\",\n      init: true,\n      nullable: false,\n      event: \"changeAutoUpload\",\n      apply: \"_applyAutoUpload\"\n    },\n\n    /**\n     * Whether to support multiple files (default=true); this is not supported\n     * on older browsers\n     */\n    multiple: {\n      check: \"Boolean\",\n      init: true,\n      nullable: false,\n      event: \"changeMultiple\",\n      apply: \"_applyMultiple\",\n      event: \"changeMultiple\" \t  \n    },\n\n    directory: {\n      init: false,\n      check: \"Boolean\",\n      nullable: false,\n      apply: \"_applyDirectory\",\n      event: \"changeDirectory\" \t  \n    },\n\n    /**\n     * Prefix to apply to the name of input fields\n     */\n    inputNamePrefix: {\n      check: \"String\",\n      init: \"uploadMgrInput\",\n      nullable: false,\n      event: \"changeInputNamePrefix\"\n    },\n\n    /**\n     * Whether the server can only handle multipart/form-data content type\n     */\n    requireMultipartFormData: {\n      check: \"Boolean\",\n      init: true,\n      nullable: false,\n      event: \"changeRequireMultipartFormData\",\n      apply: \"_applyRequireMultipartFormData\"\n    }\n  },\n\n  members: {\n    __widgetsData: null,\n    __inputSerial: 0,\n    __uploadHandler: null,\n    __uploadId: 0,\n\n    /**\n     * Adds a widget which is to have an input[type=file] attached; this would\n     * typically be an instance of com.zenesis.qx.upload.UploadButton (see\n     * com.zenesis.qx.upload.MUploadButton for implementing for other widgets)\n     */\n    addWidget: function(widget) {\n      var appearId = widget.addListenerOnce(\"appear\", function(evt) {\n        var data = this.__widgetsData[widget.toHashCode()];\n        if (data) {\n          data.appearId = null;\n          var container = widget.getContentElement();\n          container.setStyle(\"overflow\", \"hidden\");\n          if (widget.getEnabled() && !data.inputElement)\n            container.addAt(this._createInputElement(widget), 0);\n          this.__fixupSize(widget);\n        }\n      }, this);\n      var keydownId = null;\n      if (qx.core.Environment.get(\"engine.name\") != \"gecko\") {\n        keydownId = widget.addListener(\"keydown\", function(evt) {\n          var data = this.__widgetsData[widget.toHashCode()];\n          if (data && data.inputElement) {\n            var dom = data.inputElement.getDomElement();\n            if (dom && typeof dom.click == \"function\") {\n              // dom.focus();\n              dom.click();\n            }\n          }\n        }, this);\n      }\n      this.__widgetsData[widget.toHashCode()] = {\n        appearId: appearId,\n        keydownId: keydownId,\n        widget: widget,\n        inputElement: null\n      };\n      widget.addListener(\"resize\", function(evt) {\n        this.__fixupSize(widget);\n      }, this);\n      widget.addListener(\"changeEnabled\", function(evt) {\n        if (evt.getData()) {\n          var container = widget.getContentElement();\n          container.addAt(this._createInputElement(widget), 0);\n        } else {\n          this._removeInputElement(widget);\n        }\n      }, this);\n      if (qx.Class.hasMixin(widget.constructor, com.zenesis.qx.upload.MUploadButton)) {\n        this.bind(\"multiple\", widget, \"multiple\");       \n        this.bind(\"directory\", widget, \"directory\");       \n     }\n  \n    },\n\n    /**\n     * Removes a widget\n     * \n     * @param widget {qx.ui.core.Widget} Widget to remvove\n     */\n    removeWidget: function(widget) {\n      var data = this.__widgetsData[widget.toHashCode()];\n      if (data) {\n        if (data.appearId)\n          widget.removeListener(data.appearId);\n        if (data.keydownId)\n          widget.removeListener(data.keydownId);\n        delete this.__widgetsData[widget.toHashCode()];\n      }\n    },\n    \n    /**\n     * Adds a blob to the upload list \n     * \n     * @param blob    {Blob}    the blob to upload\n     * @param params  {Object}  List of params added to the upload params\n     */\n    addBlob: function (filename, blob, params){\n      this.getUploadHandler().addBlob(filename, blob, params);\n      if (this.getAutoUpload())\n        this.getUploadHandler().beginUploads();\n    },\n    \n    /**\n     * Helper method that corrects the size of the input element to match the\n     * size of the widget\n     * \n     * @param widget {qx.ui.core.Widget} Widget to fixup size\n     */\n    __fixupSize: function(widget) {\n      var data = this.__widgetsData[widget.toHashCode()];\n      if (data && data.inputElement) {\n        var bounds = widget.getBounds();\n        // It may be that if the widgets icon is styled\n        // through a theme, neither label nor icon are set yet.\n        // In this situation bounds calculation would fail.\n        if(bounds) { \n          data.inputElement.setStyles({\n            width: bounds.width + \"px\",\n            height: bounds.height + \"px\"\n          });\n        }\n      }\n    },\n\n    // property apply\n    _applyAutoUpload: function(value, oldValue) {\n      this.getUploadHandler().beginUploads();\n    },\n\n    // property apply\n    _applyMultiple: function(value, oldValue) {\n      for ( var hash in this.__widgetsData) {\n        var data = this.__widgetsData[hash];\n        if (data.inputElement)\n          data.inputElement.setMultiple(value);\n      }\n    },\n\n    // property directory\n    _applyDirectory: function(value, oldValue) {\n      for ( var hash in this.__widgetsData) {\n        var data = this.__widgetsData[hash];\n        if (data.inputElement)\n          data.inputElement.setDirectory(value);\n      }\n    },\n\n    // property apply\n    _applyRequireMultipartFormData: function(value, oldValue) {\n      if (this.__uploadHandler)\n        throw new Error(\"Changing the requireMultipartFormData property of \" + this + \" has no effect once uploads have started\");\n    },\n\n    /**\n     * Cancels a file being uploaded\n     * \n     * @param file {String} Upload to cancel\n     */\n    cancel: function(file) {\n      this.getUploadHandler().cancel(file);\n    },\n\n    /**\n     * Cancels all files being uploaded\n     */\n    cancelAll: function() {\n      this.getUploadHandler().cancelAll();\n    },\n\n    /**\n     * Creates the input[type=file] element\n     * \n     * @returns\n     */\n    _createInputElement: function(widget) {\n      var data = this.__widgetsData[widget.toHashCode()];\n      var name = this.getInputNamePrefix() + '-' + (++this.__inputSerial);\n      qx.core.Assert.assertNull(data.inputElement);\n      var elem = data.inputElement = new com.zenesis.qx.upload.InputElement(widget, name);\n      elem.addListenerOnce(\"change\", qx.lang.Function.bind(this._onInputChange, this, elem));\n      return elem;\n    },\n\n    /**\n     * Removes the input element - ie discards the current one (which presumably\n     * has already been queued for uploading)\n     */\n    _removeInputElement: function(widget) {\n      var data = this.__widgetsData[widget.toHashCode()];\n      var elem = data.inputElement;\n      var container = widget.getContentElement();\n      data.inputElement = null;\n      if (elem)\n        container.remove(elem);\n    },\n\n    /**\n     * Resets the input element - ie discards the current one (which presumably\n     * has already been queued for uploading) and creates a new one\n     */\n    _resetInputElement: function(widget) {\n      this._removeInputElement(widget);\n      var container = widget.getContentElement();\n      container.addAt(this._createInputElement(widget), 0);\n    },\n\n    /**\n     * Callback for changes to the input[ty=file]'s value, ie this is called\n     * when the user has selected a file to upload\n     * \n     * @param elem {Element} Element which is affected\n     * @param evt {Event} Event data\n     */\n    _onInputChange: function(elem, evt) {\n      var widget = elem.getWidget();\n\n      this.getUploadHandler().addFile(elem.getDomElement(), widget);\n      if (this.getAutoUpload())\n        this.getUploadHandler().beginUploads();\n      this._resetInputElement(widget);\n    },\n\n    /**\n     * Returns the upload handler\n     * \n     * @returns\n     */\n    getUploadHandler: function() {\n      if (!this.__uploadHandler) {\n        if (com.zenesis.qx.upload.XhrHandler.isSupported(this.isRequireMultipartFormData()))\n          this.__uploadHandler = new com.zenesis.qx.upload.XhrHandler(this);\n        else\n          this.__uploadHandler = new com.zenesis.qx.upload.FormHandler(this);\n      }\n      return this.__uploadHandler;\n    },\n\n    /**\n     * Sets the upload handler\n     * \n     * @param elem {AbstractHandler} The upload handler\n     */\n    setUploadHandler: function(handler) {\n      this.__uploadHandler = handler;\n    },\n\n    /**\n     * Allocates a new upload ID; this is just a unique number that widgets or\n     * application code can use to uniquely identify themselves to the server\n     */\n    allocateUploadId: function() {\n      return \"uploadId:\" + (++this.__uploadId);\n    }\n\n  }\n});\n"
  ]
}