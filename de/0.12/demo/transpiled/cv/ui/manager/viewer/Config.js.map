{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/viewer/Config.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "viewer",
    "AbstractViewer",
    "construct",
    "_setLayout",
    "layout",
    "Grow",
    "properties",
    "appearance",
    "refine",
    "init",
    "target",
    "check",
    "external",
    "connectToWindow",
    "apply",
    "statics",
    "SUPPORTED_FILES",
    "TITLE",
    "locale",
    "Manager",
    "tr",
    "ICON",
    "theme",
    "dark",
    "Images",
    "getIcon",
    "members",
    "_windowRef",
    "_applyConnectToWindow",
    "value",
    "setExternal",
    "_applyFile",
    "file",
    "old",
    "isConfigFile",
    "event",
    "message",
    "Bus",
    "unsubscribe",
    "getBusTopic",
    "_onChange",
    "configName",
    "model",
    "FileItem",
    "getConfigName",
    "getFullPath",
    "url",
    "util",
    "Uri",
    "getAbsolute",
    "LibraryManager",
    "getInstance",
    "get",
    "getTarget",
    "control",
    "getChildControl",
    "setSource",
    "show",
    "hint",
    "isVisible",
    "exclude",
    "ref",
    "window",
    "open",
    "isConnectToWindow",
    "onbeforeunload",
    "_onClose",
    "bind",
    "iframe",
    "subscribe",
    "snackbar",
    "Controller",
    "error",
    "hasChildControl",
    "close",
    "ev",
    "data",
    "getData",
    "type",
    "reload",
    "console",
    "log",
    "getFile",
    "dispatchByName",
    "_createChildControlImpl",
    "id",
    "embed",
    "Iframe",
    "add",
    "basic",
    "Atom",
    "set",
    "center",
    "font",
    "addListener",
    "focus",
    "destruct",
    "Config"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n * Show rendered configs.\n */\nqx.Class.define('cv.ui.manager.viewer.Config', {\n  extend: cv.ui.manager.viewer.AbstractViewer,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    this._setLayout(new qx.ui.layout.Grow());\n\n  },\n\n  /*\n    ***********************************************\n      PROPERTIES\n    ***********************************************\n    */\n  properties: {\n    appearance: {\n      refine: true,\n      init: 'config-viewer'\n    },\n\n    target: {\n      check: ['iframe', 'window'],\n      init: 'window'\n    },\n\n    external: {\n      refine: true,\n      init: true\n    },\n\n    connectToWindow: {\n      check: 'Boolean',\n      init: false,\n      apply: '_applyConnectToWindow'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    SUPPORTED_FILES: /^(demo)?\\/?visu_config.*\\.xml/,\n    TITLE: qx.locale.Manager.tr('Config viewer'),\n    ICON: cv.theme.dark.Images.getIcon('preview', 18)\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _windowRef: null,\n\n    _applyConnectToWindow: function (value) {\n      this.setExternal(!value);\n    },\n\n    _applyFile: function (file, old) {\n      if (old && old.isConfigFile()) {\n        qx.event.message.Bus.unsubscribe(old.getBusTopic(), this._onChange, this);\n      }\n      if (file) {\n        if (file.isConfigFile()) {\n          var configName = cv.ui.manager.model.FileItem.getConfigName(file.getFullPath());\n          var url = qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get('cv', 'resourceUri')+ '/..') + '?config=' + (configName || '');\n          if (this.getTarget() === 'iframe') {\n            url += '&preview=1';\n            var control = this.getChildControl('iframe');\n            control.setSource(url);\n            control.show();\n            const hint = this.getChildControl('hint', true);\n            if (hint && hint.isVisible()) {\n              hint.exclude();\n            }\n          } else {\n            let ref = window.open(url, configName);\n            if (this.isConnectToWindow()) {\n              this._windowRef = ref;\n              this._windowRef.onbeforeunload = this._onClose.bind(this);\n              const hint = this.getChildControl('hint');\n              hint.show();\n              const iframe = this.getChildControl('iframe', true);\n              if (iframe && iframe.isVisible()) {\n                iframe.exclude();\n              }\n            } else {\n              // no connection close this immediately\n              this._onClose();\n              return;\n            }\n          }\n          qx.event.message.Bus.subscribe(file.getBusTopic(), this._onChange, this);\n        } else {\n          cv.ui.manager.snackbar.Controller.error(this.tr('%1 is no configuration file', file.getFullPath()));\n        }\n      } else {\n        if (this.hasChildControl('iframe')) {\n          this.getChildControl('iframe').exclude();\n        }\n        if (this.hasChildControl('hint')) {\n          this.getChildControl('hint').exclude();\n        }\n        if (this._windowRef) {\n          this._windowRef.close();\n        }\n      }\n    },\n\n    _onChange: function (ev) {\n      var data = ev.getData();\n      if (data.type === 'contentChanged') {\n        if (this.hasChildControl('iframe')) {\n          this.getChildControl('iframe').reload();\n        } else if (this._windowRef) {\n          this._windowRef.reload();\n        }\n      }\n    },\n\n    _onClose: function () {\n      if (this._windowRef) {\n        console.log(this, 'close', this.getFile().getFullPath());\n        qx.event.message.Bus.dispatchByName('cv.manager.action.close', this.getFile());\n      }\n    },\n\n    // overridden\n    _createChildControlImpl : function(id) {\n       var control;\n\n       switch (id) {\n         case 'iframe':\n           control = new qx.ui.embed.Iframe();\n           control.exclude();\n           this.getChildControl('scroll').add(control);\n           break;\n\n         case 'hint':\n           control = new qx.ui.basic.Atom(this.tr('This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window.'));\n           control.set({\n             center: true,\n             font: 'title'\n           });\n           control.addListener('tap', function () {\n             if (this._windowRef) {\n               this._windowRef.focus();\n             }\n           }, this);\n           this.getChildControl('scroll').add(control);\n           break;\n       }\n\n       return control || this.base(arguments, id);\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._windowRef = null;\n  }\n});\n"
  ]
}