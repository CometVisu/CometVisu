{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/model/BackupFolder.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "model",
    "FileItem",
    "type",
    "construct",
    "load",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onFilesSystemMessage",
    "members",
    "ev",
    "test",
    "getName",
    "data",
    "getData",
    "includes",
    "reload",
    "getBackupFiles",
    "file",
    "files",
    "getType",
    "pathparts",
    "getFullPath",
    "split",
    "pop",
    "path",
    "join",
    "parts",
    "suffix",
    "filename",
    "fileRegex",
    "RegExp",
    "getChildren",
    "filter",
    "backupFile",
    "match",
    "exec",
    "replace",
    "push",
    "date",
    "Date",
    "parseInt",
    "substring",
    "destruct",
    "unsubscribe",
    "BackupFolder"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n *\n */\nqx.Class.define('cv.ui.manager.model.BackupFolder', {\n  extend: cv.ui.manager.model.FileItem,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments, 'backup');\n    this.load();\n    qx.event.message.Bus.subscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _onFilesSystemMessage: function (ev) {\n      if (/^cv\\.manager\\.fs\\.visu_config.*\\.xml$/.test(ev.getName())) {\n        // Fs event on config file\n        var data = ev.getData();\n        if (['contentChanged', 'fsContentChanged'].includes(data.type)) {\n          // config file has been changed or restored, refresh the backups\n          this.reload();\n        }\n      }\n    },\n\n    /**\n     * Returns the list of existing backup files for the given file.\n     * @param file {cv.ui.manager.model.FileItem}\n     */\n    getBackupFiles: function (file) {\n      var files = [];\n      if (file.getType() === 'file') {\n        var pathparts = file.getFullPath().split('/');\n        pathparts.pop();\n        var path = pathparts.join('\\/');\n        var parts = file.getName().split('.');\n        var suffix = parts.pop();\n        var filename = parts.join('.');\n        var fileRegex = new RegExp(path + filename + '-([\\\\d]{14})\\\\.' + suffix);\n        this.getChildren().filter(function (backupFile) {\n          var match = fileRegex.exec(backupFile.getFullPath().replace('backup/', ''));\n          if (match) {\n            files.push({\n              date: new Date(\n                parseInt(match[1].substring(0,4)),\n                parseInt(match[1].substring(4,6))-1,\n                parseInt(match[1].substring(6,8)),\n                parseInt(match[1].substring(8,10)),\n                parseInt(match[1].substring(10,12)),\n                parseInt(match[1].substring(12,14))\n              ),\n              file: backupFile\n            });\n          }\n        }, this);\n      }\n      return files;\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    qx.event.message.Bus.unsubscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  }\n});\n"
  ]
}