{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/ui/manager/editor/Xml.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "editor",
    "AbstractEditor",
    "construct",
    "_setLayout",
    "layout",
    "Grow",
    "_handledActions",
    "__basePath",
    "util",
    "Uri",
    "getAbsolute",
    "window",
    "location",
    "pathname",
    "LibraryManager",
    "getInstance",
    "get",
    "_draw",
    "statics",
    "SUPPORTED_FILES",
    "TITLE",
    "locale",
    "Manager",
    "tr",
    "ICON",
    "theme",
    "dark",
    "Images",
    "getIcon",
    "members",
    "_currentContent",
    "_iframe",
    "_notWriteable",
    "_loadFile",
    "file",
    "destroy",
    "match",
    "exec",
    "getName",
    "isWriteable",
    "embed",
    "Iframe",
    "appendParamsToUrl",
    "getParentFolder",
    "addListener",
    "getWindow",
    "saveFromIframe",
    "bind",
    "_add",
    "basic",
    "Atom",
    "set",
    "center",
    "font",
    "show",
    "data",
    "filename",
    "callback",
    "xml",
    "forEach",
    "elem",
    "_elemToXml",
    "_onContentChanged",
    "save",
    "getFile",
    "relName",
    "split",
    "pop",
    "exists",
    "getParent",
    "getChildren",
    "some",
    "child",
    "method",
    "_client",
    "updateSync",
    "createSync",
    "path",
    "getPath",
    "hash",
    "type",
    "force",
    "getCurrentContent",
    "err",
    "_onSaved",
    "indent",
    "nodeName",
    "nodeValue",
    "Object",
    "keys",
    "attributes",
    "attrName",
    "children",
    "length",
    "push",
    "join",
    "setModified",
    "isSupported",
    "Xml",
    "test",
    "destruct",
    "_disposeObjects"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n * Default XML-Editor included as iframe.\n */\nqx.Class.define('cv.ui.manager.editor.Xml', {\n  extend: cv.ui.manager.editor.AbstractEditor,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    this._setLayout(new qx.ui.layout.Grow());\n    this._handledActions = ['save'];\n    this.__basePath = qx.util.Uri.getAbsolute(window.location.pathname + qx.util.LibraryManager.getInstance().get(\"cv\", \"resourceUri\") + '/../editor/editor.html');\n    this._draw();\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    SUPPORTED_FILES: /^(demo)?\\/?visu_config.*\\.xml/,\n    TITLE: qx.locale.Manager.tr('Xml-editor'),\n    ICON: cv.theme.dark.Images.getIcon('xml', 18)\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _currentContent: null,\n    _iframe: null,\n    _notWriteable: null,\n\n    _draw: function () {\n\n    },\n\n    _loadFile: function (file) {\n      if (this._iframe) {\n        this._iframe.destroy();\n      }\n      if (file) {\n        var match = /.*visu_config_?(.*)\\.xml/.exec(file.getName());\n        if (match) {\n          if (file.isWriteable()) {\n            this._iframe = new qx.ui.embed.Iframe(qx.util.Uri.appendParamsToUrl(this.__basePath, 'embed=1&config=' + match[1]) + '&demo=' + (\n              file.getParentFolder() === 'demo/' ? 'true' : 'false'\n            ));\n            this._iframe.addListener('load', function () {\n              // inject save method\n              this._iframe.getWindow().saveFromIframe = this.saveFromIframe.bind(this);\n            }, this);\n\n            this._add(this._iframe);\n          } else {\n            if (!this._notWriteable) {\n              this._notWriteable = new qx.ui.basic.Atom(this.tr('The XML-Editor does not support files that are not writeable!'));\n              this._notWriteable.set({\n                center: true,\n                font: \"title\"\n              });\n              this._add(this._notWriteable);\n            }\n            this._notWriteable.show();\n          }\n        }\n      }\n    },\n\n    saveFromIframe: function (data, filename, callback) {\n      // create XML string from data\n      var xml = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>';\n      data.forEach(function (elem) {\n        xml += this._elemToXml(elem, '');\n      }, this);\n      this._currentContent = xml;\n      if (!filename) {\n        // mark as changed as long it is no preview change\n        this._onContentChanged();\n      }\n      this.save(filename, callback);\n    },\n\n    save: function (filename, callback) {\n      if (filename) {\n        var file = this.getFile();\n        var relName = filename.split('/').pop();\n        var exists = file.getParent().getChildren().some(function (child) { return child.getName() === relName; });\n        var method = exists ? this._client.updateSync : this._client.createSync;\n        // save preview\n        method({\n          path: file.getPath() + '/' + relName,\n          hash: 'ignore',\n          type: 'file',\n          force: true\n        }, this.getCurrentContent(), function (err) {\n          callback(err);\n        }, this);\n      } else {\n        this.base(arguments, function (err) {\n          if (!err) {\n            this._onSaved();\n          }\n          callback(err);\n        }.bind(this), 'ignore');\n      }\n    },\n\n    _elemToXml: function (elem, indent) {\n      var xml = '';\n      if (elem.nodeName === '#comment') {\n        xml += '\\n' + indent + '<!-- ' + elem.nodeValue + ' -->';\n      } else if (elem.nodeName === '#text') {\n        xml += elem.nodeValue;\n      } else {\n        xml += '\\n'+ indent + '<' + elem.nodeName;\n        Object.keys(elem.attributes).forEach(function (attrName) {\n          xml += ' ' + attrName + '=\"' + elem.attributes[attrName] + '\"';\n        });\n\n        if (!elem.nodeValue && elem.children.length === 0) {\n          xml += '/>';\n        } else {\n          xml += '>';\n          if (elem.nodeName === 'status' && elem.attributes.type === 'html') {\n            xml += '<![CDATA[\\n' + indent + \"  \" + elem.nodeValue + '\\n ]]>';\n          } else if (elem.nodeValue) {\n            xml += elem.nodeValue;\n          }\n          var children = [];\n          elem.children.forEach(function (child) {\n            children.push(this._elemToXml(child, indent + \"  \"));\n          }, this);\n          xml += children.join('');\n          xml += '\\n' + indent + '</' + elem.nodeName + '>';\n        }\n      }\n      return xml;\n    },\n\n    getCurrentContent: function () {\n      return this._currentContent;\n    },\n\n    _onContentChanged: function () {\n      this.getFile().setModified(true);\n    },\n\n    isSupported: function (file) {\n      return cv.ui.manager.editor.Xml.SUPPORTED_FILES.test(file.getName()) && file.isWriteable();\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n  this._disposeObjects('_iframe', '_notWriteable');\n  }\n});\n"
  ]
}