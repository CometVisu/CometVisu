{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/ui/common/Refresh.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Mixin",
    "define",
    "construct",
    "cv",
    "TemplateEngine",
    "getInstance",
    "isDomFinished",
    "setupRefreshAction",
    "event",
    "message",
    "Bus",
    "subscribe",
    "addListener",
    "_maintainTimerState",
    "properties",
    "refresh",
    "check",
    "init",
    "cachecontrol",
    "restartOnVisible",
    "apply",
    "members",
    "_timer",
    "__timerId",
    "__setup",
    "__lastRun",
    "__restartTimer",
    "__restartOnVisible",
    "_applyRestartOnVisible",
    "value",
    "debug",
    "getPath",
    "stop",
    "dispose",
    "isRestartOnVisible",
    "isVisible",
    "delta",
    "getRefresh",
    "Date",
    "now",
    "start",
    "fireEvent",
    "Timer",
    "once",
    "isEnabled",
    "_setupRefreshAction",
    "element",
    "getDomElement",
    "target",
    "querySelector",
    "src",
    "getAttribute",
    "indexOf",
    "nodeName",
    "getCachecontrol",
    "refreshAction",
    "setRestartOnVisible",
    "_refreshAction",
    "parenthost",
    "window",
    "location",
    "protocol",
    "host",
    "setAttribute",
    "util",
    "Uri",
    "appendParamsToUrl",
    "getTime",
    "ui",
    "common",
    "Refresh",
    "__forceImgReload",
    "destruct",
    "_disposeObjects",
    "statics",
    "twostage",
    "step",
    "elements",
    "document",
    "querySelectorAll",
    "canvases",
    "imgReloadBlank",
    "forEach",
    "elem",
    "canvas",
    "createElement",
    "width",
    "height",
    "style",
    "getContext",
    "drawImage",
    "push",
    "parentNode",
    "insertBefore",
    "removeAttribute",
    "imgReloadRestore",
    "removeChild",
    "iframe",
    "doc",
    "loadCallback",
    "e",
    "contentWindow",
    "reload",
    "type",
    "display",
    "parent",
    "body",
    "appendChild",
    "addEventListener",
    "open",
    "write",
    "close",
    "proceed"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Refresh.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\nqx.Mixin.define(\"cv.ui.common.Refresh\", {\n\n  /*\n   ******************************************************\n   CONSTRUCTOR\n   ******************************************************\n   */\n  construct: function () {\n    if (cv.TemplateEngine.getInstance().isDomFinished()) {\n      this.setupRefreshAction();\n    } else {\n      qx.event.message.Bus.subscribe(\"setup.dom.finished\", function () {\n        this.setupRefreshAction();\n      }, this);\n    }\n\n    this.addListener(\"changeVisible\", this._maintainTimerState, this);\n  },\n\n  /*\n   ******************************************************\n   PROPERTIES\n   ******************************************************\n   */\n  properties: {\n    refresh: {\n      check: 'Number',\n      init: 0\n    },\n    cachecontrol: {\n      check: 'String',\n      init: 'full'\n    },\n    restartOnVisible: {\n      check: 'Boolean',\n      init: false,\n      apply: '_applyRestartOnVisible'\n    }\n  },\n\n  /*\n   ******************************************************\n   MEMBERS\n   ******************************************************\n   */\n  members: {\n    _timer: null,\n    __timerId: null,\n    __setup: false,\n    __lastRun: null,\n    __restartTimer: null,\n    __restartOnVisible: false,\n\n    _applyRestartOnVisible: function (value) {\n      if (value) {\n        this._maintainTimerState();\n      }\n    },\n\n    /**\n     * Stop the while invisible\n     */\n    _maintainTimerState: function () {\n      if (this.__restartTimer) {\n        this.debug('aborting restart timer ' + this.getPath());\n        this.__restartTimer.stop();\n        this.__restartTimer.dispose();\n        this.__restartTimer = null;\n      }\n      if (!this.isRestartOnVisible()) {\n        return;\n      }\n      if (this._timer) {\n        if (this.isVisible()) {\n          var delta = this.getRefresh() - (Date.now() - this.__lastRun);\n          if (delta <= 0) {\n            // run immediately\n            this.debug('immediate refresh because refresh time has been reached ' + this.getPath());\n            this._timer.start();\n            this._timer.fireEvent('interval');\n          } else {\n            this.debug('starting refresh ' + this.getPath() + ' in ' + delta + 'ms');\n            // start when interval is finished\n            this.__restartTimer = qx.event.Timer.once(function () {\n              this._timer.start();\n              this._timer.fireEvent('interval');\n              this.__restartTimer = null;\n            }, this, delta);\n          }\n\n        } else if (this._timer.isEnabled()) {\n          this.debug('stop refreshing ' + this.getPath());\n          this._timer.stop();\n        }\n      }\n    },\n\n    setupRefreshAction: function () {\n      if (this.getRefresh() && this.getRefresh() > 0) {\n        if (this.__setup === true) {\n          return;\n        }\n        this.__setup = true;\n        if (this._setupRefreshAction) {\n          // overridden by inheriting class\n          this._setupRefreshAction();\n          if (this._timer) {\n            // listen to foreign timer to get the last execution time;\n            this._timer.addListener('interval', function () {\n              this.__lastRun = Date.now();\n            }, this);\n          }\n        } else if (!this._timer || !this._timer.isEnabled()) {\n          var element = this.getDomElement();\n          var target = element.querySelector('img') || element.querySelector('iframe');\n          var src = target.getAttribute(\"src\");\n          if (src.indexOf('?') < 0 && ((target.nodeName === 'IMG' && this.getCachecontrol() === 'full') || target.nodeName !== 'IMG')) {\n            src += '?';\n          }\n          this._timer = new qx.event.Timer(this.getRefresh());\n          this._timer.addListener(\"interval\", function () {\n            this.refreshAction(target, src);\n          }, this);\n          this._timer.start();\n        }\n        if (this._timer && this._timer.isEnabled()) {\n          this.__lastRun = Date.now();\n          this.setRestartOnVisible(true);\n        }\n      }\n    },\n\n    refreshAction: function (target, src) {\n      this.__lastRun = Date.now();\n      if (this._refreshAction) {\n        this._refreshAction();\n      } else {\n        /*\n         * Special treatment for (external) iframes: we need to clear it and reload\n         * it in another thread as otherwise stays blank for some targets/sites and\n         * src = src doesnt work anyway on external This creates though some\n         * \"flickering\" so we avoid to use it on images, internal iframes and others\n         */\n        var parenthost = window.location.protocol + \"//\" + window.location.host;\n        if (target.nodeName === \"IFRAME\" && src.indexOf(parenthost) !== 0) {\n          target.setAttribute(\"src\", \"\");\n          qx.event.Timer.once(function () {\n            target.setAttribute(\"src\", src);\n          }, this, 0);\n        } else {\n          var cachecontrol = this.getCachecontrol();\n          \n          // force is only implied for images\n          if( target.nodeName !== 'IMG' && cachecontrol === 'force' )\n          {\n            cachecontrol = 'full';\n          }\n          \n          switch( cachecontrol ) {\n            case 'full':\n              target.setAttribute(\"src\", qx.util.Uri.appendParamsToUrl(src, \"\"+new Date().getTime()));\n              break;\n              \n            case 'weak':\n              target.setAttribute(\"src\", src + '#' + new Date().getTime());\n              break;\n              \n            case 'force':\n              cv.ui.common.Refresh.__forceImgReload( src );\n              \n            // not needed as those are NOP:\n            // case 'none':\n            // default:\n          }\n        }\n      }\n    }\n  },\n\n  /*\n  ******************************************************\n    DESTRUCTOR\n  ******************************************************\n  */\n  destruct: function() {\n    if (this._timer) {\n      this._timer.stop();\n      this._disposeObjects(\"_timer\");\n    }\n  },\n  \n  /*\n   ******************************************************\n   STATICS\n   ******************************************************\n   */\n  statics: {\n    // based on https://stackoverflow.com/questions/1077041/refresh-image-with-a-new-one-at-the-same-url\n    __forceImgReload: function(src, twostage) {\n      var step = 0,                                       // step: 0 - started initial load, 1 - wait before proceeding (twostage mode only), 2 - started forced reload, 3 - cancelled\n        elements = document.querySelectorAll('img[src=\"'+src+'\"]'),\n        canvases = [],\n        imgReloadBlank = function(){\n          elements.forEach(function(elem){\n            // place a canvas above the image to prevent a flicker on the \n            // screen when the image src is reset\n            var canvas = window.document.createElement('canvas');\n            canvas.width = elem.width;\n            canvas.height = elem.height;\n            canvas.style = 'position:fixed';\n            canvas.getContext('2d').drawImage(elem,0,0);\n            canvases.push( canvas );\n            elem.width = elem.width;\n            elem.height = elem.height;\n            elem.parentNode.insertBefore( canvas, elem );\n            elem.removeAttribute(\"src\");\n          });\n        },\n        imgReloadRestore = function(){\n          elements.forEach(function(elem){\n            elem.setAttribute(\"src\", src);\n            elem.removeAttribute('width');\n            elem.removeAttribute('height');\n          });\n          canvases.forEach(function(elem){\n            elem.parentNode.removeChild(elem);\n          });\n        },\n        iframe = window.document.createElement('iframe'), // Hidden iframe, in which to perform the load+reload.\n        doc,\n        loadCallback = function(e)                        // Callback function, called after iframe load+reload completes (or fails).\n        {                                                 // Will be called TWICE unless twostage-mode process is cancelled. (Once after load, once after reload).\n          if( !step )                                     // initial load just completed.  Note that it doesn't actually matter if this load succeeded or not!\n          {\n            if( twostage )\n            {\n              step = 1;                                   // wait for twostage-mode proceed or cancel; don't do anything else just yet\n            } else { \n              step = 2;                                   // initiate forced-reload\n              imgReloadBlank(); \n              iframe.contentWindow.location.reload(true); \n            }\n          }\n          else if( step===2 )                             // forced re-load is done\n          {\n            imgReloadRestore((e||window.event).type===\"error\");    // last parameter checks whether loadCallback was called from the \"load\" or the \"error\" event.\n            if(iframe.parentNode) \n            {\n              iframe.parentNode.removeChild(iframe);\n            }\n          }\n        };\n      iframe.style.display = 'none';\n      window.parent.document.body.appendChild(iframe);\n      iframe.addEventListener('load',loadCallback,false);\n      iframe.addEventListener('error',loadCallback,false);\n      doc = iframe.contentWindow.document;\n      doc.open();\n      doc.write('<html><head><title></title></head><body><img src=\"' + src + '\"></body></html>');\n      doc.close();\n      if( twostage )\n      {\n        return function( proceed )\n        {\n          if( !twostage ) \n          {\n            return;\n          }\n          \n          twostage = false;\n          if( proceed )\n          {\n            if( step === 1 )\n            { \n              step = 2; \n              imgReloadBlank(); \n              iframe.contentWindow.location.reload(true); \n            }\n          } else {\n            step = 3;\n            if( iframe.contentWindow.stop )\n            {\n              iframe.contentWindow.stop();\n            }\n            if( iframe.parentNode )\n            {\n              iframe.parentNode.removeChild(iframe);\n            }\n          }\n        };\n      }\n      return null;\n    }\n  }\n});\n"
  ]
}