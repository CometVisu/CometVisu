{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/data/Model.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "__states",
    "__stateListeners",
    "__addressList",
    "__widgetData",
    "statics",
    "READ",
    "WRITE",
    "isReadAddress",
    "address",
    "mode",
    "cv",
    "data",
    "Model",
    "isWriteAddress",
    "members",
    "getStateListener",
    "onUpdate",
    "state",
    "initial",
    "hasOwnProperty",
    "changed",
    "forEach",
    "listener",
    "call",
    "update",
    "addressList",
    "getOwnPropertyNames",
    "getState",
    "addUpdateListener",
    "callback",
    "context",
    "push",
    "removeUpdateListener",
    "removeIndex",
    "some",
    "entry",
    "i",
    "splice",
    "length",
    "addAddress",
    "id",
    "list",
    "getAddresses",
    "keys",
    "setAddressList",
    "value",
    "getAddressList",
    "resetAddressList",
    "getWidgetData",
    "path",
    "getWidgetDataByElement",
    "element",
    "parent",
    "parentNode",
    "getAttribute",
    "undefined",
    "setWidgetData",
    "obj",
    "attrname",
    "setWidgetDataModel",
    "getWidgetDataModel",
    "resetWidgetDataModel",
    "clear"
  ],
  "mappings": ";;;;;;;;;;;;AAAAA,EAAAA,EAAE,CAACC,SAAH,CAAaC,oBAAb,CAAkCC,aAAlC;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACAH,EAAAA,EAAE,CAACI,KAAH,CAASC,MAAT,CAAgB,eAAhB,EAAiC;AAC/BC,IAAAA,MAAM,EAAEN,EAAE,CAACO,IAAH,CAAQC,MADe;AAE/BC,IAAAA,IAAI,EAAE,WAFyB;;AAI/B;AACF;AACA;AACA;AACA;AACEC,IAAAA,SAAS,EAAE,qBAAW;AACpB,WAAKC,QAAL,GAAgB,EAAhB;AACA,WAAKC,QAAL,GAAwB,EAAxB;AACA,WAAKC,QAAL,GAAqB,EAArB;AACA,WAAKC,QAAL,GAAoB,EAApB;AACD,KAd8B;;AAgB/B;AACF;AACA;AACA;AACA;AACEC,IAAAA,OAAO,EAAE;AACPC,MAAAA,IAAI,EAAE,CADC;AAEPC,MAAAA,KAAK,EAAE,CAFA;AAIPC,MAAAA,aAAa,EAAE,uBAASC,OAAT,EAAkB;AAC/B,eAAO,CAAC,EAAEA,OAAO,CAACC,IAAR,GAAeC,EAAE,CAACC,IAAH,CAAQC,KAAR,CAAcP,IAA/B,CAAR;AACD,OANM;AAQPQ,MAAAA,cAAc,EAAE,wBAASL,OAAT,EAAkB;AAChC,eAAO,CAAC,EAAEA,OAAO,CAACC,IAAR,GAAeC,EAAE,CAACC,IAAH,CAAQC,KAAR,CAAcN,KAA/B,CAAR;AACD;AAVM,KArBsB;;AAkC/B;AACF;AACA;AACA;AACA;AACEQ,IAAAA,OAAO,EAAE;AACPd,MAAAA,QAAQ,EAAG,IADJ;AAEPC,MAAAA,QAAgB,EAAE,IAFX;AAGPC,MAAAA,QAAa,EAAG,IAHT;AAIPC,MAAAA,QAAY,EAAE,IAJP;AAMPY,MAAAA,gBAAgB,EAAE,4BAAY;AAC5B,eAAO,KAAKd,QAAZ;AACD,OARM;;AAUP;AACJ;AACA;AACA;AACA;AACA;AACIe,MAAAA,QAAQ,EAAE,kBAASR,OAAT,EAAkBS,KAAlB,EAAyB;AACjC,YAAIC,OAAO,GAAG,CAAC,KAAKlB,QAAL,CAAcmB,cAAd,CAA6BX,OAA7B,CAAf;AACA,YAAIY,OAAO,GAAGF,OAAO,IAAI,KAAKlB,QAAL,CAAcQ,OAAd,MAA2BS,KAApD;AACA,aAAKjB,QAAL,CAAcQ,OAAd,IAAyBS,KAAzB,CAHiC,CAIjC;;AACA,YAAI,KAAKhB,QAAL,CAAsBO,OAAtB,CAAJ,EAAoC;AAClC,eAAKP,QAAL,CAAsBO,OAAtB,EAA+Ba,OAA/B,CAAuC,UAASC,QAAT,EAAmB;AACxDA,YAAAA,QAAQ,CAAC,CAAD,CAAR,CAAYC,IAAZ,CAAiBD,QAAQ,CAAC,CAAD,CAAzB,EAA8Bd,OAA9B,EAAuCS,KAAvC,EAA8CC,OAA9C,EAAuDE,OAAvD;AACD,WAFD,EAEG,IAFH;AAGD;AACF,OA1BM;;AA4BP;AACJ;AACA;AACA;AACII,MAAAA,MAAM,EAAE,gBAASb,IAAT,EAAe;AACrB,YAAI,CAACA,IAAL,EAAW;AAAE;AAAS;;AACtB,YAAIc,WAAW,GAAG,KAAKvB,QAAvB;AACAL,QAAAA,MAAM,CAAC6B,mBAAP,CAA2Bf,IAA3B,EAAiCU,OAAjC,CAAyC,UAASb,OAAT,EAAkB;AACzD,cAAIiB,WAAW,CAACN,cAAZ,CAA2BX,OAA3B,CAAJ,EAAyC;AACvC,iBAAKQ,QAAL,CAAcR,OAAd,EAAuBG,IAAI,CAACH,OAAD,CAA3B;AACD;AACF,SAJD,EAIG,IAJH;AAKD,OAxCM;;AA0CP;AACJ;AACA;AACA;AACA;AACA;AACImB,MAAAA,QAAQ,EAAE,kBAASnB,OAAT,EAAkB;AAC1B,eAAO,KAAKR,QAAL,CAAcQ,OAAd,CAAP;AACD,OAlDM;;AAoDP;AACJ;AACA;AACA;AACA;AACA;AACA;AACIoB,MAAAA,iBAAiB,EAAE,2BAASpB,OAAT,EAAkBqB,QAAlB,EAA4BC,OAA5B,EAAqC;AACtD,YAAI,CAAC,KAAK7B,QAAL,CAAsBO,OAAtB,CAAL,EAAqC;AACnC,eAAKP,QAAL,CAAsBO,OAAtB,IAAiC,EAAjC;AACD;;AACD,aAAKP,QAAL,CAAsBO,OAAtB,EAA+BuB,IAA/B,CAAoC,CAACF,QAAD,EAAWC,OAAX,CAApC;AACD,OAhEM;;AAkEP;AACJ;AACA;AACA;AACA;AACA;AACA;AACIE,MAAAA,oBAAoB,EAAE,8BAASxB,OAAT,EAAkBqB,QAAlB,EAA4BC,OAA5B,EAAqC;AACzD,YAAI,KAAK7B,QAAL,CAAsBO,OAAtB,CAAJ,EAAoC;AAClC,cAAIyB,WAAW,GAAG,CAAC,CAAnB;;AACA,eAAKhC,QAAL,CAAsBO,OAAtB,EAA+B0B,IAA/B,CAAoC,UAASC,KAAT,EAAgBC,CAAhB,EAAmB;AACrD,gBAAID,KAAK,CAAC,CAAD,CAAL,KAAaN,QAAb,IAAyBM,KAAK,CAAC,CAAD,CAAL,KAAaL,OAA1C,EAAmD;AACjDG,cAAAA,WAAW,GAAGG,CAAd;AACA,qBAAO,IAAP;AACD;AACF,WALD;;AAMA,cAAIH,WAAW,IAAI,CAAnB,EAAsB;AACpB,iBAAKhC,QAAL,CAAsBO,OAAtB,EAA+B6B,MAA/B,CAAsCJ,WAAtC,EAAmD,CAAnD;;AACA,gBAAI,KAAKhC,QAAL,CAAsBO,OAAtB,EAA+B8B,MAA/B,KAA0C,CAA9C,EAAiD;AAC/C,qBAAO,KAAKrC,QAAL,CAAsBO,OAAtB,CAAP;AACD;AACF;AACF;AACF,OAzFM;;AA2FP;AACJ;AACA;AACA;AACA;AACI+B,MAAAA,UAAU,EAAE,oBAAU/B,OAAV,EAAmBgC,EAAnB,EAAuB;AACjC,YAAIC,IAAI,GAAG,KAAKvC,QAAhB;;AACA,YAAIM,OAAO,IAAIiC,IAAf,EAAqB;AACnBA,UAAAA,IAAI,CAACjC,OAAD,CAAJ,CAAcuB,IAAd,CAAmBS,EAAnB;AACD,SAFD,MAGK;AACHC,UAAAA,IAAI,CAACjC,OAAD,CAAJ,GAAgB,CAACgC,EAAD,CAAhB;AACD;AACF,OAxGM;;AA0GP;AACJ;AACA;AACA;AACIE,MAAAA,YAAY,EAAE,wBAAY;AACxB,eAAO7C,MAAM,CAAC8C,IAAP,CAAY,KAAKzC,QAAjB,CAAP;AACD,OAhHM;;AAkHP;AACJ;AACA;AACA;AACI0C,MAAAA,cAAc,EAAE,wBAASC,KAAT,EAAgB;AAC9B,aAAK3C,QAAL,GAAqB2C,KAArB;AACD,OAxHM;;AA0HP;AACJ;AACA;AACA;AACIC,MAAAA,cAAc,EAAE,0BAAW;AACzB,eAAO,KAAK5C,QAAZ;AACD,OAhIM;;AAkIP;AACJ;AACA;AACA;AACI6C,MAAAA,gBAAgB,EAAE,4BAAW;AAC3B,aAAK7C,QAAL,GAAqB,EAArB;AACD,OAxIM;;AA0IP;AACJ;AACA;AACA;AACA;AACI8C,MAAAA,aAAa,EAAE,uBAAUC,IAAV,EAAgB;AAC7B,eAAO,KAAK9C,QAAL,CAAkB8C,IAAlB,MAA4B,KAAK9C,QAAL,CAAkB8C,IAAlB,IAA0B,EAAtD,CAAP;AACD,OAjJM;;AAoJP;AACJ;AACA;AACA;AACA;AACIC,MAAAA,sBAAsB,EAAE,gCAAUC,OAAV,EAAmB;AACzC,YACEC,MAAM,GAAGD,OAAO,CAACE,UADnB;AAAA,YAEEJ,IAAI,GAAGG,MAAM,CAACE,YAAP,CAAoB,IAApB,CAFT;;AAIA,YAAIL,IAAI,KAAKM,SAAb,EAAwB;AACtBN,UAAAA,IAAI,GAAGG,MAAM,CAACC,UAAP,CAAkBC,YAAlB,CAA+B,IAA/B,CAAP;AACD;;AACD,eAAO,KAAKN,aAAL,CAAmBC,IAAnB,CAAP;AACD,OAlKM;;AAoKP;AACJ;AACA;AACA;AACA;AACA;AACA;AACIO,MAAAA,aAAa,EAAE,uBAAUP,IAAV,EAAgBQ,GAAhB,EAAqB;AAClC,YAAI9C,IAAI,GAAG,KAAKqC,aAAL,CAAmBC,IAAnB,CAAX;AAEApD,QAAAA,MAAM,CAAC6B,mBAAP,CAA2B+B,GAA3B,EAAgCpC,OAAhC,CAAwC,UAASqC,QAAT,EAAmB;AACzD/C,UAAAA,IAAI,CAAC+C,QAAD,CAAJ,GAAiBD,GAAG,CAACC,QAAD,CAApB;AACD,SAFD,EAEG,IAFH;AAGA,eAAO/C,IAAP;AACD,OAlLM;;AAoLP;AACJ;AACA;AACA;AACIgD,MAAAA,kBAAkB,EAAE,4BAASd,KAAT,EAAgB;AAClC,aAAK1C,QAAL,GAAoB0C,KAApB;AACD,OA1LM;;AA4LP;AACJ;AACA;AACA;AACIe,MAAAA,kBAAkB,EAAE,8BAAW;AAC7B,eAAO,KAAKzD,QAAZ;AACD,OAlMM;;AAoMP;AACJ;AACA;AACA;AACI0D,MAAAA,oBAAoB,EAAE,gCAAW;AAC/B,aAAK1D,QAAL,GAAoB,EAApB;AACD,OA1MM;;AA4MP;AACJ;AACA;AACA;AACI2D,MAAAA,KAAK,EAAE,iBAAW;AAChB,aAAK5D,QAAL,GAAqB,EAArB;AACA,aAAKC,QAAL,GAAoB,EAApB;AACA,aAAKH,QAAL,GAAgB,EAAhB;AACA,aAAKC,QAAL,GAAwB,EAAxB;AACD;AArNM;AAvCsB,GAAjC;AA3BAS,EAAAA,EAAE,CAACC,IAAH,CAAQC,KAAR,CAAcpB,aAAd,GAA8BA,aAA9B",
  "sourcesContent": [
    "/* Model.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Internal Model which holds all relevant data like addresses and widgetData\n * and the states. Widget can add themselves as listeners to updates of certain addresses.\n *\n * @author Tobias Br√§utigam\n * @since 0.11.0 (2017)\n */\nqx.Class.define('cv.data.Model', {\n  extend: qx.core.Object,\n  type: \"singleton\",\n\n  /*\n  ******************************************************\n    CONSTRUCTOR\n  ******************************************************\n  */\n  construct: function() {\n    this.__states = {};\n    this.__stateListeners = {};\n    this.__addressList = {};\n    this.__widgetData = {};\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    READ: 1,\n    WRITE: 2,\n\n    isReadAddress: function(address) {\n      return !!(address.mode & cv.data.Model.READ);\n    },\n\n    isWriteAddress: function(address) {\n      return !!(address.mode & cv.data.Model.WRITE);\n    }\n  },\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    __states : null,\n    __stateListeners: null,\n    __addressList : null,\n    __widgetData: null,\n\n    getStateListener: function () {\n      return this.__stateListeners;\n    },\n\n    /**\n     * Updates the state of a single address\n     *\n     * @param address {String} KNX-GA or openHAB item name\n     * @param state {var} new state\n     */\n    onUpdate: function(address, state) {\n      var initial = !this.__states.hasOwnProperty(address);\n      var changed = initial || this.__states[address] !== state;\n      this.__states[address] = state;\n      // notify listeners\n      if (this.__stateListeners[address]) {\n        this.__stateListeners[address].forEach(function(listener) {\n          listener[0].call(listener[1], address, state, initial, changed);\n        }, this);\n      }\n    },\n\n    /**\n     * Handle incoming data from backend\n     * @param data {Map} Key/value map of address/state\n     */\n    update: function(data) {\n      if (!data) { return; }\n      var addressList = this.__addressList;\n      Object.getOwnPropertyNames(data).forEach(function(address) {\n        if (addressList.hasOwnProperty(address)) {\n          this.onUpdate(address, data[address]);\n        }\n      }, this);\n    },\n\n    /**\n     * Get the current state of an address.\n     *\n     * @param address {String} KNX-GA or openHAB item name\n     * @return {var}\n     */\n    getState: function(address) {\n      return this.__states[address];\n    },\n\n    /**\n     * Add a listener to an address, that gets called when an update for that address has been received.\n     *\n     * @param address {String} KNX-GA or openHAB item name\n     * @param callback {Function} called on updates\n     * @param context {Object} context of the callback\n     */\n    addUpdateListener: function(address, callback, context) {\n      if (!this.__stateListeners[address]) {\n        this.__stateListeners[address] = [];\n      }\n      this.__stateListeners[address].push([callback, context]);\n    },\n\n    /**\n     * Remove an address listener\n     *\n     * @param address {String} KNX-GA or openHAB item name\n     * @param callback {Function} called on updates\n     * @param context {Object} context of the callback\n     */\n    removeUpdateListener: function(address, callback, context) {\n      if (this.__stateListeners[address]) {\n        var removeIndex = -1;\n        this.__stateListeners[address].some(function(entry, i) {\n          if (entry[0] === callback && entry[1] === context) {\n            removeIndex = i;\n            return true;\n          }\n        });\n        if (removeIndex >= 0) {\n          this.__stateListeners[address].splice(removeIndex, 1);\n          if (this.__stateListeners[address].length === 0) {\n            delete this.__stateListeners[address];\n          }\n        }\n      }\n    },\n\n    /**\n     * Add an Address -> Path mapping to the addressList\n     * @param address {String} KNX-GA or openHAB item name\n     * @param id {String} path to the widget\n     */\n    addAddress: function (address, id) {\n      var list = this.__addressList;\n      if (address in list) {\n        list[address].push(id);\n      }\n      else {\n        list[address] = [id];\n      }\n    },\n\n    /**\n     * Get the addresses as Array.\n     * @return {Map} Address -> path mapping\n     */\n    getAddresses: function () {\n      return Object.keys(this.__addressList);\n    },\n\n    /**\n     * Setter for address list.\n     * @param value {Map} Address -> path mapping\n     */\n    setAddressList: function(value) {\n      this.__addressList = value;\n    },\n\n    /**\n     * Getter for the address list.\n     * @return {Map} Address -> path mapping\n     */\n    getAddressList: function() {\n      return this.__addressList;\n    },\n\n    /**\n     * Clears the current address list.\n     * @internal\n     */\n    resetAddressList: function() {\n      this.__addressList = {};\n    },\n\n    /**\n     * Return (reference to) widgetData object by path.\n     * @param path {String} widget path\n     * @return {Map} widget data map\n     */\n    getWidgetData: function (path) {\n      return this.__widgetData[path] || (this.__widgetData[path] = {});\n    },\n\n\n    /**\n     * Return (reference to) widget data by element\n     * @param element {Element} DOM-Element to retrieve the widgetData for\n     * @return {Map} widget data Map\n     */\n    getWidgetDataByElement: function (element) {\n      var\n        parent = element.parentNode,\n        path = parent.getAttribute('id');\n\n      if (path === undefined) {\n        path = parent.parentNode.getAttribute('id');\n      }\n      return this.getWidgetData(path);\n    },\n\n    /**\n     * Merge obj in the widgetData.\n     *\n     * @param path {String} widget path to store the data\n     * @param obj {Map} data to store\n     * @return {Map} updated widget data map\n     */\n    setWidgetData: function (path, obj) {\n      var data = this.getWidgetData(path);\n\n      Object.getOwnPropertyNames(obj).forEach(function(attrname) {\n        data[attrname] = obj[attrname];\n      }, this);\n      return data;\n    },\n\n    /**\n     * Setter for widget data model\n     * @param value {Map} path -> widget data map\n     */\n    setWidgetDataModel: function(value) {\n      this.__widgetData = value;\n    },\n\n    /**\n     * Getter for widget data model\n     * @return {Map} path -> widget data map\n     */\n    getWidgetDataModel: function() {\n      return this.__widgetData;\n    },\n\n    /**\n     * Clear the widget data model.\n     * @internal\n     */\n    resetWidgetDataModel: function() {\n      this.__widgetData = {};\n    },\n\n    /**\n     * Clear the model, internal method for testing purposes\n     * @internal\n     */\n    clear: function() {\n      this.__addressList = {};\n      this.__widgetData = {};\n      this.__states = {};\n      this.__stateListeners = {};\n    }\n  }\n\n});"
  ]
}