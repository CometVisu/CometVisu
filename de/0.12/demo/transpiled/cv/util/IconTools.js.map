{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/util/IconTools.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "hexColorRegEx",
    "colorMapping",
    "white",
    "orange",
    "red",
    "green",
    "blue",
    "purple",
    "yellow",
    "grey",
    "black",
    "iconCache",
    "iconCacheMap",
    "iconDelay",
    "iconDelayFn",
    "tmpCanvas",
    "tmpCtx",
    "iconDelayed",
    "icon",
    "colors",
    "color",
    "cv",
    "util",
    "IconTools",
    "push",
    "setInterval",
    "length",
    "fillRecoloredIcon",
    "shift",
    "clearInterval",
    "bind",
    "createCanvas",
    "iconId",
    "styling",
    "classes",
    "fillCanvas",
    "canvas",
    "imageData",
    "width",
    "height",
    "getContext",
    "putImageData",
    "innerRecolorLoop",
    "navigator",
    "userAgent",
    "toLowerCase",
    "indexOf",
    "parseFloat",
    "slice",
    "r",
    "g",
    "b",
    "data",
    "i",
    "a",
    "doRecolorNonTransparent",
    "thisIcon",
    "thisIconColors",
    "drawImage",
    "getImageData",
    "undefined",
    "test",
    "log",
    "Logger",
    "error",
    "parseInt",
    "substr",
    "recolorNonTransparent",
    "url",
    "loadHandler",
    "toFill",
    "thisFillColor",
    "pop",
    "asText",
    "Image",
    "onload",
    "src",
    "id",
    "c",
    "complete",
    "newCanvas",
    "newElement",
    "document",
    "querySelector",
    "parameters",
    "className",
    "split",
    "baseVal",
    "substring",
    "cacheEntry",
    "coloredIcon",
    "svgKUF",
    "iconID",
    "iconPath",
    "ResourceManager",
    "getInstance",
    "toUri",
    "style",
    "defer",
    "createElement",
    "self"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* IconTools.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * @author Christian Mayer\n * @since 2015\n */\nqx.Class.define('cv.util.IconTools', {\n  type: \"static\",\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n\n    // \"global\" functions (=> state less)\n    hexColorRegEx: /#[0-9a-fA-F]{6}/,\n    colorMapping: { // as a convenience, definition of a few colors\n      white: '#ffffff',\n      orange: '#ff8000',\n      red: '#ff4444',\n      green: '#44ff44',\n      blue: '#4444ff',\n      purple: '#ff44ff',\n      yellow: '#ffff00',\n      grey: '#777777',\n      black: '#000000'\n    },\n    iconCache: {},    // the Image() of all knows (i.e. used) icons\n    iconCacheMap: [], // mapping of ID to Cache entry (URL)\n    iconDelay: [],    // array of all icons to fill where the Image is not ready yet\n    iconDelayFn: null,       // handler for delay function\n\n    tmpCanvas: null,\n    tmpCtx: null,\n\n    iconDelayed: function (icon, colors, color) {\n      cv.util.IconTools.iconDelay.push([icon, colors, color]);\n      if (!cv.util.IconTools.iconDelayFn) {\n        cv.util.IconTools.iconDelayFn = setInterval(function () {\n          while (cv.util.IconTools.iconDelay.length) {\n            // it should be enough to test only the first element - the other\n            // elements will be covered anyway...\n            if (cv.util.IconTools.iconDelay[0][2] in cv.util.IconTools.iconDelay[0][1]) {\n              cv.util.IconTools.fillRecoloredIcon(cv.util.IconTools.iconDelay.shift()[0]);\n            }\n            else {\n              break;\n            }\n          }\n\n          if (0 === cv.util.IconTools.iconDelay.length) {\n            clearInterval(cv.util.IconTools.iconDelayFn);\n            cv.util.IconTools.iconDelayFn = 0;\n          }\n        }.bind(this), 10);\n      }\n    },\n    /**\n     * Create the HTML for the canvas element and return it.\n     */\n    createCanvas: function (iconId, styling, classes) {\n      return '<canvas class=\"' + iconId + ' ' + classes + '\" ' + styling + '/>';\n    },\n    /**\n     * Fill the canvas with the ImageData. Also resize the\n     * canvas at the same time.\n     */\n    fillCanvas: function (canvas, imageData) {\n      canvas.width = imageData.width;\n      canvas.height = imageData.height;\n      canvas.getContext('2d').putImageData(imageData, 0, 0);\n    },\n    /**\n     * Two versions of a recoloring funtion to work around an Android bug:\n     * http://stackoverflow.com/questions/14969496/html5-canvas-pixel-manipulation-problems-on-mobile-devices-when-setting-the-alph\n     * https://code.google.com/p/android/issues/detail?id=17565\n     *\n     */\n    innerRecolorLoop: navigator.userAgent.toLowerCase().indexOf('android') > -1 && parseFloat(navigator.userAgent.slice(navigator.userAgent.toLowerCase().indexOf('android') + 8)) < 4.4 ?\n      function (r, g, b, data, length) // for Android version < 4.4\n      {\n        for (var i = 0; i < length; i += 4) {\n          var a = data[i + 3];\n          if (a > 127) {\n            data[i] = r;\n            data[i + 1] = g;\n            data[i + 2] = b;\n            data[i + 3] = 255;\n          } else { // brute force it...\n            data[i] = 0;\n            data[i + 1] = 0;\n            data[i + 2] = 0;\n            data[i + 3] = 0;\n          }\n        }\n      } :\n      function (r, g, b, data, length) // the normal version\n      {\n        for (var i = 0; i < length; i += 4) {\n          if (0 !== data[i + 3]) {\n            data[i] = r;\n            data[i + 1] = g;\n            data[i + 2] = b;\n          }\n        }\n      },\n    /**\n     * Do the recoloring based on @param thisIcon and store it in the\n     * hash @param thisIconColors.\n     */\n    doRecolorNonTransparent: function (color, thisIcon, thisIconColors) {\n      if (thisIconColors[color]) {\n        return; // done, already recolored\n      }\n      var\n        width = cv.util.IconTools.tmpCanvas.width = thisIcon.width,\n        height = cv.util.IconTools.tmpCanvas.height = thisIcon.height;\n      cv.util.IconTools.tmpCtx.drawImage(thisIcon, 0, 0);\n\n      var imageData = cv.util.IconTools.tmpCtx.getImageData(0, 0, width, height);\n      if (color !== undefined) {\n        if (!cv.util.IconTools.hexColorRegEx.test(color)) {\n          qx.log.Logger.error(this, 'Error! \"' + color + '\" is not a valid color for icon recoloring! It must have a shape like \"#aabbcc\".');\n        }\n        var r = parseInt(color.substr(1, 2), 16),\n          g = parseInt(color.substr(3, 2), 16),\n          b = parseInt(color.substr(5, 2), 16);\n        cv.util.IconTools.innerRecolorLoop(r, g, b, imageData.data, width * height * 4);\n      }\n      thisIconColors[color] = imageData;\n    },\n\n    /**\n     * Funtion to call for each icon that should be dynamically recolored.\n     * This will be called for each known URL, so only remember the string but\n     * don't load the image yet as it might not be needed.\n     */\n    recolorNonTransparent: function (url) {\n      var\n        loadHandler = function () {\n          var\n            toFill = cv.util.IconTools.iconCache[url].toFill,\n            thisIcon = cv.util.IconTools.iconCache[url].icon,\n            thisIconColors = cv.util.IconTools.iconCache[url].colors,\n            thisFillColor;\n          while (thisFillColor = toFill.pop()) { // jshint ignore:line\n            cv.util.IconTools.doRecolorNonTransparent(thisFillColor, thisIcon, thisIconColors);\n          }\n        };\n\n      /**\n       * will be called for each color that is actually used\n       * => load image for all colors\n       * => transform image\n       * @return {Function} a function that will append the recolored image to\n       *         the jQuery element passed to that function\n       */\n      return function (color, styling, classes, asText) {\n        if (undefined === cv.util.IconTools.iconCache[url]) {\n          var thisIcon = new Image();\n          thisIcon.onload = loadHandler;\n          thisIcon.src = url;\n\n          cv.util.IconTools.iconCache[url] = {\n            icon: thisIcon,            // the original Image() of the icon\n            id: cv.util.IconTools.iconCacheMap.length, // the unique ID for this icon\n            colors: {},                  // cache all the transformed ImageDatas\n            toFill: []                   // all the icon colors to fill once the image was loaded\n          };\n          cv.util.IconTools.iconCacheMap.push(url);\n        }\n\n        if (color === undefined) {\n          color = '#ffffff';\n        }\n        if (color in cv.util.IconTools.colorMapping) {\n          color = cv.util.IconTools.colorMapping[color];\n        }\n        var c = 'icon' + cv.util.IconTools.iconCache[url].id + '_' + color.substr(1, 6);\n        cv.util.IconTools.iconCache[url].toFill.push(color);\n\n        // when already available - fill it now. Otherwise the onLoad will do it.\n        if (cv.util.IconTools.iconCache[url].icon.complete) {\n          loadHandler();\n        }\n        var newCanvas = cv.util.IconTools.createCanvas(c, styling, classes);\n        if (asText) {\n          return newCanvas;\n        }\n        var newElement = document.querySelector(newCanvas);\n        if (cv.util.IconTools.iconCache[url].icon.complete) {\n          cv.util.IconTools.fillCanvas(newElement, cv.util.IconTools.iconCache[url].colors[color]);\n        }\n        else {\n          cv.util.IconTools.iconDelayed(newElement, cv.util.IconTools.iconCache[url].colors, color);\n        }\n        return newElement;\n      };\n    },\n\n    /**\n     * This function must be called to fill a specific icon that was created\n     */\n    fillRecoloredIcon: function (icon) {\n      var\n        parameters = (icon.className.split ? icon.className.split(' ') : icon.className.baseVal.split(' '))[0].substring(4).split('_');\n      if (2 === parameters.length) {\n        var\n          cacheEntry = cv.util.IconTools.iconCache[cv.util.IconTools.iconCacheMap[parameters[0]]],\n          coloredIcon = cacheEntry.colors['#' + parameters[1]];\n\n        if (undefined === coloredIcon) {\n          cv.util.IconTools.iconDelayed(icon, cacheEntry.colors, '#' + parameters[1]);\n        }\n        else {\n          cv.util.IconTools.fillCanvas(icon, coloredIcon);\n        }\n      }\n    },\n\n    svgKUF: function (iconID) {\n      return function (color, styling, classes) {\n        if (color in cv.util.IconTools.colorMapping) {\n          color = cv.util.IconTools.colorMapping[color];\n        }\n        var iconPath = qx.util.ResourceManager.getInstance().toUri('icons/knx-uf-iconset.svg');\n        var style = styling || \"\";\n        if (color) {\n          style += 'color:' + color + ';';\n        }\n        if (style) {\n          style = ' style=\"'+style+'\"';\n        }\n        return '<svg ' + style + ' class=\"' + classes + '\"><use xlink:href=\"'+iconPath+'#kuf-' + iconID + '\"></use></svg>';\n      };\n    }\n  },\n\n  defer: function() {\n    var canvas = document.createElement('canvas');\n    this.defer.self.tmpCanvas = canvas;\n    this.defer.self.tmpCtx = canvas.getContext('2d');\n  }\n});\n"
  ]
}