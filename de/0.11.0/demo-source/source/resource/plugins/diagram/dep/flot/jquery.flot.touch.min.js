!function(t){function e(e){function o(t){var o=e.getPlaceholder(),n=e.getOptions();if(m.x-=t.x,m.y-=t.y,n.touch.css)switch(n.touch.pan.toLowerCase()){case"x":o.css("transform","translateX("+m.x+"px)");break;case"y":o.css("transform","translateY("+m.y+"px)");break;default:o.css("transform","translate("+m.x+"px,"+m.y+"px)")}}function n(t){var o=e.getPlaceholder(),n=e.getOptions();if(w*=1+t/100,n.touch.css)switch(n.touch.scale.toLowerCase()){case"x":o.css("transform","scaleX("+w+")");break;case"y":o.css("transform","scaleY("+w+")");break;default:o.css("transform","scale("+w+")")}}function a(e,o){var n=e.getPlaceholder(),o=e.getOptions();if(o.touch.autoWidth&&n.css("width","100%"),o.touch.autoHeight){var a=n.parent(),c=0;a.siblings().each(function(){c-=t(this).outerHeight()}),c-=parseInt(a.css("padding-top"),10),c-=parseInt(a.css("padding-bottom"),10),c+=window.innerHeight,n.css("height",0>=c?100:c+"px")}}function c(){return(new Date).getTime()}function i(e,a){var i=e.getPlaceholder(),r=e.getOptions();r.touch.css&&i.parent("div").css({overflow:"hidden"}),i.bind("touchstart",function(o){clearTimeout(u);var n=o.originalEvent.touches,a=e.getPlaceholder(),i=e.getOptions();t.each(e.getAxes(),function(t,e){(e.direction===i.touch.scale.toLowerCase()||"xy"==i.touch.scale.toLowerCase())&&(e.touch={min:e.min,max:e.max})}),g=c(),1===n.length?(d=!0,x={x:n[0].pageX,y:n[0].pageY},f=0,X++):2===n.length&&(l=!0,x={x:(n[0].pageX+n[1].pageX)/2,y:(n[0].pageY+n[1].pageY)/2},f=Math.sqrt(Math.pow(n[1].pageX-n[0].pageX,2)+Math.pow(n[1].pageY-n[0].pageY,2)));var s=a.offset(),r={x:s.left,y:s.top,width:a.width(),height:a.height()};return y={x:x.x,y:x.y},y.x<r.x?y.x=r.x:y.x>r.x+r.width&&(y.x=r.x+r.width),y.y<r.y?y.y=r.y:y.y>r.y+r.height&&(y.y=r.y+r.height),v={x:Math.round(y.x/r.width*100),y:Math.round(y.y/r.height*100)},i.touch.css&&a.css("transform-origin",v.x+"% "+v.y+"%"),a.trigger("touchstarted",[y]),!1}),i.bind("touchmove",function(t){var a,c,i,r=e.getOptions(),h=t.originalEvent.touches;if(d&&1===h.length?(a={x:h[0].pageX,y:h[0].pageY},i={x:x.x-a.x,y:x.y-a.y},o(i),x=a,f=0):l&&2===h.length&&(c=Math.sqrt(Math.pow(h[1].pageX-h[0].pageX,2)+Math.pow(h[1].pageY-h[0].pageY,2)),a={x:(h[0].pageX+h[1].pageX)/2,y:(h[0].pageY+h[1].pageY)/2},i=c-f,n(i),x=a,f=c),!r.touch.css){var u=(new Date).getTime(),p=u-b;p>50&&(b=u,window.requestAnimationFrame(s))}}),i.bind("touchend",function(o){var n=e.getPlaceholder(),a=e.getOptions(),i=o.originalEvent.changedTouches;if(p=setTimeout(function(){X=0},a.touch.dbltapThreshold),d&&1===i.length&&g+a.touch.tapThreshold-c()>=0&&y.x>=x.x-a.touch.tapPrecision&&y.x<=x.x+a.touch.tapPrecision&&y.y>=x.y-a.touch.tapPrecision&&y.y<=x.y+a.touch.tapPrecision){if(2===X?n.trigger("dbltap",[x]):n.trigger("tap",[x]),a.touch.simulClick){var s=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,detail:X,screenX:i[0].screenX,screenY:i[0].screenY,clientX:i[0].clientX,clientY:i[0].clientY,button:0});i[0].target.dispatchEvent(s)}}else{var r={};c1={x:0,y:0},c2={x:e.width(),y:e.height()},t.each(e.getAxes(),function(t,e){if(e.used){var o=e.c2p(c1[e.direction]),n=e.c2p(c2[e.direction]);r[t]={from:Math.min(o,n),to:Math.max(o,n)}}}),u=setTimeout(function(){n.trigger("touchended",[r])},a.touch.delayTouchEnded)}d=!1,l=!1,x={x:-1,y:-1},y=x,f=0,m={x:0,y:0},w=1,v={x:50,y:50},a.touch.css&&n.css({transform:"translate("+m.x+"px,"+m.y+"px) scale("+w+")","transform-origin":v.x+"% "+v.y+"%"})})}function s(){var t=e.getOptions();r(),"function"==typeof t.touch.callback?t.touch.callback():(e.setupGrid(),e.draw())}function r(){var o=e.getOptions();if((0!==m.x||0!==m.y)&&t.each(e.getAxes(),function(t,e){if(e.direction===o.touch.pan.toLowerCase()||"xy"==o.touch.pan.toLowerCase()){var n=e.c2p(e.p2c(e.touch.min)-m[e.direction]),a=e.c2p(e.p2c(e.touch.max)-m[e.direction]);e.options.min=n,e.options.max=a}}),1!==w){var n=e.width(),a=e.height(),c={x:Math.round(v.x/100*n),y:Math.round(v.y/100*a)},i={x:{min:c.x-v.x/100*n/w,max:c.x+(1-v.x/100)*n/w},y:{min:c.y-v.y/100*a/w,max:c.y+(1-v.y/100)*a/w}};t.each(e.getAxes(),function(t,e){if(e.direction===o.touch.scale.toLowerCase()||"xy"==o.touch.scale.toLowerCase()){var n=e.c2p(i[e.direction].min),a=e.c2p(i[e.direction].max);if(n>a){var c=n;n=a,a=c}e.options.min=n,e.options.max=a}})}}function h(t,e){var o=t.getPlaceholder();o.unbind("touchstart").unbind("touchmove").unbind("touchend")}if(t.support.touch="ontouchend"in document,t.support.touch){var u,p,g,d=!1,l=!1,x={x:-1,y:-1},y=x,f=0,m={x:0,y:0},w=1,v={x:50,y:50},b=(new Date).getTime(),X=0;e.hooks.processOptions.push(a),e.hooks.bindEvents.push(i),e.hooks.shutdown.push(h)}}t.plot.plugins.push({init:e,options:{touch:{pan:"xy",scale:"xy",css:!1,autoWidth:!1,autoHeight:!1,delayTouchEnded:500,callback:null,simulClick:!0,tapThreshold:150,dbltapThreshold:200,tapPrecision:30}},name:"touch",version:"3.0"})}(jQuery);