qx.$$packageData['1024']={"locales":{},"resources":{},"translations":{"de":{},"en":{}}};
qx.Part.$$notifyLoad("1024", function() {
(function(){var a='TR064_calllist',b='<audio preload="none">',c='audio_play',d='String',e='resource/plugins/tr064/soap.php?device=',f='type;date;nameOrCaller;tam',g='control_reload',h=';',j='',k='timer',l='tam',m='&uri=',n='interval',o='%26max=',p=': ',q='cv.plugins.tr064.CallList',r='<div class="actor"><table class="TR064_calllist"><tr><td>Loading...</td></tr></table></div>',s='tr064ListRefreshed',t='</td>',u='phone_answering',v='nameOrCaller',w='resource/plugins/tr064/proxy.php?device=',x='phone_ring_out',y='phone_call_end_in',z='resource/plugins/tr064/tr064.css',A='update',B='%26sid=',C="text/xml",D="calllist",E='*',F='text_question_mark',G='phone_call_in',H='</tr>',I='qx.event.type.Event',J='<source src="resource/plugins/tr064/proxy.php?device=',K='</audio>',L='date',M='</div>',N='ended',O='phone_ring_in',P=' failed with status ',Q='">',R='&location=upnp/control/x_contact&uri=urn:dslforum-org:service:X_AVM-DE_OnTel:1&fn=GetCallList',S='<xml/>',T='name',U='Error: reading URL "',V='type',W='initial',X='phone_call_out',Y='getCallListURI',bo='<fail>',bp="click",bq='phone_missed_in',bk='caller',bl='<td>',bm='Number',bn='<tr>',br='Call',bs='TR-064 refreshCalllist() error:',bt='<div class="tam clickable">';qx.Class.define(q,{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Refresh,cv.ui.common.Update],statics:{parse:function(bu,by,bw,bv){var bx=cv.parser.WidgetParser.parseElement(this,bu,by,bw,bv,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseFormat(bu,by);cv.parser.WidgetParser.parseAddress(bu,by);cv.parser.WidgetParser.parseRefresh(bu,by);return bx;},getAttributeToPropertyMappings:function(){return {'device':{},'max':{transform:function(bz){return +bz;}},'columns':{'default':f},'TAM':{'default':u},'TAMColor':{'default':j},'TAMwait':{'default':g},'TAMwaitColor':{'default':j},'TAMplay':{'default':c},'TAMplayColor':{'default':j},'TAMstop':{'default':u},'TAMstopColor':{'default':j},'typeIncoming':{'default':G},'typeIncomingColor':{'default':j},'typeMissed':{'default':bq},'typeMissedColor':{'default':j},'typeOutgoing':{'default':X},'typeOutgoingColor':{'default':j},'typeActiveIncoming':{'default':O},'typeActiveIncomingColor':{'default':j},'typeRejectedIncoming':{'default':y},'typeRejectedIncomingColor':{'default':j},'typeActiveOutgoing':{'default':x},'typeActiveOutgoingColor':{'default':j},'typeUnknown':{'default':F},'typeUnknownColor':{'default':j}};}},events:{'tr064ListRefreshed':I},properties:{device:{check:d,init:j},max:{check:bm,init:0},columns:{check:d},TAM:{check:d},TAMColor:{check:d},TAMwait:{check:d},TAMwaitColor:{check:d},TAMplay:{check:d},TAMplayColor:{check:d},TAMstop:{check:d},TAMstopColor:{check:d},typeIncoming:{check:d},typeIncomingColor:{check:d},typeMissed:{check:d},typeMissedColor:{check:d},typeOutgoing:{check:d},typeOutgoingColor:{check:d},typeActiveIncoming:{check:d},typeActiveIncomingColor:{check:d},typeRejectedIncoming:{check:d},typeRejectedIncomingColor:{check:d},typeActiveOutgoing:{check:d},typeActiveOutgoingColor:{check:d},typeUnknown:{check:d},typeUnknownColor:{check:d}},members:{__tO:j,__tP:undefined,__tQ:false,__tR:{},_getInnerDomString:function(){this.refreshCalllist(W);return r;},_setupRefreshAction:function(){this._timer=new qx.event.Timer(this.getRefresh());this._timer.addListener(n,function(){if(!this.__tQ){this.refreshCalllist(k);};},this);this._timer.start();},_update:function(bB,bA){if(!this.__tQ){this.refreshCalllist(A);};},_displayCalllist:function(){var self=this,bC=this.getDomElement().getElementsByClassName(a)[0],bF=this.__tO?this.__tO.replace(/.*sid=/,j):j,bE=j,bG={'0':{name:this.getTypeUnknown(),color:this.getTypeUnknownColor()},'1':{name:this.getTypeIncoming(),color:this.getTypeIncomingColor()},'2':{name:this.getTypeMissed(),color:this.getTypeMissedColor()},'3':{name:this.getTypeOutgoing(),color:this.getTypeOutgoingColor()},'9':{name:this.getTypeActiveIncoming(),color:this.getTypeActiveIncomingColor()},'10':{name:this.getTypeRejectedIncoming(),color:this.getTypeRejectedIncomingColor()},'11':{name:this.getTypeActiveOutgoing(),color:this.getTypeActiveOutgoingColor()}};this.__tP.forEach(function(bJ){var bH=j,bI=(bJ.Type in bG)?bG[bJ.Type]:bG[0];if(bJ.Path){bH=b+J+self.getDevice()+m+bJ.Path+B+bF+Q+K+bt+cv.IconHandler.getInstance().getIconText(self.getTAM(),E,E,self.getTAMColor())+M;};bE+=bn;self.getColumns().split(h).forEach(function(bK){switch(bK){case V:bE+=bl+cv.IconHandler.getInstance().getIconText(bI.name,E,E,bI.color)+t;break;case L:bE+=bl+bJ.Date+t;break;case T:bE+=bl+bJ.Name+t;break;case bk:bE+=bl+bJ.Caller+t;break;case v:if(bJ.Name!==j){bE+=bl+bJ.Name+t;}else {bE+=bl+bJ.Caller+t;};break;case l:bE+=bl+bH+t;break;};});bE+=H;});bC.innerHTML=bE;var bD=bC.getElementsByClassName(l);for(var i=0;i<bD.length;i++ ){bD[i].addEventListener(bp,function(){self.__tS(this);});};},_getCallListURI:function(){var self=this,bL=e+this.getDevice()+R;window.fetch(bL).then(function(bM){if(bM.ok){return bM.json();};console.error(U+bM.url+P+bM.status+p+bM.statusText);self.__tO=bo;}).then(function(bN){self.__tO=bN;self.refreshCalllist(Y);});},refreshCalllist:function(bP){this.__tQ=true;if(this.__tO===bo){return;};if(this.__tO===j){this._getCallListURI();return;};var self=this,bO=w+this.getDevice()+m+this.__tO+o+this.getMax();window.fetch(bO).then(function(bQ){if(bQ.ok){return bQ.text();};console.error(U+bQ.url+P+bQ.status+p+bQ.statusText);return S;}).then(function(bR){return (new window.DOMParser()).parseFromString(bR,C);}).then(function(bW){self.__tP=[];var bU=bW.getElementsByTagName(br);for(var i=0;i<bU.length;i++ ){var bT=bU[i].children,bV={};for(var bS=0;bS<bT.length;bS++ ){bV[bT[bS].nodeName]=bT[bS].textContent;};self.__tP.push(bV);};self._displayCalllist();self.__tQ=false;self.fireEvent(s);}).catch(function(bX){console.error(bs,bX);});},__tS:function(cb){var self=this,bY=cb.previousElementSibling;if(!this.__tR[bY]){bY.addEventListener(N,function(){self.__tV(cb);});this.__tR[bY]=true;};if(bY.readyState<4){this.__tT(cb);};if(bY.paused){var ca=bY.play();if(ca!==undefined){ca.then(function(){self.__tU(cb);}).catch(function(){});};}else {bY.pause();bY.currentTime=0;this.__tV(cb);};},__tT:function(cc){cc.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMwait(),E,E,this.getTAMwaitColor());},__tU:function(cd){cd.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMplay(),E,E,this.getTAMplayColor());},__tV:function(ce){ce.innerHTML=cv.IconHandler.getInstance().getIconText(this.getTAMstop(),E,E,this.getTAMstopColor());}},defer:function(cf){var cg=cv.util.ScriptLoader.getInstance();cg.addStyles(z);cv.parser.WidgetParser.addHandler(D,cv.plugins.tr064.CallList);cv.ui.structure.WidgetFactory.registerClass(D,cf);}});})();
});