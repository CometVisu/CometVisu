{"version":3,"names":["qx","Class","define","extend","cv","ui","structure","pure","AbstractBasicWidget","construct","props","constructor","call","this","__P_18_0","statics","parse","xml","path","flavour","pageType","parser","WidgetParser","parseElement","getAttributeToPropertyMappings","target","default","time","transform","parseFloat","debug","value","properties","check","init","members","__P_18_2","__P_18_3","__P_18_4","__P_18_5","__P_18_1","isDebug","getTime","getTarget","event","Timer","deltaT","ev","getData","document","querySelector","innerText","_onUserAction","timeoutTrigger","pageNavigationHandler","Application","structureController","getCurrentPage","getDomElement","scrollTop","destruct","_disposeObjects","defer","addHandler","plugins","Timeout","WidgetFactory","registerClass","$$dbClassInfo"],"sources":["/home/runner/work/CometVisu/CometVisu/source/class/cv/plugins/Timeout.js"],"sourcesContent":["/* Timeout.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * This plugins jumps back to a defined page after a given timeout period\n *\n * @author Carsten Tschach (Carsten@Tschach.com)\n * @since 2012\n */\nqx.Class.define('cv.plugins.Timeout', {\n  extend: cv.ui.structure.pure.AbstractBasicWidget,\n\n  /*\n  ******************************************************\n    CONSTRUCTOR\n  ******************************************************\n  */\n  construct(props) {\n    super(props);\n    this.__timeoutIdleCount = 0;\n    this.__initialize();\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    /**\n     * Parses the widgets XML configuration and extracts the given information\n     * to a simple key/value map.\n     *\n     * @param xml {Element} XML-Element\n     * @param path {String} internal path of the widget\n     * @param flavour {String} Flavour of the widget\n     * @param pageType {String} Page type (2d, 3d, ...)\n     * @return {Map} extracted data from config element as key/value map\n     */\n    parse(xml, path, flavour, pageType) {\n      return cv.parser.pure.WidgetParser.parseElement(\n        this,\n        xml,\n        path,\n        flavour,\n        pageType,\n        this.getAttributeToPropertyMappings()\n      );\n    },\n\n    getAttributeToPropertyMappings() {\n      return {\n        target: { default: 'id_' },\n        time: { default: 600, transform: parseFloat },\n        debug: {\n          default: false,\n          transform(value) {\n            return value === 'true';\n          }\n        }\n      };\n    }\n  },\n\n  /*\n   ******************************************************\n   PROPERTIES\n   ******************************************************\n   */\n  properties: {\n    target: {\n      check: 'String',\n      init: 'id_'\n    },\n\n    time: {\n      check: 'Number',\n      init: 600\n    },\n\n    debug: {\n      check: 'Boolean',\n      init: false\n    }\n  },\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    __timeoutIdleCount: null,\n    __timeoutCurrentPage: null,\n    __timeoutCurrentPageTitle: null,\n    __timeoutTargetPage: null,\n    __timer: null,\n\n    __initialize() {\n      if (this.isDebug()) {\n        this.debug('Timeout Set to : ' + this.getTime());\n        this.debug('Target Page: ' + this.getTarget());\n      }\n\n      const deltaT = this.getTime() * 100;\n      this.__timer = new qx.event.Timer(deltaT);\n      this.__timer.addListener('interval', this.timeoutTrigger, this);\n      this.__timer.start();\n\n      // Reset Counter on every interaction\n      qx.event.Registration.addListener(window, 'useraction', this._onUserAction, this);\n\n      // Keep track of current page\n      qx.event.message.Bus.subscribe(\n        'path.pageChanged',\n        function (ev) {\n          const path = ev.getData();\n          this.__timeoutCurrentPage = path;\n          this.__timeoutCurrentPageTitle = document.querySelector('#' + path + ' div > h1').innerText;\n          this.__timeoutIdleCount = 0;\n          /* We could trun on and off the above binds if we are already on the right page\n        if (timeoutCurrentPage === timeoutTargetPage) {\n        console.log(\"XXXXXX TIMEOUT: Scrolled to Target Page: \" + path);\n        } else {\n        console.log(\"XXXXXX TIMEOUT: Scrolled to: \" + path + \" (\"+timeoutTargetPage + \")\");\n        }\n        */\n        },\n        this\n      );\n    },\n\n    _onUserAction() {\n      this.__timeoutIdleCount = 0;\n    },\n\n    timeoutTrigger() {\n      if (this.isDebug()) {\n        this.debug('TIMEOUT: Got Trigger (' + this.__timeoutIdleCount + ')');\n      }\n      this.__timeoutIdleCount++;\n      this.__timeoutTargetPage = this.getTarget();\n      if (this.__timeoutIdleCount >= 10) {\n        this.__timeoutIdleCount = 0;\n        const pageNavigationHandler = cv.Application.structureController;\n\n        if (\n          this.__timeoutCurrentPage !== this.__timeoutTargetPage &&\n          this.__timeoutCurrentPageTitle !== this.__timeoutTargetPage\n        ) {\n          if (this.isDebug()) {\n            this.debug('TIMEOUT: Got Timeout - Now Goto Page ' + this.__timeoutTargetPage);\n          }\n          pageNavigationHandler.scrollToPage(this.__timeoutTargetPage);\n          pageNavigationHandler.getCurrentPage().getDomElement().scrollTop = 0;\n          //templateEngine.updateTopNavigation();\n        } else {\n          if (this.isDebug()) {\n            this.debug('TIMEOUT: Already on page ' + this.__timeoutTargetPage);\n          }\n          pageNavigationHandler.getCurrentPage().getDomElement().scrollTop = 0;\n        }\n      }\n    }\n  },\n\n  /*\n  ******************************************************\n    DESTRUCTOR\n  ******************************************************\n  */\n  destruct() {\n    this._disposeObjects('__timer');\n  },\n\n  defer(statics) {\n    cv.parser.pure.WidgetParser.addHandler('timeout', cv.plugins.Timeout);\n    cv.ui.structure.WidgetFactory.registerClass('timeout', statics);\n  }\n});\n"],"mappings":"iXAwBCA,GAAAC,MAAAC,OAAA,sBACCC,OAAOC,GAAAC,GAAOC,UAAAC,KAAAC,oBAOfC,UAAA,SAAAC,GACCN,GAAAC,GAAAC,UARoCC,KAAAC,oBAQnBG,YAAAC,KAAAC,KAAAH,GACfG,KAAAC,SAAA,E,iBASHC,QAAA,CAWAC,MAAA,SAAAC,EAAAC,EAAAC,EAAAC,GACG,OAXOhB,GAAAiB,OAAAd,KAWDe,aAAWC,aAXVV,KAW6BI,EAAAC,EAAAC,EAAAC,EAAAP,KAAAW,iC,EASnCA,+BApBM,WAsBP,OACEC,OAAO,CACLC,QAAQ,OAAAC,KADH,CAELD,QAAM,IAAEE,UAASC,YAAXC,MAFD,CAGLJ,SAAO,EACLE,UAAS,SADJG,GAEL,MAFK,SAAAA,C,MAcdC,WAAA,CACCP,OAAU,CACRQ,MAAQ,SACNC,KAAK,OADCP,KADE,CAMVM,MAAM,SACJC,KAAK,KADDJ,MANI,CAWVG,MAAO,UACLC,MAAK,IASVC,QAAA,CACCrB,SAAS,KACPsB,SAAoB,KACpBC,SAAsB,KACtBC,SAA2B,KAC3BC,SAAqB,KACrBC,SAAS,WAET,GAAA3B,KAPO4B,UAAA,CAQL5B,KAAIiB,MAAK,oBAAWjB,KAAA6B,WAClB7B,KAAKiB,MAAM,gBAAAjB,KAAsB8B,Y,0BAInC9B,KAAM0B,SAAS,IAAKvC,GAAA4C,MAALC,MAAfC,G,mOASE,IAAC5B,EAAM6B,EAATC,UAGInC,KAAMuB,SAAUlB,EAChBL,KAAKwB,SAAuBY,SAA5BC,cAAA,IAAAhC,EAAA,aAAAiC,UACAtC,KAAKC,SAA4B,CAQ1C,GAAAD,K,EAIIuC,cAvCM,WAyCPvC,KAAAC,SAzCO,C,EA2CNuC,eA3CM,WA6CPxC,KAAA4B,WACE5B,KAAIiB,MAAK,yBAAWjB,KAAAC,SAAA,K,gBAGpBD,KAAKyB,SAALzB,KAAA8B,Y,sBAEA9B,KAAIC,SAAA,EACF,IAAAwC,EAAAlD,GAAAmD,YAAAC,oB,iEAIE3C,KAAK4B,WAGL5B,KAAIiB,MAAK,wCAAWjB,KAAAyB,U,8BAGpBgB,EAAsBG,iBAAaC,gBAAnCC,UAAA,C,KACA,CARF9C,KAUO4B,WACL5B,KAAIiB,MAAK,4BAAWjB,KAAAyB,U,mDAa7BsB,SAAA,WACC/C,KAAAgD,gBAlKoC,W,EAoKnCC,MApKmC,SAAA/C,GAsKpCX,GAtKoCiB,OAAAd,KAAAe,aAAAyC,WAsKrB,UAAA3D,GAAA4D,QAAAC,SACb7D,GAAGC,GAAAC,UAAY4D,cAAaC,cAAW,UAAcpD,E,IAvKnBX,GAArC4D,QAAAC,QAAAG,e"}