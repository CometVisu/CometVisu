!function(){var t={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"cv.util.Function":{},"qx.util.ResourceManager":{},"cv.ui.PopupHandler":{},"cv.TemplateEngine":{},"cv.Transform":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(t);qx.Class.define("cv.plugins.Clock",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update],construct:function(t){t.value=new Date;cv.ui.structure.AbstractWidget.constructor.call(this,t)},properties:{src:{check:"String"},srcPopup:{check:"String"},titlePopup:{check:"String"},hide24h:{check:"Boolean",init:!1},hide24hPopup:{check:"Boolean",init:!1},hideAMPM:{check:"Boolean",init:!1},hideAMPMPopup:{check:"Boolean",init:!1},hideDigits:{check:"Boolean",init:!1},hideDigitsPopup:{check:"Boolean",init:!1},hideSeconds:{check:"Boolean",init:!1},hideSecondsPopup:{check:"Boolean",init:!1},sendOnFinish:{check:"Boolean",init:!1}},statics:{parse:function(t,e,i,r){var n=cv.parser.WidgetParser.parseElement(this,t,e,i,r,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseFormat(t,e);cv.parser.WidgetParser.parseAddress(t,e);return n},getAttributeToPropertyMappings:function(){var t=function(t){return"true"===t};return{src:{default:"plugins/clock/clock_pure.svg"},src_popup:{target:"srcPopup",default:""},title_popup:{target:"titlePopup",default:""},hide_24h:{target:"hide24h",default:!1,transform:t},hide_24h_popup:{target:"hide24hPopup",default:!1,transform:t},hide_am_pm:{target:"hideAMPM",default:!1,transform:t},hide_am_pm_popup:{target:"hideAMPMPopup",default:!1,transform:t},hide_digits:{target:"hideDigits",default:!1,transform:t},hide_digits_popup:{target:"hideDigitsPopup",default:!1,transform:t},hide_seconds:{target:"hideSeconds",default:!1,transform:t},hide_seconds_popup:{target:"hideSecondsPopup",default:!1,transform:t},send_on_finish:{target:"sendOnFinish",default:!1,transform:t}}},getElements:function(t,e,i,r,n){for(var o,s={hour24:t.querySelector("#Hour24"),hour:t.querySelector("#Hour"),minute:t.querySelector("#Minute"),second:t.querySelector("#Second"),am:t.querySelector("#AM"),pm:t.querySelector("#PM"),digits:t.querySelector("#Digits")};null!==s.digits&&null!==(o=s.digits.querySelector("tspan"));)s.digits=o;var u=t.querySelector("#Hour24Group");e&&null!==u&&u.setAttribute("display","none");if(i){if(null!==s.am){s.am.setAttribute("display","none");s.am=null}if(null!==s.pm){s.pm.setAttribute("display","none");s.pm=null}}r&&null!==s.digits&&s.digits.setAttribute("display","none");n&&null!==s.second&&s.second.setAttribute("display","none");return s}},members:{__P_8_0:null,__P_8_1:null,__P_8_2:0,_getInnerDomString:function(){return'<div class="actor" style="width:100%;height:100%"></div>'},_onDomReady:function(){var t=this,e=this;this.__P_8_3=cv.util.Function.throttle(this.dragAction,250,{trailing:!0},this);var i=qx.util.ResourceManager.getInstance().toUri(this.getSrc()),r=this.getSrcPopup(),n=[window.fetch(i)];if(""!==r){r=qx.util.ResourceManager.getInstance().toUri(r);n.push(window.fetch(r))}Promise.all(n).then(function(t){var e=[];if(!t[0].ok)throw new Error('Not 2xx response for URI "'+i+'"');e.push(t[0].text());if(""!==r){if(!t[1].ok)throw new Error('Not 2xx response for popup URI "'+r+'"');e.push(t[1].text())}return Promise.all(e)}).then(function(e){var i=t.getActor();i.innerHTML=e[0];var r=i.firstElementChild;if(!r.getAttribute("viewBox")){var n=r.getAttribute("width")||300,o=r.getAttribute("height")||150;r.setAttribute("viewBox","0 0 "+n+" "+o)}r.setAttribute("width","100%");r.setAttribute("height","100%");t.__P_8_1=[cv.plugins.Clock.getElements(r,t.getHide24h(),t.getHideAMPM(),t.getHideDigits(),t.getHideSeconds())];if(e.length>1){var s=document.createElement("div"),u=t.getTitlePopup();s.setAttribute("style","width:100%;height:100%;position:absolute;");s.innerHTML=e[1];r.addEventListener("click",function(){cv.ui.PopupHandler.showPopup("clock",{title:u,content:s})});if(!(r=s.firstElementChild).getAttribute("viewBox")){var a=r.getAttribute("width")||300,c=r.getAttribute("height")||150;r.setAttribute("viewBox","0 0 "+a+" "+c)}r.setAttribute("width","100%");r.setAttribute("height","100%");t.__P_8_1.push(cv.plugins.Clock.getElements(r,t.getHide24hPopup(),t.getHideAMPMPopup(),t.getHideDigitsPopup(),t.getHideSecondsPopup()))}r.setAttribute("style","touch-action: none");var d=r.getElementById("HotSpotHour");d&&d.addEventListener("pointerdown",t);var l=r.getElementById("HotSpotMinute");l&&l.addEventListener("pointerdown",t);var p=r.getElementById("HotSpotSecond");p&&p.addEventListener("pointerdown",t);t.__P_8_0=r;cv.plugins.Clock.prototype._onDomReady.base.call(t)}).catch(function(t){e.error("There has been a problem with the reading of the clock SVG:",t)})},initListeners:function(){},_update:function(t,e,i){var r=(i?e:this.defaultValueHandling(t,e)).split(":");this._updateHands(r[0],r[1],r[2])},handleEvent:function(t){var e=0,i=1,r=2,n=3;switch(t.type){case"pointerdown":switch(t.target.id){case"HotSpotHour":this.__P_8_2=i;break;case"HotSpotMinute":this.__P_8_2=r;break;case"HotSpotSecond":this.__P_8_2=n;break;default:this.__P_8_2=e;return}document.addEventListener("pointermove",this);document.addEventListener("pointerup",this);t.preventDefault();t.stopPropagation();break;case"pointermove":if(this.__P_8_2===e)return;t.preventDefault();t.stopPropagation();if(t.buttons>0){this.dragHelper(t);break}case"pointerup":case"pointercancel":this.dragHelper(t);this.__P_8_2=e;document.removeEventListener("pointermove",this);document.removeEventListener("pointerup",this)}this.getSendOnFinish()&&"pointerup"!==t.type||this.__P_8_3.call()},dragHelper:function(t){var e,i=1,r=2,n=3,o=this.__P_8_0.getScreenCTM(),s=(t.clientX-o.e)/o.a-60,u=60-(t.clientY-o.f)/o.d,a=(180*Math.atan2(s,u)/Math.PI+360)%360,c=this.getValue();switch(this.__P_8_2){case i:var d=c.getHours(),l=d>=12,p=Math.floor(a/30);e=a%30*2;if(d%12>9&&p<3)if(l){l=!1;c.setDate(c.getDate()+1)}else l=!0;else if(p>9&&d%12<3)if(l)l=!1;else{l=!0;c.setDate(c.getDate()-1)}c.setHours(p+12*l);c.setMinutes(e);break;case r:e=this.getHideSeconds()?Math.round(a/6):Math.floor(a/6);var h=c.getMinutes();h>45&&e<15?c.setHours(c.getHours()+1):e>45&&h<15&&c.setHours(c.getHours()-1);c.setMinutes(e);c.setSeconds(a%6*10);break;case n:var g=Math.round(a/6)%60,_=c.getSeconds();_>45&&g<15?c.setMinutes(c.getMinutes()+1):g>45&&_<15&&c.setMinutes(c.getMinutes()-1);c.setSeconds(g)}this.getHideSeconds()&&c.setSeconds(0);this._updateHands(c.getHours(),c.getMinutes(),c.getSeconds())},dragAction:function(){var t=this.getAddress();for(var e in t)!0!==t[e].mode&&cv.TemplateEngine.getInstance().visu.write(e,cv.Transform.encode(t[e].transform,this.getValue()))},_updateHands:function(t,e,i){var r=this;this.__P_8_1.forEach(function(n){null!==n.hour&&n.hour.setAttribute("transform","rotate("+(t%12*360/12+30*e/60+30*i/60/60)+",0,0)");null!==n.minute&&n.minute.setAttribute("transform","rotate("+(6*e+6*i/60)+",0,0)");null!==n.second&&n.second.setAttribute("transform","rotate("+6*i+",0,0)");null!==n.hour24&&n.hour24.setAttribute("transform","rotate("+(t%24*360/24+15*e/60)+",0,0)");null!==n.am&&n.am.setAttribute("display",t<12?"":"none");null!==n.pm&&n.pm.setAttribute("display",t<12?"none":"");null!==n.digits&&(r.getHideSeconds()?n.digits.textContent=sprintf("%02d:%02d",t,e):n.digits.textContent=sprintf("%02d:%02d:%02d",t,e,i))})}},defer:function(t){cv.parser.WidgetParser.addHandler("clock",cv.plugins.Clock);cv.ui.structure.WidgetFactory.registerClass("clock",t)}});cv.plugins.Clock.$$dbClassInfo=t}();qx.$$packageData[4]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-4.js.map