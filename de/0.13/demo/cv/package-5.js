function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,o,a=[],u=!0,c=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(i=s.call(r)).done)&&(a.push(i.value),a.length!==e);u=!0);}catch(t){c=!0,n=t}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){var t={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.pure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.ui.common.Operate":{require:!0},"cv.parser.pure.WidgetParser":{defer:"runtime"},"cv.util.Function":{},"qx.util.ResourceManager":{},"cv.ui.PopupHandler":{},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(t);qx.Class.define("cv.plugins.Clock",{extend:cv.ui.structure.pure.AbstractWidget,include:[cv.ui.common.Update,cv.ui.common.Operate],construct:function(t){t.value=new Date;t.value.setHours(0,0,0,0);this.__P_11_0=[0,0,0];this.__P_11_1=[];cv.ui.structure.pure.AbstractWidget.constructor.call(this,t)},properties:{src:{check:"String"},srcPopup:{check:"String"},titlePopup:{check:"String"},hide24h:{check:"Boolean",init:!1},hide24hPopup:{check:"Boolean",init:!1},hideAMPM:{check:"Boolean",init:!1},hideAMPMPopup:{check:"Boolean",init:!1},hideDigits:{check:"Boolean",init:!1},hideDigitsPopup:{check:"Boolean",init:!1},hideSeconds:{check:"Boolean",init:!1},hideSecondsPopup:{check:"Boolean",init:!1},sendOnFinish:{check:"Boolean",init:!1}},statics:{parse:function(t,e,r,i){var n=cv.parser.pure.WidgetParser.parseElement(this,t,e,r,i,this.getAttributeToPropertyMappings());cv.parser.pure.WidgetParser.parseFormat(t,e);cv.parser.pure.WidgetParser.parseAddress(t,e);return n},getAttributeToPropertyMappings:function(){var t=function(t){return"true"===t};return{src:{default:"plugins/clock/clock_pure.svg"},src_popup:{target:"srcPopup",default:""},title_popup:{target:"titlePopup",default:""},hide_24h:{target:"hide24h",default:!1,transform:t},hide_24h_popup:{target:"hide24hPopup",default:!1,transform:t},hide_am_pm:{target:"hideAMPM",default:!1,transform:t},hide_am_pm_popup:{target:"hideAMPMPopup",default:!1,transform:t},hide_digits:{target:"hideDigits",default:!1,transform:t},hide_digits_popup:{target:"hideDigitsPopup",default:!1,transform:t},hide_seconds:{target:"hideSeconds",default:!1,transform:t},hide_seconds_popup:{target:"hideSecondsPopup",default:!1,transform:t},send_on_finish:{target:"sendOnFinish",default:!1,transform:t}}},getElements:function(t,e,r,i,n){for(var s,o={hour24:t.querySelector("#Hour24"),hour:t.querySelector("#Hour"),minute:t.querySelector("#Minute"),second:t.querySelector("#Second"),am:t.querySelector("#AM"),pm:t.querySelector("#PM"),digits:t.querySelector("#Digits")};null!==o.digits&&null!==(s=o.digits.querySelector("tspan"));)o.digits=s;var a=t.querySelector("#Hour24Group");e&&null!==a&&a.setAttribute("display","none");if(r){if(null!==o.am){o.am.setAttribute("display","none");o.am=null}if(null!==o.pm){o.pm.setAttribute("display","none");o.pm=null}}i&&null!==o.digits&&o.digits.setAttribute("display","none");n&&null!==o.second&&o.second.setAttribute("display","none");return o}},members:{__P_11_2:null,__P_11_1:null,__P_11_3:0,__P_11_0:null,__P_11_4:!1,_getInnerDomString:function(){return'<div class="actor" style="width:100%;height:100%"></div>'},_onDomReady:function(){var t=this;cv.plugins.Clock.superclass.prototype._onDomReady.call(this);this.__P_11_5=cv.util.Function.throttle(this.dragAction,250,{trailing:!0},this);var e=qx.util.ResourceManager.getInstance().toUri(this.getSrc()),r=this.getSrcPopup(),i=[window.fetch(e)];if(""!==r){r=qx.util.ResourceManager.getInstance().toUri(r);i.push(window.fetch(r))}Promise.all(i).then((function(t){var i=[];if(!t[0].ok)throw new Error('Not 2xx response for URI "'+e+'"');i.push(t[0].text());if(""!==r){if(!t[1].ok)throw new Error('Not 2xx response for popup URI "'+r+'"');i.push(t[1].text())}return Promise.all(i)})).then((function(e){var r=t.getActor();r.innerHTML=e[0];var i=r.firstElementChild;if(!i.getAttribute("viewBox")){var n=i.getAttribute("width")||300,s=i.getAttribute("height")||150;i.setAttribute("viewBox","0 0 "+n+" "+s)}i.setAttribute("width","100%");i.setAttribute("height","100%");t.__P_11_1=[cv.plugins.Clock.getElements(i,t.getHide24h(),t.getHideAMPM(),t.getHideDigits(),t.getHideSeconds())];if(e.length>1){var o=document.createElement("div"),a=t.getTitlePopup();o.setAttribute("style","width:100%;height:100%;position:absolute;");o.innerHTML=e[1];i.addEventListener("click",(function(){cv.ui.PopupHandler.showPopup("clock",{title:a,content:o})}));if(!(i=o.firstElementChild).getAttribute("viewBox")){var u=i.getAttribute("width")||300,c=i.getAttribute("height")||150;i.setAttribute("viewBox","0 0 "+u+" "+c)}i.setAttribute("width","100%");i.setAttribute("height","100%");t.__P_11_1.push(cv.plugins.Clock.getElements(i,t.getHide24hPopup(),t.getHideAMPMPopup(),t.getHideDigitsPopup(),t.getHideSecondsPopup()))}i.setAttribute("style","touch-action: none");var _=i.querySelector("#HotSpotHour");_&&_.addEventListener("pointerdown",t);var l=i.querySelector("#HotSpotMinute");l&&l.addEventListener("pointerdown",t);var d=i.querySelector("#HotSpotSecond");d&&d.addEventListener("pointerdown",t);t.__P_11_2=i;t._updateHands()})).catch((function(e){t.error("There has been a problem with the reading of the clock SVG:",e)}))},initListeners:function(){},_update:function(t,e,r){var i=r?e:this.applyTransform(t,e);if(i instanceof Date){this.__P_11_4=!1;this.__P_11_0=[i.getHours(),i.getMinutes(),i.getSeconds()];this.setValue(i)}else{this.__P_11_4=!0;this.__P_11_0="string"==typeof i?i.split(":"):[0,0,0];this.__P_11_0[0]=this.__P_11_0[0]>=0&&this.__P_11_0[0]<=23?this.__P_11_0[0]:0;this.__P_11_0[1]=this.__P_11_0[1]>=0&&this.__P_11_0[1]<=59?this.__P_11_0[1]:0;this.__P_11_0[2]=this.__P_11_0[2]>=0&&this.__P_11_0[2]<=59?this.__P_11_0[2]:0;var n=new Date;n.setHours(this.__P_11_0[0],this.__P_11_0[1],this.__P_11_0[2],0);this.setValue(n)}this._updateHands()},handleEvent:function(t){var e=0,r=1,i=2,n=3;switch(t.type){case"pointerdown":switch(t.target.id){case"HotSpotHour":this.__P_11_3=r;break;case"HotSpotMinute":this.__P_11_3=i;break;case"HotSpotSecond":this.__P_11_3=n;break;default:this.__P_11_3=e;return}document.addEventListener("pointermove",this);document.addEventListener("pointerup",this);t.preventDefault();t.stopPropagation();break;case"pointermove":if(this.__P_11_3===e)return;t.preventDefault();t.stopPropagation();if(t.buttons>0){this.dragHelper(t);break}case"pointerup":case"pointercancel":this.dragHelper(t);this.__P_11_3=e;document.removeEventListener("pointermove",this);document.removeEventListener("pointerup",this)}this.getSendOnFinish()&&"pointerup"!==t.type||this.__P_11_5.call()},dragHelper:function(t){var e,r=1,i=2,n=3,s=this.__P_11_2.getScreenCTM(),o=(t.clientX-s.e)/s.a-60,a=60-(t.clientY-s.f)/s.d,u=(180*Math.atan2(o,a)/Math.PI+360)%360,c=this.getValue();switch(this.__P_11_3){case r:var _=c.getHours(),l=_>=12,d=Math.floor(u/30);e=u%30*2;if(_%12>9&&d<3)if(l){l=!1;c.setDate(c.getDate()+1)}else l=!0;else if(d>9&&_%12<3)if(l)l=!1;else{l=!0;c.setDate(c.getDate()-1)}c.setHours(d+12*l);c.setMinutes(e);break;case i:e=this.getHideSeconds()?Math.round(u/6):Math.floor(u/6);var p=c.getMinutes();p>45&&e<15?c.setHours(c.getHours()+1):e>45&&p<15&&c.setHours(c.getHours()-1);c.setMinutes(e);c.setSeconds(u%6*10);break;case n:var h=Math.round(u/6)%60,g=c.getSeconds();g>45&&h<15?c.setMinutes(c.getMinutes()+1):h>45&&g<15&&c.setMinutes(c.getMinutes()-1);c.setSeconds(h)}this.getHideSeconds()&&c.setSeconds(0);this.__P_11_0=[c.getHours(),c.getMinutes(),c.getSeconds()];this._updateHands()},dragAction:function(){var t=this.__P_11_4?this.getValue().toTimeString().split(" ")[0]:this.getValue();this.__P_11_6=this.sendToBackend(t,!1,this.__P_11_6)},_updateHands:function(){var t=this,e=_slicedToArray(this.__P_11_0,3),r=e[0],i=e[1],n=e[2];Array.isArray(this.__P_11_1)&&this.__P_11_1.forEach((function(e){null!==e.hour&&e.hour.setAttribute("transform","rotate("+(r%12*360/12+30*i/60+30*n/60/60)+",0,0)");null!==e.minute&&e.minute.setAttribute("transform","rotate("+(6*i+6*n/60)+",0,0)");null!==e.second&&e.second.setAttribute("transform","rotate("+6*n+",0,0)");null!==e.hour24&&e.hour24.setAttribute("transform","rotate("+(r%24*360/24+15*i/60)+",0,0)");null!==e.am&&e.am.setAttribute("display",r<12?"":"none");null!==e.pm&&e.pm.setAttribute("display",r<12?"none":"");null!==e.digits&&(t.getHideSeconds()?e.digits.textContent=sprintf("%02d:%02d",r,i):e.digits.textContent=sprintf("%02d:%02d:%02d",r,i,n))}))}},defer:function(t){cv.parser.pure.WidgetParser.addHandler("clock",cv.plugins.Clock);cv.ui.structure.WidgetFactory.registerClass("clock",t)}});cv.plugins.Clock.$$dbClassInfo=t}();qx.$$packageData[5]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-5.js.map