!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.AbstractWidget":{construct:!0,require:!0},"cv.ui.common.Update":{require:!0},"cv.parser.WidgetParser":{defer:"runtime"},"cv.ui.layout.ResizeHandler":{},"cv.Transform":{},"cv.util.ScriptLoader":{defer:"runtime"},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.PowerSpectrum",{extend:cv.ui.structure.AbstractWidget,include:[cv.ui.common.Update],construct:function(e){e.name1||(e.name1=!0===e.singlePhase?"L":"L1");e.name2||(e.name2="L2");e.name3||(e.name3="L3");cv.ui.structure.AbstractWidget.constructor.call(this,e);this.setSpectrum(this.isSinglePhase()?[this.setupSpectrum()]:[this.setupSpectrum(-.26),this.setupSpectrum(0),this.setupSpectrum(.26)]);this.setCurve(this.isSinglePhase()?[this.setupCurve()]:[this.setupCurve(),this.setupCurve(),this.setupCurve()])},statics:{CURRENT:0,VOLTAGE:1,limitEN50160_1999:[[2,.02],[3,.05],[4,.01],[5,.06],[6,.005],[7,.05],[8,.005],[9,.015],[10,.005],[11,.035],[12,.005],[13,.03],[14,.005],[15,.005],[16,.005],[17,.02],[18,.005],[19,.015],[20,.005],[21,.005],[22,.005],[23,.015],[24,.005],[25,.015]],limitEN61000_3_2:[[2,1.62],[3,3.45],[4,.65],[5,1.71],[6,.45],[7,1.16],[8,.35],[9,.6],[10,.28],[11,.5],[12,.233],[13,.32],[14,.2],[15,.23],[16,.175],[17,.203],[18,.155],[19,.182],[20,.14],[21,.164],[22,.127],[23,.15],[24,.117],[25,.139]],referenceSin:[[],[],[]],fixLimits:function(e,t,i){i[t][0]-=.5},lastShifted:function(e){var t=e[e.length-1];return[t[0]+1,t[1]]},parse:function(e,t,i,r){var s=cv.parser.WidgetParser.parseElement(this,e,t,i,r,this.getAttributeToPropertyMappings());cv.parser.WidgetParser.parseFormat(e,t);cv.parser.WidgetParser.parseAddress(e,t,this.makeAddressListFn);return s},getAttributeToPropertyMappings:function(){return{type:{target:"displayType",transform:function(e){return"current"===e?cv.plugins.PowerSpectrum.CURRENT:cv.plugins.PowerSpectrum.VOLTAGE}},singlephase:{target:"singlePhase",transform:function(e){return"true"===e}},limitname:{target:"limitName",default:"limit"},name1:{},name2:{},name3:{},spectrumonly:{target:"showCurve",transform:function(e){return"true"!==e}},showlegend:{target:"showLegend",transform:function(e){return"true"===e}},limitcolor:{target:"limitColor",default:"#edc240"},color1:{default:"#afd8f8"},color2:{default:"#cb4b4b"},color3:{default:"#4da74d"}}},makeAddressListFn:function(e,t,i,r){r||(r="spectrum");return[!0,r]}},properties:{displayType:{check:[0,1],init:1},singlePhase:{check:"Boolean",init:!1},spectrum:{check:"Array",init:[]},limitName:{check:"String",init:"limit"},name1:{check:"String",init:"L1"},name2:{check:"String",init:"L2"},name3:{check:"String",init:"L3"},curve:{check:"Array",init:[]},showCurve:{check:"Boolean",init:!1},showLegend:{check:"Boolean",init:!1},current:{check:"Array",init:[]},limitColor:{check:"Color",init:"#edc240"},color1:{check:"Color",init:"#afd8f8"},color2:{check:"Color",init:"#cb4b4b"},color3:{check:"Color",init:"#4da74d"}},members:{__P_12_0:null,__P_12_1:null,_getInnerDomString:function(){var e='<div class="actor clickable">';this.isShowCurve()&&(e+='<div class="diagram_inline curve">loading...</div>');return e+='<div class="diagram_inline spectrum">loading...</div></div>'},_onDomReady:function(){cv.plugins.PowerSpectrum.prototype._onDomReady.base.call(this);var e=[this.getLimitColor(),this.getColor1(),this.getColor2(),this.getColor3()],t=this.isShowCurve()&&$("#"+this.getPath()+" .actor div.curve").empty(),i=this.isShowCurve()&&{colors:e,legend:{show:this.isShowLegend()},xaxis:{show:!1},yaxis:{show:!1}},r=$("#"+this.getPath()+" .actor div.spectrum").empty(),s={colors:e,series:{bars:{show:!0,fill:1,fillColor:null,lineWidth:0}},bars:{align:"center",barWidth:this.isSinglePhase()?.75:.25},legend:{show:this.isShowLegend()},xaxis:{show:!1},yaxis:{show:!1}},a=function(){this.__P_12_1=this.isShowCurve()&&$.plot(t,this.createDatasetCurve(),i);this.__P_12_0=$.plot(r,this.createDatasetSpectrum(),s)}.bind(this);cv.ui.layout.ResizeHandler.states.isPageSizeInvalid()?cv.ui.layout.ResizeHandler.states.addListenerOnce("changePageSizeInvalid",a):a()},_update:function(e,t){if(void 0!==e){var i,r=this.getAddress()[e];if("I"===r.variantInfo[0]){i=this.isSinglePhase()?1:+(r.variantInfo[1]||1);var s=cv.Transform.encode(r,t);this.getCurrent()[i-1]=s/1e3}else if("spectrum"===r.variantInfo.substr(0,8)&&28===t.length){i=this.isSinglePhase()?1:+(r.variantInfo[8]||1);for(var a=parseInt(t.substr(0,2),16),n=this.getCurrent()[i-1]||1,c=[],o=0;o<13;o++)if(!(a+o<2)){c[o]=Math.pow(10,(parseInt(t.substr(2*o+2,2),16)-253)/80);this.getSpectrum()[i-1][a+o-2][1]=c[o]*n}this.__P_12_0.setData(this.createDatasetSpectrum());this.__P_12_0.draw();if(this.__P_12_1){this.updateCurve(this.getSpectrum(),this.getCurve(),i-1);this.__P_12_1.setData(this.createDatasetCurve());this.__P_12_1.draw()}}}},setupCurve:function(){return[[0,0],[.4,0],[.8,0],[1.2,0],[1.6,0],[2,0],[2.4,0],[2.8,0],[3.2,0],[3.6,0],[4,0],[4.4,0],[4.8,0],[5.2,0],[5.6,0],[6,0],[6.4,0],[6.8,0],[7.2,0],[7.6,0],[8,0],[8.4,0],[8.8,0],[9.2,0],[9.6,0],[10,0],[10.4,0],[10.8,0],[11.2,0],[11.6,0],[12,0],[12.4,0],[12.8,0],[13.2,0],[13.6,0],[14,0],[14.4,0],[14.8,0],[15.2,0],[15.6,0],[16,0],[16.4,0],[16.8,0],[17.2,0],[17.6,0],[18,0],[18.4,0],[18.8,0],[19.2,0],[19.6,0]]},setupSpectrum:function(e){var t=[];void 0===e&&(e=0);for(var i=2;i<52;i++)t.push([i+e,0]);return t},updateCurve:function(e,t,i){for(var r=e[i],s=t[i],a=(2*i/3-.5)*Math.PI,n=0;n<50;n++){for(var c=n*Math.PI/25,o=Math.cos(c+a),u=2;u<50;u++)o+=Math.cos((c+a)*u)*r[u][1];s[n][1]=o}},createDatasetCurve:function(){return this.isSinglePhase()?[{label:null,data:cv.plugins.PowerSpectrum.referenceSin[0],color:13},{label:"L",data:this.getCurve()[0],color:1}]:[{label:null,data:cv.plugins.PowerSpectrum.referenceSin[0],color:13},{label:null,data:cv.plugins.PowerSpectrum.referenceSin[1],color:14},{label:null,data:cv.plugins.PowerSpectrum.referenceSin[2],color:15},{label:"L1",data:this.getCurve()[0],color:1},{label:"L2",data:this.getCurve()[1],color:2},{label:"L3",data:this.getCurve()[2],color:3}]},createDatasetSpectrum:function(){return this.isSinglePhase()?[{label:this.getLimitName(),data:this.getDisplayType()===cv.plugins.PowerSpectrum.VOLTAGE?cv.plugins.PowerSpectrum.limitEN50160_1999:cv.plugins.PowerSpectrum.limitEN61000_3_2,bars:{show:!1},lines:{steps:!0},color:0},{label:this.getName1(),data:this.getSpectrum()[0],color:1}]:[{label:this.getLimitName(),data:this.getDisplayType()===cv.plugins.PowerSpectrum.VOLTAGE?cv.plugins.PowerSpectrum.limitEN50160_1999:cv.plugins.PowerSpectrum.limitEN61000_3_2,bars:{show:!1},lines:{steps:!0},color:0},{label:this.getName1(),data:this.getSpectrum()[0],color:1},{label:this.getName2(),data:this.getSpectrum()[1],color:2},{label:this.getName3(),data:this.getSpectrum()[2],color:3}]}},defer:function(e){cv.util.ScriptLoader.getInstance().addScripts(["plugins/diagram/dep/flot/jquery.flot.min.js","plugins/diagram/dep/flot/jquery.flot.canvas.min.js","plugins/diagram/dep/flot/jquery.flot.resize.min.js","plugins/diagram/dep/flot/jquery.flot.navigate.min.js"]);cv.parser.WidgetParser.addHandler("powerspectrum",cv.plugins.PowerSpectrum);cv.ui.structure.WidgetFactory.registerClass("powerspectrum",e);e.limitEN50160_1999.forEach(e.fixLimits);e.limitEN50160_1999.push(e.lastShifted(e.limitEN50160_1999));e.limitEN61000_3_2.forEach(e.fixLimits);e.limitEN61000_3_2.push(e.lastShifted(e.limitEN61000_3_2));for(var t=0;t<50;t++){var i=20*t/50;e.referenceSin[0].push([i,Math.sin(t*Math.PI/25)]);e.referenceSin[1].push([i,Math.sin((t+16.666666666666668)*Math.PI/25)]);e.referenceSin[2].push([i,Math.sin((t+33.333333333333336)*Math.PI/25)])}}});cv.plugins.PowerSpectrum.$$dbClassInfo=e}();qx.$$packageData[8]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-8.js.map