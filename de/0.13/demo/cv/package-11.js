!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.structure.pure.AbstractWidget":{require:!0},"cv.ui.common.Refresh":{require:!0},"cv.parser.pure.WidgetParser":{defer:"runtime"},"qx.event.Timer":{},"cv.util.ScriptLoader":{defer:"runtime"},"cv.ui.structure.WidgetFactory":{defer:"runtime"}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.plugins.Rss",{extend:cv.ui.structure.pure.AbstractWidget,include:[cv.ui.common.Refresh],statics:{parse:function(e,t,r,i){var s=cv.parser.pure.WidgetParser.parseElement(this,e,t,r,i,this.getAttributeToPropertyMappings());cv.parser.pure.WidgetParser.parseRefresh(e,t);return s},getAttributeToPropertyMappings:function(){return{src:{},width:{default:""},height:{default:""},limit:{default:10},header:{default:!0},date:{default:!0},content:{default:!0},snippet:{default:!0},showerror:{default:!0},ssl:{default:!1},linktarget:{default:"_new"},link:{default:!0},title:{default:!0}}}},properties:{src:{check:"String",init:""},width:{init:""},height:{init:""},limit:{init:10},header:{init:!0},date:{init:!0},content:{init:!0},snippet:{init:!0},showerror:{init:!0},ssl:{init:!1},linktarget:{init:"_new"},link:{init:!0},title:{init:!0}},members:{_parser:null,_getInnerDomString:function(){return'<div class="actor"><ul class="rss_inline" style="'+(""+this.getWidth()?"width:"+this.getWidth():""+this.getHeight()?"height:"+this.getHeight():"")+'"></ul>'},_onDomReady:function(){cv.plugins.Rss.superclass.prototype._onDomReady.call(this);this._parser=new RSSParser;this.refreshRSS()},_setupRefreshAction:function(){var e=this;this._timer=new qx.event.Timer(this.getRefresh());this._timer.addListener("interval",(function(){e.refreshRSS()}));this._timer.start()},refreshRSS:function(){var e=this;this._parser.parseURL(this.getSrc(),(function(t,r){var i=e.getActor(),s=i.querySelector(".rss_inline");if(t){e.error(t);e.getShowerror()&&(s.textContent="ERROR: "+t)}else{if(e.getHeader()){var n=i.querySelector(":scope > h3");if(!n){n=document.createElement("h3");i.insertBefore(n,i.firstElementChild)}n.textContent=r.title}for(var a=s.querySelectorAll(":scope > li"),c=a.length;c>=r.items.length;c--)a[c].remove();var l=e.getLink(),u=e.getContent(),o=e.getDate();r.items.some((function(t,r){var i,n,a,c=s.querySelector(':scope > li[data-row="'+r+'"]');if(c){l&&(i=c.querySelector(":scope > a"));u&&(n=c.querySelector(":scope > p.content"));o&&(a=c.querySelector(":scope > p.date"))}else{c=document.createElement("li");if(l){(i=document.createElement("a")).setAttribute("target",e.getLinktarget());c.appendChild(i)}if(u){(n=document.createElement("p")).classList.add("content");c.appendChild(n)}if(o){(a=document.createElement("p")).classList.add("date");c.appendChild(a)}c.setAttribute("data-row",""+r);s.appendChild(c)}if(l){i.textContent=t.title;i.setAttribute("href",t.link)}else c.textContent=t.title;u&&(n.innerHTML=e.getSnippet()?t.contentSnippet:t.content);o&&(a.innerText=new Date(t.isoDate).toLocaleString());return r>=e.getLimit()}))}}))}},destruct:function(){this._parser=null},defer:function(e){cv.util.ScriptLoader.getInstance().addScripts("plugins/rss/rss-parser.min.js");cv.parser.pure.WidgetParser.addHandler("rss",cv.plugins.Rss);cv.ui.structure.WidgetFactory.registerClass("rss",e)}});cv.plugins.Rss.$$dbClassInfo=e}();qx.$$packageData[11]={locales:{},resources:{},translations:{}};
//# sourceMappingURL=package-11.js.map