!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.tree.FileSystem":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.container.Composite":{},"qx.ui.basic.Atom":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.upload.MDragUpload",{construct:function(){var e=this;this.setDroppable(!0);this.getBounds()?this._applyStartDragListeners():this.addListenerOnce("appear",(function(){e._applyStartDragListeners()}));var t=this._getLayout();t instanceof qx.ui.layout.Grow||t instanceof qx.ui.layout.Canvas||this.addListener("resize",this.__P_54_0,this)},properties:{uploadMode:{check:"Boolean",init:!1,apply:"__P_54_1"},uploadHint:{check:"String",init:""}},statics:{onHtml5Drop:function(e){e.preventDefault();this.getFiles(e).forEach(this.uploadFile,this)},uploadFile:function(e,t){var n;cv.ui.manager.model.FileItem.isConfigFile(e.name)?n=new cv.ui.manager.model.FileItem("."):cv.ui.manager.tree.FileSystem.isAccepted(e.type)&&(n=new cv.ui.manager.model.FileItem("media"));if(n){n.set({type:"dir"});var i=new cv.ui.manager.upload.UploadMgr;if(t)i.replaceFile(e,t);else{i.setFolder(n);i.uploadFile(e)}}},hasDroppableFile:function(e){return this.getFiles(e).length>0},getFiles:function(e){var t,n,i,r=[];if(e.dataTransfer.items)for(t=0,n=e.dataTransfer.items.length;t<n;t++){var a=e.dataTransfer.items[t];if("file"===a.kind&&cv.ui.manager.tree.FileSystem.isAccepted(a.type)){i=a.getAsFile();r.push(i)}}else for(t=0,n=e.dataTransfer.files.length;t<n;t++){i=e.dataTransfer.files[t];cv.ui.manager.tree.FileSystem.isAccepted(i.type)&&r.push(i)}return r}},members:{__P_54_2:null,_boundOnStop:null,__P_54_0:function(){var e=this.getBounds();this.getChildControl("upload-overlay").setUserBounds(e.left,e.top,e.width,e.height);this.getChildControl("upload-dropbox").setUserBounds(e.left,e.top,e.width,e.height)},_createMDragUploadChildControlImpl:function(e){var t,n=this.getBounds(),i=this._getLayout();switch(e){case"upload-overlay":(t=new qx.ui.container.Composite).setZIndex(1e6);t.exclude();i instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!n||t.setUserBounds(n.left,n.top,n.width,n.height);this._add(t);this.getChildControl("upload-dropbox").bind("visibility",t,"visibility");break;case"upload-dropbox":(t=new qx.ui.container.Composite(new qx.ui.layout.Grow)).setBackgroundColor("rgba(32, 32, 32, 0.9)");t.setZIndex(1e3);var r=new qx.ui.basic.Atom(this.getUploadHint(),cv.theme.dark.Images.getIcon("upload",32));r.set({iconPosition:"top",rich:!0,center:!0});r.getChildControl("label").setWrap(!0);t.setAnonymous(!0);t.add(r);t.exclude();i instanceof qx.ui.layout.Canvas?this._add(t,{edge:0}):this._getLayout()instanceof qx.ui.layout.Grow||!n||t.setUserBounds(n.left,n.top,n.width,n.height);this._add(t)}return t},_onStopDragging:function(e){e.preventDefault();this.setUploadMode(!1);document.removeEventListener("dragend",this._boundOnStop,!1)},_applyStartDragListeners:function(){var e=this;this.getContentElement().getDomElement().addEventListener("dragenter",function(e){this._isDroppable?this._isDroppable(e.dataTransfer.items)&&this.setUploadMode(!0):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&this.setUploadMode(!0)}.bind(this),!1);this.getChildControl("upload-overlay").getBounds()?this._applyDragListeners():this.getChildControl("upload-overlay").addListenerOnce("appear",(function(){e._applyDragListeners()}))},_applyDragListeners:function(){var e=this,t=this.getChildControl("upload-overlay").getContentElement().getDomElement();if(t){t.addEventListener("dragexit",function(){this.setUploadMode(!1)}.bind(this),!1);t.addEventListener("dragover",function(e){e.preventDefault();var t=!1;this._isDroppable?t=this._isDroppable(e.dataTransfer.items):cv.ui.manager.upload.MDragUpload.hasDroppableFile(e)&&(t=!0);this.setUploadMode(t)}.bind(this),!1);this._boundOnStop=this._onStopDragging.bind(this);t.addEventListener("dragleave",this._boundOnStop,!1);t.addEventListener("dragend",function(){this.setUploadMode(!1)}.bind(this),!1);document.addEventListener("dragend",this._boundOnStop,!1);this._onDrop?t.addEventListener("drop",this._onDrop.bind(this),!1):t.addEventListener("drop",function(e){cv.ui.manager.upload.MDragUpload.onHtml5Drop(e);this._onStopDragging(e)}.bind(this),!1)}else var n=this.getChildControl("upload-overlay").addListener("visibility",(function(t){if("visible"===t.getData()){e._applyDragListeners();e.getChildControl("upload-overlay").removeListenerById(n)}}))},__P_54_1:function(e){if(!0===e){this.getChildControl("upload-dropbox").show();if(this.hasChildControl("empty-info")&&this.getChildControl("empty-info").isVisible()){this.getChildControl("empty-info").exclude();this.__P_54_2=!0}else this.__P_54_2=!1}else{this.getChildControl("upload-dropbox").exclude();!0===this.__P_54_2&&this.getChildControl("empty-info").show()}}}});cv.ui.manager.upload.MDragUpload.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.Timer":{},"cv.ui.manager.tree.VirtualFsItem":{},"qx.ui.tree.VirtualTree":{},"cv.ui.manager.model.Preferences":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.FileSystem",{extend:qx.ui.core.Widget,include:[cv.ui.manager.upload.MDragUpload],construct:function(e){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this.setRootFolder(e);qx.event.message.Bus.subscribe("cv.manager.tree.enable",this._onEnableTree,this)},statics:{MIMETYPES:{"text/xml":"xml","application/xml":"xml","text/javascript":"js","application/x-httpd-php":"php","text/css":"css","image/png":"png","image/svg+xml":"svg","text/plain":""},getMimetypeFromSuffix:function(e){return Object.keys(this.MIMETYPES).find((function(t){return this.MIMETYPES[t]===e}),this)},isAccepted:function(e){return Object.prototype.hasOwnProperty.call(this.MIMETYPES,e)}},events:{changeSelection:"qx.event.type.Data"},properties:{appearance:{refine:!0,init:"cv-filesystem"},rootFolder:{check:"cv.ui.manager.model.FileItem",apply:"_applyRootFolder"},selectedNode:{check:"cv.ui.manager.model.FileItem",apply:"_applySelectedNode",nullable:!0}},members:{__P_51_0:null,__P_51_1:500,__P_51_2:!1,_replacementManager:null,reload:function(){var e=this.getChildControl("tree"),t=e.getOpenNodes().map((function(e){return e.getFullPath()})),n=e.getModel();n.reload((function(){this.getChildControl("tree").refresh();n.setOpen(!0);t.forEach(this.openPath,this)}),this)},openPath:function(e){var t=this.getChildControl("tree").getModel();if("."===e)t.setOpen(!0);else{t.setOpen(!0);t.openPath(e)}},refresh:function(){this.getChildControl("tree").refresh()},_applyRootFolder:function(e){if(e){var t=this.getChildControl("tree");t.setModel(e);e.load((function(){t.setHideRoot(!0)}),this)}},_applySelectedNode:function(e){var t=this.getChildControl("tree"),n=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();n.configure(e);e&&t.setContextMenu(n)},setSelection:function(e){this.getChildControl("tree").getSelection().replace([e])},_onDblTapTreeSelection:function(){var e=this.getSelectedNode();if(e){this.__P_51_0&&this.__P_51_0.stop();"file"===e.getType()&&this.fireDataEvent("changeSelection",{node:e,mode:"dbltap"})}},_onChangeTreeSelection:function(){this.__P_51_0&&this.__P_51_0.stop();if(!0!==this.__P_51_2){var e=this.getChildControl("tree"),t=e.getSelection();if(t.length>0){var n=t.getItem(0);this.setSelectedNode(n);"file"===n.getType()?this.__P_51_0=qx.event.Timer.once((function(){this.fireDataEvent("changeSelection",{node:this.getSelectedNode(),mode:"tap"});this.__P_51_0=null}),this,this.__P_51_1):this.fireDataEvent("changeSelection",{node:n,mode:"tap"})}else{e.resetContextMenu();this.resetSelectedNode()}}},_onFsItemRightClick:function(e){var t=this.getChildControl("tree"),n=e.getTarget();if(n instanceof cv.ui.manager.tree.VirtualFsItem){var i=n.getModel();if(i){this.__P_51_2=!0;t.getSelection().replace([i]);this.setSelectedNode(i);this.fireDataEvent("changeSelection",{node:i,mode:"contextmenu"});this.__P_51_2=!1}}},_onEnableTree:function(e){this.getChildControl("tree").setEnabled(e.getData())},_createChildControlImpl:function(e){var t;if("tree"===e){(t=new qx.ui.tree.VirtualTree(null,"name","children")).set({selectionMode:"single",minWidth:250,showTopLevelOpenCloseIcons:!0});cv.ui.manager.model.Preferences.getInstance().bind("quickPreview",t,"openMode",{converter:function(e){return e?"tap":"dbltap"}});t.setDelegate({createItem:function(){var e=new cv.ui.manager.tree.VirtualFsItem;e.addListener("dbltap",this._onDblTapTreeSelection,this);e.addListener("contextmenu",this._onFsItemRightClick,this);return e}.bind(this),bindItem:function(e,t,n){e.bindProperty("","model",null,t,n);e.bindPropertyReverse("open","open",null,t,n);e.bindProperty("open","open",null,t,n);e.bindProperty("readable","enabled",null,t,n);e.bindProperty("icon","icon",null,t,n);e.bindProperty("editing","editing",null,t,n)}});t.getSelection().addListener("change",this._onChangeTreeSelection,this);this._add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.tree.FileSystem.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.tree.enable",this._onEnableTree,this);this._disposeObjects("_dateFormat","_timeFormat","_replacementManager")}});cv.ui.manager.tree.FileSystem.$$dbClassInfo=e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.data.Array":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.data.controller.List":{construct:!0},"cv.ui.manager.model.Message":{},"cv.ui.manager.snackbar.Message":{},"qx.ui.form.List":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Controller",{extend:qx.ui.core.Widget,type:"singleton",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox(8));this.initMessages(new qx.data.Array);qx.event.message.Bus.subscribe("cv.manager.msg.snackbar",this._onMessage,this);this._listController=new qx.data.controller.List(this.getMessages(),this.getChildControl("list"));this._initDelegate()},statics:{info:function(e){var t=new cv.ui.manager.model.Message;t.set({title:e});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)},error:function(e){var t=new cv.ui.manager.model.Message;"object"===_typeof(e)&&Object.prototype.hasOwnProperty.call(e,"statusText")&&(e=e.statusText);t.set({title:e,type:"error",sticky:!0});qx.event.message.Bus.dispatchByName("cv.manager.msg.snackbar",t)}},properties:{appearance:{refine:!0,init:"cv-snackbar"},messages:{check:"qx.data.Array",deferredInit:!0,event:"changeMessages"}},members:{_listController:null,_onMessage:function(e){var t=e.getData();if(t instanceof cv.ui.manager.model.Message){this.getMessages().push(t);this.show()}},_onCloseMessage:function(e){var t=e.getData();this.getMessages().remove(t);0===this.getMessages().length&&this.exclude()},_initDelegate:function(){this._listController.setDelegate({createItem:function(){var e=new cv.ui.manager.snackbar.Message;e.addListener("close",this._onCloseMessage,this);return e}.bind(this),bindItem:function(e,t,n){e.bindProperty("","model",null,t,n)}})},_createChildControlImpl:function(e){var t;if("list"===e){t=new qx.ui.form.List;this._add(t,{flex:1})}return t||cv.ui.manager.snackbar.Controller.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.msg.snackbar",this._onMessage,this);this._disposeObjects("_listController")}});cv.ui.manager.snackbar.Controller.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.control.MFileEventHandler",{construct:function(){this._disableFileEvents||qx.event.message.Bus.subscribe("cv.manager.file",this._handleFileEvent,this)},members:{_disableFileEvents:!1},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.file",this._handleFileEvent,this)}});cv.ui.manager.control.MFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.control.IFileEventHandler",{members:{_handleFileEvent:function(e){}}});cv.ui.manager.control.IFileEventHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",usage:"dynamic",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.marshal.MEventBubbling":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"qx.data.Array":{construct:!0},"qx.locale.Manager":{construct:!0},"cv.theme.dark.Images":{},"cv.ui.manager.snackbar.Controller":{},"cv.io.rest.Client":{},"qx.util.LibraryManager":{},"qx.lang.Type":{}},environment:{provided:[],required:{"qx.dynlocale":{load:!0}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.FileItem",{extend:qx.core.Object,include:[qx.data.marshal.MEventBubbling,cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.control.IFileEventHandler],construct:function(e,t,n,i){qx.core.Object.constructor.call(this);this.initChildren(new qx.data.Array);i&&this.setFakeChildren(i);if(t){t.endsWith("/")||(t+="/");this.__P_43_0=t}e&&this.setName(e);n&&this.setParent(n);qx.locale.Manager.getInstance().addListener("changeLocale",this._onChangeLocale,this)},statics:{ROOT:null,_fakeIconFile:null,_hiddenConfigFakeFile:null,_acceptedFiles:{".":"*.xml",media:"*.js,*.jpg,*.gif,*.png,*.conf,*.svg,*.md,*.rst,*,css,*.txt"},isConfigFile:function(e){return/visu_config.*\.xml/.test(e)},getConfigName:function(e){var t=/visu_config_?([^.]+)\.xml/.exec(e);return t?t[1]:null},getIconFile:function(){this._fakeIconFile||(this._fakeIconFile=new cv.ui.manager.model.FileItem("CometVisu-Icons","",cv.ui.manager.model.FileItem.ROOT).set({type:"file",overrideIcon:!0,writeable:!1,readable:!0,open:!0,loaded:!0,hasChildren:!1,fake:!0,icon:cv.theme.dark.Images.getIcon("icons",18)}));return this._fakeIconFile},getHiddenConfigFile:function(){this._hiddenConfigFakeFile||(this._hiddenConfigFakeFile=new cv.ui.manager.model.FileItem("hidden.php","",cv.ui.manager.model.FileItem.ROOT).set({hasChildren:!1,loaded:!0,readable:!0,writeable:!0,overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),type:"file",fake:!0,displayName:qx.locale.Manager.tr("Hidden configuration")}));return this._hiddenConfigFakeFile},getAcceptedFiles:function(e){return this._acceptedFiles[e.getFullPath()]}},properties:{open:{check:"Boolean",event:"changeOpen",apply:"_onOpen",init:!1},loaded:{check:"Boolean",event:"changeLoaded",init:!1},loading:{check:"Boolean",event:"changeLoading",init:!1},parent:{event:"changeParent",init:null},children:{check:"qx.data.Array",event:"changeChildren",apply:"_applyEventPropagation",deferredInit:!0},fakeChildren:{check:"Array",nullable:!0},displayName:{check:"String",init:"",event:"changeDisplayName"},fake:{check:"Boolean",init:!1,event:"changeFake"},overrideIcon:{check:"Boolean",init:!1},icon:{check:"String",nullable:!0,event:"changeIcon"},hash:{check:"Number",nullable:!0},editing:{check:"Boolean",init:!1,event:"changeEditing"},special:{check:"String",nullable:!0,event:"changeSpecial"},temporary:{check:"Boolean",init:!1,event:"changeTemporary"},valid:{check:"Boolean",init:!0,event:"changeValid"},hasWarnings:{check:"Boolean",init:!1,event:"changeHasWarnings"},content:{check:"String",nullable:!0},modified:{check:"Boolean",init:!1,event:"changeModified"},hasChildren:{check:"Boolean",event:"changeHasChildren",apply:"_applyHasChildren",init:!1},name:{check:"String",event:"changeName",init:"",apply:"_applyName"},type:{check:["dir","file"],transform:"_toLowerCase",nullable:!0,apply:"_maintainIcon"},parentFolder:{check:"String",nullable:!0},readable:{check:"Boolean",init:!1,event:"changeReadable"},writeable:{check:"Boolean",init:!1,event:"changeWriteable"},mounted:{check:"Boolean",init:!1,event:"changeMounted"},trash:{check:"Boolean",init:!1,event:"changeTrash"},inTrash:{check:"Boolean",init:!1,event:"changeInTrash"}},members:{__P_43_0:null,__P_43_1:null,__P_43_2:null,_toLowerCase:function(e){return e.toLowerCase()},isRelated:function(e){return this.getFullPath()===e},_handleFileEvent:function(e){if(!this.isFake()){var t=e.getData();switch(t.action){case"moved":this.reload();break;case"added":"dir"===this.getType()&&t.path.startsWith(this.getFullPath())&&this.reload();break;case"deleted":if(t.path===this.getFullPath())this.dispose();else if("dir"===this.getType()&&t.path.startsWith(this.getFullPath())){var n=this.getChildren();n.some((function(e){if(e.getFullPath()===t.path){n.remove(e);this.removeRelatedBindings(e);return!0}return!1}),this)}}}},_applyName:function(e,t){this.__P_43_1=null;!e||null!==this.getDisplayName()&&this.getDisplayName()!==t||this.setDisplayName(e)},getPath:function(){if(!this.__P_43_0){var e=this.getParentFolder();e?e.endsWith("/")||(e+="/"):e="";this.__P_43_0=e}return this.__P_43_0},_onOpen:function(e){!this.isLoaded()&&e&&this.load();this._maintainIcon()},_maintainIcon:function(){this.isOverrideIcon()||("file"===this.getType()?this.setIcon(cv.theme.dark.Images.getIcon("file",18)):this.isTrash()?this.setIcon(cv.theme.dark.Images.getIcon("trash",18)):this.isOpen()?this.setIcon(cv.theme.dark.Images.getIcon("folder-open",18)):this.isMounted()?this.setIcon(cv.theme.dark.Images.getIcon("mounted-folder",18)):this.setIcon(cv.theme.dark.Images.getIcon("folder",18)))},isConfigFile:function(){return cv.ui.manager.model.FileItem.isConfigFile(this.getName())},_applyHasChildren:function(e){!0===e&&0===this.getChildren().length&&this.getChildren().push(new cv.ui.manager.model.FileItem(""))},unload:function(){this.setLoaded(!1);this.setLoading(!1);this.getChildren().removeAll().forEach((function(e){this.removeRelatedBindings(e)}),this)},reload:function(e,t){this.unload();return this.load(e,t)},addChild:function(e){var t=e.getParent();if(t!==this){t.getChildren().remove(e);t.removeRelatedBindings(e)}e.setParent(this);"dir"===e.getType()&&e.isMounted()||this.bind("mounted",e,"mounted");this.getChildren().push(e)},_onGet:function(e){var t=this.getChildren();t.removeAll().forEach((function(e){this.removeRelatedBindings(e)}),this);e&&e.forEach((function(e){var n=new cv.ui.manager.model.FileItem(null,null,this);if(Object.prototype.hasOwnProperty.call(e,"children")){var i=e.children;delete e.children;if(i.length>0){n.getChildren().replace(i);n.setLoaded(!0)}}n.set(e);t.push(n)}),this);this.getFakeChildren()&&t.append(this.getFakeChildren());this.sortElements();this.setLoaded(!0);this.__P_43_2&&this.__P_43_2();this.setLoading(!1)},_onError:function(e){this.error(e);cv.ui.manager.snackbar.Controller.error(e);this.getChildren().removeAll().forEach((function(e){this.removeRelatedBindings(e)}),this);this.setLoaded(!0);this.__P_43_2&&this.__P_43_2();this.setLoading(!1)},load:function(e,t){if("file"!==this.getType())if(this.isFake()){this.setLoaded(!0);this.getFakeChildren()&&this.getChildren().append(this.getFakeChildren())}else if(this.isLoading())e&&this.addListenerOnce("changeLoading",e,t);else if(this.isLoaded())e&&e.apply(t);else{this.setLoading(!0);e&&(this.__P_43_2=e.bind(t||this));cv.io.rest.Client.getFsClient().readSync({path:this.getFullPath()},(function(e,t){e?this._onError(e):this._onGet(t)}),this)}else this.setLoaded(!0)},getFullPath:function(){this.__P_43_1||(this.__P_43_1=this.getPath()+this.getName());return this.__P_43_1},getBusTopic:function(){return"cv.manager.fs."+this.getFullPath().replace(/\//g,".")},getUri:function(){return"cv://"+this.getFullPath()},getServerPath:function(){return this.isMounted()?qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/"+this.getFullPath():qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/config/"+this.getFullPath()},sortElements:function(){this.getChildren().sort((function(e,t){return"dir"===e.getType()?"dir"===t.getType()?e.isTrash()?1:t.isTrash()?-1:e.getName().localeCompare(t.getName()):-1:"dir"===t.getType()?1:e.getName().localeCompare(t.getName())}))},openPath:function(e){var t=qx.lang.Type.isArray(e)?e:e.split("/"),n=t.shift();this.getChildren().some((function(e){if(e.getName()===n){e.load((function(){e.setOpen(!0);t.length>0&&e.openPath(t)}),this);return!0}return!1}),this)},_onChangeLocale:qx.core.Environment.select("qx.dynlocale",{true:function(){var e=this.getDisplayName();e&&e.translate&&this.setDisplayName(e.translate())},false:null})},destruct:function(){this.__P_43_1=null}});cv.ui.manager.model.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"com.zenesis.qx.upload.UploadMgr":{construct:!0,require:!0},"cv.ui.manager.model.FileItem":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"qxl.dialog.Dialog":{},"qx.lang.Json":{},"qx.event.message.Bus":{},"com.zenesis.qx.upload.File":{},"com.zenesis.qx.upload.UploadButton":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.upload.UploadMgr",{extend:com.zenesis.qx.upload.UploadMgr,construct:function(e,t){com.zenesis.qx.upload.UploadMgr.constructor.call(this,e,t);this._init()},statics:{LAST_ID:0},properties:{multiple:{refine:!0,init:!1},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_updateUploadUrl"},filename:{check:"String",nullable:!0},force:{check:"Boolean",init:!1}},members:{_updateUploadUrl:function(){var e=this.getFolder(),t=e?e.getFullPath():".",n=cv.io.rest.Client.getBaseUrl()+"/fs?type=file&path="+t;this.setUploadUrl(n)},_init:function(){var e=this;this.addListener("addFile",(function(t){var n=t.getData(),i=e.getFilename();i&&n.setParam("filename",i);e.isForce()&&n.setParam("force",!0);var r=n.addListener("changeProgress",(function(t){var n=t.getTarget(),i=t.getData();e.debug("Upload "+n.getFilename()+": "+i+" / "+n.getSize()+" - "+Math.round(i/n.getSize()*100)+"%")})),a=n.addListener("changeState",(function(t){var n=t.getData(),i=t.getTarget();if("uploading"===n)e.debug(i.getFilename()+" (Uploading...)");else if("uploaded"===n){e.debug(i.getFilename()+" (Complete)");if(200!==i.getStatus())switch(i.getStatus()){case 406:e.isForce()?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Replacing the file failed.")):qxl.dialog.Dialog.confirm(qx.locale.Manager.tr("This file already exists, do you want to replace it?"),(function(e){e&&this.forceUpload(i)}),e,qx.locale.Manager.tr("File already exists"));break;case 403:cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Uploading this file is not allowed here."));break;default:var o=i.getResponse();try{o=qx.lang.Json.parse(o).message}catch(e){}e.error(o);cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("File upload stopped with an error: %1",o))}else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("File has been uploaded"));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"uploaded",path:e.getFolder().getFullPath()+"/"+i.getFilename()})}}else"cancelled"===n&&e.debug(i.getFilename()+" (Cancelled)");if("uploaded"===n||"cancelled"===n){i.removeListenerById(r);i.removeListenerById(a)}}))}))},_getUniqueFileId:function(){return++cv.ui.manager.upload.UploadMgr.LAST_ID},forceUpload:function(e){this.setForce(!0);var t=new com.zenesis.qx.upload.File(e.getBrowserObject(),e.getFilename(),e.getId());t.set({size:e.getSize(),uploadWidget:e.getUploadWidget()});t.setParam("force",!0);this.getUploadHandler()._addFile(t);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},uploadFile:function(e){var t="upload-"+this._getUniqueFileId(),n=void 0!==e.name?e.name:e.fileName,i=new com.zenesis.qx.upload.File(e,n,t),r=void 0!==e.size?e.size:e.fileSize;i.setSize(r);this.isForce()&&i.setParam("force",!0);i.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(i);this.getAutoUpload()&&this.getUploadHandler().beginUploads()},replaceFile:function(e,t){this.setFolder(t.getParent());var n="upload-"+this._getUniqueFileId(),i=t.getName(),r=new com.zenesis.qx.upload.File(e,i,n);r.setParam("force",!0);r.setParam("filename",i);var a=void 0!==e.size?e.size:e.fileSize;r.setSize(a);r.setUploadWidget(new com.zenesis.qx.upload.UploadButton);this.getUploadHandler()._addFile(r);this.getAutoUpload()&&this.getUploadHandler().beginUploads()}}});cv.ui.manager.upload.UploadMgr.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menu.Menu":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.util.format.DateFormat":{construct:!0},"qx.locale.Date":{construct:!0},"cv.ui.manager.model.BackupFolder":{},"qx.ui.menu.Separator":{},"qx.ui.menu.Button":{},"cv.ui.manager.control.FileHandlerRegistry":{},"qx.event.message.Bus":{},"cv.ui.manager.model.CompareFiles":{},"cv.ui.manager.dialog.Prompt":{},"cv.ui.manager.control.FileController":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"cv.ui.manager.upload.UploadMgr":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.FileItem",{extend:qx.ui.menu.Menu,construct:function(e,t){qx.ui.menu.Menu.constructor.call(this);this._noCompare=!0===t;this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this._init();this._dateFormat=new qx.util.format.DateFormat(qx.locale.Date.getDateFormat("medium"));this._timeFormat=new qx.util.format.DateFormat(qx.locale.Date.getTimeFormat("medium"));e&&this.configure(e);this.addListener("appear",(function(){this.setActive(!0)}));this.addListener("disappear",(function(){this.setActive(!1)}))},properties:{appearance:{refine:!0,init:"cv-file-contextmenu"},active:{check:"Boolean",init:!1}},members:{_commandGroup:null,_selectedNode:null,_dateFormat:null,_timeFormat:null,_renameDialog:null,_noCompare:!1,configure:function(e){this._selectedNode=e;if(e){var t="dir"===e.getType(),n=t?e:e.getParent(),i=!1;(n&&n.getFullPath().startsWith("backup")||e.getFullPath().startsWith("backup"))&&(i=!0);if(t){this.getChildControl("new-file-button").set({enabled:!(!n||i)&&n.isWriteable(),visibility:"visible"});this.getChildControl("new-folder-button").set({enabled:!(!n||i)&&n.isWriteable(),visibility:"visible"})}else{this.getChildControl("new-file-button").exclude();this.getChildControl("new-folder-button").exclude()}this.getChildControl("clone-file-button").setVisibility(e.isConfigFile()&&!i?"visible":"excluded");this.getChildControl("convert-file-button").setVisibility(!e.isConfigFile()||e.isMounted()||i?"excluded":"visible");this.getChildControl("delete-button").setLabel(e.isTrash()?this.tr("Clear"):this.tr("Delete"));if(!this._noCompare){var r=this.getChildControl("compare-menu");r.removeAll();if(i)this.getChildControl("compare-with-button").exclude();else{this.getChildControl("compare-with-button").show();var a=cv.ui.manager.model.BackupFolder.getInstance().getBackupFiles(e);this.getChildControl("compare-with-button").setEnabled(a.length>0);a.sort((function(e,t){return t.date.getTime()-e.date.getTime()}));var o=null;a.forEach((function(e){var t=this._dateFormat.format(e.date);if(o!==t){null!==o&&r.add(new qx.ui.menu.Separator);var n=new qx.ui.menu.Button(t);n.setEnabled(!1);r.add(n);o=t}var i=new qx.ui.menu.Button(this.tr("Backup from %1",this._timeFormat.format(e.date)));i.setUserData("file",e.file);i.addListener("execute",this._onCompareWith,this);r.add(i)}),this)}}var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e),l=this.getChildControl("open-with-menu");l.removeAll();if(i)this.getChildControl("open-with-button").exclude();else{this.getChildControl("open-with-button").show();var c=cv.ui.manager.control.FileHandlerRegistry.getInstance().getAllFileHandlers(e);this.getChildControl("open-with-button").setEnabled(c.length>1);c.sort((function(e,t){return e.Clazz.constructor.TITLE.toString().localeCompare(t.Clazz.constructor.TITLE.toString())}));c.forEach((function(e){var t=new qx.ui.menu.Button(e.Clazz.constructor.TITLE,e.Clazz.constructor.ICON);t.setAppearance("open-with-button");s.Clazz.classname===e.Clazz.classname&&t.addState("default");t.setUserData("handlerId",e.Clazz.classname);t.addListener("execute",this._onOpenWith,this);l.add(t)}),this)}this.getChildControl("validate-config-button").setVisibility(!e.isConfigFile()||e.isMounted()||i?"excluded":"visible");if(t||i)this.getChildControl("replace-button").exclude();else{this.getChildControl("replace-button").show();this._replacementManager.setFilename(e.getName());this._replacementManager.setFolder(e.getParent())}["delete-button","replace-button","rename-button"].forEach((function(t){this.getChildControl(t).setEnabled(!e.isFake()&&e.isWriteable()&&(!i||"delete-button"===t))}),this);this.getChildControl("download-button").setEnabled(!e.isFake()&&"file"===e.getType());this.getChildControl("restore-button").setVisibility(e.isInTrash()||i?"visible":"excluded")}else{this.getChildControl("delete-button").set({label:this.tr("Delete"),enabled:!1});this.getChildControl("replace-button").exclude();this.getChildControl("download-button").setEnabled(!1);this.getChildControl("restore-button").exclude()}},_init:function(){this._noNew||this.add(this.getChildControl("new-file-button"));this.add(this.getChildControl("clone-file-button"));this.add(this.getChildControl("convert-file-button"));this._noNew||this.add(this.getChildControl("new-folder-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("open-button"));this.add(this.getChildControl("open-with-button"));this._noCompare||this.add(this.getChildControl("compare-with-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("rename-button"));this.add(this.getChildControl("delete-button"));this.add(this.getChildControl("restore-button"));this.add(new qx.ui.menu.Separator);this.add(this.getChildControl("download-button"));var e=new qx.ui.menu.Separator,t=this.getChildControl("replace-button");this.add(e);this.add(t);t.bind("visibility",e,"visibility");e=new qx.ui.menu.Separator;(t=this.getChildControl("validate-config-button")).bind("visibility",e,"visibility");this.add(e);this.add(t)},_onCompareWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("file");qx.event.message.Bus.dispatchByName("cv.manager.compareFiles",new cv.ui.manager.model.CompareFiles(t,this._selectedNode))}},_onOpenWith:function(e){if(this.isActive()){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this._selectedNode,handler:t})}},_onRename:function(){var e=this;if(this._selectedNode&&this.isActive()){if(this._renameDialog){this._renameDialog.setValue(this._selectedNode.getName());this._renameDialog.setCallback((function(t){t&&t!==e._selectedNode.getName()&&cv.ui.manager.control.FileController.getInstance().rename(e._selectedNode,t)}))}else this._renameDialog=new cv.ui.manager.dialog.Prompt({message:this.tr("New name"),callback:function(t){t&&t!==e._selectedNode.getName()&&cv.ui.manager.control.FileController.getInstance().rename(e._selectedNode,t)},context:this,value:this._selectedNode.getName(),caption:this.tr("Rename file"),filter:/[\w\d_\-\.\s]/});this._renameDialog.show()}},_onDownload:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().download(this._selectedNode)},_onRestore:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().restore(this._selectedNode)},_onValidate:function(){this._selectedNode&&this.isActive()&&cv.ui.manager.control.FileController.getInstance().validate(this._selectedNode)},_onClone:function(){this._selectedNode&&this.isActive()&&qx.event.message.Bus.dispatchByName("cv.manager.action.clone",{file:this._selectedNode})},_onConvert:function(){this._selectedNode&&this.isActive()&&qx.event.message.Bus.dispatchByName("cv.manager.action.convertToTile",{file:this._selectedNode})},_createChildControlImpl:function(e){var t,n=this;switch(e){case"new-file-button":(t=new qx.ui.menu.Button(this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18))).addListener("execute",(function(){n._selectedNode.isConfigFile()?qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",n._selectedNode.getParent()):qx.event.message.Bus.dispatchByName("cv.manager.action.new-file","dir"===n._selectedNode.getType()?n._selectedNode:n._selectedNode.getParent())}));break;case"clone-file-button":(t=new qx.ui.menu.Button(this.tr("Clone file"),cv.theme.dark.Images.getIcon("clone-file",18))).exclude();t.addListener("execute",this._onClone,this);break;case"new-folder-button":(t=new qx.ui.menu.Button(this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18))).addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder","dir"===n._selectedNode.getType()?n._selectedNode:n._selectedNode.getParent())}));break;case"rename-button":(t=new qx.ui.menu.Button(this.tr("Rename"),cv.theme.dark.Images.getIcon("rename",18))).addListener("execute",this._onRename,this);break;case"delete-button":(t=new qx.ui.menu.Button(this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18))).addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action.delete",n._selectedNode)}));break;case"download-button":(t=new qx.ui.menu.Button(this.tr("Download"),cv.theme.dark.Images.getIcon("download",18))).addListener("execute",this._onDownload,this);break;case"open-button":(t=new qx.ui.menu.Button(this.tr("Open"),cv.theme.dark.Images.getIcon("open",18))).addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.open",n._selectedNode)}));break;case"restore-button":(t=new qx.ui.menu.Button(this.tr("Restore"),cv.theme.dark.Images.getIcon("trash",18))).exclude();t.addListener("execute",this._onRestore,this);break;case"validate-config-button":(t=new qx.ui.menu.Button(this.tr("Validate"),cv.theme.dark.Images.getIcon("validate",18))).exclude();t.addListener("execute",this._onValidate,this);break;case"replace-button":(t=new com.zenesis.qx.upload.UploadMenuButton(this.tr("Replace"),cv.theme.dark.Images.getIcon("upload",18))).exclude();this._replacementManager=new cv.ui.manager.upload.UploadMgr;this._replacementManager.setForce(!0);this._replacementManager.addWidget(t);break;case"compare-menu":case"open-with-menu":t=new qx.ui.menu.Menu;break;case"compare-with-button":t=new qx.ui.menu.Button(this.tr("Compare with..."),cv.theme.dark.Images.getIcon("compare",18),null,this.getChildControl("compare-menu"));break;case"open-with-button":t=new qx.ui.menu.Button(this.tr("Open with..."),cv.theme.dark.Images.getIcon("open-with",18),null,this.getChildControl("open-with-menu"));break;case"convert-file-button":(t=new qx.ui.menu.Button(this.tr("Convert to tile structure"),cv.theme.dark.Images.getIcon("convert",18))).addListener("execute",this._onConvert,this)}return t||cv.ui.manager.contextmenu.FileItem.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._commandGroup=null;this._renameDialog=null;this._disposeObjects("_dateFormat","_timeFormat")}});cv.ui.manager.contextmenu.FileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.contextmenu.FileItem":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.GlobalFileItem",{extend:cv.ui.manager.contextmenu.FileItem,type:"singleton"});cv.ui.manager.contextmenu.GlobalFileItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.tree.VirtualTreeItem":{require:!0},"qx.event.message.Bus":{},"cv.ui.manager.control.FileController":{},"qx.ui.form.TextField":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.VirtualFsItem",{extend:qx.ui.tree.VirtualTreeItem,properties:{appearance:{refine:!0,init:"fs-tree-item"},editing:{check:"Boolean",init:!1,apply:"_applyEditing"},name:{check:"String",init:"",event:"changeName"},temporary:{check:"Boolean",init:!1,apply:"_applyTemporary"},status:{check:["valid","error"],nullable:!0,apply:"_applyStatus"}},members:{_applyEditing:function(e,t){if(e!==t){var n=this.getChildControl("edit");if(e){n.setValue(this.getLabel());n.show();qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!1)}else{qx.event.message.Bus.dispatchByName("cv.manager.tree.enable",!0);n.exclude();n.getValue()!==this.getName()&&cv.ui.manager.control.FileController.getInstance().rename(this.getModel(),n.getValue())}}},_applyTemporary:function(e){e?this.addState("temporary"):this.removeState("temporary")},_applyModel:function(e,t){cv.ui.manager.tree.VirtualFsItem.superclass.prototype._applyModel.call(this,e,t);t&&t.removeRelatedBindings(this);if(e){if(e.isTrash())this.setLabel(this.tr("Trash"));else{e.bind("name",this,"label");e.bind("valid",this,"status",{converter:function(e){return!0===e?"valid":"error"}})}e.bind("temporary",this,"temporary");if("dir"===e.getType()){this.setDroppable(!0);this.addListener("drop",this._onDrop,this)}else{this.setDroppable(!1);this.removeListener("drop",this._onDrop,this)}}},_applyStatus:function(e){var t=this.getChildControl("icon");if(e)switch(e){case"valid":t.removeState("error");break;case"error":t.addState("error")}},_onDrop:function(e){this.info(e.getRelatedTarget())},__P_53_0:function(){this.getChildControl("edit").setValue(this.getName());this.setEditing(!1)},_onKeypress:function(e){"Enter"===e.getKeyIdentifier()?this.setEditing(!1):"Esc"===e.getKeyIdentifier()&&this.__P_53_0()},_createChildControlImpl:function(e){var t,n=this;if("edit"===e){(t=new qx.ui.form.TextField).addListener("keypress",this._onKeypress,this);t.exclude();t.addListener("changeVisibility",(function(e){"visible"===e.getData()?n.getChildControl("label").exclude():n.getChildControl("label").show()}));t.addListener("blur",(function(){n.setEditing(!1)}));this._add(t)}return t||cv.ui.manager.tree.VirtualFsItem.superclass.prototype._createChildControlImpl.call(this,e)}}});cv.ui.manager.tree.VirtualFsItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.bom.Storage":{},"qx.util.Serializer":{},"cv.report.Record":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Preferences",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._restorePreferences()},properties:{defaultConfigEditor:{check:["source","xml"],init:"source",event:"changeDefaultConfigEditor",apply:"_savePreferences"},quickPreview:{check:"Boolean",init:!1,event:"changeQuickPreview",apply:"_savePreferences"},expertMode:{check:"Boolean",init:!1,event:"changeExpertMode",apply:"_savePreferences"},startViewMode:{check:["list","preview"],init:"preview",event:"changeStartViewMode",apply:"_savePreferences"}},members:{_skipSaving:!1,_savePreferences:function(){if(!this._skipSaving){var e=qx.bom.Storage.getLocal(),t=qx.util.Serializer.toNativeObject(this);e.setItem("preferences",t);cv.report.Record.record(cv.report.Record.STORAGE,"preferences",t)}},_restorePreferences:function(){var e=qx.bom.Storage.getLocal();this.set(e.getItem("preferences"))},setPreferences:function(e,t){t&&(this._skipSaving=!0);this.set(e);this._skipSaving=!1}}});cv.ui.manager.model.Preferences.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Message",{extend:qx.core.Object,properties:{title:{check:"String",init:"",event:"changeTitle"},content:{check:"String",init:"",event:"changeContent"},type:{check:["alert","hint","warning","error"],nullable:!0,event:"changeType"},sticky:{check:"Boolean",init:!1,event:"changeSticky"}}});cv.ui.manager.model.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"cv.ui.manager.model.Message":{},"qx.event.Timer":{},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{},"cv.theme.dark.Images":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.snackbar.Message",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this.addListener("appear",this._onAppear,this)},events:{close:"qx.event.type.Data"},properties:{appearance:{refine:!0,init:"cv-snackbar-msg"},model:{check:"cv.ui.manager.model.Message",nullable:!0,apply:"_applyModel"},timeout:{check:"Number",init:5e3,apply:"_applyTimeout"},type:{check:["alert","hint","warning","error"],nullable:!0,apply:"_applyType"}},members:{_timer:null,_applyModel:function(e,t){if(t){t.removeRelatedBindings(this);t.removeRelatedBindings(this.getChildControl("content"))}if(e){e.bind("title",this.getChildControl("content"),"value");e.bind("type",this,"type");e.bind("sticky",this,"timeout",{converter:function(e){return e?0:5e3}});this.getChildControl("close")}},_applyType:function(e){e?this.setDecorator(this.getAppearance()+"-"+e):this.setDecorator(this.getAppearance())},_applyTimeout:function(e){if(this._timer){this._timer.stop();0===e&&(this._timer=null)}},_onAppear:function(){var e=this.getTimeout();this._timer&&this._timer.stop();e>0&&(this._timer=qx.event.Timer.once(this.close,this,e))},close:function(){this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":t=new qx.ui.basic.Image;this._addAt(t,0);break;case"content":(t=new qx.ui.basic.Label).set({rich:!0,wrap:!0});this._addAt(t,1,{flex:1});break;case"close":(t=new qx.ui.basic.Image(cv.theme.dark.Images.getIcon("close",15))).addListener("tap",this.close,this);this._addAt(t,2)}return t||cv.ui.manager.snackbar.Message.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._disposeObjects("_timer")}});cv.ui.manager.snackbar.Message.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.FileItem":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.BackupFolder",{extend:cv.ui.manager.model.FileItem,type:"singleton",construct:function(){cv.ui.manager.model.FileItem.constructor.call(this,"backup");this.load();qx.event.message.Bus.subscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)},members:{_onFilesSystemMessage:function(e){if(/^cv\.manager\.fs\.visu_config.*\.xml$/.test(e.getName())){var t=e.getData();["contentChanged","fsContentChanged"].includes(t.type)&&this.reload()}},getBackupFiles:function(e){var t=[];if("file"===e.getType()){var n=e.getFullPath().split("/");n.pop();var i=n.join("/"),r=e.getName().split("."),a=r.pop(),o=r.join("."),s=new RegExp(i+o+"-([\\d]{14})\\."+a);this.getChildren().forEach((function(e){var n=s.exec(e.getFullPath().replace("backup/",""));n&&t.push({date:new Date(parseInt(n[1].substring(0,4)),parseInt(n[1].substring(4,6))-1,parseInt(n[1].substring(6,8)),parseInt(n[1].substring(8,10)),parseInt(n[1].substring(10,12)),parseInt(n[1].substring(12,14))),file:e})}),this)}return t}},destruct:function(){qx.event.message.Bus.unsubscribe("cv.manager.fs.*",this._onFilesSystemMessage,this)}});cv.ui.manager.model.BackupFolder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.viewer.Image":{construct:!0},"cv.ui.manager.viewer.Config":{construct:!0},"cv.ui.manager.viewer.Icons":{construct:!0},"cv.ui.manager.viewer.Folder":{construct:!0},"cv.ui.manager.Start":{construct:!0},"cv.ui.manager.editor.Source":{construct:!0},"cv.ui.manager.editor.Tree":{construct:!0},"cv.ui.manager.model.CompareFiles":{construct:!0},"cv.ui.manager.editor.Diff":{construct:!0},"cv.ui.manager.editor.Config":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"qx.lang.Type":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileHandlerRegistry",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_32_0={};this.__P_32_1=[];this.registerFileHandler(new RegExp("\\.("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i"),cv.ui.manager.viewer.Image,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Config.SUPPORTED_FILES,cv.ui.manager.viewer.Config,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Icons.SUPPORTED_FILES,cv.ui.manager.viewer.Icons,{type:"view"});this.registerFileHandler(cv.ui.manager.viewer.Folder.SUPPORTED_FILES,cv.ui.manager.viewer.Folder,{type:"view"});this.registerFileHandler(null,cv.ui.manager.Start,{type:"view"});this.registerFileHandler(cv.ui.manager.editor.Source.SUPPORTED_FILES,cv.ui.manager.editor.Source,{type:"edit"});this.registerFileHandler(cv.ui.manager.editor.Tree.SUPPORTED_FILES,cv.ui.manager.editor.Tree,{preview:!1,type:"edit"});this.registerFileHandler(cv.ui.manager.model.CompareFiles,cv.ui.manager.editor.Diff,{type:"view"});this.registerFileHandler("hidden.php",cv.ui.manager.editor.Config,{type:"edit"});cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this);this._onChangesDefaultConfigEditor()},members:{__P_32_0:null,__P_32_1:null,registerFileHandler:function(e,t,n){var i=Object.assign({Clazz:t,instance:null},n||{});if(qx.Class.isClass(e)){i.instanceOf=e;i.selectorId="instanceOf:"+e.classname;i.priority=0}else if(qx.lang.Type.isRegExp(e)){i.regex=e;i.selectorId="regex:"+e.toString();i.priority=4}else if(qx.lang.Type.isFunction(e)){i.selectorId="function:"+e.name;i.priority=3;i.function=e}else if(qx.lang.Type.isString(e))if(e.includes("/")){i.fullPath=e;i.selectorId="fullPath:"+e;i.priority=1}else{i.fileName=e;i.selectorId="fileName:"+e;i.priority=2}else{i.selectorId="none";i.priority=10}this.__P_32_0[t.classname]=i},getFileHandler:function(e,t){var n=[];if(!(e instanceof cv.ui.manager.model.CompareFiles)){var i;Object.keys(this.__P_32_1).some((function(n){if(this.__P_32_1[n].regex.test(e.getFullPath())&&(!e.isTemporary()||!this.__P_32_1[n].noTemporaryFiles)&&(e.isWriteable()||!this.__P_32_1[n].noReadOnlyFiles))if(t){var r=this.getFileHandlerById(this.__P_32_1[n].clazz.classname);r.type===t&&(i=r)}else i=this.getFileHandlerById(this.__P_32_1[n].clazz.classname);return!!i}),this);if(i)return i}Object.keys(this.__P_32_0).forEach((function(i){var r=this.__P_32_0[i];!this.__P_32_2(r,e)||t&&r.type!==t||n.push(r)}),this);if(0===n.length)return e.isFake()||1!==e.getDisplayName().split(".").length?null:this.getFileHandlerById("cv.ui.manager.editor.Source");if(1===n.length)return n[0];n.sort((function(e,t){return e.priority-t.priority}));return n[0]},getFileHandlerById:function(e){return this.__P_32_0[e]},hasFileHandler:function(e,t){return Object.keys(this.__P_32_0).some((function(n){var i=this.__P_32_0[n];return this.__P_32_2(i,e)&&(!t||i.type===t)}),this)},setDefault:function(e,t,n,i){this.__P_32_1[e.toString()]={regex:e,clazz:t,noTemporaryFiles:n,noReadOnlyFiles:i}},_onChangesDefaultConfigEditor:function(){switch(cv.ui.manager.model.Preferences.getInstance().getDefaultConfigEditor()){case"source":this.setDefault(cv.ui.manager.editor.Source.DEFAULT_FOR,cv.ui.manager.editor.Source);break;case"xml":this.setDefault(cv.ui.manager.editor.Tree.SUPPORTED_FILES,cv.ui.manager.editor.Tree)}},__P_32_2:function(e,t){return(!0!==e.noTemporaryFiles||!t.isTemporary())&&(!(!0===e.noReadOnlyFiles&&!t.isWriteable())&&(!(!e.fileName||t.getName()!==e.fileName)||(!(!e.fullPath||t.getFullPath()!==e.fullPath)||(!(!e.regex||!e.regex.test(t.getFullPath().toLowerCase()))||(!!(e.instanceOf&&t instanceof e.instanceOf)||!(!e.function||!e.function(t)))))))},getAllFileHandlers:function(e,t){return Object.keys(this.__P_32_0).filter((function(n){return this.__P_32_2(this.__P_32_0[n],e)&&(!t||this.__P_32_0[n].type===t)}),this).map((function(e){return this.__P_32_0[e]}),this)}},destruct:function(){Object.keys(this.__P_32_0).forEach((function(e){if(this.__P_32_0[e].instance){this.__P_32_0[e].instance.dispose();this.__P_32_0[e].instance=null}}),this);cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._onChangesDefaultConfigEditor,this)}});cv.ui.manager.control.FileHandlerRegistry.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.model.FileItem":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.CompareFiles",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setOriginalFile(e);this.setModifiedFile(t)},properties:{originalFile:{check:"cv.ui.manager.model.FileItem",event:"changeOriginal"},modifiedFile:{check:"cv.ui.manager.model.FileItem",event:"changeModifiedFile",apply:"_applyModifiedFile"},permanent:{check:"Boolean",init:!0},name:{check:"String",init:"",event:"changeName"},type:{check:"String",init:"file"},modified:{check:"Boolean",init:!1,event:"changeModified"}},members:{isRelated:function(e){return this.getOriginalFile().getFullPath()===e||this.getModifiedFile().getFullPath()===e},isConfigFile:function(){return this.getModifiedFile().isConfigFile()},getFullPath:function(){return this.getOriginalFile().getFullPath()},_applyModifiedFile:function(){this.setName(qx.locale.Manager.tr("Diff: %1",this.getModifiedFile().getName()))},getParent:function(){return this.getModifiedFile().getParent()},isWriteable:function(){return this.getModifiedFile().isWriteable()},isTrash:function(){return this.getModifiedFile().isTrash()},isInTrash:function(){return this.getModifiedFile().isInTrash()},isFake:function(){return this.getModifiedFile().isFake()},isTemporary:function(){return this.getModifiedFile().isTemporary()||this.getOriginalFile().isTemporary()},isMounted:function(){return this.getModifiedFile().isMounted()||this.getOriginalFile().isMounted()},getUri:function(){return"cv://"+this.getOriginalFile().getFullPath()+"+"+this.getModifiedFile().getFullPath()}}});cv.ui.manager.model.CompareFiles.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Prompt":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.Prompt",{extend:qxl.dialog.Prompt,members:{_createWidgetContent:function(){cv.ui.manager.dialog.Prompt.superclass.prototype._createWidgetContent.call(this);this._textField.setLiveUpdate(!0)}}});cv.ui.manager.dialog.Prompt.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"qx.event.message.Bus":{},"qxl.dialog.Dialog":{},"cv.ui.manager.editor.Worker":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.FileController",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_31_0=cv.io.rest.Client.getFsClient()},members:{__P_31_0:null,rename:function(e,t){var n=e.getPath()||"";n.length>0&&!n.endsWith("/")&&(n+="/");n+=t;e.isTemporary()?this.__P_31_0.createSync({path:n,type:e.getType()},(function(n){if(n)cv.ui.manager.snackbar.Controller.error(n);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been created',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been created',e.getDisplayName()));e.resetTemporary();e.resetModified();e.setName(t);e.reload()}}),this):e.getFullPath()!==n&&this.__P_31_0.moveSync({src:e.getFullPath(),target:n},(function(n){if(n)cv.ui.manager.snackbar.Controller.error(n);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been renamed to "%2"',e.getDisplayName(),t):qx.locale.Manager.tr('Folder "%1" has been renamed to "%2"',e.getDisplayName(),t));e.setName(t);e.resetModified();e.reload()}e.resetEditing()}),this)},move:function(e,t){this.__P_31_0.moveSync({src:e.getFullPath(),target:t},(function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been moved',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been moved',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"moved",path:e.getFullPath()})}}),this)},restore:function(e){if(e.isInTrash()){var t=e.getFullPath().replace(".trash/","");this.__P_31_1(e,t)}else if("file"===e.getType()&&!e.isTemporary()){var n=/^\/?backup\/visu_config(.*)-[0-9]{14}\.xml$/.exec(e.getFullPath());if(n){var i="visu_config"+n[1]+".xml",r=e.getParent().getParent(),a=null;r.getChildren().some((function(e){if(e.getFullPath()===i){a=e;return!0}return!1}));this.__P_31_0.readSync({path:e.getFullPath()},(function(t,n){t?cv.ui.manager.snackbar.Controller.error(t):a?this.__P_31_0.updateSync({path:a.getFullPath(),hash:"ignore"},n,(function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()));a.resetModified();a.resetTemporary();qx.event.message.Bus.dispatchByName(a.getBusTopic(),{type:"fsContentChanged",data:n,source:this})}}),this):this.__P_31_0.createSync({path:i,hash:"ignore"},n,(function(t){t?cv.ui.manager.snackbar.Controller.error(t):cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has been restored",e.getName()))}),this)}),this)}}},__P_31_1:function(e,t){this.__P_31_0.moveSync({src:e.getFullPath(),target:t},(function(t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{cv.ui.manager.snackbar.Controller.info("file"===e.getType()?qx.locale.Manager.tr('File "%1" has been restored',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been restored',e.getDisplayName()));qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"restored",path:e.getFullPath()})}}),this)},delete:function(e,t,n){if(e.isTemporary())t&&t.apply(n,!0);else if(e){var i;i=e.isTrash()?qx.locale.Manager.tr("Do you really want to clear the trash?"):e.isInTrash()?"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1" from the trash?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1" from the trash?',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('Do you really want to delete file "%1"?',e.getDisplayName()):qx.locale.Manager.tr('Do you really want to delete folder "%1"?',e.getDisplayName());qxl.dialog.Dialog.confirm(i,(function(i){i?this.__P_31_2(e,t,n):t&&t.apply(n,!1)}),this,qx.locale.Manager.tr("Confirm deletion"))}},__P_31_2:function(e,t,n){this.__P_31_0.deleteSync({path:e.getFullPath(),force:e.isTrash()},null,(function(i){if(i){cv.ui.manager.snackbar.Controller.error(i);t&&t.apply(n,!1)}else{var r;r=e.isTrash()?qx.locale.Manager.tr("Trash has been cleared"):e.isInTrash()?"file"===this.getType()?qx.locale.Manager.tr('File "%1" has been removed from trash',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been removed from trash',e.getDisplayName()):"file"===e.getType()?qx.locale.Manager.tr('File "%1" has been deleted',e.getDisplayName()):qx.locale.Manager.tr('Folder "%1" has been deleted',e.getDisplayName());cv.ui.manager.snackbar.Controller.info(r);t&&t.apply(n,!0);qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:e.getFullPath()})}}),this)},download:function(e){if("file"===e.getType()){var t=document.createElement("a");t.setAttribute("href",cv.io.rest.Client.getBaseUrl()+"/fs?download=true&path="+e.getFullPath());t.style.display="none";document.body.appendChild(t);t.click();document.body.removeChild(t)}},validate:function(e){e.isConfigFile()?this.__P_31_3(e):this.info("no validation available for file: "+e.getFullPath())},__P_31_3:function(e){var t=qxl.dialog.Dialog.alert(qx.locale.Manager.tr("Validating %1",e.getFullPath()));cv.ui.manager.editor.Worker.getInstance().validateConfig(e).then((function(n){t.close();if(!0===n){e.setValid(!0);cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("%1 has no errors!",e.getFullPath()))}else{e.setValid(!1);qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:e,handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}});cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.trn("%1 error found in %2!","%1 errors found in %2!",n.length,n.length,e.getFullPath()))}}))}},destruct:function(){this.__P_31_0=null}});cv.ui.manager.control.FileController.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0},"cv.ui.manager.model.FileItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.editor.IEditor",{properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_loadFile"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},statics:{TITLE:""},members:{save:function(){},getCurrentContent:function(){}}});cv.ui.manager.editor.IEditor.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Interface":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Interface.define("cv.ui.manager.IActionHandler",{members:{canHandleAction:function(e){},handleAction:function(e,t){},configureButton:function(e,t){},unConfigureButton:function(e,t){}}});cv.ui.manager.IActionHandler.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.Grow":{construct:!0},"cv.ui.manager.model.FileItem":{},"qx.ui.container.Scroll":{},"qx.ui.basic.Atom":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.AbstractViewer",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},members:{canHandleAction:function(){return!1},handleAction:function(){},configureButton:function(e){},unConfigureButton:function(e){},save:function(){},getCurrentContent:function(){},_applyFile:function(e,t){},_createChildControlImpl:function(e){var t;switch(e){case"scroll":t=new qx.ui.container.Scroll;this._add(t);break;case"image":t=new qx.ui.basic.Atom;this.getChildControl("scroll").add(t);t.getChildControl("icon").addListener("resize",this._scaleImage,this)}return t||cv.ui.manager.viewer.AbstractViewer.superclass.prototype._createChildControlImpl.call(this,e)}}});cv.ui.manager.viewer.AbstractViewer.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.ResourceManager":{},"qx.io.ImageLoader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Image",{extend:cv.ui.manager.viewer.AbstractViewer,properties:{appearance:{refine:!0,init:"image-viewer"}},statics:{SUPPORTED_FILES:["jpg","jpeg","png","gif","svg"],TITLE:qx.locale.Manager.tr("Show image"),ICON:cv.theme.dark.Images.getIcon("image",18),getImageData:function(e){var t=qx.util.ResourceManager.getInstance().getData(e);return t?{width:t[0],height:t[1],aspectRatio:t[0]/t[1]}:(t=qx.io.ImageLoader.getSize(e))&&t.width&&t.height?Object.assign({aspectRatio:t.width/t.height},t):null}},members:{_applyFile:function(e){var t=this.getChildControl("image");if(e){t.setIcon(e.getServerPath());t.setLabel(e.getFullPath());cv.ui.manager.viewer.Image.getImageData(e.getServerPath())?this._scaleImage():t.getChildControl("icon").addListenerOnce("loaded",this._scaleImage,this);this.addListener("resize",this._scaleImage,this)}else{t.resetIcon();t.resetLabel();this.removeListener("resize",this._scaleImage,this)}},_scaleImage:function(){var e=this.getBounds();if(e){var t=this.getFile();if(t){var n=this.getChildControl("image").getChildControl("icon"),i=cv.ui.manager.viewer.Image.getImageData(t.getServerPath()),r=e.height-40,a=e.width-20,o=Math.round(1/i.aspectRatio*a);if(o>r){o=r;a=Math.round(i.aspectRatio*r)}n.set({width:a,height:o,scale:!0})}}else this.addListenerOnce("appear",this._scaleImage,this)}}});cv.ui.manager.viewer.Image.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.event.message.Bus":{},"cv.ui.manager.model.FileItem":{},"qx.util.Uri":{},"qx.util.LibraryManager":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.embed.Iframe":{},"qx.ui.basic.Atom":{},"qx.event.Timer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Config",{extend:cv.ui.manager.viewer.AbstractViewer,construct:function(){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);this._setLayout(new qx.ui.layout.Grow)},properties:{appearance:{refine:!0,init:"config-viewer"},target:{check:["iframe","window"],init:"window"},external:{refine:!0,init:!0},connectToWindow:{check:"Boolean",init:!1,apply:"_applyConnectToWindow"}},statics:{SUPPORTED_FILES:/^(demo|\.)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Config viewer"),ICON:cv.theme.dark.Images.getIcon("preview",18)},members:{_windowRef:null,_source:null,_reloading:!1,_applyConnectToWindow:function(e){this.setExternal(!e)},_applyFile:function(e,t){t&&t.isConfigFile()&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e)if(e.isConfigFile()){var n=cv.ui.manager.model.FileItem.getConfigName(e.getFullPath()),i=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/..")+"?config="+(n||"");if("iframe"===this.getTarget()){i+="&preview=1&libraryCheck=false";var r=this.getChildControl("iframe");this._source=i;this.getChildControl("loading").show();r.setSource(i);r.show();var a=this.getChildControl("hint",!0);a&&a.isVisible()&&a.exclude()}else{this._source=i;var o=window.open(i,n);if(!this.isConnectToWindow()){this._onClose();return}this._windowRef=o;this._windowRef.onbeforeunload=this._onClose.bind(this);this.getChildControl("hint").show();var s=this.getChildControl("iframe",!0);s&&s.isVisible()&&s.exclude()}qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else{cv.ui.manager.snackbar.Controller.error(this.tr("%1 is no configuration file",e.getFullPath()));this._source=null}else{if(this.hasChildControl("iframe")){this.getChildControl("iframe").resetSource();this.getChildControl("iframe").exclude()}this.hasChildControl("hint")&&this.getChildControl("hint").exclude();this._windowRef&&this._windowRef.close()}},_onChange:function(e){var t=this;if("contentChanged"===e.getData().type)if(this.hasChildControl("iframe")){var n=this.getChildControl("iframe"),i=n.getDocument().location.href.startsWith(this._source)?n.getDocument().location.href:this._source;if(i&&"about:blank"!==i){this._reloading=!0;this.getChildControl("loading").show();n.addListenerOnce("load",(function(){t._reloading=!1;n.setSource(i)}))}n.setSource("about:blank")}else this._windowRef&&this._windowRef.reload()},_onClose:function(){if(this._windowRef){qx.event.message.Bus.dispatchByName("cv.manager.action.close",this.getFile());this._windowRef=null}this.resetFile()},openPage:function(e,t){if(this.hasChildControl("iframe")){var n=this.getChildControl("iframe").getContentElement().getDomElement();if(n&&n.contentWindow.cv){var i=n.contentWindow.cv.Application.structureController,r=t?i.getPageIdByPath(e,t):e;i.scrollToPage(r,0)}}},setHighlightWidget:function(e){if(this.hasChildControl("iframe")){var t=this.getChildControl("iframe").getContentElement().getDomElement();if(t&&t.contentWindow.cv){t.contentWindow.cv.TemplateEngine.getInstance().setHighlightedWidget(e)}}},_createChildControlImpl:function(e){var t,n=this;switch(e){case"iframe":(t=new qx.ui.embed.Iframe).exclude();t.addListener("load",(function(){n.hasChildControl("loading")&&!n._reloading&&n.getChildControl("loading").exclude()}));this.getChildControl("scroll").add(t);break;case"hint":(t=new qx.ui.basic.Atom(this.tr("This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window."))).set({center:!0,font:"title"});t.addListener("tap",(function(){n._windowRef&&n._windowRef.focus()}));this.getChildControl("scroll").add(t);break;case"loading":(t=new qx.ui.basic.Atom(this.tr("Loading..."),cv.theme.dark.Images.getIcon("reload",64))).set({center:!0,font:"title",iconPosition:"top",backgroundColor:"rgba(0,0,0,0.2)"});t.addListener("appear",(function(){qx.event.Timer.once((function(){t.exclude()}),n,5e3)}));t.exclude();this._add(t)}return t||cv.ui.manager.viewer.Config.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._windowRef=null}});cv.ui.manager.viewer.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.AbstractViewer":{construct:!0,require:!0},"qx.ui.core.ISingleSelection":{require:!0},"qx.ui.form.IModelSelection":{require:!0},"qx.ui.core.MSingleSelectionHandling":{require:!0},"qx.ui.core.MRemoteChildrenHandling":{require:!0},"qx.ui.form.MModelSelection":{require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.viewer.Image":{construct:!0},"qx.data.Array":{construct:!0},"qx.ui.layout.VBox":{construct:!0},"cv.ui.manager.model.FileItem":{construct:!0},"cv.theme.dark.Images":{construct:!0,usage:"dynamic",require:!0},"qx.util.Function":{construct:!0},"qx.locale.Manager":{require:!0},"cv.ui.manager.form.FileListItem":{},"cv.ui.manager.contextmenu.GlobalFileItem":{},"qx.event.message.Bus":{},"qx.data.controller.List":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.TextField":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.layout.Flow":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Folder",{extend:cv.ui.manager.viewer.AbstractViewer,implement:[qx.ui.core.ISingleSelection,qx.ui.form.IModelSelection],include:[qx.ui.core.MSingleSelectionHandling,qx.ui.core.MRemoteChildrenHandling,qx.ui.form.MModelSelection,cv.ui.manager.control.MFileEventHandler],construct:function(e){cv.ui.manager.viewer.AbstractViewer.constructor.call(this);cv.ui.manager.model.Preferences.getInstance().bind("startViewMode",this,"viewMode");this._isImageRegex=new RegExp("\\.("+cv.ui.manager.viewer.Image.SUPPORTED_FILES.join("|")+")$","i");this.initModel(new qx.data.Array);this._setLayout(new qx.ui.layout.VBox(8));this._newItem=new cv.ui.manager.model.FileItem("new","new",null).set({fake:!0,type:"file",loaded:!0,icon:cv.theme.dark.Images.getIcon("upload"),displayName:this.tr("Upload file"),special:"add-file"});this._debouncedOnFilter=qx.util.Function.debounce(this._onFilter,500,!1);e||this._createChildControl("toolbar");this._createChildControl("filter")},statics:{SUPPORTED_FILES:function(e){return"dir"===e.getType()},TITLE:qx.locale.Manager.tr("Show folder"),ICON:cv.theme.dark.Images.getIcon("folder",18)},events:{addItem:"qx.event.type.Data",removeItem:"qx.event.type.Data"},properties:{model:{check:"qx.data.Array",deferredInit:!0},permanentFilter:{check:"Function",nullable:!0,apply:"_onFilter"},showTextFilter:{check:"Boolean",init:!0,apply:"_applyShowTextFilter"},labelConverter:{check:"Function",nullable:!0},disableScrolling:{check:"Boolean",init:!1,apply:"_applyDisableScrolling"},viewMode:{check:["list","preview"],init:"list",event:"changeViewMode"}},members:{_controller:null,_isImageRegex:null,_newItem:null,_getItems:function(){return this.getChildControl("list").getChildren()},_isAllowEmptySelection:function(){return!0},_defaultLabelConverter:function(e){if("list"===this.getViewMode())return e;var t=e.split(".");t.length>1&&t.pop();return t.join(".")},_getDelegate:function(){var e=this.getLabelConverter(),t={converter:e||this._defaultLabelConverter.bind(this)};return{createItem:function(){return new cv.ui.manager.form.FileListItem},configureItem:function(e){e.addListener("dbltap",this._onDblTap,this);e.addListener("contextmenu",this._onFsItemRightClick,this);e.addListener("action",this._onFsItemRightClick,this);e.setShowFileActions(!0);this.bind("viewMode",e,"viewMode")}.bind(this),bindItem:function(e,n,i){e.bindProperty("","model",null,n,i);e.bindProperty("displayName","label",t,n,i);e.bindProperty("icon","icon",{converter:function(e,t){if("file"===t.getType()&&this._isImageRegex.test(t.getName()))return t.getServerPath();if(!e)return null;var n=e.split("/");3===n.length&&n.pop();return n.join("/")}.bind(this)},n,i)}.bind(this)}},_onFsItemRightClick:function(e){var t=e.getCurrentTarget().getModel();if("add-file"!==t.getSpecial()){var n=cv.ui.manager.contextmenu.GlobalFileItem.getInstance();n.configure(t);e.getCurrentTarget().setContextMenu(n);n.openAtPointer(e);e.getBubbles()&&e.stop()}else{e.preventDefault();e.getBubbles()&&e.stopPropagation()}},_onDblTap:function(e){var t=e.getCurrentTarget().getModel();"add-file"===t.getSpecial()||qx.event.message.Bus.dispatchByName("cv.manager.open",t)},_applyFile:function(e,t){var n=this;if(t){t.removeRelatedBindings(this);this.resetModel()}if(e){var i=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,i);this._controller.setDelegate(this._getDelegate())}e.bind("children",this,"model");var r=this.getModel();this._newItem.setParent(e);r.addListener("change",(function(){n.getChildControl("filter").getValue()||n.getPermanentFilter()?n._onFilter():n._controller.setModel(r)}));this._controller.setModel(r);e.load()}else{this._controller&&this._controller.resetModel();this._newItem.resetParent()}},_handleFileEvent:function(e){var t=this.getFile(),n=e.getData();switch(n.action){case"moved":t.reload();break;case"added":case"uploaded":case"created":n.path.startsWith(t.getFullPath())&&t.reload();break;case"deleted":var i;t&&(n.path===t.getFullPath()?this.dispose():n.path.startsWith(t.getFullPath())&&(i=t.getChildren()).some((function(e){if(e.getFullPath()===n.path){i.remove(e);this.removeRelatedBindings(e);return!0}return!1}),this));(i=this.getModel()).some((function(e){if(e.getFullPath()===n.path){i.remove(e);this.removeRelatedBindings(e);return!0}return!1}),this)}},_applyShowTextFilter:function(e){this.getChildControl("filter").setVisibility(e?"visible":"excluded")},_onFilter:function(){if(this._controller){var e=this.getChildControl("filter").getValue(),t=this.getPermanentFilter(),n=this.getModel().filter((function(n){return(!t||t(n))&&(!e||n.getName().includes(e))}));this._controller.setModel(n)}},getChildrenContainer:function(){return this.getChildControl("list")},_onAddChild:function(e){this.fireDataEvent("addItem",e.getData())},_onRemoveChild:function(e){this.fireDataEvent("removeItem",e.getData())},_onFileEvent:function(e){e.getData().action},_applyDisableScrolling:function(e){if(e){this.getChildControl("scroll").exclude();this._addAt(this.getChildControl("list"),1,{flex:1})}else{var t=this.getChildControl("scroll");t.show();t.add(this.getChildControl("list"));this._addAt(t,1,{flex:1})}},_createChildControlImpl:function(e){var t,n=this;switch(e){case"toolbar":t=new cv.ui.manager.ToolBar(null,["new-file","new-folder","upload","reload"]);this.bind("file",t,"folder");t.addListener("reload",(function(){n.getFile().reload()}));this._addAt(t,0);break;case"filter":(t=new qx.ui.form.TextField).set({placeholder:this.tr("Filter by name..."),liveUpdate:!0,margin:8});this.isShowTextFilter()||t.exclude();t.addListener("changeValue",this._debouncedOnFilter,this);this._addAt(t,1);break;case"scroll":t=new qx.ui.container.Scroll;this._addAt(t,2,{flex:1});break;case"list":(t=new qx.ui.container.Composite(new qx.ui.layout.Flow(8,8))).addListener("addChildWidget",this._onAddChild,this);t.addListener("removeChildWidget",this._onRemoveChild,this);this.isDisableScrolling()?this._addAt(t,1,{flex:1}):this.getChildControl("scroll").add(t)}return t||cv.ui.manager.viewer.Folder.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._disposeObjects("_controller");this._isImageRegex=null;cv.ui.manager.model.Preferences.getInstance().removeRelatedBindings(this)}});cv.ui.manager.viewer.Folder.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.viewer.Folder":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.core.IconAtom":{},"qx.data.controller.List":{},"cv.IconHandler":{},"cv.IconConfig":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.Icons",{extend:cv.ui.manager.viewer.Folder,construct:function(){this._disableFileEvents=!0;cv.ui.manager.viewer.Folder.constructor.call(this,!0)},statics:{SUPPORTED_FILES:/^CometVisu-Icons$/i,TITLE:qx.locale.Manager.tr("Show icons"),ICON:cv.theme.dark.Images.getIcon("icons",18)},members:{_getDelegate:function(){return{createItem:function(){return new cv.ui.manager.core.IconAtom},bindItem:function(e,t,n){e.bindProperty("","model",null,t,n)}}},_onFilter:function(){var e=this.getChildControl("filter").getValue(),t=this.getModel().filter((function(t){return t[0].includes(e)}));this._controller.setModel(t)},_applyFile:function(e,t){if(e){var n=this.getChildControl("list");if(!this._controller){this._controller=new qx.data.controller.List(null,n);this._controller.setDelegate(this._getDelegate())}var i=this.getModel(),r=cv.IconHandler.getInstance();Object.keys(cv.IconConfig.DB).forEach((function(e){i.push([e,r.getIconSource(e,"icon-preview")])}));this.getChildControl("filter").getValue()||this.getPermanentFilter()?this._onFilter():this._controller.setModel(i)}else this._controller&&this._controller.resetModel()}}});cv.ui.manager.viewer.Icons.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"qx.ui.layout.VBox":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.theme.dark.Images":{},"cv.ui.manager.model.Preferences":{},"qx.ui.container.Scroll":{},"qx.ui.container.Composite":{},"qx.ui.toolbar.ToolBar":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.RadioButton":{},"qx.ui.form.RadioGroup":{},"qx.ui.basic.Atom":{},"qx.ui.layout.HBox":{},"cv.ui.manager.ToolBar":{},"cv.ui.manager.viewer.Folder":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Start",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.VBox);this._configRegex=/^visu_config_?([^.]+)?\.xml$/;["toolbar","configs-title","configs-toolbar","configs","demo-configs-title","demo-configs","media-title","media-toolbar","media","misc-title","misc"].forEach(this._createChildControl,this)},properties:{file:{check:"cv.ui.manager.model.FileItem",apply:"_loadRoot",event:"changeFile"},appearance:{refine:!0,init:"cv-start"},selectedItem:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applySelectedItem"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},members:{_configRegex:null,_ignoreSelectionChanges:!1,_previewButton:null,_listButton:null,_radioGroup:null,save:function(){},getCurrentContent:function(){},canHandleAction:function(){return!1},handleAction:function(){},configureButton:function(e){},unConfigureButton:function(e){},_loadRoot:function(e){this.getChildControl("configs").setFile(e);var t=0;e&&e.load((function(){e.getChildren().some((function(e){if("media"===e.getName()){this.getChildControl("media").setFile(e);this.getChildControl("media-toolbar").setFolder(e);t++}else if("demo"===e.getName()){this.getChildControl("demo-configs").setFile(e);t++}return 2===t}),this)}),this)},_onChangeSelection:function(e){if(!1===this._ignoreSelectionChanges){var t=e.getTarget(),n=e.getData();this._ignoreSelectionChanges=!0;["configs","demo-configs","media"].forEach((function(e){var n=this.getChildControl(e);n!==t&&n.resetSelection()}),this);this._ignoreSelectionChanges=!1;n.length>0&&this.setSelectedItem(n[0].getModel())}},_applySelectedItem:function(){},_onToggleExpand:function(e){var t=this.getChildControl(e.getTarget().getUserData("control"));if("visible"===t.getVisibility()){t.exclude();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-down",18))}else{t.show();e.getTarget().setIcon(cv.theme.dark.Images.getIcon("drop-up",18))}},_onChangeViewMode:function(){switch(cv.ui.manager.model.Preferences.getInstance().getStartViewMode()){case"list":this._radioGroup.setSelection([this._listButton]);break;case"preview":this._radioGroup.setSelection([this._previewButton])}},_createChildControlImpl:function(e){var t;switch(e){case"scroll-container":t=new qx.ui.container.Scroll;this._add(t,{flex:1});break;case"content":t=new qx.ui.container.Composite(new qx.ui.layout.VBox(8));this.getChildControl("scroll-container").add(t);break;case"toolbar":t=new qx.ui.toolbar.ToolBar;var n=new qx.ui.toolbar.Part,i=this._listButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("listViewMode",22));i.setUserData("mode","list");i.set({show:"icon",toolTipText:this.tr("List mode")});var r=this._previewButton=new qx.ui.toolbar.RadioButton("",cv.theme.dark.Images.getIcon("previewMode",22));r.setUserData("mode","preview");r.set({show:"icon",toolTipText:this.tr("Preview mode")});n.add(i);n.add(r);t.add(n);this._radioGroup=new qx.ui.form.RadioGroup(i,r);this._onChangeViewMode();this._radioGroup.addListener("changeSelection",(function(e){var t=e.getData()[0];cv.ui.manager.model.Preferences.getInstance().setStartViewMode(t.getUserData("mode"))}));cv.ui.manager.model.Preferences.getInstance().addListener("changeStartViewMode",this._onChangeViewMode,this);this._add(t);break;case"configs-title":(t=new qx.ui.basic.Atom(this.tr("Configurations"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","configs");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("configs-header").add(t);break;case"configs-header":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox)).getContentElement().setAttribute("data-section","configs");this.getChildControl("content").add(t);break;case"configs-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-config-file","upload","reload"])).setFolder(cv.ui.manager.model.FileItem.ROOT);t.addListener("reload",(function(){cv.ui.manager.model.FileItem.ROOT.reload()}));this.getChildControl("configs-header").add(t);break;case"configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){var t=this._configRegex.exec(e.getName());return!(!t||t[1]&&t[1].endsWith("temp"))}.bind(this),labelConverter:function(e,t){if(t.isFake())return e;var n=cv.ui.manager.model.FileItem.getConfigName(e);return n||"<Default>"},file:cv.ui.manager.model.FileItem.ROOT,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"demo-configs-title":(t=new qx.ui.basic.Atom(this.tr("Demo configurations"),cv.theme.dark.Images.getIcon("drop-down",18))).setUserData("control","demo-configs");t.getContentElement().setAttribute("data-section","demo");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"demo-configs":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,permanentFilter:function(e){return this._configRegex.test(e.getName())}.bind(this),labelConverter:function(e){var t=cv.ui.manager.model.FileItem.getConfigName(e);return t||"<Default>"},disableScrolling:!0});t.exclude();t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"media-title":(t=new qx.ui.basic.Atom(this.tr("Media files"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","media");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("media-header").add(t);break;case"media-header":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox)).getContentElement().setAttribute("data-section","media");this.getChildControl("content").add(t);break;case"media-toolbar":(t=new cv.ui.manager.ToolBar(null,["new-file","upload","reload"])).addListener("reload",(function(){t.getFolder().reload()}));this.getChildControl("media-header").add(t);break;case"media":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});t.addListener("changeSelection",this._onChangeSelection,this);this.getChildControl("content").add(t);break;case"misc-title":(t=new qx.ui.basic.Atom(this.tr("Miscellaneous"),cv.theme.dark.Images.getIcon("drop-up",18))).setUserData("control","misc");t.getContentElement().setAttribute("data-section","misc");t.addListener("tap",this._onToggleExpand,this);this.getChildControl("content").add(t);break;case"misc":(t=new cv.ui.manager.viewer.Folder(!0)).set({showTextFilter:!1,disableScrolling:!0});this.__P_27_0(t);this.getChildControl("content").add(t,{flex:1})}return t||cv.ui.manager.Start.superclass.prototype._createChildControlImpl.call(this,e)},__P_27_0:function(e){var t=this;if(cv.ui.manager.model.FileItem.ROOT.isLoaded()){var n=[cv.ui.manager.model.FileItem.getIconFile()];cv.ui.manager.model.FileItem.ROOT.getChildren().some((function(e){if("hidden.php"===e.getFullPath()){e.set({overrideIcon:!0,icon:cv.theme.dark.Images.getIcon("hidden-config",15),displayName:qx.locale.Manager.tr("Hidden configuration"),fake:!0});n.unshift(e);return!0}return!1}));var i=new cv.ui.manager.model.FileItem("fake","fake",cv.ui.manager.model.FileItem.ROOT,n).set({fake:!0,type:"dir",loaded:!0});e.setFile(i);e.addListener("changeSelection",this._onChangeSelection,this)}else cv.ui.manager.model.FileItem.ROOT.addListenerOnce("changeLoaded",(function(){t.__P_27_0(e)}))}},destruct:function(){this._configRegex=null;cv.ui.manager.model.Preferences.getInstance().removeListener("changeStartViewMode",this._onChangeViewMode,this);this._disposeObjects("_previewButton","_listButton","_radioGroup")}});cv.ui.manager.Start.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"cv.ui.manager.editor.IEditor":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.io.rest.Client":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"qx.lang.Function":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.AbstractEditor",{extend:qx.ui.core.Widget,implement:[cv.ui.manager.editor.IEditor,cv.ui.manager.IActionHandler],type:"abstract",construct:function(){qx.ui.core.Widget.constructor.call(this);this._initClient();this._nativePasteSupported=document.queryCommandSupported("paste")},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,apply:"_loadFile",event:"changeFile"},content:{nullable:!0,event:"changeContent",apply:"_applyContent"},handlerOptions:{check:"Map",nullable:!0,apply:"_applyHandlerOptions"},external:{check:"Boolean",init:!1},ready:{check:"Boolean",init:!0,event:"changeReady"}},statics:{CLIPBOARD:null},members:{_handledActions:null,_nativePasteSupported:!1,canHandleAction:function(e){return!("save"===e&&this.getFile()&&!this.getFile().isWriteable())&&(this._handledActions&&this._handledActions.includes(e))},handleAction:function(e){if(this.canHandleAction(e)&&"save"===e)this.save()},configureButton:function(e){},unConfigureButton:function(e){},_initClient:function(){this._client=cv.io.rest.Client.getFsClient()},_applyHandlerOptions:function(){},_loadFile:function(e,t){t&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(e&&"file"===e.getType()){null!==e.getContent()?this.setContent(e.getContent()):this._loadFromFs();qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this)}else this.resetContent()},_loadFromFs:function(){this._client.readSync({path:this.getFile().getFullPath()},(function(e,t){if(e)cv.ui.manager.snackbar.Controller.error(e);else{t instanceof XMLDocument&&(t=(new XMLSerializer).serializeToString(t));this.setContent(t)}}),this)},_onChange:function(e){var t=e.getData();"fsContentChanged"===t.type&&t.source!==this&&this.setContent(t.data)},_applyContent:function(){},getCurrentContent:function(){},_handleSaveResponse:function(e,t){if(t)cv.ui.manager.snackbar.Controller.error(t);else{var n="created"===e?this.tr("File has been created"):this.tr("File has been saved");cv.ui.manager.snackbar.Controller.info(n);this._onSaved();var i=this.getFile();if(i){i.resetContent();qx.event.message.Bus.dispatchByName(i.getBusTopic(),{type:e,file:i,data:this.getCurrentContent(),source:this})}}},save:function(e,t){var n=this.getFile();n.isModified()&&(n.isTemporary()?this._client.createSync({path:n.getFullPath(),hash:t||n.getHash(),type:"file"},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"created"),this):this._client.updateSync({path:n.getFullPath(),hash:t||n.getHash()},this.getCurrentContent(),e||qx.lang.Function.curry(this._handleSaveResponse,"contentChanged"),this))},_onSaved:function(){var e=this.getFile();if(e){e.resetModified();e.resetTemporary()}},showErrors:function(e,t){},showDecorations:function(e,t){}},destruct:function(){this._client&&(this._client=null)}});cv.ui.manager.editor.AbstractEditor.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.core.FocusHandler":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"qx.util.Uri":{},"qx.util.LibraryManager":{},"qx.util.DynamicScriptLoader":{},"cv.ui.manager.editor.completion.Config":{},"cv.ui.manager.editor.completion.CometVisu":{},"qx.log.Logger":{},"cv.ui.manager.editor.Worker":{},"cv.Version":{},"qx.io.request.Xhr":{},"qx.util.ResourceManager":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qxl.dialog.Dialog":{},"qx.xml.Document":{},"cv.util.ConfigUpgrader":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Source",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save","cut","copy","paste","undo","redo"];this.getContentElement().setAttribute("contentEditable","true");this.set({droppable:!1,focusable:!0});this.addListener("dragover",(function(e){e.preventDefault();e.dataTransfer.effectAllowed="none";e.dataTransfer.dropEffect="none"}));this.addListener("drop",(function(e){e.preventDefault()}));this.addListener("appear",(function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!1)}));this.addListener("disappear",(function(){qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)}));this._draw();this._initWorker();this._currentDecorations=[];this.bind("file.writeable",this,"selectable")},statics:{TITLE:qx.locale.Manager.tr("Texteditor"),COUNTER:0,MONACO_EXTENSION_REGEX:null,FALLBACK_EXTENSION_REGEX:/\.(xml|xsd|html|php|css|js|svg|json|md|yaml|conf|ts|rst|py|txt)$/i,SUPPORTED_FILES:function(e){var t="string"==typeof e?e:e.getFullPath().toLowerCase();return cv.ui.manager.editor.Source.getExtensionRegex().test(t)},DEFAULT_FOR:/^(demo|\.)?\/?visu_config.*\.xml/,ICON:cv.theme.dark.Images.getIcon("text",18),getExtensionRegex:function(){if(!cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX&&window.monaco&&window.monaco.languages&&!cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX){var e=["\\.xsd"];monaco.languages.getLanguages().forEach((function(t){t.extensions&&t.extensions.forEach((function(t){t=t.replace(/\./g,"\\.");-1===e.indexOf(t)&&e.push(t)}))}));cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX=new RegExp("("+e.join("|")+")$")}return cv.ui.manager.editor.Source.MONACO_EXTENSION_REGEX||cv.ui.manager.editor.Source.FALLBACK_EXTENSION_REGEX},load:function(e,t){var n=this,i=qx.util.Uri.getAbsolute(qx.util.LibraryManager.getInstance().get("cv","resourceUri")+"/.."),r=new qx.util.DynamicScriptLoader([i+"node_modules/monaco-editor/min/vs/loader.js","manager/xml.js"]);r.addListener("ready",(function(){window.require.config({paths:{vs:i+"node_modules/monaco-editor/min/vs"}});window.require.config({"vs/nls":{availableLanguages:{"*":"en"!==qx.locale.Manager.getInstance().getLanguage()?qx.locale.Manager.getInstance().getLanguage():""}}});window.require(["xml!*./resource/manager/completion-libs/qooxdoo.d.ts","vs/editor/editor.main"],(function(n){e.apply(t);window.monaco.languages.typescript.javascriptDefaults.addExtraLib(n,"qooxdoo.d.ts");var i=new cv.ui.manager.editor.completion.Config,r=new cv.ui.manager.editor.completion.CometVisu;window.monaco.languages.registerCompletionItemProvider("javascript",r.getProvider());window.monaco.languages.registerCompletionItemProvider("xml",i.getProvider())}))}));r.addListener("failed",(function(e){qx.log.Logger.error(n,e.getData())}));r.start()}},members:{_editor:null,_workerWrapper:null,_currentDecorations:null,_configClient:null,_onDidChangeContentGuard:0,_initWorker:function(){this._workerWrapper=cv.ui.manager.editor.Worker.getInstance();this._workerWrapper.setEditor(this)},_getDefaultModelOptions:function(){return{tabSize:2,indentSize:2,insertSpaces:!0}},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.create(e,{suggestOnTriggerCharacters:!0,folding:!0,autoIndent:!0,automaticLayout:!0,dragAndDrop:!0,formatOnPaste:!0,formatOnType:!0,renderValidationDecorations:"on",minimap:{enabled:!0},theme:"vs-dark"});var t=cv.Version.VERSION.split("-")[0],n=new qx.io.request.Xhr(qx.util.ResourceManager.getInstance().toUri("hidden-schema.json"));n.set({method:"GET",accept:"application/json"});n.addListenerOnce("success",(function(e){var n=e.getTarget().getResponse();window.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:[{uri:"https://www.cometvisu.org/CometVisu/schemas/"+t+"/hidden-schema.json",fileMatch:["hidden.php"],schema:n}]})}));n.send();this.getFile()&&this._loadFile(this.getFile());this._editor.onDidChangeModelContent(this._onContentChanged.bind(this))}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"cut":this._editor.trigger("external","editor.action.clipboardCutAction");this._nativePasteSupported||(cv.ui.manager.editor.AbstractEditor.CLIPBOARD=this._editor.getModel().getValueInRange(this._editor.getSelection()));break;case"copy":this._editor.trigger("external","editor.action.clipboardCopyAction");this._nativePasteSupported||(cv.ui.manager.editor.AbstractEditor.CLIPBOARD=this._editor.getModel().getValueInRange(this._editor.getSelection()));break;case"paste":this._nativePasteSupported?this._editor.trigger("external","editor.action.clipboardPasteAction"):this._paste();break;case"undo":case"redo":this._editor.trigger("external",e);break;default:cv.ui.manager.editor.Source.superclass.prototype.handleAction.call(this,e)}},_paste:function(){if(cv.ui.manager.editor.AbstractEditor.CLIPBOARD){var e={identifier:{major:1,minor:1},range:this._editor.getSelection(),text:cv.ui.manager.editor.AbstractEditor.CLIPBOARD,forceMoveMarkers:!0};this._editor.executeEdits("clipboard",[e])}},_loadFile:function(e,t){t&&this._workerWrapper&&this._workerWrapper.close(t);this._editor&&(e&&"file"===e.getType()&&this.isSupported(e)?cv.ui.manager.editor.Source.superclass.prototype._loadFile.call(this,e,t):cv.ui.manager.editor.Source.superclass.prototype._loadFile.call(this,null,t))},_loadFromFs:function(){var e=this;if("hidden.php"===this.getFile().getName()){if(!this._configClient){this._configClient=cv.io.rest.Client.getConfigClient();this._configClient.addListener("getSuccess",(function(t){var n=t.getData();Object.prototype.hasOwnProperty.call(n,"error")?e.setContent(n.data):e.setContent(JSON.stringify(t.getData(),null,2))}));this._configClient.addListener("updateSuccess",this._onSaved,this)}this._configClient.get({section:"*",key:"*"})}else cv.ui.manager.editor.Source.superclass.prototype._loadFromFs.call(this)},save:function(e,t){"hidden.php"===this.getFile().getName()?this.getFile().isValid()?this.getFile().getHasWarnings()?qxl.dialog.Dialog.confirm(this.tr("Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?"),(function(e){e&&this.__P_34_0()}),this,qx.locale.Manager.tr("Confirm saving with warnings")):this.__P_34_0():cv.ui.manager.snackbar.Controller.error(this.tr("Hidden config is invalid, please correct the errors")):cv.ui.manager.editor.Source.superclass.prototype.save.call(this,e,t)},__P_34_0:function(){this._configClient.saveSync(null,JSON.parse(this.getCurrentContent()),(function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}}),this)},_applyContent:function(e){var t=this.getFile();if(t){var n=this._editor.getModel();this._workerWrapper&&this._workerWrapper.open(t,e);var i=monaco.Uri.parse(t.getUri()),r=window.monaco.editor.getModel(i);if(!r){qx.xml.Document.isXmlDocument(e)?e=e.documentElement.outerHTML:"object"===_typeof(e)&&(e=JSON.stringify(e,null,2));(r=window.monaco.editor.createModel(e,this._getLanguage(t),i)).onDidChangeDecorations((function(e){var n=!1,a=!1;monaco.editor.getModelMarkers({owner:r.getLanguageId(),resource:i}).some((function(e){e.severity===monaco.MarkerSeverity.Warning?a=!0:e.severity===monaco.MarkerSeverity.Error&&(n=!0);return a&&n}),this);t.setValid(!n);t.setHasWarnings(a)}))}if(n!==r){r.updateOptions(this._getDefaultModelOptions());this._editor.setModel(r)}else this._editor.setValue(e);this._editor.updateOptions({readOnly:!t.isWriteable()});this._processHandlerOptions(e)}},_processHandlerOptions:function(e){var t=this.getHandlerOptions()||{};if(Object.prototype.hasOwnProperty.call(t,"upgradeVersion")&&!0===t.upgradeVersion&&e){var n=this._upgradeConfig(e),i=_slicedToArray(n,2),r=i[0],a=i[1];r?this.error(r):this._editor.setValue(this._convertToString(a))}},_convertToString:function(e){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+e.documentElement.outerHTML},_upgradeConfig:function(e){if(this.getFile()){if(this.getFile().isWriteable()){return(new cv.util.ConfigUpgrader).upgrade(e)}cv.ui.manager.snackbar.Controller.error(this.tr('"%1" is not writable. Upgrading not possible.',this.getFile().getFullPath()))}return[null,"",[]]},getCurrentContent:function(){return this._editor.getValue()},_onContentChanged:function(){this._workerWrapper&&this._workerWrapper.contentChanged(this.getFile(),this._editor.getValue())},isSupported:function(e){var t=e.getName().split("."),n="."+(t.length>1?t.pop():"txt");return cv.ui.manager.editor.Source.getExtensionRegex().test(n)},showErrors:function(e,t){var n=[],i=this._editor.getModel();if(i){var r=-1;t&&t.forEach((function(e){t=e.line,(r<0||r>t)&&(r=t);var t;n.push({severity:window.monaco.MarkerSeverity.Error,startLineNumber:e.line,endLineNumber:e.line,message:e.message,startColumn:e.startColumn,endColumn:e.endColumn})}));if(this.getFile().getFullPath()===e){window.monaco.editor.setModelMarkers(i,i.getLanguageId(),n);var a=this.getHandlerOptions();a&&a.jumpToError&&0===this._editor.getScrollTop()&&this._editor.revealLineInCenter(r)}}},showDecorations:function(e,t){this.getFile().getFullPath()===e&&this._editor.deltaDecorations(this._currentDecorations[e],t);this._currentDecorations[e]=t},_getLanguage:function(e){if("hidden.php"===e.getName())return"json";var t=e.getName().split(".").pop();switch(t){case"svg":case"xsd":return"xml";case"js":return"javascript";case"md":return"markdown";default:if(!t)return"txt";var n="."+t;monaco.languages.getLanguages().some((function(e){return e.id===t||e.extensions&&e.extensions.indexOf(n)>=0}))||(t="txt");return t}}},destruct:function(){this._workerWrapper=null;if(this._editor){this._editor.dispose();this._editor=null}this._configClient=null;qx.ui.core.FocusHandler.getInstance().setUseTabNavigation(!0)}});cv.ui.manager.editor.Source.$$dbClassInfo=e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new I(r||[]);return i(o,"_invoke",{value:y(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function h(){}function g(){}function m(){}var f={};l(f,a,(function(){return this}));var p=Object.getPrototypeOf,_=p&&p(p(E([])));_&&_!==t&&n.call(_,a)&&(f=_);var v=m.prototype=h.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function y(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return P()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}function C(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=u(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,i(v,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:g,configurable:!0}),g.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(x.prototype),l(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new x(c(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(q),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),q(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;q(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,i,r,o,s,"next",e)}function s(e){asyncGeneratorStep(a,i,r,o,s,"throw",e)}o(void 0)}))}}!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",require:!0},"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.Grow":{construct:!0},"qx.data.Array":{construct:!0},"qx.core.Init":{construct:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.model.XmlElement":{},"cv.ui.manager.model.Schema":{},"qx.bom.Viewport":{},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.model.ElementChange":{},"cv.ui.manager.editor.Worker":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.layout.Canvas":{},"qx.ui.layout.VBox":{},"cv.ui.manager.viewer.Config":{},"qx.ui.basic.Atom":{},"qx.ui.toolbar.Button":{},"qx.ui.toolbar.CheckBox":{},"qx.ui.toolbar.ToolBar":{},"qx.ui.form.TextField":{},"qx.util.Function":{},"qx.ui.tree.VirtualTree":{},"qx.bom.client.Device":{require:!0},"cv.ui.manager.tree.VirtualElementItem":{},"qxl.dialog.Dialog":{},"qx.ui.core.Widget":{},"qx.ui.decoration.Decorator":{},"cv.ui.manager.contextmenu.ConfigElement":{},"qx.ui.core.DragDropCursor":{},"qx.event.Timer":{},"cv.ui.manager.snackbar.Controller":{},"cv.ui.manager.form.ElementForm":{},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.editor.data.Provider":{},"qx.ui.form.ListItem":{},"qx.core.ValidationError":{},"cv.ui.manager.editor.Source":{},"cv.ui.manager.dialog.ValidationError":{},"cv.ui.manager.Main":{},"qx.event.message.Bus":{},"qx.xml.Document":{},"cv.util.Prettifier":{},"qx.ui.core.FocusHandler":{},"cv.ui.manager.dialog.BigAlert":{}},environment:{provided:[],required:{"device.touch":{className:"qx.bom.client.Device"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Tree",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){var e=this;cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._setLayout(new qx.ui.layout.Grow);this._handledActions=["save","cut","copy","paste","undo","redo","help"];this._initWorker();this._schemas={};this.__P_35_0=[];this.__P_35_1=new qx.data.Array;this.__P_35_1.addListener("changeLength",(function(t){if(0===t.getData())e.setPreviewState("synced");else{var n=e.__P_35_1.some((function(e){return e.hasChildrenModified()}));e.setPreviewState(n?"structureChanged":"changed")}}));this.initUnDos(new qx.data.Array);this.initReDos(new qx.data.Array);this.__P_35_2={};qx.core.Init.getApplication().getRoot().addListener("keyup",this._onElementKeyUp,this);this.addListener("resize",this._maintainPreviewVisibility,this);this._draw()},statics:{SUPPORTED_FILES:/^(demo|\.)?\/?visu_config.*\.xml/,TITLE:qx.locale.Manager.tr("Xml-editor"),ICON:cv.theme.dark.Images.getIcon("xml",18),Allowed:{NONE:0,BEFORE:1,AFTER:2,INSIDE:4,FIRST_CHILD:8}},properties:{appearance:{refine:!0,init:"tree-editor"},expert:{check:"Boolean",init:!1},ready:{refine:!0,init:!1},selected:{check:"cv.ui.manager.model.XmlElement",nullable:!0,event:"changeSelected",apply:"_applySelected"},clipboard:{check:"cv.ui.manager.model.XmlElement",nullable:!0,event:"changeClipboard",apply:"_applyClipboard"},unDos:{check:"qx.data.Array",deferredInit:!0},reDos:{check:"qx.data.Array",deferredInit:!0},autoRefreshPreview:{check:"Boolean",init:!1},previewState:{check:["synced","changed","structureChanged"],init:"synced",event:"previewStateChanged",apply:"_updateHighlightWidget"},showPreview:{check:"Boolean",init:!0,apply:"_applyShowPreview",event:"showPreviewChanged"},dragging:{check:"Boolean",init:!1,event:"changeDragging"}},members:{_schemas:null,__P_35_0:null,__P_35_1:null,_workerWrapper:null,__P_35_3:!1,__P_35_2:null,__P_35_4:null,__P_35_5:0,_structure:null,getSchema:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.startsWith("../")&&(e=e.substring(3));if(Object.prototype.hasOwnProperty.call(t,e)){n.next=5;break}n.next=4;return cv.ui.manager.model.Schema.getInstance(e);case 4:t._schemas[e]=n.sent;case 5:return n.abrupt("return",new Promise((function(n,i){t._schemas[e].onLoaded((function(){this.setReady(!0);n(this._schemas[e])}),t)})));case 6:case"end":return n.stop()}}),n)})))()},isPreviewSynced:function(){return"synced"===this.getPreviewState()},_applyHandlerOptions:function(){this._maintainPreviewVisibility()},_maintainPreviewVisibility:function(){var e=this.getHandlerOptions(),t=qx.bom.Viewport.getWidth()>800&&(!e||!e.noPreview);if(t){var n=this.__P_35_6();n.isTemporary()||n.isWriteable()?n.isTemporary()&&!cv.ui.manager.model.FileItem.ROOT.isWriteable()&&(t=!1):t=!1}this.setShowPreview(t)},_applyShowPreview:function(e){this.getChildControl("right").setVisibility(e?"visible":"excluded");if(e){this.getChildControl("left").clearLayoutProperties();this.getChildControl("left").updateLayoutProperties()}else{var t=this.getHandlerOptions();t&&t.noStretch||this.getChildControl("left").setLayoutProperties({flex:1})}var n=this.getFile();if(e&&n){var i=this.getChildControl("preview");n.isWriteable()?i.getFile()||i.setFile(this.__P_35_6()):i.setFile(n);this._updatePreview()}},handleAction:function(e){if(this.canHandleAction(e))switch(e){case"undo":this.__P_35_3||this.undo();break;case"redo":this.__P_35_3||this.redo();break;case"cut":this._onCut();break;case"copy":this._onCopy();break;case"paste":this._onPaste();break;case"help":this.__P_35_3||this._showHelp();break;default:cv.ui.manager.editor.Tree.superclass.prototype.handleAction.call(this,e)}},configureButton:function(e,t){var n=this;switch(e){case"undo":this.__P_35_2[e]=this.getUnDos().addListener("changeLength",(function(){var e=n.getUnDos().length;if(e>0){t.setEnabled(!0);t.setToolTipText(n.tr("Undo: %1",n.getUnDos().getItem(e-1).getTitle()))}else{t.setEnabled(!1);t.resetToolTipText()}}));t.setEnabled(this.getUnDos().length>0);break;case"redo":this.__P_35_2[e]=this.getReDos().addListener("changeLength",(function(){var e=n.getReDos().length;if(e>0){t.setEnabled(!0);t.setToolTipText(n.tr("Undo: %1",n.getReDos().getItem(e-1).getTitle()))}else{t.setEnabled(!1);t.resetToolTipText()}}));t.setEnabled(this.getReDos().length>0);break;case"cut":this.bind("selected",t,"enabled",{converter:function(e){return!!e&&!e.isDeletable()}});break;case"copy":this.bind("selected",t,"enabled",{converter:function(e){return!!e}});break;case"paste":this.bind("clipboard",t,"enabled",{converter:function(e){return!!e}})}},unConfigureButton:function(e,t){switch(e){case"undo":if(this.__P_35_2[e]){this.getUnDos().removeListenerById(this.__P_35_2[e]);delete this.__P_35_2[e]}t.setEnabled(!1);break;case"redo":if(this.__P_35_2[e]){this.getReDos().removeListenerById(this.__P_35_2[e]);delete this.__P_35_2[e]}t.setEnabled(!1);break;case"paste":case"cut":case"copy":this.removeRelatedBindings(t)}},addUndo:function(e){e instanceof cv.ui.manager.model.ElementChange&&this.getUnDos().push(e)},undo:function(){var e=this.getUnDos();if(e.length>0){var t=e.pop();if(t.undo())this.getReDos().push(t);else{this.error("could not undo "+t.getTitle());e.push(t)}}},redo:function(){var e=this.getReDos();if(e.length>0){var t=e.pop();if(t.redo())this.getUnDos().push(t);else{this.error("could not redo "+t.getTitle());e.push(t)}}},clearUnDosReDos:function(){this.getUnDos().removeAll().forEach((function(e){return e.dispose()}));this.clearReDos()},clearReDos:function(){this.getReDos().removeAll().forEach((function(e){return e.dispose()}))},_applyClipboard:function(e){try{e?navigator.clipboard.writeText(e.getNode().outerHTML):navigator.clipboard.writeText("")}catch(t){cv.ui.manager.editor.AbstractEditor.CLIPBOARD=e?e.getNode().outerHTML:""}},_initWorker:function(){this._workerWrapper=cv.ui.manager.editor.Worker.getInstance()},showErrors:function(e,t){},showDecorations:function(e,t){},_loadFile:function(e,t){t&&this._workerWrapper&&this._workerWrapper.close(t);if(e&&"file"===e.getType()&&this.isSupported(e))cv.ui.manager.editor.Tree.superclass.prototype._loadFile.call(this,e,t);else{cv.ui.manager.editor.Tree.superclass.prototype._loadFile.call(this,null,t);this.hasChildControl("preview")&&this.getChildControl("preview").resetFile();this.resetPreviewState()}},_createChildControlImpl:function(e,t){var n,i=this;switch(e){case"splitpane":n=new qx.ui.container.Composite(new qx.ui.layout.HBox);this._add(n);break;case"left":n=new qx.ui.container.Composite(new qx.ui.layout.Canvas);this.getChildControl("splitpane").addAt(n,0);break;case"right":n=new qx.ui.container.Composite(new qx.ui.layout.VBox);this.isShowPreview()||n.exclude();this.getChildControl("splitpane").addAt(n,1,{flex:1});break;case"preview":(n=new cv.ui.manager.viewer.Config).set({target:"iframe",minWidth:600});this.getChildControl("right").addAt(n,1,{flex:1});break;case"preview-sync-hint":var r=this.tr("Preview shows the current state of the edited configuration."),a=this.tr("Preview is out of sync. Click here to refresh."),o=this.tr("Preview is out of sync. Highlighting of the currently selected tree element is deactivated until you refresh the preview. Click here to refresh.");(n=new qx.ui.basic.Atom(r,cv.theme.dark.Images.getIcon("valid",16))).setRich(!0);n.getChildControl("label").setWrap(!0);n.addListener("tap",(function(){!i.isPreviewSynced()&&i.isShowPreview()&&i._updatePreview()}));this.getChildControl("right").addAt(n,0);this.addListener("previewStateChanged",(function(e){switch(e.getData()){case"synced":n.set({label:r,icon:cv.theme.dark.Images.getIcon("valid",16)});n.getChildControl("icon").removeState("error");n.getChildControl("icon").removeState("warning");break;case"changed":n.set({label:a,icon:cv.theme.dark.Images.getIcon("out-of-sync",16)});n.getChildControl("icon").removeState("error");n.getChildControl("icon").addState("warning");break;case"structureChanged":n.set({label:o,icon:cv.theme.dark.Images.getIcon("out-of-sync",16)});n.getChildControl("icon").addState("error");n.getChildControl("icon").removeState("warning")}}));break;case"edit-button":(n=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("edit",24))).setEnabled(!1);n.addListener("execute",this._onEdit,this);this.bind("file.writeable",n,"icon",{converter:function(e){return e?cv.theme.dark.Images.getIcon("edit",16):cv.theme.dark.Images.getIcon("view",16)}});this.getChildControl("toolbar").add(n);break;case"delete-button":(n=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("delete",16))).setEnabled(!1);n.addListener("execute",this._onDelete,this);this.getChildControl("toolbar").add(n);break;case"toggle-expert":(n=new qx.ui.toolbar.CheckBox(this.tr("Expertview"),cv.theme.dark.Images.getIcon("expert",16))).addListener("execute",(function(){i.toggleExpert()}));this.getChildControl("toolbar").add(n);break;case"refresh-preview":(n=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("reload",16))).setToolTipText(this.tr("Reload preview"));n.addListener("execute",this._updatePreview,this);this.bind("showPreview",n,"visibility",{converter:function(e){return e?"visible":"hidden"}});this.bind("previewState",n,"enabled",{converter:function(e){return"synced"!==e}});this.getChildControl("toolbar").add(n);break;case"toolbar":n=new qx.ui.toolbar.ToolBar;this.getChildControl("left").add(n,{top:0,left:0,right:0});break;case"searchbar-container":n=new qx.ui.container.Composite(new qx.ui.layout.HBox);this.getChildControl("left").add(n,{top:36,left:0,right:0});break;case"searchbar":(n=new qx.ui.form.TextField).set({liveUpdate:!0,placeholder:this.tr("Search..."),margin:8});n.addListener("changeValue",qx.util.Function.debounce(this._onSearch,250),this);n.addListener("keyup",(function(e){switch(e.getKeyIdentifier()){case"Enter":case"Down":i._showNextResult();break;case"Up":i._showPreviousResult()}e.stopPropagation()}));this.getChildControl("searchbar-container").add(n,{flex:1});break;case"tree":(n=new qx.ui.tree.VirtualTree(null,"displayName","children")).set({selectionMode:"single",width:350,openMode:"none",itemHeight:qx.core.Environment.get("device.touch")?40:20});this.bind("file.writeable",n,"droppable");this.bind("file.writeable",n,"draggable");this._initDragDrop(n);n.setDelegate({createItem:function(){var e=new cv.ui.manager.tree.VirtualElementItem;qx.core.Environment.get("device.touch")?e.addListener("action",this._onContextMenuAction,this):e.addListener("contextmenu",this._onContextMenu,this);e.addListener("dbltap",this._onEdit,this);return e}.bind(this),bindItem:function(e,t,n){e.bindProperty("","model",null,t,n);e.bindProperty("displayName","label",null,t,n);e.bindProperty("name","name",null,t,n);e.bindPropertyReverse("open","open",null,t,n);e.bindProperty("open","open",null,t,n);e.bindProperty("showEditButton","editable",null,t,n);e.bindProperty("sortable","sortable",null,t,n);e.bindProperty("icon","icon",null,t,n);e.bindProperty("status","status",null,t,n);e.bindProperty("invalidMessage","toolTipText",null,t,n);e.bindProperty("dragging","dragging",null,t,n)}});n.getSelection().addListener("change",this._onChangeTreeSelection,this);this.getChildControl("left").add(n,{top:72,left:0,right:0,bottom:0});break;case"add-button":(n=new qx.ui.basic.Atom(null,cv.theme.dark.Images.getIcon("add",32))).setDraggable(!0);n.setMarginLeft(-16);n.setZIndex(20);this.addListener("changeDragging",(function(e){n.setLayoutProperties({bottom:16,left:e.getData()?-1e3:"50%"})}));n.setAppearance("round-button");n.addListener("pointerover",(function(){return n.addState("hovered")}));n.addListener("pointerout",(function(){return n.removeState("hovered")}));n.addListener("tap",(function(){i.getSelected()?i._onCreate(i.getSelected(),"inside"):qxl.dialog.Dialog.alert(i.tr("Please create a new Element either by dragging this button to the place where the new element should be inserted or by selecting an element and pressing this button to insert a new child to this element."))}));this.getChildControl("left").add(n,{bottom:16,left:"50%"});break;case"drag-indicator":(n=new qx.ui.core.Widget).setDecorator((new qx.ui.decoration.Decorator).set({widthTop:1,styleTop:"solid",colorTop:"white"}));n.setHeight(0);n.setOpacity(.5);n.setZIndex(100);n.setDroppable(!0);n.setLayoutProperties({left:-1e3,top:-1e3});qx.core.Init.getApplication().getRoot().add(n);break;case"context-menu":(n=new cv.ui.manager.contextmenu.ConfigElement(this)).addListener("action",this._onContextMenuAction,this)}return n||cv.ui.manager.editor.Tree.superclass.prototype._createChildControlImpl.call(this,e)},_onContextMenu:function(e){var t=e.getCurrentTarget();if(t instanceof cv.ui.manager.tree.VirtualElementItem){var n=t.getModel();this.getChildControl("tree").getSelection().replace([n]);this.setSelected(n);var i=this.getChildControl("context-menu");i.setElement(n);i.openAtPointer(e)}e.getBubbles()&&e.stop()},_onContextMenuAction:function(e){var t=e.getData();if(this.canHandleAction(t.action))this.handleAction(t.action);else switch(t.action){case"view":case"edit":this._onEdit(null,t.element);break;case"delete":this._onDelete(null,t.element);break;case"create":this._onCreate(t.element,"inside");break;default:this.error("unhandled context menu action",t.action)}},_onChangeTreeSelection:function(e){var t=e.getData();1===t.added.length?this.setSelected(t.added[0]):this.resetSelected()},openByQuerySelector:function(e,t){var n=this;return new Promise((function(i,r){var a=n.getChildControl("tree").getModel().getNode().querySelector(e);if(a){n.__P_35_4=[a];n.__P_35_5=0;n.__P_35_7();t&&n._onEdit();i(!0)}else i(!1)}))},_onSearch:function(e){var t=e.getData();this.__P_35_4=[];this.__P_35_5=0;if(t.length>2){var n=this.getChildControl("tree").getModel().getNode();this.__P_35_4=Array.from(n.querySelectorAll("*")).filter((function(e){return e.tagName.startsWith(t)||e.hasAttribute("name")&&e.getAttribute("name").startsWith(t)}));this.__P_35_7()}},_showNextResult:function(){if(this.__P_35_4&&this.__P_35_4.length>this.__P_35_5+1){this.__P_35_5++;this.__P_35_7()}},_showPreviousResult:function(){if(this.__P_35_4&&this.__P_35_5>0){this.__P_35_5--;this.__P_35_7()}},__P_35_7:function(){if(this.__P_35_4.length>this.__P_35_5){var e=this.__P_35_4[this.__P_35_5],t=this.getChildControl("tree");if(e.$$widget){t.openNodeAndParents(e.$$widget);t.getSelection().replace([e.$$widget])}else{for(var n=e,i=[];n&&!n.$$widget;)(n=n.parentElement)&&i.push(n);if(n&&n.$$widget){n.$$widget.load();for(var r=i.length-1;r>=0;r--){var a=i[r].$$widget;a&&a.load()}if(e.$$widget){t.openNodeAndParents(e.$$widget);t.getSelection().replace([e.$$widget])}}}}},_initDragDrop:function(e){var t,n=this;e.addListener("dragstart",(function(e){var i,r=e.getDragTarget();if(r instanceof cv.ui.manager.tree.VirtualElementItem){(i=r.getModel()).setDragging(!0);if(!i.isEditable()||!i.isDeletable()){e.preventDefault();e.stopPropagation();return}e.addAction("copy");i.isDeletable()&&e.addAction("move");e.addType("cv/tree-element");e.addData("cv/tree-element",i);t=i}n.setDragging(!0)}));var i=this.getChildControl("add-button");i.addListener("dragstart",(function(e){e.addAction("copy");e.addType("cv/new-tree-element");n.setDragging(!0)}));var r=cv.ui.manager.editor.Tree.Allowed,a={mode:0,target:null};e.addListener("dragover",(function(t){var i,o=t.getCurrentAction();t.supportsType("cv/tree-element")&&(i=t.getData("cv/tree-element"));var s="copy"===o&&!i&&t.supportsType("cv/new-tree-element"),c=t.getTarget();if(c!==l){if("copy"!==o&&c&&c instanceof cv.ui.manager.tree.VirtualElementItem){if(c.getModel()===i){n.debug("dropping on same element forbidden");a.mode=r.NONE;t.preventDefault();return}if(i&&i.isAncestor(c.getModel())){n.debug("moving inside own subtree forbidden");a.mode=r.NONE;t.preventDefault();return}}if(c===e){var u=e.getPane().getLayers()[0].getContentLocation();if(u&&t.getDocumentTop()-u.bottom<=20){var d=document.elementFromPoint(Math.round((u.left+u.right)/2),u.bottom-20);if(c=qx.ui.core.Widget.getWidgetByElement(d))for(;c.isAnonymous();)c=c.getLayoutParent()}else c=null;if(!c||c===e){a.mode=r.NONE;t.preventDefault();n.debug("drop target not found");return}}if(s||i){var h=c.getModel(),g=h.getParent();a.target=h;if(g){var m=g.getSchemaElement();if(s){var f=m.getAllowedElements();if(Object.keys(f).length>0){var p=g.getAddableChildren();if(p.length>0)if(m.areChildrenSortable())a.mode=r.BEFORE|r.AFTER;else{var _=r.NONE,v=m.getAllowedElementsSorting();p.some((function(e){return!!((_|=n.__P_35_8(v,e,h.getName()))&r.BEFORE&&_&r.AFTER)}));a.mode=_}}else{t.preventDefault();a.mode=r.NONE;n.debug("no children allowed here")}}else if(m.isChildElementAllowed(i.getName()))m.areChildrenSortable()?a.mode=r.BEFORE|r.AFTER:a.mode=n.__P_35_8(m.getAllowedElementsSorting(),i.getName(),h.getName());else{a.mode=r.NONE;n.debug("not allowed as child element of",g.getName())}}else a.mode=r.NONE;if(s?Object.keys(h.getSchemaElement().getAllowedElements(!0)).length>0:h.getSchemaElement().isChildElementAllowed(i.getName())){a.mode|=r.INSIDE;if(h.getSchemaElement().areChildrenSortable())a.mode|=r.FIRST_CHILD;else{var b=h.getSchemaElement().getFirstLevelElementSorting();if(b)if(i){var x=b[i.getName()];if(void 0!==x)if(0===x||0===h.getChildren().length)a.mode|=r.FIRST_CHILD;else{b[h.getChildren().getItem(0).getName()]>=x&&(a.mode|=r.FIRST_CHILD)}}else if(h.getChildren().length>0){var y=b[h.getChildren().getItem(0).getName()];void 0!==y&&y>0&&(a.mode|=r.FIRST_CHILD)}else Object.keys(b).length>0&&(a.mode|=r.FIRST_CHILD)}}if(a.mode===r.NONE){t.preventDefault();n.debug("dropping not accepted here")}}else{n.debug("drop not allowed here, no drag element");a.mode=r.NONE;t.preventDefault()}}else n.debug("dragging over indicator")}));var o,s,l=this.getChildControl("drag-indicator");e.addListener("dragleave",(function(e){if(o){o.stop();o=null}}));var c=e.getPane(),u=function(t){var n=-1e3,i=-1e3,u="",d=t.getManager().getCursor();d||(d=qx.ui.core.DragDropCursor.getInstance());"touch"===t._native.pointerType&&(d.hasState("touch")||d.addState("touch"));if(a.mode!==r.NONE){var h=document.elementFromPoint(t.getDocumentLeft(),t.getDocumentTop()),g=qx.ui.core.Widget.getWidgetByElement(h),m=!1;if(!g)return;for(;g.isAnonymous();)g=g.getLayoutParent();var f=g.getContentLocation(),p=f.left;if(g instanceof cv.ui.manager.tree.VirtualElementItem){p=g._getChildren()[0].getWidth()+g.getPaddingLeft();l.setWidth(g.getBounds().width-p);a.target&&g.getModel()!==a.target&&(m=!0);s=g}else{if(g===l)return;if(g===c){var _=s.getContentLocation();if(t.getDocumentTop()-_.bottom<=20&&a.mode&r.AFTER){n=s._getChildren()[0].getWidth()+s.getPaddingLeft();i=_.bottom;u="after"}m=!0}else m=!0}if(!m)if(t.getDocumentTop()-f.top<=5){if(o){o.stop();o=null}if(a.mode&r.BEFORE){n=p;i=f.top;u="before"}else if(a.mode&r.INSIDE){n=-1e3;i=-1e3;u="inside"}}else if(f.bottom-t.getDocumentTop()<=5){if(a.target&&!a.target.isOpen()){if(a.mode&r.AFTER){n=p;i=f.bottom;u="after"}else if(a.mode&r.INSIDE){n=-1e3;i=-1e3;u="inside"}}else if(a.mode&r.FIRST_CHILD){n=p+19;l.setWidth(l.getWidth()-19);i=f.bottom;u="first-child"}else this.debug("not allowed as first child");if(o){o.stop();o=null}}else if(a.target&&a.target.isOpen()){if(a.mode&r.FIRST_CHILD){if("first-child"!==l.getUserData("position")){n=p+19;l.setWidth(l.getWidth()-19)}i=f.bottom;u="first-child"}}else{l.setDomPosition(-1e3,-1e3);a.mode&r.INSIDE&&(u="inside");o||(o=qx.event.Timer.once((function(){a.target&&e.openNode(a.target)}),this,1e3))}}l.setDomPosition(n,i);l.setUserData("position",u);if(!u&&d.getAction()){l.setUserData("action",t.getCurrentAction());d.resetAction();console.assert(n<0);console.assert(i<0)}else if(u&&!d.getAction()&&d.getAction()!==l.getUserData("action")){d.setAction(l.getUserData("action"));l.setUserData("action",null)}};e.addListener("drag",u,this);i.addListener("drag",u,this);var d=function(e){var t=e.getCurrentAction(),n=e.supportsType("cv/tree-element")?e.getData("cv/tree-element"):null;"copy"===t&&(n?n=n.clone():t="add");var i=n?n.getDisplayName():"new",o=a.target;if("move"!==t||n!==o)switch(l.getUserData("position")){case"after":if(a.mode&r.AFTER){this.debug(t,i,"after",o.getDisplayName());switch(t){case"move":n.moveAfter(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved after "%2"',i,o.getDisplayName()));break;case"copy":n.insertAfter(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied after "%2"',i,o.getDisplayName()));break;case"add":this._onCreate(o,l.getUserData("position"))}}else this.debug("NOT ALLOWED",t,i,"after",o.getDisplayName());break;case"before":if(a.mode&r.BEFORE){this.debug(t,i,"before",o.getDisplayName());switch(t){case"move":n.moveBefore(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved before "%2"',i,o.getDisplayName()));break;case"copy":n.insertBefore(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied before "%2"',i,o.getDisplayName()));break;case"add":this._onCreate(o,l.getUserData("position"))}}else this.debug("NOT ALLOWED",t,i,"after",o.getDisplayName());break;case"first-child":if(a.mode&r.FIRST_CHILD){this.debug(t,i,"into",o.getDisplayName(),"as first child");switch(t){case"move":n.moveBefore(o.getChildren().getItem(0))&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved into "%2" as first child',i,o.getDisplayName()));break;case"copy":n.insertBefore(o.getChildren().getItem(0))&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied into "%2" as first child',i,o.getDisplayName()));break;case"add":this._onCreate(o,l.getUserData("position"))}}else this.debug("NOT ALLOWED",i,"into",o.getDisplayName()+" as first child");break;case"inside":if(a.mode&r.INSIDE){this.debug(t,i,"into",o.getDisplayName(),"as child");switch(t){case"move":n.moveInside(o)&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been moved into "%2"',i,o.getDisplayName()));break;case"copy":o.insertChild(n,-1,!1,"added")&&cv.ui.manager.snackbar.Controller.info(this.tr('"%1" has been copied into "%2"',i,o.getDisplayName()));break;case"add":this._onCreate(o,l.getUserData("position"))}}else this.debug("NOT ALLOWED",i,"into",o.getDisplayName(),"as child")}}.bind(this);e.addListener("drop",d,this);l.addListener("drop",d,this);var h=function(e){l.setDomPosition(-1e3,-1e3);l.resetUserData();if(o){o.stop();o=null}if(t){t.resetDragging();t=null}a.target=null;a.mode=0;var n=e.getManager().getCursor();n||(n=qx.ui.core.DragDropCursor.getInstance());n.hasState("touch")&&n.removeState("touch");this.setDragging(!1)};e.addListener("dragend",h,this);i.addListener("dragend",h,this)},_onCreate:function(e,t,n){var i=this,r="inside"===t||"first-child"===t?e:e.getParent(),a=r.getSchemaElement(),o=r.getAddableChildren(!1);if(o.length>0){var s=r.getChildren();if(!a.areChildrenSortable()&&"inside"!==t&&s.length>0){var l=a.getFirstLevelElementSorting(),c=0,u=0;if("before"===t){u=l[e.getName()];var d=s.indexOf(e);if(d>0){for(var h=!1,g=d-1;g>=0;g--){var m=s.getItem(g);if(!m.getName().startsWith("#")&&m.getName()!==e.getName()){c=l[m.getName()];h=!0;break}}h||(c=u)}}else if("after"===t){c=l[e.getName()];var f=s.indexOf(e);if(f<s.length-1){for(var p=!1,_=f;_<s.length;_++){var v=s.getItem(_);if(!v.getName().startsWith("#")&&v.getName()!==e.getName()){u=l[v.getName()];p=!0;break}}p||(u=c)}else u=c+1}else if("first-child"===t){var b=s.getItem(0);u=l[b.getName()]}o=o.filter((function(e){return Object.prototype.hasOwnProperty.call(l,e)&&l[e]<=u&&l[e]>=c}))}}if(o.length>0){this.__P_35_3=!0;(o.length>1?new cv.ui.manager.form.ElementForm({allowCancel:!0,context:this,message:this.tr("<p style='font-weight:bold'>Choose element</p><p>Several possible element can be created at this position, please select one to proceed.</p>"),formData:{type:{type:"SelectBox",label:this.tr("Choose element"),help:this.tr("Please choose the element you want to add here."),options:o.sort((function(e,t){return e.startsWith("#")&&!t.startsWith("#")?1:!e.startsWith("#")&&t.startsWith("#")?-1:e.localeCompare(t)})).map((function(e){return{label:e,value:e}})),validation:{required:!0}}}}).show().promise():Promise.resolve({type:o[0]})).then((function(n){if(n){var o,s=n.type,l=e.getNode().ownerDocument,c=!1;switch(s){case"#comment":o=l.createComment("");break;case"#text":o=l.createTextNode("");break;case"#cdata-section":o=l.createCDATASection("");break;default:o=l.createElement(s);c=!0}var u=a.getSchemaElementForElementName(s);c&&function e(t,n){var i=n.getRequiredElements();if(i.length>1&&!n.areChildrenSortable()){var r=n.getAllowedElementsSorting();i.sort(cv.ui.manager.model.schema.Element.sortChildNodes(r))}i.forEach((function(i){var r=l.createElement(i);t.appendChild(r);e(r,n.getSchemaElementForElementName(i))}));if(n.isTextContentRequired()){var a=l.createTextNode("-");t.appendChild(a)}}(o,u);var d=new cv.ui.manager.model.XmlElement(o,u,e.getEditor(),r);d.load();var h=Promise.resolve(!0);d.isShowEditButton()&&(h=i._onEdit(null,d,!0));h.then((function(n){if(n){switch(t){case"before":d.insertBefore(e);break;case"after":d.insertAfter(e);break;case"inside":e.insertChild(d,-1,!1,"added");break;case"first-child":e.insertChild(d,0,!1,"added")}i.getChildControl("tree").openNodeAndParents(d);i.getChildControl("tree").setSelection([d])}}),i).catch((function(e){return i.error(e)}))}}))}},__P_35_8:function(e,t,n,i){if(e){var r=e[t];r="string"==typeof r?r.split(".").map((function(e){return/^\d+$/.test(e)?parseInt(e):e})):[r];var a=e[n];a="string"==typeof a?a.split(".").map((function(e){return/^\d+$/.test(e)?parseInt(e):e})):[a];for(var o=Math.min(o||1,r.length,a.length),s=0;s<o;s++){if(r[s]===a[s])return cv.ui.manager.editor.Tree.Allowed.BEFORE|cv.ui.manager.editor.Tree.Allowed.AFTER;if(r[s]-1===a[s])return cv.ui.manager.editor.Tree.Allowed.AFTER;if(r[s]+1===a[s])return cv.ui.manager.editor.Tree.Allowed.BEFORE}}return cv.ui.manager.editor.Tree.Allowed.NONE},__P_35_9:function(e,t,n){var i=this,r=cv.ui.manager.editor.data.Provider.get(e);if(r){"function"==typeof r.getLive?t.options=r.getLive(n):r.data?t.options=r.data:this.error("misconfigured provider found for "+e);t.type=r.userInputAllowed?"VirtualComboBox":"VirtualSelectBox"}else if(["mapping","styling"].includes(e.split("@").pop())){var a=e.split("@").pop(),o=this.getChildControl("tree").getModel().getNode();t.type="SelectBox";t.options=[];var s="tile"===this._structure?"cv-meta > cv-"+a:"meta > "+a+"s > "+a;o.querySelectorAll(s).forEach((function(e){var n=e.getAttribute("name");t.options.push({label:n,value:n})}))}if(t.type.endsWith("SelectBox")){delete t.placeholder;t.validation.required||(t.options instanceof Promise?t.options.then((function(e){Array.isArray(e)&&e.unshift({label:" - "+i.tr("not set")+" - ",value:""})})).catch((function(){})):t.options.unshift({label:" - "+this.tr("not set")+" - ",value:""}))}},__P_35_10:function(e,t){var n=t.getDocumentation(),i={type:"TextField",label:t.getName(),placeholder:" - "+this.tr("not set")+" - ",help:n.join("<br/>"),enabled:e.isEditable(),value:e.getAttribute(t.getName())||t.getDefaultValue(),validation:{required:!t.isOptional(),validator:function(e){e instanceof qx.ui.form.ListItem&&(e=e.getModel().getValue());if(!t.isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}};switch(t.getTypeString()){case"boolean":i.type="CheckBox";i.value=""===i.value||null===i.value||void 0===i.value?null:"true"===i.value;delete i.placeholder;break;case"string":var r=t.getEnumeration();if(r.length>0){i.type="SelectBox";delete i.placeholder;i.options=[];r.forEach((function(e){i.options.push({label:e,value:e})}));t.isOptional()&&i.options.unshift({label:" - "+this.tr("not set")+" - ",value:""})}else this.__P_35_9(e.getName()+"@"+t.getName(),i,e.getNode())}return i},_onEdit:function(e,t,n){var i,r,a=this;if(!this.getFile()||!this.getFile().isWriteable())return null;if(!t){if(!this.getSelected())return null;t=this.getSelected()}if(!t.getShowEditButton())return null;t.load();var o={},s=t.getSchemaElement();if(n){i=this.tr("Create new %1 element",t.getName());r=this.tr("Please edit the attributes of the new %1 element, that will be added to the chosen position.",t.getName())}else{i=this.tr("Edit element attributes");r=t.isEditable()?this.tr("Edit %1",t.getName()):this.tr("Show %1",t.getName())}if(t.getNode().nodeType===Node.ELEMENT_NODE){var l=s.getAllowedAttributes();Object.keys(l).forEach((function(e){var n=l[e];if(!a.getExpert()){if(n.getAppinfo().includes("level:expert"))return}o[e]=a.__P_35_10(t,n)}));if(s.isChildElementAllowed("*")){var c=new DOMParser,u="custom"===t.getNode().nodeName?"#innerHTML":"#outerHTML";if(n){i=this.tr("Create new %1 element",t.getName());r=this.tr("Please edit the content of the new %1 element, that will be added to the chosen position.",t.getName())}else i="#outerHTML"===u?this.tr("Edit element and content"):this.tr("Edit element content");o[u]={type:"TextArea",label:"",lines:5,autoSize:!0,width:Math.min(qx.bom.Viewport.getWidth(),500),enabled:t.isEditable(),value:"#outerHTML"===u?t.getNode().outerHTML:t.getNode().innerHTML,validation:{validator:function(e){if(e){if(c.parseFromString(e,"text/xml").getElementsByTagName("parsererror").length>0)throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}}}}}else if(t.getNode().nodeType===Node.TEXT_NODE||t.getNode().nodeType===Node.COMMENT_NODE||t.getNode().nodeType===Node.CDATA_SECTION_NODE){i=this.tr("Edit text content",t.getName());r="";var d=t.getNode().nodeName,h=s.getDocumentation();o[d]={type:"TextArea",label:"",lines:1,autoSize:!0,width:Math.min(qx.bom.Viewport.getWidth(),500),placeholder:this.tr("not set"),help:h.join("<br/>"),enabled:t.isEditable(),value:t.getTextContent(),validation:{validator:function(e){e instanceof qx.ui.form.ListItem&&(e=e.getModel().getValue());if(!s.isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("This is not a valid value."))}}};if(t.isTextNode()){var g="",m=t.getParent(),f=!1;switch(m.getName()){case"status":f="html"===(g=t.getParent().getAttribute("type"))||"xml"===g;break;case"style":g="css";f=!0;break;case"dataset":m.getAttribute("src").startsWith("flux://")&&(g="flux")}if(f&&t.getNode().nodeType===Node.TEXT_NODE){t.convertTextNodeType(Node.CDATA_SECTION_NODE);var p=t.getNode().nodeName;o[p]=o[d];delete o[d];d=p}if(g&&cv.ui.manager.editor.Source.SUPPORTED_FILES("test."+g)){o[d].type="SourceEditor";o[d].language=g;o[d].width=Math.min(qx.bom.Viewport.getWidth(),800);delete o[d].placeholder}}this.__P_35_9(t.getParent().getName()+"@"+t.getName(),o[d],t.getNode())}this.__P_35_3=!0;var _=new cv.ui.manager.form.ElementForm({allowCancel:!0,context:this,caption:i,message:r,formData:o,minWidth:Math.min(qx.bom.Viewport.getWidth(),400),maxWidth:qx.bom.Viewport.getWidth()}).show();return _.promise().then((function(e){if(e&&t.isEditable()){t.setAttributes(e);a.clearReDos();Object.prototype.hasOwnProperty.call(e,"#outerHTML")||Object.prototype.hasOwnProperty.call(e,"#innerHTML")||t.validate()}a.__P_35_3=!1;_.destroy();return e}))},_onDelete:function(e,t){t||(t=this.getSelected());if(t&&t.isDeletable()){t.remove();this.clearReDos();return t}return null},_onCut:function(){if(this.__P_35_3)document.execCommand("cut");else{var e=this._onDelete();e&&this.setClipboard(e)}},_onCopy:function(){if(this.__P_35_3)document.execCommand("copy");else{var e=this.getSelected();if(e){var t=e.clone();this.setClipboard(t)}}},_onPaste:function(){var e=this.getSelected(),t=this.getClipboard();e&&t&&e.insertChild(t,-1,!1,"added")&&this.resetClipboard()},updateModified:function(e){var t=this.__P_35_0.indexOf(e),n=this.__P_35_1.indexOf(e);if(e.$$removed){t>=0&&this.__P_35_0.splice(t,1);n>=0&&this.__P_35_1.splice(t,1)}else if(e.isModified()){-1===t&&this.__P_35_0.push(e);-1===n&&this.__P_35_1.push(e)}else{t>=0&&this.__P_35_0.splice(t,1);n>=0&&this.__P_35_1.splice(t,1)}this.getFile().setModified(this.__P_35_0.length>0);this._onContentChanged()},_draw:function(){var e=this.getChildControl("toolbar");this._createChildControl("searchbar");this.hasChildControl("add-button")||this._createChildControl("add-button");e.addSeparator();this._createChildControl("edit-button");this._createChildControl("delete-button");e.addSeparator();this._createChildControl("toggle-expert");e.addSpacer();this._createChildControl("refresh-preview");this.hasChildControl("tree")||this._createChildControl("tree");this.hasChildControl("right")||this._createChildControl("right");this.hasChildControl("preview-sync-hint")||this._createChildControl("preview-sync-hint");this.hasChildControl("preview")||this._createChildControl("preview")},_applySelected:function(e,t){t&&t.removeRelatedBindings(this.getChildControl("delete-button"));if(e){this.getChildControl("edit-button").setEnabled(e.getShowEditButton());this.getFile().isWriteable()&&e.bind("deletable",this.getChildControl("delete-button"),"enabled")}else{this.getChildControl("edit-button").setEnabled(!1);this.getChildControl("delete-button").setEnabled(!1)}this._updateHighlightWidget()},_updateHighlightWidget:function(){var e=this.getSelected();if(this.isShowPreview()){var t=this.getChildControl("preview");if("structureChanged"!==this.getPreviewState()&&e){var n=[],i=e.getNode();if("tile"===this._structure)for(;i&&"config"!==i.nodeName;){if("cv-page"===i.nodeName){t.openPage(i.getAttribute("id"));break}i=i.parentNode}else{for(;i&&"pages"!==i.nodeName;){"page"===i.nodeName&&n.unshift(i.getAttribute("name"));i=i.parentNode}n.length>0&&t.openPage(n.pop(),n.join("/"))}t.setHighlightWidget(e.getWidgetPath())}else t.setHighlightWidget(null)}},_onElementKeyUp:function(e){this.getSelected()&&this.isVisible()&&"Enter"===e.getKeyIdentifier()&&(this.__P_35_3||this._onEdit())},_applyContent:function(e){var t=this,n=this.getChildControl("tree"),i=this.getFile();this._updatePreview(null,null,!0);if(e&&i){if(this._workerWrapper){this._workerWrapper.open(i,e,null,{validate:!1,initialValidation:!0,modified:!1});this._workerWrapper.validateXmlConfig(e).then((function(n){if(!0===n){t.info(i.getPath()+" is a valid config file");t.__P_35_11(e)}else{var r=new cv.ui.manager.dialog.ValidationError(i,e,n);r.addListener("action",(function(i){switch(i.getData()){case"proceed":t.__P_35_11(e,n);break;case"open-source":var a=t.getFile();cv.ui.manager.Main.getInstance().closeFile(a);qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:a.getFullPath(),handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}});break;case"cancel":cv.ui.manager.Main.getInstance().closeFile(t.getFile())}r.hide();r.destroy()}));r.show()}}))}}else{n.resetModel();this.hasChildControl("add-button")&&this.getChildControl("add-button").setEnabled(!1)}},__P_35_6:function(){var e;cv.ui.manager.model.FileItem.ROOT.getChildren().some((function(t){if("visu_config_previewtemp.xml"===t.getName()){e=t;return!0}return!1}));e||(e=new cv.ui.manager.model.FileItem("visu_config_previewtemp.xml","/",cv.ui.manager.model.FileItem.ROOT)).setTemporary(!0);return e},__P_35_11:function(e,t){var n=this;return _asyncToGenerator(_regeneratorRuntime().mark((function i(){var r,a,o,s,l,c,u,d;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=n.getChildControl("tree");if(!(a=n.getFile())){i.next=20;break}o=qx.xml.Document.fromString(e);s=o.documentElement;i.next=7;return n.getSchema(s.getAttributeNS("http://www.w3.org/2001/XMLSchema-instance","noNamespaceSchemaLocation"));case 7:l=i.sent;c=l.getElementNode(s.nodeName);u=new cv.ui.manager.model.XmlElement(s,c,n);n._structure=l.getStructure();u.setEditable(a.getWriteable());u.load();r.setModel(u);if(n.hasChildControl("add-button")){n.getChildControl("add-button").setVisibility(a.getWriteable()?"visible":"excluded");r.setContentPaddingBottom(a.getWriteable()?80:0)}if(n.isShowPreview()){d=n.getChildControl("preview");a.isWriteable()?d.getFile()||d.setFile(n.__P_35_6()):d.setFile(a);n._updatePreview(null,e);d.isVisible()||d.show()}a.isTemporary()&&n._onContentChanged();t&&t.forEach((function(e){if(e.path&&e.path.startsWith("/pages")){for(var t=u,i=e.path.substr(1).split("/");i.length>0;){var a=i.shift(),o=/^([^[]+)\[(\d+)\]$/.exec(a);if(!o){n.error("patch segment format error: "+a);t=null;break}if(!(t=t.getChildren().getItem(parseInt(o[2]))))break;try{t.load()}catch(e){n.error("Error loading "+t.getName()+": "+e.toString());t=null;break}}if(t){t.setValid(!1);t.validate(!1);r.openNodeAndParents(t)}}}));i.next=21;break;case 20:n._structure=null;case 21:case"end":return i.stop()}}),i)})))()},_onContentChanged:function(){var e=this.getCurrentContent();this._workerWrapper&&this._workerWrapper.contentChanged(this.getFile(),e);this.isAutoRefreshPreview()&&this.isShowPreview()&&this._updatePreview(null,e)},_updatePreview:function(e,t,n){var i=this,r=this.getChildControl("preview").getFile();if(r){if(t||n){if(!0===n){this.getChildControl("preview").hide();return}}else t=this.getCurrentContent(!0);this.getChildControl("preview").show();r.isTemporary()?this._client.createSync({path:r.getFullPath(),hash:"ignore"},t,(function(e){if(e){i.setShowPreview(!1);i.error(e);cv.ui.manager.snackbar.Controller.error(i.tr("Disabling preview because the preview file could not be created."))}else{qx.event.message.Bus.dispatchByName(r.getBusTopic(),{type:"contentChanged",file:r,data:t,source:i});i.__P_35_1.removeAll();i.resetPreviewState();r.resetTemporary()}}),this):this._client.updateSync({path:r.getFullPath(),hash:"ignore"},t,(function(e){if(e)cv.ui.manager.snackbar.Controller.error(e);else{qx.event.message.Bus.dispatchByName(r.getBusTopic(),{type:"contentChanged",file:r,data:t,source:i});i.__P_35_1.removeAll();i.resetPreviewState()}}),this)}},getCurrentContent:function(e){var t=this.getChildControl("tree");if(t.getModel()){var n=t.getModel().getNode();return e?(new XMLSerializer).serializeToString(n.ownerDocument):cv.util.Prettifier.xml(n.ownerDocument)}return null},_onSaved:function(){cv.ui.manager.editor.Tree.superclass.prototype._onSaved.call(this);this.__P_35_0.forEach((function(e){return e.onSaved()}));this.__P_35_0=[];this.clearUnDosReDos()},isSupported:function(e){return cv.ui.manager.editor.Tree.SUPPORTED_FILES.test(e.getName())},_showHelp:function(){var e=qx.ui.core.FocusHandler.getInstance().getFocusedWidget(),t={caption:this.tr("Help"),modal:!0,image:"qxl.dialog.icon.info",minWidth:Math.min(600,qx.bom.Viewport.getWidth()),maxHeight:qx.bom.Viewport.getHeight(),message:""};e===this.getChildControl("searchbar")?t.message=this.tr("<h3>Search for elements</h3><p>You can search for element names (tag names or content of name attribute) by typing a search value here. All elements whose tag name or name-attribute start with the search term will be found</p><p>Search will start automatically when the search term is at least 2 characters long.</p><p>The first found element will be opened and selected in the element tree. You can jump to the next found element with 'Enter' or the 'Down' key. Accordingly you can jump the the previous found element with the 'Up' key.</p>"):t.message=this.tr("<h3>CometVisu XML-Editor - a brief introduction</h3><p>The CometVisu XMl-Editor shows the content of a CometVisu config file in a tree-like structure. You can traverse through the tree by opening/closing elements with a click on the expand icon.</p><p>The Xml-Editor will make sure that you do not create an invalid configuration file. If you experience a change that has not been accepted / or is not allowed that is most likely due to avoid an invalid configuration.</p><h4>Editing attributes</h4><p>The elements attributes can be edited by double clicking on it or selecting an element and clicking on the 'edit'-button in the toolbar above the tree of by right-clicking on the element and the 'edit'-button in the context menu</p><h4>Editing elements</h4><p>The elements in the tree support re-ordering via drag & drop. You can also cut/copy or paste them. You can add new elements by starting a drag in the round + button on the bottom of the tree, or by right clicking on an element and choosing the 'add child'-button.</p><p>You can delete elements by the delete buttons in the toolbar</p><h4>Expert view</h4><p>Some attributes are hidden in the editing dialog, because they provide access to settings that usually are not needed that often. You can access these attributes by toggling to the 'Expertview'-button in the toolbar directly above the tree.</p><h4>Config preview</h4><p>An preview of the edited config file is shown on the right part of the screen. The preview will not automatically refresh after you have changed something. You can refresh is manually by clicking the most right button in the toolbar.</p>");new cv.ui.manager.dialog.BigAlert(t).show()}},destruct:function(){this._schemas=null;this._workerWrapper=null;this._disposeArray("__P_35_0","__P_35_1");qx.core.Init.getApplication().getRoot().removeListener("keyup",this._onElementKeyUp,this)}});cv.ui.manager.editor.Tree.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.Source":{construct:!0,require:!0},"qx.locale.Manager":{require:!0},"cv.theme.dark.Images":{usage:"dynamic",require:!0},"cv.ui.manager.model.CompareFiles":{},"cv.ui.manager.model.FileItem":{},"qx.event.message.Bus":{},"cv.ui.manager.snackbar.Controller":{},"cv.ui.manager.Main":{},"qxl.dialog.Dialog":{},"qx.bom.Viewport":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Diff",{extend:cv.ui.manager.editor.Source,construct:function(){cv.ui.manager.editor.Source.constructor.call(this)},statics:{COUNTER:0,TITLE:qx.locale.Manager.tr("File compare"),ICON:cv.theme.dark.Images.getIcon("compare",18)},properties:{originalContent:{check:"String",init:"",apply:"_applyContent"},modifiedContent:{check:"String",init:"",apply:"_applyContent"},editable:{check:"Boolean",init:!1,apply:"_applyEditable"}},members:{_applyEditable:function(e){this._editor&&this._editor.updateOptions({readOnly:!e})},_initWorker:function(){},_draw:function(){if(window.monaco){var e=this.getContentElement().getDomElement();if(e){this._editor=window.monaco.editor.createDiffEditor(e,{folding:!0,autoIndent:!0,automaticLayout:!0,theme:"vs-dark",readOnly:!this.getEditable()});this.getFile()&&this._loadFile(this.getFile())}else this.addListenerOnce("appear",this._draw,this)}else cv.ui.manager.editor.Source.load(this._draw,this)},_applyContent:function(){var e=this.getOriginalContent(),t=this.getModifiedContent();if(e&&t){var n=this.getFile(),i=n instanceof cv.ui.manager.model.CompareFiles?n.getOriginalFile():n,r=n instanceof cv.ui.manager.model.CompareFiles?n.getModifiedFile():n,a=window.monaco.editor.createModel(e,this._getLanguage(i));a.updateOptions(this._getDefaultModelOptions());var o=window.monaco.editor.createModel(t,this._getLanguage(r));o.updateOptions(this._getDefaultModelOptions());this._editor.setModel({original:a,modified:o})}},getCurrentContent:function(){return this._editor.getModifiedEditor().getValue()},clear:function(){this._editor.getModel().original.dispose();this._editor.getModel().modified.dispose()},save:function(e){var t=this.getHandlerOptions();this.getFile()instanceof cv.ui.manager.model.FileItem&&Object.prototype.hasOwnProperty.call(t,"upgradeVersion")&&!0===t.upgradeVersion&&cv.ui.manager.editor.Diff.superclass.prototype.save.call(this,e,"ignore")},_loadFile:function(e,t){t&&t instanceof cv.ui.manager.model.FileItem&&qx.event.message.Bus.unsubscribe(t.getBusTopic(),this._onChange,this);if(this._editor){var n=this.getHandlerOptions();if(e&&e instanceof cv.ui.manager.model.FileItem&&Object.prototype.hasOwnProperty.call(n,"upgradeVersion")&&!0===n.upgradeVersion){if(!e.isWriteable()){cv.ui.manager.snackbar.Controller.error(this.tr('"%1" is not writable. Upgrading not possible.',this.getFile().getFullPath()));cv.ui.manager.Main.getInstance().closeFile(e);return}qx.event.message.Bus.subscribe(e.getBusTopic(),this._onChange,this);this.setEditable(e.isWriteable());this._client.readSync({path:e.getFullPath()},(function(t,n){if(t)cv.ui.manager.snackbar.Controller.error(t);else{this.setOriginalContent(n);var i=this._upgradeConfig(n),r=_slicedToArray(i,3),a=r[0],o=r[1],s=r[2];if(a){qxl.dialog.Dialog.error(a);qx.event.message.Bus.dispatchByName("cv.manager.action.close")}else{this.setModifiedContent(this._convertToString(o));var l=s.length>0?"<div>"+qx.locale.Manager.tr("The following changes have been made")+"</div><ul><li>"+s.join("</li><li>")+"</li></ul><div>"+qx.locale.Manager.tr("You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.")+"</div>":"<div><strong>"+qx.locale.Manager.tr("No changes have been made")+"</strong></div>",c="<h3>"+qx.locale.Manager.tr("Config file has been upgraded to the current library version.").translate().toString()+"</h3>"+l+"<div>"+qx.locale.Manager.tr('Click "Apply" if you want to save the changes and reload the browser.')+"</div><div>"+qx.locale.Manager.tr('Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.')+"</div>";qxl.dialog.Dialog.confirm(c,(function(e){e&&this.save((function(){window.location.hash="";window.location.reload()}))}),this,qx.locale.Manager.tr("Upgrade successful")).set({width:Math.min(qx.bom.Viewport.getWidth(),600),yesButtonLabel:qx.locale.Manager.tr("Apply"),noButtonLabel:qx.locale.Manager.tr("Check")});e.setModified(!0)}}}),this)}else if(e&&e instanceof cv.ui.manager.model.CompareFiles&&this.isSupported(e.getModifiedFile())){this.resetEditable();this._client.readSync({path:e.getModifiedFile().getFullPath()},(function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setModifiedContent(t)}),this);this._client.readSync({path:e.getOriginalFile().getFullPath()},(function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):this.setOriginalContent(t)}),this)}else{this.resetOriginalContent();this.resetModifiedContent()}}}}});cv.ui.manager.editor.Diff.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.editor.AbstractEditor":{construct:!0,require:!0},"qx.ui.layout.VBox":{construct:!0},"qx.locale.Manager":{require:!0},"cv.io.rest.Client":{},"qxl.dialog.Dialog":{},"qx.event.message.Bus":{},"cv.ui.manager.model.config.Section":{},"cv.ui.manager.snackbar.Controller":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"qx.data.Array":{},"cv.ui.manager.form.SectionListItem":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Config",{extend:cv.ui.manager.editor.AbstractEditor,construct:function(){cv.ui.manager.editor.AbstractEditor.constructor.call(this);this._handledActions=["save"];this._setLayout(new qx.ui.layout.VBox(8));this._createChildControl("list");this._createChildControl("add-section")},statics:{TITLE:qx.locale.Manager.tr("Hidden configuration")},properties:{appearance:{refine:!0,init:"cv-editor-config"}},members:{_model:null,_listController:null,__P_33_0:0,_initClient:function(){this._client=cv.io.rest.Client.getConfigClient();this._client.addListener("getSuccess",this._onModelValueChange,this);this._client.addListener("updateSuccess",this._onSaved,this)},_loadFile:function(e){e&&this._client.get({section:"*",key:"*"})},_onModelValueChange:function(e){if(this.getFile()){var t=e.getData();Object.prototype.hasOwnProperty.call(t,"error")?qxl.dialog.Dialog.confirm(this.tr("Hidden configuration has a syntax error and could not be loaded, you can try to fix the problem in the text editor. Do you want to open the file in the text editor?"),(function(e){var t=this.getFile();qx.event.message.Bus.dispatchByName("cv.manager.action.close",t);e&&qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:t.getFullPath(),handler:"cv.ui.manager.editor.Source",handlerOptions:{jumpToError:!0}})}),this,qx.locale.Manager.tr("Hidden configuration error")):this.setContent(t)}},_applyContent:function(e){var t=this._listController.getModel();t.removeAll();this.__P_33_0=Object.keys(e).length;Object.keys(e).forEach((function(n){var i=new cv.ui.manager.model.config.Section(n);Object.keys(e[n]).forEach((function(t){i.addOption(t,e[n][t])}),this);t.push(i)}),this);this.__P_33_1()},getCurrentContent:function(){return this.getContent()},_onDeleteSection:function(e){if(this.getFile()&&this.getFile().isWriteable()){var t=e.getData();this._listController.getModel().remove(t);this.__P_33_1()}},__P_33_1:function(){var e=this.getFile();if(this.__P_33_0===this._listController.getModel().length){var t=this.getChildControl("list").getChildren().some((function(e){return e.isModified()}),this);e.setModified(t)}else e.setModified(!0)},save:function(){if(this.getFile()&&this.getFile().isWriteable()){var e=this._listController.getModel(),t=[],n=!0;e.forEach((function(e){var i=e.getName();if(t.includes(i)){n=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Section name duplicate: "%1".',i))}else t.push(i);var r=[];e.getOptions().forEach((function(e){var t=e.getKey();if(r.includes(t)){n=!1;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Option key duplicate: "%1" in section "%2".',t,i))}else r.push(t)}),this)}),this);if(n){var i={};this._listController.getModel().forEach((function(e){var t={};e.getOptions().forEach((function(e){t[e.getKey()]=e.getValue()}));i[e.getName()]=t}),this);this._client.saveSync(null,i,(function(e){if(e)cv.ui.manager.snackbar.Controller.error(this.tr("Saving hidden config failed with error %1 (%2)",e.status,e.statusText));else{cv.ui.manager.snackbar.Controller.info(this.tr("Hidden config has been saved"));this._onSaved()}}),this)}else cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Section is invalid and has not been saved."))}else cv.ui.manager.snackbar.Controller.info(this.tr("Hidden configuration file (hidden.php) not writeable"))},_createChildControlImpl:function(e){var t,n=this;switch(e){case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(new qx.data.Array,t);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.SectionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteSection,this);e.addListener("changeModified",this.__P_33_1,this)}.bind(this),bindItem:function(e,t,n){e.bindProperty("","model",null,t,n);this.bind("file.writeable",t,"readOnly",{converter:function(e){return!e}})}.bind(this)});this._add(t,{flex:1});break;case"buttons":t=new qx.ui.container.Composite(new qx.ui.layout.HBox(8));this._add(t);break;case"add-section":(t=new qx.ui.form.Button(this.tr("Add section"))).addListener("execute",(function(){n._listController.getModel().push(new cv.ui.manager.model.config.Section(""));n.__P_33_1()}));this.bind("file.writeable",t,"visibility",{converter:function(e){return e?"visible":"excluded"}});this.getChildControl("buttons").add(t)}return t||cv.ui.manager.editor.Config.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._disposeObjects("_model","_listController")}});cv.ui.manager.editor.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.data.FileWorker":{construct:!0},"cv.ui.manager.editor.AbstractEditor":{},"qx.xml.Document":{},"qx.log.Logger":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.Worker",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this._files={};this._worker=cv.data.FileWorker.getInstance();this._worker.addListener("message",this._onMessage,this)},properties:{editor:{check:"cv.ui.manager.editor.AbstractEditor",nullable:!0}},members:{_worker:null,_files:null,open:function(e,t,n,i){this._worker.postMessage(["openFile",{path:e.getFullPath(),code:qx.xml.Document.isXmlDocument(t)?t.documentElement.outerHTML:t,schema:n},i]);this._files[e.getFullPath()]=e},close:function(e){this._worker.postMessage(["closeFile",{path:e.getFullPath()}]);delete this._files[e.getFullPath()]},contentChanged:function(e,t){this._worker.postMessage(["contentChange",{path:e.getFullPath(),code:t}])},validateConfig:function(e){if(e.isConfigFile())return this._worker.validateConfig(e.getServerPath());qx.log.Logger.error(this,e.getFullPath()+" is no configuration file");return!0},validateXmlConfig:function(e){return this._worker.validateXmlConfig(e)},_onMessage:function(e){var t=e.getData().topic,n=e.getData().data,i=e.getData().path,r=this._files[i];if(r||"validationResult"===t){var a=this.getEditor();switch(t){case"modified":r.isTemporary()||r.setModified(n.modified);r.setHash(n.currentHash);break;case"hash":r.setHash(n);break;case"errors":r.setValid(!n||0===n.length);a&&a.showErrors(i,n);break;case"decorations":a&&a.showDecorations(i,n)}}else qx.log.Logger.error(this,"no file found for path "+i+" ignoring worker message for topic "+t)}},destruct:function(){this._worker.terminate();this._worker=null}});cv.ui.manager.editor.Worker.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"cv.ui.manager.upload.MDragUpload":{require:!0},"qx.ui.layout.Canvas":{construct:!0},"cv.ui.manager.model.Preferences":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.tree.FileSystem":{},"qxl.dialog.Dialog":{},"qx.lang.String":{},"qx.event.message.Bus":{},"cv.ui.manager.viewer.Image":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.theme.dark.Images":{},"qx.ui.basic.Atom":{},"qx.ui.basic.Label":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.form.Button":{},"cv.ui.manager.control.FileController":{},"qx.event.type.Tap":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileListItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],include:[cv.ui.manager.upload.MDragUpload],construct:function(e,t,n){qx.ui.core.Widget.constructor.call(this,e,t);var i=new qx.ui.layout.Canvas;i.setDesktop(!0);this._setLayout(i);n&&this.setModel(n);this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this);cv.ui.manager.model.Preferences.getInstance().addListener("changeDefaultConfigEditor",this._maintainFileActions,this);this.setUploadHint(this.tr("Drop the file here to replace the content."))},events:{action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0,check:"cv.ui.manager.model.FileItem"},showFileActions:{check:"Boolean",init:!1,apply:"_maintainFileActions"},label:{nullable:!0,check:"String",event:"changeLabel"},icon:{check:"String",nullable:!0,themeable:!0,event:"changeIcon"},gap:{check:"Integer",nullable:!1,event:"changeGap",themeable:!0,init:4},show:{init:"both",check:["both","label","icon"],themeable:!0,inheritable:!0,event:"changeShow"},iconPosition:{init:"left",check:["top","right","bottom","left","top-left","bottom-left","top-right","bottom-right"],themeable:!0,event:"changeIconPosition"},center:{init:!1,check:"Boolean",themeable:!0,event:"changeCenter"},acceptUpload:{init:null,nullable:!0,check:"String"},viewMode:{check:["list","preview"],init:"preview",apply:"_applyViewMode"}},members:{_uploadManager:null,_forwardStates:{focused:!0,selected:!0,dragover:!0,hovered:!0},_applyViewMode:function(){switch(this.getViewMode()){case"list":this.addState("list");this.getChildControl("atom").setLayoutProperties({left:10,top:0,bottom:0,right:null});this.getChildControl("bottom-bar").setLayoutProperties({top:0,bottom:0,right:0,left:null});break;case"preview":this.removeState("list");this.getChildControl("atom").setLayoutProperties({left:0,top:0,bottom:34,right:0});this.getChildControl("bottom-bar").setLayoutProperties({left:0,bottom:0,right:0,top:null})}},_onPointerOver:function(){this.addState("hovered")},_onPointerOut:function(){this.removeState("hovered")},_isDroppable:function(e){if(1===e.length){return"add-file"===this.getModel().getSpecial()||cv.ui.manager.tree.FileSystem.getMimetypeFromSuffix(this.getModel().getName().split(".").pop())===e[0].type}return!1},_onDrop:function(e){e.preventDefault();"add-file"===this.getModel().getSpecial()?cv.ui.manager.upload.MDragUpload.uploadFile(cv.ui.manager.upload.MDragUpload.getFiles(e)[0]):qxl.dialog.Dialog.confirm(this.tr("Do you really want to replace the '%1' with the uploaded files content?",this.getModel().getName()),(function(t){if(t){var n=cv.ui.manager.upload.MDragUpload.getFiles(e)[0];cv.ui.manager.upload.MDragUpload.uploadFile(n,this.getModel())}}),this);this._onStopDragging(e)},_applyModel:function(e){if(e&&"file"===e.getType()){var t=this.getChildControl("file-type");if(!e.isFake()){var n=e.getName();this.getChildControl("atom").setToolTipText(this.tr('Double click to open "%1"',n));var i=n.split(".").pop();if(i.length<=4){var r=!1;switch(i){case"xml":t.setValue("</>");r=!0;break;case"js":i=qx.lang.String.firstUp(i);case"css":case"conf":t.setValue(i);r=!0}r&&"preview"===this.getViewMode()?t.show():t.exclude()}else t.exclude()}}else{this.getChildControl("file-type").exclude();this.getChildControl("atom").resetToolTipText()}this._maintainFileActions()},_onOpenWith:function(e){var t=e.getTarget().getUserData("handlerId");qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:this.getModel(),handler:t})},_applyIcon:function(e,t){cv.ui.manager.form.FileListItem.superclass.prototype._applyIcon.call(this,e,t);if(e&&!e.startsWith("@")){var n=this.getChildControl("atom").getChildControl("icon");cv.ui.manager.viewer.Image.getImageData(e)?this.__P_39_0():n.addListenerOnce("loaded",this.__P_39_0,this)}},_maintainFileActions:function(){var e=this.getModel();if(this.isShowFileActions()&&e){this.getChildControl("download-button").setVisibility("dir"===e.getType()||e.isFake()?"excluded":"visible");this.getChildControl("action-button").setVisibility(e.isFake()?"excluded":"visible");var t=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"edit"),n=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,"view"),i=this.getChildControl("open-button"),r=this.getChildControl("edit-button");if(e.isWriteable()&&t){r.setUserData("handlerId",t.Clazz.classname);r.set({icon:t.Clazz.ICON||cv.theme.dark.Images.getIcon("edit",18),enabled:!0,toolTipText:t.Clazz.TITLE?t.Clazz.TITLE.translate().toString():""});r.show()}else r.exclude();if(n){i.setUserData("handlerId",n.Clazz.classname);i.set({icon:n.Clazz.ICON||cv.theme.dark.Images.getIcon("preview",18),enabled:!0,toolTipText:n.Clazz.TITLE?n.Clazz.TITLE.translate().toString():""});i.show()}else i.exclude();this.getChildControl("action-button");this.getChildControl("bottom-bar").show()}else this.getChildControl("bottom-bar").exclude()},__P_39_0:function(){var e=cv.ui.manager.viewer.Image.getImageData(this.getIcon()),t=this.getChildControl("atom").getChildControl("icon"),n=t.getSizeHint(),i=n.width,r=Math.round(1/e.aspectRatio*i),a=[0,0,0,0];if(r>n.height){r=n.height;i=Math.round(e.aspectRatio*r);a[1]=Math.round((n.width-i)/2);a[3]=a[1]}else{a[0]=Math.round((n.height-r)/2);a[2]=a[0]}t.setPadding(a)},_maintainFileTypePosition:function(){var e=this.getChildControl("atom").getChildControl("icon").getBounds(),t=Math.round(e.top+e.height/2);this.getChildControl("file-type").setLayoutProperties({left:e.left,top:t,right:e.left+e.width,bottom:t+18})},_createChildControlImpl:function(e){var t,n=this;switch(e){case"atom":t=new qx.ui.basic.Atom;["label","icon","gap","iconPosition","show","center"].forEach((function(e){this.bind(e,t,e)}),this);t.setAnonymous(!0);this._add(t,{top:0,left:0,right:0,bottom:34});break;case"file-type":(t=new qx.ui.basic.Label).set({zIndex:100,anonymous:!0,font:"title",textAlign:"center",textColor:"surface",minWidth:70});var i=this.getChildControl("atom").getChildControl("icon");i.bind("visibility",t,"visibility");i.addListener("resize",this._maintainFileTypePosition,this);this._add(t,{width:"100%"});break;case"bottom-bar":(t=new qx.ui.container.Composite(new qx.ui.layout.HBox(4,"center"))).setAnonymous(!0);this._add(t,{left:0,bottom:0,right:0});break;case"download-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("download",18))).setToolTipText(this.tr("Download file"));t.addListener("execute",(function(){cv.ui.manager.control.FileController.getInstance().download(n.getModel())}));this.getChildControl("bottom-bar").add(t);break;case"action-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("menu",18))).setToolTipText(this.tr("Other file actions"));this.getChildControl("bottom-bar").add(t);t.addListener("tap",(function(e){n.fireEvent("action",qx.event.type.Tap,[e.getNativeEvent(),n,e.getTarget(),!1,!0])}));break;case"open-button":case"edit-button":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("preview",18))).addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.openWith",{file:n.getModel(),handler:t.getUserData("handlerId")})}));this.getChildControl("bottom-bar").add(t)}t||(t=this._createMDragUploadChildControlImpl(e));return t||cv.ui.manager.form.FileListItem.superclass.prototype._createChildControlImpl.call(this,e)},capture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.superclass.prototype.capture.call(this)},releaseCapture:function(){this.getFile()&&"add-file"===this.getFile().getSpecial()||cv.ui.manager.form.FileListItem.superclass.prototype.releaseCapture.call(this)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this);this._disposeObjects("_uploadManager");cv.ui.manager.model.Preferences.getInstance().removeListener("changeDefaultConfigEditor",this._maintainFileActions,this)}});cv.ui.manager.form.FileListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.toolbar.ToolBar":{construct:!0,require:!0},"cv.ui.manager.MenuBar":{construct:!0},"cv.ui.manager.model.FileItem":{},"cv.ui.manager.upload.UploadMgr":{},"cv.ui.manager.control.FileController":{},"qx.ui.toolbar.Part":{},"qx.ui.toolbar.MenuButton":{},"cv.theme.dark.Images":{},"qx.event.message.Bus":{},"qx.ui.toolbar.Button":{},"qx.locale.Manager":{},"qx.ui.core.Spacer":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.ToolBar",{extend:qx.ui.toolbar.ToolBar,construct:function(e,t){qx.ui.toolbar.ToolBar.constructor.call(this);t&&(this.__P_28_0=t);this._menuBar=cv.ui.manager.MenuBar.getInstance();this._menuButtonConfig=this._menuBar.getButtonConfiguration();this._uploadManager=e;this._init()},events:{reload:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"cv-toolbar"},folder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFolder",event:"changeFolder"},file:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyFile",event:"changeFile"}},members:{_menuButtonConfig:null,_uploadManager:null,_menuBar:null,__P_28_0:null,__P_28_1:function(e){return null===this.__P_28_0||this.__P_28_0.includes(e)},_init:function(){var e=this;this._uploadManager||(this._uploadManager=new cv.ui.manager.upload.UploadMgr);var t,n=cv.ui.manager.control.FileController.getInstance(),i=new qx.ui.toolbar.Part;i.set({marginLeft:0});this.add(i);if(this.__P_28_1("new-menu")){t=new qx.ui.toolbar.MenuButton(null,cv.theme.dark.Images.getIcon("new-file",15),this._menuBar.getChildControl("new-menu"));this.bind("folder.writeable",t,"enabled");i.add(t)}else{if(this.__P_28_1("new-config-file")){t=this._createButton("new-config-file",cv.theme.dark.Images.getIcon("new-file",15));this.bind("folder.writeable",t,"enabled");this.bind("folder",t,"visibility",{converter:function(e){return e===cv.ui.manager.model.FileItem.ROOT?"visible":"excluded"}});t.addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-config-file",e.getFolder())}));i.add(t)}else if(this.__P_28_1("new-file")){t=this._createButton("new-file",null,!0);this.bind("folder.writeable",t,"enabled");t.addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-file",e.getFolder())}));i.add(t)}if(this.__P_28_1("new-folder")){t=this._createButton("new-folder",cv.theme.dark.Images.getIcon("new-folder",15),!0);this.bind("folder.writeable",t,"enabled");t.addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action.new-folder",e.getFolder())}));i.add(t)}}if(this.__P_28_1("upload")){var r=this._createButton("upload");this._uploadManager.addWidget(r);this.bind("folder.writeable",r,"enabled");i.add(r)}if(this.__P_28_1("delete")){var a=this._createButton("delete");a.addListener("execute",(function(){n.delete(e.getFile())}));this.bind("file",a,"enabled",{converter:function(e){return!!e&&e.isWriteable()&&!e.isFake()}});this.add(a)}if(this.__P_28_1("download")){var o=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("download",15));o.setAppearance("cv-toolbar-button");o.setToolTipText(qx.locale.Manager.tr("Download"));o.addListener("execute",(function(){n.download(e.getFile())}));this.bind("file",o,"enabled",{converter:function(e){return!!e&&"file"===e.getType()&&!e.isFake()}});i.add(o)}if(this.__P_28_1("validate")){var s=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("validate",15));s.setAppearance("cv-toolbar-button");s.setToolTipText(qx.locale.Manager.tr("Validate"));s.addListener("execute",(function(){n.validate(e.getFile())}));this.bind("file",s,"enabled",{converter:function(e){return!!e&&e.isConfigFile()}});this.add(s)}if(this.__P_28_1("reload")){var l=new qx.ui.toolbar.Button(null,cv.theme.dark.Images.getIcon("reload",15));l.setAppearance("cv-toolbar-button");l.setToolTipText(qx.locale.Manager.tr("Reload"));l.addListener("execute",(function(){e.fireEvent("reload")}));this.add(new qx.ui.core.Spacer,{flex:1});this.add(l)}},_createButton:function(e,t,n){var i=this._menuButtonConfig[e].args,r=new qx.ui.toolbar.Button(null,t||i[1].replace(/\/[0-9]+$/,"/15"),n?null:i[2]);r.setAppearance("cv-toolbar-button");r.setToolTipText(i[0]);return r},_applyFile:function(){},_applyFolder:function(e){this._uploadManager&&(e?this._uploadManager.setFolder(e):this._uploadManager.resetFolder())}},destruct:function(){this._menuButtonConfig=null;this._uploadManager=null;this.__P_28_2=null}});cv.ui.manager.ToolBar.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.basic.Atom":{construct:!0,require:!0},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"cv.ui.manager.basic.Image":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.IconAtom",{extend:qx.ui.basic.Atom,construct:function(e,t){qx.ui.basic.Atom.constructor.call(this,e,t);this._fontIconRegex=/^\<i.*class=".*(knxuf-|ri-)([^\s"]+).*".*\<\/i\>$/;this.addListener("tap",this._onTap,this)},properties:{appearance:{refine:!0,init:"cv-icon"},model:{check:"Array",apply:"_applyModel"}},members:{_fontIconRegex:null,_iconChildControlName:null,_onTap:function(){if("object"===_typeof(navigator.clipboard)){navigator.clipboard.writeText(this.getLabel());cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("Icon name has been copied to clipboard"))}},_applyLabel:function(e,t){cv.ui.manager.core.IconAtom.superclass.prototype._applyLabel.call(this,e,t);this.setToolTipText(e)},_applyModel:function(e){if(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];this.setLabel(n);this.setIcon(i)}else{this.resetLabel();this.resetIcon()}},_applyIcon:function(e,t){if(e)if(this._fontIconRegex.test(e)){this._iconChildControlName="htmlIcon";var n=this.getChildControl(this._iconChildControlName,!0);n&&n.setValue(e);this._excludeChildControl("icon")}else{this._iconChildControlName="icon";var i=this.getChildControl(this._iconChildControlName,!0);i&&i.setSource(e);this._excludeChildControl("htmlIcon")}else{this._iconChildControlName="icon";this._excludeChildControl("htmlIcon")}this._handleIcon()},_handleIcon:function(){null===this.getIcon()||"label"===this.getShow()?this._excludeChildControl(this._iconChildControlName):this._showChildControl(this._iconChildControlName)},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new cv.ui.manager.basic.Image(this.getIcon())).set({anonymous:!0,scale:!0,maxHeight:64});this._addAt(t,0);null!==this.getIcon()&&"label"!==this.getShow()||t.exclude();break;case"htmlIcon":(t=new qx.ui.basic.Label(this.getIcon())).set({anonymous:!0,rich:!0,height:64,width:64});this._addAt(t,0);null!==this.getIcon()&&"label"!==this.getShow()||t.exclude()}return t||cv.ui.manager.core.IconAtom.superclass.prototype._createChildControlImpl.call(this,e)}}});cv.ui.manager.core.IconAtom.$$dbClassInfo=e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){s=!0;a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new I(r||[]);return i(o,"_invoke",{value:y(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function h(){}function g(){}function m(){}var f={};l(f,a,(function(){return this}));var p=Object.getPrototypeOf,_=p&&p(p(E([])));_&&_!==t&&n.call(_,a)&&(f=_);var v=m.prototype=h.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function y(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return P()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}function C(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=u(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,i(v,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:g,configurable:!0}),g.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(x.prototype),l(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new x(c(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(q),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),q(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;q(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,i,r,o,s,"next",e)}function s(e){asyncGeneratorStep(a,i,r,o,s,"throw",e)}o(void 0)}))}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.editor.data.Provider":{construct:!0},"cv.ui.manager.model.Schema":{},"qx.xml.Document":{},"qx.locale.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.Config",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this);this.__P_36_0={};this.__P_36_1={};this._dataProvider=cv.ui.manager.editor.data.Provider.getInstance()},properties:{currentPath:{check:"String",nullable:!0,apply:"_applyCurrentPath"}},members:{_schemas:null,__P_36_2:null,__P_36_0:null,__P_36_3:null,_dataProvider:null,__P_36_4:null,__P_36_5:null,_getSuggestions:null,_applyCurrentPath:function(){this.__P_36_2=null;this.__P_36_4=""},setStructure:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=Object.prototype.hasOwnProperty.call(t.__P_36_1,e);n.t0=e;n.next="pure"===n.t0?4:"tile"===n.t0?13:22;break;case 4:if(i){n.next=8;break}n.next=7;return cv.ui.manager.model.Schema.getInstance("visu_config.xsd");case 7:t.__P_36_1.pure=n.sent;case 8:t.__P_36_2=t.__P_36_1.pure;t.__P_36_4="pages";t.__P_36_5="meta";t._getSuggestions=t.providePureCompletionItems;return n.abrupt("break",22);case 13:if(i){n.next=17;break}n.next=16;return cv.ui.manager.model.Schema.getInstance("visu_config_tile.xsd");case 16:t.__P_36_1.tile=n.sent;case 17:t.__P_36_2=t.__P_36_1.tile;t.__P_36_4="config";t.__P_36_5="cv-meta";t._getSuggestions=t.provideTileCompletionItems;return n.abrupt("break",22);case 22:case"end":return n.stop()}}),n)})))()},getLastOpenedTag:function(e){var t=e.match(/<\/*(?=\S*)([a-zA-Z-]+)/g);if(!t)return null;for(var n=[],i=t.length-1;i>=0;i--)if(0===t[i].indexOf("</"))n.push(t[i].substring(2));else{var r=e.lastIndexOf(t[i]),a=t[i].substring(1);if(-1===e.indexOf("/>",r)){if(!n.length||n[n.length-1]!==a){var o=(e=e.substring(r)).indexOf("<")>e.indexOf(">"),s=!1,l=null;if(o){var c=/([\w\-_\.\d]+)="[^"]*$/.exec(e);s=!!c;l=c?c[1]:null}var u,d=/<[\w-_\d]+$/.test(e),h=_toConsumableArray(e.matchAll(/\s([^=]+)="([^"]+)"/g)),g={},m=_createForOfIteratorHelper(h);try{for(m.s();!(u=m.n()).done;){var f=u.value;g[f[1]]=f[2]}}catch(e){m.e(e)}finally{m.f()}return{tagName:a,currentAttribute:l,attributes:g,filteredElementSearch:d,isAttributeSearch:!d&&o&&!s,isContentSearch:s,text:e}}n.splice(n.length-1,1)}e=e.substring(0,r)}return null},findElements:function(e,t,n,i,r){var a=!0===r?this.__P_36_3:this.__P_36_0;if(t in a)return a[t];if(n<i)return null;e||(e=this.__P_36_2.getElementNode(this.__P_36_4));void 0===i&&(i=1);var o=e.getAllowedElements();if(t in o){this.__P_36_0[t]=o[t];return o[t]}for(var s in o)if((!0===r||s!==this.__P_36_5)&&n>i){var l=this.findElements(o[s],t,n,i+1);if(l){a[t]=l;return l}}return null},isItemAvailable:function(e,t,n){if((t=t||"1")&&"unbounded"===t)return!0;for(var i=0,r=0;r<n.length;r++)n[r]===e&&i++;return 0===i||parseInt(t)>i},getElementString:function(e,t,n){var i=t+n+e.getName()+" ",r=e.getAllowedAttributes();Object.getOwnPropertyNames(r).forEach((function(e){var t=r[e];t.isOptional||(i+=e+'="'+(t.getDefaultValue()?t.getDefaultValue():"")+'" ')}));var a=e.getRequiredElements(),o=e.getAllowedContent();if(o._text||a.length>0||!!o._grouping){i=i.trim()+">";var s=0;a.forEach((function(n){var r=this.findElements(e,n,1,0);if(r){i+="\n    "+this.getElementString(r,t+"    ","<")+">";s++}}),this);s>0&&(i+="\n"+t);i+="</"+e.getName()}else i=i.trim()+"/";return i},getAvailableElements:function(e,t){var n=[],i=e.getAllowedElements();if(!i)return[];Object.getOwnPropertyNames(i).filter((function(e){return!e.startsWith("#")})).forEach((function(e){var r=i[e];this.isItemAvailable(r.getName(),r.getBounds().max,t)&&n.push({label:r.getName(),insertText:this.getElementString(r,"",""),kind:window.monaco.languages.CompletionItemKind.Field,detail:r.getType(),documentation:r.getDocumentation().join("\n")})}),this);return n},getAvailableAttributes:function(e,t){var n=[],i=e.getAllowedAttributes();Object.getOwnPropertyNames(i).forEach((function(e){var r=i[e];-1===t.indexOf(r.name)&&n.push({label:r.getName(),insertText:r.getName()+'=""',kind:window.monaco.languages.CompletionItemKind.Property,detail:r.getTypeString(),documentation:r.getDocumentation().join("\n")})}),this);return n},detectSchema:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=/:noNamespaceSchemaLocation="([^"]+)"/.exec(e.substring(0,200)))||!i[1].endsWith("visu_config_tile.xsd")){n.next=6;break}n.next=4;return t.setStructure("tile");case 4:n.next=8;break;case 6:n.next=8;return t.setStructure("pure");case 8:case"end":return n.stop()}}),n)})))()},getProvider:function(){return{triggerCharacters:["<",'"'],provideCompletionItems:function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setCurrentPath(t.uri.toString());i=t.getValue();if(this.__P_36_2){e.next=5;break}e.next=5;return this.detectSchema(i);case 5:if(!this._getSuggestions){e.next=7;break}return e.abrupt("return",this._getSuggestions(t,n));case 7:return e.abrupt("return",{suggestions:[]});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}().bind(this)}},providePureCompletionItems:function(e,t){for(var n,i,r=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),a=e.getValue(),o=a.indexOf("</meta>"),s=o>0?a.substring(0,o):a,l=[],c=[],u={},d=/<mapping name="([^"]+)"/gm;null!==(n=d.exec(s));)l.push(n[1]);d=/<styling name="([^"]+)"/gm;for(;null!==(n=d.exec(s));)c.push(n[1]);var h=s.indexOf("<templates>");if(h>=0){s.substring(h+11,s.indexOf("</templates>")-12).replace(/(?:\r\n|\r|\n)/g,"").split("</template>").forEach((function(e){for(var t=/<template name="([^"]+)"/.exec(e),n=[],r=/{{{?\s*([\w\d]+)\s*}?}}/gm;null!==(i=r.exec(e));)n.push(i[1]);u[t[1]]=n}),this)}var g,m=this.getLastOpenedTag(r),f=[],p=[],_=[],v=m&&m.isAttributeSearch,b=m&&m.isContentSearch,x=m&&m.filteredElementSearch;if(m){(g=m.text.split(" ")).shift();var y=r;g.length&&(y=y.substring(0,y.length-g.join(" ").length)+">");for(var C,w=qx.xml.Document.fromString(y).lastElementChild,q=!1;w&&"parsererror"!==w.tagName.toLowerCase();){f.push(w.tagName);p.push(w.attributes);if(w.tagName===m.tagName){q=!0;if(m.isAttributeSearch&&w.outerHTML===m.text){var I=w.attributes;for(C=0;C<I.length;C++)_.push(I[C].nodeName)}else{var E=w.children;for(C=0;C<E.length;C++)"parsererror"!==E[C].tagName.toLowerCase()&&_.push(E[C].tagName)}break}w=w.lastElementChild}if(!q&&(v||b)){(g=m.text.split(" ")).shift();g.forEach((function(e){_.push(e.split("=").shift())}))}}var P,S=[],k=f[f.length-1];if(b){if("pages"===m.tagName&&"design"===m.currentAttribute)return this._dataProvider.getDesigns(null,null,"pure").then((function(e){return{suggestions:e}}));if("address"===m.tagName&&"transform"===m.currentAttribute)return{suggestions:this._dataProvider.getTransforms()};if("plugin"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getPlugins()};if("icon"===m.tagName&&"name"===m.currentAttribute)return{suggestions:this._dataProvider.getIcons("monaco",{cache:!1},a)};if("influx"===m.tagName){if("measurement"===m.currentAttribute)return this._dataProvider.getInfluxDBs().then((function(e){return{suggestions:e}}));if("field"===m.currentAttribute&&(P=/measurement="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBFields(P[1]).then((function(e){return{suggestions:e}}))}else if("tag"!==m.tagName||"key"!==m.currentAttribute&&"value"!==m.currentAttribute||!f.includes("influx")){if("template"===m.tagName&&"name"===m.currentAttribute&&f.includes("meta"))return{suggestions:S=Object.keys(u).map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}),this)};if("value"===m.tagName&&"name"===m.currentAttribute&&!f.includes("meta")&&f.includes("template")){Object.keys(u).forEach((function(e){u[e].forEach((function(t){S.push({label:t,insertText:t,detail:qx.locale.Manager.tr("Variable from template %1",e),kind:window.monaco.languages.CompletionItemKind.Variable})}),this)}),this);return{suggestions:S}}if("mapping"===m.currentAttribute)return{suggestions:S=l.map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}),this)};if("styling"===m.currentAttribute)return{suggestions:S=c.map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}),this)}}else{var T=p[f.indexOf("influx")].getNamedItem("measurement");if(T){if("key"===m.currentAttribute)return this._dataProvider.getInfluxDBTags(T.value).then((function(e){return{suggestions:e}}));if("value"===m.currentAttribute&&(P=/key="([^"]+)"/.exec(m.text)))return this._dataProvider.getInfluxDBValues(T.value,P[1]).then((function(e){return{suggestions:e}}))}}k=m.tagName}else if(!v&&x)k=f[f.length-2];else if("address"===m.tagName&&null===m.currentAttribute){var F=m.attributes.backend||"main";return this._dataProvider.getAddresses("monaco",null,F).then((function(e){return{suggestions:e}}))}if("rrd"===k)return this._dataProvider.getRrds("monaco").then((function(e){return{suggestions:e}}));if("file"===k&&!v&&!b&&f.includes("files")){var A=(P=/type="([^"]+)"/.exec(m.text))?P[1]:null;return this._dataProvider.getMediaFiles(A).then((function(e){return{suggestions:e}}))}var D=this.findElements(this.__P_36_2.getElementNode("pages"),k,f.length,f.includes("meta"));if(b){var O=_[_.length-1];if(D&&O in D.getAllowedAttributes()){var N=D.getAllowedAttributes()[O],M=N.getTypeString();N.getEnumeration().forEach((function(e){S.push({label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.Value,detail:M,documentation:N.getDocumentation().join("\n")})}))}}else v?S=D?this.getAvailableAttributes(D,_):[]:m&&m.text.endsWith("</")?S.push({label:m.tagName,insertText:m.tagName,kind:window.monaco.languages.CompletionItemKind.Field}):S=D?this.getAvailableElements(D,_):[];return{suggestions:S}},provideTileCompletionItems:function(e,t){for(var n,i=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),r=e.getValue(),a=r.indexOf("</cv-meta>"),o=a>0?r.substring(0,a):r,s=[],l=[],c=/<cv-mapping name="([^"]+)"/gm;null!==(n=c.exec(o));)s.push(n[1]);c=/<cv-styling name="([^"]+)"/gm;for(;null!==(n=c.exec(o));)l.push(n[1]);var u,d=this.getLastOpenedTag(i),h=[],g=[],m=[],f=d&&d.isAttributeSearch,p=d&&d.isContentSearch,_=d&&d.filteredElementSearch;if(d){(u=d.text.split(" ")).shift();var v=i;u.length&&(v=v.substring(0,v.length-u.join(" ").length)+">");for(var b,x=qx.xml.Document.fromString(v).lastElementChild,y=!1;x;){h.push(x.tagName);g.push(x.attributes);if(x.tagName===d.tagName){y=!0;if(d.isAttributeSearch&&x.outerHTML===d.text){var C=x.attributes;for(b=0;b<C.length;b++)m.push(C[b].nodeName)}else{var w=x.children;for(b=0;b<w.length;b++)"parsererror"!==w[b].tagName.toLowerCase()&&m.push(w[b].tagName)}break}x=x.lastElementChild}if(!y&&(f||p)){(u=d.text.split(" ")).shift();u.forEach((function(e){m.push(e.split("=").shift())}))}}var q,I=[],E=h[h.length-1];if(p){if("config"===d.tagName&&"design"===d.currentAttribute){return{suggestions:this._dataProvider.getDesigns(null,null,"tile")}}if("cv-address"===d.tagName&&"transform"===d.currentAttribute)return{suggestions:this._dataProvider.getTransforms()};if("cv-icon"===d.tagName&&"name"===d.currentAttribute)return{suggestions:this._dataProvider.getIcons()};if("mapping"===d.currentAttribute)return{suggestions:I=s.map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}),this)};if("styling"===d.currentAttribute)return{suggestions:I=l.map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}),this)};E=d.tagName}else if(!f&&_)E=h[h.length-2];else{if("cv-address"===d.tagName&&null===d.currentAttribute){var P=d.attributes.backend||"main";return this._dataProvider.getAddresses("monaco",null,P).then((function(e){return{suggestions:e}}))}if("cv-chart"===d.tagName&&"src"===d.currentAttribute)return this._dataProvider.getRrds("monaco").then((function(e){return{suggestions:e}}));if("cv-loader"===d.tagName&&"src"===d.currentAttribute){var S=(q=/type="([^"]+)"/.exec(d.text))?q[1]:null;return this._dataProvider.getMediaFiles(S).then((function(e){return{suggestions:e}}))}}var k=this.findElements(this.__P_36_2.getElementNode("config"),E,h.length,h.includes("cv-meta"));if(p){var T=d.currentAttribute;if(k&&T in k.getAllowedAttributes()){var F=k.getAllowedAttributes()[T],A=F.getTypeString();F.getEnumeration().forEach((function(e){I.push({label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.Value,detail:A,documentation:F.getDocumentation().join("\n")})}))}}else f?I=k?this.getAvailableAttributes(k,m):[]:d&&d.text.endsWith("</")?I.push({label:d.tagName,insertText:d.tagName,kind:window.monaco.languages.CompletionItemKind.Field}):I=k?this.getAvailableElements(k,m):[];return{suggestions:I}}},destruct:function(){this.__P_36_0=null;this._schema=null;this._dataProvider=null}});cv.ui.manager.editor.completion.Config.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.Version":{},"cv.io.rest.Client":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.completion.CometVisu",{extend:qx.core.Object,construct:function(){qx.core.Object.constructor.call(this)},members:{TEMPLATES:null,getTemplates:function(){if(!this.TEMPLATES){this.TEMPLATES=[{filterText:"cvclass",label:"CometVisu-Class",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu class.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.$0", {\n  extend: qx.core.Object,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvwidget",label:"CometVisu-Widget",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a widget.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Class.define("cv.ui.structure.pure.$0", {\n  extend: cv.ui.structure.pure.AbstractWidget,\n\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvinterface",label:"CometVisu-Interface",kind:window.monaco.languages.CompletionItemKind.Interface,detail:"A generic CometVisu Interface.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Interface.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmixin",label:"CometVisu-Mixin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A generic CometVisu Mixin.",insertText:"/**\n * TODO: Add documentation\n * \n * @since "+cv.Version.VERSION.replace("-dev","")+' ($CURRENT_YEAR)\n */\nqx.Mixin.define("cv.$0", {\n  \n});\n',insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvmembers",label:"CometVisu-Class members",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes members section.",insertText:"  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvproperties",label:"CometVisu-Class properties",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"A CometVisu classes properties section.",insertText:"  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvstatics",label:"CometVisu-Class statics",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"statics section.",insertText:"  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvevents",label:"CometVisu-Class events",kind:window.monaco.languages.CompletionItemKind.Struct,detail:"events section.",insertText:"  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvconstructor",label:"Constructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"constructor.",insertText:"  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    $0\n  },\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace},{filterText:"cvdestructor",label:"Destructor",kind:window.monaco.languages.CompletionItemKind.Method,detail:"destructor.",insertText:"  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this.base(arguments);\n    $0\n  }\n",insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace}];return new Promise(function(e,t){cv.io.rest.Client.getFsClient().readSync({path:"demo/templates/Plugin.js"},(function(n,i){if(n)t(n);else{this.TEMPLATES.push({filterText:"cvplugin",label:"CometVisu-Plugin",kind:window.monaco.languages.CompletionItemKind.Class,detail:"A CometVisu class for a plugin.",insertText:i.replace("###SINCE###",cv.Version.VERSION.replace("-dev","")+" ($CURRENT_YEAR)"),insertTextRules:window.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet|window.monaco.languages.CompletionItemInsertTextRule.KeepWhitespace});e(this.TEMPLATES)}}),this)}.bind(this))}return Promise.resolve(this.TEMPLATES)},getProvider:function(){return{triggerCharacters:["cv"],provideCompletionItems:function(){return this.getTemplates().then((function(e){return{suggestions:e}}))}.bind(this)}}}});cv.ui.manager.editor.completion.CometVisu.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){s=!0;a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.marshal.MEventBubbling":{require:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.editor.Tree":{},"cv.ui.manager.model.schema.Element":{},"cv.theme.dark.Images":{},"cv.IconHandler":{},"cv.ui.manager.model.ElementChange":{},"qx.locale.Manager":{},"qx.core.ValidationError":{},"qx.lang.String":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.XmlElement",{extend:qx.core.Object,include:[qx.data.marshal.MEventBubbling],construct:function(e,t,n,i){qx.core.Object.constructor.call(this);this._node=e;var r=new qx.data.Array;if(e){this._node.$$widget=this;this.setSchemaElement(t);this.initName(e.nodeName);this._updateShowEditButton();this.hasChildren()&&r.push(new cv.ui.manager.model.XmlElement);n&&this.setEditor(n);i&&this.setParent(i);this._maintainIcon();this._maintainStatus()}else this.initName("#temp");this.initChildren(r);this._initialAttributes=new Map;this.bind("editor.file.writeable",this,"editable")},statics:{entityMap:{"&":"&amp;",'"':"&quot;","'":"&#39;","`":"&#x60;"}},properties:{editor:{check:"cv.ui.manager.editor.Tree",nullable:!0,event:"changeEditor"},schemaElement:{check:"cv.ui.manager.model.schema.Element",apply:"_applySchemaElement"},name:{check:"String",deferredInit:!0,event:"changeName",apply:"updateDisplayName"},displayName:{check:"String",init:"",event:"changeDisplayName"},open:{check:"Boolean",event:"changeOpen",init:!1,apply:"_onOpen"},loaded:{check:"Boolean",event:"changeLoaded",init:!1},children:{check:"qx.data.Array",event:"changeChildren",apply:"_applyEventPropagation",deferredInit:!0},textContent:{check:"String",nullable:!0,apply:"_applyTextContent",event:"changeTextContent",validate:"_validateTextContent"},temporary:{check:"Boolean",init:!1,event:"changeTemporary"},valid:{check:"Boolean",init:!0,event:"changeValid",apply:"_applyValid"},invalidMessage:{check:"String",init:"",event:"changeInvalidMessage"},status:{check:["error","valid","comment"],init:"valid",event:"changeStatus"},editable:{check:"Boolean",init:!0,event:"changeEditable",apply:"_applyEditable"},sortable:{check:"Boolean",init:!0,event:"changeSortable"},deletable:{check:"Boolean",init:!0,event:"changeDeletable"},modified:{check:"Boolean",init:!1,apply:"_applyModified"},showEditButton:{check:"Boolean",init:!0,event:"changeShowEditButton"},parent:{check:"cv.ui.manager.model.XmlElement",nullable:!0},icon:{check:"String",nullable:!0,event:"changeIcon"},dragging:{check:"Boolean",init:!1,event:"changeDragging"}},members:{_node:null,_schema:null,_schemaElement:null,_initialAttributes:null,_initialChildNames:null,_initialTextContent:null,__P_46_0:!1,__P_46_1:null,_structure:null,_maintainStatus:function(){this._node.nodeType===Node.COMMENT_NODE?this.setStatus("comment"):this.isValid()?this.setStatus("valid"):this.setStatus("error")},_applyValid:function(e){this._maintainStatus();e&&this.resetInvalidMessage()},convertTextNodeType:function(e){if(this.isTextNode()&&this._node.nodeType!==e&&(e===Node.TEXT_NODE||e===Node.CDATA_SECTION_NODE)){var t=this.getText(),n=this._node,i=e===Node.CDATA_SECTION_NODE?this._node.ownerDocument.createCDATASection(t):this._node.ownerDocument.createTextNode(t);n.parentNode&&n.parentNode.replaceChild(i,n);this._node=i;this.setName(this._node.nodeName);this.load(!0)}},_maintainIcon:function(){if(this._node){if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this.setIcon(cv.theme.dark.Images.getIcon("text-fields",18));return}if(this._node.nodeType===Node.COMMENT_NODE){this.setIcon(cv.theme.dark.Images.getIcon("comment-fields",18));return}if("icon"===this.getName()&&this.getAttribute("name")&&-1===this.getAttribute("name").indexOf("{{")){var e=cv.IconHandler.getInstance().getIconSource(this.getAttribute("name"),"tree-icon");e?this.setIcon(e):this.setIcon(cv.theme.dark.Images.getIcon("image",18));return}}this.isOpen()?this.setIcon(cv.theme.dark.Images.getIcon("folder-open",18)):this.setIcon(cv.theme.dark.Images.getIcon("folder",18))},_applyEditable:function(){this._updateShowEditButton();this.updateDeletable()},_updateShowEditButton:function(){var e=this.getSchemaElement();this.setShowEditButton(e.isTextContentAllowed()&&this.getName().startsWith("#")||Object.keys(e.getAllowedAttributes()).length>0||e.isChildElementAllowed("*"))},updateDeletable:function(){var e=this;if(this.isEditable()){var t=this.getParent();if(this.isTextNode())if(this.getSchemaElement().isTextContentRequired()){var n=t.getChildren().filter((function(e){return e.isTextNode()})).length;this.setDeletable(n>1)}else this.setDeletable(!0);else{var i=!1;if(t){var r=t.getSchemaElement();if(r.getRequiredElements().includes(this.getName())){var a=r.getBoundsForElementName(this.getName());if(a){var o=t.getChildren().filter((function(t){return t.getName()===e.getName()})).length;i=a.min<=o-1}else i=!0}else i=!0}else i=!0;this.setDeletable(i)}}else this.setDeletable(!1)},getNode:function(){return this._node},remove:function(e){var t=this.getParent();if(t){var n=[{index:t.getChildren().indexOf(this),parent:t,child:this}];this._node.remove();t.getChildren().remove(this);var i=this.getEditor();this.$$removed=!0;i&&i.updateModified(this);t.updateModified();if(!e&&i){var r=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Remove %1",this.getDisplayName()),this,n,"deleted");i.addUndo(r)}}},isAncestor:function(e){for(var t=e.getParent();t;){if(t===this)return!0;t=t.getParent()}return!1},_move:function(e,t,n){if(this.isAncestor(e))return!1;if(e===this)return!1;var i=this.getParent(),r=i.getChildren(),a="inside"===t?e:e.getParent(),o=a.getChildren(),s=[{oldIndex:r.indexOf(this),oldParent:i,parent:a,child:this,index:o.indexOf(e)+("after"===t?1:0)}];if("inside"===t&&a.getSchemaElement().isChildElementAllowed(this.getName())||a.isChildAllowedAtPosition(this,s[0].index)){r.remove(this);this.getNode().remove();a===i&&(s[0].index=o.indexOf(e)+("after"===t?1:0));a.insertChild(this,s[0].index,!0,"moved");if(!n){var l=this.getEditor();if(l){var c=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Move %1",this.getDisplayName()),this,s,"moved");l.addUndo(c)}}return!0}return!1},moveTo:function(e,t,n){if(this.isAncestor(e))return!1;var i=this.getParent(),r=i.getChildren(),a=[{oldIndex:r.indexOf(this),oldParent:i,parent:e,child:this,index:t}],o=e===i&&t<r.length?r.getItem(t):null;if(e.isChildAllowedAtPosition(this,t)){r.remove(this);this.getNode().remove();if(o){t=r.indexOf(o);a[0].index=t}e.insertChild(this,t,!0,"moved");if(!n){var s=this.getEditor();if(s){var l=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Move %1",this.getDisplayName()),this,a,"moved");s.addUndo(l)}}return!0}return!1},moveAfter:function(e,t){return this._move(e,"after",t)},moveBefore:function(e,t){return this._move(e,"before",t)},moveInside:function(e,t){return this._move(e,"inside",t)},insertAfter:function(e,t){var n=e.getParent(),i=n.getChildren().indexOf(e)+1;return n.insertChild(this,i,t,"added")},insertBefore:function(e,t){var n=e.getParent(),i=n.getChildren().indexOf(e);return n.insertChild(this,i,t,"added")},getAddableChildren:function(e){if(!this.__P_46_1)if(this.getName().startsWith("#"))this.__P_46_1=[];else{var t=this.getSchemaElement(),n=t.getAllowedElements(),i=[],r={};this.isLoaded()||this.load();this.getChildren().forEach((function(e){Object.prototype.hasOwnProperty.call(r,e.getName())||(r[e.getName()]=0);r[e.getName()]++}));Object.keys(n).forEach((function(n){if(!0!==e||"#comment"!==n)if("#text"!==n&&"#cdata-section"!==n){var a=t.getBoundsForElementName(n),o=Object.prototype.hasOwnProperty.call(r,n)?r[n]:0;a&&a.max>o&&i.push(n)}else if(t.isTextContentAllowed())if(t.isMixed()){var s=0,l=0;Object.keys(r).forEach((function(e){"#text"===e||"#cdata-section"===e?s+=r[e]:l+=r[e]}));s<=l&&i.push(n)}else Object.prototype.hasOwnProperty.call(r,"#text")||Object.prototype.hasOwnProperty.call(r,"#cdata-section")||i.push(n)}));this.__P_46_1=i}return this.__P_46_1},isChildAllowedAtPosition:function(e,t){var n=this.getSchemaElement(),i=e instanceof cv.ui.manager.model.XmlElement?e.getName():e;if(!n.isChildElementAllowed(i)){this.debug(i,"is not allowed as child of",this.getName());return!1}if(n.areChildrenSortable())return!0;var r=n.getFirstLevelElementSorting();this.isLoaded()||this.load();var a=this.getChildren();if(0===a.length)return!0;var o=t;o=a.length>t?r[a.getItem(t).getName()]:a.length;var s,l=r[i];if(o===l||l>=a.length)return!0;if(t>0)for(var c=Math.min(t,a.length)-1;c>=0;c--)if(a.getItem(c).getName()!==i){s=a.getItem(c).getName();break}s&&(o=r[s]);if(!(o+1>=l)){this.debug(i,"is not allowed as child of",this.getName());return!1}return!0},findPositionForChild:function(e){var t=this.getSchemaElement();if(t.isChildElementAllowed(e.getName())){this.isLoaded()||this.load();if(t.areChildrenSortable())return this.getChildren().length;var n=t.getFirstLevelElementSorting();if(n&&Object.prototype.hasOwnProperty.call(n,e.getName())){var i=n[e.getName()],r=i;this.getChildren().some((function(e,t){if(n[e.getName()]>i){r=t;return!0}return!1}))||(r=this.getChildren().length);return r}}return-1},insertChild:function(e,t,n,i){this.isLoaded()||this.load();var r=this.getChildren(),a=!1;if(-1===t&&-1===(t=this.findPositionForChild(e)))return!1;if(this.isChildAllowedAtPosition(e,t))if(t>=r.length){this._node.appendChild(e.getNode());r.push(e);a=!0}else if(0===t){this._node.insertBefore(e.getNode(),this._node.childNodes[0]);r.unshift(e);a=!0}else{var o=r.getItem(t);if(o){o.getNode().before(e.getNode());r.insertBefore(o,e);a=!0}}if(a){var s=this.getEditor();e.setParent(this);if(e.$$removed){delete e.$$removed;s&&s.updateModified(e);e.updateModified()}else if(!i||"added"===i){e.$$added=!0;e.updateModified()}this.updateModified();1===r.length&&this.setOpen(!0);if(!n&&s){var l=[{index:t,parent:this,child:e}],c=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Add %1",this.getDisplayName()),this,l,"created");s.addUndo(c)}}return a},_validateTextContent:function(e){if(!this.__P_46_0){if(!this._node)throw new qx.core.ValidationError(qx.locale.Manager.tr("Text content not allowed here"));if(!this.getSchemaElement().isValueValid(e))throw new qx.core.ValidationError(qx.locale.Manager.tr("Invalid text content: '%1'",e))}},validate:function(e){var t=this,n=this.getSchemaElement();if(this.isTextNode()){this.getParent().validate(!1);this.setValid(n.isValueValid(this.getText()))}else if(this.isElement()){for(var i=n.getAllowedAttributes(),r=[],a=0;a<this._node.attributes.length;a++){var o=this._node.attributes.item(a);Object.prototype.hasOwnProperty.call(i,o.name)?i[o.name].isValueValid(o.value)||r.push({attribute:o.name,error:qx.locale.Manager.tr("Invalid value")}):r.push({attribute:o.name,error:qx.locale.Manager.tr("Attribute '%1' not allowed",o.name)})}Object.keys(i).filter((function(e){return!i[e].isOptional()})).forEach((function(e){t._node.hasAttribute(e)||r.push({attribute:e,error:qx.locale.Manager.tr("Attribute '%1' is required but missing",e)})}));if(n.isTextContentRequired()){this.getChildren().some((function(e){return e.isTextNode()&&""!==e.getNode().nodeValue.trim()}))||r.push({attribute:"#text",error:qx.locale.Manager.tr("Text content is missing")})}n.isTextContentAllowed()&&this.getChildren().forEach((function(e){if(e.isTextNode()){e.load();e.setValid(n.isValueValid(e.getText()));e.isValid()||e.setInvalidMessage(qx.locale.Manager.tr("Text content is invalid"))}}));this.setInvalidMessage(r.map((function(e){return e.error})).join("<br/>"));this.setValid(0===r.length)}},isTextNode:function(){return"#text"===this.getName()||"#cdata-section"===this.getName()},_applyTextContent:function(e){if(!this.__P_46_0&&this._node)if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.COMMENT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this._node.nodeValue=e;this.updateDisplayName()}else this._node.nodeType===Node.ELEMENT_NODE&&(this._node.textContent=e)},getText:function(){return this.getTextContent()},setText:function(e,t){var n=!1,i=e,r="";if(this.getSchemaElement().isTextContentAllowed()){r=this.getTextContent();if(this.getSchemaElement().isValueValid(e)){if(r!==e){this.setTextContent(e);n=!0}}else this.error("'"+e+"' is no valid text content for a '"+this.getName()+"' element")}else this.error("text content is not allowed for a '"+this.getName()+"' element");return{changed:n,attribute:t||"#text",value:i,old:r}},getAttribute:function(e){return this._node.getAttribute(e)},setAttribute:function(e,t){if(this._node.nodeType===Node.ELEMENT_NODE){var n=this.getSchemaElement().getAllowedAttributes()[e],i=!1,r=t,a=this._node.hasAttribute(e)?this._node.getAttribute(e):"";if(n){r=t=(t=null==t?"":""+t).replace(/[&"'`]/g,(function(e){return cv.ui.manager.model.XmlElement.entityMap[e]}));if(n.isValueValid(t)){if(a!==t){if(t&&t!==n.getDefaultValue())this._node.setAttribute(e,t);else{this._node.removeAttribute(e);r=""}if("name"===e){this.updateDisplayName();"icon"===this.getName()&&this._maintainIcon()}i=!0}}else this.error("'"+t+"' is not allowed for attribute '"+e+"'")}else this.error("'"+e+"' is no allowed attribute for a '"+this.getName()+"' element");return{changed:i,attribute:e,value:r,old:a}}if(this._node.nodeType===Node.TEXT_NODE&&"#text"===e||this._node.nodeType===Node.CDATA_SECTION_NODE&&"#cdata-section"===e)return this.setText(t,e);if(this._node.nodeType===Node.COMMENT_NODE&&"#comment"===e){var o=this.getTextContent(),s=t!==o;this.setTextContent(t);return{changed:s,attribute:e,value:t,old:o}}return null},isRequired:function(){var e=this.getParent();if(e){return e.getSchemaElement().getRequiredElements().includes(this.getName())}return!0},setAttributes:function(e){var t,n=this,i=[],r=[],a="#text"===this.getName()||"#cdata-section"===this.getName(),o=this.getParent();Object.keys(e).forEach((function(s){if(a&&!s.startsWith("#"))(t=o.setAttribute(s,e[s])).changed&&r.push(t);else if("#outerHTML"===s||"#innerHTML"===s){if(n.getSchemaElement().isChildElementAllowed("*")){var l=(new DOMParser).parseFromString(e[s],"text/xml");if(0===l.getElementsByTagName("parsererror").length){var c="#outerHTML"===s?n._node.outerHTML:n._node.innerHTML,u=l.documentElement;if("#outerHTML"===s){var d=n._node;d.parentNode.replaceChild(u,d);n._node=u;n.setName(n._node.nodeName)}else n._node.innerHTML=e[s];i.push({changed:!0,attribute:s,value:e[s],old:c});n.load(!0)}}else if("#innerHTML"===s&&!e[s]){var h=n._node.innerHTML;n._node.innerHTML=e[s];i.push({changed:!0,attribute:s,value:e[s],old:h});n.load(!0)}}else(t=n.setAttribute(s,e[s])).changed&&i.push(t)}));var s=this.getEditor();if(s&&i.length>0){if(r.length>0){var l=new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Change %1",o.getDisplayName()),o,r);i.push(l);o.updateModified()}s.addUndo(new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr("Change %1",this.getDisplayName()),this,i))}this.updateModified()},_applySchemaElement:function(e){this._structure=e?e.getSchema().getStructure():null;e.bind("sortable",this,"sortable",{converter:function(e){return this.isEditable()&&e}.bind(this)})},_onOpen:function(e){e&&!this.isLoaded()&&this.load();this._maintainIcon()},_applyModified:function(){this.updateDisplayName()},updateDisplayName:function(){var e=this.getName();if(this._node)if(this._node.nodeType===Node.ELEMENT_NODE){if(this._node.hasAttribute("name")){e+=' "'+this._node.getAttribute("name")+'"'}else if(this.getSchemaElement().getSchema().isRoot(this.getName())&&this._node.hasAttribute("design")){e+=' "'+this._node.getAttribute("design")+'"'}}else if((this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE||this._node.nodeType===Node.COMMENT_NODE)&&this._node.nodeValue.trim()){var t=this._node.nodeValue.trim();t.length>26&&(t=t.substring(0,26)+"...");e=t}this.isModified()&&(e+=" *");this.setDisplayName(e)},hasChildren:function(){if(this._node.nodeType===Node.ELEMENT_NODE&&this._node&&this._node.hasChildNodes())for(var e=0;e<this._node.childNodes.length;e++){var t=this._node.childNodes.item(e);if(t.nodeType===Node.ELEMENT_NODE||(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)&&""!==t.nodeValue.trim())return!0}return!1},load:function(e){if(!this.isLoaded()||e){this.__P_46_0=!0;var t=this.getChildren();t.removeListener("change",this._syncChildNodes,this);t.removeAll();if(this._node)if(this._node.nodeType===Node.ELEMENT_NODE){var n=this.getSchemaElement();this._initialChildNames=[];for(var i=0;i<this._node.childNodes.length;i++){var r=this._node.childNodes.item(i),a=n.getSchemaElementForElementName(r.nodeName);if(a){if(r.nodeType===Node.ELEMENT_NODE){var o=new cv.ui.manager.model.XmlElement(r,a,this.getEditor(),this);t.push(o);this._initialChildNames.push(r.nodeName)}else if(r.nodeType===Node.TEXT_NODE||r.nodeType===Node.CDATA_SECTION_NODE){if(r.nodeValue.trim()){var s=new cv.ui.manager.model.XmlElement(r,n,this.getEditor(),this);n.isMixed()&&s.setSortable(!0);t.push(s);r.nodeValue.trim()&&this._initialChildNames.push(r.nodeName)}}else if(r.nodeType===Node.COMMENT_NODE&&r.nodeValue){var l=new cv.ui.manager.model.XmlElement(r,a,this.getEditor(),this);l.setSortable(!1);t.push(l);r.nodeValue.trim()&&this._initialChildNames.push(r.nodeName)}}else if(r.nodeType===Node.ELEMENT_NODE)if(n.isChildElementAllowed(r.nodeName)){var c=new cv.ui.manager.model.XmlElement(r,n,this.getEditor(),this);n.isMixed()&&c.setSortable(!0);t.push(c);this._initialChildNames.push(r.nodeName)}else{this.setValid(!1);var u=this.getInvalidMessage();u=(u?u+"<br/>":"")+qx.locale.Manager.tr("Child element '%1' not allowed.",r.nodeName);this.setInvalidMessage(u);this.setValid(!1)}}this._initialAttributes.clear();for(var d=0;d<this._node.attributes.length;d++){var h=this._node.attributes.item(d);this._initialAttributes.set(h.name,h.value)}}else if(this._node.nodeType===Node.TEXT_NODE||this._node.nodeType===Node.COMMENT_NODE||this._node.nodeType===Node.CDATA_SECTION_NODE){this._initialTextContent=this._node.nodeValue;try{this.setTextContent(this._node.nodeValue)}catch(e){this.appendInvalidMessage(e.toString())}}this.setLoaded(!0);t.addListener("change",this._syncChildNodes,this);this._updateChildrenDeletableFlags();this.__P_46_0=!1}},appendInvalidMessage:function(e){if(e){var t=this.getInvalidMessage();this.setInvalidMessage(t?t+"<br/>"+e:e)}},updateModified:function(){if(this.$$added)this.setModified(!0);else if(this._node.nodeType===Node.ELEMENT_NODE){var e=this._initialAttributes,t=this._currentChildNames();if(this._node.attributes.length!==e.size)this.setModified(!0);else if(t.length!==this._initialChildNames.length||t.join("")!==this._initialChildNames.join(""))this.setModified(!0);else{var n,i=!1,r=_createForOfIteratorHelper(e);try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray(n.value,2),o=a[0],s=a[1];if(!this._node.hasAttribute(o)||this._node.getAttribute(o)!==s){i=!0;break}}}catch(e){r.e(e)}finally{r.f()}this.setModified(i)}}else this._node.nodeType!==Node.TEXT_NODE&&this._node.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||this.setModified(this._initialTextContent!==this.getTextContent());var l=this.getEditor();l&&l.updateModified(this)},hasChildrenModified:function(){if(this._node.nodeType===Node.ELEMENT_NODE&&this.isLoaded()){var e=this._currentChildNames();return this.isModified()&&(e.length!==this._initialChildNames.length||e.join("")!==this._initialChildNames.join(""))}return!1},onSaved:function(){if(this._node.nodeType===Node.ELEMENT_NODE){this._initialAttributes.clear();for(var e=0;e<this._node.attributes.length;e++){var t=this._node.attributes.item(e);this._initialAttributes.set(t.name,t.value)}this._initialChildNames=this._currentChildNames()}else this._node.nodeType!==Node.TEXT_NODE&&this._node.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||(this._initialTextContent=this._node.nodeValue);this.$$added&&delete this.$$added;this.setModified(!1)},isElement:function(){return this._node.nodeType===Node.ELEMENT_NODE},_currentChildNames:function(){for(var e,t,n=[],i=0;i<this._node.childNodes.length;i++){var r=this._node.childNodes.item(i);if(r.nodeType===Node.ELEMENT_NODE){e=(t=this._node.$$widget)?t.getDisplayName():r.nodeName;n.push(e)}else r.nodeType!==Node.TEXT_NODE&&r.nodeType!==Node.COMMENT_NODE&&this._node.nodeType!==Node.CDATA_SECTION_NODE||!r.nodeValue.trim()||n.push(r.nodeName)}return n},_syncChildNodes:function(e){this.__P_46_1=null;this._updateChildrenDeletableFlags()},_updateChildrenDeletableFlags:function(){this.isEditable()&&this.getChildren().forEach((function(e){(e.isElement()||e.isTextNode())&&e.updateDeletable()}))},getWidgetPath:function(){if("#comment"===this.getName())return"";for(var e=this.getSchemaElement().getSchema().getWidgetNames(),t=this;t&&!e.includes(t.getName());)t=t.getParent();if(!t)return"";if("pure"===this._structure){if("navbar"===t.getName())return"navbar"+qx.lang.String.firstUp(t.getAttribute("position"));for(var n=[],i=t;i;){var r=i.getParent();if("pages"===r.getName()){n.unshift("id");break}var a=r.getChildren().filter((function(e){return e.getNode().nodeType===Node.ELEMENT_NODE&&"layout"!==e.getName()})).indexOf(i);n.unshift(a);i=r}"page"===t.getName()&&n.push("");return"#"+n.join("_")}if("tile"===this._structure){for(var o=t.getNode(),s=0,l="";o;){var c=o.parentElement;if(o.hasAttribute("id")){l=l?"#".concat(o.getAttribute("id")," > ").concat(l):"#".concat(o.getAttribute("id"));break}if("config"===o.nodeName.toLowerCase()){l=l?"config > ".concat(l):"config";break}s=Array.prototype.indexOf.call(c.children,o)+1;l=l?"*:nth-child(".concat(s,") > ").concat(l):"*:nth-child(".concat(s,")");o=c}return l}return""},clone:function(){return new cv.ui.manager.model.XmlElement(this._node.cloneNode(!0),this.getSchemaElement(),this.getEditor())}},destruct:function(){this._node=null;this._schema=null;this._initialAttributes=null;this.__P_46_1=null;this._disposeObjects("_schemaElement")}});cv.ui.manager.model.XmlElement.$$dbClassInfo=e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){s=!0;a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new I(r||[]);return i(o,"_invoke",{value:y(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function h(){}function g(){}function m(){}var f={};l(f,a,(function(){return this}));var p=Object.getPrototypeOf,_=p&&p(p(E([])));_&&_!==t&&n.call(_,a)&&(f=_);var v=m.prototype=h.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function y(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return P()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}function C(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=u(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,i(v,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:g,configurable:!0}),g.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(x.prototype),l(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new x(c(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(q),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),q(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;q(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,i,r,o,s,"next",e)}function s(e){asyncGeneratorStep(a,i,r,o,s,"throw",e)}o(void 0)}))}}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.util.ResourceManager":{},"qx.io.request.Xhr":{},"qx.xml.Document":{},"cv.ui.manager.model.schema.Element":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.Schema",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);if(!e||!e.match(/\.xsd$/))throw new Error("no, empty or invalid filename given, can not instantiate without one");this.__filename=e;this.setStructure(e.endsWith("visu_config_tile.xsd")?"tile":"pure");this.__P_45_0={};this.__P_45_1={};this.__P_45_2={};this._cacheXSD()},statics:{__P_45_3:{},getInstance:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Object.prototype.hasOwnProperty.call(t.__P_45_3,e)){n.next=4;break}if((i=t.__P_45_3[e]=new cv.ui.manager.model.Schema(qx.util.ResourceManager.getInstance().toUri(e))).isLoaded()){n.next=4;break}return n.abrupt("return",new Promise((function(e,t){var n=setTimeout((function(){t(new Error("timeout loading schema file"))}),5e3);i.addListenerOnce("changeLoaded",(function(){clearTimeout(n);e(i)}))})));case 4:return n.abrupt("return",t.__P_45_3[e]);case 5:case"end":return n.stop()}}),n)})))()}},properties:{loaded:{check:"Boolean",init:!1,event:"changeLoaded"},structure:{check:["pure","tile"],apply:"_applyStructure"}},members:{__filename:null,__P_45_4:null,__P_45_0:null,__P_45_1:null,__P_45_2:null,__P_45_5:null,__P_45_6:null,_widgetNames:null,__P_45_7:null,__P_45_8:null,__P_45_9:null,_applyStructure:function(e){if("tile"===e){this.__P_45_7="config";this.__P_45_8="main";this.__P_45_9="cv-page"}else{this.__P_45_7="pages";this.__P_45_9="page"}},onLoaded:function(e,t){this.isLoaded()?e.call(t):this.addListenerOnce("changeLoaded",e,t)},_cacheXSD:function(){var e=this,t=new qx.io.request.Xhr(this.__filename);t.set({accept:"application/xml"});t.addListenerOnce("success",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n){var i,r,a,o,s,l,c,u,d,h;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=n.getTarget();(r=i.getResponse())&&"string"==typeof r&&(r=qx.xml.Document.fromString(r));o=_createForOfIteratorHelper(r.querySelectorAll("schema include"));t.prev=4;o.s();case 6:if((s=o.n()).done){t.next=17;break}l=s.value;t.next=10;return e.loadXml("resource/"+l.getAttribute("schemaLocation"));case 10:a=t.sent;c=l.parentElement;l.remove();u=_createForOfIteratorHelper(a.querySelectorAll("schema > *"));try{for(u.s();!(d=u.n()).done;){h=d.value;c.appendChild(h)}}catch(e){u.e(e)}finally{u.f()}case 15:t.next=6;break;case 17:t.next=22;break;case 19:t.prev=19;t.t0=t.catch(4);o.e(t.t0);case 22:t.prev=22;o.f();return t.finish(22);case 25:e.__P_45_4=r;e._parseXSD();case 27:case"end":return t.stop()}}),t,null,[[4,19,22,25]])})));return function(e){return t.apply(this,arguments)}}());t.send()},loadXml:function(e){return _asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var i=new qx.io.request.Xhr(e);i.set({accept:"application/xml"});i.addListenerOnce("success",(function(e){var n=e.getTarget().getResponse();n&&"string"==typeof n&&(n=qx.xml.Document.fromString(n));t(n)}));i.addListenerOnce("statusError",(function(e){var t=e.getTarget();n(new Error(t.getStatusText()))}));i.send()})));case 1:case"end":return t.stop()}}),t)})))()},_parseXSD:function(){var e=this;this.__P_45_4.querySelectorAll("schema > element").forEach((function(t){var n=t.getAttribute("name");e.__P_45_0[n]=new cv.ui.manager.model.schema.Element(t,e)}));this.setLoaded(!0)},getElementNode:function(e){if(Object.prototype.hasOwnProperty.call(this.__P_45_0,e))return this.__P_45_0[e];throw new Error("schema/xsd appears to be invalid, element "+e+" not allowed on root level")},getReferencedNode:function(e,t,n){if(Object.prototype.hasOwnProperty.call(this.__P_45_1,e)&&Object.prototype.hasOwnProperty.call(this.__P_45_1[e],t))return this.__P_45_1[e][t];var i="simpleType"===e?"complexType":"simpleType";if(!n&&Object.prototype.hasOwnProperty.call(this.__P_45_1,i)&&Object.prototype.hasOwnProperty.call(this.__P_45_1[i],t))return this.__P_45_1[i][t];var r="schema > "+e+'[name="'+t+'"]',a=this.__P_45_4.querySelector(r);if(!a&&!n)try{a=this.getReferencedNode(i,t,!0)}catch(e){}if(!a)throw new Error("schema/xsd appears to be invalid, reference "+e+' "'+t+'" can not be found');a.hasAttribute("ref")&&(a=this.getReferencedNode(e,a.getAttribute("ref")));Object.prototype.hasOwnProperty.call(this.__P_45_1,e)||(this.__P_45_1[e]={});this.__P_45_1[e][t]=a;return a},getTypeNode:function(e,t){if(Object.prototype.hasOwnProperty.call(this.__P_45_2,e)&&Object.prototype.hasOwnProperty.call(this.__P_45_2[e],t))return this.__P_45_2[e][t];var n=this.__P_45_4.querySelector(e+'Type[name="'+t+'"]');if(!n)throw new Error("schema/xsd appears to be invalid, "+e+'Type "'+t+'" can not be found');void 0===this.__P_45_2[e]&&(this.__P_45_2[e]={});this.__P_45_2[e][t]=n;return n},getTextNodeSchemaElement:function(){if(null===this.__P_45_5){var e=this.__P_45_4.createElement("element");e.setAttribute("name","#text");e.setAttribute("type","xsd:string");this.__P_45_5=new cv.ui.manager.model.schema.Element(e,this)}return this.__P_45_5},getCommentNodeSchemaElement:function(){if(null===this.__P_45_6){var e=this.__P_45_4.createElement("element");e.setAttribute("name","#comment");e.setAttribute("type","xsd:string");e.setAttribute("minOccurs","0");e.setAttribute("maxOccurs","unbounded");this.__P_45_6=new cv.ui.manager.model.schema.Element(e,this)}return this.__P_45_6},getSchemaDOM:function(){return this.__P_45_4},getWidgetNames:function(){if(!this._widgetNames){var e=this.getElementNode(this.__P_45_7),t=e;this.__P_45_8&&(t=e.getSchemaElementForElementName(this.__P_45_8));var n=t.getSchemaElementForElementName(this.__P_45_9);this._widgetNames=Object.keys(n.getAllowedElements()).filter((function(e){return!e.startsWith("#")&&"layout"!==e}))}return this._widgetNames},isRoot:function(e){return e===this.__P_45_7},isPage:function(e){return this.__P_45_9}},destruct:function(){this.__P_45_4=null;this._disposeObjects("__P_45_6","__P_45_5");this._disposeMap("__P_45_0");this.__P_45_1=null;this.__P_45_2=null;this._widgetNames=null}});cv.ui.manager.model.Schema.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.model.XmlElement":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.ElementChange",{extend:qx.core.Object,construct:function(e,t,n,i){qx.core.Object.constructor.call(this);this.setTitle(e);this.setElement(t);this.setChanges(n);this.setChangeType(i||"content")},properties:{element:{check:"cv.ui.manager.model.XmlElement"},title:{check:"String"},changes:{check:"Array"},changeType:{check:["content","created","deleted","moved"],init:["content"]}},members:{undo:function(){var e,t=this.getElement(),n=!1;if(!t.isDisposed())switch(this.getChangeType()){case"content":this.getChanges().forEach((function(e){e instanceof cv.ui.manager.model.ElementChange?e.undo():t.setAttribute(e.attribute,e.old)}));t.updateModified();n=!0;break;case"deleted":(e=this.getChanges()[0]).parent&&(n=e.parent.insertChild(e.child,e.index,!0));break;case"created":if((e=this.getChanges()[0]).child){e.child.remove(!0);n=!0}break;case"moved":n=(e=this.getChanges()[0]).child.moveTo(e.oldParent,e.oldIndex,!0)}return n},redo:function(){var e,t=this.getElement(),n=!1;if(!t.isDisposed())switch(this.getChangeType()){case"content":this.getChanges().forEach((function(e){e instanceof cv.ui.manager.model.ElementChange?e.redo():t.setAttribute(e.attribute,e.value)}));t.updateModified();n=!0;break;case"deleted":if(t){t.remove(!0);n=!0}break;case"created":(e=this.getChanges()[0]).parent&&(n=e.parent.insertChild(e.child,e.index,!0));break;case"moved":n=(e=this.getChanges()[0]).child.moveTo(e.parent,e.index,!0)}return n}}});cv.ui.manager.model.ElementChange.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",construct:!0,require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.ui.tree.VirtualTreeItem":{construct:!0,require:!0},"qx.bom.client.Device":{construct:!0,require:!0},"cv.ui.manager.basic.Image":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.basic.Atom":{},"cv.theme.dark.Images":{},"qx.ui.form.MenuButton":{},"cv.ui.manager.contextmenu.ConfigElement":{},"qx.ui.core.Spacer":{}},environment:{provided:[],required:{"device.touch":{construct:!0,className:"qx.bom.client.Device"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.tree.VirtualElementItem",{extend:qx.ui.tree.VirtualTreeItem,construct:function(e){qx.ui.tree.VirtualTreeItem.constructor.call(this,e);qx.core.Environment.get("device.touch")&&this.addState("touch")},properties:{appearance:{refine:!0,init:"element-tree-item"},name:{check:"String",init:"",event:"changeName",apply:"_applyName"},temporary:{check:"Boolean",init:!1,apply:"_applyTemporary"},status:{check:["valid","error","comment"],nullable:!0,apply:"_applyStatus"},editable:{check:"Boolean",init:!1},sortable:{check:"Boolean",init:!1,apply:"_applySortable"},droppable:{refine:!0,init:!0},dragging:{check:"Boolean",init:!1,apply:"_applyDragging"}},events:{edit:"qx.event.type.Data",action:"qx.event.type.Data"},members:{_forwardStates:{selected:!0,touch:!0},__P_52_0:!1,_applyName:function(e){this.getContentElement().setAttribute("data-nodename",e)},_applyDragging:function(e){e?this.addState("drag"):this.removeState("drag")},_applyModel:function(e){if(qx.core.Environment.get("device.touch"))if(e){var t=this.getChildControl("menu-button");t.show();var n=t.getMenu();n.setEditor(e.getEditor());n.setElement(e)}else this.getChildControl("menu-button").hide();else this.hasChildControl("menu-button")&&this.getChildControl("menu-button").exclude()},_applyTemporary:function(e){e?this.addState("temporary"):this.removeState("temporary")},_applySortable:function(e){e?this.getChildControl("move-button").show():this.getChildControl("move-button").hide()},_applyStatus:function(e,t){var n=this.getChildControl("icon"),i=this.getChildControl("label");if(t){n.removeState(t);i.removeState(t)}if(e){n.addState(e);i.addState(e)}},_addWidgets:function(){cv.ui.manager.tree.VirtualElementItem.superclass.prototype._addWidgets.call(this);var e=this.getChildControl("open",!0);e&&qx.core.Environment.get("device.touch")&&e.getContentElement().addClass("touch-tree-open-icon")},_createChildControlImpl:function(e,t){var n,i=this;switch(e){case"icon":n=(new cv.ui.manager.basic.Image).set({forceScale:!0,alignY:"middle",anonymous:!0,source:this.getIcon(),maxWidth:22,maxHeight:22});break;case"buttons":(n=new qx.ui.container.Composite(new qx.ui.layout.HBox(8))).setAnonymous(!0);break;case"move-button":(n=new qx.ui.basic.Atom("",cv.theme.dark.Images.getIcon("drag-handle",qx.core.Environment.get("device.touch")?36:18))).setToolTipText(this.tr("Drag to move"));n.setAnonymous(!0);n.setShow("icon");this.getChildControl("buttons").addAt(n,0);break;case"menu-button":(n=new qx.ui.form.MenuButton("",cv.theme.dark.Images.getIcon("menu",qx.core.Environment.get("device.touch")?24:14),new cv.ui.manager.contextmenu.ConfigElement)).getMenu().addListener("action",(function(e){i.fireDataEvent("action",e.getData())}));this.getChildControl("buttons").addAt(n,1)}return n||cv.ui.manager.tree.VirtualElementItem.superclass.prototype._createChildControlImpl.call(this,e)},addLabel:function(e){var t=this.getChildControl("label");this.__P_52_0&&this._remove(t);e?this.setLabel(e):t.setValue(this.getLabel());this._add(t);this._add(new qx.ui.core.Spacer,{flex:1});var n=this.getChildControl("buttons");this._add(n);this.__P_52_0=!0}}});cv.ui.manager.tree.VirtualElementItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menu.Menu":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"cv.ui.manager.model.XmlElement":{},"cv.ui.manager.editor.Tree":{},"cv.theme.dark.Images":{},"qx.ui.menu.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.contextmenu.ConfigElement",{extend:qx.ui.menu.Menu,construct:function(e){qx.ui.menu.Menu.constructor.call(this);e&&this.setEditor(e);this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this._init()},events:{action:"qx.event.type.Data"},properties:{element:{check:"cv.ui.manager.model.XmlElement",nullable:!0,apply:"_applyElement"},editor:{check:"cv.ui.manager.editor.Tree",nullable:!0,apply:"_applyEditor"}},members:{_commandGroup:null,_applyEditor:function(e,t){t&&t.removeListener("changeClipboard",this._maintainClipboardButtons,this);e&&e.addListener("changeClipboard",this._maintainClipboardButtons,this)},_applyElement:function(e,t){var n=this;if(t){t.removeRelatedBindings(this.getChildControl("delete-button"));t.removeRelatedBindings(this.getChildControl("cut-button"))}if(e){var i=e.isEditable();this.getChildControl("copy-button").setEnabled(!0);if(i){e.bind("deletable",this.getChildControl("delete-button"),"enabled");e.bind("deletable",this.getChildControl("cut-button"),"enabled");this.getChildControl("view-button").exclude();this.getChildControl("edit-button").show();this.getChildControl("edit-button").setEnabled(e.getShowEditButton());var r=e.getAddableChildren(!0);this.getChildControl("create-button").setEnabled(r.length>0)}else{this.getChildControl("delete-button").setEnabled(!1);this.getChildControl("cut-button").setEnabled(!1);this.getChildControl("create-button").setEnabled(!1);this.getChildControl("view-button").show();this.getChildControl("view-button").setEnabled(e.getShowEditButton());this.getChildControl("edit-button").exclude()}}else["edit","delete","cut","copy","paste","create"].forEach((function(e){return n.getChildControl(e+"-button").setEnabled(!1)}));this._maintainClipboardButtons()},_init:function(){var e=this;["view","edit","delete"].forEach((function(t){return e.add(e.getChildControl(t+"-button"))}));this.addSeparator();["cut","copy","paste"].forEach((function(t){return e.add(e.getChildControl(t+"-button"))}));this.addSeparator();this.add(this.getChildControl("create-button"))},_maintainClipboardButtons:function(){var e=this.getEditor().getClipboard(),t=this.getElement(),n=!!t&&t.isEditable()&&e instanceof cv.ui.manager.model.XmlElement;if(n){n=t.getAddableChildren(!0).includes(e.getName())&&t.isChildAllowedAtPosition(e,Number.POSITIVE_INFINITY)}this.getChildControl("paste-button").setEnabled(n)},_createChildControlImpl:function(e,t){var n;switch(e){case"view-button":(n=this.__P_30_0("view",this.tr("View"),cv.theme.dark.Images.getIcon("view",18))).exclude();break;case"edit-button":n=this.__P_30_0("edit",this.tr("Edit"),cv.theme.dark.Images.getIcon("edit",18));break;case"delete-button":n=this.__P_30_0("delete",this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18));break;case"cut-button":n=this.__P_30_0("cut",this.tr("Cut"),cv.theme.dark.Images.getIcon("cut",18));break;case"copy-button":n=this.__P_30_0("copy",this.tr("Copy"),cv.theme.dark.Images.getIcon("copy",18));break;case"paste-button":n=this.__P_30_0("paste",this.tr("Paste"),cv.theme.dark.Images.getIcon("paste",18));break;case"create-menu":n=new qx.ui.menu.Menu;break;case"create-button":n=this.__P_30_0("create",this.tr("Add child"),cv.theme.dark.Images.getIcon("add",18))}return n||cv.ui.manager.contextmenu.ConfigElement.superclass.prototype._createChildControlImpl.call(this,e)},__P_30_0:function(e,t,n,i,r){var a=this,o=new qx.ui.menu.Button(t,n,i,r);o.addListener("execute",(function(){a.fireDataEvent("action",{action:e,element:a.getElement()})}));return o}},destruct:function(){this._commandGroup=null}});cv.ui.manager.contextmenu.ConfigElement.$$dbClassInfo=e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){s=!0;a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}(function(){var $$dbClassInfo={dependsOn:{"qx.core.Environment":{defer:"load",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Form":{require:!0},"qx.data.marshal.Json":{},"qx.ui.form.Form":{},"qx.data.controller.Object":{},"qx.ui.form.TextArea":{},"qx.ui.form.TextField":{},"cv.ui.manager.form.SourceCodeField":{},"qx.ui.form.DateField":{},"qx.ui.form.PasswordField":{},"qx.ui.form.ComboBox":{},"qx.ui.form.ListItem":{},"qx.ui.form.VirtualComboBox":{},"cv.ui.manager.form.Option":{},"qx.data.Array":{},"cv.ui.manager.form.ListItem":{},"qx.ui.form.SelectBox":{},"qx.data.controller.List":{},"cv.ui.manager.form.VirtualSelectBox":{},"qx.ui.form.RadioGroup":{},"qx.ui.form.RadioButton":{},"cv.ui.manager.form.CheckBox":{},"qx.ui.form.Spinner":{},"qx.util.format.NumberFormat":{},"qx.util.Validate":{},"qx.ui.form.validation.AsyncValidator":{},"qx.lang.Type":{},"qx.locale.Manager":{},"cv.ui.manager.form.ElementFormRenderer":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.event.Timer":{},"qx.util.Serializer":{}},environment:{provided:[],required:{"module.objectid":{}}}};qx.Bootstrap.executePendingDefers($$dbClassInfo);qx.Class.define("cv.ui.manager.form.ElementForm",{extend:qxl.dialog.Form,properties:{labelColumnWidth:{refine:!0,init:300},useBlocker:{refine:!0,init:!0},blockerOpacity:{refine:!0,init:.9},blockerColor:{refine:!0,init:"#585858"}},members:{__P_38_0:null,__P_38_1:null,_rootListenerId:null,_applyFormData:function _applyFormData(formData,old){var _this=this,firstWidget;this.__P_38_0={map:{},inverse:{}};if(this._formController)try{this.getModel().removeAllBindings();this._formController.dispose()}catch(e){}if(this._form)try{this._form.getValidationManager().removeAllBindings();this._form.dispose()}catch(e){}this._formContainer.removeAll();if(formData){if(this.getModel()){this.getModel().removeAllBindings();this.getModel().dispose()}var modelData={},_iterator=_createForOfIteratorHelper(Object.getOwnPropertyNames(formData)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){for(var key=_step.value,_i=0,mappedKey=key.replaceAll(/[-_\.#]+([a-z])/g,(function(e,t){return t.toUpperCase()}))+_i++;Object.prototype.hasOwnProperty.call(modelData,mappedKey);)mappedKey=mappedKey.substr(0,mappedKey.length-1)+_i++;if(mappedKey!==key){this.__P_38_0.map[mappedKey]=key;this.__P_38_0.inverse[key]=mappedKey}modelData[mappedKey]=void 0!==formData[key].value?formData[key].value:null}}catch(e){_iterator.e(e)}finally{_iterator.f()}var model=qx.data.marshal.Json.createModel(modelData);this.setModel(model);this._form=new qx.ui.form.Form;if(!0===qx.core.Environment.get("module.objectid")){this._form.setQxObjectId("form");this.addOwnedQxObject(this._form)}this._formController=new qx.data.controller.Object(model);this._onFormReady(this._form);var i=0,atom,_iterator2=_createForOfIteratorHelper(Object.getOwnPropertyNames(formData)),_step2;try{var _loop=function _loop(){var key=_step2.value,mappedKey=_this.__P_38_0.inverse[key],fieldData=formData[key],formElement=null,elementModel=null,elementModelReady=null;switch(fieldData.type.toLowerCase()){case"groupheader":_this._form.addGroupHeader(fieldData.value);break;case"textarea":formElement=new qx.ui.form.TextArea;formElement.setMinimalLineHeight(fieldData.lines);if(!0===fieldData.autoSize){formElement.setAutoSize(!0);formElement.setMinHeight(16*fieldData.lines)}else formElement.setHeight(16*fieldData.lines);formElement.setLiveUpdate(!0);break;case"textfield":formElement=new qx.ui.form.TextField;fieldData.maxLength&&formElement.setMaxLength(fieldData.maxLength);formElement.setLiveUpdate(!0);break;case"sourceeditor":formElement=new cv.ui.manager.form.SourceCodeField("",fieldData.language);if(!0===fieldData.autoSize){formElement.setAutoSize(!0);formElement.setMinHeight(16*fieldData.lines)}else formElement.setHeight(16*fieldData.lines);break;case"datefield":case"date":formElement=new qx.ui.form.DateField;fieldData.dateFormat&&formElement.setDateFormat(fieldData.dateFormat);break;case"passwordfield":case"password":formElement=new qx.ui.form.PasswordField;formElement.getContentElement().setAttribute("autocomplete","password");break;case"combobox":formElement=new qx.ui.form.ComboBox;var parseComboOptions=function(e){Array.isArray(e)?e.forEach((function(e){var t=new qx.ui.form.ListItem(e.label,e.icon);formElement.add(t)})):"object"===_typeof(e)&&Object.keys(e).forEach((function(t){var n=new qx.ui.form.ListItem(t);n.set({anonymous:!0,appearance:"optiongroup"});formElement.add(n);e[t].forEach((function(e){var t=new qx.ui.form.ListItem(e.label,e.icon,e.value);formElement.add(t)}))}))};if(fieldData.options instanceof Promise){formElement.setPlaceholder(_this.tr("Loading..."));elementModelReady=fieldData.options.then((function(e){formElement.setPlaceholder(fieldData.placeholder);parseComboOptions(e);return!0}),_this).catch((function(e){_this.error(e);formElement.setPlaceholder(_this.tr("Possible values could no be retrieved, please check browser console for error details"))}),_this)}else parseComboOptions(fieldData.options);break;case"virtualcombobox":formElement=new qx.ui.form.VirtualComboBox;formElement.set({iconPath:"icon",labelPath:"value"});fieldData.validation&&formElement.getChildControl("textfield").setLiveUpdate(!0);var selection=formElement.getChildControl("dropdown").getSelection();selection.addListener("change",(function(e){var t=selection.getItem(0);t&&t instanceof cv.ui.manager.form.Option?_this.__P_38_1=t.getHints():_this.__P_38_1=null}));elementModel=new qx.data.Array;var parseVComboOptions=function(e){Array.isArray(e)?e.forEach((function(e){elementModel.push(new cv.ui.manager.form.Option(e.label+(e.value?" (".concat(e.value,")"):""),e.icon,e.value,e.hints))})):"object"===_typeof(e)&&Object.keys(e).forEach((function(t){var n=new cv.ui.manager.form.Option(t);n.setType("group");elementModel.push(n);e[t].forEach((function(e){elementModel.push(new cv.ui.manager.form.Option(e.label+(e.value?" (".concat(e.value,")"):""),e.icon,e.value,e.hints))}))}))};if(fieldData.options instanceof Promise){formElement.setPlaceholder(_this.tr("Loading..."));fieldData.options.then((function(e){formElement.setPlaceholder(fieldData.placeholder);parseVComboOptions(e)}),_this).catch((function(e){_this.error(e);formElement.setPlaceholder(_this.tr("Possible values could no be retrieved, please check browser console for error details"))}),_this)}else parseVComboOptions(fieldData.options);formElement.setDelegate({createItem:function(){return new cv.ui.manager.form.ListItem},bindItem:function(e,t,n){e.bindProperty("icon","icon",null,t,n);e.bindProperty("label","label",null,t,n);e.bindProperty("type","appearance",{converter:function(e){switch(e){case"state":return"state-option";case"error":return"error-option";case"group":return"optiongroup";default:return"listitem"}}},t,n);e.bindProperty("type","anonymous",{converter:function(e){return"group"===e}},t,n)}});formElement.setModel(elementModel);break;case"selectbox":formElement=new qx.ui.form.SelectBox;if(fieldData.options instanceof Promise){atom=formElement.getChildControl("atom");atom.setLabel(_this.tr("Loading..."));atom.addState("loading");elementModelReady=fieldData.options.then((function(e){var t=formElement.getChildControl("atom");t.resetLabel();t.removeState("loading");new qx.data.controller.List(qx.data.marshal.Json.createModel(e),formElement,"label");return!0}),_this).catch((function(e){_this.error(e);var t=formElement.getChildControl("atom");t.setLabel(_this.tr("Possible values could no be retrieved, please check browser console for error details"));t.removeState("loading");t.addState("error")}),_this)}else new qx.data.controller.List(qx.data.marshal.Json.createModel(fieldData.options),formElement,"label");break;case"virtualselectbox":formElement=new cv.ui.manager.form.VirtualSelectBox;elementModel=new qx.data.Array;if(fieldData.options)if(fieldData.options instanceof Promise){atom=formElement.getChildControl("atom");atom.setLabel(_this.tr("Loading..."));atom.addState("loading");elementModelReady=fieldData.options.then((function(e){var t=formElement.getChildControl("atom");t.resetLabel();t.removeState("loading");e.forEach((function(e){elementModel.push(new cv.ui.manager.form.Option(e.label,e.icon,e.value))}));return!0})).catch((function(e){_this.error(e);var t=formElement.getChildControl("atom");t.setLabel(_this.tr("Possible values could no be retrieved, please check browser console for error details"));t.removeState("loading");t.addState("error")}),_this)}else fieldData.options.forEach((function(e){elementModel.push(new cv.ui.manager.form.Option(e.label,e.icon,e.value))}));formElement.setDelegate({createItem:function(){return new cv.ui.manager.form.ListItem},bindItem:function(e,t,n){e.bindDefaultProperties(t,n);e.bindProperty("value","model",null,t,n)}});formElement.set({labelPath:"label",iconPath:"icon",iconOptions:{converter:function(e){return"function"==typeof e?e().trim():e}},model:elementModel});break;case"radiogroup":formElement=new qx.ui.form.RadioGroup;fieldData.orientation&&formElement.setUserData("orientation",fieldData.orientation);fieldData.options.forEach((function(e){var t=new qx.ui.form.RadioButton(e.label);t.setUserData("value",void 0!==e.value?e.value:e.label);formElement.add(t)}),_this);break;case"label":formElement=new qx.ui.form.TextField;formElement.setUserData("excluded",!0);break;case"checkbox":formElement=new cv.ui.manager.form.CheckBox;formElement.setTriState(!0);break;case"spinner":formElement=new qx.ui.form.Spinner;fieldData.min&&formElement.setMinimum(fieldData.min);fieldData.max&&formElement.setMaximum(fieldData.max);fieldData.step&&formElement.setSingleStep(fieldData.step);if(fieldData.fractionsDigits){var fd=fieldData.fractionsDigits,nf=new qx.util.format.NumberFormat;fd.min&&nf.setMinimumFractionDigits(fd.min);fd.max&&nf.setMaximumFractionDigits(fd.max);formElement.setNumberFormat(nf)}break;default:_this.error("Invalid form field type:"+fieldData.type)}formElement.setUserData("key",key);formElement.setUserData("mappedKey",mappedKey);0===i&&(firstWidget=formElement);i++;if("string"==typeof fieldData.type){var options=null,reverseOptions=null,bidirectional=!0,handled=!1;switch(fieldData.type.toLowerCase()){case"textarea":case"textfield":case"passwordfield":case"combobox":case"virtualcombobox":case"datefield":case"spinner":case"sourceeditor":reverseOptions={converter:function(e){this.getValidationManager().validate();return e}.bind(_this._form)};break;case"virtualselectbox":options={converter:function(e){if("string"==typeof e){var t;this.getModel().some((function(n){if(n.getValue()===e){t=n;return!0}return!1}));return t}return e}.bind(formElement)};reverseOptions={converter:function(e){this.getValidationManager().validate();return e?e.getValue():null}.bind(_this._form)};break;case"checkbox":break;case"selectbox":_this._formController.addTarget(formElement,"selection",mappedKey,!0,{converter:function(e){var t=null,n=this.getSelectables();n.some((function(n){if(n.getModel().getValue()===e){t=n;return!0}return!1}),this);return t?[t]:[n[0]]}.bind(formElement)},{converter:function(e){return e[0].getModel().getValue()}});handled=!0;break;case"radiogroup":options={converter:function(e){var t=this.getSelectables(),n=[];e&&t.forEach((function(t){t.getUserData("value")===e&&(n=[t])}),this);return n}.bind(formElement)};reverseOptions={converter:function(e){return e[0].getUserData("value")}}}handled||(elementModelReady?elementModelReady.then((function(){_this._formController.addTarget(formElement,"value",mappedKey,bidirectional,options,reverseOptions)})):_this._formController.addTarget(formElement,"value",mappedKey,bidirectional,options,reverseOptions))}var validator=null;if(formElement&&fieldData.validation){fieldData.validation.required&&formElement.setRequired(!0);if(fieldData.validation.validator){validator=fieldData.validation.validator;"string"==typeof validator?qx.util.Validate[validator]?validator=qx.util.Validate[validator]():"/"===validator.charAt(0)?validator=qx.util.Validate.regExp(new RegExp(validator.substr(1,validator.length-2)),fieldData.validation.errorMessage):_this.error("Invalid string validator."):validator instanceof qx.ui.form.validation.AsyncValidator||"function"==typeof validator||_this.error("Invalid validator.")}if(qx.lang.Type.isString(fieldData.validation.proxy)&&qx.lang.Type.isString(fieldData.validation.method)){var proxy=fieldData.validation.proxy.replace(/;\n/g,"");try{eval("proxy = "+proxy+";")}catch(e){_this.warn("Invalid proxy name")}if("function"==typeof proxy){var method=fieldData.validation.method,message=fieldData.validation.invalidMessage,validationFunc=function(e,t){if(!e.__P_38_2){e.__P_38_2=!0;proxy(method,[t],(function(t){e.setValid(t,message||qx.locale.Manager.tr("Value is invalid"));e.__P_38_2=!1}))}};validator=new qx.ui.form.validation.AsyncValidator(validationFunc)}}}void 0!==fieldData.width&&formElement.setWidth(fieldData.width);void 0!==fieldData.placeholder&&formElement.setPlaceholder(fieldData.placeholder);void 0!==fieldData.enabled&&formElement.setEnabled(fieldData.enabled);void 0!==fieldData.help&&formElement.setUserData("help",fieldData.help);if(qx.lang.Type.isObject(fieldData.events))for(var type in fieldData.events)try{var func=eval("("+fieldData.events[type]+")");if(!qx.lang.Type.isFunction(func))throw new Error;formElement.addListener(type,func,formElement)}catch(e){_this.warn("Invalid '"+type+"' event handler for form element '"+key+"'.")}var label=fieldData.label;_this._form.add(formElement,label,validator);if(!0===qx.core.Environment.get("module.objectid")){formElement.setQxObjectId(key);_this._form.addOwnedQxObject(formElement)}};for(_iterator2.s();!(_step2=_iterator2.n()).done;)_loop()}catch(e){_iterator2.e(e)}finally{_iterator2.f()}var view=new cv.ui.manager.form.ElementFormRenderer(this._form);view.getLayout().setColumnFlex(0,0);view.getLayout().setColumnMaxWidth(0,this.getLabelColumnWidth());view.getLayout().setColumnFlex(1,1);view.getLayout().set({spacingX:8});view.setAllowGrowX(!0);var scroll=new qx.ui.container.Scroll(view);scroll.setMaxHeight(qx.bom.Document.getHeight()-132);this._rootListenerId=qx.core.Init.getApplication().getRoot().addListener("resize",(function(){scroll.setMaxHeight(qx.bom.Document.getHeight()-132)}));view.bind("width",scroll,"width");view.bind("height",scroll,"height");this._formContainer.add(scroll);this._form.getValidationManager().validate();firstWidget&&qx.event.Timer.once((function(){firstWidget.focus()}),this,200)}},_handleOk:function(){var e=this;this.hide();if(this.getCallback()){var t=qx.util.Serializer.toNativeObject(this.getModel());Object.keys(this.__P_38_0.map).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)){t[e.__P_38_0.map[n]]=t[n];delete t[n]}}));this.__P_38_1&&Object.keys(this.__P_38_1).forEach((function(n){return t[n]=e.__P_38_1[n]}));this.getCallback().call(this.getContext(),t)}this.resetCallback()}},destruct:function(){if(this._rootListenerId){qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);this._rootListenerId=null}}});cv.ui.manager.form.ElementForm.$$dbClassInfo=$$dbClassInfo})();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.model.Schema":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Base",{extend:qx.core.Object,type:"abstract",construct:function(e,t){qx.core.Object.constructor.call(this);this.setNode(e);this.setSchema(t);this._bounds={min:void 0,max:void 0};this._allowedElements={};this._sortedContent=[];this._subGroupings=[]},properties:{type:{check:"String",init:"unknown"},elementsHaveOrder:{check:"Boolean",init:!1},schema:{check:"cv.ui.manager.model.Schema",nullable:!1},node:{check:"Node",nullable:!1},subGroupings:{check:"Array"}},members:{_bounds:null,_regexCache:null,_allowedElements:null,_sortedContent:null,_subGroupings:null,parse:function(){var e=this.getNode(),t=e.hasAttribute("minOccurs")?e.getAttribute("minOccurs"):1,n=e.hasAttribute("maxOccurs")?e.getAttribute("maxOccurs"):1;this._bounds={min:parseInt(t),max:"unbounded"===n?Number.POSITIVE_INFINITY:parseInt(n)}},isElementAllowed:function(e){if(void 0!==this._allowedElements[e])return!0;for(var t=0;t<this._subGroupings.length;++t)if(!0===this._subGroupings[t].isElementAllowed(e))return!0;return!1},getSchemaElementForElementName:function(e){if(void 0!==this._allowedElements[e])return this._allowedElements[e];for(var t=0;t<this._subGroupings.length;++t)if(!0===this._subGroupings[t].isElementAllowed(e))return this._subGroupings[t].getSchemaElementForElementName(e)},getRequiredElements:function(){if(0===this._bounds.min)return[];for(var e=[],t=0,n=Object.entries(this._allowedElements);t<n.length;t++){var i=_slicedToArray(n[t],2),r=i[0],a=i[1];if(a.getBounds().min>0)for(var o=0;o<a.getBounds().min;++o)e.push(r)}this._subGroupings.forEach((function(t){var n=t.getRequiredElements();if(n.length>0)for(var i=0;i<n.length;++i)e.push(n[i])}));return e},getAllowedElements:function(){for(var e={},t=0,n=Object.entries(this._allowedElements);t<n.length;t++){var i=_slicedToArray(n[t],2),r=i[0],a=i[1];e[r]=a}this._subGroupings.forEach((function(t){Object.assign(e,t.getAllowedElements())}));return e},getAllowedElementsSorting:function(e){return{}},getRegex:function(e,t){return""},hasMultiLevelBounds:function(){return this._subGroupings.length>0},getBounds:function(){return this._bounds},getBoundsForElementName:function(e){return this._bounds},regexFromString:function(e,t){void 0===t&&(t="");return new RegExp(e,t)}}});cv.ui.manager.model.schema.Base.$$dbClassInfo=e}();function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}!function(){var e={dependsOn:{"qx.Mixin":{usage:"dynamic",require:!0},"qx.locale.Manager":{construct:!0},"cv.ui.manager.model.schema.DocumentationMapping":{}}};qx.Bootstrap.executePendingDefers(e);qx.Mixin.define("cv.ui.manager.model.schema.MAnnotation",{construct:function(){this.__P_49_0=new RegExp(":ref:[`'](.+?)[`']","g");this.__P_49_1="de"===qx.locale.Manager.getInstance().getLanguage()?"de":"en"},members:{__P_49_2:null,__P_49_0:null,__P_49_1:null,__P_49_3:null,__P_49_4:function(e,t){var n=[],i=e.ownerDocument,r=i.createNSResolver(i.documentElement),a=i.evaluate(t,e,r,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);try{for(var o=a.iterateNext();o;){n.push(o.textContent.replaceAll(/``([^`]+)``/g,"<code>$1</code>"));o=a.iterateNext()}}catch(e){this.error("Error: Document tree modified during iteration "+e)}return n},getAppinfo:function(){if(null!==this.__P_49_2)return this.__P_49_2;var e=this.getNode(),t=this.__P_49_4(e,"xsd:annotation/xsd:appinfo"),n=this.getType();if("element"===n)0===e.querySelectorAll(":scope > complexType").length&&t.push.apply(t,_toConsumableArray(this.__P_49_4(this._type,"xsd:annotation/xsd:appinfo")));else if("attribute"===n&&e.hasAttribute("ref")){var i=e.getAttribute("ref"),r=this.getSchema().getReferencedNode("attribute",i);t.push.apply(t,_toConsumableArray(this.__P_49_4(r,"xsd:annotation/xsd:appinfo")))}this.__P_49_2=t;return t},getDocumentation:function(){var e=this;if(null!==this.__P_49_3)return this.__P_49_3;var t=this.getNode(),n="xsd:annotation/xsd:documentation[@xml:lang='"+qx.locale.Manager.getInstance().getLanguage()+"']",i=this.__P_49_4(t,n),r=this.getType();if("element"===r){if(0===t.querySelectorAll(":scope > complexType").length){var a;(a=i).push.apply(a,_toConsumableArray(this.__P_49_4(this._type,n)))}}else if("attribute"===r&&t.hasAttribute("ref")){var o,s=t.getAttribute("ref"),l=this.getSchema().getReferencedNode("attribute",s);(o=i).push.apply(o,_toConsumableArray(this.__P_49_4(l,n)));i=i.map((function(t){return e.createDocumentationWebLinks(t)}))}this.__P_49_3=i;return i},createDocumentationWebLinks:function(e){var t=this.__P_49_1;return e.replace(this.__P_49_0,(function(e,n){var i=n.match(/^(.*?) *<([^<]*)>$/),r=i?i[1]:n,a=i?i[2]:n,o=cv.ui.manager.model.schema.DocumentationMapping.MAP[a];return o?'<a class="doclink" target="_blank" href="'+cv.ui.manager.model.schema.DocumentationMapping.MAP._base+t+o+'">'+r+"</a>":r}))}},destruct:function(){this.__P_49_2=null;this.__P_49_3=null;this.__P_49_0=null}});cv.ui.manager.model.schema.MAnnotation.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.MAnnotation":{require:!0},"cv.ui.manager.model.schema.SimpleType":{},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{},"cv.ui.manager.model.schema.Group":{},"cv.ui.manager.model.schema.Any":{},"cv.ui.manager.model.schema.Attribute":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Element",{extend:cv.ui.manager.model.schema.Base,include:cv.ui.manager.model.schema.MAnnotation,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},statics:{getElementName:function(e,t){if(e.hasAttribute("name"))return e.getAttribute("name");if(e.hasAttribute("ref")){var n=e.getAttribute("ref"),i=t.getReferencedNode("element",n);if(1!==i.length)throw new Error("schema/xsd appears to be invalid, can not find element "+n);return i.getAttribute("name")}return"unknown"},getTypeNode:function(e,t){var n;e.hasAttribute("type")?n=e.getAttribute("type").match(/^xsd:/)?e:t.getTypeNode("complex",e.getAttribute("type")):e.hasAttribute("ref")||(n=e.querySelector(":scope > complexType"));return n},sortChildNodes:function(e){return function(t,n){var i=e[t.name],r=e[n.name];if(void 0===i||void 0===r)return 0;if(i===r)return 0;"string"!=typeof i&&(i=i.toString());"string"!=typeof r&&(r=r.toString());for(var a=i.split("."),o=r.split("."),s=0;s<a.length;++s){if(a[s]<o[s])return-1;if(a[s]>o[s])return 1}return 0}}},properties:{type:{refine:!0,init:"element"},name:{check:"String",init:""},defaultValue:{check:"String",nullable:!0},sortable:{check:"Boolean",init:!1,event:"changeSortable"},mixed:{check:"Boolean",init:!1}},members:{__P_48_0:!1,__P_48_1:null,__P_48_2:null,__P_48_3:null,_type:null,parse:function(){cv.ui.manager.model.schema.Element.superclass.prototype.parse.call(this);var e=this.getNode(),t=this.getSchema();this._type=cv.ui.manager.model.schema.Element.getTypeNode(e,t);this.setName(cv.ui.manager.model.schema.Element.getElementName(e,t));e.hasAttribute("default")&&this.setDefaultValue(e.getAttribute("default"));this.setMixed(this._type.hasAttribute("mixed")&&"true"===this._type.getAttribute("mixed"))},getAllowedContent:function(){if(null!==this.__P_48_1)return this.__P_48_1;var e=this.getSchema(),t={_grouping:void 0,_text:!1};if(this._type.querySelectorAll(":scope > simpleContent").length>0)t._text=new cv.ui.manager.model.schema.SimpleType(this._type.querySelector(":scope > simpleContent"),e);else if(this._type.querySelectorAll("complexType > choice, complexType> sequence, complexType > group").length>0){var n=this._type.querySelector("complexType > choice, complexType > sequence, complexType > group");switch(n.nodeName){case"xsd:choice":case"choice":t._grouping=new cv.ui.manager.model.schema.Choice(n,e);break;case"xsd:sequence":case"sequence":t._grouping=new cv.ui.manager.model.schema.Sequence(n,e);break;case"xsd:group":case"group":t._grouping=new cv.ui.manager.model.schema.Group(n,e);break;case"xsd:any":case"any":t._grouping=new cv.ui.manager.model.schema.Any(n,e)}}else{if(!this._type.hasAttribute("type")||!this._type.getAttribute("type").match(/^xsd:/)){this.__P_48_1=t;return t}t._text=new cv.ui.manager.model.schema.SimpleType(this._type,e)}Array.from(this._type.querySelectorAll(":scope > element")).forEach((function(n){var i=new cv.ui.manager.model.schema.Element(n,e);t[i.getName()]=i}));this.__P_48_1=t;return t},getAllowedAttributes:function(){var e=this;if(null===this.__P_48_2){var t={},n=Array.from(this._type.querySelectorAll(":scope > attribute, :scope > simpleContent > extension > attribute"));Array.from(this._type.querySelectorAll(":scope > attributeGroup, :scope > simpleContent > extension > attributeGroup")).forEach((function(t){var i={};i=t.hasAttribute("ref")?e.getSchema().getReferencedNode("attributeGroup",t.getAttribute("ref")):t;Array.from(i.querySelectorAll(":scope > attribute")).forEach((function(e){n.push(e)}))}));n.forEach((function(n){var i=new cv.ui.manager.model.schema.Attribute(n,e.getSchema());t[i.getName()]=i}));this.__P_48_2=t}return this.__P_48_2},areChildrenSortable:function(){var e=this.getAllowedContent();return void 0===e._grouping||!e._grouping.getElementsHaveOrder()},getRequiredElements:function(){var e=this.getAllowedContent();return void 0!==e._grouping?e._grouping.getRequiredElements():[]},getAllowedElements:function(e){var t=this.getAllowedContent(),n={};void 0!==t._grouping&&Object.assign(n,t._grouping.getAllowedElements());var i=!1;if(this.isMixed())n["#text"]=this.getSchema().getTextNodeSchemaElement();else if(t._text&&void 0===t._grouping){n["#text"]=t._text;i=!0}i||e||(n["#comment"]=this.getSchema().getCommentNodeSchemaElement());return n},getAllowedElementsSorting:function(){var e=this.getAllowedContent();if(void 0!==e._grouping)return e._grouping.getAllowedElementsSorting()},getFirstLevelElementSorting:function(){var e=this.getAllowedElementsSorting();e&&Object.keys(e).forEach((function(t){var n=e[t];"string"==typeof n&&(n=parseInt(n.split(".")[0]));e[t]=n}));return e},getChildBounds:function(){var e=this.getAllowedContent();if(void 0!==e._grouping&&!0!==e._grouping.hasMultiLevelBounds())return e._grouping.getBounds()},getBoundsForElementName:function(e){return this.getAllowedContent()._grouping.getBoundsForElementName(e)},isTextContentAllowed:function(){if(this.isMixed())return!0;var e=this.getAllowedContent();return void 0!==e._text&&!1!==e._text},isTextContentRequired:function(){return!!this.isTextContentAllowed()&&(!this.isMixed()&&!this.getAllowedContent()._text.isValueValid(""))},isChildElementAllowed:function(e){if("#text"===e||"#cdata-section"===e)return this.isTextContentAllowed();if("#comment"===e)return!0;var t=this.getAllowedContent();return void 0!==t._grouping&&t._grouping.isElementAllowed(e)},getSchemaElementForElementName:function(e){var t=this.getAllowedContent();if("#text"===e||"#cdata-section"===e){if(!1===this.isTextContentAllowed())return;if(!this.__P_48_3){var n=this.getSchema().getSchemaDOM().createElement("element");n.setAttribute("name","#text");n.setAttribute("type","xsd:string");this.__P_48_3=new cv.ui.manager.model.schema.Element(n,this.getSchema());t._text?this.__P_48_3.getAllowedContent()._text=t._text:this.isMixed()&&(this.__P_48_3.getAllowedContent._text=this.getSchema().getTextNodeSchemaElement())}return this.__P_48_3}return"#comment"===e?this.getSchema().getCommentNodeSchemaElement():void 0!==t._grouping&&t._grouping.isElementAllowed(e)?t._grouping.getSchemaElementForElementName(e):void 0},getSchemaDOM:function(){return this.getSchema().getSchemaDOM()},isValueValid:function(e){return!1!==this.isTextContentAllowed()&&(!!this.isMixed()||this.getAllowedContent()._text.isValueValid(e))},getRegex:function(e,t){void 0!==e&&void 0!==e||(e="");var n="(";t&&(n+="?:");n+=this.getName()+e+")";var i="",r="",a=this.getBounds();void 0!==a.min&&(i=a.min);void 0!==a.max&&a.max!==Number.POSITIVE_INFINITY&&(r=a.max);""===i&&""===r||(n+="{"+i+","+r+"}");return n},getChildrenRegex:function(e,t){void 0!==e&&void 0!==e||(e="");var n=this.getAllowedContent();return void 0===n._grouping?"^":n._grouping.getRegex(e,t)}},destruct:function(){this._disposeMap("__P_48_2");this._disposeMap("__P_48_1");this._disposeObjects("__P_48_3")}});cv.ui.manager.model.schema.Element.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.io.rest.Client":{construct:!0},"qx.lang.Function":{},"cv.Config":{},"qx.log.Logger":{},"qx.lang.Type":{},"qx.io.request.Xhr":{},"cv.io.BackendConnections":{},"cv.Transform":{},"qx.locale.Manager":{},"qx.io.PartLoader":{},"cv.IconHandler":{},"cv.IconConfig":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.editor.data.Provider",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);this.__P_37_0={};this._client=cv.io.rest.Client.getDataProviderClient()},statics:{Config:{address:{"#text":{cache:!0,userInputAllowed:!0,grouped:!0,method:"getAddresses"}},rrd:{"#text":{cache:!0,userInputAllowed:!0,method:"getRrds"}},influx:{measurement:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBs"},field:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBFields"}},tag:{key:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBTags"},value:{cache:!1,live:!0,userInputAllowed:!1,method:"getInfluxDBValues"}},icon:{name:{cache:!1,live:!0,userInputAllowed:!1,method:"getIcons"}},plugin:{name:{cache:!0,userInputAllowed:!1,method:"getPlugins"}},pages:{design:{method:"getDesigns",cache:!0,userInputAllowed:!1}},"*":{rrd:{method:"getRrds",cache:!0,userInputAllowed:!0},ga:{method:"getAddresses",cache:!0,userInputAllowed:!0,grouped:!0},transform:{method:"getTransforms",cache:!0,userInputAllowed:!1}}},get:function(e){var t=cv.ui.manager.editor.data.Provider.getInstance(),n=e.split("@"),i=_slicedToArray(n,2),r=i[0],a=i[1],o=null;this.Config[r]&&this.Config[r][a]?o=this.Config[r][a]:this.Config["*"][a]&&(o=this.Config["*"][a]);if(o){var s={};if(o.live)s.getLive=qx.lang.Function.curry(t[o.method],"dp",o).bind(t);else{for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];c.unshift(o);c.unshift("dp");s.data=t[o.method].apply(t,c)}return Object.assign(s,o)}return null}},members:{__P_37_0:null,_getFromCache:function(e){return this.__P_37_0[e]},__P_37_1:function(e){e?delete this.__P_37_0[e]:this.__P_37_0={}},_addToCache:function(e,t){this.__P_37_0[e]=t},getDesigns:function(e,t,n){n||(n="pure");var i=cv.Config.designStructureMap[n]||[];return"dp"===e?i.map((function(e){return{label:e,value:e}})):i.map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}}))},__P_37_2:function(e,t,n,i,r,a,o){var s=o?this._getFromCache(e):null;return s?Promise.resolve(r.call(a||this,s)):new Promise(function(s,l){var c=function(t,n){if(t)l(t);else if("string"==typeof n&&n.startsWith("Error:")){qx.log.Logger.error(this,n);s(r.call(a||this,[]))}else{o&&this._addToCache(e,n);s(r.call(a||this,n))}};if(i){i.push(c);i.push(this)}else i=[c,this];qx.lang.Type.isString(t)?this._client[t].apply(n||this._client,i):qx.lang.Type.isFunction(t)&&t.apply(n,i)}.bind(this))},__P_37_3:function(e,t,n,i){var r=i?this._getFromCache(e):null;if(r){t&&(r=t.call(n||this,r));return Promise.resolve(r)}return new Promise(function(r,a){var o=this,s=new qx.io.request.Xhr(e),l=cv.io.BackendConnections.getClient();l&&l.authorize(s);s.set({accept:"application/json"});s.addListener("success",(function(a){var s=a.getTarget().getResponse();i&&o._addToCache(e,s);t&&(s=t.call(n||o,s));r(s)}));s.addListener("statusError",a,this);s.send()}.bind(this))},getAddresses:function(e,t,n){var i=cv.io.BackendConnections.getClient(n);t||(t={cache:!0});if(i&&i.hasProvider("addresses")){var r=i.getProviderUrl("addresses");return r?this.__P_37_3(r,i.getProviderConvertFunction("addresses",e),i,t.cache):i.getProviderData("addresses",e)}return this.__P_37_2("addresses","addressesSync",null,[],"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},getRrds:function(e,t){var n=cv.io.BackendConnections.getClient();t||(t={cache:!0});return n&&n.hasProvider("rrd")?this.__P_37_3(n.getProviderUrl("rrd"),n.getProviderConvertFunction("rrd",e),n,t.cache):this.__P_37_2("rrds","rrdsSync",null,[],"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},getInfluxDBs:function(e,t,n){var i=this.__P_37_4(n,!1);return this.__P_37_2("influxdbs","influxdbsSync",null,i,"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)},__P_37_4:function(e,t){var n=[];e.hasAttribute("authentication")&&n.push({auth:e.getAttribute("authentication")});if(t){for(var i=e;"influx"!==i.nodeName;)if(void 0===(i=i.parentElement))throw new Error;n.push({measurement:e.getAttribute("measurement")})}return n},getInfluxDBFields:function(e,t,n){try{var i=this.__P_37_4(n,!0);return this.__P_37_2("influxdbfields|"+i.measurement+"|"+i.auth,"influxdbfieldsSync",null,i,"dp"===e?this._parseDpResponseForEditor:this._parseDpResponseForMonaco,this,t.cache)}catch(e){return[]}},__P_37_5:function(e,t,n,i){try{var r=this.__P_37_4(n,!0);return this.__P_37_2("influxdbtags|"+r.measurement+"|"+r.auth,"influxdbtagsSync",null,r,i,this,t.cache)}catch(e){return[]}},getInfluxDBTags:function(e,t,n){return this.__P_37_5(e,t,n,(function(t){return"monaco"===e?Object.keys(t).map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})):Object.keys(t).map((function(e){return{value:e,label:e}}))}))},getInfluxDBValues:function(e,t,n,i){return this.__P_37_5(e,t,n,(function(t){return null!==t&&n.attributes.key in t?"monaco"===e?t[i].map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})):t[i].map((function(e){return{label:e,value:e}})):[]}))},_parseDpResponseForMonaco:function(e){return this.__P_37_6(e,"monaco")},_parseDpResponseForEditor:function(e){return this.__P_37_6(e,"dp")},__P_37_6:function(e,t){var n=[];if(t&&"monaco"!==t){if("dp"===t)return e||[]}else e.forEach((function(e){n.push({label:e.label,insertText:e.value,kind:window.monaco.languages.CompletionItemKind.EnumMember})}),this);return n},getMediaFiles:function(e,t,n){var i=cv.io.rest.Client.getFsClient();return this.__P_37_2("media",i.readSync,i,[{path:"media",recursive:!0}],(function(e){return e.filter((function(e){return!n||e.name.endsWith("."+n)})).map((function(e){var t=e.parentFolder+e.name;return{label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember}}))}),this,t.cache)},getTransforms:function(e,t){e||(e="monaco");var n="transforms|"+e,i=!t||!0===t.cache,r=i?this._getFromCache(n):null;if(r)return r;var a=[];Object.keys(cv.Transform.registry).forEach((function(t){var n,i=cv.Transform.registry[t];if("dp"===e)n={label:i.name+" ["+t+"]",value:t};else{n={label:t,insertText:t,kind:window.monaco.languages.CompletionItemKind.EnumMember};i.lname&&Object.prototype.hasOwnProperty.call(i.lname,qx.locale.Manager.getInstance().getLanguage())&&(n.detail=i.lname[qx.locale.Manager.getInstance().getLanguage()])}a.push(n)}),this);i&&this._addToCache(n,a);return a},getPlugins:function(e,t){e||(e="monaco");var n=!t||!0===t.cache,i="plugins|"+e,r=n?this._getFromCache(i):null;if(r)return r;var a=[],o=qx.io.PartLoader.getInstance().getParts();Object.keys(o).forEach((function(t){if(t.startsWith("plugin-")){var n=t.substring(7);"dp"===e?a.push({label:n,value:n}):a.push({label:n,insertText:n,kind:window.monaco.languages.CompletionItemKind.EnumMember})}}),this);n&&this._addToCache(i,a);return a},getIcons:function(e,t,n){e||(e="monaco");var i,r=!t||!0===t.cache,a="icons|"+e,o=r?this._getFromCache(a):null;if(o)return o;var s=cv.IconHandler.getInstance();"monaco"===e?i=Object.keys(cv.IconConfig.DB).filter((function(e){return!n||"config"!==cv.IconConfig.DB[e].source})).map((function(e){return{label:e,insertText:e,kind:window.monaco.languages.CompletionItemKind.EnumMember}})):"dp"===e&&(i=Object.keys(cv.IconConfig.DB).filter((function(e){return!n||"config"!==cv.IconConfig.DB[e].source})).map((function(e){return{label:e,value:e,icon:s.getIconSource(e)}})));if(n)if(n instanceof Element)n.ownerDocument.querySelectorAll("pages > meta > icons > icon-definition").forEach((function(t){var n=t.getAttribute("name");"monaco"===e?i.push({label:n,insertText:n,kind:window.monaco.languages.CompletionItemKind.EnumMember}):"dp"===e&&i.push({label:n,value:n,icon:t.getAttribute("uri")})}));else if("string"==typeof n){var l=n.match(/<icon-definition.+>/gm),c=document.createElement("template");l.forEach((function(t){c.innerHTML=t;var n=c.content.firstElementChild,r=n.getAttribute("name");"monaco"===e?i.push({label:r,insertText:r,kind:window.monaco.languages.CompletionItemKind.EnumMember}):"dp"===e&&i.push({label:r,value:r,icon:n.getAttribute("uri")})}))}r&&this._addToCache(a,i);return i}},destruct:function(){this.__P_37_0=null}});cv.ui.manager.editor.data.Provider.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Dialog":{construct:!0,require:!0},"cv.ui.manager.editor.Source":{construct:!0},"qx.ui.container.Composite":{},"qx.ui.layout.VBox":{},"qx.bom.Viewport":{},"qx.ui.basic.Label":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.xml.String":{},"qx.ui.form.Button":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.ValidationError",{extend:qxl.dialog.Dialog,construct:function(e,t,n,i){var r=this;this._file=e;this._content=t.split("\n");this._errors=n;qxl.dialog.Dialog.constructor.call(this,Object.assign(i||{},{useBlocker:!0}));this.addListener("appear",(function(){window.monaco?r.highlight():cv.ui.manager.editor.Source.load(r.highlight,r)}))},events:{action:"qx.event.type.Data"},members:{_content:null,_errors:null,_rootListenerId:null,_file:null,highlight:function(){Array.from(document.querySelectorAll("pre.highlight")).forEach((function(e){monaco.editor.colorizeElement(e,{theme:"vs-dark"})}))},_createWidgetContent:function(){var e=this,t=this._createDialogContainer(),n=new qx.ui.container.Composite(new qx.ui.layout.VBox(10));t.add(n);var i=this.tr('<h3>Config Errors</h3><p>The validation of "%1" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because it can break the file completely. Please open this file in the text editor and fix the errors there. Only proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>',this._file.getFullPath()),r=this.tr("<p>You can choose between the following options:<ul>    <li><b>Cancel</b> - Close this editor</li>    <li><b>Proceed</b> - Open the defective file in this editor</li>    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li></ul></p>"),a={rich:!0,width:Math.min(qx.bom.Viewport.getWidth()-32,750),allowGrowX:!0},o=new qx.ui.basic.Label(i);o.set(a);n.add(o);var s=new qx.ui.container.Composite(new qx.ui.layout.VBox(0)),l=new qx.ui.container.Scroll(s);l.set({padding:[0,0,8,8],decorator:"cv-editor-config-section"});l.setMinHeight(100);l.setHeight(Math.min(300,qx.bom.Document.getHeight()-340));this._rootListenerId=qx.core.Init.getApplication().getRoot().addListener("resize",(function(){l.setHeight(Math.min(300,qx.bom.Document.getHeight()-340))}));n.add(l,{flex:1});var c=new Map;this._errors.forEach((function(t){var n,i=t.line+t.element+t.attribute;if(c.has(i))n=c.get(i);else{for(var r=[],o=Math.max(0,t.line-3),l=Math.min(e._content.length-1,t.line+2),u=Number.POSITIVE_INFINITY,d=o;d<l;d++){var h=e._content[d],g=h.search(/\S|$/);g<u&&g>=0&&(u=g);r.push([d+1,h.trimRight()])}u===Number.POSITIVE_INFINITY&&(u=0);r=r.map((function(e){return e[0]+": "+qx.xml.String.escape(e[1].substr(u))}));var m=e.tr("Line %1",t.line);(n=new qx.ui.basic.Label("<h4>".concat(m,'</h4><pre class="highlight" style="background-color: black; padding: 8px;" data-lang="text/xml">').concat(r.join("\n"),"</pre>"))).set(a);c.set(i,n);s.add(n)}t.message.startsWith("[facet")||n.setValue(n.getValue()+"<p>".concat(t.message,"</p>"))}),this);var u=new qx.ui.basic.Label(r);u.set(a);n.add(u);var d=this._createButtonPane(),h=new qx.ui.form.Button(this.tr("Cancel"));h.addListener("execute",(function(){return e.fireDataEvent("action","cancel")}));var g=new qx.ui.form.Button(this.tr("Proceed"));g.addListener("execute",(function(){return e.fireDataEvent("action","proceed")}));var m=new qx.ui.form.Button(this.tr("Open in text editor"));m.addListener("execute",(function(){return e.fireDataEvent("action","open-source")}));d.add(h);d.add(g);d.add(m);t.add(d);this.add(t)}},destruct:function(){this._content=null;this._errors=null;this._file=null;if(this._rootListenerId){qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);this._rootListenerId=null}}});cv.ui.manager.dialog.ValidationError.$$dbClassInfo=e}();function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);return"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.control.MFileEventHandler":{require:!0},"cv.ui.manager.IActionHandler":{require:!0},"cv.ui.manager.control.IFileEventHandler":{require:!0},"cv.ui.manager.model.BackupFolder":{construct:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.control.ActionDispatcher":{construct:!0},"qx.event.message.Bus":{construct:!0},"qx.ui.tooltip.Manager":{construct:!0},"cv.ui.manager.model.FileItem":{},"qx.core.Init":{},"qx.bom.element.Style":{},"cv.io.rest.Client":{},"cv.ui.manager.snackbar.Controller":{},"qx.locale.Manager":{},"cv.util.ConfigLoader":{},"qxl.dialog.Confirm":{},"cv.util.ConfigUpgrader":{},"cv.ui.manager.model.Preferences":{},"cv.ui.manager.control.FileHandlerRegistry":{},"cv.ui.manager.editor.AbstractEditor":{},"cv.ui.manager.core.GlobalState":{},"cv.ui.manager.model.OpenFile":{},"cv.ui.manager.editor.IEditor":{},"cv.ui.manager.Start":{},"cv.ui.manager.model.CompareFiles":{},"qx.dom.Element":{},"qx.theme.manager.Meta":{},"cv.theme.Dark":{},"qx.ui.command.Group":{},"qx.ui.command.Command":{},"cv.ui.manager.control.FileController":{},"cv.ui.manager.dialog.Prompt":{},"qx.ui.root.Inline":{},"qx.ui.layout.Canvas":{},"qx.ui.container.Composite":{},"qx.ui.layout.Dock":{},"cv.ui.manager.MenuBar":{},"cv.ui.manager.upload.UploadMgr":{},"qx.ui.splitpane.Pane":{},"cv.theme.dark.Images":{},"cv.ui.manager.tree.FileSystem":{},"qx.ui.layout.VBox":{},"cv.ui.manager.ToolBar":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.FileTabItem":{},"qx.ui.container.Stack":{},"qx.bom.Viewport":{},"cv.Version":{},"cv.ui.manager.dialog.BigAlert":{},"qx.util.DeferredCall":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.Main",{extend:qx.core.Object,type:"singleton",include:[cv.ui.manager.control.MFileEventHandler],implement:[cv.ui.manager.IActionHandler,cv.ui.manager.control.IFileEventHandler],construct:function(){var e=this;qx.core.Object.constructor.call(this);cv.ui.manager.model.BackupFolder.getInstance();this._checkEnvironment();this.initOpenFiles(new qx.data.Array);this.__P_25_0=cv.ui.manager.control.ActionDispatcher.getInstance();this.__P_25_0.setMain(this);this.__P_25_1();this._draw();qx.event.message.Bus.subscribe("cv.manager.*",this._onManagerEvent,this);qx.ui.tooltip.Manager.getInstance();window.addEventListener("beforeunload",(function(t){e._onBeforeUnload(t)}))},statics:{ROOT:null},properties:{openFiles:{check:"qx.data.Array",deferredInit:!0},writeableFolder:{check:"Boolean",init:!1,event:"changeWriteableFolder"},currentFolder:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentFolder",event:"changeCurrentFolder"},currentSelection:{check:"cv.ui.manager.model.FileItem",nullable:!0,apply:"_applyCurrentSelection",event:"changeCurrentSelection"},deleteableSelection:{check:"Boolean",init:!1,event:"changeDeleteableSelection"},renameableSelection:{check:"Boolean",init:!1,event:"changeRenameableSelection"},visible:{check:"Boolean",init:!0,event:"changeVisible",apply:"_applyVisible"}},members:{__P_25_2:null,__P_25_3:null,_pane:null,_tree:null,_stack:null,_oldCommandGroup:null,_managerCommands:null,_mainContent:null,_openFilesController:null,_hiddenConfigFakeFile:null,__P_25_0:null,_applyVisible:function(e){var t=qx.core.Init.getApplication().getCommandManager();if(e){t.setActive(this._managerCommands);qx.bom.element.Style.set(this.__P_25_4(),"display","block")}else{t.setActive(this._oldCommandGroup);qx.bom.element.Style.set(this.__P_25_4(),"display","none")}},_checkEnvironment:function(){cv.io.rest.Client.getFsClient().checkEnvironmentSync((function(e,t){e?cv.ui.manager.snackbar.Controller.error(e):t&&t.forEach((function(e){var t=!1;switch(e.entity){case".":if(0==(1&e.state))cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder does not exists"));else if(0==(2&e.state)){cv.ui.manager.model.FileItem.ROOT.setReadable(!1);t=!0;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not readable"))}else if(0==(4&e.state)){cv.ui.manager.model.FileItem.ROOT.setWriteable(!1);t=!0;cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("config folder is not writeable"))}if(t){var n=this.__P_25_0.getFocusedWidget();this.__P_25_0.resetFocusedWidget();this.__P_25_0.setFocusedWidget(n)}break;case"backup":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("backup folder is not writeable"));break;case"media":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("media folder is not writeable"));break;case"hidden.php":0==(4&e.state)&&1==(1&e.state)&&cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Hidden configuration file (hidden.php) not writeable"))}}),this)}),this)},canHandleAction:function(e){if("delete"===e&&this.getCurrentSelection()&&!this.getCurrentSelection().isWriteable())return!1;var t=["close","quit","about"];if(this.getCurrentFolder().isWriteable()){t.push("new-file");t.push("new-folder");t.push("delete");t.push("upload");t.push("clone");t.push("convertToTile")}cv.ui.manager.model.FileItem.ROOT.isWriteable()&&t.push("new-config-file");return t.includes(e)},_doClose:function(){if(document.querySelector("#main.loading")){var e=new cv.util.ConfigLoader,t=qx.core.Init.getApplication();e.load(t.bootstrap,t)}this.setVisible(!1)},handleAction:function(e,t){var n;switch(e){case"close":t?this.closeFile(t):this.closeCurrentFile();break;case"quit":if((n=this.getOpenFiles().filter((function(e){return e.getFile().isModified()}))).length>0){var i=new qxl.dialog.Confirm({message:qx.locale.Manager.tr("You have files opened with unsaved changes, you should save them now."),callback:function(e){e&&n.forEach((function(e){e.save()}));i.dispose();this._doClose()},context:this,caption:qx.locale.Manager.tr("Unsaved changes"),yesButtonLabel:qx.locale.Manager.tr("Save & quit"),noButtonLabel:qx.locale.Manager.tr("Quit without saving"),useBlocker:!0});i.show()}else this._doClose();break;case"new-file":this._onCreate("file",null,t);break;case"new-config-file":cv.io.rest.Client.getFsClient().readSync({path:"demo/templates/visu_config.xml"},(function(e,t){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load config template")):this._onCreate("config",t,cv.ui.manager.model.FileItem.ROOT)}),this);break;case"clone":cv.io.rest.Client.getFsClient().readSync({path:t.file.getFullPath()},(function(e,n){e?cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load file content")):t.file.isConfigFile()?this._onCreate("config",n,cv.ui.manager.model.FileItem.ROOT):this._onCreate("file",n)}),this);break;case"convertToTile":cv.io.rest.Client.getFsClient().readSync({path:t.file.getFullPath()},(function(e,n){if(e)cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr("Cannot load file content"));else if(t.file.isConfigFile()){var i=(new cv.util.ConfigUpgrader).convertPureToTile(n),r=_slicedToArray(i,2),a=r[0],o=r[1];if(a)cv.ui.manager.snackbar.Controller.error(a);else{var s="tile",l=/visu[_-]config[_-]([\w\d_-]+)(\.xml)?/.exec(t.file.getName());l&&(s="tile-"+l[1]);this._onCreate("config",o,cv.ui.manager.model.FileItem.ROOT,"cv.ui.manager.editor.Source",s)}}}),this);break;case"new-folder":this._onCreate("dir",null,t);break;case"delete":this._onDelete(t);break;case"upload":break;case"about":this._showAbout();break;default:this.warn(e+" handling is not implemented yet!")}},_onBeforeUnload:function(e){if(this.getOpenFiles().filter((function(e){return e.getFile().isModified()})).length>0){e.preventDefault();e.returnValue=""}else delete e.returnValue},configureButton:function(e){},unConfigureButton:function(e){},_handleFileEvent:function(e){var t=e.getData();if("deleted"===t.action){this.getOpenFiles().copy().some((function(e){e.getFile().isRelated(t.path)&&this.closeFile(e);return!1}),this);this.getCurrentFolder()&&this.getCurrentFolder().getFullPath()===t.path&&this.resetCurrentFolder()}else this.warn("unhandled file event",t.action);this._tree.refresh()},__P_25_5:function(e){var t=null,n=null;cv.ui.manager.model.FileItem.ROOT.getChildren().some((function(i){if("demo"===i.getName())n=i;else if(i.getName()===e){t=i;return!0}return!1}));if(!t&&n){e.startsWith("demo/")&&(e=e.substr(5));n.getChildren().some((function(n){if(n.getName()===e){t=n;return!0}return!1}))}return t},_onManagerEvent:function(e){var t=e.getData();switch(e.getName()){case"cv.manager.compareFiles":this.openFile(t,!1);break;case"cv.manager.openWith":"string"==typeof t.file&&(t.file=this.__P_25_5(t.file));this.openFile(t.file||this.getCurrentSelection(),!1,t.handler,null,t.handlerOptions);break;case"cv.manager.open":"string"==typeof t&&(t=this.__P_25_5(t));this.openFile(t||this.getCurrentSelection(),!1)}},_onChangeTreeSelection:function(e){var t=e.getData();(cv.ui.manager.model.Preferences.getInstance().isQuickPreview()&&"tap"===t.mode||"dbltap"===t.mode)&&this.__P_25_6(t.node,t.mode);var n=t.node;if(n){"file"===t.node.getType()?this.setCurrentFolder(t.node.getParent()):this.setCurrentFolder(n);this.setCurrentSelection(n)}else{this.resetCurrentFolder();this.resetCurrentSelection()}},__P_25_6:function(e,t){e&&("file"===e.getType()?this.openFile(e,"tap"===t):"dbltap"===t&&e.setEditing(!0))},_applyCurrentFolder:function(e,t){t&&t.removeRelatedBindings(this);e?e.bind("writeable",this,"writeableFolder"):this.resetWriteableFolder()},_applyCurrentSelection:function(e,t){t&&t.removeRelatedBindings(this);if(e){e.bind("writeable",this,"deleteableSelection");e.bind("inTrash",this,"renameableSelection",{converter:function(e){return!e}})}else this.resetDeleteableSelection()},_onChangeFileSelection:function(){var e=this._openFilesController.getSelection();if(e.length>0){var t,n=e.getItem(0),i=n.getFile(),r=n.getHandlerId();(t=r?cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(r):cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(i)).instance||(t.instance=new t.Clazz);t.instance.setFile(i);this._stack.indexOf(t.instance)<0&&this._stack.add(t.instance);t.instance instanceof cv.ui.manager.editor.AbstractEditor&&t.instance.setHandlerOptions(n.getHandlerOptions());this._stack.setSelection([t.instance]);this.__P_25_0.setFocusedWidget(t.instance);cv.ui.manager.core.GlobalState.getInstance().setOpenedFocusedFile(i)}else cv.ui.manager.core.GlobalState.getInstance().resetOpenedFocusedFile()},openFile:function(e,t,n,i,r){var a,o,s=this.getOpenFiles();if(n){(o=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(n)).instance||(o.instance=new o.Clazz);if(o.instance.isExternal()){o.instance.setFile(e);return}}else{if(!(o=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(e,i))){cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr('Cannot open file: "%1"',e.getName()));return}n=o.Clazz.classname}var l=s.some((function(t){if(t.getFile()===e&&n===t.getHandlerId()){a=t;return!0}return!1}));a||(a=new cv.ui.manager.model.OpenFile(e,n));r?a.setHandlerOptions(r):a.resetHandlerOptions();if(!0===t){if(!a.isPermanent()){if(null!==this.__P_25_2&&s.getItem(this.__P_25_2)&&!s.getItem(this.__P_25_2).isPermanent())s.setItem(this.__P_25_2,a);else{this.__P_25_2=s.length;s.push(a)}a.setPermanent(!1)}}else{l||null!==this.__P_25_2&&s.indexOf(a)===this.__P_25_2||s.push(a);a.setPermanent(!0);this.__P_25_2=null}this._openFilesController.getTarget().setModelSelection([a])},checkUnsavedChanged:function(e){var t=this;if(e instanceof cv.ui.manager.model.FileItem){if(!this.getOpenFiles().some((function(t){if(t.getFile().getFullPath()===e.getFullPath()){e=t;return!0}return!1})))return!1}var n=e.getFile();if(n.isModified()){var i=qx.locale.Manager.tr("This file has unsaved changes that will be lost when you close it without saving.");n.isTemporary()&&(i=qx.locale.Manager.tr("This file has not been saved on the backend yet. It will be lost when you close it without saving."));var r=new qxl.dialog.Confirm({message:i,callback:function(i){if(!0===i){e.save();t.closeFile(e,!0)}else if(!1===i){n.resetModified();n.isTemporary()&&qx.event.message.Bus.dispatchByName("cv.manager.file",{action:"deleted",path:n.getFullPath()});t.closeFile(e,!0)}r.dispose()},context:this,caption:qx.locale.Manager.tr("Unsaved changes"),yesButtonLabel:qx.locale.Manager.tr("Save & close"),noButtonLabel:qx.locale.Manager.tr("Discard & close"),noButtonIcon:"qxl.dialog.icon.delete",useBlocker:!0,allowCancel:!0});r.show();return!0}return!1},closeFile:function(e,t){if(e instanceof cv.ui.manager.model.FileItem){if(!this.getOpenFiles().some((function(t){if(t.getFile().getFullPath()===e.getFullPath()){e=t;return!0}return!1})))return}if(e&&e.isCloseable()){var n=e.getFile();if(t||!this.checkUnsavedChanged(e)){e instanceof cv.ui.manager.model.OpenFile&&e.resetPermanent();var i=this._openFilesController.getSelection(),r=-1,a=this.getOpenFiles();i.length>0&&i.getItem(0)===e&&(r=a.indexOf(e));a.remove(e);var o=this._stack.getSelection()[0];!qx.Class.hasInterface(o.constructor,cv.ui.manager.editor.IEditor)||o instanceof cv.ui.manager.Start||o.resetFile();if(0===this.getOpenFiles().length){this._stack.resetSelection();this.__P_25_0.resetFocusedWidget();this.__P_25_2=null}r>0?this._openFilesController.getSelection().replace(a.getItem(r-1)):0===r&&a.length>0&&this._openFilesController.getSelection().replace(a.getItem(0));if(n instanceof cv.ui.manager.model.CompareFiles){var s=cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(n);s.instance.clear();if(0===a.filter((function(e){return e.getFile()instanceof cv.ui.manager.model.CompareFiles})).length){s.instance.destroy();s.instance=null}}else if(window.monaco&&"cv.ui.manager.editor.Source"===e.getHandlerId()){var l=window.monaco.editor.getModel(n.getUri());l&&l.dispose()}}}},closeCurrentFile:function(){var e=this._openFilesController.getSelection().length>0?this._openFilesController.getSelection().getItem(0):null;e&&this.closeFile(e)},_onCloseFile:function(e){this.closeFile(e.getData())},__P_25_4:function(){if(!this.__P_25_3){this.__P_25_3=qx.dom.Element.create("div",{id:"manager",style:"position: absolute; top: 0; left: 0; right: 0; bottom: 0;"});qx.dom.Element.insertEnd(this.__P_25_3,document.body);qx.theme.manager.Meta.getInstance().setTheme(cv.theme.Dark)}return this.__P_25_3},__P_25_1:function(){var e=this._managerCommands=new qx.ui.command.Group;e.add("save",new qx.ui.command.Command("Ctrl+S"));e.add("save-as",new qx.ui.command.Command("Ctrl+Shift+S"));e.add("new-file",new qx.ui.command.Command("Ctrl+N"));e.add("new-folder",new qx.ui.command.Command("Ctrl+Shift+N"));e.add("quit",new qx.ui.command.Command("Ctrl+Q"));var t=new qx.ui.command.Command("F2");e.add("rename",t);this.bind("renameableSelection",t,"enabled");e.add("undo",new qx.ui.command.Command("Ctrl+Z"));e.add("redo",new qx.ui.command.Command("Ctrl+Y"));e.add("cut",new qx.ui.command.Command("Ctrl+X"));e.add("copy",new qx.ui.command.Command("Ctrl+C"));e.add("paste",new qx.ui.command.Command("Ctrl+V"));e.add("help",new qx.ui.command.Command("F1"));var n=qx.core.Init.getApplication().getCommandManager();this._oldCommandGroup=n.getActive();n.add(e);n.setActive(e)},_onDelete:function(e){var t=e||this.getCurrentSelection();t&&cv.ui.manager.control.FileController.getInstance().delete(t)},_onChangeStackSelection:function(e){var t=e.getData(),n=[];t.forEach((function(e){var t=this.getOpenFiles().toArray().find((function(t){return t.getFile()===e.getFile()&&t.getHandlerId()===e.classname}));t&&n.push(t)}),this);this._openFilesController.getSelection().replace(n)},__P_25_7:function(e,t,n,i,r){var a=new cv.ui.manager.dialog.Prompt({message:e,callback:t||null,context:n||null,value:i||null,caption:r||"",filter:/[\w\d_\-\.\s]/});a.show();return a},_onCreate:function(e,t,n,i,r){var a=n||this.getCurrentFolder();if(a){var o,s;if("config"===e){o=qx.locale.Manager.tr('Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)');s=qx.locale.Manager.tr("A configuration with this name already exists.")}else if("file"===e){o=qx.locale.Manager.tr("Please enter the file name.");s=qx.locale.Manager.tr("A file with this name already exists.")}else{o=qx.locale.Manager.tr("Please enter the folder name.");s=qx.locale.Manager.tr("A folder with this name already exists.")}this.__P_25_7(o,(function n(r){if(r){var l=r;if("config"===e){var c=/visu[_-]config[_-]([\w\d_-]+)(\.xml)?/.exec(r);c&&(r=c[1]);l="visu_config_"+r+".xml"}if(a.getChildren().some((function(t){return t.getName()===l&&t.getType()===e}),this)){cv.ui.manager.snackbar.Controller.error(s);this.__P_25_7(o,n,this,r)}else{var u=new cv.ui.manager.model.FileItem(l,a.getFullPath(),a);u.set({type:"config"===e?"file":e,readable:!0,writeable:!0,loaded:!0,modified:!0,temporary:!0,parentFolder:a.getFullPath(),content:t||""});"dir"===e&&cv.io.rest.Client.getFsClient().createSync({path:u.getFullPath(),type:e},null,(function(e){if(e)cv.ui.manager.snackbar.Controller.error(e);else{cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr("Folder has been created"));u.set({modified:!1,temporary:!1});qx.event.message.Bus.dispatchByName(u.getBusTopic(),{type:"created",file:u,data:"",source:this})}}),this);a.addChild(u);a.sortElements();this._tree.refresh();this._tree.setSelection(u);"dir"!==e&&this.openFile(u,!1,i,"edit")}}}),this,r)}},__P_25_8:function(e){for(;e&&1===e.nodeType;){if("on"===e.getAttribute("qxDroppable"))return e;e=e.parentNode}return null},_draw:function(){var e=this,t=this.__P_25_4(),n=new qx.ui.root.Inline(t,!0,!0);this.bind("visible",n,"visibility",{converter:function(e){return e?"visible":"excluded"}});n.addListenerOnce("appear",(function(){var t=n.getContentElement().getDomElement();t.addEventListener("drop",function(e){this.__P_25_8(e.target)||e.preventDefault()}.bind(e));t.addEventListener("dragover",function(e){this.__P_25_8(e.target)||e.preventDefault()}.bind(e))}));qx.core.Init.getApplication().setRoot(n);n.setLayout(new qx.ui.layout.Canvas);var i=cv.ui.manager.snackbar.Controller.getInstance();n.add(i,{bottom:10,left:200});function r(){var e=n.getBounds();i.setLayoutProperties({bottom:10,left:Math.round(e.width/2)-150});i.setMaxHeight(e.height-40)}n.addListener("resize",r,this);n.addListener("appear",r,this);window.addEventListener("resize",(function(){t.style.height=window.innerHeight+"px"}));var a=new qx.ui.container.Composite(new qx.ui.layout.Dock);n.add(a,{edge:0});var o=cv.ui.manager.MenuBar.getInstance();a.add(o,{edge:"north"});var s=o.getButton("upload"),l=new cv.ui.manager.upload.UploadMgr(s);this.bind("currentFolder",l,"folder");this._pane=new qx.ui.splitpane.Pane;a.add(this._pane,{edge:"center"});var c=cv.ui.manager.model.FileItem.ROOT=new cv.ui.manager.model.FileItem("."),u=cv.ui.manager.model.FileItem.getIconFile();c.set({overrideIcon:!0,writeable:!0,readable:!0,open:!0,fakeChildren:[u],icon:cv.theme.dark.Images.getIcon("home",18)});this.setCurrentFolder(c);this._tree=new cv.ui.manager.tree.FileSystem(c);this._tree.addListener("changeSelection",this._onChangeTreeSelection,this);var d=new qx.ui.container.Composite(new qx.ui.layout.VBox),h=new cv.ui.manager.ToolBar(l);this.bind("currentFolder",h,"folder");this.bind("currentSelection",h,"file");h.addListener("reload",this._tree.reload,this._tree);var g=o.getButtonConfiguration();this.bind("writeableFolder",g["new-file"].args[2],"enabled");this.bind("writeableFolder",g["new-folder"].args[2],"enabled");d.add(h);d.add(this._tree,{flex:1});this._pane.add(d,0);cv.ui.manager.model.Preferences.getInstance().bind("expertMode",d,"visibility",{converter:function(e){return e?"visible":"excluded"}});this._mainContent=new qx.ui.container.Composite(new qx.ui.layout.VBox);var m=new qx.ui.form.List(!0);m.setAppearance("open-files-tabs");this._openFilesController=new qx.data.controller.List(this.getOpenFiles(),m,"file.name");this._openFilesController.setDelegate({createItem:function(){var e=new cv.ui.manager.form.FileTabItem;e.addListener("close",this._onCloseFile,this);return e}.bind(this),bindItem:function(e,t,n){e.bindDefaultProperties(t,n);e.bindProperty("file.permanent","permanent",null,t,n);e.bindProperty("file.modified","modified",null,t,n);e.bindProperty("icon","icon",null,t,n);e.bindProperty("closeable","closeable",null,t,n)}});m.addListener("changeSelection",this._onChangeFileSelection,this);this._mainContent.add(m);this._stack=new qx.ui.container.Stack;this._stack.addListener("changeSelection",this._onChangeStackSelection,this);this._mainContent.add(this._stack,{flex:1});this._pane.add(this._mainContent,1);var f=new cv.ui.manager.model.OpenFile(c,"cv.ui.manager.Start");f.setCloseable(!1);this.getOpenFiles().push(f);m.setModelSelection([f])},_showAbout:function(){var e=qx.core.Init.getApplication(),t={caption:qx.locale.Manager.tr("About"),modal:!0,minWidth:Math.min(500,qx.bom.Viewport.getWidth()),maxHeight:qx.bom.Viewport.getHeight(),message:'\n<div class="about-cv">\n <img src="resource/icons/comet_icon_128x128_ff8000.png" width="128" height="128"/>\n <h2>CometVisu '.concat(cv.Version.VERSION,'</h2>\n <div class="info">\n   <label for="date">').concat(qx.locale.Manager.tr("Build date"),': </label>\n   <span id="date">').concat(cv.Version.DATE,'</span><br/>\n   <label for="build">').concat(qx.locale.Manager.tr("Build revision"),': </label>\n   <span id="build">').concat(cv.Version.REV,'</span><br/>\n   <label for="lib-version">').concat(qx.locale.Manager.tr("Library version"),': </label>\n   <span id="lib-version">Pure: ').concat(cv.Version.LIBRARY_VERSION_PURE,", Tile: ").concat(cv.Version.LIBRARY_VERSION_TILE,'</span><br/>\n   <label for="server">').concat(qx.locale.Manager.tr("Server"),': </label>\n   <span id="server">').concat(e.getServer()||"?",'</span><br/>\n   <label for="php-version">').concat(qx.locale.Manager.tr("PHP version")||"?",': </label>\n   <span id="php-version">').concat(e.getServerPhpVersion(),"</span>\n </div>\n</div>")};new cv.ui.manager.dialog.BigAlert(t).show()}},destruct:function(){this._disposeObjects("_pane","_tree","_stack","_mainContent","_openFilesController");var e=qx.core.Init.getApplication();e.getCommandManager().setActive(this._oldCommandGroup);this._oldCommandGroup=null;new qx.util.DeferredCall((function(){e.resetRoot()})).schedule();document.body.removeChild(this.__P_25_3);this.__P_25_3=null;this.__P_25_0=null;qx.event.message.Bus.unsubscribe("cv.manager.*",this._onManagerEvent,this);delete cv.ui.manager.Main.$$instance}});cv.ui.manager.Main.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.Alert":{require:!0},"qx.ui.basic.Image":{},"qx.ui.container.Composite":{},"qx.ui.layout.HBox":{},"qx.ui.container.Scroll":{},"qx.bom.Document":{},"qx.core.Init":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.dialog.BigAlert",{extend:qxl.dialog.Alert,members:{_hbox:null,_applyImage:function(e,t){if(!this._image){this._image=(new qx.ui.basic.Image).set({scale:!0,height:32,width:32});this._hbox.addAt(this._image,0)}this._image.setSource(e);this._image.setVisibility(e?"visible":"excluded")},_createWidgetContent:function(){var e=this._createDialogContainer();this.add(e);var t=this._hbox=new qx.ui.container.Composite(new qx.ui.layout.HBox(10)),n=new qx.ui.container.Scroll(t);n.setMaxHeight(qx.bom.Document.getHeight()-132);qx.core.Init.getApplication().getRoot().addListener("resize",(function(){n.setMaxHeight(qx.bom.Document.getHeight()-132)}));e.add(n);t.bind("width",n,"width");t.bind("height",n,"height");var i=this.getImage();if(i){this._image=new qx.ui.basic.Image(i).set({scale:!0,height:32,width:32});t.add(this._image)}this._message=new qx.ui.basic.Label;this._message.setRich(!0);this._message.setWidth(200);this._message.setAllowStretchX(!0);t.addAt(this._message,1,{flex:1});var r=this._createButtonPane(),a=this._createOkButton();r.add(a);e.add(r)}},destruct:function(){this._disposeObjects("_hbox")}});cv.ui.manager.dialog.BigAlert.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.data.Array":{construct:!0},"cv.ui.manager.model.config.Option":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Section",{extend:qx.core.Object,construct:function(e){qx.core.Object.constructor.call(this);this.setName(e);this.initOptions(new qx.data.Array)},properties:{name:{check:"String",event:"changeName",init:""},options:{check:"qx.data.Array",deferredInit:!0,event:"changeOptions"}},members:{addOption:function(e,t){var n=this.getOptions();n.some((function(n){if(n.getKey()===e){n.setValue(t);return!0}return!1}),this)||n.push(new cv.ui.manager.model.config.Option(e,t))}}});cv.ui.manager.model.config.Section.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.Grid":{construct:!0},"cv.ui.manager.model.config.Section":{},"cv.ui.manager.model.config.Option":{},"qx.ui.basic.Label":{},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.form.List":{},"qx.data.controller.List":{},"cv.ui.manager.form.OptionListItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.SectionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);var e=new qx.ui.layout.Grid(8,8);e.setColumnFlex(1,1);e.setColumnAlign(0,"left","top");this._setLayout(e);this._createChildControl("section-title");this._createChildControl("list");this._createChildControl("delete")},properties:{appearance:{refine:!0,init:"cv-editor-config-section"},model:{check:"cv.ui.manager.model.config.Section",nullable:!1,apply:"_applyModel"},modified:{check:"Boolean",init:!1,event:"changeModified"},readOnly:{check:"Boolean",init:!1,event:"changeReadOnly"}},events:{delete:"qx.event.type.Data"},members:{_listController:null,_originalName:null,_originalOptions:null,_applyModel:function(e,t){var n=this.getChildControl("name");this.__P_41_0(t);if(e){e.bind("name",n,"value");this._originalName=e.getName();this._originalOptions={};e.getOptions().forEach((function(e){e.addListener("change",this.__P_41_1,this);this._originalOptions[e.getKey()]=e.getValue()}),this);n.bind("value",e,"name");e.addListener("changeName",this.__P_41_1,this);e.bind("options",this._listController,"model");if(0===e.getOptions().length){var i=new cv.ui.manager.model.config.Option("","");e.getOptions().push(i)}}else{this._originalName=null;this._originalOptions=null}},__P_41_0:function(e){if(e){var t=this.getChildControl("name");this._listController&&e.removeRelatedBindings(this._listController);e.removeListener("changeName",this.__P_41_1,this);e.removeRelatedBindings(t);t.removeRelatedBindings(e);e.getOptions().forEach((function(e){e.removeListener("change",this.__P_41_1,this)}),this)}},__P_41_1:function(){if(this._originalName===this.getModel().getName())if(Object.keys(this._originalOptions).length===this.getModel().getOptions().length){var e=this.getModel().getOptions().some((function(e){return!Object.prototype.hasOwnProperty.call(this._originalOptions,e.getKey())||this._originalOptions[e.getKey()]!==e.getValue()}),this);this.setModified(e)}else this.setModified(!0);else this.setModified(!0)},_onDeleteOption:function(e){var t=e.getData();if(1===this.getModel().getOptions().length){t.resetKey();t.resetValue()}else{var n=this.getModel().getOptions().remove(t);n&&n.removeListener("change",this.__P_41_1,this)}this.__P_41_1()},_onAddOption:function(){var e=new cv.ui.manager.model.config.Option("","");e.addListener("change",this.__P_41_1,this);this.getModel().getOptions().push(e);this.__P_41_1()},_createChildControlImpl:function(e){var t,n=this;switch(e){case"section-title":t=new qx.ui.basic.Label(this.tr("Section"));this._add(t,{row:0,column:0});break;case"name":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this.bind("readOnly",t,"readOnly");this._add(t,{row:0,column:1});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete section"));t.addListener("execute",(function(){n.fireDataEvent("delete",n.getModel())}));this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t,{row:0,column:2});break;case"list":(t=new qx.ui.form.List).setEnableInlineFind(!1);this._listController=new qx.data.controller.List(null,t);this._listController.setNullValueTitle("header");this._listController.setAllowNull(!0);this._listController.setDelegate({createItem:function(){return new cv.ui.manager.form.OptionListItem},configureItem:function(e){e.addListener("delete",this._onDeleteOption,this);e.addListener("add",this._onAddOption,this);this.bind("readOnly",e,"readOnly")}.bind(this),bindItem:function(e,t,n){e.bindProperty("","model",null,t,n)}});this._add(t,{row:1,column:1})}return t||cv.ui.manager.form.SectionListItem.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._disposeObjects("_listController")}});cv.ui.manager.form.SectionListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.menubar.MenuBar":{construct:!0,require:!0},"qx.core.Init":{construct:!0},"qx.ui.core.Spacer":{},"qx.ui.form.RadioGroup":{},"cv.theme.dark.Images":{},"com.zenesis.qx.upload.UploadMenuButton":{},"qx.ui.menu.RadioButton":{},"qx.ui.menu.CheckBox":{},"cv.ui.manager.model.Preferences":{},"qx.ui.menu.Button":{},"qx.lang.Type":{},"qx.event.message.Bus":{},"qx.ui.menu.Separator":{},"qx.ui.basic.Label":{},"qx.ui.menubar.Button":{},"qx.ui.menu.Menu":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.MenuBar",{extend:qx.ui.menubar.MenuBar,type:"singleton",construct:function(){qx.ui.menubar.MenuBar.constructor.call(this);this._commandGroup=qx.core.Init.getApplication().getCommandManager().getActive();this.__P_26_0={};this._draw()},members:{_commandGroup:null,__P_26_0:null,__P_26_1:null,__P_26_2:null,_draw:function(){this._createChildControl("file");this._createChildControl("edit");this._createChildControl("preferences");this.add(new qx.ui.core.Spacer,{flex:1});this._createChildControl("title");this.add(new qx.ui.core.Spacer,{flex:1});this._createChildControl("help");var e=new qx.ui.form.RadioGroup;this.__P_26_1={"new-file":{menu:"new-menu",args:[this.tr("New file"),cv.theme.dark.Images.getIcon("new-file",18),this._commandGroup.get("new-file")],enabled:!0},"new-folder":{menu:"new-menu",args:[this.tr("New folder"),cv.theme.dark.Images.getIcon("new-folder",18),this._commandGroup.get("new-folder")],enabled:!0,separator:"after"},"new-config-file":{menu:"new-menu",args:[this.tr("New config file")],enabled:!0},upload:{menu:"file-menu",clazz:com.zenesis.qx.upload.UploadMenuButton,args:[this.tr("Upload file"),cv.theme.dark.Images.getIcon("upload",18)],enabled:!0,separator:"before"},save:{menu:"file-menu",args:[this.tr("Save"),cv.theme.dark.Images.getIcon("save",18),this._commandGroup.get("save")],enabled:!1,separator:"before"},"save-as":{menu:"file-menu",args:[this.tr("Save as..."),null,this._commandGroup.get("save-as")],enabled:!1},delete:{args:[this.tr("Delete"),cv.theme.dark.Images.getIcon("delete",18),this._commandGroup.get("delete")],enabled:!1,hidden:!0},quit:{menu:"file-menu",args:[this.tr("Quit"),cv.theme.dark.Images.getIcon("quit",18),this._commandGroup.get("quit")],enabled:!0,separator:"before"},undo:{menu:"edit-menu",args:[this.tr("Undo"),cv.theme.dark.Images.getIcon("undo",18),this._commandGroup.get("undo")],enabled:!0},redo:{menu:"edit-menu",args:[this.tr("Redo"),cv.theme.dark.Images.getIcon("redo",18),this._commandGroup.get("redo")],enabled:!0},cut:{menu:"edit-menu",args:[this.tr("Cut"),cv.theme.dark.Images.getIcon("cut",18),this._commandGroup.get("cut")],enabled:!1,separator:"before"},copy:{menu:"edit-menu",args:[this.tr("Copy"),cv.theme.dark.Images.getIcon("copy",18),this._commandGroup.get("copy")],enabled:!1},paste:{menu:"edit-menu",args:[this.tr("Paste"),cv.theme.dark.Images.getIcon("paste",18),this._commandGroup.get("paste")],enabled:!1},"source-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use text editor")],general:!0,enabled:!0,properties:{model:"source",group:e}},"xml-editor":{menu:"preferences-menu",clazz:qx.ui.menu.RadioButton,args:[this.tr("Use xml editor")],general:!0,enabled:!0,properties:{model:"xml",group:e}},"quick-preview":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Enable quick preview")],general:!0,enabled:!0,separator:"before"},"expert-mode":{menu:"preferences-menu",clazz:qx.ui.menu.CheckBox,args:[this.tr("Expert mode")],general:!0,enabled:!0},help:{menu:"help-menu",args:[this.tr("Help"),cv.theme.dark.Images.getIcon("help",18),this._commandGroup.get("help")],enabled:!1},about:{menu:"help-menu",args:[this.tr("About")],enabled:!1}};this.maintainButtons();var t=cv.ui.manager.model.Preferences.getInstance();t.bind("defaultConfigEditor",e,"modelSelection",{converter:function(e){return[e]}});e.getModelSelection().addListener("change",(function(){t.setDefaultConfigEditor(e.getModelSelection().getItem(0))}));this.__P_26_3("quick-preview","quickPreview");this.__P_26_3("expert-mode","expertMode")},__P_26_3:function(e,t){var n=this.getButton(e),i=cv.ui.manager.model.Preferences.getInstance();i.bind(t,n,"value");n.bind("value",i,t)},maintainButtons:function(e){if(e){e=Object.merge(this.__P_26_1,e);this.__P_26_2=e}else e=this.__P_26_1;Object.keys(e).forEach((function(t){var n,i=e[t];if(Object.prototype.hasOwnProperty.call(this.__P_26_0,t))n=this.__P_26_0[t];else{var r=i.args[0],a=i.args[1],o=i.args[2],s=i.clazz||qx.ui.menu.Button;if(qx.lang.Type.isString(o)||!o){n=new s(r,a);o&&n.getChildControl("shortcut").setValue(o)}else(n=new s(r,a,o)).bind("enabled",o,"enabled");n.addListener("execute",(function(){qx.event.message.Bus.dispatchByName("cv.manager.action."+t)}));if(!i.hidden){var l=this.getChildControl(i.menu);if(!l)throw new Error("no menu named "+i.menu+" found!");"before"===i.separator&&l.add(new qx.ui.menu.Separator);l.add(n);"after"===i.separator&&l.add(new qx.ui.menu.Separator)}this.__P_26_0[t]=n;Object.prototype.hasOwnProperty.call(i,"onAfterCreate")&&i.onAfterCreate(n)}n.setEnabled(i.enabled);i.properties&&n.set(i.properties)}),this)},getButton:function(e){return this.__P_26_0[e]},getButtonConfiguration:function(){return this.__P_26_2||this.__P_26_1},_createChildControlImpl:function(e){var t;switch(e){case"title":t=new qx.ui.basic.Label(this.tr("CometVisu Manager"));this.add(t);break;case"file":t=new qx.ui.menubar.Button(this.tr("File"),null,this.getChildControl("file-menu"));this.add(t);break;case"edit":t=new qx.ui.menubar.Button(this.tr("Edit"),null,this.getChildControl("edit-menu"));this.add(t);break;case"help":t=new qx.ui.menubar.Button(this.tr("Help"),null,this.getChildControl("help-menu"));this.add(t);break;case"about":t=new qx.ui.menubar.Button(this.tr("About"),null,this.getChildControl("help-menu"));this.add(t);break;case"new":t=new qx.ui.menu.Button(this.tr("New"),null,null,this.getChildControl("new-menu"));break;case"preferences":t=new qx.ui.menubar.Button(this.tr("Preferences"),null,this.getChildControl("preferences-menu"));this.add(t);break;case"new-menu":case"edit-menu":case"preferences-menu":case"help-menu":t=new qx.ui.menu.Menu;break;case"file-menu":(t=new qx.ui.menu.Menu).add(this.getChildControl("new"))}return t||cv.ui.manager.MenuBar.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this._commandGroup=null}});cv.ui.manager.MenuBar.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.core.Environment":{defer:"load",usage:"dynamic",require:!0},"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.util.ResourceManager":{},"qx.util.AliasManager":{},"qx.theme.manager.Color":{},"qx.html.Image":{},"qx.io.ImageLoader":{},"qx.lang.String":{},"qx.bom.client.Css":{require:!0},"qx.html.Element":{},"qx.html.Label":{},"qx.bom.client.Engine":{require:!0},"qx.bom.client.Browser":{require:!0},"qx.bom.element.Decoration":{},"qx.lang.Type":{},"qx.bom.AnimationFrame":{},"qx.theme.manager.Font":{},"qx.lang.Object":{},"qx.theme.manager.Decoration":{},"qx.ui.core.queue.Layout":{}},environment:{provided:[],required:{"css.alphaimageloaderneeded":{className:"qx.bom.client.Css"},"engine.name":{className:"qx.bom.client.Engine",load:!0},"engine.version":{className:"qx.bom.client.Engine"},"browser.documentmode":{className:"qx.bom.client.Browser"}}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.basic.Image",{extend:qx.ui.core.Widget,construct:function(e){this.__P_29_0={};qx.ui.core.Widget.constructor.call(this);e&&this.setSource(e)},properties:{source:{check:"String",init:null,nullable:!0,event:"changeSource",apply:"_applySource",themeable:!0,transform:"_transformSource"},scale:{check:"Boolean",init:!1,event:"changeScale",themeable:!0,apply:"_applyScale"},forceScale:{check:"Boolean",init:!1},forceRatio:{init:"auto",check:["disabled","height","width","auto"],apply:"_applyDimension"},allowScaleUp:{init:!1,check:"Boolean",apply:"_applyDimension"},appearance:{refine:!0,init:"image"},allowShrinkX:{refine:!0,init:!1},allowShrinkY:{refine:!0,init:!1},allowGrowX:{refine:!0,init:!1},allowGrowY:{refine:!0,init:!1}},events:{loadingFailed:"qx.event.type.Event",loaded:"qx.event.type.Event",aborted:"qx.event.type.Event"},statics:{PLACEHOLDER_IMAGE:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},members:{__P_29_1:null,__P_29_2:null,__P_29_3:null,__P_29_0:null,__P_29_4:null,__P_29_5:null,__P_29_6:0,_transformSource:function(e){if(e&&e.startsWith("resource/")){if(qx.util.ResourceManager.getInstance().has(e.substring(9)))return e.substring(9)}return e},_onChangeTheme:function(){cv.ui.manager.basic.Image.superclass.prototype._onChangeTheme.call(this);this._styleSource()},getContentElement:function(){return this.__P_29_7()},_createContentElement:function(){return this.__P_29_7()},_getContentHint:function(){return{width:this.__P_29_1||0,height:this.__P_29_2||0}},_applyDecorator:function(e,t){cv.ui.manager.basic.Image.superclass.prototype._applyDecorator.call(this,e,t);var n=this.getSource();n=qx.util.AliasManager.getInstance().resolve(n);var i=this.getContentElement();this.__P_29_5&&(i=i.getChild(0));this.__P_29_8(i,n)},_applyTextColor:function(e){if("font"===this.__P_29_9()){var t=this.getContentElement();this.__P_29_5&&(t=t.getChild(0));e?t.setStyle("color",qx.theme.manager.Color.getInstance().resolve(e)):t.removeStyle("color")}},_applyPadding:function(e,t,n){cv.ui.manager.basic.Image.superclass.prototype._applyPadding.call(this,e,t,n);var i=this.getContentElement();this.__P_29_5?i.getChild(0).setStyles({top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0}):"font"===this.__P_29_9()?i.setStyles({top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0}):i instanceof qx.html.Image&&i.setPadding(this.getPaddingLeft()||0,this.getPaddingTop()||0)},renderLayout:function(e,t,n,i){cv.ui.manager.basic.Image.superclass.prototype.renderLayout.call(this,e,t,n,i);var r=this.getContentElement();this.__P_29_5&&r.getChild(0).setStyles({width:n-(this.getPaddingLeft()||0)-(this.getPaddingRight()||0),height:i-(this.getPaddingTop()||0)-(this.getPaddingBottom()||0),top:this.getPaddingTop()||0,left:this.getPaddingLeft()||0})},_applyEnabled:function(e,t){cv.ui.manager.basic.Image.superclass.prototype._applyEnabled.call(this,e,t);this.getSource()&&this._styleSource()},_applySource:function(e,t){t&&qx.io.ImageLoader.isLoading(t)&&qx.io.ImageLoader.abort(t);this._styleSource()},_applyScale:function(e){this._styleSource()},__P_29_10:function(e){this.__P_29_3=e},__P_29_9:function(){if(null===this.__P_29_3){var e=this.getSource();if(e&&qx.lang.String.startsWith(e,"@"))this.__P_29_3="font";else if(e&&e.startsWith("<svg"))this.__P_29_3="svg";else{var t=!1;null!==e&&(t=e.endsWith(".png"));this.getScale()&&t&&qx.core.Environment.get("css.alphaimageloaderneeded")?this.__P_29_3="alphaScaled":this.getScale()||this.getForceScale()?this.__P_29_3="scaled":this.__P_29_3="nonScaled"}}return this.__P_29_3},__P_29_11:function(e){var t,n,i=qx.html.Image;switch(e){case"svg":i=qx.html.Element;n="div";break;case"font":i=qx.html.Label;t=!0;n="div";break;case"alphaScaled":t=!0;n="div";break;case"nonScaled":t=!1;n="div";break;default:t=!0;n="img"}var r=new i(n);r.connectWidget(this);r.setStyles({overflowX:"hidden",overflowY:"hidden",boxSizing:"border-box"});if("font"===e)r.setRich(!0);else if("svg"!==e){r.setScale(t);if(qx.core.Environment.get("css.alphaimageloaderneeded")){var a=this.__P_29_5=new qx.html.Element("div");r.connectWidget(this);a.setStyle("position","absolute");a.add(r);return a}}return r},__P_29_7:function(){if(this.$$disposed)return null;var e=this.__P_29_9();this.__P_29_0[e]||(this.__P_29_0[e]=this.__P_29_11(e));var t=this.__P_29_0[e];this.__P_29_4||(this.__P_29_4=t);return t},_styleSource:function(){var e=qx.util.AliasManager.getInstance(),t=qx.util.ResourceManager.getInstance(),n=e.resolve(this.getSource()),i=this.getContentElement();this.__P_29_5&&(i=i.getChild(0));if(n){this.__P_29_13(n);if("mshtml"==qx.core.Environment.get("engine.name")&&(parseInt(qx.core.Environment.get("engine.version"),10)<9||qx.core.Environment.get("browser.documentmode")<9)){var r=this.getScale()?"scale":"no-repeat";i.tagNameHint=qx.bom.element.Decoration.getTagName(r,n)}var a=this.__P_29_14();if(t.isFontUri(n)){this.__P_29_15(a,n);var o=this.getTextColor();qx.lang.Type.isString(o)&&this._applyTextColor(o,null)}else if(n&&n.startsWith("<svg"))this.__P_29_15(a,n);else if(t.has(n)){var s=t.findHighResolutionSource(n);if(s){var l=t.getImageWidth(n),c=t.getImageHeight(n);this.setWidth(l);this.setHeight(c);var u=l+"px, "+c+"px";this.__P_29_4.setStyle("background-size",u);this.setSource(s);n=s}this.__P_29_15(a,n);this.__P_29_16()}else if(qx.io.ImageLoader.isLoaded(n)){this.__P_29_17(a,n);this.__P_29_16()}else this.__P_29_18(a,n)}else this.__P_29_12(i)},__P_29_16:function(){this.__P_29_6++;qx.bom.AnimationFrame.request(function(e){e===this.__P_29_6?this.fireEvent("loaded"):this.fireEvent("aborted")}.bind(this,this.__P_29_6))},__P_29_14:function(){var e=this.__P_29_4;this.__P_29_5&&(e=e.getChild(0));return e},__P_29_13:qx.core.Environment.select("engine.name",{mshtml:function(e){var t=qx.core.Environment.get("css.alphaimageloaderneeded"),n=e.endsWith(".png"),i=e.startsWith("@"),r=e.startsWith("<svg"),a=this.getScale()||this.getForceScale();i?this.__P_29_10("font"):r?this.__P_29_10("svg"):t&&n?a&&"alphaScaled"!==this.__P_29_9()?this.__P_29_10("alphaScaled"):a||"nonScaled"===this.__P_29_9()||this.__P_29_10("nonScaled"):a&&"scaled"!==this.__P_29_9()?this.__P_29_10("scaled"):a||"nonScaled"===this.__P_29_9()||this.__P_29_10("nonScaled");this.__P_29_19(this.__P_29_7())},default:function(e){var t=e&&qx.lang.String.startsWith(e,"@"),n=e.startsWith("<svg"),i=this.getScale()||this.getForceScale();t?this.__P_29_10("font"):n?this.__P_29_10("svg"):i&&"scaled"!==this.__P_29_9()?this.__P_29_10("scaled"):i||"nonScaled"===this.__P_29_9()||this.__P_29_10("nonScaled");this.__P_29_19(this.__P_29_7())}}),__P_29_19:function(e){var t=this.__P_29_4;if(t!==e&&null!==t){var n="px",i={},r=t.getAllStyles();if(r)for(var a in r)i[a]=r[a];"font"!==this.__P_29_9()&&"svg"!==this.__P_29_9()||delete i.backgroundImage;var o=this.getBounds();if(null!==o){i.width=o.width+n;i.height=o.height+n}var s=this.getInsets();i.left=parseInt(t.getStyle("left")||s.left)+n;i.top=parseInt(t.getStyle("top")||s.top)+n;i.zIndex=10;var l=this.__P_29_5?e.getChild(0):e;l.setStyles(i,!0);l.setSelectable(this.getSelectable());t.isVisible()?e.isVisible()||e.show():e.hide();t.isIncluded()?e.isIncluded()||e.include():e.exclude();var c=t.getParent();if(c){var u=c.getChildren().indexOf(t);c.removeAt(u);c.addAt(e,u)}var d=l.getNodeName();l.setSource?l.setSource(null):l.setValue?l.setValue(""):l.removeAll();var h=this.__P_29_14();l.tagNameHint=d;l.setAttribute("class",h.getAttribute("class"));qx.html.Element.flush();var g=h.getDomElement(),m=e.getDomElement();(t.getListeners()||[]).forEach((function(t){e.addListener(t.type,t.handler,t.self,t.capture)}));if(g&&m){var f=g.$$hash;g.$$hash=m.$$hash;m.$$hash=f}this.__P_29_4=e}},__P_29_15:function(e,t){var n=qx.util.ResourceManager.getInstance(),i=n.isFontUri(t),r=t.startsWith("<svg");if(!this.getEnabled()){var a=t.replace(/\.([a-z]+)$/,"-disabled.$1");if(!i&&n.has(a)){t=a;this.addState("replacement")}else this.removeState("replacement")}if(i||r||e.getSource()!==t)if(i){this.getScale()&&parseInt(t.split("/")[2],10)&&this.setScale(!1);var o,s;if(this.getScale()){var l=this.getSizeHint();o=this.getWidth()||l.width;s=this.getHeight()||l.height}else{var c=qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]),u=parseInt(t.split("/")[2]||c.getSize(),10);o=n.getImageWidth(t)||u;s=n.getImageHeight(t)||u}this.__P_29_20(o,s);this.__P_29_8(e,t)}else if(r){this.__P_29_8(e,t);this.__P_29_20(40,40)}else{this.__P_29_8(e,t);this.__P_29_20(n.getImageWidth(t),n.getImageHeight(t))}},_applyDimension:function(){cv.ui.manager.basic.Image.superclass.prototype._applyDimension.call(this);if(this.getSource()&&qx.lang.String.startsWith(this.getSource(),"@")){var e=this.getContentElement();if(e)if(this.getScale()){var t=this.getSizeHint(),n=this.getWidth()||t.width||40,i=this.getHeight()||t.height||40;e.setStyle("fontSize",(n>i?i:n)+"px")}else{var r=qx.theme.manager.Font.getInstance().resolve(this.getSource().match(/@([^/]+)/)[1]);e.setStyle("fontSize",r.getSize()+"px")}}else this.__P_29_20()},__P_29_17:function(e,t){var n=qx.io.ImageLoader;this.__P_29_8(e,t);var i=n.getWidth(t),r=n.getHeight(t);this.__P_29_20(i,r)},__P_29_18:function(e,t){var n=qx.io.ImageLoader;n.isFailed(t)?this.__P_29_12(e):n.load(t,this.__P_29_21,this)},__P_29_12:function(e){null!==e&&(e instanceof qx.html.Image?e.resetSource():e instanceof qx.html.Label?e.resetValue():e.removeAll())},__P_29_8:function(e,t){var n=t&&qx.lang.String.startsWith(t,"@");if(t&&qx.lang.String.startsWith(t,"<svg")){var i=new qx.html.Element("svg");i.useMarkup(t);e.removeAll();e.add(i)}else{if(n){var r=t.split("/"),a=t;r.length>2&&(a=r[0]+"/"+r[1]);var o=qx.util.ResourceManager.getInstance(),s=qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]),l=qx.lang.Object.clone(s.getStyles());delete l.color;e.setStyles(l);e.setStyle("font");e.setStyle("display","table-cell");e.setStyle("verticalAlign","middle");e.setStyle("textAlign","center");if(this.getScale())e.setStyle("fontSize",(this.__P_29_1>this.__P_29_2?this.__P_29_2:this.__P_29_1)+"px");else{var c=parseInt(r[2]||qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)/)[1]).getSize());e.setStyle("fontSize",c+"px")}var u=o.getData(a);if(u)e.setValue(String.fromCharCode(u[2]));else{var d=parseInt(qx.theme.manager.Font.getInstance().resolve(t.match(/@([^/]+)\/(.*)$/)[2]),16);e.setValue(String.fromCharCode(d))}return}if("div"===e.getNodeName()){var h=qx.theme.manager.Decoration.getInstance().resolve(this.getDecorator());if(h){var g=h.getStartColor()&&h.getEndColor(),m=h.getBackgroundImage();if(g||m){var f=this.getScale()?"scale":"no-repeat",p=qx.bom.element.Decoration.getAttributes(t,f),_=h.getStyles(!0),v={backgroundImage:p.style.backgroundImage,backgroundPosition:p.style.backgroundPosition||"0 0",backgroundRepeat:p.style.backgroundRepeat||"no-repeat"};if(m){v.backgroundPosition+=","+_["background-position"]||"0 0";v.backgroundRepeat+=", "+h.getBackgroundRepeat()}if(g){v.backgroundPosition+=", 0 0";v.backgroundRepeat+=", no-repeat"}v.backgroundImage+=","+(_["background-image"]||_.background);e.setStyles(v);return}}else e.setSource&&e.setSource(null)}}e.setSource&&e.setSource(t)},__P_29_21:function(e,t){if(!0!==this.$$disposed)if(e===qx.util.AliasManager.getInstance().resolve(this.getSource())){if(t.failed){this.warn("Image could not be loaded: "+e);this.fireEvent("loadingFailed")}else{if(t.aborted){this.fireEvent("aborted");return}this.fireEvent("loaded")}this.__P_29_17(this.__P_29_14(),e)}else this.fireEvent("aborted")},__P_29_20:function(e,t){void 0===e&&(e=this.__P_29_1);void 0===t&&(t=this.__P_29_2);this._recalc(e,t)&&qx.ui.core.queue.Layout.add(this)},_recalc:function(e,t){var n=this.getMaxWidth(),i=this.getMaxHeight(),r=this.getMinWidth(),a=this.getMinHeight(),o=e,s=t,l=t/e;switch(this.getForceRatio()){case"height":null!==i&&s>i?o=(s=i)/l:s<a&&(o=(s=a)/l);s<i&&this.isAllowScaleUp()&&(o=(s=i)/l);break;case"width":null!==n&&o>n?s=(o=n)*l:o<r&&(s=(o=r)*l);o<n&&this.isAllowScaleUp()&&(s=(o=n)*l);break;case"auto":case"bestfit":null!==n&&o>n?s=(o=n)*l:o<r&&(s=(o=r)*l);o<n&&this.isAllowScaleUp()&&(s=(o=n)*l);null!==i&&s>i&&(o=(s=i)/l)}o=Math.round(o);s=Math.round(s);if(o!=this.__P_29_1||s!=this.__P_29_2){this.__P_29_1=o;this.__P_29_2=s;return!0}return!1}},destruct:function(){for(var e in this.__P_29_0)Object.prototype.hasOwnProperty.call(this.__P_29_0,e)&&this.__P_29_0[e].disconnectWidget(this);delete this.__P_29_4;this.__P_29_5&&delete this.__P_29_5;this._disposeMap("__P_29_0")}});cv.ui.manager.basic.Image.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IStringForm":{require:!0},"qx.ui.form.IForm":{require:!0},"qx.ui.form.MForm":{require:!0},"cv.ui.manager.editor.Source":{},"qx.ui.core.queue.Layout":{},"qx.ui.core.queue.Manager":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.SourceCodeField",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IStringForm,qx.ui.form.IForm],include:[qx.ui.form.MForm],construct:function(e,t){qx.ui.core.Widget.constructor.call(this);this._init();t&&this.setType(t);e&&this.setValue(e);this.getContentElement().setAttribute("contenteditable","true")},events:{changeValue:"qx.event.type.Data"},properties:{type:{check:"String",init:"xml",apply:"_applyType"},focusable:{refine:!0,init:!0},autoSize:{check:"Boolean",init:!1,apply:"_autoSize"}},members:{_editor:null,__P_42_0:null,__P_42_1:null,_hasBeenEdited:!1,_applyType:function(e){if(e&&this.__P_42_0){this.setValue(this.__P_42_0);this.__P_42_0=null}},_autoSize:function(){if(this._editor&&this.isAutoSize()){var e=19*(this._editor.getModel().getLineCount()+1);this._setAreaHeight(e)}},setValue:function(e){this._hasBeenEdited||(this._editor&&this.getType()?this._editor.setValue(e):this.__P_42_0=e);this._autoSize()},resetValue:function(){this._editor&&this._editor.setValue("")},getValue:function(){return this._editor?this._editor.getValue():this.__P_42_0?this.__P_42_0:""},_init:function(){var e=this;if(window.monaco){var t=this.getContentElement().getDomElement();if(t){this._editor=window.monaco.editor.create(t,{suggestOnTriggerCharacters:!0,folding:!0,autoIndent:!0,automaticLayout:!0,dragAndDrop:!0,formatOnPaste:!0,formatOnType:!0,renderValidationDecorations:"on",minimap:{enabled:!1},theme:"vs-dark"});if(this.getType()){var n=this._editor.getModel(),i=monaco.Uri.parse("cv://SourceCode."+this.getType()),r=window.monaco.editor.getModel(i);r?r.setValue(this.__P_42_0):r=window.monaco.editor.createModel(this.__P_42_0,this.getType(),i);if(n!==r){r.updateOptions({tabSize:2,indentSize:2,insertSpaces:!0});this._editor.setModel(r);this._autoSize()}}this.__P_42_0&&(this.__P_42_0=null);this._editor.onDidChangeModelContent(this._onContentChange.bind(this))}else this.addListenerOnce("appear",(function(){e._init()}))}else cv.ui.manager.editor.Source.load(this._init,this)},_onContentChange:function(){this._hasBeenEdited=!0;this.fireDataEvent("changeValue",this._editor.getValue());this._autoSize()},getFocusElement:function(){var e=this.getContentElement();return e||null},_setAreaHeight:function(e){if(this.__P_42_1!==e){this.__P_42_1=e;qx.ui.core.queue.Layout.add(this);qx.ui.core.queue.Manager.flush();this._editor&&this._editor.layout()}},_getContentHint:function(){var e=cv.ui.manager.form.SourceCodeField.superclass.prototype._getContentHint.call(this);this.isAutoSize()&&(e.height=this.__P_42_1||e.height);return e}},destruct:function(){this._hasBeenEdited=!1;if(this._editor){this._editor.dispose();this._editor=null}}});cv.ui.manager.form.SourceCodeField.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.Option",{extend:qx.core.Object,construct:function(e,t,n,i){qx.core.Object.constructor.call(this);e&&this.setLabel(e);t&&this.setIcon(t);n&&this.setValue(n);i&&this.setHints(i)},properties:{type:{check:["default","group","state","error"],init:"default",event:"changeType"},label:{check:"String",event:"changeLabel"},icon:{event:"changeIcon",nullable:!0},value:{check:"String",event:"changeValue",nullable:!0},hints:{check:"Object",nullable:!0}}});cv.ui.manager.form.Option.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.ListItem":{require:!0},"cv.ui.manager.basic.Image":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.ListItem",{extend:qx.ui.form.ListItem,members:{_createChildControlImpl:function(e,t){var n;if("icon"===e){(n=new cv.ui.manager.basic.Image(this.getIcon())).set({anonymous:!0,scale:!0,maxHeight:64});this._addAt(n,0);null!==this.getIcon()&&"label"!==this.getShow()||n.exclude()}return n||cv.ui.manager.form.ListItem.superclass.prototype._createChildControlImpl.call(this,e)}}});cv.ui.manager.form.ListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.VirtualSelectBox":{require:!0},"cv.ui.manager.form.ListItem":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.VirtualSelectBox",{extend:qx.ui.form.VirtualSelectBox,members:{_createChildControlImpl:function(e,t){var n;if("atom"===e){(n=new cv.ui.manager.form.ListItem("")).setCenter(!1);n.setAnonymous(!0);this._add(n,{flex:1})}return n||cv.ui.manager.form.VirtualSelectBox.superclass.prototype._createChildControlImpl.call(this,e,t)}}});cv.ui.manager.form.VirtualSelectBox.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.form.CheckBox":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.CheckBox",{extend:qx.ui.form.CheckBox,members:{_onExecute:function(e){this.isTriState()?!0===this.getValue()?this.setValue(!1):!1===this.getValue()?this.setValue(null):this.setValue(!0):this.toggleValue()},_applyValue:function(e,t){cv.ui.manager.form.CheckBox.superclass.prototype._applyValue.call(this,e,t);null===e?this.setLabel(" - "+this.tr("not set")+" - "):this.setLabel("")}}});cv.ui.manager.form.CheckBox.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qxl.dialog.FormRenderer":{require:!0},"qx.ui.form.RadioGroup":{},"qx.ui.basic.Label":{},"qx.ui.menu.Separator":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.ElementFormRenderer",{extend:qxl.dialog.FormRenderer,members:{addItems:function(e,t,n){if(null!==n){this._add(this._createHeader(n),{row:this._row,column:0,colSpan:2});this._row++}for(var i=0;i<e.length;i++){var r=e[i],a=void 0,o=void 0;a=r instanceof qx.ui.form.RadioGroup?"horizontal"===r.getUserData("orientation")?this._createHBoxForRadioGroup(r):this._createWidgetForRadioGroup(r):r;if(t[i]&&r.getUserData("excluded")){(o=new qx.ui.basic.Label(t[i])).setRich(!0);this._add(o,{row:this._row,column:0,colSpan:2})}else if(t[i]){(o=this._createLabel(t[i],r)).setRich(!0);this._add(o,{row:this._row,column:0});this._add(a,{row:this._row,column:1})}else this._add(a,{row:this._row,column:0,colSpan:2});this._row++;if(r.getUserData("help")){(o=new qx.ui.basic.Label(r.getUserData("help"))).setRich(!0);o.setAppearance("helptext");this._add(o,{row:this._row,column:1});this._row++}this._add(new qx.ui.menu.Separator,{row:this._row,column:0,colSpan:2});this._row++;0===i&&a.focus()}}}});cv.ui.manager.form.ElementFormRenderer.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.DocumentationMapping",{type:"static",statics:{MAP:{_base:"https://www.cometvisu.org/CometVisu/",address:"/develop/manual/config/address.html#address",audio:"/develop/manual/config/widgets/audio/index.html#audio",bashrc:"/develop/manual/tutorial/rpi_prequesites.html#bashrc",break:"/develop/manual/config/widgets/break/index.html#break",clock:"/develop/manual/config/widgets/plugins/clock/index.html#clock",colorchooser:"/develop/manual/config/widgets/colorchooser/index.html#colorchooser","custom-css":"/develop/manual/config/customizing.html#custom-css","custom-cssrules":"/develop/manual/config/customizing.html#custom-cssrules","custom-plugins":"/develop/manual/config/customizing.html#custom-plugins",customizing:"/develop/manual/config/customizing.html#customizing","cv-installation-in-terminal":"/develop/manual/tutorial/rpi_cometvisu.html#cv-installation-in-terminal",designtoggle:"/develop/manual/config/widgets/designtoggle/index.html#designtoggle",diagram:"/develop/manual/config/widgets/plugins/diagram/index.html#diagram","diagram-influx":"/develop/manual/config/widgets/plugins/diagram/index.html#diagram-influx","diagram-info":"/develop/manual/config/widgets/plugins/diagram_info/index.html#diagram-info",docker:"/develop/manual/install/docker.html#docker","docker-openhab-installation":"/develop/manual/install/docker_openhab.html#docker-openhab-installation",dockerenvironment:"/develop/manual/install/docker.html#dockerenvironment",editor:"/develop/manual/config/editor.html#editor",enablecache:"/develop/manual/config/url-params.html#enablecache",flavour:"/develop/manual/config/flavour.html#flavour",format:"/develop/manual/config/format.html#format",gauge:"/develop/manual/config/widgets/plugins/gauge/index.html#gauge",group:"/develop/manual/config/widgets/group/index.html#group","hidden-config":"/develop/manual/config/hidden-config.html#hidden-config",image:"/develop/manual/config/widgets/image/index.html#image",imagetrigger:"/develop/manual/config/widgets/imagetrigger/index.html#imagetrigger",include:"/develop/manual/config/widgets/include/index.html#include",info:"/develop/manual/config/widgets/info/index.html#info","info-seite":"/develop/manual/config/widgets/plugins/rsslog/index.html#info-seite",infoaction:"/develop/manual/config/widgets/infoaction/index.html#infoaction",infotrigger:"/develop/manual/config/widgets/infotrigger/index.html#infotrigger","install-no-pakets":"/develop/manual/install/install-dev.html#install-no-pakets",layout:"/develop/manual/config/layout.html#layout",line:"/develop/manual/config/widgets/line/index.html#line",link:"/develop/manual/config/widgets/plugins/link/index.html#link",log:"/develop/manual/config/url-params.html#log","long-polling":"/develop/manual/devel/transport/long-polling.html#long-polling",manager:"/develop/manual/config/manager.html#manager",mapping:"/develop/manual/config/mapping.html#mapping",multitrigger:"/develop/manual/config/widgets/multitrigger/index.html#multitrigger",navbar:"/develop/manual/config/widgets/navbar/index.html#navbar","nodered-installation-in-terminal":"/develop/manual/tutorial/rpi_nodered.html#nodered-installation-in-terminal",notificationcenterbadge:"/develop/manual/config/widgets/notificationcenterbadge/index.html#notificationcenterbadge",notifications:"/develop/manual/config/notifications.html#notifications","openhab-plugin":"/develop/manual/config/widgets/plugins/openhab/index.html#openhab-plugin",openweathermap:"/develop/manual/config/widgets/plugins/openweathermap/index.html#openweathermap",page:"/develop/manual/config/widgets/page/index.html#page",pagejump:"/develop/manual/config/widgets/pagejump/index.html#pagejump",powerspectrum:"/develop/manual/config/widgets/plugins/powerspectrum/index.html#powerspectrum",pushbutton:"/develop/manual/config/widgets/pushbutton/index.html#pushbutton",refresh:"/develop/manual/config/widgets/refresh/index.html#refresh",reload:"/develop/manual/config/widgets/reload/index.html#reload",reporterrors:"/develop/manual/config/url-params.html#reporterrors",reporting:"/develop/manual/config/url-params.html#reporting",rgb:"/develop/manual/config/widgets/rgb/index.html#rgb",roundbar:"/develop/manual/config/widgets/roundbar/index.html#roundbar","rpi-tutorial-cometvisu-in-docker":"/develop/manual/tutorial/rpi_cometvisu.html#rpi-tutorial-cometvisu-in-docker","rrd-introduction":"/develop/manual/config/rrd_examples.html#rrd-introduction",rsslog:"/develop/manual/config/widgets/plugins/rsslog/index.html#rsslog","size-attributes":"/develop/manual/config/size-attributes.html#size-attributes",slide:"/develop/manual/config/widgets/slide/index.html#slide",speech:"/develop/manual/config/widgets/plugins/speech/index.html#speech",sse:"/develop/manual/devel/transport/sse.html#sse",strftime:"/develop/manual/config/widgets/plugins/strftime/index.html#strftime",styling:"/develop/manual/config/styling.html#styling",switch:"/develop/manual/config/widgets/switch/index.html#switch","system-voraussetzungen":"/develop/manual/#system-voraussetzungen",text:"/develop/manual/config/widgets/text/index.html#text","tile-backend-system":"/develop/manual/config/structure-tile/elements/backend.html#tile-backend-system","tile-component-button":"/develop/manual/config/structure-tile/components/button.html#tile-component-button","tile-component-chart":"/develop/manual/config/structure-tile/components/chart.html#tile-component-chart","tile-component-color":"/develop/manual/config/structure-tile/components/color.html#tile-component-color","tile-component-group":"/develop/manual/config/structure-tile/components/group.html#tile-component-group","tile-component-icon":"/develop/manual/config/structure-tile/components/icon.html#tile-component-icon","tile-component-image":"/develop/manual/config/structure-tile/components/image.html#tile-component-image","tile-component-list":"/develop/manual/config/structure-tile/components/list.html#tile-component-list","tile-component-menu":"/develop/manual/config/structure-tile/components/menu.html#tile-component-menu","tile-component-page":"/develop/manual/config/structure-tile/components/page.html#tile-component-page","tile-component-popup":"/develop/manual/config/structure-tile/components/popup.html#tile-component-popup","tile-component-select":"/develop/manual/config/structure-tile/components/select.html#tile-component-select","tile-component-slider":"/develop/manual/config/structure-tile/components/slider.html#tile-component-slider","tile-component-spinner":"/develop/manual/config/structure-tile/components/spinner.html#tile-component-spinner","tile-component-value":"/develop/manual/config/structure-tile/components/value.html#tile-component-value","tile-components":"/develop/manual/config/structure-tile/index.html#tile-components","tile-dimmer":"/develop/manual/config/structure-tile/widgets/dimmer.html#tile-dimmer","tile-element-address":"/develop/manual/config/structure-tile/elements/address.html#tile-element-address","tile-element-address-target":"/develop/manual/config/structure-tile/elements/address.html#tile-element-address-target","tile-element-backend":"/develop/manual/config/structure-tile/elements/backend.html#tile-element-backend","tile-element-loader":"/develop/manual/config/structure-tile/elements/loader.html#tile-element-loader","tile-element-mapping":"/develop/manual/config/structure-tile/elements/mapping.html#tile-element-mapping","tile-element-state-notification":"/develop/manual/config/structure-tile/elements/state-notification.html#tile-element-state-notification","tile-element-style":"/develop/manual/config/structure-tile/elements/style.html#tile-element-style","tile-element-styling":"/develop/manual/config/structure-tile/elements/styling.html#tile-element-styling","tile-info":"/develop/manual/config/structure-tile/widgets/info.html#tile-info","tile-item-menu":"/develop/manual/config/structure-tile/components/menu.html#tile-item-menu","tile-media-player":"/develop/manual/config/structure-tile/widgets/media-player.html#tile-media-player","tile-nav-menu":"/develop/manual/config/structure-tile/components/menu.html#tile-nav-menu","tile-rtc":"/develop/manual/config/structure-tile/widgets/rtc.html#tile-rtc","tile-shutter":"/develop/manual/config/structure-tile/widgets/shutter.html#tile-shutter","tile-small-status":"/develop/manual/config/structure-tile/widgets/small-status.html#tile-small-status","tile-status":"/develop/manual/config/structure-tile/widgets/status.html#tile-status","tile-status-chart":"/develop/manual/config/structure-tile/widgets/status-chart.html#tile-status-chart","tile-switch":"/develop/manual/config/structure-tile/widgets/switch.html#tile-switch","tile-widget-pair":"/develop/manual/config/structure-tile/widgets/widget-pair.html#tile-widget-pair","tile-widgets":"/develop/manual/config/structure-tile/index.html#tile-widgets",timberwolf:"/develop/manual/install/timberwolf.html#timberwolf","timberwolf-portainer":"/develop/manual/install/timberwolf.html#timberwolf-portainer",timeout:"/develop/manual/config/widgets/plugins/timeout/index.html#timeout",toggle:"/develop/manual/config/widgets/toggle/index.html#toggle",tr064:"/develop/manual/config/widgets/plugins/tr064/index.html#tr064",trigger:"/develop/manual/config/widgets/trigger/index.html#trigger",tutorials:"/develop/manual/tutorial/index.html#tutorials",urltrigger:"/develop/manual/config/widgets/urltrigger/index.html#urltrigger",video:"/develop/manual/config/widgets/video/index.html#video","visu-config-details":"/develop/manual/config/index.html#visu-config-details",web:"/develop/manual/config/widgets/web/index.html#web","wgplugin-info":"/develop/manual/config/widgets/wgplugin_info/index.html#wgplugin-info",widgets:"/develop/manual/config/widgets/index.html#widgets",worker:"/develop/manual/config/url-params.html#worker","xml-format":"/develop/manual/config/xml-format.html#xml-format","xml-format-files":"/develop/manual/config/xml-format.html#xml-format-files","xml-format-header":"/develop/manual/config/xml-format.html#xml-format-header","xml-format-icons":"/develop/manual/config/xml-format.html#xml-format-icons","xml-format-mappings":"/develop/manual/config/xml-format.html#xml-format-mappings","xml-format-pages":"/develop/manual/config/xml-format.html#xml-format-pages","xml-format-plugins":"/develop/manual/config/xml-format.html#xml-format-plugins","xml-format-statusbar":"/develop/manual/config/xml-format.html#xml-format-statusbar","xml-format-stylings":"/develop/manual/config/xml-format.html#xml-format-stylings","xml-format-templates":"/develop/manual/config/xml-format.html#xml-format-templates"}}});cv.ui.manager.model.schema.DocumentationMapping.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.SimpleType",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.__P_50_0=[];this.__P_50_1=[];this.__P_50_2={};this.__P_50_3=[];this.parse()},properties:{type:{refine:!0,init:"simpleType"},optional:{check:"Boolean",init:!1},baseType:{check:"String",nullable:!0}},members:{__P_50_1:null,__P_50_0:null,__P_50_3:null,__P_50_2:null,parse:function(){var e=this.getNode();this.setOptional("required"===e.getAttribute("use"));this.__P_50_4(e)},__P_50_4:function(e){var t=this,n=this.getSchema();if(e.hasAttribute("ref")){var i=e.getAttribute("ref");if(!(e=n.getReferencedNode("attribute",i)))throw new Error("schema/xsd appears to be invalid, can not find element "+i)}if(e.hasAttribute("type")){var r=e.getAttribute("type");if(r.match(/^xsd:/))this.setBaseType(r);else{var a=n.getReferencedNode("simpleType",r);this.__P_50_4(a)}this.setOptional("required"!==e.getAttribute("use"))}else{Array.from(e.querySelectorAll(":scope > restriction, :scope > extension, :scope > simpleType > restriction, :scope > simpleType > extension")).forEach((function(e){var i=e.getAttribute("base");if(i.match(/^xsd:/))t.setBaseType(i);else{var r=n.getReferencedNode("simpleType",i);t.__P_50_4(r)}Array.from(e.querySelectorAll(":scope > pattern")).forEach((function(e){t.__P_50_1.push(e.getAttribute("value"))}));Array.from(e.querySelectorAll(":scope > enumeration")).forEach((function(e){t.__P_50_0.push(e.getAttribute("value"))}))}));this.getBaseType()||this.setBaseType("xsd:anyType");this.__P_50_3.push(this.getBaseType())}},isValueValid:function(e){var t=this,n=this.getBaseType(),i=this.getSchema();if(!n)throw new Error("something is wrong, do not have a baseType for type");if(""===e)return this.isOptional();if(-1===n.search(/^xsd:/)){var r=i.getTypeNode("simple",n);return new cv.ui.manager.model.schema.SimpleType(r,i).isValueValid(e)}switch(n){case"xsd:string":case"xsd:anyURI":case"xsd:anyType":if("string"!=typeof e)return!1;break;case"xsd:decimal":if(!e.match(/^[-+]?[0-9]*(\.[0-9]+)?$/))return!1;break;case"xsd:unsignedByte":case"xsd:nonNegativeInteger":if(!e.match(/^[+]?[0-9]+$/))return!1;break;case"xsd:integer":if(!e.match(/^[-+]?[0-9]+$/))return!1;break;case"xsd:float":if(!e.match(/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/))return!1;break;case"xsd:boolean":if(!e.match(/^(true|false|0|1)$/))return!1;break;default:throw new Error("not implemented baseType "+n)}if(this.__P_50_0.length>0&&!this.__P_50_0.includes(e))return!1;if(this.__P_50_1.length>0){var a=!0;this.__P_50_1.forEach((function(n){if(!Object.prototype.hasOwnProperty.call(t.__P_50_2,n)){for(var i=[],r=0,o=n.indexOf("|",r);o<n.length&&!(o<0);){for(var s=!0,l=o;l>=r&&"]"!==n[l];l--)"["===n[l]&&(s=!1);s&&i.push([r,o-r]);r=o+1;o=n.indexOf("|",r);if(i.length>100){t.error("too many branchIndices");break}}n.length>r&&i.push([r,n.length-r]);var c=i.map((function(e){return"^".concat(n.substr(e[0],e[1]).replace(/\\([\s\S])|(\$)/g,"\\$1$2"),"$")}));t.__P_50_2[n]=t.regexFromString(c.join("|"))}!1===t.__P_50_2[n].test(e)&&(a=!1)}),this);if(!1===a)return!1}return!0},getEnumeration:function(){return"xsd:boolean"===this.getBaseType()?["true","false"]:this.__P_50_0}},destruct:function(){this.__P_50_2=null}});cv.ui.manager.model.schema.SimpleType.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.model.schema.Sequence":{},"cv.ui.manager.model.schema.Group":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Choice",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"choice"}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Choice.superclass.prototype.parse.call(this);var t=this.getNode(),n=this.getSchema();Array.from(t.querySelectorAll(":scope > element")).forEach((function(t){var i=new cv.ui.manager.model.schema.Element(t,n);i.setSortable(!0);e._allowedElements[i.getName()]=i}));this._allowedElements["#comment"]=this.getSchema().getCommentNodeSchemaElement();Array.from(t.querySelectorAll(":scope > choice")).forEach((function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Choice(t,n))}));Array.from(t.querySelectorAll(":scope > sequence")).forEach((function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Sequence(t,n))}));Array.from(t.querySelectorAll(":scope > group")).forEach((function(t){e._subGroupings.push(new cv.ui.manager.model.schema.Group(t,n))}))},getRequiredElements:function(){return[]},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var n="(";t&&(n+="?:");for(var i=[],r=0,a=Object.values(this._allowedElements);r<a.length;r++){var o=a[r];i.push(o.getRegex(e,t))}this._subGroupings.forEach((function(n){i.push(n.getRegex(e,t))}));n+=i.join("|");n+=")";n+="{";var s=this.getBounds();n+=void 0===s.min?1:s.min;n+=",";s.max!==Number.POSITIVE_INFINITY&&(n+=void 0===s.max?1:s.max);n+="}";this._regexCache=n;return n},getBoundsForElementName:function(e){if(!0===this.isElementAllowed(e))return this.getBounds()},getAllowedElementsSorting:function(e){var t={};Object.keys(this._allowedElements).forEach((function(n){var i=this._allowedElements[n],r="x";void 0!==e&&(r=e+"."+r);if("element"===i.getType())t[i.getName()]=r;else{var a=i.getAllowedElementsSorting(r);Object.assign(t,a)}}),this);this._subGroupings.forEach((function(n,i){var r="x";void 0!==e&&(r=e+"."+r);if("element"===n.getType())t[n.getName()]=r;else{var a=n.getAllowedElementsSorting(r);Object.assign(t,a)}}),this);return t}}});cv.ui.manager.model.schema.Choice.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Element":{},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Group":{},"cv.ui.manager.model.schema.Any":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Sequence",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"sequence"},elementsHaveOrder:{refine:!0,init:!0}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Sequence.superclass.prototype.parse.call(this);var t=this.getSchema();Array.from(this.getNode().children).forEach((function(n){var i;switch(n.nodeName){case"xsd:element":case"element":(i=new cv.ui.manager.model.schema.Element(n,t)).setSortable(!1);e._allowedElements[i.getName()]=i;break;case"xsd:choice":case"choice":i=new cv.ui.manager.model.schema.Choice(n,t);e._subGroupings.push(i);break;case"xsd:sequence":case"sequence":i=new cv.ui.manager.model.schema.Sequence(n,t);e._subGroupings.push(i);break;case"xsd:group":case"group":i=new cv.ui.manager.model.schema.Group(n,t);e._subGroupings.push(i);break;case"xsd:any":case"any":i=new cv.ui.manager.model.schema.Any(n,t);e._subGroupings.push(i)}e._sortedContent.push(i)}));this._allowedElements["#comment"]=this.getSchema().getCommentNodeSchemaElement()},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var n="(";t&&(n+="?:");var i=[];this._sortedContent.forEach((function(n){i.push(n.getRegex(e,t))}));n+=i.join("");n+=")";n+="{";var r=this.getBounds();n+=void 0===r.min?1:r.min;n+=",";r.max!==Number.POSITIVE_INFINITY&&(n+=void 0===r.max?1:r.max);n+="}";this._regexCache=n;return n},getBoundsForElementName:function(e){if(void 0!==this._allowedElements[e]){var t=this._allowedElements[e].getBounds(),n=this.getBounds(),i={min:1,max:1};Object.prototype.hasOwnProperty.call(t,"min")&&(i.min=t.min);Object.prototype.hasOwnProperty.call(n,"min")&&!isNaN(n.min)&&(i.min*=n.min);if(t.max===Number.POSITIVE_INFINITY||n.max===Number.POSITIVE_INFINITY)i.max=Number.POSITIVE_INFINITY;else{Object.prototype.hasOwnProperty.call(t,"max")&&(i.max=t.max);Object.prototype.hasOwnProperty.call(n,"max")&&!isNaN(n.max)&&(i.max*=n.max)}return i}for(var r,a,o=0;o<this._subGroupings.length;++o)if(void 0!==(a=this._subGroupings[o].getBoundsForElementName(e))){r=a;break}return r},getAllowedElementsSorting:function(e){var t={};this._sortedContent.forEach((function(n,i){var r=i;void 0!==e&&(r=e+"."+i);if("element"===n.getType())t[n.getName()]=r;else{var a=n.getAllowedElementsSorting(r);Object.assign(t,a)}}));return t}}});cv.ui.manager.model.schema.Sequence.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Group",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"group"}},members:{parse:function(){cv.ui.manager.model.schema.Group.superclass.prototype.parse.call(this);var e=this.getSchema(),t=this.getNode();t.hasAttribute("ref")&&(t=e.getReferencedNode("group",t.getAttribute("ref")));var n=t.querySelector(":scope > choice");n?this._subGroupings.push(new cv.ui.manager.model.schema.Choice(n,e)):(n=t.querySelector(":scope > sequence"))&&this._subGroupings.push(new cv.ui.manager.model.schema.Sequence(n,e))},getAllowedElements:function(){return this._subGroupings[0].getAllowedElements()},getAllowedElementsSorting:function(e){var t={},n=this.getAllowedElements();Object.keys(n).forEach((function(i){var r=n[i],a="x";void 0!==e&&(a=e+"."+a);if("element"===r.getType())t[r.getName()]=a;else{var o=r.getAllowedElementsSorting(a);Object.assign(t,o)}}),this);return t},getRegex:function(e,t){if(null!==this._regexCache)return this._regexCache;var n="(";this._subGroupings.forEach((function(i){n="(";t&&(n+="?:");n+=i.getRegex(e,t)+")"}));n+="{";var i=this.getBounds();n+=void 0===i.min?1:i.min;n+=",";i.max!==Number.POSITIVE_INFINITY&&(n+=void 0===i.max?1:i.max);n+="}";this._regexCache=n;return n},getBoundsForElementName:function(e){return this._subGroupings[0].getBoundsForElementName(e)}}});cv.ui.manager.model.schema.Group.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.Choice":{},"cv.ui.manager.model.schema.Sequence":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Any",{extend:cv.ui.manager.model.schema.Base,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},properties:{type:{refine:!0,init:"any"}},members:{parse:function(){var e=this;cv.ui.manager.model.schema.Any.superclass.prototype.parse.call(this);var t=this.getSchema(),n=this.getNode();n.hasAttribute("ref")&&(n=t.getReferencedNode("group",n.getAttribute("ref")));n.querySelectorAll(":scope > choice").forEach((function(n){e._subGroupings.push(new cv.ui.manager.model.schema.Choice(n,t))}));n.querySelectorAll(":scope > sequence").forEach((function(n){e._subGroupings.push(new cv.ui.manager.model.schema.Sequence(n,t))}));this._subGroupings.length>0&&(this._subGroupings=[this._subGroupings[0]])},isElementAllowed:function(e){return!0},getSchemaElementForElementName:function(e){},getRequiredElements:function(){return[]},getAllowedElements:function(){return{}},getRegex:function(e,t){return".*"},hasMultiLevelBounds:function(){return!0},getBoundsForElementName:function(e){return this._bounds}}});cv.ui.manager.model.schema.Any.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"cv.ui.manager.model.schema.Base":{construct:!0,require:!0},"cv.ui.manager.model.schema.MAnnotation":{require:!0},"cv.ui.manager.model.schema.SimpleType":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.schema.Attribute",{extend:cv.ui.manager.model.schema.Base,include:cv.ui.manager.model.schema.MAnnotation,construct:function(e,t){cv.ui.manager.model.schema.Base.constructor.call(this,e,t);this.parse()},statics:{getAttributeName:function(e,t){if(e.hasAttribute("name"))return e.getAttribute("name");if(e.hasAttribute("ref")){var n=e.getAttribute("ref"),i=t.getReferencedNode("attribute",n);if(!i)throw new Error("schema/xsd appears to be invalid, can not find element "+n);return i.getAttribute("name")}return"unknown"}},properties:{type:{refine:!0,init:"attribute"},name:{check:"String",init:""},optional:{check:"Boolean",init:!1},defaultValue:{check:"String",nullable:!0}},members:{_type:null,parse:function(){var e=this.getNode(),t=this.getSchema();this._type=new cv.ui.manager.model.schema.SimpleType(e,t);this.setName(cv.ui.manager.model.schema.Attribute.getAttributeName(e,t));e.hasAttribute("default")&&this.setDefaultValue(e.getAttribute("default"));this.setOptional("required"!==e.getAttribute("use"))},isValueValid:function(e){return""===(e=null==e?"":""+e)?this.isOptional():this._type.isValueValid(e)},getTypeString:function(){var e=this._type.getBaseType();return e.match(/xsd\:/)?e.replace(/xsd\:/,""):this.tr("complex type, please see documentation")},getEnumeration:function(){return this._type.getEnumeration()}},destruct:function(){this.__P_47_0=null;this.__P_47_1=null}});cv.ui.manager.model.schema.Attribute.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"qx.event.message.Bus":{construct:!0},"cv.ui.manager.IActionHandler":{},"cv.ui.manager.Main":{},"cv.ui.manager.MenuBar":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.control.ActionDispatcher",{extend:qx.core.Object,type:"singleton",construct:function(){qx.core.Object.constructor.call(this);qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)},properties:{focusedWidget:{check:"cv.ui.manager.IActionHandler",nullable:!0,apply:"_applyFocusedWidget"},main:{check:"cv.ui.manager.Main",nullable:!0}},members:{updateBarButtons:function(){var e,t=this.getFocusedWidget(),n=cv.ui.manager.MenuBar.getInstance(),i=n.getButtonConfiguration();Object.keys(i).forEach((function(r){if(e=n.getButton(r)){e.setEnabled(i[r].general||this.hasHandler(r));t&&t.configureButton(r,e)}}),this)},_applyFocusedWidget:function(e,t){if(t){var n,i=cv.ui.manager.MenuBar.getInstance(),r=i.getButtonConfiguration();Object.keys(r).forEach((function(e){(n=i.getButton(e))&&t.unConfigureButton(e,n)}),this)}this.updateBarButtons()},hasHandler:function(e){return!!this._getHandler(e)},_getHandler:function(e){var t=this.getFocusedWidget(),n=this.getMain();return t&&t.canHandleAction(e)?t:n&&n.canHandleAction(e)?n:null},_onAction:function(e){var t=e.getName().split(".").pop(),n=this._getHandler(t);n?n.handleAction(t,e.getData()):this.warn("no action handler found for action: "+t)}},destruct:function(){qx.event.message.Bus.subscribe("cv.manager.action.*",this._onAction,this)}});cv.ui.manager.control.ActionDispatcher.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{require:!0},"cv.ui.manager.control.ActionDispatcher":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.core.GlobalState",{extend:qx.core.Object,type:"singleton",properties:{openedFocusedFile:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeOpenedFocusedFile",apply:"_applyFile"}},members:{_applyFile:function(){cv.ui.manager.control.ActionDispatcher.getInstance().updateBarButtons()}}});cv.ui.manager.core.GlobalState.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0},"cv.ui.manager.control.FileHandlerRegistry":{},"qx.Interface":{},"cv.ui.manager.editor.IEditor":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.OpenFile",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);e&&this.setFile(e);t&&this.setHandlerId(t)},properties:{file:{check:"cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles",nullable:!0,event:"changeFile",apply:"_applyFile"},handlerId:{check:"!!qx.Class.getByName(value)",nullable:!0,apply:"_maintainIcon"},handlerOptions:{check:"Map",nullable:!0},permanent:{check:"Boolean",init:!1,event:"changePermanent"},icon:{check:"String",init:"",event:"changeIcon"},closeable:{check:"Boolean",init:!0,event:"changeCloseable"}},members:{__P_44_0:null,_applyFile:function(e,t){if(t){t.removeListener("changeModified",this._maintainPermanent,this);t.removeRelatedBindings(this);this.__P_44_0=null}e&&e.addListener("changeModified",this._maintainPermanent,this);this._maintainIcon()},_maintainIcon:function(){var e=this.getFile();if(this.getHandlerId()&&e){var t=qx.Class.getByName(this.getHandlerId());if(t&&t.ICON){this.setIcon(t.ICON);if(this.__P_44_0){e.removeBinding(this.__P_44_0);this.__P_44_0=null}}else this.__P_44_0=e.bind("icon",this,"icon")}else this.resetIcon()},_maintainPermanent:function(){this.getFile().isModified()&&!this.isPermanent()&&this.setPermanent(!0)},save:function(e,t){var n,i=this.getFile(),r=this.getHandlerId();n=r?cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(r):cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(i);i.isModified()&&n&&n.instance&&qx.Interface.objectImplements(n.instance,cv.ui.manager.editor.IEditor)&&n.instance.save(e,t)}}});cv.ui.manager.model.OpenFile.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.form.IModel":{require:!0},"qx.ui.layout.HBox":{construct:!0},"qx.ui.basic.Image":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.FileTabItem",{extend:qx.ui.core.Widget,implement:[qx.ui.form.IModel],construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox);this._createChildControl("icon");this._createChildControl("label");this._createChildControl("close");this.addListener("pointerover",this._onPointerOver,this);this.addListener("pointerout",this._onPointerOut,this)},events:{close:"qx.event.type.Data",action:"qx.event.type.Event"},properties:{appearance:{refine:!0,init:"open-file-item"},model:{nullable:!0,event:"changeModel",apply:"_applyModel",dereference:!0},label:{check:"String",nullable:!0,transform:"_transformFilename",event:"changeLabel",apply:"_applyLabel"},icon:{check:"String",nullable:!0,apply:"_applyIcon"},permanent:{check:"Boolean",init:!1,apply:"_applyPermanent"},modified:{check:"Boolean",init:!1,apply:"_applyLabel"},closeable:{check:"Boolean",init:!0,apply:"_applyCloseable"},writeable:{check:"Boolean",init:!0,apply:"_applyLabel"}},members:{_forwardStates:{focused:!0,hovered:!0,selected:!0,dragover:!0},_onPointerOver:function(){this.addState("hovered")},_transformFilename:function(e){return"."===e?"":e},_onPointerOut:function(){this.removeState("hovered")},_applyPermanent:function(e){this.setFont(e?"default":"italic")},_applyCloseable:function(e){this.getChildControl("close").setVisibility(e?"visible":"excluded")},_applyModel:function(e,t){t&&t.removeRelatedBindings(this);e&&e.bind("file.writeable",this,"writeable")},_applyIcon:function(e){var t=this.getChildControl("icon");t.setSource(e);e?t.show():t.exclude()},_applyLabel:function(){var e=this.getChildControl("label");if(this.getLabel()){var t=this.getLabel();if(this.isWriteable()||this.getModel().getFile().isFake()&&"hidden.php"!==this.getModel().getFile().getName())this.resetToolTipText();else{t+=" !";this.setToolTipText(this.tr("This file is not writeable"))}this.isModified()&&(t+=" *");e.setValue(t);e.show()}else{e.exclude();this.resetToolTipText()}},_onClose:function(){this.isCloseable()&&this.fireDataEvent("close",this.getModel())},_createChildControlImpl:function(e){var t;switch(e){case"icon":(t=new qx.ui.basic.Image).setAppearance("open-file-item/icon");t.setAnonymous(!0);t.exclude();this._addAt(t,0);break;case"label":(t=new qx.ui.basic.Label).setAppearance("open-file-item/label");t.setAnonymous(!0);this._addAt(t,1);break;case"close":(t=new qx.ui.basic.Image("decoration/tabview/close.gif")).setAppearance("open-file-item/close");this.isCloseable()?t.addListener("tap",this._onClose,this):t.exclude();this._addAt(t,2)}return t||cv.ui.manager.form.FileTabItem.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this.removeListener("pointerover",this._onPointerOver,this);this.removeListener("pointerout",this._onPointerOut,this)}});cv.ui.manager.form.FileTabItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.core.Object":{construct:!0,require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.model.config.Option",{extend:qx.core.Object,construct:function(e,t){qx.core.Object.constructor.call(this);this.setKey(e);this.setValue(t)},events:{change:"qx.event.type.Event"},properties:{key:{check:"String",init:"",event:"changeKey",apply:"_applyChange"},value:{check:"String",init:"",event:"changeValue",apply:"_applyChange"}},members:{_applyChange:function(){this.fireEvent("change")}}});cv.ui.manager.model.config.Option.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.ui.layout.HBox":{construct:!0},"cv.ui.manager.model.config.Option":{},"qx.ui.form.TextField":{},"qx.ui.form.Button":{},"cv.theme.dark.Images":{},"qx.ui.basic.Label":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.form.OptionListItem",{extend:qx.ui.core.Widget,construct:function(){qx.ui.core.Widget.constructor.call(this);this._setLayout(new qx.ui.layout.HBox(8));this._createChildControl("key");this._createChildControl("value");this._createChildControl("key-title");this._createChildControl("value-title");this._createChildControl("delete");this._createChildControl("add")},properties:{appearance:{refine:!0,init:"cv-editor-config-option"},model:{check:"cv.ui.manager.model.config.Option",nullable:!0,apply:"_applyModel"},readOnly:{check:"Boolean",init:!1,event:"changeReadOnly"}},events:{delete:"qx.event.type.Data",add:"qx.event.type.Event"},members:{setLabel:function(e){},setIcon:function(){},_applyModel:function(e,t){var n=this.getChildControl("key"),i=this.getChildControl("value"),r=this.getChildControl("key-title"),a=this.getChildControl("value-title");this.__P_40_0(t);if(e){e.bind("key",n,"value");e.bind("value",i,"value");n.bind("value",e,"key");i.bind("value",e,"value");n.show();i.show();r.exclude();a.exclude();this.getChildControl("delete").show();this.getChildControl("add").show()}else{n.exclude();i.exclude();r.show();a.show();this.getChildControl("delete").hide();this.getChildControl("add").hide()}},__P_40_0:function(e){if(e){var t=this.getChildControl("key"),n=this.getChildControl("value");if(e){e.removeRelatedBindings(t);e.removeRelatedBindings(n);t.removeRelatedBindings(e);n.removeRelatedBindings(e)}}},_createChildControlImpl:function(e){var t,n=this;switch(e){case"key":(t=new qx.ui.form.TextField).set({liveUpdate:!0,required:!0});this.bind("readOnly",t,"readOnly");this._add(t,{width:"40%"});break;case"value":(t=new qx.ui.form.TextField).set({liveUpdate:!0});this.bind("readOnly",t,"readOnly");this._add(t,{width:"40%"});break;case"delete":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("delete",22))).setToolTipText(this.tr("Delete option"));t.addListener("execute",(function(){n.fireDataEvent("delete",n.getModel())}));this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t);break;case"add":(t=new qx.ui.form.Button(null,cv.theme.dark.Images.getIcon("add",18))).setToolTipText(this.tr("Add option"));t.addListener("execute",(function(){n.fireEvent("add")}));this.bind("readOnly",t,"visibility",{converter:function(e){return e?"hidden":"visible"}});this._add(t);break;case"key-title":(t=new qx.ui.basic.Label(this.tr("Key"))).exclude();this._add(t,{width:"40%"});break;case"value-title":(t=new qx.ui.basic.Label(this.tr("Value"))).exclude();this._add(t,{width:"40%"})}return t||cv.ui.manager.form.OptionListItem.superclass.prototype._createChildControlImpl.call(this,e)}},destruct:function(){this.__P_40_0(this.getModel())}});cv.ui.manager.form.OptionListItem.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{require:!0}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.basic.Icon",{extend:qx.ui.core.Widget});cv.ui.manager.basic.Icon.$$dbClassInfo=e}();!function(){var e={dependsOn:{"qx.Class":{usage:"dynamic",require:!0},"qx.ui.core.Widget":{construct:!0,require:!0},"qx.util.ResourceManager":{},"cv.svg.Element":{}}};qx.Bootstrap.executePendingDefers(e);qx.Class.define("cv.ui.manager.viewer.SvgIcon",{extend:qx.ui.core.Widget,construct:function(e){qx.ui.core.Widget.constructor.call(this);e&&this.setName(e)},properties:{name:{check:"String",nullable:!0,apply:"_applyName"},appearance:{refine:!0,init:"cv-svg-icon"}},members:{__P_55_0:null,__P_55_1:null,_applyName:function(e){var t=this;if(e){this.__P_55_0||(this.__P_55_0=qx.util.ResourceManager.getInstance().toUri("icons/knx-uf-iconset.svg"));if(!this.__P_55_1.getDomElement()){this.__P_55_1.addListenerOnce("appear",(function(){t._applyName(e)}));return}this.__P_55_1.getDomElement().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.__P_55_0+"#kuf-"+e)}else this.__P_55_1.removeAttribute("xlink:href")},_createContentElement:function(){var e=new cv.svg.Element("svg");this.__P_55_1=new cv.svg.Element("use");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");e.add(this.__P_55_1);return e}},destruct:function(){this.__P_55_1=null}});cv.ui.manager.viewer.SvgIcon.$$dbClassInfo=e}();qx.$$packageData[3]={locales:{},resources:{},translations:{en:{},de:{"Hidden configuration":"Versteckte Konfiguration","Replacing the file failed.":"Das Ersetzen der Datei ist fehlgeschlagen.","This file already exists, do you want to replace it?":"Diese Datei existiert bereits, mchten Sie sie berschreiben?","File already exists":"Diese Datei existiert bereits","Uploading this file is not allowed here.":"Das Hochladen der Datei ist an dieser Stelle nicht erleubt.","File upload stopped with an error: %1":"Das Hochladen der Datei wurde mit einem Fehler beendet: %1","File has been uploaded":"Die Datei wurde hochgeladen",Clear:"Leeren",Delete:"Lschen","Backup from %1":"Sicherung vom %1","New name":"Neuer Name","Rename file":"Datei umbenennen","New file":"Neue Datei","Clone file":"Datei duplizieren","New folder":"Neuer Ordner",Rename:"Umbenennen",Download:"Herunterladen",Open:"ffnen",Restore:"Wiederherstellen",Validate:"Prfen",Replace:"Ersetzen","Compare with...":"Vergleichen mit...","Open with...":"ffnen mit...","Convert to tile structure":"In Tile-Struktur konvertieren",Trash:"Papierkorb","Diff: %1":"Vergleich: %1",'File "%1" has been created':'Datei "%1" wurde angelegt','Folder "%1" has been created':'Ordner "%1" wurde angelegt','File "%1" has been renamed to "%2"':'Datei "%1" wurde umbenannt in "%2"','Folder "%1" has been renamed to "%2"':'Ordner "%1" wurde umbenannt in "%2"','File "%1" has been moved':'Datei "%1" wurde verschoben','Folder "%1" has been moved':'Ordner "%1" wurde verschoben',"%1 has been restored":"%1 wurde wieder hergestellt",'File "%1" has been restored':'Datei "%1" wurde wieder hergestellt','Folder "%1" has been restored':'Ordner "%1" wurde wieder hergestellt',"Do you really want to clear the trash?":"Mchten Sie den Papirtkorb wirklich leeren?",'Do you really want to delete file "%1" from the trash?':'Mchten Sie die Datei "%1" wirklich aus dem Papierkorb lschen?','Do you really want to delete folder "%1" from the trash?':'Mchten Sie den Ordner "%1" wirklich aus dem Papierkorb lschen?','Do you really want to delete file "%1"?':'Mchten Sie die Datei "%1" wirklich lschen?','Do you really want to delete folder "%1"?':'Mchten Sie den Ordner "%1" wirklich lschen?',"Confirm deletion":"Lschen besttigen","Trash has been cleared":"Der Papierkorb wurde geleert",'File "%1" has been removed from trash':'Datei "%1" wurde aus dem Papierkorb gelscht','Folder "%1" has been removed from trash':'Ornder "%1" wurde aus dem Papierkorb gelscht','File "%1" has been deleted':'Datei "%1" wurde gelscht','Folder "%1" has been deleted':'Ordner "%1" wurde gelscht',"Validating %1":"Prfe %1","%1 has no errors!":"%1 hat keine Fehler!","%1 error found in %2!":"%1 Fehler gefunden in %2!","%1 errors found in %2!":"%1 Fehler gefunden in %2!","Show image":"Bild anzeigen","Config viewer":"Konfiguration anzeigen","%1 is no configuration file":"%1 ist keine Konfigurationsdatei","This configuration has been opened in another window. When you close this file, the window will also be closed. Click here top jump the the window.":"Diese Konfiguration wurde in einem anderen Fenster geffnet. Wenn Sie diese Datei schlieen, wird das Fenster ebenfalls geschlossen. Klicken zu hier, um zu dem Fenster zu gelangen.","Loading...":"Lade...","Upload file":"Datei hochladen","Show folder":"Ordner anzeigen","Filter by name...":"Nach Namen filtern...","Show icons":"Icons anzeigen","List mode":"Listenansicht","Preview mode":"Vorschau-Modus",Configurations:"Konfigurationen","Demo configurations":"Demo Konfigurationen","Media files":"Mediendateien",Miscellaneous:"Sonstiges","File has been created":"Datei wurde erstellt","File has been saved":"Datei wurde gespeichert",Texteditor:"Texteditor","Hidden config is invalid, please correct the errors":"Die versteckte Konfiguration ist ungltig, bitte beheben Sie die Fehler","Hidden config content has some warnings! It is recommended to fix the warnings before saving. Save anyways?":"Die versteckte Konfiguration enthlt eventuell Fehler! Es wird empfohlen die Warnungen zu beheben, bevor gespeichert wird. Trotzdem speichern?","Confirm saving with warnings":"Speichen trotz Warnungen besttigen","Saving hidden config failed with error %1 (%2)":"Das Speichern der versteckten Konfiguration ist fehlgeschlagen: %1 (%2)","Hidden config has been saved":"Die versteckte Konfiguration wurde gespeichert",'"%1" is not writable. Upgrading not possible.':'"%1" ist nicht speicherbar. Upgrade kann nicht durchgefhrt werden.',"Xml-editor":"XML-Editor","Undo: %1":"Rckgngig: %1","Preview shows the current state of the edited configuration.":"Die Vorschau zeigt den aktuellen Stand der Konfiguration an.","Preview is out of sync. Click here to refresh.":"Die Vorschau zeigt nicht mehr den aktuellen Zustand der Konfiguration an. Klicken Sie hier, um die Vorschau zu aktualisieren.","Preview is out of sync. Highlighting of the currently selected tree element is deactivated until you refresh the preview. Click here to refresh.":"Die Vorschau zeigt nicht mehr den aktuellen Zustand der Konfiguration an. Das Hervorheben des gerade selektierten Elements ist deaktiviert bis die Vorschau aktualisiert wurde. Klicken Sie hier, um die Vorschau zu aktualisieren.",Expertview:"Expertenansicht","Reload preview":"Vorschau aktualisieren","Search...":"Suchen...","Please create a new Element either by dragging this button to the place where the new element should be inserted or by selecting an element and pressing this button to insert a new child to this element.":"Bitte erzeugen Sie ein neues Element indem Sie diesen Button auf die Stelle an der das neue Element platziert werden soll ziehen oder indem Sie ein Element auswhlen und ber einen Klick auf diesen Button ein neues Element als Kind-Element der Selektion anlegen.",'"%1" has been moved after "%2"':'"%1" wurde hinter "%2" verschoben','"%1" has been copied after "%2"':'"%1" wurde hinter "%2" kopiert','"%1" has been moved before "%2"':'"%1" wurde vor "%2" verschoben','"%1" has been copied before "%2"':'"%1" wurde vor "%2" kopiert','"%1" has been moved into "%2" as first child':'"%1" wurde als erstes Element in "%2" verschoben','"%1" has been copied into "%2" as first child':'"%1" wurde als erstes Element in "%2" kopiert','"%1" has been moved into "%2"':'"%1" wurde in "%2" verschoben','"%1" has been copied into "%2"':'"%1" wurde in "%2" kopiert',"<p style='font-weight:bold'>Choose element</p><p>Several possible element can be created at this position, please select one to proceed.</p>":"<p style='font-weight:bold'>Element whlen</p><p>Verschiedene Elemente knnen an dieser Stelle eingefgt werden, bitte whlen sie eines aus.</p>","Choose element":"Element whlen","Please choose the element you want to add here.":"Bitte whlen sie das Element, welches hinzugefgt werden soll.","not set":"nicht angegeben","This is not a valid value.":"Dies ist kein gltiger Wert.","Create new %1 element":"Erzeuge neues %1 Element","Please edit the attributes of the new %1 element, that will be added to the chosen position.":"Bitte bearbeiten Sie die Attribute des neuen %1 Elements, welches an der gewnschten Stelle erzeugt wird.","Edit element attributes":"Element Attribute bearbeiten","Edit %1":"Bearbeite %1","Show %1":"Zeige %1","Please edit the content of the new %1 element, that will be added to the chosen position.":"Bitte bearbeiten Sie den Inhalt des neuen %1 Elements, welches an der gewnschten Stelle erzeugt wird.","Edit element and content":"Element und Inhalt bearbeiten","Edit element content":"Elementinhalt bearbeiten","Edit text content":"Textinhalt bearbeiten","Disabling preview because the preview file could not be created.":"Vorschau wurde deaktiviert, weil die Vorschaudatei nicht erzeugt werden konnte.",Help:"Hilfe","<h3>Search for elements</h3><p>You can search for element names (tag names or content of name attribute) by typing a search value here. All elements whose tag name or name-attribute start with the search term will be found</p><p>Search will start automatically when the search term is at least 2 characters long.</p><p>The first found element will be opened and selected in the element tree. You can jump to the next found element with 'Enter' or the 'Down' key. Accordingly you can jump the the previous found element with the 'Up' key.</p>":"<h3>Suche nach Elementen</h3><p>Sie knnen nach Elementen suchen (Tag-Namen oder Name-Attribut) indem Sie hier einen Suchbegriff eingeben. Es werden alle Elemente gefunden deren Tag-Name oder 'name'-Attribut mit dem Suchbegriff beginnen.</p><p>Die Suche startet automatisch, wenn der Suchbegriff mindestens 2 Zeichen lang ist.</p><p>Das erste gefunden Element wird im Baum angezeigt. Mit der 'enter' oder der 'Pfeil runter'-Taste kann man zum nchsten Suchergebnis springen. Mit der 'Pfeil rauf'-Taste entsprechend zum vorherigen Suchergebnis.</p>","<h3>CometVisu XML-Editor - a brief introduction</h3><p>The CometVisu XMl-Editor shows the content of a CometVisu config file in a tree-like structure. You can traverse through the tree by opening/closing elements with a click on the expand icon.</p><p>The Xml-Editor will make sure that you do not create an invalid configuration file. If you experience a change that has not been accepted / or is not allowed that is most likely due to avoid an invalid configuration.</p><h4>Editing attributes</h4><p>The elements attributes can be edited by double clicking on it or selecting an element and clicking on the 'edit'-button in the toolbar above the tree of by right-clicking on the element and the 'edit'-button in the context menu</p><h4>Editing elements</h4><p>The elements in the tree support re-ordering via drag & drop. You can also cut/copy or paste them. You can add new elements by starting a drag in the round + button on the bottom of the tree, or by right clicking on an element and choosing the 'add child'-button.</p><p>You can delete elements by the delete buttons in the toolbar</p><h4>Expert view</h4><p>Some attributes are hidden in the editing dialog, because they provide access to settings that usually are not needed that often. You can access these attributes by toggling to the 'Expertview'-button in the toolbar directly above the tree.</p><h4>Config preview</h4><p>An preview of the edited config file is shown on the right part of the screen. The preview will not automatically refresh after you have changed something. You can refresh is manually by clicking the most right button in the toolbar.</p>":"<h3>CometVisu XML-Editor - eine kurze Einfhrung</h3><p>Der CometVisu XML-Editor stellt eine CometVisu-Konfigurationsdatei in einer Baumstruktur dar. Man kann die Elemente durch einen Klick auf das kleine Dreieck-Icon ffnen/schlieen.</p><p>Der XML-Editor stellt sicher, dass keine ungltige Konfiguration erzeugt werden kann. Falls einige nderungen nicht mglich sind, dann ist das diesem Umstand geschuldet.</p><h4>Attribute bearbeiten</h4><p>Die Attribute eines Elements knnen bearbeitet werden, indem man einen Doppelklick auf dem Element ausfhrt. Alternativ stehen im Kontextmen (ffnen mit rechter Maustaste) und in der Symbolleiste direkt ber dem Baum \"Bearbeiten\"-Buttons zur Verfgung .</p><h4>Element bearbeiten</h4><p>Die Elemente im Baum untersttzen eine Umsortierung via Drag&Drop. Sie knnen ebenfalls ausgeschnitten, kopiert und eingefgt werden. Neue Elemente knnen hinzugefgt werden, indem man auf den '+'-Button unter dem Baum klickt (Maustaste gedrckt halten) und diesen dann an die Stelle zieht, an der man das neuen Element einfgen mchte. Alternativ steht ber das Kontextmen ein 'Kind-Element einfgen'-Button zur Verfgung.</p><p>Selektierte Elemente knnen ber die Symbolleiste und das Kontextmen gelscht werden.</p><h4>Expertenansicht</h4><p>Normalerweise sind einige Attribute nicht sichtbar im Editier-Dialog. ber den 'Expertansicht'-Button in der Symbolleiste kann man diese freischalten.</p><h4>Vorschau</h4><p>Auf der rechten Seite wird eine Vorschau der Konfiguration gezeigt. Diese aktualisiert sich nicht automatisch. ber den Button in der Symbolleiste ganz rechts, kann man die Vorschau aktualisieren.</p>","File compare":"Datei vergleichen","The following changes have been made":"Die folgendenen nderungen wurden vorgenommen","You can check the changes in the editor. The left side shows the content before the upgrade and the right side shows the content after the upgrade.":"Sie knnen die nderungen im Editor berprfen. Die linke Seite zeigt den Inhalt vor der Aktualisierung, die rechte Seite nachher.","No changes have been made":"Es wurden keine nderungen vorgenommen","Config file has been upgraded to the current library version.":"Die Konfigurations-Datei wurde auf die aktuelle Version aktualisiert.",'Click "Apply" if you want to save the changes and reload the browser.':'Klicken Sie "Anwenden", wenn Sie die nderungen speichern und die aktualisierte Konfigurations-Datei laden mchten.','Click "Check" if you want to check the changes. You have to save the changes and reload your browser yourself in this case.':'Klicken Sie "Prfen", wenn Sie die nderungen berprfen mchten. In diesem Fall mssen Sie selbst die Datei speichern und den Browser neu laden, damit die nderungen wirksam werden.',"Upgrade successful":"Aktualisierung erfolgreich",Apply:"Anwenden",Check:"Prfen","Hidden configuration has a syntax error and could not be loaded, you can try to fix the problem in the text editor. Do you want to open the file in the text editor?":"Die versteckte Konfiguration enthlt einen Syntax-Fehler und konnte nicht geladen werden, Sie knnen versuchen das Problem im Texteditor zu beheben. Mchten Sie die Datei im Texteditor ffnen?","Hidden configuration error":"Fehler in der versteckten Konfiguration","Hidden configuration file (hidden.php) not writeable":"Die versteckte Konfiguration (hidden.php) ist nicht beschreibbar",'Section name duplicate: "%1".':'Doppelter Sektionsname: "%1".','Option key duplicate: "%1" in section "%2".':'Doppelter Optionsname "%1" in Sektion "%2".',"Section is invalid and has not been saved.":"Diese Sektion ist ungltig und wurde nicht gespeichert.","Add section":"Sektion hinzufgen","Drop the file here to replace the content.":"Lassen Sie die Datei hier fallen um den Inhalt zu ersetzen.","Do you really want to replace the '%1' with the uploaded files content?":"Mchten Sie wirklich '%1' mit der hochgeladenen Datei ersetzen?",'Double click to open "%1"':'Doppelklick zum ffnen von "%1"',"Download file":"Datei herunterladen","Other file actions":"Andere Datei-Aktionen",Reload:"Neu laden","Icon name has been copied to clipboard":"Der Icon-Name wurde in die Zwischenablage kopiert","Variable from template %1":"Variable aus Template %1","Remove %1":"Lsche %1","Move %1":"Verschiebe %1","Add %1":"Erzeuge %1","Invalid text content: '%1'":"Ungltiger Textinhalt: '%1'","Text content not allowed here":"Kein Text-Inhalt erlaubt","Invalid value":"Ungltiger Wert","Attribute '%1' not allowed":"Attribut '%1' ist nicht erlaubt","Attribute '%1' is required but missing":"Attribut '%1' fehlt","Text content is missing":"Fehlender Textinhalt","Text content is invalid":"Textinhalt ist ungltig","Change %1":"ndere %1","Child element '%1' not allowed.":"Kind-Element '%1' ist nicht erlaubt.","Drag to move":"Klicken & Ziehen zum Verschieben",View:"Ansehen",Edit:"Bearbeiten",Cut:"Ausschneiden",Copy:"Kopieren",Paste:"Einfgen","Add child":"Kind-Element einfgen","Possible values could no be retrieved, please check browser console for error details":"Die mglichen Werte konnten nicht geladen werden. Details zum Fehler knnen in der Browser-Konsole nachgelesen werden","Value is invalid":"Wert ist ungltig",'<h3>Config Errors</h3><p>The validation of "%1" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because it can break the file completely. Please open this file in the text editor and fix the errors there. Only proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>':'<h3>Fehler in der Konfiguration</h3><p>Die berprfung von "%1" hat Fehler gefunden. Es wird NICHT empfohlen, diese Datei im XML-Editor zu bearbeiten, weil die Mglichkeit besteht, dass sie dadurch unbrauchbar wird. Bitte ffnen Sie die Datei im Texteditor und beheben Sie die Fehler dort. Fahren Sie nur fort, wenn Sie wissen was Sie tun.</p>',"<p>You can choose between the following options:<ul>    <li><b>Cancel</b> - Close this editor</li>    <li><b>Proceed</b> - Open the defective file in this editor</li>    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li></ul></p>":"<p>Sie knnen zwischen folgenden Optionen whlen:<ul>    <li><b>Abbrechen</b> - Diesen Editor schlieen</li>    <li><b>Fortfahren</b> - Ungltige Datei in diesem Editor ffnen</li>    <li><b>ffnen in Text-Editor</b> - Diesen Editor schlieen und die ungltige Datei im Text-Editor ffnen</li></ul></p>","Line %1":"Zeile %1",Cancel:"Abbruch",Proceed:"Fortfahren","Open in text editor":"Im Text-Editor ffnen","config folder does not exists":"config Ordner existiert nicht","config folder is not readable":"config Ordner kann nicht gelesen werden","config folder is not writeable":"config Ordner ist nicht beschreibbar","backup folder is not writeable":"backup Ordner ist nicht beschreibbar","media folder is not writeable":"media Ordner ist nicht beschreibbar","You have files opened with unsaved changes, you should save them now.":"Sie haben Dateien mit ungespeicherten nderungen geffnet, Sie sollten diese jetzt speichern.","Unsaved changes":"Nicht gespeicherte nderungen","Save & quit":"Speichern & beenden","Quit without saving":"Beenden ohne zu speichern","Cannot load config template":"Template fr Konfigurationsdatei kann nicht geladen werden","Cannot load file content":"Dateiinhalt kann nicht geladen werden",'Cannot open file: "%1"':'Datei "%1" kann nicht geffnet werden',"This file has unsaved changes that will be lost when you close it without saving.":"Diese Datei enthlt ungespeicherte nderungen, die verloren gehen, wenn Sie sie ohne zu speichern schlieen.","This file has not been saved on the backend yet. It will be lost when you close it without saving.":"Diese Datei wurde noch nicht gespeichert. Sie wird verloren gehen, wenn Sie sie ohne zu speichern schlieen.","Save & close":"Speichern & schlieen","Discard & close":"Verwerfen & schlieen",'Please enter the name of the new configuration (without "visu_config_" at the beginning and ".xml" at the end)':'Bitte geben Sie den Namen der neuen Konfiguraton (ohne "visu_config_" am Anfang und ".xml" am Ende) ein',"A configuration with this name already exists.":"Eine Konfigurationsdatei mit diesem Namen existiert bereits.","Please enter the file name.":"Bitte geben Sie den Dateinamen ein.","A file with this name already exists.":"Eine Datei mit diesem Namen exisitert bereits.","Please enter the folder name.":"Bitte geben Sie den Namen des Ordners ein.","A folder with this name already exists.":"Eine Ordner mit diesem Namen exisitert bereits.","Folder has been created":"Verzeichnis wurde erstellt",About:"ber","Build date":"Erzeugt am","Build revision":"Revision","Library version":"Library-Version",Server:"Server","PHP version":"PHP Version",Section:"Sektion","Delete section":"Sektion lschen","New config file":"Neue Konfigurationsdatei",Save:"Speichern","Save as...":"Speichern unter...",Quit:"Beenden",Undo:"Rckgngig",Redo:"Wiederholen","Use text editor":"Texteditor benutzen","Use xml editor":"XML-Editor benutzen","Enable quick preview":"Schnellvorschau aktivieren","Expert mode":"Expertenansicht","CometVisu Manager":"CometVisu Manager",File:"Datei",New:"Neu",Preferences:"Einstellungen","complex type, please see documentation":"Komplexer Typ, bitte in der Dokumentation nachschauen","This file is not writeable":"Diese Datei ist nicht nderbar","Delete option":"Option lschen","Add option":"Option hinzufgen",Key:"Schlssel",Value:"Wert"}}};
//# sourceMappingURL=package-3.js.map