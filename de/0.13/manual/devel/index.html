<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Informationen für Entwickler &mdash; CometVisu</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_override.css?v=8073742d" />

  
    <link rel="canonical" href="https://www.cometvisu.org/CometVisu/de/0.13/manual/devel/index.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=245627df"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=70a09b52"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="Long polling" href="transport/long-polling.html" />
    <link rel="prev" title="Automatisierte Tests" href="../colab/dev/test.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CometVisu
              <img src="../_static/comet_webapp_icon_android_48.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.13.0-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation der CometVisu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Konfiguration der CometVisu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../colab/index.html">Hilf dem CometVisu Projekt</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Informationen für Entwickler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#grundlagen-der-software">Grundlagen der Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#startverhalten">Startverhalten</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transportschichten">Transportschichten</a><ul>
<li class="toctree-l3"><a class="reference internal" href="transport/long-polling.html">Long polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="transport/sse.html">Server sent events (SSE)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#der-notificationrouter">Der NotificationRouter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fehlerbehandlung">Fehlerbehandlung</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CometVisu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Informationen für Entwickler</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition caution">
<p class="admonition-title">Vorsicht</p>
<p>Dies ist die Dokumentation des aktuellen Entwicklungszweigs der CometVisu.
Es besteht daher die Möglichkeit, dass einige der hier beschriebenen Features
mit dem aktuellsten Release der CometVisu nicht genutzt werden können.</p>
</div>
<section id="informationen-fur-entwickler">
<h1>Informationen für Entwickler<a class="headerlink" href="#informationen-fur-entwickler" title="Link to this heading"></a></h1>
<p>Diese Seite liefert eine Einführung in die internen Zusammenhänge und Hintergründe der CometVisu und richtet sich in
erster Linie an Entwickler.</p>
<section id="grundlagen-der-software">
<h2>Grundlagen der Software<a class="headerlink" href="#grundlagen-der-software" title="Link to this heading"></a></h2>
<p>Die CometVisu ist seit Version 0.11 auf dem <a class="reference external" href="http://www.qooxdoo.org">Qooxdoo-Framework</a> aufgebaut.
Das Qooxdoo Framework bietet ein eigenes Objekt-Orientiertes Klassensystem (inkl. erweiterten Features wie: Interfaces
Mixins, Abstrakte Klasse, Singletons, einfache Type-Checks für Properties, usw.) mit dem sich ein komplexes und
dennoch strukturiertes Software-System aufbauen lässt.</p>
<p>Ebenso liefert es eine vollständige Toolchain (Qooxdoo-Generator) mit, die Klassenabhängigkeiten automatisch auflöst und daraus
entweder Entwickler Versionen (source-Version) oder Releases (build-Versionen) baut.</p>
<p>Unterschiede in der Javascript-Unterstützung der verschiedenen Browser werden automatisch ausgeglichen und der
Generator erstellt für die Releases unterschiedliche Build-Versionen für die 4 wichtigsten Browser-Engines.</p>
<p>Weitere Qooxdoo-Features die die CometVisu nutzt:</p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="http://www.qooxdoo.org/current/pages/development/parts_using.html">Parts</a>:</dt><dd><p>Teile des Codes, die nicht immer benötigt werden, werden in <em>Parts</em> ausgelagert, die bei Bedarf nachgeladen werden.
Die CometVisu nutzt dies für Plugins und die Widget-Pakete (Es gibt zwar momentan nur das <em>Pure</em>-Widgetpaket,
weitere sind jedoch möglich).</p>
</dd>
</dl>
</li>
</ul>
<p>Da die CometVisu eigene Widgets liefert inkl. Layout und CSS-basiertem Design, wird der komplette UI Teil von
Qooxdoo nicht benutzt. Dieser liefert eigene Layoutmanager und Widgets mit nicht CSS-basiertem Design.
Es wäre jedoch möglich ein neues auf Qooxdoo-UI basierendes Widgetpaket zu implementieren, welches parallel nutzbar ist.</p>
</section>
<section id="startverhalten">
<h2>Startverhalten<a class="headerlink" href="#startverhalten" title="Link to this heading"></a></h2>
<p>Der Ablauf des Ladens der Visu läuft nach dem CometVisu-Protokoll in folgenden Schritten:</p>
<figure class="align-center" id="id1">
<figcaption>
<p><span class="caption-text">Start-Kommunikation zwischen CometVisu und Backend</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><p>Laden der Konfigurationsdatei <code class="docutils literal notranslate"><span class="pre">visu_config*.xml</span></code></p></li>
<li><p>Der Server kann diese Datei mit 2 optionalen Headern ausliefern, die der CometVisu weitere Informationen
über das Backend zu liefern:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-Name</span></code>: Der Name des zu verwendenden Backends.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-KNXD-Url</span></code>: URL für die knxd Login-Ressource</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-MQTT-Url</span></code>: URL für die MQTT Login-Ressource</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-OpenHAB-Url</span></code>: Nur openHAB: Pfad zur REST-API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-LoginUrl</span></code>: Veraltet: Pfad unter der der Client das Login ausführen kann.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Die CometVisu authentifiziert sich beim Backend (zur Zeit implementiert kein Backend eine echte Authentifizierung)</p></li>
<li><p>Das Backend bestätigt die Authentifizierung und liefert Informationen als JSON zurück:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">v</span></code>: Ist die Protokollversion</p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code>: Die Session ID</p>
<p><code class="docutils literal notranslate"><span class="pre">c</span></code>: Die optionale Backend-Konfiguration</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;v&quot;</span><span class="p">:</span><span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;s&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;openhab2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="s2">&quot;sse&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;baseURL&quot;</span><span class="p">:</span><span class="s2">&quot;/rest/cv/&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;rrd&quot;</span><span class="p">:</span><span class="s2">&quot;rrdfetch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="s2">&quot;w&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Die CometVisu fängt an die Werte vom Backend abzufragen, zunächst initial alle benötigten Werten und im
zweiten Schritt wird nur noch auf Änderungen der Werte gelauscht.</p></li>
</ol>
</section>
<section id="transportschichten">
<h2>Transportschichten<a class="headerlink" href="#transportschichten" title="Link to this heading"></a></h2>
<p>Die Transportschichten sind für die Kommunikation zwischen CometVisu und Backend ab dem Moment des erfolgreichen
Logins verantwortlich. Die wesentliche Aufgabe besteht also darin, Werte vom Backend abzufragen (lesende Anfrage)
und Wertänderungen zum Backend zu schicken (schreibende Anfrage).</p>
<p>Zur Zeit unterstützt die CometVisu zwei unterschiedliche Transportschichten:</p>
<ul class="simple">
<li><p><a class="reference internal" href="transport/long-polling.html#long-polling"><span class="std std-ref">Long polling</span></a>: wird vom Default-Backend benutzt</p></li>
<li><p><a class="reference internal" href="transport/sse.html#sse"><span class="std std-ref">Server sent events</span></a>: wird vom openHAB-Backend benutzt</p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="transport/long-polling.html">Long polling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="transport/long-polling.html#lesende-anfragen">Lesende Anfragen</a></li>
<li class="toctree-l2"><a class="reference internal" href="transport/long-polling.html#schreibende-anfragen">Schreibende Anfragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transport/sse.html">Server sent events (SSE)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="transport/sse.html#lesende-anfragen">Lesende Anfragen</a></li>
<li class="toctree-l2"><a class="reference internal" href="transport/sse.html#schreibende-anfragen">Schreibende Anfragen</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Link to this heading"></a></h2>
<p>Die CometVisu nutzt eigene Caching Mechanismen um das initiale Laden zu beschleunigen.
Die meiste Zeit wird benötigt um die XML-Konfigurationsdatei vom Server zu laden, dann zu parsen und daraus
den HTML Code zu generieren der die tatsächliche Visu im Browser darstellt.</p>
<p>Da sich der Inhalt der Konfigurationsdatei in der Regel selten ändert, liegt es Nahe diese nicht jedesmal erneut zu laden und
zu parsen. Daher wird nach dem ersten Parsen der erzeugte HTML und die internen Datenstrukturen im <em>LocalStorage</em> des Browsers
abgespeichert. Beim nächsten Laden der Visu werden diese Daten ausgelesen und die Oberfläche sofort dargestellt.
Erst danach fragt die Visu die Konfigurationsdatei vom Server ab und vergleicht ob es Änderungen gegeben hat.
Sofern dies nicht der Fall ist wird die gerade geladenen Datei verworfen, andernfalls der Parse und Speicher-Vorgang erneut
durchgeführt und die Daten aus dem Cache werden verworfen.</p>
<p>Das Caching kann durch den URL-Parameter <a class="reference internal" href="../config/url-params.html#enablecache"><span class="std std-ref">enableCache - Caching aktivieren</span></a> beeinflusst werden.</p>
</section>
<section id="der-notificationrouter">
<h2>Der NotificationRouter<a class="headerlink" href="#der-notificationrouter" title="Link to this heading"></a></h2>
<p>Es gibt einen internen <code class="docutils literal notranslate"><span class="pre">NotificationRouter</span></code> der für verschiedene Zwecke benutzt wird.
Hauptfunktion dieses Routers ist es Nachrichten entgegenzunehmen und an den richtigen
Empfänger weiterzuleiten. Mögliche Empfänger sind z.B. das <code class="docutils literal notranslate"><span class="pre">NotificationCenter</span></code> und der
<code class="docutils literal notranslate"><span class="pre">PopupHandler</span></code>. Beide kümmern sich dann um die Anzeige der Nachricht, entweder in der Nachrichtenzentrale (die am
rechten Rand eingeblendet wird und eine Liste von Nachrichten anzeigt) oder als Popup.</p>
<p>Eine Nachricht hat immer ein <em>Topic</em>, welches der thematischen Zuordnung dient, einen Titel, Text und diverse
Konfigurations-Optionen.</p>
<p>Folgenden <em>Topics</em> werden zur Zeit genutzt:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv.error</span></code>: Allgemeine Fehler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv.config.error</span></code>: Fehler die beim Einlesen der Config-Datei aufgetreten sind</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv.state.*</span></code>: Namespace für alle in den <a class="reference internal" href="../config/notifications.html#notifications"><span class="std std-ref">Benachrichtigungen</span></a> benutzten Nachrichten</p></li>
</ul>
<p>Ein Nachrichtenempfänger (<code class="docutils literal notranslate"><span class="pre">NotificationHandler</span></code>) kann sich nun für eines oder mehrere solcher Topics registrieren:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">cv</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">registerMessageHandler</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;cv.config.error&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;message_attention&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s1">&#39;cv.error&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;message_attention&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Auch Wildcards sind möglich:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">cv</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">registerMessageHandler</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;cv.*&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="fehlerbehandlung">
<h2>Fehlerbehandlung<a class="headerlink" href="#fehlerbehandlung" title="Link to this heading"></a></h2>
<p>Der NotificationRouter wird auch dazu genutzt alle nicht abgefangenen Fehler zur Laufzeit der Visu anzuzeigen.
Diese Fehler werden als Popup angezeigt und ermöglichen es dem Nutzer direkt ein Issue auf Github mit vorausgefüllten
Formular mit den wichtigsten Informationen zu eröffnen. Diese Funktion ist nur
in den Build-Versionen aktiv (also auch in den Releases), während der Entwicklung werden die Fehler weiterhin
auf der Javascript-Konsole des Browsers angezeigt.</p>
<p>Weitere Fehler werden, je nach Art, entweder als Popup oder als Nachricht in der Nachrichtenzentrale angezeigt.
Als ein wichtiges Beispiel wären hier noch Verbindungsprobleme mit dem Backend zu nennen. Diese werden angezeigt,
solange das Problem besteht und verschwinden automatisch, sobald das Problem behoben wurde.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/noticenter_hidden.png"><img alt="../_images/noticenter_hidden.png" src="../_images/noticenter_hidden.png" style="width: 795.9px; height: 556.5px;" /></a>
<figcaption>
<p><span class="caption-text">Geschlossene Nachrichtenzentrale mit einer kritischen Fehlermeldung</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/NotificationCenter.png"><img alt="../_images/NotificationCenter.png" src="../_images/NotificationCenter.png" style="width: 798.6999999999999px; height: 557.9px;" /></a>
<figcaption>
<p><span class="caption-text">Geöffnete Nachrichtenzentrale mit einer kritischen Fehlermeldung</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Der <code class="docutils literal notranslate"><span class="pre">NotificationRouter</span></code> wird ebenfalls für die <a class="reference internal" href="../config/notifications.html#notifications"><span class="std std-ref">Benachrichtigungen</span></a> genutzt.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../colab/dev/test.html" class="btn btn-neutral float-left" title="Automatisierte Tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="transport/long-polling.html" class="btn btn-neutral float-right" title="Long polling" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2023 Christian Mayer and the CometVisu contributers.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versionen">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Version</span>
      v: 0.13.0-dev
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versionen</dt>
        
        <dd><a href="../../0.10/manual">0.10.2</a></dd>
        
        <dd><a href="../../0.11/manual">0.11.2</a></dd>
        
        <dd><a href="../../0.12/manual">0.12.2</a></dd>
        
        <dd><a href="../../0.13/manual">0.13.0-dev</a></dd>
        
      </dl>
    </div>
  </div>


</body>
</html>