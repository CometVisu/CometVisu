{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/node_modules/@qooxdoo/compiler/node_modules/@qooxdoo/framework/source/class/qx/ui/core/Blocker.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "events",
    "blocked",
    "unblocked",
    "construct",
    "widget",
    "_widget",
    "addListener",
    "__onBoundsChange",
    "__onWidgetDisappear",
    "isDefined",
    "ui",
    "root",
    "Abstract",
    "_isRoot",
    "setKeepBlockerActive",
    "theme",
    "manager",
    "Meta",
    "getInstance",
    "_onChangeTheme",
    "__activeElements",
    "__focusElements",
    "properties",
    "color",
    "check",
    "init",
    "nullable",
    "apply",
    "themeable",
    "opacity",
    "keepBlockerActive",
    "members",
    "__blocker",
    "__blockerCount",
    "__timer",
    "__appearListener",
    "e",
    "data",
    "getData",
    "isBlocked",
    "_updateBlockerBounds",
    "__onWidgetAppear",
    "getBounds",
    "isRootWidget",
    "getContentElement",
    "add",
    "getBlockerElement",
    "getLayoutParent",
    "getParent",
    "remove",
    "addListenerOnce",
    "bounds",
    "setStyles",
    "width",
    "height",
    "left",
    "top",
    "_applyColor",
    "value",
    "old",
    "Color",
    "resolve",
    "__setBlockersStyle",
    "_applyOpacity",
    "getColor",
    "key",
    "blockers",
    "push",
    "i",
    "length",
    "setStyle",
    "_backupActiveWidget",
    "focusHandler",
    "event",
    "Registration",
    "getManager",
    "window",
    "getHandler",
    "handler",
    "Focus",
    "activeWidget",
    "Widget",
    "getWidgetByElement",
    "getActive",
    "focusedWidget",
    "getFocus",
    "deactivate",
    "isFocusable",
    "blur",
    "_restoreActiveWidget",
    "focusElementsLength",
    "pop",
    "isDisposed",
    "focus",
    "activeElementsLength",
    "activate",
    "__createBlockerElement",
    "html",
    "Blocker",
    "getOpacity",
    "exclude",
    "block",
    "_block",
    "zIndex",
    "blockContent",
    "bind",
    "parent",
    "blocker",
    "include",
    "__activateBlockerElement",
    "__stopTabEvent",
    "fireEvent",
    "type",
    "Event",
    "unblock",
    "removeListenerById",
    "__unblock",
    "forceUnblock",
    "removeListener",
    "getKeyIdentifier",
    "stop",
    "getKeepBlockerActive",
    "FocusHandler",
    "isFocusRoot",
    "destruct",
    "_disposeObjects"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2004-2008 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Fabian Jakobs (fjakobs)\n\n************************************************************************ */\n\n/**\n * This class blocks events and can be included into all widgets.\n *\n * The {@link #block} and {@link #unblock} methods provided by this class can be used\n * to block any event from the widget. When blocked,\n * the blocker widget overlays the widget to block, including the padding area.\n *\n * @ignore(qx.ui.root.Abstract)\n */\nqx.Class.define(\"qx.ui.core.Blocker\",\n{\n  extend : qx.core.Object,\n\n\n  events :\n  {\n    /**\n     * Fires after {@link #block} executed.\n     */\n    blocked : \"qx.event.type.Event\",\n\n\n    /**\n     * Fires after {@link #unblock} executed.\n     */\n    unblocked : \"qx.event.type.Event\"\n  },\n\n\n  /**\n   * Creates a blocker for the passed widget.\n   *\n   * @param widget {qx.ui.core.Widget} Widget which should be added the blocker\n   */\n  construct: function(widget)\n  {\n    this.base(arguments);\n    this._widget = widget;\n\n    widget.addListener(\"resize\", this.__onBoundsChange, this);\n    widget.addListener(\"move\", this.__onBoundsChange, this);\n    widget.addListener(\"disappear\", this.__onWidgetDisappear, this);\n\n    if (qx.Class.isDefined(\"qx.ui.root.Abstract\") &&\n        widget instanceof qx.ui.root.Abstract) {\n      this._isRoot = true;\n      this.setKeepBlockerActive(true);\n    }\n\n    // dynamic theme switch\n    if (qx.core.Environment.get(\"qx.dyntheme\")) {\n      qx.theme.manager.Meta.getInstance().addListener(\n        \"changeTheme\", this._onChangeTheme, this\n      );\n    }\n\n    this.__activeElements = [];\n    this.__focusElements = [];\n  },\n\n  /*\n  *****************************************************************************\n     PROPERTIES\n  *****************************************************************************\n  */\n\n  properties :\n  {\n    /**\n     * Color of the blocker\n     */\n    color  :\n    {\n      check : \"Color\",\n      init : null,\n      nullable: true,\n      apply : \"_applyColor\",\n      themeable: true\n    },\n\n\n    /**\n     * Opacity of the blocker\n     */\n    opacity :\n    {\n      check : \"Number\",\n      init : 1,\n      apply : \"_applyOpacity\",\n      themeable: true\n    },\n\n\n    /**\n     * If this property is enabled, the blocker created with {@link #block}\n     * will always stay activated. This means that the blocker then gets all keyboard\n     * events, this is useful to block keyboard input on other widgets.\n     * Take care that only one blocker instance will be kept active, otherwise your\n     * browser will freeze.\n     *\n     * Setting this property to true is ignored, if the blocker is attached to a\n     * widget with a focus handler, as this would mean that the focus handler\n     * tries to activate the widget behind the blocker.\n     *\n     * fixes:\n     *     https://github.com/qooxdoo/qooxdoo/issues/9449\n     *     https://github.com/qooxdoo/qooxdoo/issues/8104\n     */\n    keepBlockerActive :\n    {\n      check : \"Boolean\",\n      init : false\n    }\n  },\n\n\n\n\n\n  /*\n  *****************************************************************************\n     MEMBERS\n  *****************************************************************************\n  */\n\n  members :\n  {\n    __blocker : null,\n    __blockerCount : 0,\n\n    __activeElements  : null,\n    __focusElements   : null,\n\n    __timer : null,\n\n    _widget : null,\n    _isRoot : false,\n\n    __appearListener : null,\n\n\n    /**\n     * Adjust html element size on layout resizes.\n     *\n     * @param e {qx.event.type.Data} event object\n     */\n    __onBoundsChange : function(e)\n    {\n      var data = e.getData();\n\n      if (this.isBlocked()) {\n        this._updateBlockerBounds(data);\n      }\n    },\n\n\n    /**\n     * Widget re-appears: Update blocker size/position and attach to (new) parent\n     */\n    __onWidgetAppear : function()\n    {\n      this._updateBlockerBounds(this._widget.getBounds());\n      if (this._widget.isRootWidget()) {\n        this._widget.getContentElement().add(this.getBlockerElement());\n      } else {\n        this._widget.getLayoutParent().getContentElement().add(this.getBlockerElement());\n      }\n    },\n\n\n    /**\n     * Remove the blocker if the widget disappears\n     */\n    __onWidgetDisappear : function()\n    {\n      if (this.isBlocked()) {\n        this.getBlockerElement().getParent().remove(this.getBlockerElement());\n        this._widget.addListenerOnce(\"appear\", this.__onWidgetAppear, this);\n      }\n    },\n\n\n    /**\n     * set the blocker's size and position\n     * @param bounds {Map} Map with the new width, height, left and top values\n     */\n    _updateBlockerBounds : function(bounds)\n    {\n      this.getBlockerElement().setStyles({\n        width: bounds.width + \"px\",\n        height: bounds.height + \"px\",\n        left: bounds.left + \"px\",\n        top: bounds.top + \"px\"\n      });\n    },\n\n\n    // property apply\n    _applyColor : function(value, old)\n    {\n      var color = qx.theme.manager.Color.getInstance().resolve(value);\n      this.__setBlockersStyle(\"backgroundColor\", color);\n    },\n\n\n    // property apply\n    _applyOpacity : function(value, old)\n    {\n      this.__setBlockersStyle(\"opacity\", value);\n    },\n\n\n    /**\n     * Handler for the theme change.\n     * @signature function()\n     */\n    _onChangeTheme : qx.core.Environment.select(\"qx.dyntheme\",\n    {\n      \"true\" : function() {\n        this._applyColor(this.getColor());\n      },\n      \"false\" : null\n    }),\n\n\n    /**\n     * Set the style to all blockers (blocker and content blocker).\n     *\n     * @param key {String} The name of the style attribute.\n     * @param value {String} The value.\n     */\n    __setBlockersStyle : function(key, value)\n    {\n      var blockers = [];\n      this.__blocker && blockers.push(this.__blocker);\n\n      for (var i = 0; i < blockers.length; i++) {\n        blockers[i].setStyle(key, value);\n      }\n    },\n\n\n    /**\n     * Backup the current active and focused widget.\n     */\n    _backupActiveWidget : function()\n    {\n      var focusHandler = qx.event.Registration.getManager(window).getHandler(qx.event.handler.Focus);\n      var activeWidget = qx.ui.core.Widget.getWidgetByElement(focusHandler.getActive());\n      var focusedWidget = qx.ui.core.Widget.getWidgetByElement(focusHandler.getFocus());\n\n      this.__activeElements.push(activeWidget);\n      this.__focusElements.push(focusedWidget);\n\n      if (activeWidget) {\n        activeWidget.deactivate();\n      }\n\n      if (focusedWidget && focusedWidget.isFocusable()) {\n        focusedWidget.blur();\n      }\n    },\n\n\n    /**\n     * Restore the current active and focused widget.\n     */\n    _restoreActiveWidget : function()\n    {\n      var widget;\n\n      var focusElementsLength = this.__focusElements.length;\n      if (focusElementsLength > 0)       {\n        widget = this.__focusElements.pop();\n\n        if (widget && !widget.isDisposed() && widget.isFocusable()) {\n          widget.focus();\n        }\n      }\n\n      var activeElementsLength = this.__activeElements.length;\n      if (activeElementsLength > 0) {\n        widget = this.__activeElements.pop();\n\n        if (widget && !widget.isDisposed()) {\n          widget.activate();\n        }\n      }\n    },\n\n\n    /**\n     * Creates the blocker element.\n     *\n     * @return {qx.html.Element} The blocker element\n     */\n    __createBlockerElement : function() {\n      return new qx.html.Blocker(this.getColor(), this.getOpacity());\n    },\n\n\n    /**\n     * Get/create the blocker element\n     *\n     * @param widget {qx.ui.core.Widget} The blocker will be added to this\n     * widget's content element\n     * @return {qx.html.Element} The blocker element\n     */\n    getBlockerElement : function(widget)\n    {\n      if (!this.__blocker)\n      {\n        this.__blocker = this.__createBlockerElement();\n        this.__blocker.setStyle(\"zIndex\", 15);\n\n        if (!widget) {\n          if (this._isRoot) {\n            widget = this._widget;\n          } else {\n            widget = this._widget.getLayoutParent();\n          }\n        }\n\n        widget.getContentElement().add(this.__blocker);\n        this.__blocker.exclude();\n      }\n      return this.__blocker;\n    },\n\n\n    /**\n     * Block all events from this widget by placing a transparent overlay widget,\n     * which receives all events, exactly over the widget.\n     */\n    block : function()\n    {\n      this._block();\n    },\n\n\n    /**\n     * Adds the blocker to the appropriate element and includes it.\n     *\n     * @param zIndex {Number} All child widgets with a zIndex below this value will be blocked\n     * @param blockContent {Boolean} append the blocker to the widget's content if true\n     */\n    _block : function(zIndex, blockContent) {\n      if (!this._isRoot && !this._widget.getLayoutParent()) {\n        if (!this.__appearListener) {\n          this.__appearListener = this._widget.addListenerOnce(\"appear\", this._block.bind(this, zIndex));\n        }\n        return;\n      }\n\n      var parent;\n      if (this._isRoot || blockContent) {\n        parent = this._widget;\n      } else {\n        parent = this._widget.getLayoutParent();\n      }\n\n      var blocker = this.getBlockerElement(parent);\n      if (zIndex != null) {\n        blocker.setStyle(\"zIndex\", zIndex);\n      }\n\n      this.__blockerCount++;\n      if (this.__blockerCount < 2)\n      {\n        this._backupActiveWidget();\n\n        var bounds = this._widget.getBounds();\n        // no bounds -> widget not yet rendered -> bounds will be set on resize\n        if (bounds) {\n          this._updateBlockerBounds(bounds);\n        }\n\n        blocker.include();\n        if (!blockContent) {\n          blocker.activate();\n        }\n\n        blocker.addListener(\"deactivate\", this.__activateBlockerElement, this);\n        blocker.addListener(\"keypress\", this.__stopTabEvent, this);\n        blocker.addListener(\"keydown\", this.__stopTabEvent, this);\n        blocker.addListener(\"keyup\", this.__stopTabEvent, this);\n\n        this.fireEvent(\"blocked\", qx.event.type.Event);\n      }\n    },\n\n\n    /**\n     * Returns whether the widget is blocked.\n     *\n     * @return {Boolean} Whether the widget is blocked.\n     */\n    isBlocked : function() {\n      return this.__blockerCount > 0;\n    },\n\n\n    /**\n     * Unblock the widget blocked by {@link #block}, but it takes care of\n     * the amount of {@link #block} calls. The blocker is only removed if\n     * the number of {@link #unblock} calls is identical to {@link #block} calls.\n     */\n    unblock : function()\n    {\n      if (this.__appearListener) {\n        this._widget.removeListenerById(this.__appearListener);\n        this.__appearListener = null;\n      }\n\n      if (!this.isBlocked()){\n        return;\n      }\n\n      this.__blockerCount--;\n      if (this.__blockerCount < 1) {\n        this.__unblock();\n        this.__blockerCount = 0;\n      }\n    },\n\n\n    /**\n     * Unblock the widget blocked by {@link #block}, but it doesn't take care of\n     * the amount of {@link #block} calls. The blocker is directly removed.\n     */\n    forceUnblock : function()\n    {\n      if (this.__appearListener) {\n        this._widget.removeListenerById(this.__appearListener);\n        this.__appearListener = null;\n      }\n\n      if (!this.isBlocked()){\n        return;\n      }\n\n      this.__blockerCount = 0;\n      this.__unblock();\n    },\n\n\n    /**\n     * Unblock the widget blocked by {@link #block}.\n     */\n    __unblock : function()\n    {\n      this._restoreActiveWidget();\n\n      var blocker = this.getBlockerElement();\n      blocker.removeListener(\"deactivate\", this.__activateBlockerElement, this);\n      blocker.removeListener(\"keypress\", this.__stopTabEvent, this);\n      blocker.removeListener(\"keydown\", this.__stopTabEvent, this);\n      blocker.removeListener(\"keyup\", this.__stopTabEvent, this);\n      blocker.exclude();\n\n      this.fireEvent(\"unblocked\", qx.event.type.Event);\n    },\n\n\n    /**\n     * Block direct child widgets with a zIndex below <code>zIndex</code>\n     *\n     * @param zIndex {Integer} All child widgets with a zIndex below this value\n     *     will be blocked\n     */\n    blockContent : function(zIndex) {\n      this._block(zIndex, true);\n    },\n\n\n    /**\n     * Stops the passed \"Tab\" event.\n     *\n     * @param e {qx.event.type.KeySequence} event to stop.\n     */\n    __stopTabEvent : function(e) {\n      if (e.getKeyIdentifier() == \"Tab\") {\n        e.stop();\n      }\n    },\n\n\n    /**\n     * Sets the blocker element to active.\n     */\n    __activateBlockerElement : function() {\n      //\n      // If this._widget is attached to the focus handler as a focus root,\n      // activating the blocker after this widget was deactivated,\n      // leads to the focus handler re-activate the widget behind\n      // the blocker, loosing tab handling for this._widget which is\n      // visually in front. Hence we prevent activating the\n      // blocker in this situation.\n      //\n      // fixes:\n      //  https://github.com/qooxdoo/qooxdoo/issues/9449\n      //  https://github.com/qooxdoo/qooxdoo/issues/8104\n      //\n      if (this.getKeepBlockerActive() &&\n          !qx.ui.core.FocusHandler.getInstance().isFocusRoot(this._widget)) {\n        this.getBlockerElement().activate();\n      }\n    }\n  },\n\n\n  /*\n  *****************************************************************************\n     DESTRUCTOR\n  *****************************************************************************\n  */\n\n  destruct : function()\n  {\n    // remove dynamic theme listener\n    if (qx.core.Environment.get(\"qx.dyntheme\")) {\n      qx.theme.manager.Meta.getInstance().removeListener(\n        \"changeTheme\", this._onChangeTheme, this\n      );\n    }\n\n    this._widget.removeListener(\"resize\", this.__onBoundsChange, this);\n    this._widget.removeListener(\"move\", this.__onBoundsChange, this);\n    this._widget.removeListener(\"appear\", this.__onWidgetAppear, this);\n    this._widget.removeListener(\"disappear\", this.__onWidgetDisappear, this);\n\n    if (this.__appearListener) {\n      this._widget.removeListenerById(this.__appearListener);\n    }\n\n    this._disposeObjects(\"__blocker\", \"__timer\");\n    this.__activeElements = this.__focusElements =\n      this._widget = null;\n  }\n});\n"
  ]
}