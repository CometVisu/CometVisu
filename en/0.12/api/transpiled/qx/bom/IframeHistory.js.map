{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/node_modules/@qooxdoo/compiler/node_modules/@qooxdoo/framework/source/class/qx/bom/IframeHistory.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "bom",
    "History",
    "implement",
    "core",
    "IDisposable",
    "construct",
    "__initTimer",
    "members",
    "__iframe",
    "__iframeReady",
    "__writeStateTimner",
    "__dontApplyState",
    "__locationState",
    "_setInitialState",
    "_getHash",
    "_setHash",
    "value",
    "_encode",
    "addToHistory",
    "state",
    "newTitle",
    "lang",
    "Type",
    "isString",
    "setTitle",
    "_titles",
    "getState",
    "setState",
    "fireDataEvent",
    "_onHistoryLoad",
    "_setState",
    "_applyState",
    "old",
    "_writeState",
    "_readState",
    "_decode",
    "doc",
    "contentWindow",
    "document",
    "elem",
    "getElementById",
    "innerText",
    "__clearWriteSateTimer",
    "event",
    "Timer",
    "once",
    "Environment",
    "get",
    "open",
    "write",
    "close",
    "stop",
    "dispose",
    "__initIframe",
    "Idle",
    "getInstance",
    "addListener",
    "__onHashChange",
    "e",
    "currentState",
    "locationState",
    "__isCurrentLocationState",
    "__storeLocationState",
    "handler",
    "__createIframe",
    "body",
    "appendChild",
    "__waitForIFrame",
    "call",
    "iframe",
    "Iframe",
    "create",
    "src",
    "util",
    "ResourceManager",
    "toUri",
    "style",
    "visibility",
    "position",
    "left",
    "top",
    "callback",
    "context",
    "retry",
    "Error",
    "window",
    "destruct",
    "removeListener",
    "IframeHistory"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2004-2008 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Sebastian Werner (wpbasti)\n     * Andreas Ecker (ecker)\n     * Fabian Jakobs (fjakobs)\n     * Mustafa Sak (msak)\n\n************************************************************************ */\n\n/**\n * Implements an iFrame based history manager for IE 6/7/8.\n *\n * Creates a hidden iFrame and uses document.write to store entries in the\n * history browser's stack.\n *\n * This class must be disposed of after use\n *\n * @internal\n */\nqx.Class.define(\"qx.bom.IframeHistory\",\n{\n  extend : qx.bom.History,\n  implement: [ qx.core.IDisposable ],\n\n\n  construct : function()\n  {\n    this.base(arguments);\n    this.__initTimer();\n  },\n\n\n  members :\n  {\n    __iframe : null,\n    __iframeReady : false,\n    __writeStateTimner : null,\n    __dontApplyState : null,\n    __locationState : null,\n\n\n    // overridden\n    _setInitialState : function()\n    {\n      this.base(arguments);\n      this.__locationState = this._getHash();\n    },\n\n\n    //overridden\n    _setHash : function(value)\n    {\n      this.base(arguments, value);\n      this.__locationState = this._encode(value);\n    },\n\n\n    //overridden\n    addToHistory : function(state, newTitle)\n    {\n      if (!qx.lang.Type.isString(state)) {\n        state = state + \"\";\n      }\n\n      if (qx.lang.Type.isString(newTitle))\n      {\n        this.setTitle(newTitle);\n        this._titles[state] = newTitle;\n      }\n\n      if (this.getState() !== state) {\n        this.setState(state);\n      }\n      this.fireDataEvent(\"request\", state);\n    },\n\n\n    //overridden\n    _onHistoryLoad : function(state)\n    {\n      this._setState(state);\n      this.fireDataEvent(\"request\", state);\n      if (this._titles[state] != null) {\n        this.setTitle(this._titles[state]);\n      }\n    },\n\n\n    /**\n     * Helper function to set state property. This will only be called\n     * by _onHistoryLoad. It determines, that no apply of state will be called.\n     * @param state {String} State loaded from history\n     */\n    _setState : function(state)\n    {\n      this.__dontApplyState = true;\n      this.setState(state);\n      this.__dontApplyState = false;\n    },\n\n\n    //overridden\n    _applyState : function(value, old)\n    {\n      if (this.__dontApplyState){\n        return;\n      }\n      this._writeState(value);\n    },\n\n\n    /**\n     * Get state from the iframe\n     *\n     * @return {String} current state of the browser history\n     */\n    _readState : function()\n    {\n      if (!this.__iframeReady) {\n        return this._decode(this._getHash());\n      }\n\n      var doc = this.__iframe.contentWindow.document;\n      var elem = doc.getElementById(\"state\");\n      return elem ? this._decode(elem.innerText) : \"\";\n    },\n\n\n    /**\n     * Store state to the iframe\n     *\n     * @param state {String} state to save\n     */\n    _writeState : function(state)\n    {\n      if (!this.__iframeReady) {\n        this.__clearWriteSateTimer();\n        this.__writeStateTimner = qx.event.Timer.once(function(){this._writeState(state);}, this, 50);\n        return;\n      }\n      this.__clearWriteSateTimer();\n\n      var state = this._encode(state);\n\n      // IE8 is sometimes recognizing a hash change as history entry. Cause of sporadic surface of this behavior, we have to prevent setting hash.\n      if (qx.core.Environment.get(\"engine.name\") == \"mshtml\" && qx.core.Environment.get(\"browser.version\") != 8){\n        this._setHash(state);\n      }\n\n      var doc = this.__iframe.contentWindow.document;\n      doc.open();\n      doc.write('<html><body><div id=\"state\">' + state + '</div></body></html>');\n      doc.close();\n    },\n\n\n    /**\n     * Helper function to clear the write state timer.\n     */\n    __clearWriteSateTimer : function()\n    {\n      if (this.__writeStateTimner){\n        this.__writeStateTimner.stop();\n        this.__writeStateTimner.dispose();\n      }\n    },\n\n\n    /**\n     * Initialize the polling timer\n     */\n    __initTimer : function()\n    {\n      this.__initIframe(function () {\n        qx.event.Idle.getInstance().addListener(\"interval\", this.__onHashChange, this);\n      });\n    },\n\n\n    /**\n     * Hash change listener.\n     *\n     * @param e {qx.event.type.Event} event instance\n     */\n    __onHashChange : function(e)\n    {\n      // the location only changes if the user manually changes the fragment\n      // identifier.\n      var currentState = null;\n      var locationState = this._getHash();\n\n      if (!this.__isCurrentLocationState(locationState)) {\n        currentState = this.__storeLocationState(locationState);\n      } else {\n        currentState = this._readState();\n      }\n      if (qx.lang.Type.isString(currentState) && currentState != this.getState()) {\n        this._onHistoryLoad(currentState);\n      }\n    },\n\n\n    /**\n     * Stores the given location state.\n     *\n     * @param locationState {String} location state\n     * @return {String}\n     */\n    __storeLocationState : function (locationState)\n    {\n      locationState = this._decode(locationState);\n      this._writeState(locationState);\n\n      return locationState;\n    },\n\n\n    /**\n     * Checks whether the given location state is the current one.\n     *\n     * @param locationState {String} location state to check\n     * @return {Boolean}\n     */\n    __isCurrentLocationState : function (locationState) {\n      return qx.lang.Type.isString(locationState) && locationState == this.__locationState;\n    },\n\n\n    /**\n     * Initializes the iframe\n     *\n     * @param handler {Function?null} if given this callback is executed after iframe is ready to use\n     */\n    __initIframe : function(handler)\n    {\n      this.__iframe = this.__createIframe();\n      document.body.appendChild(this.__iframe);\n\n      this.__waitForIFrame(function()\n      {\n        this._writeState(this.getState());\n\n        if (handler) {\n          handler.call(this);\n        }\n      }, this);\n    },\n\n\n    /**\n     * IMPORTANT NOTE FOR IE:\n     * Setting the source before adding the iframe to the document.\n     * Otherwise IE will bring up a \"Unsecure items ...\" warning in SSL mode\n     *\n     * @return {qx.bom.Iframe}\n     */\n    __createIframe : function ()\n    {\n      var iframe = qx.bom.Iframe.create({\n        src : qx.util.ResourceManager.getInstance().toUri(qx.core.Environment.get(\"qx.blankpage\"))\n      });\n\n      iframe.style.visibility = \"hidden\";\n      iframe.style.position = \"absolute\";\n      iframe.style.left = \"-1000px\";\n      iframe.style.top = \"-1000px\";\n\n      return iframe;\n    },\n\n\n    /**\n     * Waits for the IFrame being loaded. Once the IFrame is loaded\n     * the callback is called with the provided context.\n     *\n     * @param callback {Function} This function will be called once the iframe is loaded\n     * @param context {Object?window} The context for the callback.\n     * @param retry {Integer} number of tries to initialize the iframe\n     */\n    __waitForIFrame : function(callback, context, retry)\n    {\n      if (typeof retry === \"undefined\") {\n        retry = 0;\n      }\n\n      if ( !this.__iframe.contentWindow || !this.__iframe.contentWindow.document )\n      {\n        if (retry > 20) {\n          throw new Error(\"can't initialize iframe\");\n        }\n\n        qx.event.Timer.once(function() {\n          this.__waitForIFrame(callback, context, ++retry);\n        }, this, 10);\n\n        return;\n      }\n\n      this.__iframeReady = true;\n      callback.call(context || window);\n    }\n  },\n\n\n  destruct : function()\n  {\n    this.__iframe = null;\n    if (this.__writeStateTimner){\n      this.__writeStateTimner.dispose();\n      this.__writeStateTimner = null;\n    }\n    qx.event.Idle.getInstance().removeListener(\"interval\", this.__onHashChange, this);\n  }\n});\n"
  ]
}