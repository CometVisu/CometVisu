{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/util/ScriptLoader.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "__scriptQueue",
    "data",
    "Array",
    "__loaders",
    "__delayedScriptQueue",
    "__markedAsLoaded",
    "statics",
    "markAsLoaded",
    "path",
    "getInstance",
    "isMarkedAsLoaded",
    "properties",
    "allQueued",
    "check",
    "init",
    "apply",
    "event",
    "events",
    "members",
    "__listener",
    "addStyles",
    "styleArr",
    "queue",
    "concat",
    "suffix",
    "cv",
    "Config",
    "forceReload",
    "Date",
    "now",
    "forEach",
    "style",
    "bom",
    "Stylesheet",
    "includeFile",
    "util",
    "ResourceManager",
    "toUri",
    "includes",
    "debug",
    "push",
    "addScripts",
    "scriptArr",
    "order",
    "realQueue",
    "i",
    "l",
    "length",
    "append",
    "processQueue",
    "loadIndex",
    "shift",
    "script",
    "splice",
    "loader",
    "__loadSingleScript",
    "addListener",
    "bind",
    "DynamicScriptLoader",
    "_onLoaded",
    "_onFailed",
    "addListenerOnce",
    "remove",
    "removeListener",
    "start",
    "ev",
    "getData",
    "_checkQueue",
    "startsWith",
    "failedDesign",
    "split",
    "fireDataEvent",
    "match",
    "exec",
    "notifications",
    "Router",
    "dispatchMessage",
    "title",
    "locale",
    "Manager",
    "tr",
    "message",
    "severity",
    "deletable",
    "isAllQueued",
    "fireEvent",
    "removeListenerById",
    "ScriptLoader"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ScriptLoader.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\nqx.Class.define('cv.util.ScriptLoader', {\n  extend: qx.core.Object,\n  type: \"singleton\",\n\n  /*\n  ******************************************************\n    CONSTRUCTOR\n  ******************************************************\n  */\n  construct: function() {\n    this.base(arguments);\n    this.__scriptQueue = new qx.data.Array();\n    this.__loaders = new qx.data.Array();\n    this.__delayedScriptQueue = new qx.data.Array();\n    this.__markedAsLoaded = [];\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    markAsLoaded: function (path) {\n      return this.getInstance().markAsLoaded(path);\n    },\n\n    isMarkedAsLoaded: function (path) {\n      return this.getInstance().isMarkedAsLoaded(path);\n    },\n  },\n\n  /*\n  ******************************************************\n    PROPERTIES\n  ******************************************************\n  */\n  properties: {\n    allQueued: {\n      check: \"Boolean\",\n      init: false,\n      apply: \"_checkQueue\",\n      event: \"changeAllQueued\"\n    }\n  },\n\n  /*\n  ******************************************************\n    EVENTS\n  ******************************************************\n  */\n  events: {\n    \"finished\": \"qx.event.type.Event\",\n    \"designError\": \"qx.event.type.Data\"\n  },\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    __scriptQueue: null,\n    __loaders: null,\n    __listener : null,\n    __markedAsLoaded: null,\n\n    addStyles: function(styleArr) {\n      var queue = (typeof styleArr === 'string' ? [ styleArr ] : styleArr.concat());\n      var suffix = (cv.Config.forceReload === true) ? '?'+Date.now() : '';\n      queue.forEach(function(style) {\n        qx.bom.Stylesheet.includeFile(qx.util.ResourceManager.getInstance().toUri(style) + suffix);\n      }, this);\n    },\n\n    markAsLoaded: function (path) {\n      if (!this.__markedAsLoaded.includes(path)) {\n        this.debug('marking ' + path + ' as loaded')\n        this.__markedAsLoaded.push(path)\n      }\n    },\n\n    isMarkedAsLoaded: function (path) {\n      return this.__markedAsLoaded.includes(path)\n    },\n\n    addScripts: function(scriptArr, order) {\n      var queue = (typeof scriptArr === 'string' ? [ scriptArr ] : scriptArr);\n      // make sure that no cached scripts are loaded\n      var suffix = (cv.Config.forceReload === true) ? '?'+Date.now() : '';\n      var realQueue = [];\n      for (var i=0, l = queue.length; i<l; i++) {\n        if (!this.__markedAsLoaded.includes(queue[i])) {\n          realQueue.push(qx.util.ResourceManager.getInstance().toUri(queue[i]) + suffix);\n        }\n      }\n      if (realQueue.length === 0) {\n        return;\n      }\n      this.debug(\"queueing \"+realQueue.length+\" scripts\");\n      this.__scriptQueue.append(realQueue);\n      if (order) {\n        var processQueue = function () {\n          if (order.length > 0) {\n            var loadIndex = order.shift();\n            var script = realQueue.splice(loadIndex, 1)[0];\n            var loader = this.__loadSingleScript(script);\n            loader.addListener(\"ready\", processQueue, this);\n          } else {\n            realQueue.forEach(this.__loadSingleScript, this);\n          }\n        }.bind(this);\n        processQueue();\n      } else {\n        // use an extra DynamicScriptLoader for every single script because loading errors stop the process\n        // and the loader would not try to load the other scripts\n        // queue.forEach(this.__loadSingleScript, this);\n        this.__loadSingleScript(realQueue);\n      }\n    },\n\n    /**\n     * Load one script\n     *\n     * @param script {String} path to script\n     */\n    __loadSingleScript: function(script) {\n      var loader = new qx.util.DynamicScriptLoader(script);\n      this.__loaders.push(loader);\n      loader.addListener(\"loaded\", this._onLoaded, this);\n      loader.addListener(\"failed\", this._onFailed, this);\n      loader.addListenerOnce(\"ready\", function() {\n        this.__loaders.remove(loader);\n        loader.removeListener(\"loaded\", this._onLoaded, this);\n        loader.removeListener(\"failed\", this._onFailed, this);\n      }, this);\n      loader.start();\n      return loader;\n    },\n\n    _onLoaded: function(ev) {\n      var data = ev.getData();\n      this.__scriptQueue.remove(data.script);\n      this.debug(data.script+\" loaded\");\n      this._checkQueue();\n    },\n\n    _onFailed: function(ev) {\n      var data = ev.getData();\n      this.__scriptQueue.remove(data.script);\n      if (data.script.startsWith(\"design\")) {\n        var failedDesign = data.script.split(\"/\")[1];\n        this.fireDataEvent(\"designError\", failedDesign);\n      } else if (data.script.includes(\"/plugins/\")) {\n        var match = /.+\\/plugins\\/([\\w]+)\\/index\\.js.*/.exec(data.script);\n        if (match) {\n          cv.core.notifications.Router.dispatchMessage('cv.loading.error', {\n            title: qx.locale.Manager.tr('Error loading plugin \"%1\"', match[1]),\n            message: qx.locale.Manager.tr('File %1 could not be loaded.', data.script),\n            severity: \"high\",\n            deletable: true\n          });\n        }\n      } else {\n        cv.core.notifications.Router.dispatchMessage('cv.loading.error', {\n          title: qx.locale.Manager.tr('File loading error'),\n          message:  qx.locale.Manager.tr('File %1 could not be loaded.', data.script),\n          severity: \"high\",\n          deletable: true\n        });\n      }\n      this._checkQueue();\n    },\n\n    // property apply\n    _checkQueue: function() {\n      if (this.__scriptQueue.length === 0) {\n        if (this.isAllQueued()) {\n          this.debug(\"script loader finished\");\n          this.fireEvent(\"finished\");\n        } else if (!this.__listener) {\n          this.debug(\"script loader waiting for all scripts beeing queued\");\n\n          this.__listener = this.addListener(\"changeAllQueued\", function(ev) {\n            if (ev.getData() === true) {\n              if (this.__scriptQueue.length === 0) {\n                this.debug(\"script loader finished\");\n                this.fireEvent(\"finished\");\n              }\n              this.removeListenerById(this.__listener);\n              this.__listener = null;\n            }\n          }, this);\n        }\n      } else {\n        this.debug(this.__scriptQueue.length+\" scripts remaining\");\n      }\n    }\n  }\n});"
  ]
}