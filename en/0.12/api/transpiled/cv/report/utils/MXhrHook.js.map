{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/report/utils/MXhrHook.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Mixin",
    "define",
    "construct",
    "addListener",
    "_onPhaseChange",
    "statics",
    "PENDING",
    "members",
    "__sendTime",
    "getRequestHash",
    "cv",
    "ConfigCache",
    "hashCode",
    "report",
    "Record",
    "normalizeUrl",
    "_getConfiguredUrl",
    "getMethod",
    "JSON",
    "stringify",
    "getRequestData",
    "ev",
    "hash",
    "delay",
    "getData",
    "Date",
    "now",
    "record",
    "XHR",
    "url",
    "utils",
    "MXhrHook",
    "push",
    "error",
    "headers",
    "getAllResponseHeaders",
    "trim",
    "split",
    "forEach",
    "entry",
    "parts",
    "getStatus",
    "method",
    "status",
    "requestData",
    "body",
    "getTransport",
    "responseText",
    "phase",
    "shift",
    "length"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n * This mixin patches {qx.io.request.Xhr} to get noticed about every XHR request to record its response.\n */\nqx.Mixin.define('cv.report.utils.MXhrHook', {\n  /*\n  ******************************************************\n    CONSTRUCTOR\n  ******************************************************\n  */\n  construct: function() {\n    this.addListener(\"changePhase\", this._onPhaseChange, this);\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    PENDING: {}\n  },\n\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    __sendTime: null,\n\n    /**\n     * Calculate Hash code for current request\n     */\n    getRequestHash: function() {\n      return cv.ConfigCache.hashCode(cv.report.Record.normalizeUrl(this._getConfiguredUrl()) +\n        this.getMethod()+JSON.stringify(this.getRequestData()));\n    },\n\n    _onPhaseChange: function(ev) {\n      var hash = this.getRequestHash();\n      var delay;\n\n      if (ev.getData() === \"opened\") {\n        this.__sendTime = Date.now();\n        // calculate Hash value for request\n        cv.report.Record.record(cv.report.Record.XHR, \"request\", {\n          url: cv.report.Record.normalizeUrl(this._getConfiguredUrl()),\n          hash: hash\n        });\n        if (!cv.report.utils.MXhrHook.PENDING[hash]) {\n          cv.report.utils.MXhrHook.PENDING[hash] = [];\n        }\n        cv.report.utils.MXhrHook.PENDING[hash].push(cv.report.Record.normalizeUrl(this._getConfiguredUrl()));\n\n      } else if (ev.getData() === \"load\") {\n        if (!this.__sendTime) {\n          this.error(\"response received without sendTime set. Not possible to calculate correct delay\");\n        }\n        // response has been received (successful or not) -> log it\n        var headers = {};\n        this.getAllResponseHeaders().trim().split(\"\\r\\n\").forEach(function(entry){\n          var parts = entry.split(\": \");\n          headers[parts[0]] = parts[1];\n        });\n        delay = Date.now() - this.__sendTime;\n\n        // log the trigger that triggers the server responses\n\n        // do not log 404 answers as the fake server sends them automatically\n        // end the logged ones break the replay for some reason\n        if (this.getStatus() !== 404) {\n          cv.report.Record.record(cv.report.Record.XHR, \"response\", {\n            url: cv.report.Record.normalizeUrl(this._getConfiguredUrl()),\n            method: this.getMethod(),\n            status: this.getStatus(),\n            delay: delay,\n            requestData: this.getRequestData(),\n            headers: headers,\n            body: this.getTransport().responseText,\n            hash: hash,\n            phase: \"load\"\n          });\n        }\n        this.__sendTime = null;\n\n        // delete pending request\n        cv.report.utils.MXhrHook.PENDING[hash].shift();\n        if (cv.report.utils.MXhrHook.PENDING[hash].length === 0) {\n          delete cv.report.utils.MXhrHook.PENDING[hash];\n        }\n      } else if (ev.getData() === \"abort\") {\n        delay = Date.now() - this.__sendTime;\n\n        // request aborted, maybe by watchdog\n        cv.report.Record.record(cv.report.Record.XHR, \"response\", {\n          url: cv.report.Record.normalizeUrl(this._getConfiguredUrl()),\n          delay: delay,\n          hash: hash,\n          phase: \"abort\"\n        });\n\n        // delete pending request\n        cv.report.utils.MXhrHook.PENDING[hash].shift();\n        if (cv.report.utils.MXhrHook.PENDING[hash].length === 0) {\n          delete cv.report.utils.MXhrHook.PENDING[hash];\n        }\n      }\n    }\n  }\n});"
  ]
}