{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/TrickOMatic.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "id",
    "run",
    "svg",
    "getSVGDocument",
    "pipes",
    "querySelectorAll",
    "forEach",
    "pipe_group",
    "path",
    "halfsize",
    "Math",
    "floor",
    "parseFloat",
    "style",
    "strokeWidth",
    "opacity",
    "width",
    "n",
    "cloneNode",
    "className",
    "baseVal",
    "stroke",
    "strokeOpacity",
    "insertBefore",
    "nextElementSibling",
    "model",
    "cv",
    "data",
    "Model",
    "getInstance",
    "segmentLength",
    "length",
    "animVal",
    "split",
    "indexOf",
    "r",
    "g",
    "b",
    "parseInt",
    "substring",
    "colors",
    "replace",
    "rTarget",
    "gTarget",
    "bTarget",
    "toHex",
    "v",
    "ret",
    "toString",
    "i",
    "factor",
    "offset",
    "low",
    "high",
    "strokeDasharray",
    "strokeDashoffset",
    "getTotalLength",
    "activeValues",
    "getAttribute",
    "address",
    "ui",
    "TrickOMatic",
    "addAddress",
    "addUpdateListener",
    "updateActive",
    "getState",
    "createKeyframe",
    "name",
    "content",
    "keyframes",
    "createCSSRules",
    "value",
    "s",
    "createElementNS",
    "setAttribute",
    "textContent",
    "svgElement",
    "querySelector",
    "firstChild",
    "classList",
    "toggle"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* TrickOMatic.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * @author Christian Mayer\n * @since 2010\n */\nqx.Class.define('cv.ui.TrickOMatic', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    id: 0,\n\n    run: function () {\n      const svg = this.getSVGDocument();\n      if (!svg) {\n        return;\n      }\n\n      // Pipe-O-Matic:\n      let pipes = svg.querySelectorAll('.pipe_group');\n      pipes.forEach(function (pipe_group) {\n        pipe_group.querySelectorAll('path').forEach(function(path) {\n          const halfsize = Math.floor(parseFloat(path.style.strokeWidth) / 2);\n          let opacity = 0.15;\n          for (let width = halfsize - 1; width > 0; width--) {\n            opacity -= 0.1 / halfsize;\n            const n = path.cloneNode();\n            n.className.baseVal += ' pipe-o-matic_clone';\n            n.style.strokeWidth = width * 2;\n            n.style.stroke = '#ffffff';\n            n.style.strokeOpacity = opacity;\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n        });\n      });\n\n      const model = cv.data.Model.getInstance();\n\n      // Flow-O-Matic: add Paths\n      const segmentLength = 40;\n      pipes = svg.querySelectorAll('.show_flow');\n      pipes.forEach(function (pipe_group) {\n        let length = 0.0;\n        pipe_group.querySelectorAll('path').forEach(function(path) {\n          if (path.className.animVal.split(' ').indexOf('pipe-o-matic_clone') > 0) {\n            return;\n          }\n          const stroke = path.style.stroke;\n          let r;\n          let g;\n          let b;\n          if (stroke[0] === '#') {\n            r = parseInt(path.style.stroke.substring(1, 3), 16);\n            g = parseInt(path.style.stroke.substring(3, 5), 16);\n            b = parseInt(path.style.stroke.substring(5, 7), 16);\n          } else if (stroke.indexOf('rgb(') === 0) {\n            const colors = stroke.replace(/[^0-9,.]*/g, '').split(',');\n            r = colors[0];\n            g = colors[1];\n            b = colors[2];\n          }\n          const rTarget = 0; // this color should be somehow user setable but how?\n          const gTarget = 0;\n          const bTarget = 0;\n\n          /**\n           * @param v\n           */\n          function toHex(v) {\n            const ret = parseInt(v).toString(16);\n            return (ret.length < 2) ? '0' + ret : ret;\n          }\n\n          for (let i = segmentLength / 2; i > 0; i -= 2) {\n            const factor = 1 - i / (segmentLength / 2);\n            const offset = (length + segmentLength / 2 - i) % segmentLength;\n            const low = 2 * i;\n            const high = segmentLength - low;\n            const n = path.cloneNode();\n            n.className.baseVal += ' flow-o-matic_clone';\n            n.style.stroke = '#' + toHex(r * factor + rTarget * (1 - factor)) + toHex(g * factor + gTarget * (1 - factor)) + toHex(b * factor + bTarget * (1 - factor));\n            if (high > offset) {\n              n.style.strokeDasharray = [high - offset, low, offset, 0];\n            } else {\n              n.style.strokeDasharray = [0, low - (offset - high), high, offset - high];\n            }\n            n.style.strokeDashoffset = length % (0.5 * segmentLength);\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n          length += path.getTotalLength();\n          const activeValues = pipe_group.getAttribute('data-cometvisu-active');\n          if (activeValues) {\n            activeValues.split(' ').forEach(function (address) {\n              const id = 'flow_' + cv.ui.TrickOMatic.id++;\n              model.addAddress(address, id);\n              model.addUpdateListener(address, function (address, data) {\n                cv.ui.TrickOMatic.updateActive(pipe_group, data);\n              });\n              // init\n              cv.ui.TrickOMatic.updateActive(pipe_group, cv.data.Model.getInstance().getState(address));\n            });\n          }\n        });\n      });\n\n      // Flow-O-Matic: add CSS\n      // helper for multiple bowser support\n      /**\n       * @param name\n       * @param content\n       */\n      function createKeyframe(name, content) {\n        return '@keyframes ' + name + ' {\\n' + content + '}\\n' +\n          '@-moz-keyframes ' + name + ' {\\n' + content + '}\\n' +\n          '@-webkit-keyframes ' + name + ' {\\n' + content + '}\\n';\n      }\n\n      let keyframes = createKeyframe('move',\n        'from {  stroke-dashoffset: ' + segmentLength + ';  }\\n' +\n        'to   {  stroke-dashoffset: 0;  }\\n');\n\n      /**\n       * @param style\n       * @param value\n       */\n      function createCSSRules(style, value) {\n        return `${style}: ${value};\n          -moz-${style}: ${value};\n          -webkit-${style}: ${value};\n        `;\n    }\n\n      keyframes += '.flow_active path {\\n' +\n        createCSSRules('animation-duration', '3s') +\n        createCSSRules('animation-name', 'move')+\n        createCSSRules('animation-timing-function', 'linear') +\n        createCSSRules('animation-iteration-count', 'infinite') +\n        '}\\n';\n      const s = svg.createElementNS('http://www.w3.org/2000/svg',\n        'style');\n      s.setAttribute('type', 'text/css');\n      s.textContent = keyframes;\n      const svgElement = svg.querySelector('svg');\n      svgElement.insertBefore(s, svgElement.firstChild);\n    },\n\n    updateActive: function (pipe_group, data) {\n      if (parseInt(data) === 1 || data === 'ON' || data === true) {\n        pipe_group.classList.toggle('flow_active', true);\n      } else {\n        pipe_group.classList.toggle('flow_active', false);\n      }\n    }\n  }\n});\n"
  ]
}