{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/ui/manager/editor/Worker.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "_files",
    "_worker",
    "Worker",
    "util",
    "ResourceManager",
    "getInstance",
    "toUri",
    "onmessage",
    "_onMessage",
    "bind",
    "_validationCallbacks",
    "properties",
    "editor",
    "check",
    "nullable",
    "members",
    "open",
    "file",
    "code",
    "schema",
    "postMessage",
    "path",
    "getFullPath",
    "xml",
    "Document",
    "isXmlDocument",
    "documentElement",
    "outerHTML",
    "close",
    "contentChanged",
    "content",
    "validateConfig",
    "isConfigFile",
    "Promise",
    "resolve",
    "reject",
    "url",
    "getServerPath",
    "hasOwnProperty",
    "push",
    "log",
    "Logger",
    "error",
    "e",
    "topic",
    "data",
    "shift",
    "getEditor",
    "isTemporary",
    "setModified",
    "modified",
    "setHash",
    "currentHash",
    "setValid",
    "length",
    "showErrors",
    "showDecorations",
    "callbacks",
    "forEach",
    "cb",
    "destruct",
    "terminate",
    "cv",
    "ui",
    "manager"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n *\n */\nqx.Class.define('cv.ui.manager.editor.Worker', {\n  extend: qx.core.Object,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    this._files = {};\n    // create WebWorker\n    this._worker = new Worker(qx.util.ResourceManager.getInstance().toUri('manager/worker.js'));\n    this._worker.onmessage = this._onMessage.bind(this);\n    this._validationCallbacks = {};\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    editor: {\n      check: 'cv.ui.manager.editor.Source',\n      nullable: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _worker: null,\n    _files: null,\n    _validationCallbacks: null,\n\n    open: function (file, code, schema) {\n      this._worker.postMessage([\"openFile\", {\n        path: file.getFullPath(),\n        code: qx.xml.Document.isXmlDocument(code) ? code.documentElement.outerHTML : code,\n        schema: schema\n      }]);\n      this._files[file.getFullPath()] = file;\n    },\n\n    close: function (file) {\n      this._worker.postMessage([\"closeFile\", {\n        path: file.getFullPath()\n      }]);\n      delete this._files[file.getFullPath()];\n    },\n\n    contentChanged: function (file, content) {\n      this._worker.postMessage([\"contentChange\", {\n        path: file.getFullPath(),\n        code: content\n      }]);\n    },\n\n    validateConfig: function (file) {\n      if (file.isConfigFile()) {\n        return new Promise(function (resolve, reject) {\n          // check if there is already one validation request ongoing\n          var url = file.getServerPath();\n          if (!this._validationCallbacks.hasOwnProperty(url)) {\n            this._validationCallbacks[url] = [resolve];\n            this._worker.postMessage([\"validateConfig\", {\n              path: url\n            }]);\n          } else {\n            this._validationCallbacks[url].push(resolve);\n          }\n        }.bind(this));\n      } else {\n        qx.log.Logger.error(this, file.getFullPath() + ' is no configuration file');\n      }\n    },\n\n    _onMessage: function (e) {\n      var topic = e.data.shift();\n      var data = e.data.shift();\n      var path = e.data.shift();\n      var file = this._files[path];\n      if (!file && topic !== 'validationResult') {\n        qx.log.Logger.error(this, 'no file found for path ' + path + ' ignoring worker message for topic ' + topic);\n        return;\n      }\n      var editor = this.getEditor();\n      switch(topic) {\n        case \"modified\":\n          // new files are always modified, to not override that state\n          if (!file.isTemporary()) {\n            file.setModified(data.modified);\n          }\n          file.setHash(data.currentHash);\n          break;\n\n        case \"errors\":\n          file.setValid(!data || data.length === 0);\n          if (editor) {\n            editor.showErrors(path, data);\n          }\n          break;\n\n        case \"decorations\":\n          if (editor) {\n            editor.showDecorations(path, data);\n          }\n          break;\n\n        case 'validationResult':\n          if (this._validationCallbacks.hasOwnProperty(path)) {\n            var callbacks = this._validationCallbacks[path];\n            delete this._validationCallbacks[path];\n            callbacks.forEach(function(cb) {\n              cb(data);\n            });\n          }\n          break;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._worker.terminate();\n    this._worker = null;\n  }\n});\n"
  ]
}