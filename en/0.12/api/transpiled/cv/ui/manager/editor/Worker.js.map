{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/editor/Worker.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "_files",
    "_worker",
    "cv",
    "data",
    "FileWorker",
    "getInstance",
    "addListener",
    "_onMessage",
    "properties",
    "editor",
    "check",
    "nullable",
    "members",
    "open",
    "file",
    "code",
    "schema",
    "features",
    "postMessage",
    "path",
    "getFullPath",
    "xml",
    "Document",
    "isXmlDocument",
    "documentElement",
    "outerHTML",
    "close",
    "contentChanged",
    "content",
    "validateConfig",
    "isConfigFile",
    "getServerPath",
    "log",
    "Logger",
    "error",
    "validateXmlConfig",
    "e",
    "topic",
    "getData",
    "getEditor",
    "isTemporary",
    "setModified",
    "modified",
    "setHash",
    "currentHash",
    "setValid",
    "length",
    "showErrors",
    "showDecorations",
    "destruct",
    "terminate",
    "ui",
    "manager",
    "Worker"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Worker.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n *\n */\nqx.Class.define('cv.ui.manager.editor.Worker', {\n  extend: qx.core.Object,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    this._files = {};\n    // create WebWorker\n    this._worker = cv.data.FileWorker.getInstance();\n    this._worker.addListener('message', this._onMessage, this);\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    editor: {\n      check: 'cv.ui.manager.editor.AbstractEditor',\n      nullable: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _worker: null,\n    _files: null,\n\n    open: function (file, code, schema, features) {\n      this._worker.postMessage(['openFile', {\n        path: file.getFullPath(),\n        code: qx.xml.Document.isXmlDocument(code) ? code.documentElement.outerHTML : code,\n        schema: schema\n      }, features]);\n      this._files[file.getFullPath()] = file;\n    },\n\n    close: function (file) {\n      this._worker.postMessage(['closeFile', {\n        path: file.getFullPath()\n      }]);\n      delete this._files[file.getFullPath()];\n    },\n\n    contentChanged: function (file, content) {\n      this._worker.postMessage(['contentChange', {\n        path: file.getFullPath(),\n        code: content\n      }]);\n    },\n\n    validateConfig: function (file) {\n      if (file.isConfigFile()) {\n        return this._worker.validateConfig(file.getServerPath());\n      }\n      qx.log.Logger.error(this, file.getFullPath() + ' is no configuration file');\n      return true;\n    },\n\n    validateXmlConfig: function (content) {\n      return this._worker.validateXmlConfig(content);\n    },\n\n    _onMessage: function (e) {\n      let topic = e.getData().topic;\n      let data = e.getData().data;\n      let path = e.getData().path;\n      let file = this._files[path];\n      if (!file && topic !== 'validationResult') {\n        qx.log.Logger.error(this, 'no file found for path ' + path + ' ignoring worker message for topic ' + topic);\n        return;\n      }\n      let editor = this.getEditor();\n      switch (topic) {\n        case 'modified':\n          // new files are always modified, to not override that state\n          if (!file.isTemporary()) {\n            file.setModified(data.modified);\n          }\n          file.setHash(data.currentHash);\n          break;\n\n        case 'hash':\n          file.setHash(data);\n          break;\n\n        case 'errors':\n          file.setValid(!data || data.length === 0);\n          if (editor) {\n            editor.showErrors(path, data);\n          }\n          break;\n\n        case 'decorations':\n          if (editor) {\n            editor.showDecorations(path, data);\n          }\n          break;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._worker.terminate();\n    this._worker = null;\n  }\n});\n"
  ]
}