{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/model/XmlElement.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "include",
    "data",
    "marshal",
    "MEventBubbling",
    "construct",
    "node",
    "schemaElement",
    "editor",
    "parent",
    "_node",
    "children",
    "Array",
    "$$widget",
    "initName",
    "nodeName",
    "setSchemaElement",
    "hasChildren",
    "push",
    "cv",
    "ui",
    "manager",
    "model",
    "XmlElement",
    "setEditor",
    "setParent",
    "_maintainIcon",
    "_maintainStatus",
    "initChildren",
    "_initialAttributes",
    "Map",
    "bind",
    "statics",
    "entityMap",
    "properties",
    "check",
    "nullable",
    "event",
    "apply",
    "name",
    "deferredInit",
    "displayName",
    "init",
    "open",
    "loaded",
    "textContent",
    "validate",
    "temporary",
    "valid",
    "invalidMessage",
    "status",
    "editable",
    "sortable",
    "deletable",
    "modified",
    "showEditButton",
    "icon",
    "dragging",
    "members",
    "_schema",
    "_schemaElement",
    "_initialChildNames",
    "_initialTextContent",
    "__initializing",
    "__addableChildren",
    "nodeType",
    "Node",
    "COMMENT_NODE",
    "setStatus",
    "isValid",
    "_applyValid",
    "value",
    "resetInvalidMessage",
    "convertTextNodeType",
    "newType",
    "isTextNode",
    "TEXT_NODE",
    "CDATA_SECTION_NODE",
    "content",
    "getText",
    "oldNode",
    "newTextNode",
    "ownerDocument",
    "createCDATASection",
    "createTextNode",
    "parentNode",
    "replaceChild",
    "setName",
    "load",
    "setIcon",
    "theme",
    "dark",
    "Images",
    "getIcon",
    "getName",
    "getAttribute",
    "indexOf",
    "source",
    "IconHandler",
    "getInstance",
    "getIconSource",
    "isOpen",
    "_applyEditable",
    "_updateShowEditButton",
    "updateDeletable",
    "getSchemaElement",
    "setShowEditButton",
    "isTextContentAllowed",
    "startsWith",
    "keys",
    "getAllowedAttributes",
    "length",
    "isChildElementAllowed",
    "isEditable",
    "setDeletable",
    "getParent",
    "isTextContentRequired",
    "existing",
    "getChildren",
    "filter",
    "child",
    "requiredFromParent",
    "getRequiredElements",
    "includes",
    "bounds",
    "getBoundsForElementName",
    "min",
    "getNode",
    "remove",
    "skipUndo",
    "changes",
    "index",
    "getEditor",
    "$$removed",
    "updateModified",
    "change",
    "ElementChange",
    "locale",
    "Manager",
    "tr",
    "getDisplayName",
    "addUndo",
    "isAncestor",
    "element",
    "_move",
    "target",
    "position",
    "targetParent",
    "targetChildren",
    "oldIndex",
    "oldParent",
    "isChildAllowedAtPosition",
    "insertChild",
    "moveTo",
    "newParent",
    "getItem",
    "moveAfter",
    "moveBefore",
    "moveInside",
    "insertAfter",
    "newIndex",
    "insertBefore",
    "getAddableChildren",
    "excludeComment",
    "allowed",
    "getAllowedElements",
    "stillAllowed",
    "countExisting",
    "isLoaded",
    "forEach",
    "prototype",
    "hasOwnProperty",
    "call",
    "elementName",
    "isMixed",
    "textNodes",
    "otherNodes",
    "key",
    "childBounds",
    "max",
    "xmlElement",
    "debug",
    "areChildrenSortable",
    "allowedSorting",
    "getFirstLevelElementSorting",
    "currentPosition",
    "targetPosition",
    "previousSibling",
    "i",
    "Math",
    "findPositionForChild",
    "newChild",
    "targetIndex",
    "found",
    "some",
    "childPos",
    "internalOperation",
    "success",
    "appendChild",
    "childNodes",
    "unshift",
    "previousChild",
    "before",
    "$$added",
    "setOpen",
    "_validateTextContent",
    "isValueValid",
    "ValidationError",
    "recursive",
    "setValid",
    "isElement",
    "allowedAttributes",
    "errors",
    "attributes",
    "attr",
    "item",
    "attribute",
    "error",
    "isOptional",
    "hasAttribute",
    "nodeValue",
    "trim",
    "setInvalidMessage",
    "map",
    "err",
    "join",
    "_applyTextContent",
    "_updateDisplayName",
    "ELEMENT_NODE",
    "getTextContent",
    "setText",
    "text",
    "changed",
    "newValue",
    "oldValue",
    "setTextContent",
    "old",
    "setAttribute",
    "undefined",
    "replace",
    "s",
    "getDefaultValue",
    "removeAttribute",
    "isRequired",
    "setAttributes",
    "parentChanges",
    "attrName",
    "dom",
    "DOMParser",
    "parseFromString",
    "getElementsByTagName",
    "outerHTML",
    "innerHTML",
    "newNode",
    "documentElement",
    "parentChange",
    "_applySchemaElement",
    "converter",
    "_onOpen",
    "_applyModified",
    "nameAttr",
    "designAttr",
    "substring",
    "isModified",
    "setDisplayName",
    "hasChildNodes",
    "childNode",
    "force",
    "removeListener",
    "_syncChildNodes",
    "removeAll",
    "childSchemaElement",
    "getSchemaElementForElementName",
    "setSortable",
    "msg",
    "getInvalidMessage",
    "clear",
    "set",
    "e",
    "appendInvalidMessage",
    "toString",
    "setLoaded",
    "addListener",
    "_updateChildrenDeletableFlags",
    "errorMsg",
    "setModified",
    "initial",
    "currentChildNames",
    "_currentChildNames",
    "size",
    "hasChildrenModified",
    "onSaved",
    "names",
    "ev",
    "getWidgetPath",
    "widgets",
    "getSchema",
    "getWidgetNames",
    "current",
    "lang",
    "String",
    "firstUp",
    "ids",
    "c",
    "id",
    "clone",
    "cloneNode",
    "destruct",
    "_disposeObjects"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* XmlElement.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Represents an Element or TextNode in an XML document\n */\nqx.Class.define('cv.ui.manager.model.XmlElement', {\n  extend: qx.core.Object,\n  include: [\n    qx.data.marshal.MEventBubbling\n  ],\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function (node, schemaElement, editor, parent) {\n    this.base(arguments);\n    this._node = node;\n    const children = new qx.data.Array();\n    if (node) {\n      this._node.$$widget = this;\n      this.initName(node.nodeName);\n      this.setSchemaElement(schemaElement);\n      if (this.hasChildren()) {\n        // we have to add a fake node to the children to show the tree that this node has children\n        // it will be removed when the real children are loaded\n        children.push(new cv.ui.manager.model.XmlElement());\n      }\n      if (editor) {\n        this.setEditor(editor);\n      }\n      if (parent) {\n        this.setParent(parent);\n      }\n      this._maintainIcon();\n      this._maintainStatus();\n    } else {\n      // this is a fake node needed for children simulation\n      this.initName('#temp');\n    }\n    this.initChildren(children);\n    this._initialAttributes = new Map();\n    this.bind('editor.file.writeable', this, 'editable');\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    entityMap: {\n      '&': '&amp;',\n      '\"': '&quot;',\n      '\\'': '&#39;',\n      '`': '&#x60;'\n    }\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    // the current editor this element os shown in\n    editor: {\n      check: 'cv.ui.manager.editor.Tree',\n      nullable: true,\n      event: 'changeEditor'\n    },\n    schemaElement: {\n      check: 'cv.ui.manager.model.schema.Element',\n      apply: '_applySchemaElement'\n    },\n    name: {\n      check: 'String',\n      deferredInit: true,\n      event: 'changeName',\n      apply: '_updateDisplayName'\n    },\n    displayName: {\n      check: 'String',\n      init: '',\n      event: 'changeDisplayName'\n    },\n    open : {\n      check : 'Boolean',\n      event : 'changeOpen',\n      init : false,\n      apply : '_onOpen'\n    },\n    loaded : {\n      check : 'Boolean',\n      event : 'changeLoaded',\n      init : false\n    },\n    children : {\n      check : 'qx.data.Array',\n      event : 'changeChildren',\n      apply: '_applyEventPropagation',\n      deferredInit : true\n    },\n\n    textContent: {\n      check: 'String',\n      nullable: true,\n      apply: '_applyTextContent',\n      event: 'changeTextContent',\n      validate: '_validateTextContent'\n    },\n    /**\n     * Temporary nodes are not save in the backend yet\n     */\n    temporary: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeTemporary'\n    },\n\n    /**\n     * Validation result for this nodes content\n     */\n    valid: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeValid',\n      apply: '_applyValid'\n    },\n\n    invalidMessage: {\n      check: 'String',\n      init: '',\n      event: 'changeInvalidMessage'\n    },\n\n    status: {\n      check: ['error', 'valid', 'comment'],\n      init: 'valid',\n      event: 'changeStatus'\n    },\n\n    editable: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeEditable',\n      apply: '_applyEditable'\n    },\n\n    sortable: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeSortable'\n    },\n\n    /**\n     * true if this element can be deleted (either no bounds.min or more existing elements)\n     */\n    deletable: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeDeletable'\n    },\n\n    modified: {\n      check: 'Boolean',\n      init: false,\n      apply: '_applyModified'\n    },\n\n    showEditButton: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeShowEditButton'\n    },\n    parent: {\n      check: 'cv.ui.manager.model.XmlElement',\n      nullable: true\n    },\n\n    // icon to show in the tree\n    icon: {\n      check: 'String',\n      nullable: true,\n      event: 'changeIcon'\n    },\n\n    dragging: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeDragging'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _node: null,\n    _schema: null,\n    _schemaElement: null,\n    _initialAttributes: null,\n    _initialChildNames: null,\n    _initialTextContent: null,\n    __initializing: false,\n    __addableChildren: null,\n\n    _maintainStatus: function () {\n      if (this._node.nodeType === Node.COMMENT_NODE) {\n        this.setStatus('comment');\n      } else if (!this.isValid()) {\n        this.setStatus('error');\n      } else {\n        this.setStatus('valid');\n      }\n    },\n\n    _applyValid: function (value) {\n      this._maintainStatus();\n      if (value) {\n        this.resetInvalidMessage();\n      }\n    },\n\n    convertTextNodeType: function (newType) {\n      if (this.isTextNode() && this._node.nodeType !== newType && (newType === Node.TEXT_NODE || newType === Node.CDATA_SECTION_NODE)) {\n        const content = this.getText();\n        const oldNode = this._node;\n        const newTextNode = newType === Node.CDATA_SECTION_NODE ? this._node.ownerDocument.createCDATASection(content) : this._node.ownerDocument.createTextNode(content);\n        if (oldNode.parentNode) {\n          oldNode.parentNode.replaceChild(newTextNode, oldNode);\n        }\n        this._node = newTextNode;\n        this.setName(this._node.nodeName);\n        this.load(true);\n      }\n    },\n\n    _maintainIcon: function () {\n      if (this._node) {\n        if (this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) {\n          this.setIcon(cv.theme.dark.Images.getIcon('text-fields', 18));\n          return;\n        } else if (this._node.nodeType === Node.COMMENT_NODE) {\n          this.setIcon(cv.theme.dark.Images.getIcon('comment-fields', 18));\n          return;\n        } else if (this.getName() === 'icon' && this.getAttribute('name') && this.getAttribute('name').indexOf('{{') === -1) {\n          // try to use the configured icon (if its not set by a template variable)\n          const source = cv.IconHandler.getInstance().getIconSource(this.getAttribute('name'), 'tree-icon');\n          if (source) {\n            this.setIcon(source);\n          } else {\n            this.setIcon(cv.theme.dark.Images.getIcon('image', 18));\n          }\n          return;\n        }\n      }\n      if (this.isOpen()) {\n        this.setIcon(cv.theme.dark.Images.getIcon('folder-open', 18));\n      } else {\n        this.setIcon(cv.theme.dark.Images.getIcon('folder', 18));\n      }\n    },\n\n    _applyEditable: function () {\n      this._updateShowEditButton();\n      this.updateDeletable();\n    },\n\n    _updateShowEditButton: function () {\n      const schemaElement = this.getSchemaElement();\n      this.setShowEditButton(\n        schemaElement.isTextContentAllowed() && this.getName().startsWith('#') ||\n        Object.keys(schemaElement.getAllowedAttributes()).length > 0 ||\n        schemaElement.isChildElementAllowed('*') // any element allowed, this is edited as text (outerHTML)\n      );\n    },\n\n    updateDeletable: function () {\n      if (!this.isEditable()) {\n        this.setDeletable(false);\n      } else {\n        const parent = this.getParent();\n        if (this.isTextNode()) {\n          if (this.getSchemaElement().isTextContentRequired()) {\n            const existing = parent.getChildren().filter(child => child.isTextNode()).length;\n            this.setDeletable(existing > 1);\n          } else {\n            this.setDeletable(true);\n          }\n        } else {\n          let deletable = false;\n          if (parent) {\n            const schemaElement = parent.getSchemaElement();\n            const requiredFromParent = schemaElement.getRequiredElements();\n            if (requiredFromParent.includes(this.getName())) {\n              const bounds = schemaElement.getBoundsForElementName(this.getName());\n              if (bounds) {\n                const existing = parent.getChildren().filter(child => child.getName() === this.getName()).length;\n                // check if we can afford to delete one\n                deletable = (bounds.min <= existing - 1);\n              } else {\n                deletable = true;\n              }\n            } else {\n              deletable = true;\n            }\n          } else {\n            deletable = true;\n          }\n          this.setDeletable(deletable);\n        }\n      }\n    },\n\n    getNode: function () {\n      return this._node;\n    },\n\n    remove: function (skipUndo) {\n      const parent = this.getParent();\n      if (parent) {\n        const changes = [{\n          index: parent.getChildren().indexOf(this),\n          parent: parent,\n          child: this\n        }];\n        this._node.remove();\n        parent.getChildren().remove(this);\n        const editor = this.getEditor();\n        this.$$removed = true;\n        if (editor) {\n          // editor should not consider the modification state of removed elements\n          editor.updateModified(this);\n        }\n        parent.updateModified();\n        if (!skipUndo) {\n          if (editor) {\n            const change = new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Remove %1', this.getDisplayName()), this, changes, 'deleted');\n            editor.addUndo(change);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check is this element is an ancestor of the given element\n     * @param element {cv.ui.manager.model.XmlElement} element to check\n     * @returns {boolean}\n     */\n    isAncestor: function (element) {\n      let parent = element.getParent();\n      while (parent) {\n        if (parent === this) {\n          return true;\n        }\n        parent = parent.getParent();\n      }\n      return false;\n    },\n\n    /**\n     * Move this node to a new position in relation to the target\n     * @param target {cv.ui.manager.model.XmlElement} new direct sibling\n     * @param position {String} more 'before', 'after' or 'inside' target\n     * @param skipUndo {Boolean} no not add an undo operation for this\n     * @private\n     */\n    _move: function (target, position, skipUndo) {\n      if (this.isAncestor(target)) {\n        // we cannot move into ourselves descendants\n        return false;\n      }\n      if (target === this) {\n        // do not move ourselves before, after or inside ourselves\n        return false;\n      }\n      const parent = this.getParent();\n      const children = parent.getChildren();\n      const targetParent = position === 'inside' ? target : target.getParent();\n      const targetChildren = targetParent.getChildren();\n      const changes = [{\n        oldIndex: children.indexOf(this),\n        oldParent: parent,\n        parent: targetParent,\n        child: this,\n        index: targetChildren.indexOf(target) + (position === 'after' ? 1 : 0)\n      }];\n      if ((position === 'inside' && targetParent.getSchemaElement().isChildElementAllowed(this.getName())) || targetParent.isChildAllowedAtPosition(this, changes[0].index)) {\n        children.remove(this);\n        this.getNode().remove();\n        if (targetParent === parent) {\n          // target index might have changed by removing\n          changes[0].index = targetChildren.indexOf(target) + (position === 'after' ? 1 : 0);\n        }\n        targetParent.insertChild(this, changes[0].index, true, 'moved');\n        if (!skipUndo) {\n          const editor = this.getEditor();\n          if (editor) {\n            const change = new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Move %1', this.getDisplayName()), this, changes, 'moved');\n            editor.addUndo(change);\n          }\n        }\n        return true;\n      }\n      return false;\n    },\n\n    moveTo: function (newParent, index, skipUndo) {\n      if (this.isAncestor(newParent)) {\n        // we cannot move into ourselves descendants\n        return false;\n      }\n      const parent = this.getParent();\n      const children = parent.getChildren();\n      const changes = [{\n        oldIndex: children.indexOf(this),\n        oldParent: parent,\n        parent: newParent,\n        child: this,\n        index: index\n      }];\n      // save old target index because we are moving inside the same parent, and the target index might change after removing\n      const target = newParent === parent && index < children.length ? children.getItem(index) : null;\n      if (newParent.isChildAllowedAtPosition(this, index)) {\n        children.remove(this);\n        this.getNode().remove();\n\n        if (target) {\n          index = children.indexOf(target);\n          changes[0].index = index;\n        }\n        newParent.insertChild(this, index, true, 'moved');\n        if (!skipUndo) {\n          const editor = this.getEditor();\n          if (editor) {\n            const change = new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Move %1', this.getDisplayName()), this, changes, 'moved');\n            editor.addUndo(change);\n          }\n        }\n        return true;\n      }\n      return false;\n    },\n\n    moveAfter: function (target, skipUndo) {\n      return this._move(target, 'after', skipUndo);\n    },\n\n    moveBefore: function (target, skipUndo) {\n      return this._move(target, 'before', skipUndo);\n    },\n\n    moveInside: function (target, skipUndo) {\n      return this._move(target, 'inside', skipUndo);\n    },\n\n    insertAfter: function (target, skipUndo) {\n      const targetParent = target.getParent();\n      const newIndex = targetParent.getChildren().indexOf(target) + 1;\n      return targetParent.insertChild(this, newIndex, skipUndo, 'added');\n    },\n\n    insertBefore: function (target, skipUndo) {\n      const targetParent = target.getParent();\n      const newIndex = targetParent.getChildren().indexOf(target);\n      return targetParent.insertChild(this, newIndex, skipUndo, 'added');\n    },\n\n    /**\n     * Returns a list of element names that can be added to this element.\n     * Checks the allowed elements and their bounds and the existing children\n     * to find out if we can add more of them.\n     * @param excludeComment {Boolean} exclude #comment child when set to true\n     */\n    getAddableChildren: function(excludeComment) {\n      if (!this.__addableChildren) {\n        if (this.getName().startsWith('#')) {\n          this.__addableChildren = [];\n        } else {\n          const schemaElement = this.getSchemaElement();\n          const allowed = schemaElement.getAllowedElements();\n          const stillAllowed = [];\n          const countExisting = {};\n          if (!this.isLoaded()) {\n            this.load();\n          }\n          this.getChildren().forEach(child => {\n            if (!Object.prototype.hasOwnProperty.call(countExisting, child.getName())) {\n              countExisting[child.getName()] = 0;\n            }\n            countExisting[child.getName()]++;\n          });\n\n          Object.keys(allowed).forEach(elementName => {\n            if (excludeComment === true && elementName === '#comment') {\n              return;\n            }\n            if ((elementName === '#text' || elementName === '#cdata-section')) {\n              if (schemaElement.isTextContentAllowed()) {\n                if (schemaElement.isMixed()) {\n                  // is a mixed content has only one text child and no other childs, we do not allow another text child -> avoid direct text siblings\n                  let textNodes = 0;\n                  let otherNodes = 0;\n                  Object.keys(countExisting).forEach(key => {\n                    if (key === '#text' || key === '#cdata-section') {\n                      textNodes+=countExisting[key];\n                    } else {\n                      otherNodes+=countExisting[key];\n                    }\n                  });\n                  if (textNodes<=otherNodes) {\n                    // we do not allow more text nodes than other nodes (e.g. a sequence of #text, elem would allow another #text node after elem)\n                    stillAllowed.push(elementName);\n                  }\n                } else if (!Object.prototype.hasOwnProperty.call(countExisting, '#text') && !Object.prototype.hasOwnProperty.call(countExisting, '#cdata-section')) {\n                  stillAllowed.push(elementName);\n                }\n              }\n              return;\n            }\n            const childBounds = schemaElement.getBoundsForElementName(elementName);\n            const existing = Object.prototype.hasOwnProperty.call(countExisting, elementName) ? countExisting[elementName] : 0;\n            if (childBounds && childBounds.max > existing) {\n              stillAllowed.push(elementName);\n            }\n          });\n          this.__addableChildren = stillAllowed;\n        }\n      }\n      return this.__addableChildren;\n    },\n\n    /**\n     * Checks if a new child is allowed at the given position\n     * @param xmlElement {cv.ui.manager.model.XmlElement|String} the element or an element name as string\n     * @param index {Number} position to check, use Number.POSITIVE_INFINITY to check if the child is allowed to be appended\n     * @returns {boolean}\n     */\n    isChildAllowedAtPosition: function (xmlElement, index) {\n      const schemaElement = this.getSchemaElement();\n      const nodeName = xmlElement instanceof cv.ui.manager.model.XmlElement ? xmlElement.getName() : xmlElement;\n      if (!schemaElement.isChildElementAllowed(nodeName)) {\n        this.debug(nodeName, 'is not allowed as child of', this.getName());\n        return false;\n      }\n      if (schemaElement.areChildrenSortable()) {\n        // allowed at any position\n        return true;\n      }\n      // check position\n      const allowedSorting = schemaElement.getFirstLevelElementSorting();\n      if (!this.isLoaded()) {\n        this.load();\n      }\n      const children = this.getChildren();\n      if (children.length === 0) {\n        // no children yet, no position problem\n        return true;\n      }\n      let currentPosition = index;\n      if (children.length > index) {\n        currentPosition = allowedSorting[children.getItem(index).getName()];\n      } else {\n        currentPosition = children.length;\n      }\n      let targetPosition = allowedSorting[nodeName];\n      if (currentPosition === targetPosition || targetPosition >= children.length) {\n        // no special position\n        return true;\n      } \n        // find the first previous sibling of a different type\n        let previousSibling;\n        if (index > 0) {\n          for (let i = Math.min(index, children.length) - 1; i >= 0; i--) {\n            if (children.getItem(i).getName() !== nodeName) {\n              previousSibling = children.getItem(i).getName();\n              break;\n            }\n          }\n        }\n        if (previousSibling) {\n          currentPosition = allowedSorting[previousSibling];\n        }\n        // only allow if it can be inserted before\n        const allowed = currentPosition + 1 >= targetPosition;\n        if (!allowed) {\n          this.debug(nodeName, 'is not allowed as child of', this.getName());\n          return false;\n        }\n      \n      return true;\n    },\n\n    findPositionForChild: function(newChild) {\n      const schemaElement = this.getSchemaElement();\n      if (schemaElement.isChildElementAllowed(newChild.getName())) {\n        if (!this.isLoaded()) {\n          this.load();\n        }\n        if (schemaElement.areChildrenSortable()) {\n          // any position is fine, just append it to the end\n          return this.getChildren().length;\n        } \n          const allowedSorting = schemaElement.getFirstLevelElementSorting();\n          if (allowedSorting && Object.prototype.hasOwnProperty.call(allowedSorting, newChild.getName())) {\n            const position = allowedSorting[newChild.getName()];\n            // search for the first sibling with a position > than the newChilds and insert it there\n            let targetIndex = position;\n            const found = this.getChildren().some((child, index) => {\n              const childPos = allowedSorting[child.getName()];\n              if (childPos > position) {\n                targetIndex = index;\n                return true;\n              }\n              return false;\n            });\n            if (!found) {\n              // append to the end\n              targetIndex = this.getChildren().length;\n            }\n            return targetIndex;\n          }\n      }\n      return -1;\n    },\n\n    /**\n     * insert child at given index\n     * @param xmlElement {cv.ui.manager.model.XmlElement} new child\n     * @param index {Number} index to insert the child, if set to -1 insert it at any allowed position\n     * @param skipUndo {Boolean} do not add an undo operation for this change\n     * @param internalOperation\n     * @return {Boolean} true if the child has been added\n     */\n    insertChild: function (xmlElement, index, skipUndo, internalOperation) {\n      if (!this.isLoaded()) {\n        this.load();\n      }\n      const children = this.getChildren();\n      let success = false;\n      if (index === -1) {\n        index = this.findPositionForChild(xmlElement);\n        if (index === -1) {\n          // no valid position found\n          return false;\n        }\n      }\n      if (this.isChildAllowedAtPosition(xmlElement, index)) {\n        if (index >= children.length) {\n          // append\n          this._node.appendChild(xmlElement.getNode());\n          children.push(xmlElement);\n          success = true;\n        } else if (index === 0) {\n          // add before first child\n          this._node.insertBefore(xmlElement.getNode(), this._node.childNodes[0]);\n          children.unshift(xmlElement);\n          success = true;\n        } else {\n          const previousChild = children.getItem(index);\n          if (previousChild) {\n            previousChild.getNode().before(xmlElement.getNode());\n            children.insertBefore(previousChild, xmlElement);\n            success = true;\n          }\n        }\n      }\n      if (success) {\n        const editor = this.getEditor();\n        xmlElement.setParent(this);\n        if (xmlElement.$$removed) {\n          delete xmlElement.$$removed;\n          if (editor) {\n            editor.updateModified(xmlElement);\n          }\n          xmlElement.updateModified();\n        } else if (!internalOperation || internalOperation === 'added') {\n            xmlElement.$$added = true;\n            xmlElement.updateModified();\n          }\n        this.updateModified();\n        if (children.length === 1) {\n          // first child added -> open it\n          this.setOpen(true);\n        }\n        if (!skipUndo) {\n          if (editor) {\n            const changes = [{\n              index: index,\n              parent: this,\n              child: xmlElement\n            }];\n            const change = new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Add %1', this.getDisplayName()), this, changes, 'created');\n            editor.addUndo(change);\n          }\n        }\n      }\n      return success;\n    },\n\n    _validateTextContent: function (value) {\n      // do not validate content that is loaded from the actual node\n      if (!this.__initializing) {\n        if (this._node) {\n          if (!this.getSchemaElement().isValueValid(value)) {\n            throw new qx.core.ValidationError(qx.locale.Manager.tr('Invalid text content: \\'%1\\'', value));\n          }\n        } else {\n          throw new qx.core.ValidationError(qx.locale.Manager.tr('Text content not allowed here'));\n        }\n      }\n    },\n\n    /**\n     * Validate this element (and its parent when this is a text node)\n     * @param recursive {Boolean} validate children too\n     */\n    validate: function (recursive) {\n      const schemaElement = this.getSchemaElement();\n      if (this.isTextNode()) {\n        this.getParent().validate(false);\n        this.setValid(schemaElement.isValueValid(this.getText()));\n      } else if (this.isElement()) {\n        const allowedAttributes = schemaElement.getAllowedAttributes();\n        const errors = [];\n        // check attribute values\n        for (let i = 0; i < this._node.attributes.length; i++) {\n          const attr = this._node.attributes.item(i);\n          if (Object.prototype.hasOwnProperty.call(allowedAttributes, attr.name)) {\n            if (!allowedAttributes[attr.name].isValueValid(attr.value)) {\n              errors.push({\n                attribute: attr.name,\n                error: qx.locale.Manager.tr('Invalid value')\n              });\n            }\n          } else {\n            errors.push({\n              attribute: attr.name,\n              error: qx.locale.Manager.tr('Attribute \\'%1\\' not allowed', attr.name)\n            });\n          }\n        }\n        // check for missing required attributes\n        Object.keys(allowedAttributes).filter(name => !allowedAttributes[name].isOptional()).forEach(name => {\n          if (!this._node.hasAttribute(name)) {\n            errors.push({\n              attribute: name,\n              error: qx.locale.Manager.tr('Attribute \\'%1\\' is required but missing', name)\n            });\n          }\n        });\n        if (schemaElement.isTextContentRequired()) {\n          // check if we have at least one non empty #text child\n          const found = this.getChildren().some(child => child.isTextNode() && child.getNode().nodeValue.trim() !== '');\n          if (!found) {\n            errors.push({\n              attribute: '#text',\n              error: qx.locale.Manager.tr('Text content is missing')\n            });\n          }\n        }\n        if (schemaElement.isTextContentAllowed()) {\n          this.getChildren().forEach(child => {\n            if (child.isTextNode()) {\n              child.load();\n              child.setValid(schemaElement.isValueValid(child.getText()));\n              if (!child.isValid()) {\n                child.setInvalidMessage(qx.locale.Manager.tr('Text content is invalid'));\n              }\n            }\n          });\n        }\n        this.setInvalidMessage(errors.map(err => err.error).join('<br/>'));\n        this.setValid(errors.length === 0);\n      }\n    },\n\n    isTextNode: function () {\n      return this.getName() === '#text' || this.getName() === '#cdata-section';\n    },\n\n    _applyTextContent: function (value) {\n      if (!this.__initializing) {\n        if (this._node) {\n          if (this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.COMMENT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) {\n            this._node.nodeValue = value;\n            this._updateDisplayName();\n          } else if (this._node.nodeType === Node.ELEMENT_NODE) {\n            this._node.textContent = value;\n          }\n        }\n      }\n    },\n\n    getText: function () {\n      return this.getTextContent();\n    },\n\n    setText: function (text, nodeName) {\n      let changed = false;\n      let newValue = text;\n      let oldValue = '';\n      if (this.getSchemaElement().isTextContentAllowed()) {\n        oldValue = this.getTextContent();\n        if (this.getSchemaElement().isValueValid(text)) {\n          if (oldValue !== text) {\n            this.setTextContent(text);\n            changed = true;\n          }\n        } else {\n          this.error('\\''+text+'\\' is no valid text content for a \\''+this.getName() + '\\' element');\n        }\n      } else {\n        this.error('text content is not allowed for a \\''+this.getName() + '\\' element');\n      }\n      return {\n        changed: changed,\n        attribute: nodeName || '#text',\n        value: newValue,\n        old: oldValue\n      };\n    },\n\n    getAttribute: function (name) {\n      return this._node.getAttribute(name);\n    },\n\n    setAttribute: function (name, value) {\n      if (this._node.nodeType === Node.ELEMENT_NODE) {\n        const attribute = this.getSchemaElement().getAllowedAttributes()[name];\n        let changed = false;\n        let newValue = value;\n        let oldValue = this._node.hasAttribute(name) ? this._node.getAttribute(name) : '';\n        if (attribute) {\n          if (value === null || value === undefined) {\n            value = '';\n          } else {\n            value = '' + value;\n          }\n          value = value.replace(/[&\"'`]/g, function (s) {\n            return cv.ui.manager.model.XmlElement.entityMap[s];\n          });\n          newValue = value;\n          if (attribute.isValueValid(value)) {\n            if (oldValue !== value) {\n              if (!value || value === attribute.getDefaultValue()) {\n                this._node.removeAttribute(name);\n                newValue = '';\n              } else {\n                this._node.setAttribute(name, value);\n              }\n              if (name === 'name') {\n                this._updateDisplayName();\n                if (this.getName() === 'icon') {\n                  this._maintainIcon();\n                }\n              }\n              changed = true;\n            }\n          } else {\n            this.error('\\'' + value + '\\' is not allowed for attribute \\'' + name + '\\'');\n          }\n        } else {\n          this.error('\\'' + name + '\\' is no allowed attribute for a \\'' + this.getName() + '\\' element');\n        }\n        return {\n          changed: changed,\n          attribute: name,\n          value: newValue,\n          old: oldValue\n        };\n      } else if (this._node.nodeType === Node.TEXT_NODE && name === '#text' || (this._node.nodeType === Node.CDATA_SECTION_NODE && name === '#cdata-section')) {\n        return this.setText(value, name);\n      } else if ((this._node.nodeType === Node.COMMENT_NODE && name === '#comment')) {\n        const oldValue = this.getTextContent();\n        const changed = value !== oldValue;\n        this.setTextContent(value);\n        return {\n          changed: changed,\n          attribute: name,\n          value: value,\n          old: oldValue\n        };\n      }\n      return null;\n    },\n\n    /**\n     * @return {Boolean} true if this element is a required child from its parent\n     */\n    isRequired: function () {\n      const parent = this.getParent();\n      if (parent) {\n        const requiredFromParent = parent.getSchemaElement().getRequiredElements();\n        return requiredFromParent.includes(this.getName());\n      }\n      // only root element has nor parent, and a root element is always required\n      return true;\n    },\n\n    setAttributes: function (data) {\n      const changes = [];\n      let change;\n      const parentChanges = [];\n      const isTextNode = (this.getName() === '#text' || this.getName() === '#cdata-section');\n      const parent = this.getParent();\n      Object.keys(data).forEach(attrName => {\n        if (isTextNode && !attrName.startsWith('#')) {\n          // special mode for editing text content from a data provider with hints, those hints must be applied to the parent\n          change = parent.setAttribute(attrName, data[attrName]);\n          if (change.changed) {\n            parentChanges.push(change);\n          }\n        } else if (attrName === '#outerHTML' || attrName === '#innerHTML') {\n          if (this.getSchemaElement().isChildElementAllowed('*')) {\n            const dom = new DOMParser().parseFromString(data[attrName], 'text/xml');\n            if (dom.getElementsByTagName('parsererror').length === 0) {\n              const oldValue = attrName === '#outerHTML' ? this._node.outerHTML : this._node.innerHTML;\n              const newNode = dom.documentElement;\n              if (attrName === '#outerHTML') {\n                const oldNode = this._node;\n                oldNode.parentNode.replaceChild(newNode, oldNode);\n                this._node = newNode;\n                this.setName(this._node.nodeName);\n              } else {\n                this._node.innerHTML = data[attrName];\n              }\n              changes.push({\n                changed: true,\n                attribute: attrName,\n                value: data[attrName],\n                old: oldValue\n              });\n              this.load(true);\n            }\n          } else if (attrName === '#innerHTML' && !data[attrName]) {\n            // allow empty values\n            const oldValue = this._node.innerHTML;\n            this._node.innerHTML = data[attrName];\n            changes.push({\n              changed: true,\n              attribute: attrName,\n              value: data[attrName],\n              old: oldValue\n            });\n            this.load(true);\n          }\n        } else {\n          change = this.setAttribute(attrName, data[attrName]);\n          if (change.changed) {\n            changes.push(change);\n          }\n        }\n      });\n      const editor = this.getEditor();\n      if (editor && changes.length > 0) {\n        if (parentChanges.length > 0) {\n          const parentChange = new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Change %1', parent.getDisplayName()), parent, parentChanges);\n          changes.push(parentChange);\n          parent.updateModified();\n        }\n        editor.addUndo(new cv.ui.manager.model.ElementChange(qx.locale.Manager.tr('Change %1', this.getDisplayName()), this, changes));\n      }\n      this.updateModified();\n    },\n\n    _applySchemaElement: function (schemaElement) {\n      schemaElement.bind('sortable', this, 'sortable', {\n        converter: function (value) {\n          return this.isEditable() && value;\n        }.bind(this)\n      });\n      this._updateShowEditButton();\n    },\n\n    _onOpen: function (value) {\n      if (value && !this.isLoaded()) {\n        this.load();\n      }\n      this._maintainIcon();\n    },\n\n    _applyModified: function () {\n      this._updateDisplayName();\n    },\n\n    _updateDisplayName: function () {\n      let displayName = this.getName();\n      if (this._node) {\n        if (this._node.nodeType === Node.ELEMENT_NODE) {\n          if (this._node.hasAttribute('name')) {\n            const nameAttr = this._node.getAttribute('name');\n            displayName += ' \"' + nameAttr + '\"';\n          } else if (this.getName() === 'pages' && this._node.hasAttribute('design')) {\n            const designAttr = this._node.getAttribute('design');\n            displayName += ' \"' + designAttr + '\"';\n          }\n        } else if ((this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE || this._node.nodeType === Node.COMMENT_NODE) && this._node.nodeValue.trim()) {\n          let textContent = this._node.nodeValue.trim();\n          if (textContent.length > 26) {\n            textContent = textContent.substring(0, 26) + '...';\n          }\n          displayName = textContent;\n        }\n      }\n      if (this.isModified()) {\n        displayName += ' *';\n      }\n      this.setDisplayName(displayName);\n    },\n    hasChildren: function() {\n      if (this._node.nodeType === Node.ELEMENT_NODE) {\n        if (this._node && this._node.hasChildNodes()) {\n          for (let i = 0; i < this._node.childNodes.length; i++) {\n            const childNode = this._node.childNodes.item(i);\n            if (childNode.nodeType === Node.ELEMENT_NODE ||\n              ((childNode.nodeType === Node.TEXT_NODE || childNode.nodeType === Node.CDATA_SECTION_NODE) && childNode.nodeValue.trim() !== '')) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    load: function (force) {\n      if (!this.isLoaded() || force) {\n        this.__initializing = true;\n        const children = this.getChildren();\n        children.removeListener('change', this._syncChildNodes, this);\n        children.removeAll();\n        if (this._node) {\n          if (this._node.nodeType === Node.ELEMENT_NODE) {\n            // read children\n            const schemaElement = this.getSchemaElement();\n            this._initialChildNames = [];\n            for (let i = 0; i < this._node.childNodes.length; i++) {\n              const childNode = this._node.childNodes.item(i);\n              const childSchemaElement = schemaElement.getSchemaElementForElementName(childNode.nodeName);\n              if (childSchemaElement) {\n                if (childNode.nodeType === Node.ELEMENT_NODE) {\n                  const child = new cv.ui.manager.model.XmlElement(childNode, childSchemaElement, this.getEditor(), this);\n                  children.push(child);\n                  this._initialChildNames.push(childNode.nodeName);\n                } else if (childNode.nodeType === Node.TEXT_NODE || childNode.nodeType === Node.CDATA_SECTION_NODE) {\n                  if (childNode.nodeValue.trim()) {\n                    // do not use childSchemaElement here, because our schemeElement already knows how to validate text\n                    const child = new cv.ui.manager.model.XmlElement(childNode, schemaElement, this.getEditor(), this);\n                    if (schemaElement.isMixed()) {\n                      // text nodes can be re-ordered in mixed content\n                      child.setSortable(true);\n                    }\n                    children.push(child);\n                    if (childNode.nodeValue.trim()) {\n                      this._initialChildNames.push(childNode.nodeName);\n                    }\n                  }\n                } else if (childNode.nodeType === Node.COMMENT_NODE) {\n                  if (childNode.nodeValue) {\n                    const child = new cv.ui.manager.model.XmlElement(childNode, childSchemaElement, this.getEditor(), this);\n                    // comment nodes are allowed everywhere. but we do not allow them to be moved via drag&drop now\n                    // because comments might contains template conditions, which will get invalid when moved and we cannot validate that\n                    child.setSortable(false);\n                    children.push(child);\n                    if (childNode.nodeValue.trim()) {\n                      this._initialChildNames.push(childNode.nodeName);\n                    }\n                  }\n                }\n              } else if (childNode.nodeType === Node.ELEMENT_NODE) {\n                if (schemaElement.isChildElementAllowed(childNode.nodeName)) {\n                  // allowed but no schema element\n                  const child = new cv.ui.manager.model.XmlElement(childNode, schemaElement, this.getEditor(), this);\n                  if (schemaElement.isMixed()) {\n                    // text nodes can be re-ordered in mixed content\n                    child.setSortable(true);\n                  }\n                  children.push(child);\n                  this._initialChildNames.push(childNode.nodeName);\n                } else {\n                  // only complain for real childs (no comments, textNodes)\n                  this.setValid(false);\n                  let msg = this.getInvalidMessage();\n                  msg = (msg ? msg + '<br/>' : '') + qx.locale.Manager.tr('Child element \\'%1\\' not allowed.', childNode.nodeName);\n                  this.setInvalidMessage(msg);\n                  this.setValid(false);\n                }\n              }\n            }\n\n            // read attributes\n            this._initialAttributes.clear();\n            for (let i = 0; i < this._node.attributes.length; i++) {\n              const attr = this._node.attributes.item(i);\n              this._initialAttributes.set(attr.name, attr.value);\n            }\n          } else if (this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.COMMENT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) {\n            this._initialTextContent = this._node.nodeValue;\n            try {\n              this.setTextContent(this._node.nodeValue);\n            } catch (e) {\n              this.appendInvalidMessage(e.toString());\n            }\n          }\n        }\n        this.setLoaded(true);\n        children.addListener('change', this._syncChildNodes, this);\n        this._updateChildrenDeletableFlags();\n        this.__initializing = false;\n      }\n    },\n\n    appendInvalidMessage: function (errorMsg) {\n      if (errorMsg) {\n        const existing = this.getInvalidMessage();\n        this.setInvalidMessage(existing ? existing + '<br/>' + errorMsg : errorMsg);\n      }\n    },\n\n    updateModified: function () {\n      if (this.$$added) {\n        this.setModified(true);\n      } else if (this._node.nodeType === Node.ELEMENT_NODE) {\n        const initial = this._initialAttributes;\n        const currentChildNames = this._currentChildNames();\n        if (this._node.attributes.length !== initial.size) {\n          this.setModified(true);\n        } else if (currentChildNames.length !== this._initialChildNames.length || currentChildNames.join('') !== this._initialChildNames.join('')) {\n          this.setModified(true);\n        } else {\n          let modified = false;\n          for (const [key, value] of initial) {\n            if (!this._node.hasAttribute(key) || this._node.getAttribute(key) !== value) {\n              modified = true;\n              break;\n            }\n          }\n          this.setModified(modified);\n        }\n      } else if (this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.COMMENT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) {\n        this.setModified(this._initialTextContent !== this.getTextContent());\n      }\n      const editor = this.getEditor();\n      if (editor) {\n        editor.updateModified(this);\n      }\n    },\n\n    /**\n     * Special check if this element has modified children (position, of length)\n     * This is used to determine if the preview highlighting needs to be disabled because the xml structure has changed\n     * @returns {*|boolean}\n     */\n    hasChildrenModified: function () {\n      if (this._node.nodeType === Node.ELEMENT_NODE && this.isLoaded()) {\n        const currentChildNames = this._currentChildNames();\n        return this.isModified() && (currentChildNames.length !== this._initialChildNames.length || currentChildNames.join('') !== this._initialChildNames.join(''));\n      }\n      return false;\n    },\n\n    onSaved: function () {\n      if (this._node.nodeType === Node.ELEMENT_NODE) {\n        // read attributes\n        this._initialAttributes.clear();\n        for (let i = 0; i < this._node.attributes.length; i++) {\n          const attr = this._node.attributes.item(i);\n          this._initialAttributes.set(attr.name, attr.value);\n        }\n        this._initialChildNames = this._currentChildNames();\n      } else if (this._node.nodeType === Node.TEXT_NODE || this._node.nodeType === Node.COMMENT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) {\n        this._initialTextContent = this._node.nodeValue;\n      }\n      if (this.$$added) {\n        delete this.$$added;\n      }\n      this.setModified(false);\n    },\n\n    isElement: function () {\n      return this._node.nodeType === Node.ELEMENT_NODE;\n    },\n\n    _currentChildNames: function () {\n      const names = [];\n      for (let i = 0; i < this._node.childNodes.length; i++) {\n        const childNode = this._node.childNodes.item(i);\n        if (childNode.nodeType === Node.ELEMENT_NODE) {\n          names.push(childNode.nodeName);\n        } else if ((childNode.nodeType === Node.TEXT_NODE || childNode.nodeType === Node.COMMENT_NODE || this._node.nodeType === Node.CDATA_SECTION_NODE) && childNode.nodeValue.trim()) {\n          names.push(childNode.nodeName);\n        }\n      }\n      return names;\n    },\n\n    _syncChildNodes: function (ev) {\n      // children have changed clear cache\n      this.__addableChildren = null;\n      // we have to update all deletable flags for this elements children, when their siblings changed\n      this._updateChildrenDeletableFlags();\n    },\n\n    _updateChildrenDeletableFlags: function () {\n      if (this.isEditable()) {\n        this.getChildren().forEach(child => {\n          if (child.isElement() || child.isTextNode()) {\n            child.updateDeletable();\n          }\n        });\n      }\n    },\n\n    getWidgetPath: function () {\n      if (this.getName() === '#comment') {\n        return '';\n      }\n      const widgets = this.getSchemaElement().getSchema().getWidgetNames();\n      let current = this;\n      while (current && !widgets.includes(current.getName())) {\n        current = current.getParent();\n      }\n      if (!current) {\n        return '';\n      }\n      if (current.getName() === 'navbar') {\n        return 'navbar' + qx.lang.String.firstUp(current.getAttribute('position'));\n      }\n\n      const ids = [];\n      let c = current;\n      while (c) {\n        const parent = c.getParent();\n        if (parent.getName() === 'pages') {\n          ids.unshift('id');\n          break;\n        }\n        let id = parent.getChildren().filter(child => child.getNode().nodeType === Node.ELEMENT_NODE && child.getName() !== 'layout').indexOf(c);\n        ids.unshift(id);\n        c = parent;\n      }\n      if (current.getName() === 'page') {\n        // make sure that the join ends with '_'\n        ids.push('');\n      }\n      return ids.join('_');\n    },\n\n    // overridden\n    clone: function() {\n      return new cv.ui.manager.model.XmlElement(this._node.cloneNode(true), this.getSchemaElement(), this.getEditor());\n    }\n  },\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._node = null;\n    this._schema = null;\n    this._initialAttributes = null;\n    this.__addableChildren = null;\n    this._disposeObjects('_schemaElement');\n  }\n});\n"
  ]
}