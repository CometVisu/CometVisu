{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/tree/FileSystem.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "ui",
    "core",
    "Widget",
    "include",
    "cv",
    "manager",
    "upload",
    "MDragUpload",
    "construct",
    "rootFolder",
    "_setLayout",
    "layout",
    "Grow",
    "setRootFolder",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onEnableTree",
    "statics",
    "MIMETYPES",
    "getMimetypeFromSuffix",
    "suffix",
    "Object",
    "keys",
    "find",
    "mime",
    "isAccepted",
    "mimetype",
    "prototype",
    "hasOwnProperty",
    "call",
    "events",
    "properties",
    "check",
    "apply",
    "selectedNode",
    "nullable",
    "members",
    "__selectionTimer",
    "__doubleTapWaitingTime",
    "__ignoreSelectionChange",
    "_replacementManager",
    "reload",
    "tree",
    "getChildControl",
    "openPaths",
    "getOpenNodes",
    "map",
    "node",
    "getFullPath",
    "root",
    "getModel",
    "refresh",
    "setOpen",
    "forEach",
    "openPath",
    "path",
    "_applyRootFolder",
    "value",
    "setModel",
    "load",
    "setHideRoot",
    "_applySelectedNode",
    "contextMenu",
    "contextmenu",
    "GlobalFileItem",
    "getInstance",
    "configure",
    "setContextMenu",
    "setSelection",
    "getSelection",
    "replace",
    "_onDblTapTreeSelection",
    "sel",
    "getSelectedNode",
    "stop",
    "getType",
    "fireDataEvent",
    "_onChangeTreeSelection",
    "length",
    "getItem",
    "setSelectedNode",
    "Timer",
    "once",
    "resetContextMenu",
    "resetSelectedNode",
    "_onFsItemRightClick",
    "ev",
    "widget",
    "getTarget",
    "VirtualFsItem",
    "setEnabled",
    "getData",
    "_createChildControlImpl",
    "id",
    "control",
    "VirtualTree",
    "set",
    "selectionMode",
    "minWidth",
    "showTopLevelOpenCloseIcons",
    "model",
    "Preferences",
    "bind",
    "converter",
    "setDelegate",
    "createItem",
    "item",
    "addListener",
    "bindItem",
    "controller",
    "index",
    "bindProperty",
    "bindPropertyReverse",
    "_add",
    "_createMDragUploadChildControlImpl",
    "destruct",
    "unsubscribe",
    "_disposeObjects",
    "FileSystem"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* FileSystem.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Shows filesystem content in a tree.\n */\nqx.Class.define('cv.ui.manager.tree.FileSystem', {\n  extend: qx.ui.core.Widget,\n  include: [\n    cv.ui.manager.upload.MDragUpload\n  ],\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function (rootFolder) {\n    this.base(arguments);\n    this._setLayout(new qx.ui.layout.Grow());\n    this.setRootFolder(rootFolder);\n\n    qx.event.message.Bus.subscribe('cv.manager.tree.enable', this._onEnableTree, this);\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    MIMETYPES: {\n      'text/xml': 'xml',\n      'application/xml': 'xml',\n      'text/javascript': 'js',\n      'application/x-httpd-php': 'php',\n      'text/css': 'css',\n      'image/png': 'png',\n      'image/svg+xml': 'svg',\n      'text/plain': ''\n    },\n\n    getMimetypeFromSuffix: function (suffix) {\n      return Object.keys(this.MIMETYPES).find(function (mime) {\n        return this.MIMETYPES[mime] === suffix;\n      }, this);\n    },\n\n    isAccepted: function (mimetype) {\n      return Object.prototype.hasOwnProperty.call(this.MIMETYPES, mimetype);\n    }\n  },\n\n  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    'changeSelection': 'qx.event.type.Data'\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    // appearance: {\n    //   refine: true,\n    //   init: 'cv-filesystem'\n    // },\n\n    rootFolder: {\n      check: 'cv.ui.manager.model.FileItem',\n      apply: '_applyRootFolder'\n    },\n\n    selectedNode: {\n      check: 'cv.ui.manager.model.FileItem',\n      apply: '_applySelectedNode',\n      nullable: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __selectionTimer: null,\n    __doubleTapWaitingTime: 500,\n    __ignoreSelectionChange: false,\n    _replacementManager: null,\n\n    reload: function () {\n      const tree = this.getChildControl('tree');\n      const openPaths = tree.getOpenNodes().map(function (node) {\n        return node.getFullPath();\n      });\n      const root = tree.getModel();\n      root.reload(function () {\n        this.getChildControl('tree').refresh();\n        root.setOpen(true);\n        openPaths.forEach(this.openPath, this);\n      }, this);\n    },\n\n    openPath: function (path) {\n      const root = this.getChildControl('tree').getModel();\n      if (path === '.') {\n        root.setOpen(true);\n      } else {\n        root.setOpen(true);\n        root.openPath(path);\n      }\n    },\n\n    refresh: function () {\n      this.getChildControl('tree').refresh();\n    },\n\n    _applyRootFolder: function (value) {\n      if (value) {\n        const tree = this.getChildControl('tree');\n        tree.setModel(value);\n        value.load(function () {\n          tree.setHideRoot(true);\n        }, this);\n      }\n    },\n\n    _applySelectedNode: function (value) {\n      const tree = this.getChildControl('tree');\n      const contextMenu = cv.ui.manager.contextmenu.GlobalFileItem.getInstance();\n      contextMenu.configure(value);\n      if (value) {\n        tree.setContextMenu(contextMenu);\n      }\n    },\n\n    setSelection : function (node) {\n      this.getChildControl('tree').getSelection().replace([node]);\n    },\n\n    _onDblTapTreeSelection: function () {\n      const sel = this.getSelectedNode();\n      if (sel) {\n        if (this.__selectionTimer) {\n          this.__selectionTimer.stop();\n        }\n        // only files show a different behaviour when double-clicked (permanent vs. preview mode)\n        if (sel.getType() === 'file') {\n          this.fireDataEvent('changeSelection', {\n            'node': sel,\n            'mode': 'dbltap'\n          });\n        }\n      }\n    },\n\n    _onChangeTreeSelection: function () {\n      if (this.__selectionTimer) {\n        this.__selectionTimer.stop();\n      }\n      if (this.__ignoreSelectionChange === true) {\n        return;\n      }\n      const tree = this.getChildControl('tree');\n      const sel = tree.getSelection();\n      if (sel.length > 0) {\n        const node = sel.getItem(0);\n        this.setSelectedNode(node);\n        // wait for double tap\n        if (node.getType() === 'file') {\n          this.__selectionTimer = qx.event.Timer.once(function () {\n            this.fireDataEvent('changeSelection', {\n              'node': this.getSelectedNode(),\n              'mode': 'tap'\n            });\n            this.__selectionTimer = null;\n          }, this, this.__doubleTapWaitingTime);\n        } else {\n          this.fireDataEvent('changeSelection', {\n            'node': node,\n            'mode': 'tap'\n          });\n        }\n      } else {\n        tree.resetContextMenu();\n        this.resetSelectedNode();\n      }\n    },\n\n    _onFsItemRightClick: function (ev) {\n      const tree = this.getChildControl('tree');\n      const widget = ev.getTarget();\n      if (widget instanceof cv.ui.manager.tree.VirtualFsItem) {\n        const node = widget.getModel();\n        if (node) {\n          this.__ignoreSelectionChange = true;\n          tree.getSelection().replace([node]);\n          this.setSelectedNode(node);\n          this.fireDataEvent('changeSelection', {\n            'node': node,\n            'mode': 'contextmenu'\n          });\n          this.__ignoreSelectionChange = false;\n        }\n      }\n    },\n\n    /**\n     * Handle message on 'cv.manager.tree.enable' topic.\n     * @param ev {Event}\n     * @protected\n     */\n    _onEnableTree: function (ev) {\n      this.getChildControl('tree').setEnabled(ev.getData());\n    },\n\n    // overridden\n    _createChildControlImpl : function(id) {\n      let control;\n\n      switch (id) {\n         case 'tree':\n           control = new qx.ui.tree.VirtualTree(null, 'name', 'children');\n           control.set({\n             selectionMode: 'single',\n             minWidth: 250,\n             showTopLevelOpenCloseIcons: true\n           });\n           cv.ui.manager.model.Preferences.getInstance().bind('quickPreview', control, 'openMode', {\n             converter: function (value) {\n               return value ? 'tap' : 'dbltap';\n             }\n           });\n           control.setDelegate({\n             createItem: function () {\n               const item = new cv.ui.manager.tree.VirtualFsItem();\n               item.addListener('dbltap', this._onDblTapTreeSelection, this);\n               item.addListener('contextmenu', this._onFsItemRightClick, this);\n               return item;\n             }.bind(this),\n\n             // Bind properties from the item to the tree-widget and vice versa\n             bindItem : function(controller, item, index) {\n               controller.bindProperty('', 'model', null, item, index);\n               controller.bindPropertyReverse('open', 'open', null, item, index);\n               controller.bindProperty('open', 'open', null, item, index);\n               controller.bindProperty('readable', 'enabled', null, item, index);\n               controller.bindProperty('icon', 'icon', null, item, index);\n               controller.bindProperty('editing', 'editing', null, item, index);\n             }\n           });\n           control.getSelection().addListener('change', this._onChangeTreeSelection, this);\n           this._add(control);\n           break;\n       }\n\n       if (!control) {\n         control = this._createMDragUploadChildControlImpl(id);\n       }\n\n       return control || this.base(arguments, id);\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    qx.event.message.Bus.unsubscribe('cv.manager.tree.enable', this._onEnableTree, this);\n\n    this._disposeObjects('_dateFormat', '_timeFormat', '_replacementManager');\n  }\n});\n"
  ]
}