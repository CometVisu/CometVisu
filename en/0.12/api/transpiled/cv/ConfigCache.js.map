{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/ConfigCache.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "_cacheKey",
    "_parseCacheData",
    "_valid",
    "dump",
    "xml",
    "core",
    "Environment",
    "get",
    "config",
    "JSON",
    "parse",
    "stringify",
    "cv",
    "Config",
    "configSettings",
    "model",
    "data",
    "Model",
    "getInstance",
    "save",
    "hash",
    "toHash",
    "VERSION",
    "Version",
    "REV",
    "getWidgetDataModel",
    "addresses",
    "getAddressList",
    "localStorage",
    "setItem",
    "configSuffix",
    "document",
    "querySelector",
    "innerHTML",
    "restore",
    "body",
    "cache",
    "getData",
    "mappings",
    "Object",
    "keys",
    "forEach",
    "name",
    "mapping",
    "formulaSource",
    "formula",
    "Function",
    "setWidgetDataModel",
    "setAddressList",
    "widgetsToInitialize",
    "filter",
    "widgetId",
    "$$initOnCacheLoad",
    "length",
    "TemplateEngine",
    "addListenerOnce",
    "widgetData",
    "ui",
    "structure",
    "WidgetFactory",
    "createInstance",
    "$$type",
    "ConfigCache",
    "getBody",
    "key",
    "getItem",
    "isCached",
    "cacheVersion",
    "log",
    "Logger",
    "debug",
    "isValid",
    "hashCode",
    "XMLSerializer",
    "serializeToString",
    "clear",
    "removeItem",
    "string",
    "Array",
    "prototype",
    "reduce",
    "split",
    "a",
    "b",
    "charCodeAt",
    "i",
    "l",
    "character"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* ConfigCache.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Handles caches for cometvisu configs\n *\n * @author Tobias Br√§utigam\n * @since 0.10.0\n */\nqx.Class.define('cv.ConfigCache', {\n  type: \"static\",\n  \n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    _cacheKey : \"data\",\n    _parseCacheData : null,\n    _valid : null,\n    \n    dump : function(xml) {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return;\n      }\n      var config = JSON.parse(JSON.stringify(cv.Config.configSettings)); // deep copy\n      var model = cv.data.Model.getInstance();\n      this.save(this._cacheKey, {\n        hash: this.toHash(xml),\n        VERSION: cv.Version.VERSION,\n        REV: cv.Version.REV,\n        data: model.getWidgetDataModel(),\n        addresses: model.getAddressList(),\n        configSettings: config\n      });\n      localStorage.setItem(cv.Config.configSuffix+\".body\", document.querySelector('body').innerHTML);\n    },\n\n    restore: function() {\n      var body = document.querySelector(\"body\");\n      var model = cv.data.Model.getInstance();\n      var cache = this.getData();\n      cv.Config.configSettings = cache.configSettings;\n      // restore formulas\n      if (cv.Config.configSettings.mappings) {\n        Object.keys(cv.Config.configSettings.mappings).forEach(function (name) {\n          var mapping = cv.Config.configSettings.mappings[name];\n          if (mapping && mapping.formulaSource) {\n            mapping.formula = new Function('x', 'var y;' + mapping.formulaSource + '; return y;'); // jshint ignore:line\n          }\n        }, this);\n      }\n      model.setWidgetDataModel(cache.data);\n      model.setAddressList(cache.addresses);\n      var widgetsToInitialize = Object.keys(cache.data).filter(function (widgetId) {\n        return cache.data[widgetId].$$initOnCacheLoad === true;\n      });\n      if (widgetsToInitialize.length > 0) {\n        cv.TemplateEngine.getInstance().addListenerOnce('changeReady', function () {\n          widgetsToInitialize.forEach(function (widgetId) {\n            var widgetData = cache.data[widgetId];\n            cv.ui.structure.WidgetFactory.createInstance(widgetData.$$type, widgetData);\n          })\n        }, this);\n      }\n      body.innerHTML = cv.ConfigCache.getBody();\n    },\n    \n    save: function(key, data) {\n      if (qx.core.Environment.get(\"html.storage.local\") === true) {\n        localStorage.setItem(cv.Config.configSuffix + \".\" + key, JSON.stringify(data));\n      }\n    },\n    \n    getBody: function() {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return null;\n      }\n      return localStorage.getItem(cv.Config.configSuffix + \".body\");\n    },\n    \n    getData: function(key) {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return null;\n      }\n      if (!this._parseCacheData) {\n        this._parseCacheData = JSON.parse(localStorage.getItem(cv.Config.configSuffix + \".\" + this._cacheKey));\n      }\n      if (!this._parseCacheData) {\n        return null;\n      }\n      if (key) {\n        return this._parseCacheData[key];\n      } else {\n        return this._parseCacheData;\n      }\n    },\n    \n    /**\n     * Returns true if there is an existing cache for the current config file\n     */\n    isCached: function() {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return false;\n      }\n      if (localStorage.getItem(cv.Config.configSuffix + \".\" + this._cacheKey) !== null) {\n        // compare versions\n        var cacheVersion = this.getData(\"VERSION\") + '|' + this.getData('REV');\n        qx.log.Logger.debug(this, \"Cached version: \"+cacheVersion+\", CV-Version: \"+cv.Version.VERSION + '|' + cv.Version.REV);\n        return (cacheVersion === cv.Version.VERSION + '|' + cv.Version.REV);\n      } else {\n        return false;\n      }\n    },\n    \n    isValid: function(xml) {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return false;\n      }\n      // cache the result, as the config stays the same until next reload\n      if (this._valid === null) {\n        var hash = this.toHash(xml);\n        qx.log.Logger.debug(this, \"Current hash: '\"+hash+\"', cached hash: '\"+this.getData(\"hash\")+\"'\");\n        this._valid = hash === this.getData(\"hash\");\n      }\n      return this._valid;\n    },\n    \n    toHash: function(xml) {\n      return this.hashCode((new XMLSerializer()).serializeToString(xml));\n    },\n    \n    clear: function(configSuffix) {\n      if (qx.core.Environment.get(\"html.storage.local\") === false) {\n        return;\n      }\n      configSuffix = configSuffix || cv.Config.configSuffix;\n      localStorage.removeItem(configSuffix+\".\"+this._cacheKey);\n      localStorage.removeItem(configSuffix+\".body\");\n    },\n    \n    /**\n     * @see http://stackoverflow.com/q/7616461/940217\n     * @return {number}\n     */\n    hashCode: function(string){\n      if (Array.prototype.reduce){\n        return string.split(\"\").reduce(function(a,b){a=((a<<5)-a)+b.charCodeAt(0);return a&a;},0);\n      }\n      var hash = 0;\n      if (string.length === 0) {\n        return hash;\n      }\n      for (var i = 0, l = string.length; i < l; i++) {\n        var character  = string.charCodeAt(i);\n        hash  = ((hash<<5)-hash)+character;\n        hash = hash & hash; // Convert to 32bit integer\n      }\n      return hash;\n    }\n  }\n});\n"
  ]
}