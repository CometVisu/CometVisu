{
  "version": 3,
  "sources": [
    "/home/travis/build/CometVisu/CometVisu/source/class/cv/plugins/Clock.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "AbstractWidget",
    "include",
    "common",
    "Update",
    "construct",
    "props",
    "value",
    "Date",
    "statics",
    "parse",
    "xml",
    "path",
    "flavour",
    "pageType",
    "data",
    "parser",
    "WidgetParser",
    "parseElement",
    "parseFormat",
    "parseAddress",
    "members",
    "_getInnerDomString",
    "_onDomReady",
    "args",
    "arguments",
    "$actor",
    "$",
    "getActor",
    "svg",
    "loadURL",
    "util",
    "ResourceManager",
    "getInstance",
    "toUri",
    "onLoad",
    "root",
    "getElementById",
    "draggable",
    "bind",
    "type",
    "actor",
    "dragHelper",
    "dragAction",
    "Object",
    "getOwnPropertyNames",
    "getAddress",
    "filter",
    "address",
    "Model",
    "isReadAddress",
    "forEach",
    "_update",
    "getValue",
    "getHours",
    "getMinutes",
    "initListeners",
    "isDataAlreadyHandled",
    "element",
    "getDomElement",
    "defaultValueHandling",
    "querySelector",
    "time",
    "split",
    "hourElem",
    "minuteElem",
    "undefined",
    "setAttribute",
    "console",
    "error",
    "event",
    "$container",
    "$svg",
    "find",
    "x",
    "originalEvent",
    "pageX",
    "offset",
    "left",
    "y",
    "pageY",
    "top",
    "angle",
    "Math",
    "atan2",
    "PI",
    "minutes",
    "oldHours",
    "pm",
    "hours",
    "floor",
    "setDate",
    "getDate",
    "setHours",
    "setMinutes",
    "round",
    "oldMinutes",
    "attr",
    "addr",
    "TemplateEngine",
    "visu",
    "write",
    "Transform",
    "encode",
    "defer",
    "addHandler",
    "plugins",
    "Clock",
    "WidgetFactory",
    "registerClass",
    "loader",
    "ScriptLoader",
    "addScripts"
  ],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,EAAAA,EAAE,CAACC,SAAH,CAAaC,oBAAb,CAAkCC,aAAlC;;AAAA;;;;;;;;;;;;;;;;;;;AAoBA;;;AAGAH,EAAAA,EAAE,CAACI,KAAH,CAASC,MAAT,CAAgB,kBAAhB,EAAoC;AAClCC,IAAAA,MAAM,EAAEC,EAAE,CAACC,EAAH,CAAMC,SAAN,CAAgBC,cADU;AAElCC,IAAAA,OAAO,EAAE,CAACJ,EAAE,CAACC,EAAH,CAAMI,MAAN,CAAaC,MAAd,CAFyB;;AAIlC;;;;;AAKAC,IAAAA,SAAS,EAAE,mBAAUC,KAAV,EAAiB;AAC1BA,MAAAA,KAAK,CAACC,KAAN,GAAc,IAAIC,IAAJ,EAAd;AACA,4DAAqBF,KAArB;AACD,KAZiC;;AAclC;;;;;AAKAG,IAAAA,OAAO,EAAE;AACP;;;;;;;;;;AAUAC,MAAAA,KAAK,EAAE,eAAUC,GAAV,EAAeC,IAAf,EAAqBC,OAArB,EAA8BC,QAA9B,EAAwC;AAC7C,YAAIC,IAAI,GAAGjB,EAAE,CAACkB,MAAH,CAAUC,YAAV,CAAuBC,YAAvB,CAAoC,IAApC,EAA0CP,GAA1C,EAA+CC,IAA/C,EAAqDC,OAArD,EAA8DC,QAA9D,CAAX;AACAhB,QAAAA,EAAE,CAACkB,MAAH,CAAUC,YAAV,CAAuBE,WAAvB,CAAmCR,GAAnC,EAAwCC,IAAxC;AACAd,QAAAA,EAAE,CAACkB,MAAH,CAAUC,YAAV,CAAuBG,YAAvB,CAAoCT,GAApC,EAAyCC,IAAzC;AACA,eAAOG,IAAP;AACD;AAhBM,KAnByB;;AAsClC;;;;;AAKAM,IAAAA,OAAO,EAAE;AACPC,MAAAA,kBAAkB,EAAE,8BAAY;AAC9B,eAAO,8DAAP;AACD,OAHM;AAKPC,MAAAA,WAAW,EAAE,uBAAY;AACvB;AACA,YAAIC,IAAI,GAAGC,SAAX;AACA,YAAIC,MAAM,GAAGC,CAAC,CAAC,KAAKC,QAAL,EAAD,CAAd;AACAF,QAAAA,MAAM,CAACG,GAAP,CAAW;AACTC,UAAAA,OAAO,EAAEvC,EAAE,CAACwC,IAAH,CAAQC,eAAR,CAAwBC,WAAxB,GAAsCC,KAAtC,CAA4C,8BAA5C,CADA;AAETC,UAAAA,MAAM,EAAE,UAAUN,GAAV,EAAe;AACrBF,YAAAA,CAAC,CAACE,GAAG,CAACO,IAAJ,GAAWC,cAAX,CAA0B,aAA1B,CAAD,CAAD,CACGC,SADH,GAEGC,IAFH,CAEQ,MAFR,EAEgB;AAACC,cAAAA,IAAI,EAAE,MAAP;AAAeC,cAAAA,KAAK,EAAEf;AAAtB,aAFhB,EAE+C,KAAKgB,UAAL,CAAgBH,IAAhB,CAAqB,IAArB,CAF/C,EAGGA,IAHH,CAGQ,UAHR,EAGoB;AAACE,cAAAA,KAAK,EAAEf;AAAR,aAHpB,EAGqC,KAAKiB,UAAL,CAAgBJ,IAAhB,CAAqB,IAArB,CAHrC;AAIAZ,YAAAA,CAAC,CAACE,GAAG,CAACO,IAAJ,GAAWC,cAAX,CAA0B,eAA1B,CAAD,CAAD,CACGC,SADH,GAEGC,IAFH,CAEQ,MAFR,EAEgB;AAACC,cAAAA,IAAI,EAAE,QAAP;AAAiBC,cAAAA,KAAK,EAAEf;AAAxB,aAFhB,EAEiD,KAAKgB,UAAL,CAAgBH,IAAhB,CAAqB,IAArB,CAFjD,EAGGA,IAHH,CAGQ,UAHR,EAGoB;AAACE,cAAAA,KAAK,EAAEf;AAAR,aAHpB,EAGqC,KAAKiB,UAAL,CAAgBJ,IAAhB,CAAqB,IAArB,CAHrC,EALqB,CAUrB;;AACA;;AAEAK,YAAAA,MAAM,CAACC,mBAAP,CAA2B,KAAKC,UAAL,EAA3B,EACGC,MADH,CACU,UAAUC,OAAV,EAAmB;AACzB,qBAAOlD,EAAE,CAACiB,IAAH,CAAQkC,KAAR,CAAcC,aAAd,CAA4B,KAAKJ,UAAL,GAAkBE,OAAlB,CAA5B,CAAP;AACD,aAFO,CAENT,IAFM,CAED,IAFC,CADV,EAIGY,OAJH,CAIW,UAASH,OAAT,EAAkB;AACzB,mBAAKI,OAAL,CAAaJ,OAAb,EAAsB,KAAKK,QAAL,GAAgBC,QAAhB,KAA6B,GAA7B,GAAmC,KAAKD,QAAL,GAAgBE,UAAhB,EAAnC,GAAkE,KAAxF,EAA+F,IAA/F;AACH,aAND,EAMG,IANH;AAOD,WApBO,CAoBNhB,IApBM,CAoBD,IApBC;AAFC,SAAX;AAwBD,OAjCM;AAmCP;AACAiB,MAAAA,aAAa,EAAE,yBAAY,CAAE,CApCtB;AAsCP;AACAJ,MAAAA,OAAO,EAAE,iBAAUJ,OAAV,EAAmBjC,IAAnB,EAAyB0C,oBAAzB,EAA+C;AACtD,YAAIC,OAAO,GAAG,KAAKC,aAAL,EAAd;AACA,YAAIpD,KAAK,GAAGkD,oBAAoB,GAAG1C,IAAH,GAAU,KAAK6C,oBAAL,CAA0BZ,OAA1B,EAAmCjC,IAAnC,CAA1C;AACA,YAAIc,GAAG,GAAG6B,OAAO,CAACG,aAAR,CAAsB,KAAtB,CAAV;AACA,YAAIC,IAAI,GAAGvD,KAAK,CAACwD,KAAN,CAAY,GAAZ,CAAX;AACA,YAAIC,QAAQ,GAAGnC,GAAG,CAACgC,aAAJ,CAAkB,OAAlB,CAAf;AACA,YAAII,UAAU,GAAGpC,GAAG,CAACgC,aAAJ,CAAkB,SAAlB,CAAjB;;AACA,YAAIG,QAAQ,KAAKE,SAAb,IAA0BD,UAAU,KAAKC,SAA7C,EAAyD;AACvDF,UAAAA,QAAQ,CAACG,YAAT,CAAsB,WAAtB,EAAmC,aAAcL,IAAI,CAAC,CAAD,CAAJ,GAAU,EAAX,GAAiB,GAAjB,GAAuB,EAAvB,GAA4BA,IAAI,CAAC,CAAD,CAAJ,GAAU,EAAV,GAAe,EAAxD,IAA8D,SAAjG;AACAG,UAAAA,UAAU,CAACE,YAAX,CAAwB,WAAxB,EAAqC,YAAaL,IAAI,CAAC,CAAD,CAAJ,GAAU,CAAvB,GAA4B,SAAjE;AACD,SAHD,MAGO;AACLM,UAAAA,OAAO,CAACC,KAAR,CAAc,yEAAd;AACD;AACF,OApDM;AAsDP3B,MAAAA,UAAU,EAAE,oBAAU4B,KAAV,EAAiB;AAC3B,YAAIC,UAAU,GAAGD,KAAK,CAACvD,IAAN,CAAW0B,KAA5B;AACA,YAAI+B,IAAI,GAAGD,UAAU,CAACE,IAAX,CAAgB,KAAhB,CAAX;AAEA,YAAIC,CAAC,GAAGJ,KAAK,CAACK,aAAN,CAAoBC,KAApB,GAA4BJ,IAAI,CAACK,MAAL,GAAcC,IAA1C,GAAiD,EAAzD;AACA,YAAIC,CAAC,GAAG,MAAMT,KAAK,CAACK,aAAN,CAAoBK,KAApB,GAA4BR,IAAI,CAACK,MAAL,GAAcI,GAAhD,CAAR;AACA,YAAIC,KAAK,GAAG,CAACC,IAAI,CAACC,KAAL,CAAWV,CAAX,EAAcK,CAAd,IAAmB,GAAnB,GAAyBI,IAAI,CAACE,EAA9B,GAAmC,GAApC,IAA2C,GAAvD;AACA,YAAIvB,IAAI,GAAG,KAAKT,QAAL,EAAX;AACA,YAAIiC,OAAJ;;AACA,YAAIhB,KAAK,CAACvD,IAAN,CAAWyB,IAAX,KAAoB,MAAxB,EAAgC;AAC9B,cAAI+C,QAAQ,GAAGzB,IAAI,CAACR,QAAL,EAAf;AACA,cAAIkC,EAAE,GAAGD,QAAQ,IAAI,EAArB;AACA,cAAIE,KAAK,GAAGN,IAAI,CAACO,KAAL,CAAWR,KAAK,GAAG,EAAnB,CAAZ;AACAI,UAAAA,OAAO,GAAIJ,KAAK,GAAG,EAAT,GAAe,CAAzB;;AAEA,cAAIK,QAAQ,GAAG,EAAX,GAAgB,CAAhB,IAAqBE,KAAK,GAAG,CAAjC,EAAoC;AAClC,gBAAID,EAAJ,EAAQ;AACNA,cAAAA,EAAE,GAAG,KAAL;AACA1B,cAAAA,IAAI,CAAC6B,OAAL,CAAa7B,IAAI,CAAC8B,OAAL,KAAiB,CAA9B;AACD,aAHD,MAIK;AACHJ,cAAAA,EAAE,GAAG,IAAL;AACD;AACF,WARD,MAQO,IAAIC,KAAK,GAAG,CAAR,IAAaF,QAAQ,GAAG,EAAX,GAAgB,CAAjC,EAAoC;AACzC,gBAAIC,EAAJ,EAAQ;AACNA,cAAAA,EAAE,GAAG,KAAL;AACD,aAFD,MAGK;AACHA,cAAAA,EAAE,GAAG,IAAL;AACA1B,cAAAA,IAAI,CAAC6B,OAAL,CAAa7B,IAAI,CAAC8B,OAAL,KAAiB,CAA9B;AACD;AACF;;AAED9B,UAAAA,IAAI,CAAC+B,QAAL,CAAcJ,KAAK,GAAGD,EAAE,GAAG,EAA3B;AACA1B,UAAAA,IAAI,CAACgC,UAAL,CAAgBR,OAAhB;AACD,SA1BD,MA0BO;AAAE;AACPA,UAAAA,OAAO,GAAGH,IAAI,CAACY,KAAL,CAAWb,KAAK,GAAG,CAAnB,CAAV;AACA,cAAIc,UAAU,GAAGlC,IAAI,CAACP,UAAL,EAAjB;;AAEA,cAAIyC,UAAU,GAAG,EAAb,IAAmBV,OAAO,GAAG,EAAjC,EAAqC;AACnCxB,YAAAA,IAAI,CAAC+B,QAAL,CAAc/B,IAAI,CAACR,QAAL,KAAkB,CAAhC;AACD,WAFD,MAGK,IAAIgC,OAAO,GAAG,EAAV,IAAgBU,UAAU,GAAG,EAAjC,EAAqC;AACxClC,YAAAA,IAAI,CAAC+B,QAAL,CAAc/B,IAAI,CAACR,QAAL,KAAkB,CAAhC;AACD;;AACDQ,UAAAA,IAAI,CAACgC,UAAL,CAAgBR,OAAhB;AACD;;AACDf,QAAAA,UAAU,CAACE,IAAX,CAAgB,OAAhB,EAAyBwB,IAAzB,CAA8B,WAA9B,EAA2C,aAAcnC,IAAI,CAACR,QAAL,KAAkB,EAAnB,GAAyB,GAAzB,GAA+B,EAA/B,GAAoCQ,IAAI,CAACP,UAAL,KAAoB,EAApB,GAAyB,EAA1E,IAAgF,SAA3H;AACAgB,QAAAA,UAAU,CAACE,IAAX,CAAgB,SAAhB,EAA2BwB,IAA3B,CAAgC,WAAhC,EAA6C,YAAanC,IAAI,CAACP,UAAL,KAAoB,CAAjC,GAAsC,SAAnF;AACD,OAvGM;AAyGPZ,MAAAA,UAAU,EAAE,sBAAY;AACtB,YAAIK,OAAO,GAAG,KAAKF,UAAL,EAAd;;AACA,aAAK,IAAIoD,IAAT,IAAiBlD,OAAjB,EAA0B;AACxB,cAAIA,OAAO,CAACkD,IAAD,CAAP,CAAc,CAAd,MAAqB,IAAzB,EAA+B;AAAE;AAAW,WADpB,CACqB;;;AAC7CpG,UAAAA,EAAE,CAACqG,cAAH,CAAkBlE,WAAlB,GAAgCmE,IAAhC,CAAqCC,KAArC,CAA2CH,IAA3C,EAAiDpG,EAAE,CAACwG,SAAH,CAAaC,MAAb,CAAoBvD,OAAO,CAACkD,IAAD,CAAP,CAAc,CAAd,CAApB,EAAsC,KAAK7C,QAAL,EAAtC,CAAjD;AACD;AACF;AA/GM,KA3CyB;AA6JlCmD,IAAAA,KAAK,EAAE,eAAS/F,OAAT,EAAkB;AACvBX,MAAAA,EAAE,CAACkB,MAAH,CAAUC,YAAV,CAAuBwF,UAAvB,CAAkC,OAAlC,EAA2C3G,EAAE,CAAC4G,OAAH,CAAWC,KAAtD;AACA7G,MAAAA,EAAE,CAACC,EAAH,CAAMC,SAAN,CAAgB4G,aAAhB,CAA8BC,aAA9B,CAA4C,OAA5C,EAAqDpG,OAArD;AACA,UAAIqG,MAAM,GAAGhH,EAAE,CAACiC,IAAH,CAAQgF,YAAR,CAAqB9E,WAArB,EAAb;AAIO;AACL6E,QAAAA,MAAM,CAACE,UAAP,CAAkB,CAAC,gCAAD,EAAmC,iCAAnC,CAAlB,EAAyF,CAAC,CAAD,CAAzF;AACD;AACF;AAvKiC,GAApC;AAvBAlH,EAAAA,EAAE,CAAC4G,OAAH,CAAWC,KAAX,CAAiBjH,aAAjB,GAAiCA,aAAjC",
  "sourcesContent": [
    "/* Clock.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * @asset(plugins/clock/*)\n */\nqx.Class.define('cv.plugins.Clock', {\n  extend: cv.ui.structure.AbstractWidget,\n  include: [cv.ui.common.Update],\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function (props) {\n    props.value = new Date();\n    this.base(arguments, props);\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    /**\n     * Parses the widgets XML configuration and extracts the given information\n     * to a simple key/value map.\n     *\n     * @param xml {Element} XML-Element\n     * @param path {String} internal path of the widget\n     * @param flavour {String} Flavour of the widget\n     * @param pageType {String} Page type (2d, 3d, ...)\n     * @return {Map} extracted data from config element as key/value map\n     */\n    parse: function (xml, path, flavour, pageType) {\n      var data = cv.parser.WidgetParser.parseElement(this, xml, path, flavour, pageType);\n      cv.parser.WidgetParser.parseFormat(xml, path);\n      cv.parser.WidgetParser.parseAddress(xml, path);\n      return data;\n    }\n  },\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    _getInnerDomString: function () {\n      return '<div class=\"actor\" style=\"width:200px; height: 200px\"></div>';\n    },\n\n    _onDomReady: function () {\n      //this.base(arguments);\n      var args = arguments;\n      var $actor = $(this.getActor());\n      $actor.svg({\n        loadURL: qx.util.ResourceManager.getInstance().toUri('plugins/clock/clock_pure.svg'),\n        onLoad: function (svg) {\n          $(svg.root().getElementById('HotSpotHour'))\n            .draggable()\n            .bind('drag', {type: 'hour', actor: $actor}, this.dragHelper.bind(this))\n            .bind('dragstop', {actor: $actor}, this.dragAction.bind(this));\n          $(svg.root().getElementById('HotSpotMinute'))\n            .draggable()\n            .bind('drag', {type: 'minute', actor: $actor}, this.dragHelper.bind(this))\n            .bind('dragstop', {actor: $actor}, this.dragAction.bind(this));\n\n          // call parents _onDomReady method\n          this.base(args);\n\n          Object.getOwnPropertyNames(this.getAddress())\n            .filter(function (address) {\n              return cv.data.Model.isReadAddress(this.getAddress()[address]);\n            }.bind(this))\n            .forEach(function(address) {\n              this._update(address, this.getValue().getHours() + ':' + this.getValue().getMinutes() + ':00', true);\n          }, this);\n        }.bind(this)\n      });\n    },\n\n    // overridden\n    initListeners: function () {},\n\n    // overidden\n    _update: function (address, data, isDataAlreadyHandled) {\n      var element = this.getDomElement();\n      var value = isDataAlreadyHandled ? data : this.defaultValueHandling(address, data);\n      var svg = element.querySelector('svg');\n      var time = value.split(':');\n      var hourElem = svg.querySelector('#Hour');\n      var minuteElem = svg.querySelector('#Minute');\n      if( hourElem !== undefined && minuteElem !== undefined ) {\n        hourElem.setAttribute(\"transform\", 'rotate(' + ((time[0] % 12) * 360 / 12 + time[1] * 30 / 60) + ',50,50)');\n        minuteElem.setAttribute(\"transform\", 'rotate(' + (time[1] * 6) + ',50,50)');\n      } else {\n        console.error('Error: trying to update unknown clock SVG elements #Hour and/or #Minute');\n      }\n    },\n\n    dragHelper: function (event) {\n      var $container = event.data.actor;\n      var $svg = $container.find('svg');\n\n      var x = event.originalEvent.pageX - $svg.offset().left - 50;\n      var y = 50 - (event.originalEvent.pageY - $svg.offset().top);\n      var angle = (Math.atan2(x, y) * 180 / Math.PI + 360) % 360;\n      var time = this.getValue();\n      var minutes;\n      if (event.data.type === 'hour') {\n        var oldHours = time.getHours();\n        var pm = oldHours >= 12;\n        var hours = Math.floor(angle / 30);\n        minutes = (angle % 30) * 2;\n\n        if (oldHours % 12 > 9 && hours < 3) {\n          if (pm) {\n            pm = false;\n            time.setDate(time.getDate() + 1);\n          }\n          else {\n            pm = true;\n          }\n        } else if (hours > 9 && oldHours % 12 < 3) {\n          if (pm) {\n            pm = false;\n          }\n          else {\n            pm = true;\n            time.setDate(time.getDate() - 1);\n          }\n        }\n\n        time.setHours(hours + pm * 12);\n        time.setMinutes(minutes);\n      } else { // minute\n        minutes = Math.round(angle / 6);\n        var oldMinutes = time.getMinutes();\n\n        if (oldMinutes > 45 && minutes < 15) {\n          time.setHours(time.getHours() + 1);\n        }\n        else if (minutes > 45 && oldMinutes < 15) {\n          time.setHours(time.getHours() - 1);\n        }\n        time.setMinutes(minutes);\n      }\n      $container.find('#Hour').attr('transform', 'rotate(' + ((time.getHours() % 12) * 360 / 12 + time.getMinutes() * 30 / 60) + ',50,50)');\n      $container.find('#Minute').attr('transform', 'rotate(' + (time.getMinutes() * 6) + ',50,50)');\n    },\n\n    dragAction: function () {\n      var address = this.getAddress();\n      for (var addr in address) {\n        if (address[addr][1] === true) { continue; } // skip read only\n        cv.TemplateEngine.getInstance().visu.write(addr, cv.Transform.encode(address[addr][0], this.getValue()));\n      }\n    }\n  },\n\n  defer: function(statics) {\n    cv.parser.WidgetParser.addHandler(\"clock\", cv.plugins.Clock);\n    cv.ui.structure.WidgetFactory.registerClass(\"clock\", statics);\n    var loader = cv.util.ScriptLoader.getInstance();\n\n    if (qx.core.Environment.get('qx.debug')) {\n      loader.addScripts(['resource/libs/jquery-ui.js', 'resource/libs/jquery.svg.js'], [0]);\n    } else {\n      loader.addScripts(['resource/libs/jquery-ui.min.js', 'resource/libs/jquery.svg.min.js'], [0]);\n    }\n  }\n});"
  ]
}