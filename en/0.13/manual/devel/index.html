<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Information for developers &mdash; CometVisu</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_override.css?v=d0aeeef9" />

  
    <link rel="canonical" href="https://www.cometvisu.org/CometVisu/en/0.13/manual/devel/index.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Long polling" href="transport/long-polling.html" />
    <link rel="prev" title="Automated tests" href="../colab/dev/test.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CometVisu
              <img src="../_static/comet_webapp_icon_android_48.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.13.0-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation of the CometVisu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Usage of the CometVisu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration of the CometVisu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../colab/index.html">Help the CometVisu project</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Information for developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics-of-the-software">Basics of the software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#start-behavior">Start Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transport-layers">Transport layers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="transport/long-polling.html">Long polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="transport/sse.html">Server sent events (SSE)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-notification-router">The Notification Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling">Error handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CometVisu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Information for developers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This is the documentation for the current development branch of the CometVisu.
It is possible that some of the described features are not yet available in the current release.</p>
<p>Also there might be lots of errors in this documentation as some parts of the content have been translated
by an online translation service.</p>
</div>
<section id="information-for-developers">
<h1>Information for developers<a class="headerlink" href="#information-for-developers" title="Link to this heading"></a></h1>
<p>This page provides an introduction to the internal context and background of CometVisu and is aimed primarily at developers.</p>
<section id="basics-of-the-software">
<h2>Basics of the software<a class="headerlink" href="#basics-of-the-software" title="Link to this heading"></a></h2>
<p>CometVisu has been built on the <a class="reference external" href="http://www.qooxdoo.org">Qooxdoo framework</a>
since version 0.11. The Qooxdoo Framework offers its own object-oriented class
system (including advanced features such as: interface mixins, class separator,
singletons, simple type-checks for properties, etc.) with which a complex yet
structured software system can be built.</p>
<p>It also provides a full toolchain (Qooxdoo generator) that automatically
resolves class dependencies and builds either developer versions (source
version) or releases (build versions).</p>
<p>Differences in the Javascript support of the different browsers are
automatically compensated and the generator creates different build
versions for the 4 most important browser engines for the releases.</p>
<p>Other Qooxdoo features that CometVisu uses:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.qooxdoo.org/current/pages/development/parts_using.html">Parts</a>:
Parts of the code that are not always needed are offloaded to <em>Parts</em>,
which are reloaded when needed. The CometVisu uses this for plugins
and widget packages (although there is currently only the <em>Pure</em> widget
package, others are possible).</p></li>
</ul>
<p>Since the CometVisu provides its own widgets including layout and
CSS-based design, the complete UI part of Qooxdoo is not used.
This provides its own layout manager and widgets with non-CSS-based
design. However, it would be possible to implement a new Qooxdoo-UI
based widget package, which can be used in parallel.</p>
</section>
<section id="start-behavior">
<h2>Start Behavior<a class="headerlink" href="#start-behavior" title="Link to this heading"></a></h2>
<p>The process of loading the Visu runs according to the CometVisu
protocol in the following steps:</p>
<figure class="align-center" id="id1">
<figcaption>
<p><span class="caption-text">Start communication between CometVisu and backend</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><p>Loading the configuration file <code class="docutils literal notranslate"><span class="pre">visu_config*.xml</span></code></p></li>
<li><p>The server can deliver this file with 2 optional headers
that provide the CometVisu with more information about the backend:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-Name</span></code>: The name of the backend to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-KNXD-Url</span></code>: URL of the knxd login resource</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-MQTT-Url</span></code>: URL of the MQTT login resource</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-OpenHAB-Url</span></code>: Only openHAB: path to the REST-API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-CometVisu-Backend-LoginUrl</span></code>: Deprecated: Path under which the client can log in.</p></li>
</ul>
</li>
<li><p>The CometVisu authenticates itself at the backend (at present
no backend implements a real authentication)</p></li>
<li><p>The backend confirms the authentication and returns information
as JSON:</p>
<p><code class="docutils literal notranslate"><span class="pre">v</span></code>: Is the protocol version</p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code>: Session ID</p>
<p><code class="docutils literal notranslate"><span class="pre">c</span></code>: The optional backend configuration</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;v&quot;</span><span class="p">:</span><span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;s&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;openhab2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="s2">&quot;sse&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;baseURL&quot;</span><span class="p">:</span><span class="s2">&quot;/rest/cv/&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;rrd&quot;</span><span class="p">:</span><span class="s2">&quot;rrdfetch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="s2">&quot;w&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>The CometVisu starts to query the values from the backend,
initially all necessary values and in the second step only
changes of the values are listened to.</p></li>
</ol>
</section>
<section id="transport-layers">
<h2>Transport layers<a class="headerlink" href="#transport-layers" title="Link to this heading"></a></h2>
<p>The transport layers are responsible for communication between CometVisu
and the backend from the moment of the successful login. The main task
is to retrieve values from the backend (read request) and send value
changes to the backend (write request).</p>
<p>Currently CometVisu supports two different transport layers:</p>
<ul class="simple">
<li><p><a class="reference internal" href="transport/long-polling.html#long-polling"><span class="std std-ref">Long polling</span></a>: is used by the default backend</p></li>
<li><p><a class="reference internal" href="transport/sse.html#sse"><span class="std std-ref">Server sent events</span></a>: is used by the openHAB backend</p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="transport/long-polling.html">Long polling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="transport/long-polling.html#reading-inquiries">Reading inquiries</a></li>
<li class="toctree-l2"><a class="reference internal" href="transport/long-polling.html#writing-inquiries">Writing inquiries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transport/sse.html">Server sent events (SSE)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="transport/sse.html#reading-inquiries">Reading inquiries</a></li>
<li class="toctree-l2"><a class="reference internal" href="transport/sse.html#writing-inquiries">Writing inquiries</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Link to this heading"></a></h2>
<p>The CometVisu uses its own caching mechanisms to accelerate the
initial loading. Most of the time is needed to load the XML
configuration file from the server, then parse it and generate
the HTML code that represents the actual Visu in the browser.</p>
<p>Since the content of the configuration file usually rarely
changes, it is wise to not reloading and parsing it each time.
Therefore, after the first parsing, the generated HTML and the
internal data structures are stored in the <em>LocalStorage</em> of
the browser. The next time the Visu is loaded, this data is read
out and the interface is displayed immediately. Only then the Visu
asks the configuration file from the server and compares whether
there has been changes. If this is not the case, the currently
loaded file is discarded, otherwise the parse and save process
is performed again and the data from the cache is discarded.</p>
<p>Caching can be influenced by the URL parameter <a class="reference internal" href="../config/url-params.html#enablecache"><span class="std std-ref">enableCache - Activate Caching</span></a>.</p>
</section>
<section id="the-notification-router">
<h2>The Notification Router<a class="headerlink" href="#the-notification-router" title="Link to this heading"></a></h2>
<p>There is an internal <code class="docutils literal notranslate"><span class="pre">NotificationRouter</span></code> which is used for
different purposes. The main function of this router is to receive
messages and forward them to the right recipient. Possible
receivers are e.g. the <code class="docutils literal notranslate"><span class="pre">NotificationCenter</span></code> and the
<code class="docutils literal notranslate"><span class="pre">PopupHandler</span></code>. Both then take care of displaying the message,
either in the message center (which appears on the right and
displays a list of messages) or as a pop-up.</p>
<p>A message always has a <em>Topic</em>, which serves the thematic
assignment, a title, text and various configuration options.</p>
<p>The following <em>Topics</em> are currently used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv.error</span></code>: generic errors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv.config.error</span></code>: Errors that occurred while reading in the config file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv.state.*</span></code>: Namespace for all in the <a class="reference internal" href="../config/notifications.html#notifications"><span class="std std-ref">notifications</span></a> messages used</p></li>
</ul>
<p>A message receiver (<code class="docutils literal notranslate"><span class="pre">NotificationHandler</span></code>) can now register for one or more such topics:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">cv</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">registerMessageHandler</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;cv.config.error&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;message_attention&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s1">&#39;cv.error&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nx">icon</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;message_attention&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Wildcards are also possible:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">cv</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">registerMessageHandler</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;cv.*&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h2>
<p>The NotificationRouter is also used to display all uncaught errors during the
runtime of the Visu. These errors appear as a pop-up and allow the user to
directly open an issue on Github with a pre-filled form containing the most
important information. This feature is only active in the build versions
(including the releases), and during development, the errors continue to
be displayed on the Javascript console of the browser.</p>
<p>Further errors, depending on the type, are displayed either as a pop-up or
as a message in the message center. An important example would be connection
problems with the backend. These are displayed as long as the problem
persists and disappear automatically once the problem is resolved.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/noticenter_hidden.png"><img alt="../_images/noticenter_hidden.png" src="../_images/noticenter_hidden.png" style="width: 795.9px; height: 556.5px;" /></a>
<figcaption>
<p><span class="caption-text">Closed messaging center with a critical error message</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/NotificationCenter.png"><img alt="../_images/NotificationCenter.png" src="../_images/NotificationCenter.png" style="width: 798.6999999999999px; height: 557.9px;" /></a>
<figcaption>
<p><span class="caption-text">Open news center with a critical error message</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">NotificationRouter</span></code> is also used for the
<a class="reference internal" href="../config/notifications.html#notifications"><span class="std std-ref">notifications</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../colab/dev/test.html" class="btn btn-neutral float-left" title="Automated tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transport/long-polling.html" class="btn btn-neutral float-right" title="Long polling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2024 Christian Mayer and the CometVisu contributers.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <!--
  ~ Copyright (c) 2023, Christian Mayer and the CometVisu contributors.
  ~
  ~ This program is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU General Public License as published by the Free
  ~ Software Foundation; either version 3 of the License, or (at your option)
  ~ any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
  ~ more details.
  ~
  ~ You should have received a copy of the GNU General Public License along
  ~ with this program; if not, write to the Free Software Foundation, Inc.,
  ~ 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA
  ~
  -->

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Version</span>
      v: 0.13.0-dev
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
        <dd><a href="../../../0.10.2|0.10/manual">0.10.2|0.10</a>
        </dd>
        
        <dd><a href="../../../0.11.2|0.11/manual">0.11.2|0.11</a>
        </dd>
        
        <dd><a href="../../../0.12.6|0.12/manual">0.12.6|0.12</a>
        </dd>
        
        <dd><a href="../../../0.13.0-dev|0.13/manual">0.13.0-dev|0.13</a>
        </dd>
        
      </dl>
    </div>
  </div>


</body>
</html>