{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "com",
    "zenesis",
    "upload",
    "AbstractHandler",
    "members",
    "addBlob",
    "filename",
    "blob",
    "params",
    "Error",
    "_createFile",
    "input",
    "id",
    "_getUniqueFileId",
    "value",
    "replace",
    "file",
    "File",
    "_doUpload",
    "iframe",
    "_createIframe",
    "getId",
    "form",
    "_createForm",
    "appendChild",
    "getBrowserObject",
    "self",
    "bom",
    "Event",
    "addNativeListener",
    "evt",
    "parentNode",
    "contentDocument",
    "body",
    "innerHTML",
    "e",
    "response",
    "_getIframeContent",
    "_onCompleted",
    "setTimeout",
    "removeChild",
    "submit",
    "_doCancel",
    "data",
    "getUserData",
    "document",
    "getElementById",
    "setAttribute",
    "doc",
    "contentWindow",
    "dom",
    "Element",
    "create",
    "src",
    "name",
    "element",
    "Style",
    "setStyles",
    "display",
    "enctype",
    "encoding",
    "action",
    "_getUploader",
    "getUploadUrl",
    "method",
    "target",
    "_getMergedParams",
    "el",
    "type",
    "FormHandler"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/qx_packages/johnspackman_UploadMgr_v2_0_0/source/class/com/zenesis/qx/upload/FormHandler.js"
  ],
  "sourcesContent": [
    "/* ***********************************************************************\n\n   UploadMgr - provides an API for uploading one or multiple files\n   with progress feedback (on modern browsers), does not block the user \n   interface during uploads, supports cancelling uploads.\n\n   http://qooxdoo.org\n\n   Copyright:\n     2011 Zenesis Limited, http://www.zenesis.com\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     \n     This software is provided under the same licensing terms as Qooxdoo,\n     please see the LICENSE file in the Qooxdoo project's top-level directory \n     for details.\n     \n     Parts of this code is based on the work by Andrew Valums (andrew@valums.com)\n     and is covered by the GNU GPL and GNU LGPL2 licenses; please see\n     http://valums.com/ajax-upload/.\n\n   Authors:\n * John Spackman (john.spackman@zenesis.com)\n\n ************************************************************************/\n\n/**\n * Implementation of AbstractHandler that uses iframe and form DOM elements to\n * send the file.\n */\n\nqx.Class.define(\"com.zenesis.qx.upload.FormHandler\", {\n  extend: com.zenesis.qx.upload.AbstractHandler,\n\n  members: {\n    /*\n     * @Override\n     */\n    addBlob(filename, blob, params) {\n      throw new Error(\"addBlob is not supported in the FormHandler.\");\n    },\n\n    /*\n     * @Override\n     */\n    _createFile(input) {\n      var id = \"upload-\" + this._getUniqueFileId(),\n        filename = input.value.replace(/.*(\\/|\\\\)/, \"\"),\n        file = new com.zenesis.qx.upload.File(input, filename, id);\n      return file;\n    },\n\n    /*\n     * @Override\n     */\n    _doUpload(file) {\n      var iframe = this._createIframe(file.getId()),\n        form = this._createForm(iframe, file);\n\n      form.appendChild(file.getBrowserObject());\n\n      var self = this;\n\n      qx.bom.Event.addNativeListener(iframe, \"load\", function (evt) {\n        // when we remove iframe from dom the request stops, but in IE\n        // load event fires\n        if (!iframe.parentNode) return;\n\n        // fixing Opera 10.53\n        try {\n          if (\n            iframe.contentDocument &&\n            iframe.contentDocument.body &&\n            iframe.contentDocument.body.innerHTML == \"false\"\n          ) {\n            // In Opera event is fired second time when body.innerHTML\n            // changed from false\n            // to server response approx. after 1 sec when we upload\n            // file with iframe\n            return;\n          }\n        } catch (e) {\n          // IE fix\n        }\n\n        // self.debug('iframe loaded');\n\n        var response = self._getIframeContent(iframe);\n\n        self._onCompleted(file, response);\n\n        // timeout added to fix busy state in FF3.6\n        setTimeout(function () {\n          iframe.parentNode.removeChild(iframe);\n          form.parentNode.removeChild(form);\n        }, 1);\n      });\n      form.submit();\n    },\n\n    /*\n     * @Override\n     */\n    _doCancel(file) {\n      var data = file.getUserData(\"com.zenesis.qx.upload.FormHandler\");\n      if (!data) return;\n      var iframe = document.getElementById(\"upload-iframe-\" + file.getId()),\n        form = document.getElementById(\"upload-form-\" + file.getId());\n\n      if (iframe != null) {\n        // to cancel request set src to something else\n        // we use src=\"javascript:false;\" because it doesn't\n        // trigger ie6 prompt on https\n        iframe.setAttribute(\"src\", \"javascript:false;\");\n        iframe.parentNode.removeChild(iframe);\n      }\n      if (form != null) form.parentNode.removeChild(form);\n    },\n\n    /**\n     * Returns text received by iframe from server.\n     *\n     * @return {String}\n     */\n    _getIframeContent(iframe) {\n      try {\n        // iframe.contentWindow.document - for IE<7\n        var doc = iframe.contentDocument\n            ? iframe.contentDocument\n            : iframe.contentWindow.document,\n          response = doc.body.innerHTML;\n        // this.debug(\"response=\" + response);\n        return response;\n      } catch (e) {\n        // IE will throw an exception if the upload is cross domain and\n        // we try to access the iframe's content\n        return null;\n      }\n    },\n\n    /**\n     * Creates iframe with unique name\n     *\n     * @return {DOMElement} the iframe\n     */\n    _createIframe(id) {\n      // We can't use following code as the name attribute\n      // won't be properly registered in IE6, and new window\n      // on form submit will open\n      // var iframe = document.createElement('iframe');\n      // iframe.setAttribute('name', id);\n\n      var iframe = qx.dom.Element.create(\"iframe\", {\n        src: \"javascript:false;\", // src=\"javascript:false;\" removes ie6\n        // prompt on https\n        name: id,\n        id: \"upload-iframe-\" + id,\n      });\n\n      qx.bom.element.Style.setStyles(iframe, {\n        display: \"none\",\n      });\n\n      document.body.appendChild(iframe);\n\n      return iframe;\n    },\n\n    /**\n     * Creates form, that will be submitted to iframe\n     *\n     * @return {DOMElement} the form\n     */\n    _createForm(iframe, file) {\n      // We can't use the following code in IE6\n      // var form = document.createElement('form');\n      // form.setAttribute('method', 'post');\n      // form.setAttribute('enctype', 'multipart/form-data');\n      // Because in this case file won't be attached to request\n      var form = qx.dom.Element.create(\"form\", {\n        enctype: \"multipart/form-data\",\n        encoding: \"multipart/form-data\",\n        action: this._getUploader().getUploadUrl(),\n        method: \"POST\",\n        target: iframe.name,\n        id: \"upload-form-\" + file.getId(),\n      });\n\n      qx.bom.element.Style.setStyles(form, {\n        display: \"none\",\n      });\n\n      var params = this._getMergedParams(file);\n      for (var name in params) {\n        var el = qx.dom.Element.create(\"input\", {\n          type: \"hidden\",\n          name: name,\n          value: params[name],\n        });\n\n        form.appendChild(el);\n      }\n      document.body.appendChild(form);\n\n      return form;\n    },\n  },\n});\n"
  ],
  "mappings": "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"
}