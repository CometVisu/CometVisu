{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "com",
    "zenesis",
    "upload",
    "AbstractHandler",
    "members",
    "addBlob",
    "filename",
    "blob",
    "params",
    "Error",
    "_createFile",
    "input",
    "id",
    "_getUniqueFileId",
    "value",
    "replace",
    "file",
    "File",
    "_doUpload",
    "iframe",
    "_createIframe",
    "getId",
    "form",
    "_createForm",
    "appendChild",
    "getBrowserObject",
    "self",
    "bom",
    "Event",
    "addNativeListener",
    "evt",
    "parentNode",
    "contentDocument",
    "body",
    "innerHTML",
    "e",
    "response",
    "_getIframeContent",
    "_onCompleted",
    "setTimeout",
    "removeChild",
    "submit",
    "_doCancel",
    "data",
    "getUserData",
    "document",
    "getElementById",
    "setAttribute",
    "doc",
    "contentWindow",
    "dom",
    "Element",
    "create",
    "src",
    "name",
    "element",
    "Style",
    "setStyles",
    "display",
    "enctype",
    "encoding",
    "action",
    "_getUploader",
    "getUploadUrl",
    "method",
    "target",
    "_getMergedParams",
    "el",
    "type",
    "FormHandler"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/qx_packages/johnspackman_UploadMgr_v2_0_0/source/class/com/zenesis/qx/upload/FormHandler.js"
  ],
  "sourcesContent": [
    "/* ***********************************************************************\n\n   UploadMgr - provides an API for uploading one or multiple files\n   with progress feedback (on modern browsers), does not block the user \n   interface during uploads, supports cancelling uploads.\n\n   http://qooxdoo.org\n\n   Copyright:\n     2011 Zenesis Limited, http://www.zenesis.com\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     \n     This software is provided under the same licensing terms as Qooxdoo,\n     please see the LICENSE file in the Qooxdoo project's top-level directory \n     for details.\n     \n     Parts of this code is based on the work by Andrew Valums (andrew@valums.com)\n     and is covered by the GNU GPL and GNU LGPL2 licenses; please see\n     http://valums.com/ajax-upload/.\n\n   Authors:\n * John Spackman (john.spackman@zenesis.com)\n\n ************************************************************************/\n\n/**\n * Implementation of AbstractHandler that uses iframe and form DOM elements to\n * send the file.\n */\n\nqx.Class.define(\"com.zenesis.qx.upload.FormHandler\", {\n  extend: com.zenesis.qx.upload.AbstractHandler,\n\n  members: {\n    /*\n     * @Override\n     */\n    addBlob(filename, blob, params) {\n      throw new Error(\"addBlob is not supported in the FormHandler.\");\n    },\n\n    /*\n     * @Override\n     */\n    _createFile(input) {\n      var id = \"upload-\" + this._getUniqueFileId(),\n        filename = input.value.replace(/.*(\\/|\\\\)/, \"\"),\n        file = new com.zenesis.qx.upload.File(input, filename, id);\n      return file;\n    },\n\n    /*\n     * @Override\n     */\n    _doUpload(file) {\n      var iframe = this._createIframe(file.getId()),\n        form = this._createForm(iframe, file);\n\n      form.appendChild(file.getBrowserObject());\n\n      var self = this;\n\n      qx.bom.Event.addNativeListener(iframe, \"load\", function (evt) {\n        // when we remove iframe from dom the request stops, but in IE\n        // load event fires\n        if (!iframe.parentNode) return;\n\n        // fixing Opera 10.53\n        try {\n          if (\n            iframe.contentDocument &&\n            iframe.contentDocument.body &&\n            iframe.contentDocument.body.innerHTML == \"false\"\n          ) {\n            // In Opera event is fired second time when body.innerHTML\n            // changed from false\n            // to server response approx. after 1 sec when we upload\n            // file with iframe\n            return;\n          }\n        } catch (e) {\n          // IE fix\n        }\n\n        // self.debug('iframe loaded');\n\n        var response = self._getIframeContent(iframe);\n\n        self._onCompleted(file, response);\n\n        // timeout added to fix busy state in FF3.6\n        setTimeout(function () {\n          iframe.parentNode.removeChild(iframe);\n          form.parentNode.removeChild(form);\n        }, 1);\n      });\n      form.submit();\n    },\n\n    /*\n     * @Override\n     */\n    _doCancel(file) {\n      var data = file.getUserData(\"com.zenesis.qx.upload.FormHandler\");\n      if (!data) return;\n      var iframe = document.getElementById(\"upload-iframe-\" + file.getId()),\n        form = document.getElementById(\"upload-form-\" + file.getId());\n\n      if (iframe != null) {\n        // to cancel request set src to something else\n        // we use src=\"javascript:false;\" because it doesn't\n        // trigger ie6 prompt on https\n        iframe.setAttribute(\"src\", \"javascript:false;\");\n        iframe.parentNode.removeChild(iframe);\n      }\n      if (form != null) form.parentNode.removeChild(form);\n    },\n\n    /**\n     * Returns text received by iframe from server.\n     *\n     * @return {String}\n     */\n    _getIframeContent(iframe) {\n      try {\n        // iframe.contentWindow.document - for IE<7\n        var doc = iframe.contentDocument\n            ? iframe.contentDocument\n            : iframe.contentWindow.document,\n          response = doc.body.innerHTML;\n        // this.debug(\"response=\" + response);\n        return response;\n      } catch (e) {\n        // IE will throw an exception if the upload is cross domain and\n        // we try to access the iframe's content\n        return null;\n      }\n    },\n\n    /**\n     * Creates iframe with unique name\n     *\n     * @return {DOMElement} the iframe\n     */\n    _createIframe(id) {\n      // We can't use following code as the name attribute\n      // won't be properly registered in IE6, and new window\n      // on form submit will open\n      // var iframe = document.createElement('iframe');\n      // iframe.setAttribute('name', id);\n\n      var iframe = qx.dom.Element.create(\"iframe\", {\n        src: \"javascript:false;\", // src=\"javascript:false;\" removes ie6\n        // prompt on https\n        name: id,\n        id: \"upload-iframe-\" + id,\n      });\n\n      qx.bom.element.Style.setStyles(iframe, {\n        display: \"none\",\n      });\n\n      document.body.appendChild(iframe);\n\n      return iframe;\n    },\n\n    /**\n     * Creates form, that will be submitted to iframe\n     *\n     * @return {DOMElement} the form\n     */\n    _createForm(iframe, file) {\n      // We can't use the following code in IE6\n      // var form = document.createElement('form');\n      // form.setAttribute('method', 'post');\n      // form.setAttribute('enctype', 'multipart/form-data');\n      // Because in this case file won't be attached to request\n      var form = qx.dom.Element.create(\"form\", {\n        enctype: \"multipart/form-data\",\n        encoding: \"multipart/form-data\",\n        action: this._getUploader().getUploadUrl(),\n        method: \"POST\",\n        target: iframe.name,\n        id: \"upload-form-\" + file.getId(),\n      });\n\n      qx.bom.element.Style.setStyles(form, {\n        display: \"none\",\n      });\n\n      var params = this._getMergedParams(file);\n      for (var name in params) {\n        var el = qx.dom.Element.create(\"input\", {\n          type: \"hidden\",\n          name: name,\n          value: params[name],\n        });\n\n        form.appendChild(el);\n      }\n      document.body.appendChild(form);\n\n      return form;\n    },\n  },\n});\n"
  ],
  "mappings": "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"
}