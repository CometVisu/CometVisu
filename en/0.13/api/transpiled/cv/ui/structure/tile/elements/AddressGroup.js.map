{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "Address",
    "include",
    "MStringTransforms",
    "construct",
    "element",
    "constructor",
    "call",
    "hasAttribute",
    "setAttribute",
    "concat",
    "AddressGroup",
    "C",
    "debouncedCalc",
    "util",
    "Function",
    "debounce",
    "_updateCalculation",
    "bind",
    "statics",
    "events",
    "changeValue",
    "properties",
    "operator",
    "check",
    "init",
    "apply",
    "round",
    "transform",
    "factor",
    "valid",
    "nonZeroValues",
    "event",
    "members",
    "_i",
    "_values",
    "__value",
    "setValue",
    "val",
    "oldValue",
    "fireDataEvent",
    "_applyValue",
    "getValue",
    "resetValue",
    "getAddress",
    "_element",
    "getAttribute",
    "_init",
    "_this",
    "Array",
    "children",
    "length",
    "fill",
    "_stateUpdateTarget",
    "parentElement",
    "addEventListener",
    "ev",
    "onStateUpdate",
    "stopPropagation",
    "value",
    "isConnected",
    "fireStateUpdate",
    "_applyValid",
    "setNonZeroValues",
    "filter",
    "v",
    "getOperator",
    "reduce",
    "accumulator",
    "currentValue",
    "i",
    "isNaN",
    "isFinite",
    "setValid",
    "getFactor",
    "isRound",
    "Math",
    "index",
    "prototype",
    "indexOf",
    "detail",
    "source",
    "getElement",
    "state",
    "parseFloat",
    "error",
    "_typeof",
    "defer",
    "Clazz",
    "_class",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_inherits",
    "_super",
    "_createSuper",
    "_classCallCheck",
    "_createClass",
    "QxConnector",
    "_defineProperty"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/AddressGroup.js"
  ],
  "sourcesContent": [
    "/*\n * Copyright (c) 2023, Christian Mayer and the CometVisu contributors.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n *\n */\n\n/**\n * Aggregates values from sub-elements like other cv.ui.structure.tile.elements.AddressGroups\n * or cv.ui.structure.tile.elements.Address.\n *\n *  @author Tobias BrÃ¤utigam\n *  @since 2023\n */\nqx.Class.define('cv.ui.structure.tile.elements.AddressGroup', {\n  extend: cv.ui.structure.tile.elements.Address,\n  include: cv.ui.structure.tile.MStringTransforms,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct(element) {\n    super(element);\n    if (!element.hasAttribute('id')) {\n      element.setAttribute('id', `address-group_${cv.ui.structure.tile.elements.AddressGroup.C++}`);\n    }\n    this.debouncedCalc = qx.util.Function.debounce(this._updateCalculation.bind(this), 10);\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    C: 0\n  },\n\n  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    changeValue: 'qx.event.type.Data'\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n\n    operator: {\n      check: ['+', '-', '/', '*'],\n      init: '+',\n      apply: '_updateCalculation'\n    },\n\n    round: {\n      check: 'Boolean',\n      init: false,\n      transform: '_parseBoolean'\n    },\n\n    factor: {\n      check: 'Number',\n      init: 1,\n      transform: '_parseFloat'\n    },\n\n    valid: {\n      check: 'Boolean',\n      init: true,\n      apply: '_applyValid'\n    },\n\n    nonZeroValues: {\n      check: 'Number',\n      init: 0,\n      event: 'changeNonZeroValues'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _i: null,\n    _values: null,\n    __value: null,\n\n    setValue(val) {\n      if (this.__value !== val) {\n        const oldValue = this.__value;\n        this.__value = val;\n        this.fireDataEvent('changeValue', val, oldValue);\n        this._applyValue(val);\n      }\n    },\n\n    getValue() {\n      return this.__value;\n    },\n\n    resetValue() {\n      this.__value = null;\n    },\n\n    getAddress() {\n      return this._element.getAttribute('id');\n    },\n\n    _init() {\n      const element = this._element;\n      this._values = new Array(element.children.length).fill(0);\n      this._stateUpdateTarget = element.parentElement;\n      element.addEventListener('stateUpdate', ev => {\n        this.onStateUpdate(ev);\n        // cancel event here\n        ev.stopPropagation();\n      });\n    },\n\n    _applyValue(value) {\n      if (this.isConnected()) {\n        this._element.setAttribute('data-value', '' + value);\n        this.fireStateUpdate(this.getAddress(), value);\n      }\n    },\n\n    _applyValid(valid) {\n      this._element.setAttribute('data-valid', '' + valid);\n    },\n\n    _updateCalculation() {\n      if (this.isConnected()) {\n        let val = 0;\n        if (this._values.length > 0) {\n          this.setNonZeroValues(this._values.filter(v => v !== 0).length);\n          switch (this.getOperator()) {\n            case '+':\n              val = this._values.reduce((accumulator, currentValue) => accumulator + currentValue, val);\n              break;\n\n            case '-':\n              // subtract all from first one\n              val = this._values[0];\n              for (let i = 1; i < this._values.length; i++) {\n                val -= this._values[i];\n              }\n              break;\n\n            case '*':\n              val = this._values.reduce((accumulator, currentValue) => accumulator * currentValue, val);\n              break;\n\n            case '/':\n              // divide all from first one\n              val = this._values[0];\n              for (let i = 1; i < this._values.length; i++) {\n                val /= this._values[i];\n              }\n              break;\n          }\n        }\n        const valid = !isNaN(val) && isFinite(val);\n        this.setValid(valid);\n        if (valid) {\n          val *= this.getFactor();\n          if (this.isRound()) {\n            val = Math.round(val);\n          }\n          this.setValue(val);\n        } else {\n          this.resetValue();\n        }\n      }\n    },\n\n    onStateUpdate(ev) {\n      const index = Array.prototype.indexOf.call(this._element.children, ev.detail.source.getElement());\n      if (index >= 0) {\n        let val = ev.detail.state;\n        if (typeof val === 'string') {\n          val = parseFloat(val);\n        }\n        if (typeof val === 'number') {\n          this._values[index] = val;\n          this.debouncedCalc();\n        } else {\n          this.error('update value is not a number', typeof val, 'calculation not possible');\n        }\n      }\n    }\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'address-group',\n      class extends QxConnector {\n        static observedAttributes = ['round', 'operator', 'factor'];\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n\n"
  ],
  "mappings": "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"
}