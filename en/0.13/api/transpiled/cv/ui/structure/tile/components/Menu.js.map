{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "properties",
    "model",
    "check",
    "apply",
    "appearance",
    "init",
    "depth",
    "domReady",
    "showLabels",
    "members",
    "_applyAppearance",
    "value",
    "oldValue",
    "main",
    "document",
    "querySelector",
    "classList",
    "remove",
    "add",
    "_applyDepth",
    "isDomReady",
    "_generateMenu",
    "_onDomAppended",
    "setDomReady",
    "event",
    "message",
    "Bus",
    "unsubscribe",
    "_applyModel",
    "rootList",
    "createElement",
    "_element",
    "appendChild",
    "ham",
    "href",
    "onclick",
    "_onHamburgerMenu",
    "icon",
    "subscribe",
    "_onPageChange",
    "Registration",
    "addListener",
    "_onSwipe",
    "error",
    "_init",
    "element",
    "hasAttribute",
    "getAttribute",
    "querySelectorAll",
    "length",
    "setShowLabels",
    "setModel",
    "getModel",
    "currentPage",
    "window",
    "location",
    "hash",
    "substring",
    "parentElement",
    "firstPage",
    "replaceChildren",
    "__generatePagesModel",
    "item",
    "pageName",
    "pageIcon",
    "li",
    "i",
    "title",
    "isShowLabels",
    "text",
    "createTextNode",
    "addEventListener",
    "getInstance",
    "onClick",
    "toggleClass",
    "detail",
    "setAttribute",
    "toggle",
    "stopPropagation",
    "contains",
    "_onPointerDown",
    "body",
    "_closeAll",
    "ev",
    "target",
    "getTarget",
    "nodeName",
    "toLowerCase",
    "tagName",
    "Timer",
    "once",
    "getDirection",
    "next",
    "click",
    "current",
    "previousElementSibling",
    "prev",
    "except",
    "removeAttribute",
    "removeListener",
    "_openDetail",
    "first",
    "_closeDetail",
    "parentList",
    "currentLevel",
    "pages",
    "values",
    "page",
    "pageId",
    "a",
    "getDepth",
    "details",
    "summary",
    "Application",
    "structureController",
    "scrollToPage",
    "preventDefault",
    "p",
    "expander",
    "subList",
    "pageElement",
    "getData",
    "link",
    "id",
    "parent",
    "activeName",
    "destruct",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Menu"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Menu.js"
  ],
  "sourcesContent": [
    "/* Menu.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Generates a menu of a model, currently only the pages model is implemented.\n *\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.components.Menu', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    model: {\n      check: ['pages', 'menuItems'],\n      apply: '_applyModel'\n    },\n    appearance: {\n      check: ['text', 'icons', 'dock'],\n      init: 'text',\n      apply: '_applyAppearance'\n    },\n\n    depth: {\n      check: '!isNaN(value) && value >= -1 && value <= 100',\n      init: -1,\n      apply: '_applyDepth'\n    },\n\n    domReady: {\n      check: 'Boolean',\n      init: false,\n      apply: '_generateMenu'\n    },\n\n    showLabels: {\n      check: 'Boolean',\n      init: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _applyAppearance(value, oldValue) {\n      const main = document.querySelector('main');\n      if (oldValue === 'dock') {\n        main.classList.remove('has-dock');\n      }\n      if (value === 'dock') {\n        main.classList.add('has-dock');\n      }\n    },\n\n    _applyDepth() {\n      if (this.isDomReady()) {\n        this._generateMenu();\n      }\n    },\n\n    _onDomAppended() {\n      this.setDomReady(true);\n      qx.event.message.Bus.unsubscribe('setup.dom.append', this._onDomAppended, this);\n    },\n\n    _applyModel(model) {\n      if (model) {\n        const rootList = document.createElement('ul');\n        this._element.appendChild(rootList);\n\n        if (model === 'pages') {\n          // add hamburger menu\n          const ham = document.createElement('a');\n          ham.href = '#';\n          ham.classList.add('menu');\n          ham.onclick = event => this._onHamburgerMenu(event);\n          const icon = document.createElement('i');\n\n          ham.appendChild(icon);\n          this._element.appendChild(ham);\n\n          qx.event.message.Bus.subscribe('setup.dom.append', this._onDomAppended, this);\n          qx.event.message.Bus.subscribe('cv.ui.structure.tile.currentPage', this._onPageChange, this);\n          qx.event.Registration.addListener(this._element, 'swipe', this._onSwipe, this);\n          icon.classList.add('ri-menu-line');\n        } else if (model === 'menuItems') {\n          // add hamburger menu\n          const icon = document.createElement('i');\n          icon.classList.add('ri-more-2-fill');\n          this._element.appendChild(icon);\n          // listen on whole element\n          this._element.onclick = event => this._onHamburgerMenu(event);\n          rootList.classList.add('context-menu');\n          this._generateMenu();\n        }\n      } else {\n        this.error('visual-model of type', model, 'is not implemented');\n      }\n    },\n\n    _init() {\n      const element = this._element;\n      const model = element.hasAttribute('model') ? element.getAttribute('model')\n        : (element.querySelectorAll(':scope > cv-menu-item').length > 0) ? 'menuItems' : null;\n      if (!model) {\n        this.error('no model defined, menu will be empty');\n        return;\n      }\n      if (element.getAttribute('show-labels') === 'false') {\n        this.setShowLabels(false);\n      }\n      this.setModel(model);\n    },\n\n    _generateMenu() {\n      switch (this.getModel()) {\n        case 'pages': {\n          const currentPage = window.location.hash.substring(1);\n          let parentElement = document.querySelector('main');\n          if (parentElement) {\n            const firstPage = document.querySelector('cv-page');\n            if (firstPage) {\n              parentElement = firstPage.parentElement;\n            }\n          }\n          const rootList = this._element.querySelector(':scope > ul');\n          if (rootList) {\n            rootList.replaceChildren();\n            this.__generatePagesModel(rootList, parentElement, currentPage, 0);\n          }\n          break;\n        }\n        case 'menuItems': {\n          const rootList = this._element.querySelector(':scope > ul');\n          if (rootList) {\n            rootList.replaceChildren();\n            for (let item of this._element.querySelectorAll(':scope > cv-menu-item')) {\n              const pageName = item.getAttribute('name') || '';\n              const pageIcon = item.getAttribute('icon') || '';\n              const li = document.createElement('li');\n              if (pageIcon) {\n                const i = document.createElement('i');\n                i.classList.add(pageIcon);\n                i.title = pageName;\n                li.appendChild(i);\n              }\n              if (this.isShowLabels()) {\n                const text = document.createTextNode(pageName);\n                li.appendChild(text);\n              }\n              li.addEventListener('click', event => {\n                item.getInstance().onClick(event);\n              });\n              rootList.appendChild(li);\n            }\n          }\n          break;\n        }\n      }\n    },\n\n    _onHamburgerMenu(event) {\n      let toggleClass = 'open';\n      if (this.getModel() === 'pages') {\n        toggleClass = 'responsive';\n        for (let detail of this._element.querySelectorAll('.details')) {\n          detail.setAttribute('open', '');\n        }\n      }\n      this._element.classList.toggle(toggleClass);\n      event.stopPropagation();\n      if (this._element.classList.contains(toggleClass)) {\n        // add some general listeners to close\n        qx.event.Registration.addListener(document, 'pointerdown', this._onPointerDown, this);\n        qx.event.Registration.addListener(document.body.querySelector(':scope > main'), 'scroll', this._closeAll, this);\n      }\n    },\n\n    /**\n     * @param ev {qx.event.type.Event}\n     * @private\n     */\n    _onPointerDown(ev) {\n      const target = ev.getTarget();\n      if (\n        target.classList.contains('menu') ||\n        (target.parentElement && target.parentElement.classList.contains('menu')) ||\n        target.nodeName.toLowerCase() === 'cv-menu' ||\n        (target.parentElement && target.parentElement.nodeName.toLowerCase() === 'cv-menu')\n      ) {\n        // clicked in hamburger menu, do nothing\n      } else if (target.tagName.toLowerCase() !== '.summary' && target.tagName.toLowerCase() !== 'p') {\n        // defer closing because it would prevent the link clicks and page selection\n        qx.event.Timer.once(this._closeAll, this, 500);\n      } else {\n        // close others\n        this._closeAll(ev.getTarget().parentElement);\n      }\n    },\n\n    _onSwipe(ev) {\n      if (ev.getDirection() === 'left') {\n        // goto next if there is one\n        const next = this._element.querySelector('li.active + li > a');\n        if (next) {\n          next.click();\n        }\n      } else {\n        const current = this._element.querySelector('li.active');\n        if (\n          current &&\n          current.previousElementSibling &&\n          current.previousElementSibling.tagName.toLowerCase() === 'li'\n        ) {\n          const prev = current.previousElementSibling.querySelector(':scope > a');\n          if (prev) {\n            prev.click();\n          }\n        }\n      }\n    },\n\n    /**\n     * Close all open sub-menus\n     * @param except {Element?} do not close this one\n     * @private\n     */\n    _closeAll(except) {\n      if (this._element.classList.contains('open')) {\n        this._element.classList.remove('open');\n      } else if (this._element.classList.contains('responsive')) {\n        this._element.classList.remove('responsive');\n      } else {\n        for (let detail of this._element.querySelectorAll('.details[open]')) {\n          if (!except || detail !== except) {\n            detail.removeAttribute('open');\n          }\n        }\n      }\n      if (this._element.querySelectorAll('.details[open]').length === 0) {\n        qx.event.Registration.removeListener(document, 'pointerdown', this._onPointerDown, this);\n        qx.event.Registration.removeListener(document.body.querySelector(':scope > main'), 'scroll', this._closeAll, this);\n      }\n    },\n\n    _openDetail(item) {\n      const first = this._element.querySelectorAll('.details[open]').length === 0;\n      item.setAttribute('open', '');\n      if (first) {\n        qx.event.Registration.addListener(document, 'pointerdown', this._onPointerDown, this);\n        qx.event.Registration.addListener(document.body.querySelector(':scope > main'), 'scroll', this._closeAll, this);\n      }\n    },\n\n    _closeDetail(item) {\n      item.removeAttribute('open');\n      if (this._element.querySelectorAll('.details[open]').length === 0) {\n        // remove listeners\n        qx.event.Registration.removeListener(document, 'pointerdown', this._onPointerDown, this);\n        qx.event.Registration.removeListener(document.body.querySelector(':scope > main'), 'scroll', this._closeAll, this);\n      }\n    },\n\n    __generatePagesModel(parentList, parentElement, currentPage, currentLevel) {\n      if (!parentElement) {\n        return;\n      }\n      let pages = parentElement.querySelectorAll(':scope > cv-page:not([menu=\"false\"])');\n\n      for (let page of pages.values()) {\n        const pageId = page.getAttribute('id');\n        if (!pageId) {\n          this.error('page has no id, skipping');\n          continue;\n        }\n        const pageName = page.getAttribute('name') || '';\n        const pageIcon = page.getAttribute('icon') || '';\n        const li = document.createElement('li');\n        const a = document.createElement('a');\n        a.setAttribute('href', '#' + pageId);\n        a.setAttribute('data-page-id', pageId);\n        if (pageIcon) {\n          const i = document.createElement('i');\n          i.classList.add(pageIcon);\n          i.title = pageName;\n          a.appendChild(i);\n        }\n        if (this.isShowLabels() || currentLevel > 0) {\n          const text = document.createTextNode(pageName);\n          a.appendChild(text);\n        }\n        if (currentPage === pageId) {\n          li.classList.add('active');\n        }\n        parentList.appendChild(li);\n        const depth = this.getDepth();\n        if (\n          (depth < 0 || depth > currentLevel) &&\n          page.querySelectorAll(':scope > cv-page:not([menu=\"false\"])').length > 0\n        ) {\n          const details = document.createElement('div');\n          details.classList.add('details');\n          const summary = document.createElement('div');\n          summary.classList.add('summary');\n          a.setAttribute('href', '#');\n\n          a.addEventListener('click', ev => {\n            cv.Application.structureController.scrollToPage(pageId);\n            ev.stopPropagation();\n            ev.preventDefault();\n          });\n\n          const pageIcon = page.getAttribute('icon') || '';\n          if (page.querySelector(':scope > *:not(cv-page)')) {\n            // only add this as link, when this page has real content\n            summary.appendChild(a);\n          } else {\n            const p = document.createElement('p');\n            if (pageIcon) {\n              const i = document.createElement('i');\n              i.classList.add(pageIcon);\n              i.title = pageName;\n              p.appendChild(i);\n            }\n            if (this.isShowLabels()) {\n              p.appendChild(document.createTextNode(pageName));\n            }\n            summary.appendChild(p);\n          }\n          const expander = document.createElement('i');\n          expander.classList.add('expander');\n          expander.classList.add('ri-arrow-down-s-line');\n          summary.appendChild(expander);\n          expander.addEventListener('click', ev => {\n            if (details.hasAttribute('open')) {\n              this._closeDetail(details);\n            } else {\n              this._openDetail(details);\n            }\n          });\n\n          details.appendChild(summary);\n          const subList = document.createElement('ul');\n          details.appendChild(subList);\n          this.__generatePagesModel(subList, page, currentPage, currentLevel+1);\n          li.appendChild(details);\n        } else {\n          li.appendChild(a);\n        }\n      }\n    },\n\n    _onPageChange(ev) {\n      const pageElement = ev.getData();\n      // unset all currently active\n      for (let link of this._element.querySelectorAll('li.active, li.sub-active')) {\n        link.classList.remove('active');\n        link.classList.remove('sub-active');\n      }\n      // find link to current page\n      for (let link of this._element.querySelectorAll(`a[data-page-id=\"${pageElement.id}\"]`)) {\n        // activate all parents\n        let parent = link.parentElement;\n        let activeName = 'active';\n        while (parent && parent.tagName.toLowerCase() !== 'cv-menu') {\n          if (parent.tagName.toLowerCase() === 'li') {\n            parent.classList.add(activeName);\n            // all other parents have a sub-menu active\n            activeName = 'sub-active';\n          }\n          parent = parent.parentElement;\n        }\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    qx.event.Registration.removeListener(document, 'pointerdown', this._onPointerDown, this);\n\n    qx.event.message.Bus.unsubscribe('cv.ui.structure.tile.currentPage', this._onPageChange, this);\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'menu',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n        static get observedAttributes() {\n          return ['appearance', 'depth'];\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}