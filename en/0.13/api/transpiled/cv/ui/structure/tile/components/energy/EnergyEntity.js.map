{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "svg",
    "TextValue",
    "include",
    "energy",
    "MEntity",
    "statics",
    "typeSettings",
    "pv",
    "icon",
    "color",
    "battery",
    "grid",
    "house",
    "charger",
    "heatpump",
    "consumer",
    "properties",
    "direction",
    "check",
    "init",
    "apply",
    "unit",
    "members",
    "_autoFormat",
    "_applyType",
    "value",
    "settings",
    "EnergyEntity",
    "attribute",
    "_element",
    "setAttribute",
    "_init",
    "superclass",
    "prototype",
    "call",
    "element",
    "hasAttribute",
    "_svg",
    "getAttribute",
    "_applyUnit",
    "getUnit",
    "getDirection",
    "_applyDirection",
    "isConnected",
    "removeAttribute",
    "resetColor",
    "arrow",
    "_target",
    "querySelector",
    "remove",
    "getType",
    "setColor",
    "document",
    "createElementNS",
    "classList",
    "add",
    "getIconColor",
    "appendChild",
    "__updateDirectionPosition",
    "_applyOffsetY",
    "_applyScale",
    "scale",
    "concat",
    "getOffsetY",
    "defer",
    "QxClass",
    "_Class",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_classCallCheck",
    "_callSuper",
    "_inherits",
    "_createClass",
    "QxConnector",
    "_defineProperty"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/energy/EnergyEntity.js"
  ],
  "sourcesContent": [
    "/*\n * Copyright (c) 2023, Christian Mayer and the CometVisu contributors.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n *\n */\n\n/**\n * TextValue for energy entities.\n *\n * @since 2023\n * @author Tobias Br√§utigam\n */\nqx.Class.define('cv.ui.structure.tile.components.energy.EnergyEntity', {\n  extend: cv.ui.structure.tile.components.svg.TextValue,\n  include: cv.ui.structure.tile.components.energy.MEntity,\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    typeSettings: {\n      pv: {\n        icon: 'knxuf-weather_sun',\n        color: 'var(--pvColor)'\n      },\n      battery: {\n        icon: 'knxuf-measure_battery_100'\n      },\n      grid: {\n        icon: 'knxuf-scene_power_grid'\n      },\n      house: {\n        icon: 'knxuf-control_building_empty'\n      },\n      charger: {\n        icon: 'knxuf-veh_wallbox',\n        color: 'var(--powerConsumeColor)'\n      },\n      heatpump: {\n        icon: 'knxuf-sani_earth_source_heat_pump',\n        color: 'var(--powerConsumeColor)'\n      },\n      consumer: {\n        icon: 'knxuf-measure_smart_meter',\n        color: 'var(--powerConsumeColor)'\n      }\n    }\n  },\n\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    direction: {\n      check: ['incoming', 'outgoing', 'none'],\n      init: 'none',\n      apply: '_applyDirection'\n    },\n\n    unit: {\n      check: ['Wh', 'kWh'],\n      init: 'kWh',\n      apply: '_applyUnit'\n    }\n  },\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _autoFormat: null,\n\n    _applyType(value) {\n      const settings = cv.ui.structure.tile.components.energy.EnergyEntity.typeSettings[value];\n      if (settings) {\n        for (const attribute in settings) {\n          this._element.setAttribute(attribute, settings[attribute]);\n        }\n      }\n    },\n\n    _init() {\n      super._init();\n      const element = this._element;\n      if (element.hasAttribute('id')) {\n        this._svg.setAttribute('id', element.getAttribute('id'));\n      }\n      this._autoFormat = !element.hasAttribute('format');\n      this._applyUnit(this.getUnit());\n      const direction = this.getDirection();\n      if (direction !== 'none') {\n        this._applyDirection(direction);\n      }\n    },\n\n    _applyUnit(value) {\n      if (this.isConnected() && this._autoFormat) {\n        if (!this._element.hasAttribute('format')) {\n          switch (value) {\n            case 'Wh':\n              this._element.setAttribute('format', '%d Wh');\n              break;\n\n            case 'kWh':\n              this._element.setAttribute('format', '%.2f kWh');\n              break;\n\n            default:\n              this._element.removeAttribute('format');\n              break;\n          }\n        }\n      }\n    },\n\n    _applyDirection(direction) {\n      if (direction === 'none') {\n        this.resetColor();\n        let arrow = this._target ? this._target.querySelector('path.direction') : null;\n        if (arrow) {\n          arrow.remove();\n        }\n        return;\n      }\n      switch (this.getType()) {\n        case 'battery':\n          this.setColor(direction === 'incoming' ? 'var(--batteryConsumeColor)' : 'var(--batteryInjectColor)');\n          break;\n\n        case 'grid':\n          this.setColor(direction === 'incoming' ? 'var(--gridConsumeColor)' : 'var(--gridInjectColor)');\n          break;\n      }\n      if (this._target) {\n        let arrow = this._target.querySelector('path.energy-direction');\n        if (!arrow) {\n          arrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n          arrow.classList.add('energy-direction');\n          arrow.setAttribute('d', 'M 0 0 L 6 4 L 0 8');\n          arrow.setAttribute('stroke', this.getIconColor());\n          arrow.setAttribute('stroke-width', '1');\n          arrow.setAttribute('fill', 'transparent');\n          this._target.appendChild(arrow);\n        }\n        this.__updateDirectionPosition();\n      }\n    },\n\n    _applyOffsetY(value) {\n      super._applyOffsetY(value);\n      this.__updateDirectionPosition();\n    },\n\n    _applyScale(scale) {\n      super._applyScale(scale);\n      this.__updateDirectionPosition();\n    },\n\n    __updateDirectionPosition() {\n      let arrow = this._target.querySelector('path.energy-direction');\n      if (arrow) {\n        arrow.setAttribute('transform', `translate(28, ${this.getOffsetY() + 8}) rotate(${this.getDirection() === 'incoming' ? '90' : '-90'}, 3, 4)`);\n      }\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'energy-entity',\n      class extends QxConnector {\n        static observedAttributes = ['icon', 'type', 'x', 'y', 'row', 'column', 'rowspan', 'colspan', 'direction', 'unit', 'color'];\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}