{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "members",
    "__lastValue",
    "__transformedValue",
    "_init",
    "element",
    "_element",
    "address",
    "textContent",
    "trim",
    "model",
    "data",
    "Model",
    "getInstance",
    "backendName",
    "getAttribute",
    "addAddress",
    "mode",
    "hasAttribute",
    "state",
    "getState",
    "undefined",
    "fireStateUpdate",
    "addUpdateListener",
    "addEventListener",
    "ev",
    "value",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "detail",
    "allowDuplicates",
    "source",
    "components",
    "Button",
    "getType",
    "encoding",
    "encodedValue",
    "Transform",
    "encodeBusAndRaw",
    "transform",
    "raw",
    "lastSentValue",
    "delay",
    "parseInt",
    "debug",
    "event",
    "Timer",
    "once",
    "io",
    "BackendConnections",
    "getClient",
    "write",
    "bus",
    "transformedState",
    "decode",
    "mapping",
    "Application",
    "structureController",
    "mapValue",
    "util",
    "String",
    "sprintf",
    "Date",
    "toLocaleString",
    "CustomEvent",
    "bubbles",
    "cancelable",
    "target",
    "addressValue",
    "variant",
    "dispatchEvent",
    "getValue",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Address"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/Address.js"
  ],
  "sourcesContent": [
    "/* Address.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Address element that connect a widget/component to the backend.\n *\n *  @author Tobias BrÃ¤utigam\n *  @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.Address', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __lastValue: null,\n    __transformedValue: null,\n\n    _init() {\n      const element = this._element;\n      const address = element.textContent.trim();\n      if (address) {\n        const model = cv.data.Model.getInstance();\n        const backendName = element.getAttribute('backend');\n        model.addAddress(address, element.getAttribute('id'), backendName);\n        const mode = element.hasAttribute('mode') ? element.getAttribute('mode') : 'readwrite';\n        if (mode !== 'write') {\n          // subscribe\n          // this is a read address register for updates\n          const state = model.getState(address, backendName);\n          if (state !== undefined) {\n            this.fireStateUpdate(address, state);\n          }\n          //add listener\n          model.addUpdateListener(address, this.fireStateUpdate, this, backendName);\n        }\n        if (mode !== 'read') {\n          // listen for sendState events\n          element.addEventListener('sendState', ev => {\n            let value = null;\n            if (Object.prototype.hasOwnProperty.call(ev.detail, 'value')) {\n              value = ev.detail.value;\n            }\n            if (element.hasAttribute('value')) {\n              // address has a fixed value that must be sent\n              value = element.getAttribute('value');\n            }\n            const allowDuplicates =\n              ev.detail.source &&\n              ev.detail.source instanceof cv.ui.structure.tile.components.Button &&\n              (ev.detail.source.getType() === 'trigger' || ev.detail.source.getType() === 'push');\n            if (value !== null) {\n              const encoding = element.getAttribute('transform') || 'raw';\n              const encodedValue = cv.Transform.encodeBusAndRaw({ transform: encoding }, value);\n\n              // noinspection EqualityComparisonWithCoercionJS\n              if (\n                allowDuplicates ||\n                !Object.prototype.hasOwnProperty.call(element, 'lastSentValue') ||\n                encodedValue.raw !== element.lastSentValue\n              ) {\n                if (element.hasAttribute('delay')) {\n                  const delay = parseInt(element.getAttribute('delay'));\n                  this.debug(`send with delay of ${delay}ms`);\n                  qx.event.Timer.once(\n                    () => {\n                      cv.io.BackendConnections.getClient(backendName).write(\n                        element.textContent,\n                        encodedValue.bus,\n                        element\n                      );\n\n                      if (!allowDuplicates) {\n                        element.lastSentValue = encodedValue.raw;\n                      }\n                    },\n                    this,\n                    delay\n                  );\n                } else {\n                  cv.io.BackendConnections.getClient(backendName).write(element.textContent, encodedValue.bus, element);\n\n                  if (!allowDuplicates) {\n                    element.lastSentValue = encodedValue.raw;\n                  }\n                }\n              }\n            }\n          });\n        }\n      }\n    },\n\n    /**\n     * Creates a 'stateUpdate' event with the transformed value and dispatches it to the <cv-address>-Element.\n     * @param address {String} address\n     * @param state {variant} state to send\n     */\n    fireStateUpdate(address, state) {\n      if (this.__lastValue !== state || this._element.getAttribute('send-mode') === 'always') {\n        let transform = this._element.getAttribute('transform') || 'raw';\n        let transformedState = cv.Transform.decode({ transform: transform }, state);\n\n        let mapping = '';\n        if (this._element.hasAttribute('mapping')) {\n          mapping = this._element.getAttribute('mapping');\n          transformedState = cv.Application.structureController.mapValue(mapping, transformedState);\n        }\n        if (this._element.hasAttribute('format')) {\n          transformedState = cv.util.String.sprintf(\n            this._element.getAttribute('format'),\n            transformedState instanceof Date ? transformedState.toLocaleString() : transformedState\n          );\n        }\n        const ev = new CustomEvent('stateUpdate', {\n          bubbles: true,\n          cancelable: true,\n          detail: {\n            address: this._element.textContent.trim(),\n            state: transformedState,\n            target: this._element.getAttribute('target') || '',\n            raw: state,\n            mapping: mapping,\n            addressValue: this._element.hasAttribute('value') ? this._element.getAttribute('value') : null,\n            source: this,\n            variant: this._element.hasAttribute('variant') ? this._element.getAttribute('variant') : null\n          }\n        });\n\n        this.__transformedValue = transformedState;\n        //console.log(ev.detail);\n        this._element.dispatchEvent(ev);\n        this.__lastValue = state;\n        // reset lastSentValue\n        if (state !== this._element.lastSentValue) {\n          this._element.lastSentValue = null;\n        }\n      }\n    },\n\n    getValue() {\n      return this.__transformedValue;\n    }\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'address',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}