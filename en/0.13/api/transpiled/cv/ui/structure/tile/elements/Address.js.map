{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "members",
    "__lastValue",
    "__transformedValue",
    "_init",
    "_this",
    "element",
    "_element",
    "address",
    "textContent",
    "trim",
    "model",
    "data",
    "Model",
    "getInstance",
    "backendName",
    "getAttribute",
    "addAddress",
    "mode",
    "hasAttribute",
    "state",
    "getState",
    "undefined",
    "fireStateUpdate",
    "addUpdateListener",
    "startsWith",
    "addEventListener",
    "ev",
    "value",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "detail",
    "allowDuplicates",
    "source",
    "components",
    "Button",
    "getType",
    "encoding",
    "encodedValue",
    "Transform",
    "encodeBusAndRaw",
    "transform",
    "selector",
    "ignoreError",
    "variantInfo",
    "qos",
    "raw",
    "lastSentValue",
    "delay",
    "parseInt",
    "debug",
    "concat",
    "event",
    "Timer",
    "once",
    "io",
    "BackendConnections",
    "getClient",
    "write",
    "bus",
    "transformedState",
    "decode",
    "mapping",
    "Application",
    "structureController",
    "mapValue",
    "util",
    "String",
    "sprintf",
    "Date",
    "toLocaleString",
    "targetConfig",
    "split",
    "target",
    "length",
    "shift",
    "CustomEvent",
    "bubbles",
    "cancelable",
    "addressValue",
    "variant",
    "dispatchEvent",
    "isRead",
    "isWrite",
    "getValue",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_inherits",
    "_class",
    "_super",
    "_createSuper",
    "_classCallCheck",
    "_createClass",
    "QxConnector",
    "Address"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/Address.js"
  ],
  "sourcesContent": [
    "/* Address.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Address element that connect a widget/component to the backend.\n *\n *  @author Tobias BrÃ¤utigam\n *  @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.Address', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __lastValue: null,\n    __transformedValue: null,\n\n    _init() {\n      const element = this._element;\n      const address = element.textContent.trim();\n      if (address) {\n        const model = cv.data.Model.getInstance();\n        const backendName = element.getAttribute('backend');\n        model.addAddress(address, element.getAttribute('id'), backendName);\n        const mode = element.hasAttribute('mode') ? element.getAttribute('mode') : 'readwrite';\n        if (mode !== 'write') {\n          // subscribe\n          // this is a read address register for updates\n          const state = model.getState(address, backendName);\n          if (state !== undefined) {\n            this.fireStateUpdate(address, state);\n          }\n          //add listener\n          model.addUpdateListener(address, this.fireStateUpdate, this, backendName);\n\n          if (element.hasAttribute('target') && element.getAttribute('target').startsWith('last-update')) {\n            if (state === undefined) {\n              // notify tile that we have no value, so its outdated\n              this.fireStateUpdate(address, '-');\n            }\n          }\n        }\n        if (mode !== 'read') {\n          // listen for sendState events\n          element.addEventListener('sendState', ev => {\n            let value = null;\n            if (Object.prototype.hasOwnProperty.call(ev.detail, 'value')) {\n              value = ev.detail.value;\n            }\n            if (element.hasAttribute('value')) {\n              // address has a fixed value that must be sent\n              value = element.getAttribute('value');\n            }\n            const allowDuplicates =\n              ev.detail.source &&\n              ev.detail.source instanceof cv.ui.structure.tile.components.Button &&\n              (ev.detail.source.getType() === 'trigger' || ev.detail.source.getType() === 'push');\n            if (value !== null) {\n              const encoding = element.getAttribute('transform') || 'raw';\n              const encodedValue = cv.Transform.encodeBusAndRaw({\n                transform: encoding,\n                selector: this._element.getAttribute('selector'),\n                ignoreError: this._element.getAttribute('ignore-error') === 'true',\n                variantInfo: this._element.getAttribute('variant'),\n                qos: (this._element.getAttribute('qos') || 0) | 0\n              }, value);\n\n              // noinspection EqualityComparisonWithCoercionJS\n              if (\n                allowDuplicates ||\n                !Object.prototype.hasOwnProperty.call(element, 'lastSentValue') ||\n                encodedValue.raw !== element.lastSentValue\n              ) {\n                if (element.hasAttribute('delay')) {\n                  const delay = parseInt(element.getAttribute('delay'));\n                  this.debug(`send with delay of ${delay}ms`);\n                  qx.event.Timer.once(\n                    () => {\n                      cv.io.BackendConnections.getClient(backendName).write(\n                        address,\n                        encodedValue.bus,\n                        element\n                      );\n\n                      if (!allowDuplicates) {\n                        element.lastSentValue = encodedValue.raw;\n                      }\n                    },\n                    this,\n                    delay\n                  );\n                } else {\n                  cv.io.BackendConnections.getClient(backendName).write(address, encodedValue.bus, element);\n\n                  if (!allowDuplicates) {\n                    element.lastSentValue = encodedValue.raw;\n                  }\n                }\n              }\n            }\n          });\n        }\n      }\n    },\n\n    /**\n     * Creates a 'stateUpdate' event with the transformed value and dispatches it to the <cv-address>-Element.\n     * @param address {String} address\n     * @param state {variant} state to send\n     */\n    fireStateUpdate(address, state) {\n      if (this.__lastValue !== state || this._element.getAttribute('send-mode') === 'always') {\n        let transform = this._element.getAttribute('transform') || 'raw';\n        let transformedState = cv.Transform.decode({\n          transform: transform,\n          selector: this._element.getAttribute('selector'),\n          ignoreError: this._element.getAttribute('ignore-error') === 'true',\n          variantInfo: this._element.getAttribute('variant'),\n          qos: (this._element.getAttribute('qos') || 0) | 0\n        }, state);\n\n        let mapping = '';\n        if (this._element.hasAttribute('mapping')) {\n          mapping = this._element.getAttribute('mapping');\n          transformedState = cv.Application.structureController.mapValue(mapping, transformedState);\n        }\n        if (this._element.hasAttribute('format')) {\n          transformedState = cv.util.String.sprintf(\n            this._element.getAttribute('format'),\n            transformedState instanceof Date ? transformedState.toLocaleString() : transformedState\n          );\n        }\n        let targetConfig = this._element.hasAttribute('target') ? this._element.getAttribute('target').split(':') : [];\n        const target = targetConfig.length > 0 ? targetConfig.shift() : '';\n        const ev = new CustomEvent('stateUpdate', {\n          bubbles: true,\n          cancelable: true,\n          detail: {\n            address: this._element.textContent.trim(),\n            state: transformedState,\n            target: target,\n            targetConfig: targetConfig,\n            raw: state,\n            mapping: mapping,\n            addressValue: this._element.hasAttribute('value') ? this._element.getAttribute('value') : null,\n            source: this,\n            variant: this._element.hasAttribute('variant') ? this._element.getAttribute('variant') : null\n          }\n        });\n\n        this.__transformedValue = transformedState;\n        //console.log(ev.detail);\n        this._element.dispatchEvent(ev);\n        this.__lastValue = state;\n        // reset lastSentValue\n        if (state !== this._element.lastSentValue) {\n          this._element.lastSentValue = null;\n        }\n      }\n    },\n\n    /**\n     *\n     * @return {boolean} true if this is a read address\n     */\n    isRead() {\n      return this._element.getAttribute('mode') !== 'write';\n    },\n\n    /**\n     *\n     * @return {boolean} true if this is a write address\n     */\n    isWrite() {\n      return this._element.getAttribute('mode') !== 'read';\n    },\n\n    getValue() {\n      return this.__transformedValue;\n    }\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'address',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}