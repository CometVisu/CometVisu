{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "construct",
    "element",
    "constructor",
    "call",
    "__cache",
    "members",
    "_applyConnected",
    "value",
    "oldValue",
    "name",
    "Mapping",
    "superclass",
    "prototype",
    "_element",
    "tagName",
    "toLowerCase",
    "endsWith",
    "Application",
    "structureController",
    "addMapping",
    "getAttribute",
    "removeMapping",
    "mapValue",
    "val",
    "store",
    "params",
    "_this",
    "Object",
    "hasOwnProperty",
    "mappedValue",
    "exactMatch",
    "querySelector",
    "type",
    "hasAttribute",
    "_convert",
    "innerHTML",
    "trim",
    "formula",
    "_formula",
    "content",
    "textContent",
    "Function",
    "entries",
    "querySelectorAll",
    "defaultValue",
    "mapped",
    "Array",
    "from",
    "some",
    "entry",
    "matches",
    "isDefaultValue",
    "rangeMin",
    "parseFloat",
    "rangeMax",
    "Number",
    "POSITIVE_INFINITY",
    "floatValue",
    "parseInt",
    "destruct",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_inherits",
    "_class",
    "_super",
    "_createSuper",
    "_classCallCheck",
    "_createClass",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/Mapping.js"
  ],
  "sourcesContent": [
    "/* Mapping.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Mapping maps a value to another value that can be used to show e.g. the current state.\n * @author Tobias Br√§utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.Mapping', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct(element) {\n    super(element);\n    this.__cache = {};\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __cache: null,\n\n    _applyConnected(value, oldValue, name) {\n      super._applyConnected(value, oldValue, name);\n      // avoid adding styling elements here as they inherit this method but call the super method too\n      if (this._element.tagName.toLowerCase().endsWith('mapping')) {\n        if (value) {\n          cv.Application.structureController.addMapping(this._element.getAttribute('name'), this);\n        } else {\n          cv.Application.structureController.removeMapping(this._element.getAttribute('name'));\n        }\n      }\n    },\n\n    /**\n     *\n     * @param val {variant}\n     * @param store {Map<string, variant>?} optional stored values from other addresses\n     * @param params {Array<variant>?} optional array of parameters for the mapping\n     * @return {string|*|string}\n     */\n    mapValue(val, store, params) {\n      if (Object.prototype.hasOwnProperty.call(this.__cache, val)) {\n        return this.__cache[val];\n      }\n      let mappedValue = '' + val;\n      const exactMatch = this._element.querySelector(':scope > entry[value=\"' + val + '\"]');\n\n      let type = this._element.hasAttribute('type') ? this._element.getAttribute('type') : 'string';\n      if (exactMatch) {\n        mappedValue = this._convert(exactMatch.innerHTML.trim(), type);\n        this.__cache[val] = mappedValue;\n        return mappedValue;\n      }\n      const formula = this._element.querySelector(':scope > formula');\n      if (formula) {\n        if (!formula._formula) {\n          let content = formula.textContent;\n          formula._formula = new Function('x', 'store', 'params', 'let y;' + content + '; return y;');\n        }\n        mappedValue = this._convert(formula._formula(val, store, params), type);\n        return mappedValue;\n      }\n      const entries = this._element.querySelectorAll(':scope > entry');\n      let defaultValue = null;\n\n      const mapped = Array.from(entries).some(entry => {\n        let matches = false;\n        let isDefaultValue = entry.hasAttribute('default') && entry.getAttribute('default') === 'true';\n        if (entry.hasAttribute('value')) {\n          const value = entry.getAttribute('value');\n          if (value === (val ? val : 'NULL') || value === '*') {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = this._convert(value, type);\n          }\n        } else if (entry.hasAttribute('range-min')) {\n          const rangeMin = parseFloat(entry.getAttribute('range-min'));\n          const rangeMax = entry.hasAttribute('range-max')\n            ? parseFloat(entry.getAttribute('range-max'))\n            : Number.POSITIVE_INFINITY;\n          const floatValue = parseFloat(val);\n          if (rangeMin <= floatValue && floatValue <= rangeMax) {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = rangeMin;\n          }\n        }\n        return matches;\n      });\n      if (!mapped && defaultValue !== null) {\n        mappedValue = this.mapValue(defaultValue);\n      }\n      this.__cache[val] = mappedValue;\n      return mappedValue;\n    },\n\n    _convert(value, type) {\n      switch (type.toLowerCase()) {\n        case 'boolean':\n          return value === 'true';\n        case 'integer':\n          return parseInt(value);\n        case 'float':\n          return parseFloat(value);\n        default:\n          return value;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    this.__cache = null;\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'mapping',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}