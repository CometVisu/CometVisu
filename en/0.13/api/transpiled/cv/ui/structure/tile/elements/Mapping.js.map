{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/Mapping.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "construct",
    "element",
    "__cache",
    "members",
    "_applyConnected",
    "value",
    "oldValue",
    "name",
    "_element",
    "tagName",
    "toLowerCase",
    "endsWith",
    "Application",
    "structureController",
    "addMapping",
    "getAttribute",
    "removeMapping",
    "mapValue",
    "val",
    "store",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "mappedValue",
    "exactMatch",
    "querySelector",
    "type",
    "hasAttribute",
    "_convert",
    "innerHTML",
    "trim",
    "formula",
    "_formula",
    "content",
    "textContent",
    "Function",
    "entries",
    "querySelectorAll",
    "defaultValue",
    "mapped",
    "Array",
    "from",
    "some",
    "entry",
    "matches",
    "isDefaultValue",
    "rangeMin",
    "parseFloat",
    "rangeMax",
    "Number",
    "POSITIVE_INFINITY",
    "floatValue",
    "parseInt",
    "destruct",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Mapping"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Mapping.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Mapping maps a value to another value that can be used to show e.g. the current state.\n * @author Tobias Br√§utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.Mapping', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function (element) {\n    this.base(arguments, element);\n    this.__cache = {};\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __cache: null,\n\n    _applyConnected(value, oldValue, name) {\n      this.base(arguments, value, oldValue, name);\n      // avoid adding styling elements here as they inherit this method but call the super method too\n      if (this._element.tagName.toLowerCase().endsWith('mapping')) {\n        if (value) {\n          cv.Application.structureController.addMapping(this._element.getAttribute('name'), this);\n        } else {\n          cv.Application.structureController.removeMapping(this._element.getAttribute('name'));\n        }\n      }\n    },\n\n    /**\n     *\n     * @param val {variant}\n     * @param store {Map<string, variant>?} optional stored values from other addresses\n     * @return {string|*|string}\n     */\n    mapValue(val, store) {\n      if (Object.prototype.hasOwnProperty.call(this.__cache, val)) {\n        return this.__cache[val];\n      }\n      let mappedValue = '' + val;\n      const exactMatch = this._element.querySelector(':scope > entry[value=\"'+val+'\"]');\n      let type = this._element.hasAttribute('type') ? this._element.getAttribute('type') : 'string';\n      if (exactMatch) {\n        mappedValue = this._convert(exactMatch.innerHTML.trim(), type);\n        this.__cache[val] = mappedValue;\n        return mappedValue;\n      }\n      const formula = this._element.querySelector(':scope > formula');\n      if (formula) {\n        if (!formula._formula) {\n          let content = formula.textContent;\n          formula._formula = new Function('x', 'store', 'let y;' + content + '; return y;');\n        }\n        mappedValue = this._convert(formula._formula(val, store), type);\n        return mappedValue;\n      }\n      const entries = this._element.querySelectorAll(':scope > entry');\n      let defaultValue = null;\n\n      const mapped = Array.from(entries).some(entry => {\n        let matches = false;\n        let isDefaultValue = entry.hasAttribute('default') && entry.getAttribute('default') === 'true';\n        if (entry.hasAttribute('value')) {\n          const value = entry.getAttribute('value');\n          if (value === (val ? val : 'NULL') || value === '*') {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = this._convert(value, type);\n          }\n        } else if (entry.hasAttribute('range-min')) {\n          const rangeMin = parseFloat(entry.getAttribute('range-min'));\n          const rangeMax = entry.hasAttribute('range-max') ? parseFloat(entry.getAttribute('range-max')) : Number.POSITIVE_INFINITY;\n          const floatValue = parseFloat(val);\n          if (rangeMin <= floatValue && floatValue <= rangeMax) {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = rangeMin;\n          }\n        }\n        return matches;\n      });\n      if (!mapped && defaultValue !== null) {\n        mappedValue = this.mapValue(defaultValue);\n      }\n      this.__cache[val] = mappedValue;\n      return mappedValue;\n    },\n\n    _convert(value, type) {\n      switch (type.toLowerCase()) {\n        case 'boolean':\n          return value === 'true';\n        case 'integer':\n          return parseInt(value);\n        case 'float':\n          return parseFloat(value);\n        default:\n          return value;\n      }\n    }\n  },\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this.__cache = null;\n  },\n\n  defer(Clazz) {\n    customElements.define(cv.ui.structure.tile.Controller.PREFIX + 'mapping', class extends QxConnector {\n      constructor() {\n        super(Clazz);\n      }\n    });\n  }\n});\n"
  ]
}