{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "construct",
    "element",
    "__cache",
    "members",
    "_applyConnected",
    "value",
    "oldValue",
    "name",
    "_element",
    "tagName",
    "toLowerCase",
    "endsWith",
    "Application",
    "structureController",
    "addMapping",
    "getAttribute",
    "removeMapping",
    "mapValue",
    "val",
    "store",
    "params",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "mappedValue",
    "exactMatch",
    "querySelector",
    "type",
    "hasAttribute",
    "_convert",
    "innerHTML",
    "trim",
    "formula",
    "_formula",
    "content",
    "textContent",
    "Function",
    "entries",
    "querySelectorAll",
    "defaultValue",
    "mapped",
    "Array",
    "from",
    "some",
    "entry",
    "matches",
    "isDefaultValue",
    "rangeMin",
    "parseFloat",
    "rangeMax",
    "Number",
    "POSITIVE_INFINITY",
    "floatValue",
    "parseInt",
    "destruct",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Mapping"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/Mapping.js"
  ],
  "sourcesContent": [
    "/* Mapping.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Mapping maps a value to another value that can be used to show e.g. the current state.\n * @author Tobias Br√§utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.Mapping', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct(element) {\n    super(element);\n    this.__cache = {};\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __cache: null,\n\n    _applyConnected(value, oldValue, name) {\n      super._applyConnected(value, oldValue, name);\n      // avoid adding styling elements here as they inherit this method but call the super method too\n      if (this._element.tagName.toLowerCase().endsWith('mapping')) {\n        if (value) {\n          cv.Application.structureController.addMapping(this._element.getAttribute('name'), this);\n        } else {\n          cv.Application.structureController.removeMapping(this._element.getAttribute('name'));\n        }\n      }\n    },\n\n    /**\n     *\n     * @param val {variant}\n     * @param store {Map<string, variant>?} optional stored values from other addresses\n     * @param params {Array<variant>?} optional array of parameters for the mapping\n     * @return {string|*|string}\n     */\n    mapValue(val, store, params) {\n      if (Object.prototype.hasOwnProperty.call(this.__cache, val)) {\n        return this.__cache[val];\n      }\n      let mappedValue = '' + val;\n      const exactMatch = this._element.querySelector(':scope > entry[value=\"' + val + '\"]');\n\n      let type = this._element.hasAttribute('type') ? this._element.getAttribute('type') : 'string';\n      if (exactMatch) {\n        mappedValue = this._convert(exactMatch.innerHTML.trim(), type);\n        this.__cache[val] = mappedValue;\n        return mappedValue;\n      }\n      const formula = this._element.querySelector(':scope > formula');\n      if (formula) {\n        if (!formula._formula) {\n          let content = formula.textContent;\n          formula._formula = new Function('x', 'store', 'params', 'let y;' + content + '; return y;');\n        }\n        mappedValue = this._convert(formula._formula(val, store, params), type);\n        return mappedValue;\n      }\n      const entries = this._element.querySelectorAll(':scope > entry');\n      let defaultValue = null;\n\n      const mapped = Array.from(entries).some(entry => {\n        let matches = false;\n        let isDefaultValue = entry.hasAttribute('default') && entry.getAttribute('default') === 'true';\n        if (entry.hasAttribute('value')) {\n          const value = entry.getAttribute('value');\n          if (value === (val ? val : 'NULL') || value === '*') {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = this._convert(value, type);\n          }\n        } else if (entry.hasAttribute('range-min')) {\n          const rangeMin = parseFloat(entry.getAttribute('range-min'));\n          const rangeMax = entry.hasAttribute('range-max')\n            ? parseFloat(entry.getAttribute('range-max'))\n            : Number.POSITIVE_INFINITY;\n          const floatValue = parseFloat(val);\n          if (rangeMin <= floatValue && floatValue <= rangeMax) {\n            mappedValue = this._convert(entry.innerHTML.trim(), type);\n            matches = true;\n          }\n          if (isDefaultValue) {\n            defaultValue = rangeMin;\n          }\n        }\n        return matches;\n      });\n      if (!mapped && defaultValue !== null) {\n        mappedValue = this.mapValue(defaultValue);\n      }\n      this.__cache[val] = mappedValue;\n      return mappedValue;\n    },\n\n    _convert(value, type) {\n      switch (type.toLowerCase()) {\n        case 'boolean':\n          return value === 'true';\n        case 'integer':\n          return parseInt(value);\n        case 'float':\n          return parseFloat(value);\n        default:\n          return value;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    this.__cache = null;\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'mapping',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}