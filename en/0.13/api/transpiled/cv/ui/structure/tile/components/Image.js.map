{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MVisibility",
    "MRefresh",
    "members",
    "_downloadedImage",
    "_url",
    "_headers",
    "_request",
    "_init",
    "_this",
    "element",
    "_element",
    "img",
    "querySelector",
    "document",
    "createElement",
    "appendChild",
    "addEventListener",
    "refresh",
    "src",
    "getAttribute",
    "base",
    "window",
    "location",
    "origin",
    "substring",
    "pathname",
    "URL",
    "useProxy",
    "hasAttribute",
    "io",
    "rest",
    "Client",
    "getBaseUrl",
    "searchParams",
    "set",
    "toLowerCase",
    "btoa",
    "error",
    "_loadImage",
    "setRefresh",
    "parseInt",
    "_this2",
    "Object",
    "keys",
    "length",
    "request",
    "XMLHttpRequest",
    "responseType",
    "open",
    "toString",
    "forEach",
    "name",
    "setRequestHeader",
    "onreadystatechange",
    "e",
    "readyState",
    "DONE",
    "status",
    "createObjectURL",
    "response",
    "onload",
    "revokeObjectURL",
    "send",
    "Math",
    "random",
    "onStateUpdate",
    "ev",
    "Image",
    "superclass",
    "prototype",
    "call",
    "detail",
    "target",
    "state",
    "debug",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_class",
    "_classCallCheck",
    "_callSuper",
    "_inherits",
    "_createClass",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Image.js"
  ],
  "sourcesContent": [
    "/* Image.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows an image.\n *\n * HINT: Proxy mode needs an PHP environment with php-curl installed.\n */\nqx.Class.define('cv.ui.structure.tile.components.Image', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: [cv.ui.structure.tile.MVisibility, cv.ui.structure.tile.MRefresh],\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _downloadedImage: null,\n    _url: null,\n    _headers: null,\n    _request: null,\n\n    _init() {\n      const element = this._element;\n      let img = element.querySelector(':scope > img');\n      if (!img) {\n        img = document.createElement('img');\n        element.appendChild(img);\n      }\n      element.addEventListener('click', () => this.refresh());\n      let src = element.getAttribute('src');\n      let base = window.location.origin;\n      if (src.substring(0, 1) !== '/' && src.substring(0, 4) !== 'http') {\n        // relative url\n        base += window.location.pathname;\n      }\n      this._url = new URL(src, base);\n      const useProxy = element.hasAttribute('proxy') && element.getAttribute('proxy') === 'true';\n      if (useProxy) {\n        this._url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n\n        this._url.searchParams.set('url', element.getAttribute('src'));\n      }\n      this._headers = {};\n      if (element.hasAttribute('auth-type')) {\n        if (useProxy) {\n          this._url.searchParams.set('auth-type', element.getAttribute('auth-type').toLowerCase());\n        } else {\n          switch (element.getAttribute('auth-type').toLowerCase()) {\n            case 'basic':\n              this._headers['Authorization'] = 'Basic ' + window.btoa(element.getAttribute('username') + ':' + element.getAttribute('password'));\n              break;\n\n            case 'bearer':\n              this._headers['Authorization'] = 'Bearer ' + element.getAttribute('username');\n              break;\n\n            default:\n              this.error('unknown authorization type' +  element.getAttribute('auth-type'));\n              break;\n          }\n        }\n      }\n      this._loadImage();\n      if (element.hasAttribute('refresh')) {\n        this.setRefresh(parseInt(element.getAttribute('refresh')));\n      }\n    },\n\n    _loadImage() {\n      let img = this._element.querySelector(':scope > img');\n      if (Object.keys(this._headers).length > 0) {\n        let request = new XMLHttpRequest();\n        request.responseType = 'blob';\n        request.open('get', this._url.toString(), true);\n        Object.keys(this._headers).forEach(name => {\n          request.setRequestHeader(name, this._headers[name]);\n        });\n        request.onreadystatechange = e => {\n          if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {\n            img.src = URL.createObjectURL(request.response);\n            img.onload = () => {\n              URL.revokeObjectURL(img.src);\n            };\n          }\n        };\n        request.send(null);\n      } else {\n        img.src = this._url.toString();\n      }\n    },\n\n    refresh() {\n      let img = this._element.querySelector(':scope > img');\n      if (img) {\n        this._url.searchParams.set('r', '' + Math.random());\n        this._loadImage();\n      }\n    },\n\n    /**\n     * Handles the incoming data from the backend for this widget\n     *\n     * @param ev {CustomEvent} stateUpdate event fired from a cv-address component\n     */\n    onStateUpdate(ev) {\n      if (!super.onStateUpdate(ev)) {\n        if (ev.detail.target === 'refresh') {\n          if (ev.detail.state) {\n            this.refresh();\n          }\n        } else {\n          this.debug('unhandled address target', ev.detail.target);\n        }\n      }\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'image',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}