{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MVisibility",
    "MRefresh",
    "members",
    "_downloadedImage",
    "_url",
    "_headers",
    "_request",
    "_init",
    "element",
    "_element",
    "img",
    "querySelector",
    "document",
    "createElement",
    "appendChild",
    "addEventListener",
    "refresh",
    "src",
    "getAttribute",
    "base",
    "window",
    "location",
    "origin",
    "substring",
    "pathname",
    "URL",
    "useProxy",
    "hasAttribute",
    "io",
    "rest",
    "Client",
    "getBaseUrl",
    "searchParams",
    "set",
    "toLowerCase",
    "btoa",
    "error",
    "_loadImage",
    "setRefresh",
    "parseInt",
    "Object",
    "keys",
    "length",
    "request",
    "XMLHttpRequest",
    "responseType",
    "open",
    "toString",
    "forEach",
    "name",
    "setRequestHeader",
    "onreadystatechange",
    "e",
    "readyState",
    "DONE",
    "status",
    "createObjectURL",
    "response",
    "onload",
    "revokeObjectURL",
    "send",
    "Math",
    "random",
    "onStateUpdate",
    "ev",
    "detail",
    "target",
    "state",
    "debug",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Image"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Image.js"
  ],
  "sourcesContent": [
    "/* Image.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows an image.\n *\n * HINT: Proxy mode needs an PHP environment with php-curl installed.\n */\nqx.Class.define('cv.ui.structure.tile.components.Image', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: [cv.ui.structure.tile.MVisibility, cv.ui.structure.tile.MRefresh],\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _downloadedImage: null,\n    _url: null,\n    _headers: null,\n    _request: null,\n\n    _init() {\n      const element = this._element;\n      let img = element.querySelector(':scope > img');\n      if (!img) {\n        img = document.createElement('img');\n        element.appendChild(img);\n      }\n      element.addEventListener('click', () => this.refresh());\n      let src = element.getAttribute('src');\n      let base = window.location.origin;\n      if (src.substring(0, 1) !== '/' && src.substring(0, 4) !== 'http') {\n        // relative url\n        base += window.location.pathname;\n      }\n      this._url = new URL(src, base);\n      const useProxy = element.hasAttribute('proxy') && element.getAttribute('proxy') === 'true';\n      if (useProxy) {\n        this._url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n\n        this._url.searchParams.set('url', element.getAttribute('src'));\n      }\n      this._headers = {};\n      if (element.hasAttribute('auth-type')) {\n        if (useProxy) {\n          this._url.searchParams.set('auth-type', element.getAttribute('auth-type').toLowerCase());\n        } else {\n          switch (element.getAttribute('auth-type').toLowerCase()) {\n            case 'basic':\n              this._headers['Authorization'] = 'Basic ' + window.btoa(element.getAttribute('username') + ':' + element.getAttribute('password'));\n              break;\n\n            case 'bearer':\n              this._headers['Authorization'] = 'Bearer ' + element.getAttribute('username');\n              break;\n\n            default:\n              this.error('unknown authorization type' +  element.getAttribute('auth-type'));\n              break;\n          }\n        }\n      }\n      this._loadImage();\n      if (element.hasAttribute('refresh')) {\n        this.setRefresh(parseInt(element.getAttribute('refresh')));\n      }\n    },\n\n    _loadImage() {\n      let img = this._element.querySelector(':scope > img');\n      if (Object.keys(this._headers).length > 0) {\n        let request = new XMLHttpRequest();\n        request.responseType = 'blob';\n        request.open('get', this._url.toString(), true);\n        Object.keys(this._headers).forEach(name => {\n          request.setRequestHeader(name, this._headers[name]);\n        });\n        request.onreadystatechange = e => {\n          if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {\n            img.src = URL.createObjectURL(request.response);\n            img.onload = () => {\n              URL.revokeObjectURL(img.src);\n            };\n          }\n        };\n        request.send(null);\n      } else {\n        img.src = this._url.toString();\n      }\n    },\n\n    refresh() {\n      let img = this._element.querySelector(':scope > img');\n      if (img) {\n        this._url.searchParams.set('r', '' + Math.random());\n        this._loadImage();\n      }\n    },\n\n    /**\n     * Handles the incoming data from the backend for this widget\n     *\n     * @param ev {CustomEvent} stateUpdate event fired from a cv-address component\n     */\n    onStateUpdate(ev) {\n      if (!super.onStateUpdate(ev)) {\n        if (ev.detail.target === 'refresh') {\n          if (ev.detail.state) {\n            this.refresh();\n          }\n        } else {\n          this.debug('unhandled address target', ev.detail.target);\n        }\n      }\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'image',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}