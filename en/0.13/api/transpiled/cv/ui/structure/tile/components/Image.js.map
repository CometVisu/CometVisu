{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Image.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MVisibility",
    "MRefresh",
    "members",
    "_downloadedImage",
    "_url",
    "_headers",
    "_request",
    "_init",
    "element",
    "_element",
    "img",
    "querySelector",
    "document",
    "createElement",
    "appendChild",
    "addEventListener",
    "refresh",
    "src",
    "getAttribute",
    "base",
    "window",
    "location",
    "origin",
    "substring",
    "pathname",
    "URL",
    "useProxy",
    "hasAttribute",
    "io",
    "rest",
    "Client",
    "getBaseUrl",
    "searchParams",
    "set",
    "toLowerCase",
    "btoa",
    "_loadImage",
    "setRefresh",
    "parseInt",
    "Object",
    "keys",
    "length",
    "request",
    "XMLHttpRequest",
    "responseType",
    "open",
    "toString",
    "forEach",
    "name",
    "setRequestHeader",
    "onreadystatechange",
    "e",
    "readyState",
    "DONE",
    "status",
    "createObjectURL",
    "response",
    "onload",
    "revokeObjectURL",
    "send",
    "Math",
    "random",
    "onStateUpdate",
    "ev",
    "detail",
    "target",
    "state",
    "debug",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Image"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Image.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows an image.\n *\n * HINT: Proxy mode needs an PHP environment with php-curl installed.\n */\nqx.Class.define('cv.ui.structure.tile.components.Image', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: [cv.ui.structure.tile.MVisibility, cv.ui.structure.tile.MRefresh],\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _downloadedImage: null,\n    _url: null,\n    _headers: null,\n    _request: null,\n\n    _init() {\n      const element = this._element;\n      let img = element.querySelector(':scope > img');\n      if (!img) {\n        img = document.createElement('img');\n        element.appendChild(img);\n      }\n      element.addEventListener('click', () => this.refresh());\n      let src = element.getAttribute('src');\n      let base = window.location.origin;\n      if (src.substring(0, 1) !== '/' && src.substring(0, 4) !== 'http') {\n        // relative url\n        base += window.location.pathname;\n      }\n      this._url = new URL(src, base);\n      const useProxy = element.hasAttribute('proxy') && element.getAttribute('proxy') === 'true';\n      if (useProxy) {\n        this._url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n        this._url.searchParams.set('url', element.getAttribute('src'));\n      }\n      this._headers = {};\n      if (element.hasAttribute('auth-type')) {\n        switch (element.getAttribute('auth-type').toLowerCase()) {\n          case 'basic':\n            if (useProxy) {\n              this._url.searchParams.set('authorization', 'Basic ' + window.btoa(element.getAttribute('username') + ':' + element.getAttribute('password')));\n            } else {\n              this._headers['Authorization'] = 'Basic ' + window.btoa(element.getAttribute('username') + ':' + element.getAttribute('password'));\n            }\n            break;\n        }\n      }\n      this._loadImage();\n      if (element.hasAttribute('refresh')) {\n        this.setRefresh(parseInt(element.getAttribute('refresh')));\n      }\n    },\n\n    _loadImage() {\n      let img = this._element.querySelector(':scope > img');\n      if (Object.keys(this._headers).length > 0) {\n        let request = new XMLHttpRequest();\n        request.responseType = 'blob';\n        request.open('get', this._url.toString(), true);\n        Object.keys(this._headers).forEach(name => {\n          request.setRequestHeader(name, this._headers[name]);\n        });\n        request.onreadystatechange = e => {\n          if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {\n            img.src = URL.createObjectURL(request.response);\n            img.onload = () => {\n              URL.revokeObjectURL(img.src);\n            };\n          }\n        };\n        request.send(null);\n      } else {\n        img.src = this._url.toString();\n      }\n    },\n\n    refresh() {\n      let img = this._element.querySelector(':scope > img');\n      if (img) {\n        this._url.searchParams.set('r', '' + Math.random());\n        this._loadImage();\n      }\n    },\n\n    /**\n     * Handles the incoming data from the backend for this widget\n     *\n     * @param ev {CustomEvent} stateUpdate event fired from a cv-address component\n     */\n    onStateUpdate(ev) {\n      if (!this.base(arguments, ev)) {\n        if (ev.detail.target === 'refresh') {\n          if (ev.detail.state) {\n            this.refresh();\n          }\n        } else {\n          this.debug('unhandled address target', ev.detail.target);\n        }\n      }\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(cv.ui.structure.tile.Controller.PREFIX + 'image', class extends QxConnector {\n      constructor() {\n        super(QxClass);\n      }\n    });\n  }\n});\n"
  ]
}