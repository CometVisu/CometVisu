{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MResize",
    "properties",
    "throttleInterval",
    "check",
    "init",
    "apply",
    "statics",
    "CC_COUNTER",
    "members",
    "__colorChooser",
    "_init",
    "element",
    "_element",
    "hasAttribute",
    "setThrottleInterval",
    "parseInt",
    "getAttribute",
    "mode",
    "popup",
    "querySelector",
    "document",
    "createElement",
    "setAttribute",
    "addresses",
    "querySelectorAll",
    "elem",
    "src",
    "textContent",
    "transform",
    "variantInfo",
    "parser",
    "pure",
    "widgets",
    "ColorChooser",
    "makeAddressListFn",
    "trim",
    "Color",
    "path",
    "props",
    "$$type",
    "classes",
    "layout",
    "colspan",
    "controls",
    "address",
    "getThrottleInterval",
    "parseAttributes",
    "addListener",
    "_onColorChanged",
    "innerHTML",
    "getDomString",
    "appendChild",
    "addEventListener",
    "ev",
    "composedPath",
    "indexOf",
    "getInstance",
    "open",
    "event",
    "Timer",
    "once",
    "_onDomReady",
    "setResizeTarget",
    "invalidateScreensize",
    "color",
    "getColor",
    "rgb",
    "getComponent",
    "v",
    "setValue",
    "__convertToHex",
    "r",
    "g",
    "b",
    "Math",
    "round",
    "toString",
    "padStart",
    "_updateValue",
    "mappedValue",
    "value",
    "target",
    "substring",
    "tagName",
    "toLowerCase",
    "alpha",
    "length",
    "style",
    "opacity",
    "max",
    "backgroundColor",
    "destruct",
    "_disposeObjects",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Color.js"
  ],
  "sourcesContent": [
    "/* Color.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows a html color input\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.components.Color', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: cv.ui.structure.tile.MResize,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    throttleInterval: {\n      check: 'Number',\n      init: 250,\n      apply: '_applyThrottleInterval'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    CC_COUNTER: 0\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __colorChooser: null,\n\n    _init() {\n      const element = this._element;\n      if (element.hasAttribute('throttle-interval')) {\n        this.setThrottleInterval(parseInt(element.getAttribute('throttle-interval')));\n      }\n\n      // init components\n      const mode = element.hasAttribute('mode') ? element.getAttribute('mode') : 'popup';\n      if (mode === 'popup') {\n        let popup = element.querySelector(':scope > cv-popup');\n        if (!popup) {\n          popup = document.createElement('cv-popup');\n          popup.setAttribute('modal', 'true');\n          if (element.hasAttribute('title')) {\n            popup.setAttribute('title', element.getAttribute('title'));\n          }\n          const addresses = {};\n          for (const elem of element.querySelectorAll(':scope > cv-address')) {\n            let src = elem.textContent;\n            let transform = elem.getAttribute('transform');\n            let mode = 1 | 2; // Bit 0 = read, Bit 1 = write  => 1|2 = 3 = readwrite\n            switch (elem.getAttribute('mode')) {\n              case 'disable':\n                mode = 0;\n                break;\n              case 'read':\n                mode = 1;\n                break;\n              case 'write':\n                mode = 2;\n                break;\n              case 'readwrite':\n                mode = 1 | 2;\n                break;\n            }\n            let variantInfo = cv.parser.pure.widgets.ColorChooser.makeAddressListFn(src, transform, mode, elem.getAttribute('variant'));\n            addresses[src.trim()] = {\n              transform: transform,\n              mode: mode,\n              variantInfo: variantInfo[1]\n            };\n          }\n          cv.ui.structure.tile.components.Color.CC_COUNTER++;\n          const path = 'id_0_'+cv.ui.structure.tile.components.Color.CC_COUNTER;\n          const props = {\n            path: path,\n            $$type: 'colorchooser',\n            classes: 'widget colorchooser',\n            layout: {\n              colspan: 1\n            },\n            controls: element.hasAttribute('controls') ? element.getAttribute('controls') : 'triangle',\n            address: addresses,\n            throttleInterval: this.getThrottleInterval()\n          };\n          cv.parser.pure.widgets.ColorChooser.parseAttributes(element, props);\n          this.__colorChooser = new cv.ui.structure.pure.ColorChooser(props);\n          this.__colorChooser.addListener('colorChanged', this._onColorChanged, this);\n          this._onColorChanged();\n          popup.innerHTML = `<div class=\"widget_container\" style=\"margin-top: 24px; max-width: 100vw; width: 320px; max-height: 100vh; min-height: 320px; align-self: center\" id=\"${path}\" data-type=\"colorchooser\">${this.__colorChooser.getDomString()}</div>`;\n          element.appendChild(popup);\n          element.addEventListener('click', ev => {\n            const path = ev.path || (ev.composedPath && ev.composedPath());\n            if (path && path.indexOf(popup) < 0) {\n              popup.getInstance().open();\n            }\n          });\n          qx.event.Timer.once(() => {\n            this.__colorChooser._onDomReady();\n          }, this, 0);\n\n          this.setResizeTarget(popup);\n          this.addListener('resized', () => {\n            this.__colorChooser.invalidateScreensize();\n          });\n        }\n      }\n    },\n\n    _onColorChanged() {\n      const color = this.__colorChooser.getColor();\n      const rgb = color.getComponent('rgb');\n      const v = color.getComponent('v');\n      this.setValue(\n        `#${this.__convertToHex(rgb.r)}${this.__convertToHex(rgb.g)}${this.__convertToHex(rgb.b)}${this.__convertToHex(v)}`\n      );\n    },\n\n    __convertToHex(v) {\n      return Math.round(v * 255)\n        .toString(16)\n        .padStart(2, '0');\n    },\n\n    _updateValue(mappedValue, value) {\n      let target = this._element.querySelector(':scope > .value');\n      const rgb = mappedValue.substring(0, 7);\n      if (target) {\n        const tagName = target.tagName.toLowerCase();\n        const alpha = mappedValue.length === 9 ? parseInt(mappedValue.substring(7, 9), 16) / 255 : 1.0;\n\n        switch (tagName) {\n          case 'cv-icon':\n            target.style.color = rgb;\n            target.style.opacity = Math.max(alpha, 0.2); // do not blend it out totally\n            break;\n        }\n      } else {\n        // only if we do not have another value handler\n        this._element.style.backgroundColor = mappedValue;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._disposeObjects('__colorChooser');\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'color',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}