{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Color.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "properties",
    "throttleInterval",
    "check",
    "init",
    "apply",
    "members",
    "__input",
    "_init",
    "element",
    "_element",
    "hasAttribute",
    "setThrottleInterval",
    "parseInt",
    "getAttribute",
    "_applyThrottleInterval",
    "getThrottleInterval",
    "input",
    "querySelector",
    "document",
    "createElement",
    "setAttribute",
    "appendChild",
    "oninput",
    "__throttled",
    "call",
    "value",
    "util",
    "Function",
    "throttle",
    "onInput",
    "trailing",
    "abort",
    "__sendValue",
    "_updateValue",
    "mappedValue",
    "target",
    "rgb",
    "substring",
    "tagName",
    "toLowerCase",
    "alpha",
    "length",
    "style",
    "color",
    "opacity",
    "Math",
    "max",
    "backgroundColor",
    "onStateUpdate",
    "ev",
    "handled",
    "detail",
    "state",
    "variant",
    "ColorUtil",
    "hsbToRgb",
    "get",
    "round",
    "toString",
    "padStart",
    "setValue",
    "hsvArray",
    "rgbToHsb",
    "hsv",
    "Map",
    "CustomEvent",
    "source",
    "_writeAddresses",
    "filter",
    "addr",
    "forEach",
    "address",
    "dispatchEvent",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "Color"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Color.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows a html color input\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.components.Color', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    throttleInterval: {\n      check: 'Number',\n      init: 250,\n      apply: '_applyThrottleInterval'\n    }\n  },\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __input: null,\n\n    _init() {\n      this.base(arguments);\n      const element = this._element;\n      if (element.hasAttribute('throttle-interval')) {\n        this.setThrottleInterval(parseInt(element.getAttribute('throttle-interval')));\n      } else {\n        this._applyThrottleInterval(this.getThrottleInterval());\n      }\n\n      // init components\n      let input = element.querySelector(':scope > input');\n      if (!input) {\n        input = document.createElement('input');\n        input.setAttribute('type', 'color');\n        element.appendChild(input);\n        input.oninput = () => this.__throttled.call();\n      }\n      this.__input = input;\n    },\n\n    _applyThrottleInterval(value) {\n      if (value > 0) {\n        this.__throttled = cv.util.Function.throttle(this.onInput, value, { trailing: true }, this);\n      } else {\n        // no throttling, direct call\n        this.__throttled = {\n          call: () => this.onInput(),\n          abort: () => {}\n        };\n      }\n    },\n\n    onInput() {\n      this.__sendValue(this.__input.value);\n    },\n\n    _updateValue(mappedValue, value) {\n      let target = this._element.querySelector(':scope > .value');\n      const rgb = mappedValue.substring(0, 7);\n      if (target) {\n        const tagName = target.tagName.toLowerCase();\n        const alpha = mappedValue.length === 9 ? parseInt(mappedValue.substring(7, 9), 16)/255 : 1.0;\n\n        switch (tagName) {\n          case 'cv-icon':\n            target.style.color = rgb;\n            target.style.opacity = Math.max(alpha, 0.05); // do not blend it out totally\n            break;\n        }\n      }\n      const input = this._element.querySelector(':scope > input');\n      input.value = rgb; // this input can't handle the alpha value\n      if (!target) {\n        // only if we do not have another value handler\n        this._element.style.backgroundColor = mappedValue;\n      }\n    },\n\n    onStateUpdate(ev) {\n      let handled = false;\n      if (ev.detail.target) {\n        handled = this.base(arguments, ev);\n      }\n      if (!handled) {\n        const value = ev.detail.state;\n        let rgb;\n        let alpha = '';\n        switch (ev.detail.variant) {\n          case 'hsv':\n            rgb = qx.util.ColorUtil.hsbToRgb([value.get('h'), value.get('s'), 100]);\n            alpha = Math.round(value.get('v')/100 * 255).toString(16).padStart(2, '0');\n            this.setValue(`#${rgb[0].toString(16).padStart(2, '0')}${rgb[1].toString(16).padStart(2, '0')}${rgb[2].toString(16).padStart(2, '0')}${alpha}`);\n            break;\n        }\n      }\n    },\n\n    __sendValue(value) {\n      const hsvArray = qx.util.ColorUtil.rgbToHsb([\n        parseInt(value.substring(1, 3), 16),\n        parseInt(value.substring(3, 5), 16),\n        parseInt(value.substring(5, 7), 16)\n      ]);\n      const hsv = new Map([\n        ['h', hsvArray[0]],\n        ['s', hsvArray[1]],\n        ['v', hsvArray[2]]\n      ]);\n      const ev = new CustomEvent('sendState', {\n        detail: {\n          value: hsv,\n          source: this\n        }\n      });\n      this._writeAddresses.filter(addr => addr.getAttribute('variant') === 'hsv').forEach(address => address.dispatchEvent(ev));\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(cv.ui.structure.tile.Controller.PREFIX + 'color', class extends QxConnector {\n      constructor() {\n        super(QxClass);\n      }\n    });\n  }\n});\n"
  ]
}