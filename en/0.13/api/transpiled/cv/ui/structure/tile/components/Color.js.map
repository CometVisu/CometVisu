{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MResize",
    "properties",
    "throttleInterval",
    "check",
    "init",
    "apply",
    "statics",
    "CC_COUNTER",
    "members",
    "__colorChooser",
    "_init",
    "element",
    "_element",
    "hasAttribute",
    "setThrottleInterval",
    "parseInt",
    "getAttribute",
    "mode",
    "popup",
    "querySelector",
    "document",
    "createElement",
    "setAttribute",
    "addresses",
    "querySelectorAll",
    "elem",
    "src",
    "textContent",
    "transform",
    "variantInfo",
    "parser",
    "pure",
    "widgets",
    "ColorChooser",
    "makeAddressListFn",
    "trim",
    "Color",
    "path",
    "props",
    "$$type",
    "classes",
    "layout",
    "colspan",
    "controls",
    "address",
    "getThrottleInterval",
    "parseAttributes",
    "addListener",
    "_onColorChanged",
    "innerHTML",
    "getDomString",
    "appendChild",
    "addEventListener",
    "ev",
    "indexOf",
    "getInstance",
    "open",
    "event",
    "Timer",
    "once",
    "_onDomReady",
    "setResizeTarget",
    "invalidateScreensize",
    "color",
    "getColor",
    "rgb",
    "getComponent",
    "v",
    "setValue",
    "__convertToHex",
    "r",
    "g",
    "b",
    "Math",
    "round",
    "toString",
    "padStart",
    "_updateValue",
    "mappedValue",
    "value",
    "target",
    "substring",
    "tagName",
    "toLowerCase",
    "alpha",
    "length",
    "style",
    "opacity",
    "max",
    "backgroundColor",
    "destruct",
    "_disposeObjects",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Color.js"
  ],
  "sourcesContent": [
    "/* Color.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows a html color input\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.components.Color', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: cv.ui.structure.tile.MResize,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    throttleInterval: {\n      check: 'Number',\n      init: 250,\n      apply: '_applyThrottleInterval'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    CC_COUNTER: 0\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __colorChooser: null,\n\n    _init() {\n      const element = this._element;\n      if (element.hasAttribute('throttle-interval')) {\n        this.setThrottleInterval(parseInt(element.getAttribute('throttle-interval')));\n      }\n\n      // init components\n      const mode = element.hasAttribute('mode') ? element.getAttribute('mode') : 'popup';\n      if (mode === 'popup') {\n        let popup = element.querySelector(':scope > cv-popup');\n        if (!popup) {\n          popup = document.createElement('cv-popup');\n          popup.setAttribute('modal', 'true');\n          if (element.hasAttribute('title')) {\n            popup.setAttribute('title', element.getAttribute('title'));\n          }\n          const addresses = {};\n          for (const elem of element.querySelectorAll(':scope > cv-address')) {\n            let src = elem.textContent;\n            let transform = elem.getAttribute('transform');\n            let mode = 1 | 2; // Bit 0 = read, Bit 1 = write  => 1|2 = 3 = readwrite\n            switch (elem.getAttribute('mode')) {\n              case 'disable':\n                mode = 0;\n                break;\n              case 'read':\n                mode = 1;\n                break;\n              case 'write':\n                mode = 2;\n                break;\n              case 'readwrite':\n                mode = 1 | 2;\n                break;\n            }\n            let variantInfo = cv.parser.pure.widgets.ColorChooser.makeAddressListFn(src, transform, mode, elem.getAttribute('variant'));\n            addresses[src.trim()] = {\n              transform: transform,\n              mode: mode,\n              variantInfo: variantInfo[1]\n            };\n          }\n          cv.ui.structure.tile.components.Color.CC_COUNTER++;\n          const path = 'id_0_'+cv.ui.structure.tile.components.Color.CC_COUNTER;\n          const props = {\n            path: path,\n            $$type: 'colorchooser',\n            classes: 'widget colorchooser',\n            layout: {\n              colspan: 1\n            },\n            controls: element.hasAttribute('controls') ? element.getAttribute('controls') : 'triangle',\n            address: addresses,\n            throttleInterval: this.getThrottleInterval()\n          };\n          cv.parser.pure.widgets.ColorChooser.parseAttributes(element, props);\n          this.__colorChooser = new cv.ui.structure.pure.ColorChooser(props);\n          this.__colorChooser.addListener('colorChanged', this._onColorChanged, this);\n          this._onColorChanged();\n          popup.innerHTML = `<div class=\"widget_container\" style=\"margin-top: 24px; max-width: 100vw; width: 320px; max-height: 100vh; min-height: 320px; align-self: center\" id=\"${path}\" data-type=\"colorchooser\">${this.__colorChooser.getDomString()}</div>`;\n          element.appendChild(popup);\n          element.addEventListener('click', ev => {\n            if (ev.path.indexOf(popup) < 0) {\n              popup.getInstance().open();\n            }\n          });\n          qx.event.Timer.once(() => {\n            this.__colorChooser._onDomReady();\n          }, this, 0);\n\n          this.setResizeTarget(popup);\n          this.addListener('resized', () => {\n            this.__colorChooser.invalidateScreensize();\n          });\n        }\n      }\n    },\n\n    _onColorChanged() {\n      const color = this.__colorChooser.getColor();\n      const rgb = color.getComponent('rgb');\n      const v = color.getComponent('v');\n      this.setValue(\n        `#${this.__convertToHex(rgb.r)}${this.__convertToHex(rgb.g)}${this.__convertToHex(rgb.b)}${this.__convertToHex(v)}`\n      );\n    },\n\n    __convertToHex(v) {\n      return Math.round(v * 255)\n        .toString(16)\n        .padStart(2, '0');\n    },\n\n    _updateValue(mappedValue, value) {\n      let target = this._element.querySelector(':scope > .value');\n      const rgb = mappedValue.substring(0, 7);\n      if (target) {\n        const tagName = target.tagName.toLowerCase();\n        const alpha = mappedValue.length === 9 ? parseInt(mappedValue.substring(7, 9), 16) / 255 : 1.0;\n\n        switch (tagName) {\n          case 'cv-icon':\n            target.style.color = rgb;\n            target.style.opacity = Math.max(alpha, 0.2); // do not blend it out totally\n            break;\n        }\n      } else {\n        // only if we do not have another value handler\n        this._element.style.backgroundColor = mappedValue;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._disposeObjects('__colorChooser');\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'color',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}