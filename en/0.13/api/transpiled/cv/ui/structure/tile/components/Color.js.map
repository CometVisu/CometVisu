{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MResize",
    "properties",
    "throttleInterval",
    "check",
    "init",
    "apply",
    "statics",
    "CC_COUNTER",
    "members",
    "__colorChooser",
    "_init",
    "_this",
    "element",
    "_element",
    "hasAttribute",
    "setThrottleInterval",
    "parseInt",
    "getAttribute",
    "mode",
    "popup",
    "querySelector",
    "document",
    "createElement",
    "setAttribute",
    "addresses",
    "_iterator",
    "_createForOfIteratorHelper",
    "querySelectorAll",
    "_step",
    "s",
    "n",
    "done",
    "elem",
    "value",
    "src",
    "textContent",
    "transform",
    "variantInfo",
    "parser",
    "pure",
    "widgets",
    "ColorChooser",
    "makeAddressListFn",
    "trim",
    "err",
    "e",
    "f",
    "Color",
    "path",
    "props",
    "$$type",
    "classes",
    "layout",
    "colspan",
    "controls",
    "address",
    "getThrottleInterval",
    "parseAttributes",
    "addListener",
    "_onColorChanged",
    "innerHTML",
    "concat",
    "getDomString",
    "appendChild",
    "addEventListener",
    "ev",
    "composedPath",
    "indexOf",
    "getInstance",
    "open",
    "event",
    "Timer",
    "once",
    "_onDomReady",
    "setResizeTarget",
    "invalidateScreensize",
    "color",
    "getColor",
    "rgb",
    "getComponent",
    "v",
    "setValue",
    "__convertToHex",
    "r",
    "g",
    "b",
    "__P_78_1",
    "Math",
    "round",
    "toString",
    "padStart",
    "_updateValue",
    "mappedValue",
    "target",
    "substring",
    "tagName",
    "toLowerCase",
    "alpha",
    "length",
    "style",
    "opacity",
    "max",
    "backgroundColor",
    "destruct",
    "_disposeObjects",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_class",
    "_classCallCheck",
    "_callSuper",
    "_inherits",
    "_createClass",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Color.js"
  ],
  "sourcesContent": [
    "/* Color.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows a html color input\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.components.Color', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: cv.ui.structure.tile.MResize,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    throttleInterval: {\n      check: 'Number',\n      init: 250,\n      apply: '_applyThrottleInterval'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    CC_COUNTER: 0\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __colorChooser: null,\n\n    _init() {\n      const element = this._element;\n      if (element.hasAttribute('throttle-interval')) {\n        this.setThrottleInterval(parseInt(element.getAttribute('throttle-interval')));\n      }\n\n      // init components\n      const mode = element.hasAttribute('mode') ? element.getAttribute('mode') : 'popup';\n      if (mode === 'popup') {\n        let popup = element.querySelector(':scope > cv-popup');\n        if (!popup) {\n          popup = document.createElement('cv-popup');\n          popup.setAttribute('modal', 'true');\n          if (element.hasAttribute('title')) {\n            popup.setAttribute('title', element.getAttribute('title'));\n          }\n          const addresses = {};\n          for (const elem of element.querySelectorAll(':scope > cv-address')) {\n            let src = elem.textContent;\n            let transform = elem.getAttribute('transform');\n            let mode = 1 | 2; // Bit 0 = read, Bit 1 = write  => 1|2 = 3 = readwrite\n            switch (elem.getAttribute('mode')) {\n              case 'disable':\n                mode = 0;\n                break;\n              case 'read':\n                mode = 1;\n                break;\n              case 'write':\n                mode = 2;\n                break;\n              case 'readwrite':\n                mode = 1 | 2;\n                break;\n            }\n            let variantInfo = cv.parser.pure.widgets.ColorChooser.makeAddressListFn(src, transform, mode, elem.getAttribute('variant'));\n            addresses[src.trim()] = {\n              transform: transform,\n              mode: mode,\n              variantInfo: variantInfo[1]\n            };\n          }\n          cv.ui.structure.tile.components.Color.CC_COUNTER++;\n          const path = 'id_0_'+cv.ui.structure.tile.components.Color.CC_COUNTER;\n          const props = {\n            path: path,\n            $$type: 'colorchooser',\n            classes: 'widget colorchooser',\n            layout: {\n              colspan: 1\n            },\n            controls: element.hasAttribute('controls') ? element.getAttribute('controls') : 'triangle',\n            address: addresses,\n            throttleInterval: this.getThrottleInterval()\n          };\n          cv.parser.pure.widgets.ColorChooser.parseAttributes(element, props);\n          this.__colorChooser = new cv.ui.structure.pure.ColorChooser(props);\n          this.__colorChooser.addListener('colorChanged', this._onColorChanged, this);\n          this._onColorChanged();\n          popup.innerHTML = `<div class=\"widget_container\" style=\"margin-top: 24px; max-width: 100vw; width: 320px; max-height: 100vh; min-height: 320px; align-self: center\" id=\"${path}\" data-type=\"colorchooser\">${this.__colorChooser.getDomString()}</div>`;\n          element.appendChild(popup);\n          element.addEventListener('click', ev => {\n            const path = ev.path || (ev.composedPath && ev.composedPath());\n            if (path && path.indexOf(popup) < 0) {\n              popup.getInstance().open();\n            }\n          });\n          qx.event.Timer.once(() => {\n            this.__colorChooser._onDomReady();\n          }, this, 0);\n\n          this.setResizeTarget(popup);\n          this.addListener('resized', () => {\n            this.__colorChooser.invalidateScreensize();\n          });\n        }\n      }\n    },\n\n    _onColorChanged() {\n      const color = this.__colorChooser.getColor();\n      const rgb = color.getComponent('rgb');\n      const v = color.getComponent('v');\n      this.setValue(\n        `#${this.__convertToHex(rgb.r)}${this.__convertToHex(rgb.g)}${this.__convertToHex(rgb.b)}${this.__convertToHex(v)}`\n      );\n    },\n\n    __convertToHex(v) {\n      return Math.round(v * 255)\n        .toString(16)\n        .padStart(2, '0');\n    },\n\n    _updateValue(mappedValue, value) {\n      let target = this._element.querySelector(':scope > .value');\n      const rgb = mappedValue.substring(0, 7);\n      if (target) {\n        const tagName = target.tagName.toLowerCase();\n        const alpha = mappedValue.length === 9 ? parseInt(mappedValue.substring(7, 9), 16) / 255 : 1.0;\n\n        switch (tagName) {\n          case 'cv-icon':\n            target.style.color = rgb;\n            target.style.opacity = Math.max(alpha, 0.2); // do not blend it out totally\n            break;\n        }\n      } else {\n        // only if we do not have another value handler\n        this._element.style.backgroundColor = mappedValue;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._disposeObjects('__colorChooser');\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'color',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}