{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/MPopup.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Mixin",
    "define",
    "statics",
    "openedPopups",
    "events",
    "closed",
    "members",
    "_childPopup",
    "_initPopupChild",
    "popup",
    "_element",
    "querySelector",
    "event",
    "Registration",
    "addListener",
    "_openPopupChild",
    "parent",
    "parentElement",
    "last",
    "tagName",
    "toLowerCase",
    "classList",
    "add",
    "getInstance",
    "open",
    "_closePopupChild",
    "close",
    "registerModalPopup",
    "document",
    "_onPointerDown",
    "blocker",
    "body",
    "createElement",
    "appendChild",
    "style",
    "display",
    "cv",
    "ui",
    "structure",
    "tile",
    "MPopup",
    "push",
    "unregisterModalPopup",
    "removeListener",
    "index",
    "indexOf",
    "splice",
    "length",
    "ev",
    "util",
    "Tree",
    "isChildOf",
    "getTarget",
    "preventDefault",
    "destruct"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* MPopup.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Handles cv-popup children and some general popup tasks, like global registration and close on click outside, modal blocker etc.\n */\nqx.Mixin.define('cv.ui.structure.tile.MPopup', {\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    openedPopups: []\n  },\n\n  events: {\n    closed: 'qx.event.type.Event'\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _childPopup: null,\n\n    _initPopupChild() {\n      const popup = this._childPopup = this._element.querySelector(':scope > cv-popup');\n      if (popup) {\n        qx.event.Registration.addListener(this._element, 'tap', this._openPopupChild, this);\n        // we need to tell the parent widget that is inside a group that wen have a popup here\n        let parent = popup.parentElement;\n        let last;\n        while (parent) {\n          if (parent.tagName.toLowerCase() === 'cv-group') {\n            last.classList.add('has-popup');\n          } else if (parent.tagName.toLowerCase() === 'cv-page') {\n            break;\n          }\n          last = parent;\n          parent = parent.parentElement;\n        }\n      }\n    },\n\n    _openPopupChild() {\n      const popup = this._element.querySelector(':scope > cv-popup:not([open])');\n      if (popup) {\n        popup.getInstance().open();\n      }\n    },\n\n    _closePopupChild() {\n      const popup = this._element.querySelector(':scope > cv-popup[open]');\n      if (popup) {\n        popup.getInstance().close();\n      }\n    },\n\n    registerModalPopup() {\n      qx.event.Registration.addListener(document, 'pointerdown', this._onPointerDown, this);\n      let blocker = document.body.querySelector('.modal-popup-blocker');\n      if (!blocker) {\n        blocker = document.createElement('div');\n        blocker.classList.add('modal-popup-blocker');\n        document.body.appendChild(blocker);\n      }\n      blocker.style.display = 'block';\n      cv.ui.structure.tile.MPopup.openedPopups.push(this);\n    },\n\n    unregisterModalPopup() {\n      qx.event.Registration.removeListener(document, 'pointerdown', this._onPointerDown, this);\n      const index = cv.ui.structure.tile.MPopup.openedPopups.indexOf(this);\n      cv.ui.structure.tile.MPopup.openedPopups.splice(index, 1);\n      let blocker = document.body.querySelector('.modal-popup-blocker');\n      if (blocker && cv.ui.structure.tile.MPopup.openedPopups.length === 0) {\n        blocker.style.display = 'none';\n      }\n    },\n\n    _onPointerDown(ev) {\n      if (!cv.util.Tree.isChildOf(ev.getTarget(), this._element)) {\n        // clicked outside -> close\n        this.close();\n        ev.preventDefault();\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    qx.event.Registration.removeListener(this._element, 'tap', this._openPopupChild, this);\n    this._childPopup = null;\n  }\n});\n"
  ]
}