{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Mixin",
    "define",
    "construct",
    "_onPointerDownBounded",
    "_onPointerDown",
    "bind",
    "statics",
    "openedPopups",
    "events",
    "closed",
    "members",
    "_childPopup",
    "_initPopupChild",
    "popup",
    "_element",
    "querySelector",
    "event",
    "Registration",
    "addListener",
    "_openPopupChild",
    "parent",
    "parentElement",
    "last",
    "tagName",
    "toLowerCase",
    "classList",
    "add",
    "getInstance",
    "open",
    "_closePopupChild",
    "close",
    "registerModalPopup",
    "document",
    "addEventListener",
    "blocker",
    "body",
    "createElement",
    "appendChild",
    "style",
    "display",
    "cv",
    "ui",
    "structure",
    "tile",
    "MPopup",
    "push",
    "unregisterModalPopup",
    "removeEventListener",
    "index",
    "indexOf",
    "splice",
    "length",
    "ev",
    "util",
    "Tree",
    "isChildOf",
    "target",
    "preventDefault",
    "stopImmediatePropagation",
    "Timer",
    "once",
    "destruct",
    "removeListener"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/MPopup.js"
  ],
  "sourcesContent": [
    "/* MPopup.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Handles cv-popup children and some general popup tasks, like global registration and close on click outside, modal blocker etc.\n */\nqx.Mixin.define('cv.ui.structure.tile.MPopup', {\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    this._onPointerDownBounded = this._onPointerDown.bind(this);\n  },\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    openedPopups: []\n  },\n\n  events: {\n    closed: 'qx.event.type.Event'\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _childPopup: null,\n    _onPointerDownBounded: null,\n\n    _initPopupChild() {\n      const popup = (this._childPopup = this._element.querySelector(':scope > cv-popup'));\n      if (popup) {\n        qx.event.Registration.addListener(this._element, 'tap', this._openPopupChild, this);\n\n        // we need to tell the parent widget that is inside a group that wen have a popup here\n        let parent = popup.parentElement;\n        let last;\n        while (parent) {\n          if (parent.tagName.toLowerCase() === 'cv-group') {\n            last.classList.add('has-popup');\n          } else if (parent.tagName.toLowerCase() === 'cv-page') {\n            break;\n          }\n          last = parent;\n          parent = parent.parentElement;\n        }\n      }\n    },\n\n    _openPopupChild() {\n      const popup = this._element.querySelector(':scope > cv-popup:not([open])');\n\n      if (popup) {\n        popup.getInstance().open();\n      }\n    },\n\n    _closePopupChild() {\n      const popup = this._element.querySelector(':scope > cv-popup[open]');\n      if (popup) {\n        popup.getInstance().close();\n      }\n    },\n\n    registerModalPopup() {\n      document.addEventListener('pointerup', this._onPointerDownBounded);\n\n      let blocker = document.body.querySelector('.modal-popup-blocker');\n      if (!blocker) {\n        blocker = document.createElement('div');\n        blocker.classList.add('modal-popup-blocker');\n        document.body.appendChild(blocker);\n      }\n      blocker.style.display = 'block';\n      cv.ui.structure.tile.MPopup.openedPopups.push(this);\n    },\n\n    unregisterModalPopup() {\n      document.removeEventListener('pointerup', this._onPointerDownBounded);\n\n      const index = cv.ui.structure.tile.MPopup.openedPopups.indexOf(this);\n      cv.ui.structure.tile.MPopup.openedPopups.splice(index, 1);\n      let blocker = document.body.querySelector('.modal-popup-blocker');\n      if (blocker && cv.ui.structure.tile.MPopup.openedPopups.length === 0) {\n        blocker.style.display = 'none';\n      }\n    },\n\n    _onPointerDown(ev) {\n      if (!cv.util.Tree.isChildOf(ev.target, this._element)) {\n        ev.preventDefault();\n        ev.stopImmediatePropagation();\n        // clicked outside -> close (with delay to capture composed events)\n        qx.event.Timer.once(this.close, this, 100);\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    qx.event.Registration.removeListener(this._element, 'tap', this._openPopupChild, this);\n\n    this._childPopup = null;\n  }\n});\n"
  ],
  "mappings": "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"
}