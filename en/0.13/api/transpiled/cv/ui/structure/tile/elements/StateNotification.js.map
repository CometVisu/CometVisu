{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "members",
    "_init",
    "stateConfig",
    "elem",
    "_element",
    "target",
    "core",
    "notifications",
    "Router",
    "getTarget",
    "getAttribute",
    "NotificationCenter",
    "getInstance",
    "addressContainer",
    "querySelector",
    "config",
    "severity",
    "skipInitial",
    "deletable",
    "unique",
    "valueMapping",
    "addressMapping",
    "enabled",
    "hasAttribute",
    "id",
    "model",
    "data",
    "Model",
    "addUpdateListener",
    "concat",
    "_onStateUpdate",
    "onUpdate",
    "name",
    "topic",
    "icon",
    "iconClasses",
    "titleElem",
    "titleTemplate",
    "innerHTML",
    "messageElem",
    "messageTemplate",
    "conditionElem",
    "condition",
    "textContent",
    "address",
    "_iterator",
    "_createForOfIteratorHelper",
    "querySelectorAll",
    "_step",
    "s",
    "n",
    "done",
    "addressElement",
    "value",
    "trim",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "addressConfig",
    "assign",
    "mode",
    "transform",
    "selector",
    "ignoreError",
    "qos",
    "retain",
    "variantInfo",
    "push",
    "err",
    "e",
    "f",
    "registerStateUpdateHandler",
    "state",
    "initial",
    "changed",
    "_address$split",
    "split",
    "_address$split2",
    "_slicedToArray",
    "property",
    "router",
    "enableStateUpdateHandler",
    "changeStateUpdateHandlerSeverity",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "_QxConnector",
    "_class",
    "_classCallCheck",
    "_callSuper",
    "_inherits",
    "_createClass",
    "QxConnector",
    "StateNotification"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/StateNotification.js"
  ],
  "sourcesContent": [
    "/* StateNotification.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Parse notification settings and load them into the cv.core.notifications.Router\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.StateNotification', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _init() {\n    const stateConfig = {};\n    const elem = this._element;\n    const target =\n      cv.core.notifications.Router.getTarget(elem.getAttribute('target')) || cv.ui.NotificationCenter.getInstance();\n\n    const addressContainer = elem.querySelector('cv-addresses');\n\n    const config = {\n      target: target,\n      severity: elem.getAttribute('severity'),\n      skipInitial: elem.getAttribute('skip-initial') !== 'false',\n      deletable: elem.getAttribute('deletable') !== 'false',\n      unique: elem.getAttribute('unique') === 'true',\n      valueMapping: addressContainer.getAttribute('value-mapping'),\n      addressMapping: addressContainer.getAttribute('address-mapping'),\n      enabled: !elem.hasAttribute('enabled') || elem.getAttribute('enabled') === 'true'\n    };\n    if (elem.hasAttribute('id')) {\n      config.id = elem.getAttribute('id');\n      // notifications with id can be changed by the system backend, so we need to listen to some addresses\n      const model = cv.data.Model.getInstance();\n      model.addUpdateListener(`notification:${config.id}:enabled`, this._onStateUpdate, this, 'system');\n      model.addUpdateListener(`notification:${config.id}:severity`, this._onStateUpdate, this, 'system');\n\n      model.onUpdate(`notification:${config.id}:enabled`, config.enabled, 'system');\n      model.onUpdate(`notification:${config.id}:severity`, config.severity, 'system');\n    }\n\n    const name = elem.getAttribute('name');\n    if (name) {\n      config.topic = 'cv.state.' + name;\n    }\n    const icon = elem.getAttribute('icon');\n    if (icon) {\n      config.icon = icon;\n      const iconClasses = elem.getAttribute('icon-classes');\n      if (iconClasses) {\n        config.iconClasses = iconClasses;\n      }\n    }\n\n    // templates\n    const titleElem = elem.querySelector('cv-title-template');\n    if (titleElem) {\n      config.titleTemplate = titleElem.innerHTML;\n    }\n    const messageElem = elem.querySelector('cv-message-template');\n    if (messageElem) {\n      config.messageTemplate = messageElem.innerHTML;\n    }\n\n    // condition\n    const conditionElem = elem.querySelector('cv-condition');\n    let condition = conditionElem.textContent;\n    if (condition === 'true') {\n      condition = true;\n    } else if (condition === 'false') {\n      condition = false;\n    }\n    config.condition = condition;\n\n    let address;\n    for (const addressElement of addressContainer.querySelectorAll(':scope > cv-address')) {\n      address = addressElement.textContent.trim();\n      if (!Object.prototype.hasOwnProperty.call(stateConfig, address)) {\n        stateConfig[address] = [];\n      }\n      const addressConfig = Object.assign({}, config);\n      let mode = 1 | 2; // Bit 0 = read, Bit 1 = write  => 1|2 = 3 = readwrite\n      switch (addressElement.getAttribute('mode')) {\n        case 'disable':\n          mode = 0;\n          break;\n        case 'read':\n          mode = 1;\n          break;\n        case 'write':\n          mode = 2;\n          break;\n        case 'readwrite':\n          mode = 1 | 2;\n          break;\n      }\n      addressConfig.addressConfig = {\n        transform: addressElement.getAttribute('transform'),\n        mode: mode,\n        selector: addressElement.getAttribute('selector'),\n        ignoreError: addressElement.getAttribute('ignore-error') === 'true',\n        qos: (addressElement.getAttribute('qos') || 0) | 0, // force integer\n        retain: addressElement.getAttribute('retain') === 'true',\n        variantInfo: addressElement.getAttribute('variant')\n      };\n      stateConfig[address].push(addressConfig);\n    }\n    cv.core.notifications.Router.getInstance().registerStateUpdateHandler(stateConfig);\n  },\n\n    _onStateUpdate(address, state, initial, changed) {\n      const [, id, property] = address.split(':');\n      const router = cv.core.notifications.Router.getInstance();\n      if (property === 'enabled') {\n        router.enableStateUpdateHandler(id, state == 1);\n      } else if (property === 'severity') {\n        router.changeStateUpdateHandlerSeverity(id, state);\n      }\n    }\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'state-notification',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}