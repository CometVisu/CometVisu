{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "elements",
    "AbstractCustomElement",
    "members",
    "_init",
    "stateConfig",
    "elem",
    "_element",
    "target",
    "core",
    "notifications",
    "Router",
    "getTarget",
    "getAttribute",
    "NotificationCenter",
    "getInstance",
    "addressContainer",
    "querySelector",
    "config",
    "severity",
    "skipInitial",
    "deletable",
    "unique",
    "valueMapping",
    "addressMapping",
    "enabled",
    "hasAttribute",
    "id",
    "model",
    "data",
    "Model",
    "addUpdateListener",
    "_onStateUpdate",
    "onUpdate",
    "name",
    "topic",
    "icon",
    "iconClasses",
    "titleElem",
    "titleTemplate",
    "innerHTML",
    "messageElem",
    "messageTemplate",
    "conditionElem",
    "condition",
    "textContent",
    "address",
    "querySelectorAll",
    "addressElement",
    "trim",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "addressConfig",
    "assign",
    "mode",
    "transform",
    "selector",
    "ignoreError",
    "qos",
    "retain",
    "variantInfo",
    "push",
    "registerStateUpdateHandler",
    "state",
    "initial",
    "changed",
    "split",
    "property",
    "router",
    "enableStateUpdateHandler",
    "changeStateUpdateHandlerSeverity",
    "defer",
    "Clazz",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "StateNotification"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/elements/StateNotification.js"
  ],
  "sourcesContent": [
    "/* StateNotification.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Parse notification settings and load them into the cv.core.notifications.Router\n * @author Tobias BrÃ¤utigam\n * @since 2022\n */\nqx.Class.define('cv.ui.structure.tile.elements.StateNotification', {\n  extend: cv.ui.structure.tile.elements.AbstractCustomElement,\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _init() {\n    const stateConfig = {};\n    const elem = this._element;\n    const target =\n      cv.core.notifications.Router.getTarget(elem.getAttribute('target')) || cv.ui.NotificationCenter.getInstance();\n\n    const addressContainer = elem.querySelector('cv-addresses');\n\n    const config = {\n      target: target,\n      severity: elem.getAttribute('severity'),\n      skipInitial: elem.getAttribute('skip-initial') !== 'false',\n      deletable: elem.getAttribute('deletable') !== 'false',\n      unique: elem.getAttribute('unique') === 'true',\n      valueMapping: addressContainer.getAttribute('value-mapping'),\n      addressMapping: addressContainer.getAttribute('address-mapping'),\n      enabled: !elem.hasAttribute('enabled') || elem.getAttribute('enabled') === 'true'\n    };\n    if (elem.hasAttribute('id')) {\n      config.id = elem.getAttribute('id');\n      // notifications with id can be changed by the system backend, so we need to listen to some addresses\n      const model = cv.data.Model.getInstance();\n      model.addUpdateListener(`notification:${config.id}:enabled`, this._onStateUpdate, this, 'system');\n      model.addUpdateListener(`notification:${config.id}:severity`, this._onStateUpdate, this, 'system');\n\n      model.onUpdate(`notification:${config.id}:enabled`, config.enabled, 'system');\n      model.onUpdate(`notification:${config.id}:severity`, config.severity, 'system');\n    }\n\n    const name = elem.getAttribute('name');\n    if (name) {\n      config.topic = 'cv.state.' + name;\n    }\n    const icon = elem.getAttribute('icon');\n    if (icon) {\n      config.icon = icon;\n      const iconClasses = elem.getAttribute('icon-classes');\n      if (iconClasses) {\n        config.iconClasses = iconClasses;\n      }\n    }\n\n    // templates\n    const titleElem = elem.querySelector('cv-title-template');\n    if (titleElem) {\n      config.titleTemplate = titleElem.innerHTML;\n    }\n    const messageElem = elem.querySelector('cv-message-template');\n    if (messageElem) {\n      config.messageTemplate = messageElem.innerHTML;\n    }\n\n    // condition\n    const conditionElem = elem.querySelector('cv-condition');\n    let condition = conditionElem.textContent;\n    if (condition === 'true') {\n      condition = true;\n    } else if (condition === 'false') {\n      condition = false;\n    }\n    config.condition = condition;\n\n    let address;\n    for (const addressElement of addressContainer.querySelectorAll(':scope > cv-address')) {\n      address = addressElement.textContent.trim();\n      if (!Object.prototype.hasOwnProperty.call(stateConfig, address)) {\n        stateConfig[address] = [];\n      }\n      const addressConfig = Object.assign({}, config);\n      let mode = 1 | 2; // Bit 0 = read, Bit 1 = write  => 1|2 = 3 = readwrite\n      switch (addressElement.getAttribute('mode')) {\n        case 'disable':\n          mode = 0;\n          break;\n        case 'read':\n          mode = 1;\n          break;\n        case 'write':\n          mode = 2;\n          break;\n        case 'readwrite':\n          mode = 1 | 2;\n          break;\n      }\n      addressConfig.addressConfig = {\n        transform: addressElement.getAttribute('transform'),\n        mode: mode,\n        selector: addressElement.getAttribute('selector'),\n        ignoreError: addressElement.getAttribute('ignore-error') === 'true',\n        qos: (addressElement.getAttribute('qos') || 0) | 0, // force integer\n        retain: addressElement.getAttribute('retain') === 'true',\n        variantInfo: addressElement.getAttribute('variant')\n      };\n      stateConfig[address].push(addressConfig);\n    }\n    cv.core.notifications.Router.getInstance().registerStateUpdateHandler(stateConfig);\n  },\n\n    _onStateUpdate(address, state, initial, changed) {\n      const [, id, property] = address.split(':');\n      const router = cv.core.notifications.Router.getInstance();\n      if (property === 'enabled') {\n        router.enableStateUpdateHandler(id, state == 1);\n      } else if (property === 'severity') {\n        router.changeStateUpdateHandlerSeverity(id, state);\n      }\n    }\n  },\n\n  defer(Clazz) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'state-notification',\n      class extends QxConnector {\n        constructor() {\n          super(Clazz);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}