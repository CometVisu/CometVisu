{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MPopup",
    "properties",
    "backgroundImage",
    "check",
    "nullable",
    "apply",
    "popup",
    "init",
    "members",
    "_fullScreenMode",
    "_init",
    "_initPopupChild",
    "_element",
    "hasAttribute",
    "setBackgroundImage",
    "getAttribute",
    "_childPopup",
    "addEventListener",
    "resetPopup",
    "_applyBackgroundImage",
    "value",
    "style",
    "overlay",
    "querySelector",
    "document",
    "createElement",
    "classList",
    "add",
    "insertBefore",
    "firstChild",
    "remove",
    "open",
    "_openPopupChild",
    "closeButton",
    "icon",
    "appendChild",
    "setPopup",
    "display",
    "registerModalPopup",
    "close",
    "keepState",
    "_closePopupChild",
    "unregisterModalPopup",
    "_autoCloseTimer",
    "stop",
    "fireEvent",
    "_applyPopup",
    "onStateUpdate",
    "ev",
    "detail",
    "target",
    "state",
    "addressValue",
    "event",
    "Timer",
    "addListener",
    "restart",
    "debug",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector",
    "widgets",
    "Tile"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/widgets/Tile.js"
  ],
  "sourcesContent": [
    "/* Tile.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Shows a tile\n */\nqx.Class.define('cv.ui.structure.tile.widgets.Tile', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: cv.ui.structure.tile.MPopup,\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    backgroundImage: {\n      check: 'String',\n      nullable: true,\n      apply: '_applyBackgroundImage'\n    },\n\n    /**\n     * Turn this tile into a popup\n     */\n    popup: {\n      check: 'Boolean',\n      init: false,\n      apply: '_applyPopup'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _fullScreenMode: null,\n\n    _init() {\n      super._init();\n      this._initPopupChild();\n      if (this._element.hasAttribute('background-image')) {\n        this.setBackgroundImage(this._element.getAttribute('background-image'));\n      }\n      if (this._childPopup) {\n        this._childPopup.addEventListener('closed', () => {\n          this.resetPopup();\n        });\n      }\n    },\n\n    _applyBackgroundImage(value) {\n      if (value) {\n        this._element.style.backgroundImage = `url(${value})`;\n        let overlay = this._element.querySelector(':scope > div.overlay');\n        if (!overlay) {\n          overlay = document.createElement('div');\n          overlay.classList.add('overlay');\n          this._element.insertBefore(overlay, this._element.firstChild);\n        }\n        this._element.classList.add('has-bg-image');\n      } else {\n        this._element.style.backgroundImage = '';\n        this._element.classList.remove('has-bg-image');\n      }\n    },\n\n    open() {\n      if (this._childPopup) {\n        this._openPopupChild();\n      } else {\n        let closeButton = this._element.querySelector(':scope > button.close');\n        if (!closeButton) {\n          closeButton = document.createElement('button');\n          closeButton.classList.add('close');\n          const icon = document.createElement('i');\n          icon.classList.add('ri-close-line');\n          closeButton.appendChild(icon);\n          this._element.appendChild(closeButton);\n          closeButton.addEventListener('click', () => this.setPopup(false));\n        }\n        closeButton.style.display = 'block';\n        this._element.classList.add('popup');\n        if (this._fullScreenMode) {\n          this._element.classList.add('fullscreen');\n        }\n        this.registerModalPopup();\n      }\n    },\n\n    close(keepState) {\n      if (!keepState) {\n        this.setPopup(false);\n      }\n      if (this._childPopup) {\n        this._closePopupChild();\n      } else {\n        this._element.classList.remove('popup');\n        if (this._fullScreenMode) {\n          this._element.classList.remove('fullscreen');\n        }\n        let closeButton = this._element.querySelector(':scope > button.close');\n        if (closeButton) {\n          closeButton.style.display = 'none';\n        }\n        this.unregisterModalPopup();\n      }\n      if (this._autoCloseTimer) {\n        this._autoCloseTimer.stop();\n      }\n      this.fireEvent('closed');\n    },\n\n    _applyPopup(value) {\n      if (value) {\n        this.open();\n      } else {\n        this.close(true);\n      }\n    },\n\n    /**\n     * Handles the incoming data from the backend for this widget\n     *\n     * @param ev {CustomEvent} stateUpdate event fired from a cv-address component\n     */\n    onStateUpdate(ev) {\n      if (!super.onStateUpdate(ev)) {\n        switch (ev.detail.target) {\n          case 'background-image':\n            this.setBackgroundImage(ev.detail.state);\n            break;\n\n          case 'popup':\n          case 'fullscreen-popup':\n            this._fullScreenMode = ev.detail.target === 'fullscreen-popup';\n            if (ev.detail.addressValue) {\n              // only open when the sent value equals the fixed value\n              // noinspection EqualityComparisonWithCoercionJS\n              if (ev.detail.addressValue == ev.detail.state) {\n                this.setPopup(true);\n                // this is not closing by address, so we set a close timeout to 3 minutes\n                if (!this._autoCloseTimer) {\n                  this._autoCloseTimer = new qx.event.Timer(180 * 1000);\n                  this._autoCloseTimer.addListener('interval', this.close, this);\n                }\n                this._autoCloseTimer.restart();\n              }\n            } else {\n              // open / close depending on value\n              // noinspection EqualityComparisonWithCoercionJS\n              this.setPopup(ev.detail.state == 1);\n            }\n            break;\n\n          default:\n            this.debug('unhandled address target', ev.detail.target);\n        }\n      }\n    }\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'tile',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}