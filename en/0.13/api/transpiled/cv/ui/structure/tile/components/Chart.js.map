{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "tile",
    "components",
    "AbstractComponent",
    "include",
    "MVisibility",
    "MRefresh",
    "MResize",
    "statics",
    "ChartCounter",
    "DEFAULT_ASPECT_RATIO",
    "JS_LOADED",
    "Promise",
    "resolve",
    "reject",
    "check",
    "window",
    "d3",
    "util",
    "ScriptLoader",
    "includeScript",
    "ResourceManager",
    "getInstance",
    "toUri",
    "timer",
    "event",
    "Timer",
    "counter",
    "addListener",
    "Error",
    "then",
    "locale",
    "Manager",
    "getLanguage",
    "formatDefaultLocale",
    "decimal",
    "Number",
    "getDecimalSeparator",
    "translate",
    "toString",
    "thousands",
    "getGroupSeparator",
    "grouping",
    "currency",
    "timeFormatDefaultLocale",
    "dateTime",
    "date",
    "time",
    "periods",
    "Date",
    "getAmMarker",
    "getPmMarker",
    "days",
    "getDayNames",
    "map",
    "t",
    "shortDays",
    "months",
    "getMonthNames",
    "shortMonths",
    "CONFIG",
    "properties",
    "currentSeries",
    "init",
    "apply",
    "currentPeriod",
    "startTime",
    "endTime",
    "members",
    "_id",
    "_downloadedImage",
    "_url",
    "_headers",
    "_request",
    "_width",
    "_height",
    "_loaded",
    "_dataSetConfigs",
    "_initializing",
    "_navigationEnabled",
    "__toolTipTimer",
    "__showTooltip",
    "__debouncedOnResize",
    "__resizeTimeout",
    "__startTs",
    "__endTs",
    "_dot",
    "_svg",
    "_tooltip",
    "_titleString",
    "__helpers",
    "__config",
    "_chartConf",
    "_init",
    "_checkIfWidget",
    "element",
    "_element",
    "Chart",
    "chartId",
    "setAttribute",
    "inBackground",
    "hasAttribute",
    "getAttribute",
    "title",
    "getHeader",
    "document",
    "createElement",
    "classList",
    "add",
    "span",
    "appendChild",
    "textContent",
    "appendToHeader",
    "trim",
    "seriesSelection",
    "s",
    "split",
    "n",
    "toLowerCase",
    "setCurrentSeries",
    "getCurrentSeries",
    "length",
    "includes",
    "push",
    "button",
    "_buttonFactory",
    "tr",
    "addEventListener",
    "_onSeriesPrev",
    "parentElement",
    "insertBefore",
    "i",
    "popup",
    "option",
    "_seriesToShort",
    "ev",
    "style",
    "display",
    "_onSeriesChange",
    "target",
    "stopPropagation",
    "preventDefault",
    "getComputedStyle",
    "getPropertyValue",
    "disabled",
    "_onSeriesNext",
    "popupAddress",
    "data",
    "Model",
    "onUpdate",
    "tileAddress",
    "parent",
    "nodeName",
    "tileWidget",
    "onStateUpdate",
    "body",
    "contains",
    "_onRendered",
    "setRefresh",
    "parseInt",
    "svg",
    "select",
    "append",
    "noToolTips",
    "on",
    "_onPointerEntered",
    "bind",
    "_onPointerMoved",
    "_onPointerLeft",
    "y",
    "targetTouches",
    "clientY",
    "pathRect",
    "querySelector",
    "getBoundingClientRect",
    "height",
    "passive",
    "format",
    "timeFormat",
    "formatString",
    "multiTimeFormat",
    "d",
    "getSeconds",
    "getMinutes",
    "getHours",
    "getDay",
    "getDate",
    "getMonth",
    "x",
    "value",
    "z",
    "src",
    "color",
    "String",
    "sprintf",
    "curve",
    "curveLinear",
    "marginTop",
    "marginRight",
    "marginBottom",
    "marginLeft",
    "width",
    "aspectRatio",
    "xType",
    "scaleTime",
    "xFormat",
    "yType",
    "scaleLinear",
    "yFormat",
    "undefined",
    "yLabel",
    "strokeLinecap",
    "strokeLinejoin",
    "strokeWidth",
    "strokeOpacity",
    "mixBlendMode",
    "showArea",
    "showXAxis",
    "showYAxis",
    "xPadding",
    "__updateTitle",
    "datasetSources",
    "Array",
    "from",
    "querySelectorAll",
    "elem",
    "readAddresses",
    "filter",
    "targetDataset",
    "detail",
    "config",
    "ts",
    "now",
    "aggregationInterval",
    "mins",
    "Math",
    "round",
    "_renderChart",
    "state",
    "setCurrentPeriod",
    "getCurrentPeriod",
    "resetCurrentPeriod",
    "refresh",
    "_loadData",
    "_refreshData",
    "nextButton",
    "removeAttribute",
    "getStartTime",
    "getEndTime",
    "__updateTimeRange",
    "series",
    "end",
    "periodStart",
    "interval",
    "setHours",
    "setDate",
    "setMonth",
    "setFullYear",
    "getFullYear",
    "startTs",
    "getTime",
    "endTs",
    "setStartTime",
    "setEndTime",
    "client",
    "io",
    "BackendConnections",
    "getClient",
    "isConnected",
    "addListenerOnce",
    "url",
    "dataSets",
    "promises",
    "dataSet",
    "chartType",
    "attr",
    "name",
    "attributes",
    "item",
    "part",
    "substring",
    "toUpperCase",
    "join",
    "test",
    "parseFloat",
    "getResourcePath",
    "start",
    "debug",
    "Fetch",
    "cachedFetch",
    "ttl",
    "getRefresh",
    "hasCustomChartsDataProcessor",
    "processChartsData",
    "_lastRefresh",
    "err",
    "_onStatusError",
    "all",
    "responses",
    "_onSuccess",
    "chartData",
    "entry",
    "tsdata",
    "Object",
    "assign",
    "localName",
    "overflow",
    "requestAnimationFrame",
    "setTimeout",
    "retries",
    "clearTimeout",
    "isVisible",
    "_getSize",
    "padding",
    "containerWidth",
    "offsetWidth",
    "containerHeight",
    "offsetHeight",
    "factor",
    "landscape",
    "formatsArray",
    "multiFormat",
    "found",
    "fmt",
    "key",
    "core",
    "notifications",
    "Router",
    "dispatchMessage",
    "severity",
    "message",
    "JSON",
    "stringify",
    "error",
    "_getSvgElement",
    "classes",
    "empty",
    "single",
    "X",
    "Y",
    "Z",
    "O",
    "T",
    "_helpers",
    "shift",
    "xDomain",
    "extent",
    "minVal",
    "min",
    "maxVal",
    "max",
    "yDomain",
    "zDomain",
    "InternSet",
    "I",
    "range",
    "has",
    "maxValue",
    "toFixed",
    "xTicks",
    "yTicks",
    "additionalXRangePadding",
    "xRange",
    "yRange",
    "xAxis",
    "axisBottom",
    "ticks",
    "tickSizeOuter",
    "tickFormat",
    "yAxis",
    "axisLeft",
    "showGrid",
    "xGrid",
    "tickSize",
    "transform",
    "call",
    "yGrid",
    "yAxisElement",
    "label",
    "text",
    "g",
    "remove",
    "lineGroups",
    "Map",
    "areaGroups",
    "barGroups",
    "stackedBarGroups",
    "lineFunctions",
    "areaFunctions",
    "xBar",
    "xzScale",
    "idx",
    "set",
    "curveName",
    "prototype",
    "hasOwnProperty",
    "curveFunction",
    "curveStep",
    "curveNatural",
    "line",
    "minY",
    "area",
    "y0",
    "y1",
    "scaleBand",
    "xz",
    "size",
    "lineContainer",
    "fill",
    "stroke",
    "areaContainer",
    "__opacifyColor",
    "barContainer",
    "domain",
    "bandwidth",
    "keys",
    "transition",
    "duration",
    "ease",
    "easeLinear",
    "selectAll",
    "enter",
    "p",
    "func",
    "linear",
    "val",
    "yMin",
    "entries",
    "targetContainer",
    "yValue",
    "NaN",
    "get",
    "sum",
    "di",
    "v",
    "lineElem",
    "isNaN",
    "x1",
    "x2",
    "valueElem",
    "dot",
    "__activateTooltip",
    "relatedTarget",
    "raise",
    "node",
    "dispatch",
    "bubbles",
    "center",
    "xm",
    "ym",
    "pointer",
    "least",
    "hypot",
    "scaleFactorX",
    "scaleFactorY",
    "xOffset",
    "cursorOffset",
    "pointerType",
    "timeString",
    "top",
    "left",
    "lineTitle",
    "innerHTML",
    "property",
    "icon",
    "chartTitle",
    "_shownDateRange",
    "DateFormat",
    "getDateTimeFormat",
    "trc",
    "getWeekNumber",
    "yearStart",
    "ceil",
    "opacity",
    "startsWith",
    "destruct",
    "defer",
    "QxClass",
    "customElements",
    "Controller",
    "PREFIX",
    "QxConnector"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/structure/tile/components/Chart.js"
  ],
  "sourcesContent": [
    "/* Chart.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/* eslint-disable arrow-body-style */\n/**\n * Shows an chart.\n * @asset(libs/d3.min.js)\n * @ignore(d3)\n */\nqx.Class.define('cv.ui.structure.tile.components.Chart', {\n  extend: cv.ui.structure.tile.components.AbstractComponent,\n  include: [\n    cv.ui.structure.tile.MVisibility,\n    cv.ui.structure.tile.MRefresh,\n    cv.ui.structure.tile.MResize\n  ],\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    ChartCounter: 0,\n    DEFAULT_ASPECT_RATIO: 392/192,\n\n    JS_LOADED: new Promise(async (resolve, reject) => {\n      const check = () => typeof window.d3 === 'object';\n      await cv.util.ScriptLoader.includeScript(qx.util.ResourceManager.getInstance().toUri('libs/d3.min.js'));\n\n      if (!check()) {\n        const timer = new qx.event.Timer(50);\n        let counter = 0;\n        timer.addListener('interval', () => {\n          counter++;\n          if (check()) {\n            resolve(true);\n          } else if (counter > 5) {\n            reject(new Error('Error loaded d3 library'));\n          }\n        });\n      } else {\n        resolve(true);\n      }\n    }).then(() => {\n      if (qx.locale.Manager.getInstance().getLanguage() === 'de') {\n        // localize\n        d3.formatDefaultLocale({\n          decimal: qx.locale.Number.getDecimalSeparator().translate().toString(),\n          thousands: qx.locale.Number.getGroupSeparator().translate().toString(),\n          grouping: [3],\n          currency: ['â‚¬', '']\n        });\n\n        d3.timeFormatDefaultLocale({\n          dateTime: '%A, der %e. %B %Y, %X',\n          date: '%d.%m.%Y',\n          time: '%H:%M:%S',\n          periods: [qx.locale.Date.getAmMarker().translate().toString(), qx.locale.Date.getPmMarker().translate().toString()],\n          days: qx.locale.Date.getDayNames('wide', null, 'format').map(t => t.translate().toString()),\n\n          shortDays: qx.locale.Date.getDayNames('narrow', null, 'stand-alone').map(t => t.translate().toString()),\n          months: qx.locale.Date.getMonthNames('wide').map(t => t.translate().toString()),\n          shortMonths: qx.locale.Date.getMonthNames('narrow', null, 'stand-alone').map(t => t.translate().toString())\n        });\n      }\n    }),\n\n    CONFIG: null\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    currentSeries: {\n      check: ['hour', 'day', 'week', 'month', 'year'],\n      init: 'day',\n      apply: '__updateTimeRange'\n    },\n\n    currentPeriod: {\n      check: 'Number',\n      init: 0,\n      apply: '__updateTimeRange'\n    },\n\n    startTime: {\n      check: 'Number',\n      init: 0\n    },\n\n    endTime: {\n      check: 'Number',\n      init: 0\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _id: null,\n    _downloadedImage: null,\n    _url: null,\n    _headers: null,\n    _request: null,\n    _width: null,\n    _height: null,\n    _loaded: null,\n    _dataSetConfigs: null,\n    _initializing: null,\n    _navigationEnabled: null,\n    __toolTipTimer: null,\n    __showTooltip: false,\n    __debouncedOnResize: null,\n    __resizeTimeout: null,\n    __startTs: null,\n    __endTs: null,\n\n    /**\n    * @type {d3.Selection}\n    */\n    _dot: null,\n    /**\n     * @type {d3.Selection}\n     */\n    _svg: null,\n    /**\n     * @type {HTMLElement}\n     */\n    _tooltip: null,\n    /**\n     * @type {String}\n     */\n    _titleString: null,\n\n    __helpers: null,\n    __config: null,\n    // all chart properties\n    _chartConf: null,\n\n    async _init() {\n      this._checkIfWidget();\n\n      this._initializing = true;\n      const element = this._element;\n      await cv.ui.structure.tile.components.Chart.JS_LOADED;\n      this._id = cv.ui.structure.tile.components.Chart.ChartCounter++;\n      const chartId = 'chart-' + this._id;\n      element.setAttribute('data-chart-id', this._id.toString());\n      const inBackground = this._element.hasAttribute('background') && this._element.getAttribute('background') === 'true';\n\n      let title = this.getHeader('label.title');\n      if (!inBackground && element.hasAttribute('title') && !title) {\n        title = document.createElement('label');\n        title.classList.add('title');\n        let span = document.createElement('span');\n        title.appendChild(span);\n        span.textContent = element.getAttribute('title');\n        this.appendToHeader(title);\n      }\n\n      if (title) {\n        // save base title for updating\n        this._titleString = title.textContent.trim();\n      }\n\n      let seriesSelection = [];\n      if (!inBackground && element.hasAttribute('selection')) {\n        const s = element.getAttribute('selection');\n        if (s === 'none') {\n          seriesSelection = [];\n        } else if (s === 'all') {\n          seriesSelection = ['hour', 'day', 'week', 'month', 'year'];\n        } else {\n          seriesSelection = s.split(',').map(n => n.trim().toLowerCase());\n        }\n      }\n      if (element.hasAttribute('series')) {\n        this.setCurrentSeries(element.getAttribute('series'));\n      }\n      const currentSeries = this.getCurrentSeries();\n      if (seriesSelection.length > 0 && !seriesSelection.includes(currentSeries)) {\n        seriesSelection.push(currentSeries);\n      }\n      this._navigationEnabled = seriesSelection.length > 0;\n      if (seriesSelection.length > 0) {\n        // back button\n        let button = this._buttonFactory('ri-arrow-left-s-line', ['prev']);\n        button.setAttribute('title', qx.locale.Manager.tr('previous'));\n        button.addEventListener('click', () => this._onSeriesPrev());\n\n        if (!title) {\n          title = document.createElement('label');\n          title.classList.add('title');\n          let span = document.createElement('span');\n          title.appendChild(span);\n          this.appendToHeader(title);\n        }\n\n        title.parentElement.insertBefore(button, title);\n        const i = document.createElement('i');\n        i.classList.add('ri-arrow-down-s-fill');\n        title.appendChild(i);\n\n        // current selection\n        const popup = document.createElement('div');\n        popup.classList.add('popup', 'series');\n        let option;\n        for (const s of seriesSelection) {\n          option = document.createElement('cv-option');\n          option.setAttribute('key', s);\n          if (s === currentSeries) {\n            option.setAttribute('selected', 'selected');\n          }\n          option.textContent = this._seriesToShort(s);\n          option.addEventListener('click', ev => {\n            popup.style.display = 'none';\n            this._onSeriesChange(ev.target.getAttribute('key'));\n            ev.stopPropagation();\n            ev.preventDefault();\n          });\n          popup.appendChild(option);\n        }\n        title.appendChild(popup);\n\n        // make title clickable\n        title.classList.add('clickable');\n        title.addEventListener('click', ev => {\n          const style = getComputedStyle(popup);\n          if (style.getPropertyValue('display') === 'none') {\n            popup.style.display = 'flex';\n          } else {\n            popup.style.display = 'none';\n          }\n          ev.stopPropagation();\n          ev.preventDefault();\n        });\n\n        // forward button\n        button = this._buttonFactory('ri-arrow-right-s-line', ['next']);\n        button.setAttribute('title', qx.locale.Manager.tr('next'));\n        // initially we cannot go into the future\n        button.disabled = true;\n        button.addEventListener('click', () => this._onSeriesNext());\n        this.appendToHeader(button);\n      }\n      if (!inBackground && element.hasAttribute('allow-fullscreen') && element.getAttribute('allow-fullscreen') === 'true') {\n        // add fullscreen button + address\n        const button = this._buttonFactory('ri-fullscreen-line', ['fullscreen']);\n        button.setAttribute('data-value', '0');\n\n        const popupAddress = `state:${chartId}-popup`;\n\n        button.addEventListener('click', () => {\n          cv.data.Model.getInstance().onUpdate(popupAddress, button.getAttribute('data-value') === '0' ? '1' : '0', 'system');\n        });\n\n        this.appendToHeader(button, 'right');\n\n        // address\n        const tileAddress = document.createElement('cv-address');\n        tileAddress.setAttribute('mode', 'read');\n        tileAddress.setAttribute('target', 'fullscreen-popup');\n        tileAddress.setAttribute('backend', 'system');\n        tileAddress.setAttribute('send-mode', 'always');\n        tileAddress.textContent = popupAddress;\n        element.parentElement.appendChild(tileAddress);\n\n        // listen to parent tile of popup is opened or not\n        let parent = element;\n        while (parent && parent.nodeName.toLowerCase() !== 'cv-tile') {\n          parent = parent.parentElement;\n        }\n        if (parent) {\n          const tileWidget = parent.getInstance();\n          tileWidget.addListener('closed', () => cv.data.Model.getInstance().onUpdate(popupAddress, '0', 'system'));\n\n          // because we added a read address to the tile after is has been initialized we need to init the listener here manually\n          parent.addEventListener('stateUpdate', ev => {\n            tileWidget.onStateUpdate(ev);\n            // cancel event here\n            ev.stopPropagation();\n          });\n\n        // only on mobile we need this, because of height: auto\n          if (document.body.classList.contains('mobile')) {\n            tileWidget.addListener('fullscreenChanged', () => {\n              this._onRendered();\n            });\n          }\n        }\n      }\n\n\n      if (element.hasAttribute('refresh')) {\n        this.setRefresh(parseInt(element.getAttribute('refresh')));\n      }\n\n      // create needed elements\n\n      const svg = d3.select(this._element)\n        .append('svg');\n\n      let noToolTips = false;\n      if (inBackground) {\n        noToolTips = true;\n        svg.style('opacity', 0.4);\n      }\n\n      if (!noToolTips) {\n        this._tooltip = document.createElement('div');\n        this._tooltip.classList.add('tooltip');\n        this._tooltip.style.display = 'none';\n        this._element.appendChild(this._tooltip);\n\n        svg.on('pointerenter', this._onPointerEntered.bind(this));\n        svg.on('pointermove', this._onPointerMoved.bind(this));\n        svg.on('pointerleave', this._onPointerLeft.bind(this));\n      }\n      svg.on(\n        'touchmove',\n        event => {\n          if (this._loaded) {\n            let y = event.targetTouches[0].clientY;\n            const pathRect = this._element.querySelector(':scope > svg').getBoundingClientRect();\n            if (y > pathRect.y && y < pathRect.y + pathRect.height) {\n              event.preventDefault();\n            }\n          }\n        },\n        { passive: false }\n      );\n\n      // init some fixed settings\n      const format = this._element.hasAttribute('y-format') ? this._element.getAttribute('y-format') : '%s';\n      let timeFormat = null;\n      if (this._element.hasAttribute('x-format')) {\n        const formatString = this._element.getAttribute('x-format');\n        timeFormat = date => d3.timeFormat(formatString)(date);\n      } else {\n        // format auto-detection\n        timeFormat = this.multiTimeFormat([\n          [\n            '%H:%M:%S',\n            function (d) {\n              return d.getSeconds();\n            }\n          ],\n\n          [\n            '%H:%M',\n            function (d) {\n              return d.getMinutes();\n            }\n          ],\n\n          [\n            '%H',\n            function (d) {\n              return d.getHours();\n            }\n          ],\n\n          [\n            '%a %d',\n            function (d) {\n              return d.getDay() && d.getDate() !== 1;\n            }\n          ],\n\n          [\n            '%b %d',\n            function (d) {\n              return d.getDate() !== 1;\n            }\n          ],\n\n          [\n            '%B',\n            function (d) {\n              return d.getMonth();\n            }\n          ],\n\n          [\n            '%Y',\n            function () {\n              return true;\n            }\n          ]\n        ]);\n      }\n      this.__config = {\n        x: d => d.time, // given d in data, returns the (temporal) x-value\n        y: d => +d.value, // given d in data, returns the (quantitative) y-value\n        z: d => d.src, // given d in data, returns the (categorical) z-value\n        color: d => d && this._dataSetConfigs[d].color, // stroke color of line, as a constant or a function of *z*\n        title: d => cv.util.String.sprintf(format, d.value), // given d in data, returns the title text\n        curve: d3.curveLinear, // method of interpolation between points\n        marginTop: 12, // top margin, in pixels\n        marginRight: 24, // right margin, in pixels\n        marginBottom: 20, // bottom margin, in pixels\n        marginLeft: 24, // left margin, in pixels\n        width: 392, // outer width, in pixels\n        height: 192, // outer height, in pixels\n        aspectRatio: 392/192,\n        xType: d3.scaleTime, // type of x-scale\n        xFormat: timeFormat, // a format specifier string for the x-axis\n        yType: d3.scaleLinear, // type of y-scale\n        yFormat: undefined, // a format specifier string for the y-axis\n        yLabel: undefined, // a label for the y-axis\n        strokeLinecap: undefined, // stroke line cap of line\n        strokeLinejoin: undefined, // stroke line join of line\n        strokeWidth: 1.5, // stroke width of line\n        strokeOpacity: undefined, // stroke opacity of line\n        mixBlendMode: 'normal', // blend mode of lines\n        showArea: d => this._dataSetConfigs[d].showArea, // show area below the line,\n        showXAxis: !this._element.hasAttribute('show-x-axis') || this._element.getAttribute('show-x-axis') === 'true',\n        showYAxis: !this._element.hasAttribute('show-y-axis') || this._element.getAttribute('show-y-axis') === 'true',\n        xPadding: 0.1 // amount of x-range to reserve to separate bars\n      };\n\n      this._initializing = false;\n      this.__updateTitle();\n\n      // check if we have a read address for live updates\n      const datasetSources = Array.from(this._element.querySelectorAll(':scope > dataset')).map(elem => elem.getAttribute('src'));\n      const readAddresses = Array.from(element.querySelectorAll(':scope > cv-address:not([mode=\"write\"])')).filter(elem => datasetSources.includes(elem.getAttribute('target')));\n      if (readAddresses.length > 0) {\n        element.addEventListener('stateUpdate', ev => {\n          this.onStateUpdate(ev);\n          // cancel event here\n          ev.stopPropagation();\n        });\n      }\n    },\n\n    onStateUpdate(ev) {\n      const targetDataset = this._element.querySelector(':scope > dataset[src=\"'+ev.detail.target+'\"]');\n      const config = this._dataSetConfigs ? this._dataSetConfigs[ev.detail.target] : null;\n      if (targetDataset && config) {\n        let ts = Date.now();\n        if (config.aggregationInterval) {\n          const mins = config.aggregationInterval * 60 * 1000;\n          ts = Math.round(ts / mins) * mins;\n        }\n        this._renderChart({\n          src: ev.detail.target,\n          time: ts,\n          value: ev.detail.state\n        }, true);\n      }\n    },\n\n    _onSeriesPrev() {\n      this.setCurrentPeriod(this.getCurrentPeriod()+1);\n    },\n\n    _onSeriesChange(select) {\n      this._initializing = true;\n      // reset offset when series changed\n      this.resetCurrentPeriod();\n      this._initializing = false;\n      // reset configuration, we need a new one\n      this._chartConf = null;\n      this.setCurrentSeries(select);\n    },\n\n    _onSeriesNext() {\n      const currentPeriod = this.getCurrentPeriod();\n      if (currentPeriod > 0) {\n        this.setCurrentPeriod(currentPeriod-1);\n      }\n    },\n\n    refresh() {\n      this._loaded = false;\n      this._loadData();\n    },\n\n    // triggered after a change os series or period\n    _refreshData() {\n      const nextButton = this.getHeader('.next');\n      if (nextButton) {\n        if (this.getCurrentPeriod() === 0) {\n          nextButton.setAttribute('disabled', 'disabled');\n        } else {\n          nextButton.removeAttribute('disabled');\n        }\n      }\n\n      if (!this._initializing && this.getStartTime() > 0 && this.getEndTime() > 0) {\n        this._loaded = false;\n        this._loadData();\n      }\n      this.__updateTitle();\n    },\n\n    __updateTimeRange() {\n      const series = this.getCurrentSeries();\n\n      const currentPeriod = this.getCurrentPeriod();\n      let end = new Date();\n      let periodStart = new Date();\n      let interval = 0;\n      switch (series) {\n        case 'hour':\n          interval = 60 * 60;\n          periodStart.setHours(periodStart.getHours() - currentPeriod, 0, 0, 0);\n          if (currentPeriod > 0) {\n            end.setHours(periodStart.getHours() + 1, 0, 0, 0);\n          }\n          break;\n\n        case 'day':\n          interval = 24 * 60 * 60;\n          periodStart.setDate(periodStart.getDate() - currentPeriod);\n          periodStart.setHours(0, 0, 0, 0);\n          if (currentPeriod > 0) {\n            end.setDate(periodStart.getDate() + 1);\n            end.setHours(0, 0, 0, 0);\n          }\n          break;\n\n        case 'week':\n          interval = 7 * 24 * 60 * 60;\n          periodStart.setDate(-periodStart.getDay() - 7 * currentPeriod);\n          periodStart.setHours(0, 0, 0, 0);\n          if (currentPeriod > 0) {\n            end.setDate(periodStart.getDate() + 7);\n            end.setHours(0, 0, 0, 0);\n          }\n          break;\n\n        case 'month':\n          interval = 30 * 24 * 60 * 60;\n          periodStart.setMonth(periodStart.getMonth() - currentPeriod);\n          periodStart.setDate(1);\n          periodStart.setHours(0, 0, 0, 0);\n          if (currentPeriod > 0) {\n            end.setMonth(periodStart.getMonth() + 1, 1);\n            end.setHours(0, 0, 0, 0);\n          }\n          break;\n\n        case 'year':\n          interval = 365 * 24 * 60 * 60;\n          periodStart.setFullYear(periodStart.getFullYear() - currentPeriod);\n          periodStart.setMonth(0, 1);\n          periodStart.setHours(0, 0, 0, 0);\n          if (currentPeriod > 0) {\n            end.setFullYear(periodStart.getFullYear() + 1);\n            end.setMonth(periodStart.getMonth() + 1, 1);\n            end.setHours(0, 0, 0, 0);\n          }\n          break;\n      }\n      let startTs = Math.round(periodStart.getTime()/1000);\n      let endTs = Math.round(end.getTime()/1000);\n      if (this._element.getAttribute('background') === 'true' || !this._element.hasAttribute('selection')) {\n        // when have no nagivation, we can just use the old relative time range now - interval\n        startTs = endTs -  interval;\n      }\n      this.setStartTime(startTs);\n      this.setEndTime(endTs);\n      this._refreshData();\n    },\n\n    _loadData() {\n      if (this._loaded && Date.now() - this._loaded < 300000) {\n        // don't reload within 5 minutes\n        return;\n      }\n      const client = cv.io.BackendConnections.getClient();\n      if (!client) {\n        return;\n      }\n      if (!client.isConnected()) {\n        client.addListenerOnce('changeConnected', () => {\n          this._loadData();\n        });\n        return;\n      }\n      let url;\n      const dataSets = this._element.querySelectorAll(':scope > dataset');\n\n      const promises = [];\n      if (!this._dataSetConfigs) {\n        this._dataSetConfigs = {};\n        for (let dataSet of dataSets) {\n          let ts = {\n            showArea: true,\n            color: '#FF9900',\n            chartType: 'line',\n            title: '',\n            curve: 'linear',\n            aggregationInterval: 0\n          };\n\n          let attr;\n          let name;\n          let value;\n          for (let i = 0; i < dataSet.attributes.length; i++) {\n            attr = dataSet.attributes.item(i);\n            // CamelCase attribute names\n            name = attr.name\n              .split('-')\n              .map((part, i) => {\n                if (i > 0) {\n                  return `${part.substring(0, 1).toUpperCase()}${part.substring(1)}`;\n                }\n                return part;\n              })\n              .join('');\n            value = attr.value;\n            if (value === 'true' || value === 'false') {\n              value = value === 'true';\n            } else if (/^\\d+$/.test(value)) {\n              value = parseInt(value);\n            } else if (/^[\\d.]+$/.test(value)) {\n              value = parseFloat(value);\n            }\n            ts[name] = value;\n          }\n          this._dataSetConfigs[ts.src] = ts;\n        }\n      }\n\n      for (const src in this._dataSetConfigs) {\n        url = client.getResourcePath('charts', {\n          src: src,\n          start: this.getStartTime(),\n          end: this.getEndTime()\n        });\n\n        const ts = this._dataSetConfigs[src];\n\n        if (!url) {\n          continue;\n        }\n\n        this.debug('loading', url);\n        promises.push(\n          cv.io.Fetch.cachedFetch(url, {ttl: this.getRefresh()}, false, client)\n            .then(data => {\n              this.debug('successfully loaded', url);\n              if (client.hasCustomChartsDataProcessor(data)) {\n                data = client.processChartsData(data, ts);\n              }\n              if (!this._lastRefresh) {\n                this._lastRefresh = Date.now();\n              }\n              return {\n                data: data || [],\n                ts: ts\n              };\n            })\n            .catch(err => {\n              this._onStatusError(ts, url, err);\n              return {\n                data: [],\n                ts: ts\n              };\n            })\n        );\n      }\n      Promise.all(promises).then(responses => {\n        this._onSuccess(responses);\n      });\n    },\n\n    _onSuccess(data) {\n      let chartData = [];\n\n      for (let entry of data) {\n        let tsdata = entry.data;\n        if (tsdata !== null) {\n          // TODO: stacked bar times (entry.ts.chartType === 'stacked-bar') must be aggregated, they have to be at the same time index for stacking\n          const mins = entry.ts.aggregationInterval > 0 ? entry.ts.aggregationInterval * 60 * 1000 : 0;\n          for (let [time, value] of tsdata) {\n            chartData.push({\n              src: entry.ts.src,\n              time: mins > 0\n                ? Math.round(time / mins) * mins : time,\n              value\n            });\n          }\n        }\n      }\n\n      if (this._element.hasAttribute('background') && this._element.getAttribute('background') === 'true') {\n        // no margins\n        this.__config = Object.assign(this.__config, {\n          marginRight: 0,\n          marginBottom: 0,\n          marginLeft: 0\n        });\n\n        // because we have no margins we need to cut the overflow on the tile\n        let tile = this._element.parentElement;\n        while (tile && tile.localName !== 'cv-tile') {\n          tile = tile.parentElement;\n        }\n        if (tile && tile.localName === 'cv-tile') {\n          tile.style.overflow = 'hidden';\n        }\n      }\n\n      // wait some time to let the element size settle\n      window.requestAnimationFrame(() => {\n        setTimeout(() => {\n          this._onRendered(chartData);\n        }, 100);\n      });\n    },\n\n    _onRendered(chartData, retries) {\n      if (this.__resizeTimeout) {\n        clearTimeout(this.__resizeTimeout);\n        this.__resizeTimeout = null;\n      }\n      if (this.isVisible()) {\n        const [width, height] = this._getSize();\n        if ((width < 20 || height < 10) && (!retries || retries <= 5)) {\n          // this makes no sense\n          this.__resizeTimeout = setTimeout(() => {\n            this._onRendered(chartData, retries > 0 ? retries + 1 : 1);\n          }, 150);\n        }\n        if (width < 20 || height < 10) {\n          // do nothing, these values are invalid\n          return;\n        }\n\n        this.__config.width = width;\n        this.__config.height = height;\n        d3.select(this._element).select('svg')\n          .attr('viewBox', `0, 0, ${width}, ${height}`);\n        if (chartData) {\n          this._renderChart(chartData);\n          this._loaded = Date.now();\n        }\n      }\n    },\n\n    _getSize() {\n      const parent = this._element.parentElement;\n      let padding = this._element.getAttribute('background') === 'true' ? 0 : 8;\n      let containerWidth = this._element.offsetWidth - padding;\n      let containerHeight = this._element.offsetHeight - padding;\n      let factor = 1;\n\n      const landscape = containerWidth > containerHeight;\n      let width = 0;\n      let height = 0;\n\n      if (landscape && containerHeight > 0) {\n        // obeying aspect ratio in landscape mode is not necessary\n        width = Math.round(containerWidth / factor);\n        height = Math.round(containerHeight / factor);\n      } else {\n        width = Math.round(containerWidth / factor);\n        height = width / cv.ui.structure.tile.components.Chart.DEFAULT_ASPECT_RATIO;\n      }\n      if (!this._element.style.height && (parent.localName === 'cv-popup' && (parent.getAttribute('fullscreen') === 'true') ||\n        (this._element.getAttribute('allow-fullscreen') === 'true' &&\n          parent.parentElement.classList.contains('fullscreen')))) {\n        // the parent container has height: auto, so we need to have one\n        this._element.style.height = (height + this.__config.marginTop + this.__config.marginBottom) + 'px';\n      }\n      return [width, height];\n    },\n\n    multiTimeFormat(formatsArray) {\n      /**\n       * @param date\n       */\n      function multiFormat(date) {\n        let i = 0;\n        let found = false;\n        let fmt = '%c';\n        while (!found && i < formatsArray.length) {\n          found = formatsArray[i][1](date);\n          if (found) {\n            fmt = formatsArray[i][0];\n          }\n          i++;\n        }\n        return fmt;\n      }\n      return date => d3.timeFormat(multiFormat(date))(date);\n    },\n\n    _onStatusError(ts, key, err) {\n      cv.core.notifications.Router.dispatchMessage('cv.charts.error', {\n        title: qx.locale.Manager.tr('Communication error'),\n        severity: 'urgent',\n        message: qx.locale.Manager.tr('URL: %1<br/><br/>Response:</br>%2', JSON.stringify(key), JSON.stringify(err))\n      });\n\n      this.error('Chart _onStatusError', ts, key, err);\n    },\n\n    /**\n     * Get svg element selection (create if not exists)\n     * @param parent d3.selection of the parent this element should be a child of\n     * @param nodeName {String} Element name\n     * @param classes {Array<String>} array of css classes used to identify this element\n     * @param attributes {Map<String, String>?} set these attributes if the element has to be created, when it already exists these are ignored\n     * @private\n     */\n    _getSvgElement(parent, nodeName, classes, attributes) {\n      let elem = parent.select(nodeName + '.' + classes.join('.'));\n      if (elem.empty()) {\n        elem = parent.append(nodeName).attr('class', classes.join(' '));\n        if (attributes) {\n          for (const name in attributes) {\n            elem.attr(name, attributes[name]);\n          }\n        }\n      }\n      return elem;\n    },\n\n    /**\n     * Copyright 2021 Observable, Inc.\n     * Released under the ISC license.\n     * https://observablehq.com/@d3/multi-line-chart\n     *\n     * @param data\n     * @param single\n     * @private\n     */\n    _renderChart(data, single) {\n      const config = this.__config;\n      const svg = d3.select(this._element).select('svg');\n\n      // Compute values.\n      let X;\n      let Y;\n      let Z;\n      let O;\n      let T;\n      if (single) {\n        if (!this._helpers) {\n          return;\n        }\n        X = this._helpers.X;\n        Y = this._helpers.Y;\n        Z = this._helpers.Z;\n        O = this._helpers.O;\n        T = this._helpers.T;\n        if (X[X.length-1] === data.time) {\n          // replace last value instead of adding one\n          Y[Y.length-1] = data.value;\n        } else {\n          X.push(data.time);\n          Y.push(data.value);\n          Z.push(data.src);\n          O.push(data);\n          T.push(config.title === undefined ? data.src : config.title === null ? null : config.title(data));\n\n          // cleanup\n          X.shift();\n          Y.shift();\n          Z.shift();\n          O.shift();\n          T.shift();\n        }\n      } else {\n        X = d3.map(data, config.x);\n        Y = d3.map(data, config.y);\n        Z = d3.map(data, config.z);\n        O = d3.map(data, d => d);\n        // Compute titles.\n        T = config.title === undefined ? Z : config.title === null ? null : d3.map(data, config.title);\n      }\n\n      // Compute default domains, and unique the z-domain.\n      let xDomain = d3.extent(X);\n      let minVal = 0;\n      if (this._element.hasAttribute('zero-based') && this._element.getAttribute('zero-based') === 'false') {\n        minVal = d3.min(Y);\n        if (minVal > 1.0) {\n          minVal -= 1;\n        }\n      }\n      let maxVal = d3.max(Y);\n      if (maxVal > 1.0) {\n        // add some inner chart padding\n        maxVal += 1;\n      } else {\n        maxVal += 0.1;\n      }\n      const yDomain = [minVal, maxVal];\n      const zDomain = new d3.InternSet(Z);\n      // Omit any data not present in the z-domain.\n      const I = d3.range(X.length).filter(i => zDomain.has(Z[i]));\n\n      if (config.showYAxis) {\n        const maxValue = config.yFormat ? config.yFormat(yDomain[1]) : yDomain[1].toFixed(maxVal < 1 ? 2 : 1);\n        // check if we need more space for the y-axis\n        if (maxValue.length >= 2) {\n          config.marginLeft = maxValue.length * 8;\n        }\n      }\n\n      const xTicks = config.width / 80;\n      const yTicks = config.height / 60;\n      const additionalXRangePadding = this._element.getAttribute('background') === 'true' ? 0 : 2;\n\n      const xRange = [config.marginLeft + additionalXRangePadding, config.width - config.marginRight - additionalXRangePadding]; // [left, right]\n      if (!this._chartConf) {\n        const yRange = [config.height - config.marginBottom, config.marginTop]; // [bottom, top]\n\n        // initialize everything once\n        this._chartConf = {\n          // x/y scales\n          x: config.xType().range(xRange),\n          y: config.yType().range(yRange)\n        };\n        this._chartConf.xAxis = config.showXAxis\n          ? d3.axisBottom(this._chartConf.x)\n            .ticks(xTicks)\n            .tickSizeOuter(0)\n            .tickFormat(config.xFormat)\n          : undefined;\n        this._chartConf.yAxis = config.showYAxis\n          ? d3.axisLeft(this._chartConf.y).ticks(yTicks, config.yFormat)\n          : undefined;\n\n\n        // add elements\n        const showGrid = this._element.hasAttribute('show-grid') ? this._element.getAttribute('show-grid') : 'xy';\n        if (showGrid.includes('x')) {\n          this._chartConf.xGrid = d3.axisBottom(this._chartConf.x).ticks(xTicks)\n            .tickSize(-config.height + config.marginBottom + config.marginTop)\n            .tickFormat('');\n          this._getSvgElement(svg, 'g', ['grid', 'x'], {\n            transform: `translate(0,${config.height - config.marginBottom})`\n          })\n            .call(this._chartConf.xGrid);\n        }\n        if (showGrid.includes('y')) {\n          this._chartConf.yGrid = d3.axisLeft(this._chartConf.y).ticks(yTicks)\n            .tickSize(-config.width + config.marginRight + config.marginLeft)\n            .tickFormat('');\n\n          this._getSvgElement(svg, 'g', ['grid', 'y'], {\n            transform: `translate(${config.marginLeft},0)`\n          })\n            .call(this._chartConf.yGrid);\n        }\n\n        if (config.showXAxis) {\n          this._getSvgElement(svg, 'g', ['axis', 'x'])\n            .attr('transform', `translate(0,${config.height - config.marginBottom})`)\n            .call(this._chartConf.xAxis);\n        }\n\n        if (config.showYAxis) {\n          let yAxisElement = this._getSvgElement(svg, 'g', ['axis', 'y'])\n            .attr('transform', `translate(${config.marginLeft},0)`);\n\n          if (config.label && yAxisElement.select('text').empty()) {\n            yAxisElement.append('text')\n              .attr('x', -config.marginLeft)\n              .attr('y', 10)\n              .attr('fill', 'currentColor')\n              .attr('text-anchor', 'start')\n              .text(config.yLabel);\n          }\n\n          yAxisElement\n            .call(this._chartConf.yAxis)\n            .call(g => g.select('.domain').remove());\n        }\n\n        // find chart types\n        const lineGroups = new Map();\n        const areaGroups = new Map();\n        const barGroups = new Map();\n        const stackedBarGroups = new Map();\n        const lineFunctions = {};\n        const areaFunctions = {};\n        let xBar;\n        let xzScale;\n\n        for (const key of zDomain) {\n          switch (this._dataSetConfigs[key].chartType) {\n            case 'line': {\n              const idx = I.filter(i => Z[i] === key);\n              lineGroups.set(key, idx);\n              const curveName = this._dataSetConfigs[key].curve || 'linear';\n              if (!Object.prototype.hasOwnProperty.call(lineFunctions, curveName)) {\n                let curveFunction;\n                switch (curveName) {\n                  case 'linear':\n                    curveFunction = d3.curveLinear;\n                    break;\n\n                  case 'step':\n                    curveFunction = d3.curveStep;\n                    break;\n\n                  case 'natural':\n                    curveFunction = d3.curveNatural;\n                    break;\n                }\n\n                if (curveFunction) {\n                  // Construct a line generator.\n                  lineFunctions[curveName] = d3\n                    .line()\n                    .curve(curveFunction)\n                    .x(i => this._chartConf.x(this._helpers.X[i]))\n                    .y(i => this._chartConf.y(this._helpers.Y[i]));\n                }\n\n                if (this._dataSetConfigs[key].chartType === 'line' && typeof config.showArea === 'function' && config.showArea(key)) {\n                  areaGroups.set(key, idx);\n                  if (curveFunction) {\n                    // Construct a line generator.\n                    const minY = this._chartConf.y.range()[0];\n                    areaFunctions[curveName] = d3\n                      .area()\n                      .curve(curveFunction)\n                      .x(i => this._chartConf.x(this._helpers.X[i]))\n                      .y0(() => minY)\n                      .y1(i => this._chartConf.y(this._helpers.Y[i]));\n                  }\n                }\n              }\n              break;\n            }\n\n            case 'bar':\n              barGroups.set(key, I.filter(i => Z[i] === key));\n              if (!xBar) {\n                xBar = d3.scaleBand().range(this._chartConf.x.range()).padding(config.xPadding);\n              }\n              if (!xzScale) {\n                xzScale = d3.scaleBand().padding(0.05);\n              }\n              break;\n\n            case 'stacked-bar':\n              stackedBarGroups.set(key, I.filter(i => Z[i] === key));\n              break;\n          }\n        }\n\n        this._chartConf.lineGroups = lineGroups;\n        this._chartConf.areaGroups = areaGroups;\n        this._chartConf.barGroups = barGroups;\n        this._chartConf.stackedBarGroups = stackedBarGroups;\n        this._chartConf.lineFunctions = lineFunctions;\n        this._chartConf.areaFunctions = areaFunctions;\n        this._chartConf.xBar = xBar;\n        if (xzScale) {\n          this._chartConf.xz = xzScale;\n        }\n\n        // prepare elements for chart elements\n        if (this._chartConf.lineGroups.size > 0) {\n          this._chartConf.lineContainer = this._getSvgElement(svg, 'g', ['line'], {\n            fill: 'none',\n            stroke: typeof config.color === 'string' ? config.color : null,\n            'stroke-linecap': config.strokeLinecap,\n            'stroke-linejoin': config.strokeLinejoin,\n            'stroke-width': config.strokeWidth,\n            'stroke-opacity': config.strokeOpacity\n          });\n        }\n        if (this._chartConf.areaGroups.size > 0) {\n          this._chartConf.areaContainer = this._getSvgElement(svg, 'g', ['area'], {\n            stroke: 'none',\n            fill: typeof config.color === 'string' ? this.__opacifyColor(config.color, '30') : null\n          });\n        }\n        if (this._chartConf.barGroups.size > 0) {\n          this._chartConf.barContainer = this._getSvgElement(svg, 'g', ['bars']);\n        }\n      }\n\n      // apply domains to scales\n      this._chartConf.x.domain(xDomain);\n      this._chartConf.y.domain(yDomain);\n\n      this._helpers = { X, Y, I, T, Z, O };\n\n      if (this._chartConf.xAxis) {\n        this._getSvgElement(svg, 'g', ['axis', 'x'])\n          .call(this._chartConf.xAxis);\n      }\n\n      if (this._chartConf.yAxis) {\n        this._getSvgElement(svg, 'g', ['axis', 'y'])\n          .call(this._chartConf.yAxis);\n      }\n      if (this._chartConf.xBar) {\n        this._chartConf.xBar.domain(new d3.InternSet(X));\n      }\n      if (this._chartConf.xz) {\n        this._chartConf.xz.domain(zDomain);\n        this._chartConf.x.range([xRange[0], xRange[1] - this._chartConf.xBar.bandwidth()]);\n        this._chartConf.xz.range([0, this._chartConf.xBar.bandwidth()]);\n      }\n\n      // update groups\n      for (const key of this._chartConf.lineGroups.keys()) {\n        const idx = I.filter(i => Z[i] === key);\n        this._chartConf.lineGroups.set(key, idx);\n      }\n      for (const key of this._chartConf.areaGroups.keys()) {\n        const idx = I.filter(i => Z[i] === key && Y[i] !== undefined);\n        this._chartConf.areaGroups.set(key, idx);\n      }\n      for (const key of this._chartConf.barGroups.keys()) {\n        const idx = I.filter(i => Z[i] === key && Y[i] !== undefined);\n        this._chartConf.barGroups.set(key, idx);\n      }\n      for (const key of this._chartConf.stackedBarGroups.keys()) {\n        const idx = I.filter(i => Z[i] === key && Y[i] !== undefined);\n        this._chartConf.stackedBarGroups.set(key, idx);\n      }\n\n      this.__config = config;\n      this._dot = svg.select('g.dot');\n\n      const t = d3.transition()\n        .duration(single ? 0 : 500)\n        .ease(d3.easeLinear);\n\n      if (this._chartConf.lineContainer) {\n        this._chartConf.lineContainer\n          .selectAll('path')\n          .data(this._chartConf.lineGroups)\n          .join(\n            enter => enter.append('path')\n              .style('mix-blend-mode', config.mixBlendMode)\n              .attr('stroke', typeof config.color === 'function' ? p => config.color(p[0]) : null)\n          )\n          .transition(t)\n          .attr('d', d => {\n            const curveName = this._dataSetConfigs[d[0]].curve || 'linear';\n            const func = this._chartConf.lineFunctions[curveName] || this._chartConf.lineFunctions.linear;\n            const val = func(d[1]);\n            return val;\n          });\n      }\n\n      // Add the area\n      if (this._chartConf.areaContainer) {\n        this._chartConf.areaContainer\n          .selectAll('path')\n          .data(this._chartConf.areaGroups)\n          .join(\n            enter => enter.append('path')\n              .style('mix-blend-mode', config.mixBlendMode)\n              .attr('fill', typeof config.color === 'function' ? p => this.__opacifyColor(config.color(p[0]), '30') : null)\n          )\n          .transition(t)\n          .attr('d', d => {\n            const curveName = this._dataSetConfigs[d[0]].curve || 'linear';\n            const func = this._chartConf.areaFunctions[curveName] || this._chartConf.areaFunctions.linear;\n            return func(d[1]);\n          });\n      }\n\n      if (this._chartConf.barContainer) {\n        const yMin = this._chartConf.y.range()[0];\n        this._chartConf.barContainer\n          .selectAll('g')\n          .data(this._chartConf.barGroups)\n          .join('g')\n          .attr('fill', typeof config.color === 'function' ? d => config.color(d[0]) : null)\n          .selectAll('rect')\n          .data(d => {\n            return d[1].map(val => {\n              return {\n                key: d[0],\n                value: val\n              };\n            });\n          })\n          .join('rect')\n          .attr('x', d => {\n            const x = this._chartConf.x(X[d.value]);\n            const xz =  this._chartConf.xz(d.key);\n            return x + xz;\n          })\n          .attr('y', d => this._chartConf.y(Y[d.value]))\n          .attr('width', this._chartConf.xz.bandwidth())\n          .transition(t)\n          .attr('height', d => yMin - this._chartConf.y(Y[d.value]));\n      }\n\n      // add fixed/calculated lines\n      for (const [i, line] of this._element.querySelectorAll(':scope > h-line').entries()) {\n        const src = line.getAttribute('src');\n        let targetContainer = null;\n        let data = null;\n        let yValue = NaN;\n        if (src) {\n          if (this._chartConf.lineGroups.get(src)) {\n            targetContainer = this._chartConf.lineContainer;\n            data = this._chartConf.lineGroups.get(src);\n          } else if (this._chartConf.areaGroups.get(src)) {\n            targetContainer = this._chartConf.areaContainer;\n            data = this._chartConf.areaGroups.get(src);\n          } else if (this._chartConf.barGroups.get(src)) {\n            targetContainer = this._chartConf.barContainer;\n            data = this._chartConf.barGroups.get(src);\n          }\n          if (!data) {\n            this.error('no data found for src ' + src);\n            continue;\n          }\n          switch (line.getAttribute('value')) {\n            case 'avg': {\n              let sum = 0.0;\n              for (const di of data) {\n                sum += Y[di];\n              }\n              yValue = sum / data.length;\n              break;\n            }\n\n            case 'max':\n              yValue = d3.max(Y.filter((v, i) => data.includes(i), d => d));\n              break;\n\n            case 'min':\n              yValue = d3.min(Y.filter((v, i) => data.includes(i), d => d));\n              break;\n\n            default:\n              this.error('unknown value calculation: ' + line.getAttribute('value'));\n              break;\n          }\n        } else {\n          targetContainer = this._chartConf.lineContainer || this._chartConf.areaContainer || this._chartConf.barContainer;\n          yValue = parseFloat(line.getAttribute('value'));\n          data = [0, X.length-1];\n        }\n        if (!targetContainer) {\n          continue;\n        }\n\n        let lineElem = targetContainer.select('.line-' + i);\n        if (isNaN(yValue) && !lineElem.empty()) {\n          // remove line\n          lineElem.remove();\n          if (line.getAttribute('show-value') === 'true') {\n            targetContainer.select('.line-value-' + i).remove();\n          }\n        } else if (!isNaN(yValue)) {\n          const color = line.getAttribute('color') || 'currentColor';\n          if (lineElem.empty()) {\n            lineElem = targetContainer.append('line')\n              .attr('class', 'line-' + i)\n              .attr('stroke', color);\n          }\n          const x1 = this._chartConf.x(X[data[0]]);\n          const x2 = this._chartConf.x(X[X.length -1]); // always draw until end of chart (not until end of src dataset)\n          const y = this._chartConf.y(yValue);\n          lineElem\n            .attr('x1', x1)\n            .attr('x2', x2)\n            .attr('y1', y)\n            .attr('y2', y);\n\n          if (line.getAttribute('show-value') === 'true') {\n            const format = line.hasAttribute('format') ? line.getAttribute('format')\n              : (this._element.hasAttribute('y-format') ? this._element.getAttribute('y-format') : '%s');\n            let valueElem = targetContainer.select('.line-value-' + i);\n            if (valueElem.empty()) {\n              valueElem = targetContainer.append('text')\n                .attr('class', 'line-value-' + i)\n                .attr('fill', line.getAttribute('value-color') || color)\n                .attr('font-size', '10')\n                .attr('text-anchor', 'start');\n            }\n            // show value on right side of the chart\n            valueElem\n              .attr('x', x2 + 2)\n              .attr('y', y + 5)\n              .text(cv.util.String.sprintf(format, yValue));\n          }\n        }\n      }\n\n      // dot must be added last\n      const dot = svg.select('g.dot');\n      if (dot.empty()) {\n        svg.append('g')\n          .attr('class', 'dot')\n          .attr('display', 'none')\n          .attr('fill', 'currentColor')\n          .append('circle')\n          .attr('r', 2.5);\n      }\n      this._dot = svg.select('g.dot');\n    },\n\n    _onPointerEntered(ev) {\n      if (this._loaded) {\n        this.__toolTipTimer = setTimeout(() => {\n          this.__activateTooltip(true, ev);\n          this.__toolTipTimer = null;\n        }, 500);\n      }\n    },\n\n    _onPointerLeft(ev) {\n      if (this.__toolTipTimer) {\n        clearTimeout(this.__toolTipTimer);\n      }\n\n      if (this._loaded) {\n        if (ev.relatedTarget !== this._tooltip) {\n          this.__activateTooltip(false);\n        }\n      }\n    },\n\n    __activateTooltip(val, ev) {\n      this.__showTooltip = val;\n      if (val) {\n        if (this._dot) {\n          this._dot.attr('display', null);\n          this._dot.raise();\n        }\n        this._tooltip.style.display = 'block';\n        this._onPointerMoved(null, true);\n      } else {\n        if (this._dot) {\n          this._dot.attr('display', 'none');\n        }\n        const svg = d3.select(this._element).select('svg');\n        svg.node().value = null;\n        svg.dispatch('input', {bubbles: true});\n        this._tooltip.style.display = 'none';\n      }\n    },\n\n    _onPointerMoved(event, center) {\n      if (this._loaded && this.__showTooltip) {\n        let xm = 0;\n        let ym = 0;\n        if (event) {\n          [xm, ym] = d3.pointer(event);\n        } else if (center) {\n          xm = this.__config.width/2;\n          ym = this.__config.height/2;\n        } else {\n          return;\n        }\n        const {X, Y, I, T, Z, O} = this._helpers;\n        const {x, y, xz} = this._chartConf;\n        const i = d3.least(I, i => Math.hypot(x(X[i]) - xm, y(Y[i]) - ym));\n        const scaleFactorX = this._element.offsetWidth / this.__config.width;\n        const scaleFactorY = this._element.offsetHeight / this.__config.height;\n        // closest point\n        const xOffset = xz ? (xz(Z[i]) + (typeof xz.bandwidth === 'function' ? xz.bandwidth() / 2 : 0)) : 0;\n        this._dot.attr('transform', `translate(${x(X[i]) + xOffset},${y(Y[i])})`);\n        if (T) {\n          const cursorOffset = event && event.pointerType === 'mouse' ? 16 : 40;\n          const timeString = this.__config.xFormat(new Date(X[i]));\n          let top = ym * scaleFactorY - this._tooltip.offsetHeight;\n          if (top < 0) {\n            top += cursorOffset + this._tooltip.offsetHeight;\n          } else {\n            top -= cursorOffset;\n          }\n\n          let left = xm * scaleFactorX;\n          if (left > this._element.offsetWidth / 2) {\n            left -= this._tooltip.offsetWidth + cursorOffset;\n          } else {\n            left += cursorOffset;\n          }\n\n          const key = Z[i];\n          const lineTitle = this._dataSetConfigs[key] && this._dataSetConfigs[key].title ? this._dataSetConfigs[key].title + ': ' : '';\n          this._tooltip.innerHTML = `${timeString}<br/>${lineTitle}${T[i]}`;\n          this._tooltip.style.left = left + 'px';\n          this._tooltip.style.top = top + 'px';\n        }\n        d3.select(this._element).select('svg').property('value', O[i]).dispatch('input', {bubbles: true});\n      }\n    },\n\n    _buttonFactory(icon, classes) {\n      const button = document.createElement('button');\n      button.classList.add(...classes);\n      if (icon) {\n        const i = document.createElement('i');\n        i.classList.add(icon);\n        button.appendChild(i);\n      }\n      return button;\n    },\n\n    __updateTitle() {\n      if (this._navigationEnabled) {\n        let title = this.getHeader('label.title span');\n        if (title) {\n          let chartTitle = this._titleString || '';\n          title.textContent = (chartTitle ? chartTitle + ' - ' : '') + this._shownDateRange();\n        }\n      }\n    },\n\n    /**\n     * Converts series to a shot string that is shown in a select box\n     * @param series\n     * @private\n     */\n    _seriesToShort(series) {\n      switch (series) {\n        case 'hour':\n          return qx.locale.Manager.tr('Hour');\n\n        case 'day':\n          return qx.locale.Manager.tr('Day');\n\n        case 'week':\n          return qx.locale.Manager.tr('Week');\n\n        case 'month':\n          return qx.locale.Manager.tr('Month');\n\n        case 'year':\n          return qx.locale.Manager.tr('Year');\n      }\n      return '';\n    },\n\n    /**\n     * Convert the currently shown date range into a human-readable string\n     * @private\n     */\n    _shownDateRange() {\n      const series = this.getCurrentSeries();\n      const currentPeriod = this.getCurrentPeriod();\n      const date = new Date();\n      let format = new qx.util.format.DateFormat();\n      switch (series) {\n        case 'hour':\n          date.setHours(date.getHours() - currentPeriod, 0, 0);\n          format = new qx.util.format.DateFormat(qx.locale.Date.getDateTimeFormat('hmm', 'h:mm'));\n          return format.format(date);\n\n        case 'day':\n          if (currentPeriod === 0) {\n            return qx.locale.Manager.tr('today');\n          } else if (currentPeriod === 1) {\n            return qx.locale.Manager.tr('yesterday');\n          }\n          date.setDate(date.getDate() - currentPeriod);\n          format = new qx.util.format.DateFormat(qx.locale.Date.getDateTimeFormat('MMMd', 'd. MMM'));\n          return format.format(date);\n\n        case 'week':\n          date.setDate(date.getDate() - currentPeriod*7);\n          return qx.locale.Manager.trc('CW = calendar week', 'CW %1', this.getWeekNumber(date));\n\n        case 'month':\n          date.setMonth(date.getMonth() - currentPeriod);\n          if (date.getFullYear() === new Date().getFullYear()) {\n            // no year needed\n            format = new qx.util.format.DateFormat(qx.locale.Date.getDateTimeFormat('MMM', 'MMM'));\n          } else {\n            format = new qx.util.format.DateFormat(qx.locale.Date.getDateTimeFormat('yyMMM', 'MMM yy'));\n          }\n          return format.format(date);\n\n        case 'year':\n          return date.getFullYear() - currentPeriod;\n      }\n      return '';\n    },\n\n   getWeekNumber(d) {\n      d = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n      // Set to the nearest Thursday: current date + 4 - current day number\n      d.setDate(d.getDate() + 4 - (d.getDay() || 7));\n      // Get first day of year\n      const yearStart = new Date(d.getFullYear(), 0, 1);\n      // Calculate full weeks to the nearest Thursday\n      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);\n    },\n\n    /**\n     * add opacity to color\n     * @param color\n     * @param opacity {string} hex number 0 - 255\n     * @return {string|*}\n     * @private\n     */\n    __opacifyColor(color, opacity) {\n      if (color.startsWith('rgb(')) {\n        return 'rgba(' + color.substring(4, color.length-1) + ', ' + (parseInt(opacity, 16) / 255).toFixed(2) + ')';\n      } else if (color.startsWith('#') && color.length === 7) {\n        return color + opacity;\n      }\n      return color;\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    this._chartConf = null;\n    this._helpers = null;\n  },\n\n  defer(QxClass) {\n    customElements.define(\n      cv.ui.structure.tile.Controller.PREFIX + 'chart',\n      class extends QxConnector {\n        constructor() {\n          super(QxClass);\n        }\n      }\n    );\n  }\n});\n"
  ],
  "mappings": "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"
}