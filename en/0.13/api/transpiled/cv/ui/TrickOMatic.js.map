{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "id",
    "run",
    "svg",
    "getSVGDocument",
    "pipes",
    "querySelectorAll",
    "forEach",
    "pipe_group",
    "path",
    "halfsize",
    "Math",
    "floor",
    "parseFloat",
    "style",
    "strokeWidth",
    "opacity",
    "width",
    "n",
    "cloneNode",
    "className",
    "baseVal",
    "stroke",
    "strokeOpacity",
    "insertBefore",
    "nextElementSibling",
    "model",
    "cv",
    "data",
    "Model",
    "getInstance",
    "segmentLength",
    "length",
    "animVal",
    "split",
    "indexOf",
    "r",
    "g",
    "b",
    "parseInt",
    "substring",
    "colors",
    "replace",
    "rTarget",
    "gTarget",
    "bTarget",
    "toHex",
    "v",
    "ret",
    "toString",
    "i",
    "factor",
    "offset",
    "low",
    "high",
    "strokeDasharray",
    "strokeDashoffset",
    "getTotalLength",
    "activeValues",
    "getAttribute",
    "address",
    "ui",
    "TrickOMatic",
    "addAddress",
    "addUpdateListener",
    "updateActive",
    "getState",
    "createKeyframe",
    "name",
    "content",
    "keyframes",
    "createCSSRules",
    "value",
    "concat",
    "s",
    "createElementNS",
    "setAttribute",
    "textContent",
    "svgElement",
    "querySelector",
    "firstChild",
    "classList",
    "toggle"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/TrickOMatic.js"
  ],
  "sourcesContent": [
    "/* TrickOMatic.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * @author Christian Mayer\n * @since 2010\n */\nqx.Class.define('cv.ui.TrickOMatic', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    id: 0,\n\n    run() {\n      const svg = this.getSVGDocument();\n      if (!svg) {\n        return;\n      }\n\n      // Pipe-O-Matic:\n      let pipes = svg.querySelectorAll('.pipe_group');\n      pipes.forEach(function (pipe_group) {\n        pipe_group.querySelectorAll('path').forEach(function (path) {\n          const halfsize = Math.floor(parseFloat(path.style.strokeWidth) / 2);\n          let opacity = 0.15;\n          for (let width = halfsize - 1; width > 0; width--) {\n            opacity -= 0.1 / halfsize;\n            const n = path.cloneNode();\n            n.className.baseVal += ' pipe-o-matic_clone';\n            n.style.strokeWidth = width * 2;\n            n.style.stroke = '#ffffff';\n            n.style.strokeOpacity = opacity;\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n        });\n      });\n\n      const model = cv.data.Model.getInstance();\n\n      // Flow-O-Matic: add Paths\n      const segmentLength = 40;\n      pipes = svg.querySelectorAll('.show_flow');\n      pipes.forEach(function (pipe_group) {\n        let length = 0.0;\n        pipe_group.querySelectorAll('path').forEach(function (path) {\n          if (path.className.animVal.split(' ').indexOf('pipe-o-matic_clone') > 0) {\n            return;\n          }\n          const stroke = path.style.stroke;\n          let r;\n          let g;\n          let b;\n          if (stroke[0] === '#') {\n            r = parseInt(path.style.stroke.substring(1, 3), 16);\n            g = parseInt(path.style.stroke.substring(3, 5), 16);\n            b = parseInt(path.style.stroke.substring(5, 7), 16);\n          } else if (stroke.indexOf('rgb(') === 0) {\n            const colors = stroke.replace(/[^0-9,.]*/g, '').split(',');\n            r = colors[0];\n            g = colors[1];\n            b = colors[2];\n          }\n          const rTarget = 0; // this color should be somehow user setable but how?\n          const gTarget = 0;\n          const bTarget = 0;\n\n          /**\n           * @param v\n           */\n          function toHex(v) {\n            const ret = parseInt(v).toString(16);\n            return ret.length < 2 ? '0' + ret : ret;\n          }\n\n          for (let i = segmentLength / 2; i > 0; i -= 2) {\n            const factor = 1 - i / (segmentLength / 2);\n            const offset = (length + segmentLength / 2 - i) % segmentLength;\n            const low = 2 * i;\n            const high = segmentLength - low;\n            const n = path.cloneNode();\n            n.className.baseVal += ' flow-o-matic_clone';\n            n.style.stroke =\n              '#' +\n              toHex(r * factor + rTarget * (1 - factor)) +\n              toHex(g * factor + gTarget * (1 - factor)) +\n              toHex(b * factor + bTarget * (1 - factor));\n            if (high > offset) {\n              n.style.strokeDasharray = [high - offset, low, offset, 0];\n            } else {\n              n.style.strokeDasharray = [0, low - (offset - high), high, offset - high];\n            }\n            n.style.strokeDashoffset = length % (0.5 * segmentLength);\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n          length += path.getTotalLength();\n          const activeValues = pipe_group.getAttribute('data-cometvisu-active');\n          if (activeValues) {\n            activeValues.split(' ').forEach(function (address) {\n              const id = 'flow_' + cv.ui.TrickOMatic.id++;\n              model.addAddress(address, id);\n              model.addUpdateListener(address, function (address, data) {\n                cv.ui.TrickOMatic.updateActive(pipe_group, data);\n              });\n              // init\n              cv.ui.TrickOMatic.updateActive(pipe_group, cv.data.Model.getInstance().getState(address));\n            });\n          }\n        });\n      });\n\n      // Flow-O-Matic: add CSS\n      // helper for multiple bowser support\n      /**\n       * @param name\n       * @param content\n       */\n      function createKeyframe(name, content) {\n        return (\n          '@keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n' +\n          '@-moz-keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n' +\n          '@-webkit-keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n'\n        );\n      }\n\n      let keyframes = createKeyframe(\n        'move',\n        'from {  stroke-dashoffset: ' + segmentLength + ';  }\\nto   {  stroke-dashoffset: 0;  }\\n'\n      );\n\n      /**\n       * @param style\n       * @param value\n       */\n      function createCSSRules(style, value) {\n        return `${style}: ${value};\n          -moz-${style}: ${value};\n          -webkit-${style}: ${value};\n        `;\n      }\n\n      keyframes +=\n        '.flow_active path {\\n' +\n        createCSSRules('animation-duration', '3s') +\n        createCSSRules('animation-name', 'move') +\n        createCSSRules('animation-timing-function', 'linear') +\n        createCSSRules('animation-iteration-count', 'infinite') +\n        '}\\n';\n      const s = svg.createElementNS('http://www.w3.org/2000/svg', 'style');\n      s.setAttribute('type', 'text/css');\n      s.textContent = keyframes;\n      const svgElement = svg.querySelector('svg');\n      svgElement.insertBefore(s, svgElement.firstChild);\n    },\n\n    updateActive(pipe_group, data) {\n      if (parseInt(data) === 1 || data === 'ON' || data === true) {\n        pipe_group.classList.toggle('flow_active', true);\n      } else {\n        pipe_group.classList.toggle('flow_active', false);\n      }\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}