{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/TrickOMatic.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "id",
    "run",
    "svg",
    "getSVGDocument",
    "pipes",
    "querySelectorAll",
    "forEach",
    "pipe_group",
    "path",
    "halfsize",
    "parseInt",
    "parseFloat",
    "style",
    "strokeWidth",
    "opacity",
    "width",
    "n",
    "cloneNode",
    "className",
    "baseVal",
    "stroke",
    "strokeOpacity",
    "insertBefore",
    "nextElementSibling",
    "model",
    "cv",
    "data",
    "Model",
    "getInstance",
    "segmentLength",
    "length",
    "animVal",
    "split",
    "indexOf",
    "r",
    "g",
    "b",
    "substring",
    "colors",
    "replace",
    "rTarget",
    "gTarget",
    "bTarget",
    "toHex",
    "v",
    "ret",
    "toString",
    "i",
    "factor",
    "offset",
    "low",
    "high",
    "strokeDasharray",
    "strokeDashoffset",
    "getTotalLength",
    "activeValues",
    "getAttribute",
    "address",
    "ui",
    "TrickOMatic",
    "addAddress",
    "addUpdateListener",
    "updateActive",
    "getState",
    "createKeyframe",
    "name",
    "content",
    "keyframes",
    "createCSSRules",
    "value",
    "s",
    "createElementNS",
    "setAttribute",
    "textContent",
    "dom",
    "Element",
    "insertBegin",
    "querySelector",
    "classList",
    "toggle"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* TrickOMatic.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * @author Christian Mayer\n * @since 2010\n */\nqx.Class.define('cv.ui.TrickOMatic', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    id: 0,\n\n    run: function () {\n      const svg = this.getSVGDocument();\n      if (!svg) {\n return; \n}\n\n      // Pipe-O-Matic:\n      let pipes = svg.querySelectorAll('.pipe_group');\n      pipes.forEach(function (pipe_group) {\n        pipe_group.querySelectorAll('path').forEach(function(path) {\n          const halfsize = parseInt(parseFloat(path.style.strokeWidth) / 2);\n          let opacity = 0.15;\n          for (let width = halfsize - 1; width > 0; width--) {\n            opacity -= 0.1 / halfsize;\n            const n = path.cloneNode();\n            n.className.baseVal += ' pipe-o-matic_clone';\n            n.style.strokeWidth = width * 2;\n            n.style.stroke = '#ffffff';\n            n.style.strokeOpacity = opacity;\n            pipe_group.insertBefore(n,\n              path.nextElementSibling);\n          }\n        });\n      });\n\n      const model = cv.data.Model.getInstance();\n\n      // Flow-O-Matic: add Paths\n      const segmentLength = 40;\n      pipes = svg.querySelectorAll('.show_flow');\n      pipes.forEach(function (pipe_group) {\n        let length = 0.0;\n        pipe_group.querySelectorAll('path').forEach(function(path) {\n          if (path.className.animVal.split(' ').indexOf('pipe-o-matic_clone') > 0) {\n            return;\n          }\n          const stroke = path.style.stroke;\n          let r;\n          let g;\n          let b;\n          if (stroke[0] === '#') {\n            r = parseInt(path.style.stroke.substring(1, 3), 16);\n            g = parseInt(path.style.stroke.substring(3, 5), 16);\n            b = parseInt(path.style.stroke.substring(5, 7), 16);\n          } else if (stroke.indexOf('rgb(') === 0) {\n            const colors = stroke.replace(/[^0-9,.]*/g, '').split(',');\n            r = colors[0];\n            g = colors[1];\n            b = colors[2];\n          }\n          const rTarget = 0; // this color should be somehow user setable but how?\n          const gTarget = 0;\n          const bTarget = 0;\n\n          /**\n           * @param v\n           */\n          function toHex(v) {\n            const ret = parseInt(v).toString(16);\n            return (ret.length < 2) ? '0' + ret : ret;\n          }\n\n          for (let i = segmentLength / 2; i > 0; i -= 2) {\n            const factor = 1 - i / (segmentLength / 2);\n            const offset = (length + segmentLength / 2 - i) % segmentLength;\n            const low = 2 * i;\n            const high = segmentLength - low;\n            const n = path.cloneNode();\n            n.className.baseVal += ' flow-o-matic_clone';\n            n.style.stroke = '#' + toHex(r * factor + rTarget * (1 - factor)) + toHex(g * factor + gTarget * (1 - factor)) + toHex(b * factor + bTarget * (1 - factor));\n            if (high > offset) {\n              n.style.strokeDasharray = [high - offset, low, offset, 0];\n            } else {\n              n.style.strokeDasharray = [0, low - (offset - high), high, offset - high];\n            }\n            n.style.strokeDashoffset = length % (0.5 * segmentLength);\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n          length += path.getTotalLength();\n          const activeValues = pipe_group.getAttribute('data-cometvisu-active');\n          if (activeValues) {\n            activeValues.split(' ').forEach(function (address) {\n              const id = 'flow_' + cv.ui.TrickOMatic.id++;\n              model.addAddress(address, id);\n              model.addUpdateListener(address, function (address, data) {\n                cv.ui.TrickOMatic.updateActive(pipe_group, data);\n              });\n              // init\n              cv.ui.TrickOMatic.updateActive(pipe_group, cv.data.Model.getInstance().getState(address));\n            });\n          }\n        });\n      });\n\n      // Flow-O-Matic: add CSS\n      // helper for multiple bowser support\n      /**\n       * @param name\n       * @param content\n       */\n      function createKeyframe(name, content) {\n        return '@keyframes ' + name + ' {\\n' + content + '}\\n' +\n          '@-moz-keyframes ' + name + ' {\\n' + content + '}\\n' +\n          '@-webkit-keyframes ' + name + ' {\\n' + content + '}\\n';\n      }\n\n      let keyframes = createKeyframe('move',\n        'from {  stroke-dashoffset: ' + segmentLength + ';  }\\n' +\n        'to   {  stroke-dashoffset: 0;  }\\n');\n\n      /**\n       * @param style\n       * @param value\n       */\n      function createCSSRules(style, value) {\n        return `${style}: ${value};\n-moz-${style}: ${value};\n-webkit-${style}: ${value};\n`;\n    }\n\n      keyframes += '.flow_active path {\\n' +\n        createCSSRules('animation-duration', '3s') +\n        createCSSRules('animation-name', 'move')+\n        createCSSRules('animation-timing-function', 'linear') +\n        createCSSRules('animation-iteration-count', 'infinite') +\n        '}\\n';\n      const s = svg.createElementNS('http://www.w3.org/2000/svg',\n        'style');\n      s.setAttribute('type', 'text/css');\n      s.textContent = keyframes;\n      qx.dom.Element.insertBegin(s, svg.querySelector('svg'));\n    },\n\n    updateActive: function (pipe_group, data) {\n      if (parseInt(data) === 1 || data === 'ON') {\n        pipe_group.classList.toggle('flow_active', true);\n      } else {\n        pipe_group.classList.toggle('flow_active', false);\n      }\n    }\n  }\n});\n"
  ]
}