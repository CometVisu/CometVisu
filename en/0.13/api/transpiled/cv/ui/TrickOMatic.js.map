{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "id",
    "run",
    "svg",
    "getSVGDocument",
    "pipes",
    "querySelectorAll",
    "forEach",
    "pipe_group",
    "path",
    "halfsize",
    "Math",
    "floor",
    "parseFloat",
    "style",
    "strokeWidth",
    "opacity",
    "width",
    "n",
    "cloneNode",
    "className",
    "baseVal",
    "stroke",
    "strokeOpacity",
    "insertBefore",
    "nextElementSibling",
    "model",
    "cv",
    "data",
    "Model",
    "getInstance",
    "segmentLength",
    "length",
    "animVal",
    "split",
    "indexOf",
    "r",
    "g",
    "b",
    "parseInt",
    "substring",
    "colors",
    "replace",
    "rTarget",
    "gTarget",
    "bTarget",
    "toHex",
    "v",
    "ret",
    "toString",
    "i",
    "factor",
    "offset",
    "low",
    "high",
    "strokeDasharray",
    "strokeDashoffset",
    "getTotalLength",
    "activeValues",
    "getAttribute",
    "address",
    "ui",
    "TrickOMatic",
    "addAddress",
    "addUpdateListener",
    "updateActive",
    "getState",
    "createKeyframe",
    "name",
    "content",
    "keyframes",
    "createCSSRules",
    "value",
    "s",
    "createElementNS",
    "setAttribute",
    "textContent",
    "svgElement",
    "querySelector",
    "firstChild",
    "classList",
    "toggle"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/TrickOMatic.js"
  ],
  "sourcesContent": [
    "/* TrickOMatic.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * @author Christian Mayer\n * @since 2010\n */\nqx.Class.define('cv.ui.TrickOMatic', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    id: 0,\n\n    run() {\n      const svg = this.getSVGDocument();\n      if (!svg) {\n        return;\n      }\n\n      // Pipe-O-Matic:\n      let pipes = svg.querySelectorAll('.pipe_group');\n      pipes.forEach(function (pipe_group) {\n        pipe_group.querySelectorAll('path').forEach(function (path) {\n          const halfsize = Math.floor(parseFloat(path.style.strokeWidth) / 2);\n          let opacity = 0.15;\n          for (let width = halfsize - 1; width > 0; width--) {\n            opacity -= 0.1 / halfsize;\n            const n = path.cloneNode();\n            n.className.baseVal += ' pipe-o-matic_clone';\n            n.style.strokeWidth = width * 2;\n            n.style.stroke = '#ffffff';\n            n.style.strokeOpacity = opacity;\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n        });\n      });\n\n      const model = cv.data.Model.getInstance();\n\n      // Flow-O-Matic: add Paths\n      const segmentLength = 40;\n      pipes = svg.querySelectorAll('.show_flow');\n      pipes.forEach(function (pipe_group) {\n        let length = 0.0;\n        pipe_group.querySelectorAll('path').forEach(function (path) {\n          if (path.className.animVal.split(' ').indexOf('pipe-o-matic_clone') > 0) {\n            return;\n          }\n          const stroke = path.style.stroke;\n          let r;\n          let g;\n          let b;\n          if (stroke[0] === '#') {\n            r = parseInt(path.style.stroke.substring(1, 3), 16);\n            g = parseInt(path.style.stroke.substring(3, 5), 16);\n            b = parseInt(path.style.stroke.substring(5, 7), 16);\n          } else if (stroke.indexOf('rgb(') === 0) {\n            const colors = stroke.replace(/[^0-9,.]*/g, '').split(',');\n            r = colors[0];\n            g = colors[1];\n            b = colors[2];\n          }\n          const rTarget = 0; // this color should be somehow user setable but how?\n          const gTarget = 0;\n          const bTarget = 0;\n\n          /**\n           * @param v\n           */\n          function toHex(v) {\n            const ret = parseInt(v).toString(16);\n            return ret.length < 2 ? '0' + ret : ret;\n          }\n\n          for (let i = segmentLength / 2; i > 0; i -= 2) {\n            const factor = 1 - i / (segmentLength / 2);\n            const offset = (length + segmentLength / 2 - i) % segmentLength;\n            const low = 2 * i;\n            const high = segmentLength - low;\n            const n = path.cloneNode();\n            n.className.baseVal += ' flow-o-matic_clone';\n            n.style.stroke =\n              '#' +\n              toHex(r * factor + rTarget * (1 - factor)) +\n              toHex(g * factor + gTarget * (1 - factor)) +\n              toHex(b * factor + bTarget * (1 - factor));\n            if (high > offset) {\n              n.style.strokeDasharray = [high - offset, low, offset, 0];\n            } else {\n              n.style.strokeDasharray = [0, low - (offset - high), high, offset - high];\n            }\n            n.style.strokeDashoffset = length % (0.5 * segmentLength);\n            pipe_group.insertBefore(n, path.nextElementSibling);\n          }\n          length += path.getTotalLength();\n          const activeValues = pipe_group.getAttribute('data-cometvisu-active');\n          if (activeValues) {\n            activeValues.split(' ').forEach(function (address) {\n              const id = 'flow_' + cv.ui.TrickOMatic.id++;\n              model.addAddress(address, id);\n              model.addUpdateListener(address, function (address, data) {\n                cv.ui.TrickOMatic.updateActive(pipe_group, data);\n              });\n              // init\n              cv.ui.TrickOMatic.updateActive(pipe_group, cv.data.Model.getInstance().getState(address));\n            });\n          }\n        });\n      });\n\n      // Flow-O-Matic: add CSS\n      // helper for multiple bowser support\n      /**\n       * @param name\n       * @param content\n       */\n      function createKeyframe(name, content) {\n        return (\n          '@keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n' +\n          '@-moz-keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n' +\n          '@-webkit-keyframes ' +\n          name +\n          ' {\\n' +\n          content +\n          '}\\n'\n        );\n      }\n\n      let keyframes = createKeyframe(\n        'move',\n        'from {  stroke-dashoffset: ' + segmentLength + ';  }\\nto   {  stroke-dashoffset: 0;  }\\n'\n      );\n\n      /**\n       * @param style\n       * @param value\n       */\n      function createCSSRules(style, value) {\n        return `${style}: ${value};\n          -moz-${style}: ${value};\n          -webkit-${style}: ${value};\n        `;\n      }\n\n      keyframes +=\n        '.flow_active path {\\n' +\n        createCSSRules('animation-duration', '3s') +\n        createCSSRules('animation-name', 'move') +\n        createCSSRules('animation-timing-function', 'linear') +\n        createCSSRules('animation-iteration-count', 'infinite') +\n        '}\\n';\n      const s = svg.createElementNS('http://www.w3.org/2000/svg', 'style');\n      s.setAttribute('type', 'text/css');\n      s.textContent = keyframes;\n      const svgElement = svg.querySelector('svg');\n      svgElement.insertBefore(s, svgElement.firstChild);\n    },\n\n    updateActive(pipe_group, data) {\n      if (parseInt(data) === 1 || data === 'ON' || data === true) {\n        pipe_group.classList.toggle('flow_active', true);\n      } else {\n        pipe_group.classList.toggle('flow_active', false);\n      }\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}