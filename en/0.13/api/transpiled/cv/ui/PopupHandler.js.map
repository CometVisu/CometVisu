{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/PopupHandler.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "popups",
    "configs",
    "init",
    "addPopup",
    "cv",
    "ui",
    "Popup",
    "core",
    "notifications",
    "Router",
    "getInstance",
    "registerMessageHandler",
    "icon",
    "deletable",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onPageChanged",
    "ev",
    "Object",
    "keys",
    "forEach",
    "popup",
    "domElement",
    "getCurrentDomElement",
    "$$page",
    "getData",
    "removePopup",
    "handleMessage",
    "config",
    "popupConfig",
    "title",
    "content",
    "closable",
    "iconClasses",
    "actions",
    "progress",
    "evaluateCondition",
    "showPopup",
    "getPopup",
    "isClosed",
    "close",
    "attributes",
    "create",
    "parentNode",
    "removeChild",
    "object",
    "Assert",
    "assertInstance",
    "getType",
    "name",
    "p",
    "undefined",
    "unknown",
    "placementStrategy",
    "anchor",
    "page",
    "preference",
    "position_order",
    "unshift",
    "pos",
    "xy",
    "x",
    "w",
    "y",
    "h",
    "defer",
    "PopupHandler"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* PopupHandler.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Handles all popups\n */\nqx.Class.define('cv.ui.PopupHandler', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    popups: {},\n    configs: {},\n\n    init: function() {\n      this.addPopup(new cv.ui.Popup('unknown'));\n      this.addPopup(new cv.ui.Popup('info'));\n      this.addPopup(new cv.ui.Popup('warning'));\n      this.addPopup(new cv.ui.Popup('error'));\n\n      // register to topics\n      cv.core.notifications.Router.getInstance().registerMessageHandler(this, {\n        'cv.config.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n        'cv.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n        'cv.client.connection': {\n          type: 'error',\n          icon: 'message_attention',\n          deletable: true\n        }\n      });\n      qx.event.message.Bus.subscribe('path.pageLeft', this._onPageChanged, this);\n    },\n\n    /**\n     * close all popups (except errors) for the page that has been left just now.\n     * @param ev {Event}\n     */\n    _onPageChanged: function (ev) {\n      Object.keys(this.popups).forEach(function (type) {\n        if (type !== 'error') {\n          const popup = this.popups[type];\n          const domElement = popup.getCurrentDomElement();\n          if (domElement && domElement.$$page === ev.getData()) {\n            this.removePopup(popup);\n          }\n        }\n      }, this);\n    },\n\n    handleMessage: function(message, config) {\n      const popupConfig = {\n        title: message.title,\n        content: message.message,\n        closable: config.deletable || message.deletable,\n        icon: message.icon || config.icon,\n        iconClasses: message.iconClasses,\n        actions: message.actions,\n        progress: message.progress,\n        type: 'notification'\n      };\n      // popups are always unique\n      if (cv.core.notifications.Router.evaluateCondition(message)) {\n        this.showPopup(config.type, popupConfig);\n      } else {\n        const popup = this.getPopup(config.type);\n        if (!popup.isClosed()) {\n          popup.close();\n        }\n      }\n    },\n\n    /**\n     * Show a popup of type \"type\". The attributes is an type dependent object\n     *\n     * @param type {String} popup type\n     * @param attributes {Map} popup configuration (content, title, stylings etc)\n     * @return {cv.ui.Popup} The popup\n     */\n    showPopup: function (type, attributes) {\n      const popup = this.getPopup(type);\n      // if (!popup.isClosed()) {\n      //   popup.close();\n      // }\n      popup.create(attributes);\n      return popup;\n    },\n\n    /**\n     * Remove the popup.\n     * @param popup {cv.ui.Popup} popup returned by showPopup()\n     */\n    removePopup: function (popup) {\n      if (popup instanceof cv.ui.Popup) {\n        popup.close();\n      } else {\n        popup.parentNode.removeChild(popup);\n      }\n    },\n\n    /**\n     * Add a popup to the internal list\n     * @param object {cv.ui.Popup} the popup\n     */\n    addPopup: function (object) {\n      qx.core.Assert.assertInstance(object, cv.ui.Popup);\n      this.popups[object.getType()] = object;\n    },\n\n    /**\n     * Retrieve a popup by name\n     * @param name {String} name of the popup\n     * @return {Object}\n     */\n    getPopup: function(name) {\n      const p = this.popups[name];\n      if (p === undefined) {\n        return this.popups.unknown;\n      }\n      return this.popups[name];\n    },\n\n    /**\n     * Figure out best placement of popup.\n     * A preference can optionally be passed. The position is that of the numbers\n     * on the numeric keypad. I.e. a value of \"6\" means centered above the anchor.\n     * A value of \"0\" means centered to the page\n     *\n     * @param anchor {Map}\n     * @param popup {Map}\n     * @param page {Map}\n     * @param preference {Number}\n     * @return {Map}\n     */\n    placementStrategy: function(anchor, popup, page, preference) {\n      const position_order = [8, 2, 6, 4, 9, 3, 7, 1, 5, 0];\n      if (preference !== undefined) {\n position_order.unshift(preference); \n}\n\n      for (let pos in position_order) {\n        const xy = {};\n        switch (position_order[pos]) {\n          case 0: // page center - will always work\n            return {x: (page.w - popup.w) / 2, y: (page.h - popup.h) / 2};\n\n          case 1:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 2:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 3:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 4:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 5:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 6:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 7:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 8:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 9:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y - popup.h;\n            break;\n        }\n\n        // test if that solution is valid\n        if (xy.x >= 0 && xy.y >= 0 && xy.x + popup.w <= page.w && xy.y + popup.h <= page.h) {\n          return xy;\n        }\n      }\n\n      return {x: 0, y: 0}; // sanity return\n    }\n  },\n\n  defer: function(statics) {\n    // qx.event.message.Bus.subscribe(\"setup.dom.finished\", statics.init, statics);\n    statics.init();\n  }\n});\n"
  ]
}