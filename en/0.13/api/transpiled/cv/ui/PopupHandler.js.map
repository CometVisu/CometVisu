{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "popups",
    "configs",
    "init",
    "addPopup",
    "cv",
    "ui",
    "Popup",
    "core",
    "notifications",
    "Router",
    "getInstance",
    "registerMessageHandler",
    "icon",
    "deletable",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onPageChanged",
    "ev",
    "Object",
    "keys",
    "forEach",
    "popup",
    "domElement",
    "getCurrentDomElement",
    "$$page",
    "getData",
    "removePopup",
    "handleMessage",
    "config",
    "popupConfig",
    "title",
    "content",
    "closable",
    "iconClasses",
    "actions",
    "progress",
    "evaluateCondition",
    "showPopup",
    "getPopup",
    "isClosed",
    "close",
    "attributes",
    "create",
    "parentNode",
    "removeChild",
    "object",
    "Assert",
    "assertInstance",
    "getType",
    "name",
    "p",
    "undefined",
    "unknown",
    "placementStrategy",
    "anchor",
    "page",
    "preference",
    "position_order",
    "unshift",
    "pos",
    "xy",
    "x",
    "w",
    "y",
    "h",
    "defer",
    "PopupHandler"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/PopupHandler.js"
  ],
  "sourcesContent": [
    "/* PopupHandler.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Handles all popups\n */\nqx.Class.define('cv.ui.PopupHandler', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    popups: {},\n    configs: {},\n\n    init() {\n      this.addPopup(new cv.ui.Popup('unknown'));\n      this.addPopup(new cv.ui.Popup('info'));\n      this.addPopup(new cv.ui.Popup('warning'));\n      this.addPopup(new cv.ui.Popup('error'));\n\n      // register to topics\n      cv.core.notifications.Router.getInstance().registerMessageHandler(this, {\n        'cv.config.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n\n        'cv.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n\n        'cv.client.connection': {\n          type: 'error',\n          icon: 'message_attention',\n          deletable: true\n        }\n      });\n\n      qx.event.message.Bus.subscribe('path.pageLeft', this._onPageChanged, this);\n    },\n\n    /**\n     * close all popups (except errors) for the page that has been left just now.\n     * @param ev {Event}\n     */\n    _onPageChanged(ev) {\n      Object.keys(this.popups).forEach(function (type) {\n        if (type !== 'error') {\n          const popup = this.popups[type];\n          const domElement = popup.getCurrentDomElement();\n          if (domElement && domElement.$$page === ev.getData()) {\n            this.removePopup(popup);\n          }\n        }\n      }, this);\n    },\n\n    handleMessage(message, config) {\n      const popupConfig = {\n        title: message.title,\n        content: message.message,\n        closable: config.deletable || message.deletable,\n        icon: message.icon || config.icon,\n        iconClasses: message.iconClasses,\n        actions: message.actions,\n        progress: message.progress,\n        type: 'notification'\n      };\n\n      // popups are always unique\n      if (cv.core.notifications.Router.evaluateCondition(message)) {\n        this.showPopup(config.type, popupConfig);\n      } else {\n        const popup = this.getPopup(config.type);\n        if (!popup.isClosed()) {\n          popup.close();\n        }\n      }\n    },\n\n    /**\n     * Show a popup of type \"type\". The attributes is an type dependent object\n     *\n     * @param type {String} popup type\n     * @param attributes {Map} popup configuration (content, title, stylings etc)\n     * @return {cv.ui.Popup} The popup\n     */\n    showPopup(type, attributes) {\n      const popup = this.getPopup(type);\n      // if (!popup.isClosed()) {\n      //   popup.close();\n      // }\n      popup.create(attributes);\n      return popup;\n    },\n\n    /**\n     * Remove the popup.\n     * @param popup {cv.ui.Popup} popup returned by showPopup()\n     */\n    removePopup(popup) {\n      if (popup instanceof cv.ui.Popup) {\n        popup.close();\n      } else {\n        popup.parentNode.removeChild(popup);\n      }\n    },\n\n    /**\n     * Add a popup to the internal list\n     * @param object {cv.ui.Popup} the popup\n     */\n    addPopup(object) {\n      qx.core.Assert.assertInstance(object, cv.ui.Popup);\n      this.popups[object.getType()] = object;\n    },\n\n    /**\n     * Retrieve a popup by name\n     * @param name {String} name of the popup\n     * @return {Object}\n     */\n    getPopup(name) {\n      const p = this.popups[name];\n      if (p === undefined) {\n        return this.popups.unknown;\n      }\n      return this.popups[name];\n    },\n\n    /**\n     * Figure out best placement of popup.\n     * A preference can optionally be passed. The position is that of the numbers\n     * on the numeric keypad. I.e. a value of \"6\" means centered above the anchor.\n     * A value of \"0\" means centered to the page\n     *\n     * @param anchor {Map}\n     * @param popup {Map}\n     * @param page {Map}\n     * @param preference {Number}\n     * @return {Map}\n     */\n    placementStrategy(anchor, popup, page, preference) {\n      const position_order = [8, 2, 6, 4, 9, 3, 7, 1, 5, 0];\n      if (preference !== undefined) {\n        position_order.unshift(preference);\n      }\n\n      for (let pos in position_order) {\n        const xy = {};\n        switch (position_order[pos]) {\n          case 0: // page center - will always work\n            return { x: (page.w - popup.w) / 2, y: (page.h - popup.h) / 2 };\n\n          case 1:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 2:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 3:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 4:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 5:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 6:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 7:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 8:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 9:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y - popup.h;\n            break;\n        }\n\n        // test if that solution is valid\n        if (xy.x >= 0 && xy.y >= 0 && xy.x + popup.w <= page.w && xy.y + popup.h <= page.h) {\n          return xy;\n        }\n      }\n\n      return { x: 0, y: 0 }; // sanity return\n    }\n  },\n\n  defer(statics) {\n    // qx.event.message.Bus.subscribe(\"setup.dom.finished\", statics.init, statics);\n    statics.init();\n  }\n});\n"
  ],
  "mappings": "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"
}