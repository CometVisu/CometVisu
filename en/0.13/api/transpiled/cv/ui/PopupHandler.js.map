{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "popups",
    "configs",
    "init",
    "addPopup",
    "cv",
    "ui",
    "Popup",
    "core",
    "notifications",
    "Router",
    "getInstance",
    "registerMessageHandler",
    "icon",
    "deletable",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onPageChanged",
    "ev",
    "Object",
    "keys",
    "forEach",
    "popup",
    "domElement",
    "getCurrentDomElement",
    "$$page",
    "getData",
    "removePopup",
    "handleMessage",
    "config",
    "popupConfig",
    "title",
    "content",
    "closable",
    "iconClasses",
    "actions",
    "progress",
    "evaluateCondition",
    "showPopup",
    "getPopup",
    "isClosed",
    "close",
    "confirm",
    "callback",
    "decline",
    "action",
    "attributes",
    "create",
    "parentNode",
    "removeChild",
    "object",
    "Assert",
    "assertInstance",
    "getType",
    "name",
    "p",
    "undefined",
    "unknown",
    "placementStrategy",
    "anchor",
    "page",
    "preference",
    "position_order",
    "unshift",
    "pos",
    "xy",
    "x",
    "w",
    "y",
    "h",
    "defer",
    "PopupHandler"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/PopupHandler.js"
  ],
  "sourcesContent": [
    "/* PopupHandler.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Handles all popups\n */\nqx.Class.define('cv.ui.PopupHandler', {\n  type: 'static',\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    popups: {},\n    configs: {},\n\n    init() {\n      this.addPopup(new cv.ui.Popup('unknown'));\n      this.addPopup(new cv.ui.Popup('info'));\n      this.addPopup(new cv.ui.Popup('warning'));\n      this.addPopup(new cv.ui.Popup('error'));\n      this.addPopup(new cv.ui.Popup('confirm'));\n\n      // register to topics\n      cv.core.notifications.Router.getInstance().registerMessageHandler(this, {\n        'cv.config.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n\n        'cv.error': {\n          type: 'error',\n          icon: 'message_attention'\n        },\n\n        'cv.client.connection': {\n          type: 'error',\n          icon: 'message_attention',\n          deletable: true\n        }\n      });\n\n      qx.event.message.Bus.subscribe('path.pageLeft', this._onPageChanged, this);\n    },\n\n    /**\n     * close all popups (except errors) for the page that has been left just now.\n     * @param ev {Event}\n     */\n    _onPageChanged(ev) {\n      Object.keys(this.popups).forEach(function (type) {\n        if (type !== 'error') {\n          const popup = this.popups[type];\n          const domElement = popup.getCurrentDomElement();\n          if (domElement && domElement.$$page === ev.getData()) {\n            this.removePopup(popup);\n          }\n        }\n      }, this);\n    },\n\n    handleMessage(message, config) {\n      const popupConfig = {\n        title: message.title,\n        content: message.message,\n        closable: config.deletable || message.deletable,\n        icon: message.icon || config.icon,\n        iconClasses: message.iconClasses,\n        actions: message.actions,\n        progress: message.progress,\n        type: 'notification'\n      };\n\n      // popups are always unique\n      if (cv.core.notifications.Router.evaluateCondition(message)) {\n        this.showPopup(config.type, popupConfig);\n      } else {\n        const popup = this.getPopup(config.type);\n        if (!popup.isClosed()) {\n          popup.close();\n        }\n      }\n    },\n\n    /**\n     * @callback confirmationCallback\n     * @param confirmed {boolean}\n     */\n\n    /**\n     * Show a confirm message the call the callback with the information if\n     * this message has been confirmed or not,\n     * @param title {string}\n     * @param message {string}\n     * @param callback {confirmationCallback}\n     */\n    confirm(title, message, callback) {\n      const popupConfig = {\n        title: title,\n        content: message,\n        closable: true,\n        actions: {\n          decline: [\n            {\n              action() {\n                callback(false);\n              }\n            }\n          ],\n          confirm: [\n            {\n              action() {\n                callback(true);\n              }\n            }\n          ]\n        },\n        type: 'confirmation'\n      };\n      this.showPopup('confirm', popupConfig);\n    },\n\n    /**\n     * Show a popup of type \"type\". The attributes is an type dependent object\n     *\n     * @param type {String} popup type\n     * @param attributes {Map} popup configuration (content, title, stylings etc)\n     * @return {cv.ui.Popup} The popup\n     */\n    showPopup(type, attributes) {\n      const popup = this.getPopup(type);\n      // if (!popup.isClosed()) {\n      //   popup.close();\n      // }\n      popup.create(attributes);\n      return popup;\n    },\n\n    /**\n     * Remove the popup.\n     * @param popup {cv.ui.Popup} popup returned by showPopup()\n     */\n    removePopup(popup) {\n      if (popup instanceof cv.ui.Popup) {\n        popup.close();\n      } else {\n        popup.parentNode.removeChild(popup);\n      }\n    },\n\n    /**\n     * Add a popup to the internal list\n     * @param object {cv.ui.Popup} the popup\n     */\n    addPopup(object) {\n      qx.core.Assert.assertInstance(object, cv.ui.Popup);\n      this.popups[object.getType()] = object;\n    },\n\n    /**\n     * Retrieve a popup by name\n     * @param name {String} name of the popup\n     * @return {Object}\n     */\n    getPopup(name) {\n      const p = this.popups[name];\n      if (p === undefined) {\n        return this.popups.unknown;\n      }\n      return this.popups[name];\n    },\n\n    /**\n     * Figure out best placement of popup.\n     * A preference can optionally be passed. The position is that of the numbers\n     * on the numeric keypad. I.e. a value of \"6\" means centered above the anchor.\n     * A value of \"0\" means centered to the page\n     *\n     * @param anchor {Map}\n     * @param popup {Map}\n     * @param page {Map}\n     * @param preference {Number}\n     * @return {Map}\n     */\n    placementStrategy(anchor, popup, page, preference) {\n      const position_order = [8, 2, 6, 4, 9, 3, 7, 1, 5, 0];\n      if (preference !== undefined) {\n        position_order.unshift(preference);\n      }\n\n      for (let pos in position_order) {\n        const xy = {};\n        switch (position_order[pos]) {\n          case 0: // page center - will always work\n            return { x: (page.w - popup.w) / 2, y: (page.h - popup.h) / 2 };\n\n          case 1:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 2:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 3:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h;\n            break;\n\n          case 4:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 5:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 6:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y + anchor.h / 2 - popup.h / 2;\n            break;\n\n          case 7:\n            xy.x = anchor.x - popup.w;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 8:\n            xy.x = anchor.x + anchor.w / 2 - popup.w / 2;\n            xy.y = anchor.y - popup.h;\n            break;\n\n          case 9:\n            xy.x = anchor.x + anchor.w;\n            xy.y = anchor.y - popup.h;\n            break;\n        }\n\n        // test if that solution is valid\n        if (xy.x >= 0 && xy.y >= 0 && xy.x + popup.w <= page.w && xy.y + popup.h <= page.h) {\n          return xy;\n        }\n      }\n\n      return { x: 0, y: 0 }; // sanity return\n    }\n  },\n\n  defer(statics) {\n    // qx.event.message.Bus.subscribe(\"setup.dom.finished\", statics.init, statics);\n    statics.init();\n  }\n});\n"
  ],
  "mappings": "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"
}