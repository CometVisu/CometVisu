{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/model/BackupFolder.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "model",
    "FileItem",
    "type",
    "construct",
    "load",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onFilesSystemMessage",
    "members",
    "ev",
    "test",
    "getName",
    "data",
    "getData",
    "includes",
    "reload",
    "getBackupFiles",
    "file",
    "files",
    "getType",
    "pathparts",
    "getFullPath",
    "split",
    "pop",
    "path",
    "join",
    "parts",
    "suffix",
    "filename",
    "fileRegex",
    "RegExp",
    "getChildren",
    "forEach",
    "backupFile",
    "match",
    "exec",
    "replace",
    "push",
    "date",
    "Date",
    "parseInt",
    "substring",
    "destruct",
    "unsubscribe",
    "BackupFolder"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* BackupFolder.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n *\n */\nqx.Class.define('cv.ui.manager.model.BackupFolder', {\n  extend: cv.ui.manager.model.FileItem,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments, 'backup');\n    this.load();\n    qx.event.message.Bus.subscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _onFilesSystemMessage: function (ev) {\n      if (/^cv\\.manager\\.fs\\.visu_config.*\\.xml$/.test(ev.getName())) {\n        // Fs event on config file\n        const data = ev.getData();\n        if (['contentChanged', 'fsContentChanged'].includes(data.type)) {\n          // config file has been changed or restored, refresh the backups\n          this.reload();\n        }\n      }\n    },\n\n    /**\n     * Returns the list of existing backup files for the given file.\n     * @param file {cv.ui.manager.model.FileItem}\n     */\n    getBackupFiles: function (file) {\n      const files = [];\n      if (file.getType() === 'file') {\n        const pathparts = file.getFullPath().split('/');\n        pathparts.pop();\n        const path = pathparts.join('\\/');\n        const parts = file.getName().split('.');\n        const suffix = parts.pop();\n        const filename = parts.join('.');\n        const fileRegex = new RegExp(path + filename + '-([\\\\d]{14})\\\\.' + suffix);\n        this.getChildren().forEach(function (backupFile) {\n          const match = fileRegex.exec(backupFile.getFullPath().replace('backup/', ''));\n          if (match) {\n            files.push({\n              date: new Date(\n                parseInt(match[1].substring(0, 4)),\n                parseInt(match[1].substring(4, 6))-1,\n                parseInt(match[1].substring(6, 8)),\n                parseInt(match[1].substring(8, 10)),\n                parseInt(match[1].substring(10, 12)),\n                parseInt(match[1].substring(12, 14))\n              ),\n              file: backupFile\n            });\n          }\n        }, this);\n      }\n      return files;\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    qx.event.message.Bus.unsubscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  }\n});\n"
  ]
}