{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "model",
    "FileItem",
    "type",
    "construct",
    "constructor",
    "call",
    "load",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onFilesSystemMessage",
    "members",
    "ev",
    "test",
    "getName",
    "data",
    "getData",
    "includes",
    "reload",
    "getBackupFiles",
    "file",
    "files",
    "getType",
    "pathparts",
    "getFullPath",
    "split",
    "pop",
    "path",
    "join",
    "parts",
    "suffix",
    "filename",
    "fileRegex",
    "RegExp",
    "getChildren",
    "forEach",
    "backupFile",
    "match",
    "exec",
    "replace",
    "push",
    "date",
    "Date",
    "parseInt",
    "substring",
    "destruct",
    "unsubscribe",
    "BackupFolder"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/model/BackupFolder.js"
  ],
  "sourcesContent": [
    "/* BackupFolder.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n *\n */\nqx.Class.define('cv.ui.manager.model.BackupFolder', {\n  extend: cv.ui.manager.model.FileItem,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super('backup');\n    this.load();\n    qx.event.message.Bus.subscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _onFilesSystemMessage(ev) {\n      if (/^cv\\.manager\\.fs\\.visu_config.*\\.xml$/.test(ev.getName())) {\n        // Fs event on config file\n        const data = ev.getData();\n        if (['contentChanged', 'fsContentChanged'].includes(data.type)) {\n          // config file has been changed or restored, refresh the backups\n          this.reload();\n        }\n      }\n    },\n\n    /**\n     * Returns the list of existing backup files for the given file.\n     * @param file {cv.ui.manager.model.FileItem}\n     */\n    getBackupFiles(file) {\n      const files = [];\n      if (file.getType() === 'file') {\n        const pathparts = file.getFullPath().split('/');\n        pathparts.pop();\n        const path = pathparts.join('/');\n        const parts = file.getName().split('.');\n        const suffix = parts.pop();\n        const filename = parts.join('.');\n        const fileRegex = new RegExp(path + filename + '-([\\\\d]{14})\\\\.' + suffix);\n\n        this.getChildren().forEach(function (backupFile) {\n          const match = fileRegex.exec(backupFile.getFullPath().replace('backup/', ''));\n\n          if (match) {\n            files.push({\n              date: new Date(\n                parseInt(match[1].substring(0, 4)),\n                parseInt(match[1].substring(4, 6)) - 1,\n                parseInt(match[1].substring(6, 8)),\n                parseInt(match[1].substring(8, 10)),\n                parseInt(match[1].substring(10, 12)),\n                parseInt(match[1].substring(12, 14))\n              ),\n\n              file: backupFile\n            });\n          }\n        }, this);\n      }\n      return files;\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    qx.event.message.Bus.unsubscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}