{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "model",
    "FileItem",
    "type",
    "construct",
    "load",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onFilesSystemMessage",
    "members",
    "ev",
    "test",
    "getName",
    "data",
    "getData",
    "includes",
    "reload",
    "getBackupFiles",
    "file",
    "files",
    "getType",
    "pathparts",
    "getFullPath",
    "split",
    "pop",
    "path",
    "join",
    "parts",
    "suffix",
    "filename",
    "fileRegex",
    "RegExp",
    "getChildren",
    "forEach",
    "backupFile",
    "match",
    "exec",
    "replace",
    "push",
    "date",
    "Date",
    "parseInt",
    "substring",
    "destruct",
    "unsubscribe",
    "BackupFolder"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/model/BackupFolder.js"
  ],
  "sourcesContent": [
    "/* BackupFolder.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n *\n */\nqx.Class.define('cv.ui.manager.model.BackupFolder', {\n  extend: cv.ui.manager.model.FileItem,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super('backup');\n    this.load();\n    qx.event.message.Bus.subscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _onFilesSystemMessage(ev) {\n      if (/^cv\\.manager\\.fs\\.visu_config.*\\.xml$/.test(ev.getName())) {\n        // Fs event on config file\n        const data = ev.getData();\n        if (['contentChanged', 'fsContentChanged'].includes(data.type)) {\n          // config file has been changed or restored, refresh the backups\n          this.reload();\n        }\n      }\n    },\n\n    /**\n     * Returns the list of existing backup files for the given file.\n     * @param file {cv.ui.manager.model.FileItem}\n     */\n    getBackupFiles(file) {\n      const files = [];\n      if (file.getType() === 'file') {\n        const pathparts = file.getFullPath().split('/');\n        pathparts.pop();\n        const path = pathparts.join('/');\n        const parts = file.getName().split('.');\n        const suffix = parts.pop();\n        const filename = parts.join('.');\n        const fileRegex = new RegExp(path + filename + '-([\\\\d]{14})\\\\.' + suffix);\n\n        this.getChildren().forEach(function (backupFile) {\n          const match = fileRegex.exec(backupFile.getFullPath().replace('backup/', ''));\n\n          if (match) {\n            files.push({\n              date: new Date(\n                parseInt(match[1].substring(0, 4)),\n                parseInt(match[1].substring(4, 6)) - 1,\n                parseInt(match[1].substring(6, 8)),\n                parseInt(match[1].substring(8, 10)),\n                parseInt(match[1].substring(10, 12)),\n                parseInt(match[1].substring(12, 14))\n              ),\n\n              file: backupFile\n            });\n          }\n        }, this);\n      }\n      return files;\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    qx.event.message.Bus.unsubscribe('cv.manager.fs.*', this._onFilesSystemMessage, this);\n  }\n});\n"
  ],
  "mappings": "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"
}