{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "viewer",
    "AbstractViewer",
    "properties",
    "appearance",
    "refine",
    "init",
    "statics",
    "SUPPORTED_FILES",
    "TITLE",
    "locale",
    "Manager",
    "tr",
    "ICON",
    "theme",
    "dark",
    "Images",
    "getIcon",
    "getImageData",
    "source",
    "data",
    "util",
    "ResourceManager",
    "getInstance",
    "getData",
    "width",
    "height",
    "aspectRatio",
    "io",
    "ImageLoader",
    "getSize",
    "Object",
    "assign",
    "members",
    "_applyFile",
    "file",
    "control",
    "getChildControl",
    "setIcon",
    "getServerPath",
    "setLabel",
    "getFullPath",
    "Image",
    "addListenerOnce",
    "_scaleImage",
    "addListener",
    "resetIcon",
    "resetLabel",
    "removeListener",
    "bounds",
    "getBounds",
    "getFile",
    "icon",
    "paddingX",
    "paddingY",
    "availableHeight",
    "Math",
    "round",
    "set",
    "scale"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/viewer/Image.js"
  ],
  "sourcesContent": [
    "/* Image.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n// noinspection JSClosureCompilerSyntax\n/**\n * Show images.\n */\nqx.Class.define('cv.ui.manager.viewer.Image', {\n  extend: cv.ui.manager.viewer.AbstractViewer,\n\n  /*\n    ***********************************************\n      PROPERTIES\n    ***********************************************\n    */\n  properties: {\n    appearance: {\n      refine: true,\n      init: 'image-viewer'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    SUPPORTED_FILES: ['jpg', 'jpeg', 'png', 'gif', 'svg'],\n    TITLE: qx.locale.Manager.tr('Show image'),\n    ICON: cv.theme.dark.Images.getIcon('image', 18),\n\n    /**\n     * Returns size information for images\n     * @param source {String} path to image\n     * @returns {{width: *, aspectRatio: number, height: *}}\n     */\n    getImageData(source) {\n      let data = qx.util.ResourceManager.getInstance().getData(source);\n      if (data) {\n        return {\n          width: data[0],\n          height: data[1],\n          aspectRatio: data[0] / data[1]\n        };\n      }\n      data = qx.io.ImageLoader.getSize(source);\n      if (data && data.width && data.height) {\n        return Object.assign(\n          {\n            aspectRatio: data.width / data.height\n          },\n\n          data\n        );\n      }\n\n      return null;\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _applyFile(file) {\n      const control = this.getChildControl('image');\n      if (file) {\n        control.setIcon(file.getServerPath());\n        control.setLabel(file.getFullPath());\n        if (!cv.ui.manager.viewer.Image.getImageData(file.getServerPath())) {\n          control.getChildControl('icon').addListenerOnce('loaded', this._scaleImage, this);\n        } else {\n          this._scaleImage();\n        }\n        this.addListener('resize', this._scaleImage, this);\n      } else {\n        control.resetIcon();\n        control.resetLabel();\n        this.removeListener('resize', this._scaleImage, this);\n      }\n    },\n\n    _scaleImage() {\n      const bounds = this.getBounds();\n      if (!bounds) {\n        this.addListenerOnce('appear', this._scaleImage, this);\n        return;\n      }\n      const file = this.getFile();\n      if (!file) {\n        return;\n      }\n      const icon = this.getChildControl('image').getChildControl('icon');\n      const data = cv.ui.manager.viewer.Image.getImageData(file.getServerPath());\n\n      const paddingX = 10;\n      const paddingY = 20;\n      const availableHeight = bounds.height - paddingY * 2;\n      let width = bounds.width - paddingX * 2;\n      let height = Math.round((1 / data.aspectRatio) * width);\n      if (height > availableHeight) {\n        height = availableHeight;\n        width = Math.round(data.aspectRatio * availableHeight);\n      }\n      icon.set({\n        width: width,\n        height: height,\n        scale: true\n      });\n    }\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}