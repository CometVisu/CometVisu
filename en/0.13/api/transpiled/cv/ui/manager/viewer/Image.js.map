{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "manager",
    "viewer",
    "AbstractViewer",
    "properties",
    "appearance",
    "refine",
    "init",
    "statics",
    "SUPPORTED_FILES",
    "TITLE",
    "locale",
    "Manager",
    "tr",
    "ICON",
    "theme",
    "dark",
    "Images",
    "getIcon",
    "getImageData",
    "source",
    "data",
    "util",
    "ResourceManager",
    "getInstance",
    "getData",
    "width",
    "height",
    "aspectRatio",
    "io",
    "ImageLoader",
    "getSize",
    "Object",
    "assign",
    "members",
    "_applyFile",
    "file",
    "control",
    "getChildControl",
    "setIcon",
    "getServerPath",
    "setLabel",
    "getFullPath",
    "Image",
    "addListenerOnce",
    "_scaleImage",
    "addListener",
    "resetIcon",
    "resetLabel",
    "removeListener",
    "bounds",
    "getBounds",
    "getFile",
    "icon",
    "paddingX",
    "paddingY",
    "availableHeight",
    "Math",
    "round",
    "set",
    "scale"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/viewer/Image.js"
  ],
  "sourcesContent": [
    "/* Image.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n// noinspection JSClosureCompilerSyntax\n/**\n * Show images.\n */\nqx.Class.define('cv.ui.manager.viewer.Image', {\n  extend: cv.ui.manager.viewer.AbstractViewer,\n\n  /*\n    ***********************************************\n      PROPERTIES\n    ***********************************************\n    */\n  properties: {\n    appearance: {\n      refine: true,\n      init: 'image-viewer'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    SUPPORTED_FILES: ['jpg', 'jpeg', 'png', 'gif', 'svg'],\n    TITLE: qx.locale.Manager.tr('Show image'),\n    ICON: cv.theme.dark.Images.getIcon('image', 18),\n\n    /**\n     * Returns size information for images\n     * @param source {String} path to image\n     * @returns {{width: *, aspectRatio: number, height: *}}\n     */\n    getImageData(source) {\n      let data = qx.util.ResourceManager.getInstance().getData(source);\n      if (data) {\n        return {\n          width: data[0],\n          height: data[1],\n          aspectRatio: data[0] / data[1]\n        };\n      }\n      data = qx.io.ImageLoader.getSize(source);\n      if (data && data.width && data.height) {\n        return Object.assign(\n          {\n            aspectRatio: data.width / data.height\n          },\n\n          data\n        );\n      }\n\n      return null;\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _applyFile(file) {\n      const control = this.getChildControl('image');\n      if (file) {\n        control.setIcon(file.getServerPath());\n        control.setLabel(file.getFullPath());\n        if (!cv.ui.manager.viewer.Image.getImageData(file.getServerPath())) {\n          control.getChildControl('icon').addListenerOnce('loaded', this._scaleImage, this);\n        } else {\n          this._scaleImage();\n        }\n        this.addListener('resize', this._scaleImage, this);\n      } else {\n        control.resetIcon();\n        control.resetLabel();\n        this.removeListener('resize', this._scaleImage, this);\n      }\n    },\n\n    _scaleImage() {\n      const bounds = this.getBounds();\n      if (!bounds) {\n        this.addListenerOnce('appear', this._scaleImage, this);\n        return;\n      }\n      const file = this.getFile();\n      if (!file) {\n        return;\n      }\n      const icon = this.getChildControl('image').getChildControl('icon');\n      const data = cv.ui.manager.viewer.Image.getImageData(file.getServerPath());\n\n      const paddingX = 10;\n      const paddingY = 20;\n      const availableHeight = bounds.height - paddingY * 2;\n      let width = bounds.width - paddingX * 2;\n      let height = Math.round((1 / data.aspectRatio) * width);\n      if (height > availableHeight) {\n        height = availableHeight;\n        width = Math.round(data.aspectRatio * availableHeight);\n      }\n      icon.set({\n        width: width,\n        height: height,\n        scale: true\n      });\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}