{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "ui",
    "core",
    "Widget",
    "implement",
    "cv",
    "manager",
    "editor",
    "IEditor",
    "IActionHandler",
    "type",
    "construct",
    "constructor",
    "call",
    "_initClient",
    "_nativePasteSupported",
    "document",
    "queryCommandSupported",
    "properties",
    "file",
    "check",
    "nullable",
    "apply",
    "event",
    "content",
    "handlerOptions",
    "external",
    "init",
    "ready",
    "statics",
    "CLIPBOARD",
    "members",
    "_handledActions",
    "canHandleAction",
    "actionName",
    "getFile",
    "isWriteable",
    "includes",
    "handleAction",
    "save",
    "configureButton",
    "button",
    "unConfigureButton",
    "_client",
    "io",
    "rest",
    "Client",
    "getFsClient",
    "_applyHandlerOptions",
    "_loadFile",
    "old",
    "message",
    "Bus",
    "unsubscribe",
    "getBusTopic",
    "_onChange",
    "getType",
    "getContent",
    "setContent",
    "_loadFromFs",
    "subscribe",
    "resetContent",
    "readSync",
    "path",
    "getFullPath",
    "err",
    "res",
    "snackbar",
    "Controller",
    "error",
    "XMLDocument",
    "XMLSerializer",
    "serializeToString",
    "ev",
    "data",
    "getData",
    "source",
    "_applyContent",
    "getCurrentContent",
    "_handleSaveResponse",
    "tr",
    "info",
    "_onSaved",
    "dispatchByName",
    "callback",
    "overrideHash",
    "isModified",
    "isTemporary",
    "createSync",
    "hash",
    "getHash",
    "lang",
    "Function",
    "curry",
    "updateSync",
    "resetModified",
    "resetTemporary",
    "showErrors",
    "errorList",
    "showDecorations",
    "decorators",
    "destruct",
    "AbstractEditor"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/editor/AbstractEditor.js"
  ],
  "sourcesContent": [
    "/* AbstractEditor.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Abstract base class for all editors.\n */\nqx.Class.define('cv.ui.manager.editor.AbstractEditor', {\n  extend: qx.ui.core.Widget,\n  implement: [cv.ui.manager.editor.IEditor, cv.ui.manager.IActionHandler],\n\n  type: 'abstract',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super();\n    this._initClient();\n    this._nativePasteSupported = document.queryCommandSupported('paste');\n  },\n\n  /*\n  ***********************************************\n   PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    file: {\n      check: 'cv.ui.manager.model.FileItem || cv.ui.manager.model.CompareFiles',\n      nullable: true,\n      apply: '_loadFile',\n      event: 'changeFile'\n    },\n\n    content: {\n      nullable: true,\n      event: 'changeContent',\n      apply: '_applyContent'\n    },\n\n    handlerOptions: {\n      check: 'Map',\n      nullable: true,\n      apply: '_applyHandlerOptions'\n    },\n\n    /**\n     * External viewers just open the file in a new frame but to not show a new tab in the manager for the opened file\n     */\n    external: {\n      check: 'Boolean',\n      init: false\n    },\n\n    ready: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeReady'\n    }\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    // fake clipboard data when native clipboard is not supported\n    CLIPBOARD: null\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _handledActions: null,\n    _nativePasteSupported: false,\n\n    canHandleAction(actionName) {\n      if (actionName === 'save' && this.getFile() && !this.getFile().isWriteable()) {\n        return false;\n      }\n      return this._handledActions && this._handledActions.includes(actionName);\n    },\n\n    handleAction(actionName) {\n      if (this.canHandleAction(actionName)) {\n        switch (actionName) {\n          case 'save':\n            this.save();\n            break;\n        }\n      }\n    },\n\n    configureButton(button) {},\n    unConfigureButton(button) {},\n\n    _initClient() {\n      this._client = cv.io.rest.Client.getFsClient();\n    },\n\n    _applyHandlerOptions() {},\n\n    _loadFile(file, old) {\n      if (old) {\n        qx.event.message.Bus.unsubscribe(old.getBusTopic(), this._onChange, this);\n      }\n      if (file && file.getType() === 'file') {\n        if (file.getContent() !== null) {\n          this.setContent(file.getContent());\n        } else {\n          this._loadFromFs();\n        }\n        qx.event.message.Bus.subscribe(file.getBusTopic(), this._onChange, this);\n      } else {\n        this.resetContent();\n      }\n    },\n\n    _loadFromFs() {\n      this._client.readSync(\n        { path: this.getFile().getFullPath() },\n        function (err, res) {\n          if (err) {\n            cv.ui.manager.snackbar.Controller.error(err);\n          } else {\n            if (res instanceof XMLDocument) {\n              res = new XMLSerializer().serializeToString(res);\n            }\n            this.setContent(res);\n          }\n        },\n        this\n      );\n    },\n\n    _onChange(ev) {\n      const data = ev.getData();\n      if (data.type === 'fsContentChanged' && data.source !== this) {\n        this.setContent(data.data);\n      }\n    },\n\n    // must be overridden by inheriting classes\n    _applyContent() {},\n\n    // must be overridden by inheriting classes\n    getCurrentContent() {},\n\n    _handleSaveResponse(type, err) {\n      if (err) {\n        cv.ui.manager.snackbar.Controller.error(err);\n      } else {\n        const message = type === 'created' ? this.tr('File has been created') : this.tr('File has been saved');\n        cv.ui.manager.snackbar.Controller.info(message);\n        this._onSaved();\n        const file = this.getFile();\n        if (file) {\n          // file content loaded from FS is outdated now\n          file.resetContent();\n          qx.event.message.Bus.dispatchByName(file.getBusTopic(), {\n            type: type,\n            file: file,\n            data: this.getCurrentContent(),\n            source: this\n          });\n        }\n      }\n    },\n\n    save(callback, overrideHash) {\n      const file = this.getFile();\n      if (file.isModified()) {\n        if (file.isTemporary()) {\n          this._client.createSync(\n            {\n              path: file.getFullPath(),\n              hash: overrideHash || file.getHash(),\n              type: 'file'\n            },\n\n            this.getCurrentContent(),\n            callback || qx.lang.Function.curry(this._handleSaveResponse, 'created'),\n            this\n          );\n        } else {\n          this._client.updateSync(\n            {\n              path: file.getFullPath(),\n              hash: overrideHash || file.getHash()\n            },\n\n            this.getCurrentContent(),\n            callback || qx.lang.Function.curry(this._handleSaveResponse, 'contentChanged'),\n\n            this\n          );\n        }\n      }\n    },\n\n    _onSaved() {\n      const file = this.getFile();\n      if (file) {\n        file.resetModified();\n        file.resetTemporary();\n      }\n    },\n\n    showErrors(path, errorList) {},\n    showDecorations(path, decorators) {}\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    if (this._client) {\n      this._client = null;\n    }\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}