{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "construct",
    "_files",
    "_worker",
    "cv",
    "data",
    "FileWorker",
    "getInstance",
    "addListener",
    "_onMessage",
    "properties",
    "editor",
    "check",
    "nullable",
    "members",
    "open",
    "file",
    "code",
    "schema",
    "features",
    "postMessage",
    "path",
    "getFullPath",
    "xml",
    "Document",
    "isXmlDocument",
    "documentElement",
    "outerHTML",
    "close",
    "contentChanged",
    "content",
    "validateConfig",
    "isConfigFile",
    "getServerPath",
    "log",
    "Logger",
    "error",
    "validateXmlConfig",
    "e",
    "topic",
    "getData",
    "getEditor",
    "isTemporary",
    "setModified",
    "modified",
    "setHash",
    "currentHash",
    "setValid",
    "length",
    "showErrors",
    "showDecorations",
    "destruct",
    "terminate",
    "ui",
    "manager",
    "Worker"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/editor/Worker.js"
  ],
  "sourcesContent": [
    "/* Worker.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n *\n */\nqx.Class.define('cv.ui.manager.editor.Worker', {\n  extend: qx.core.Object,\n  type: 'singleton',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super();\n    this._files = {};\n    // create WebWorker\n    this._worker = cv.data.FileWorker.getInstance();\n    this._worker.addListener('message', this._onMessage, this);\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    editor: {\n      check: 'cv.ui.manager.editor.AbstractEditor',\n      nullable: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _worker: null,\n    _files: null,\n\n    open(file, code, schema, features) {\n      this._worker.postMessage([\n        'openFile',\n        {\n          path: file.getFullPath(),\n          code: qx.xml.Document.isXmlDocument(code) ? code.documentElement.outerHTML : code,\n          schema: schema\n        },\n\n        features\n      ]);\n\n      this._files[file.getFullPath()] = file;\n    },\n\n    close(file) {\n      this._worker.postMessage([\n        'closeFile',\n        {\n          path: file.getFullPath()\n        }\n      ]);\n\n      delete this._files[file.getFullPath()];\n    },\n\n    contentChanged(file, content) {\n      this._worker.postMessage([\n        'contentChange',\n        {\n          path: file.getFullPath(),\n          code: content\n        }\n      ]);\n    },\n\n    validateConfig(file) {\n      if (file.isConfigFile()) {\n        return this._worker.validateConfig(file.getServerPath());\n      }\n      qx.log.Logger.error(this, file.getFullPath() + ' is no configuration file');\n\n      return true;\n    },\n\n    validateXmlConfig(content) {\n      return this._worker.validateXmlConfig(content);\n    },\n\n    _onMessage(e) {\n      let topic = e.getData().topic;\n      let data = e.getData().data;\n      let path = e.getData().path;\n      let file = this._files[path];\n      if (!file && topic !== 'validationResult') {\n        qx.log.Logger.error(this, 'no file found for path ' + path + ' ignoring worker message for topic ' + topic);\n\n        return;\n      }\n      let editor = this.getEditor();\n      switch (topic) {\n        case 'modified':\n          // new files are always modified, to not override that state\n          if (!file.isTemporary()) {\n            file.setModified(data.modified);\n          }\n          file.setHash(data.currentHash);\n          break;\n\n        case 'hash':\n          file.setHash(data);\n          break;\n\n        case 'errors':\n          file.setValid(!data || data.length === 0);\n          if (editor) {\n            editor.showErrors(path, data);\n          }\n          break;\n\n        case 'decorations':\n          if (editor) {\n            editor.showDecorations(path, data);\n          }\n          break;\n      }\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    this._worker.terminate();\n    this._worker = null;\n  }\n});\n"
  ],
  "mappings": "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"
}