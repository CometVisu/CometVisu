{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/Main.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "include",
    "cv",
    "ui",
    "manager",
    "control",
    "MFileEventHandler",
    "implement",
    "IActionHandler",
    "IFileEventHandler",
    "construct",
    "iconfont",
    "material",
    "Load",
    "model",
    "BackupFolder",
    "getInstance",
    "_checkEnvironment",
    "initOpenFiles",
    "data",
    "Array",
    "__actionDispatcher",
    "ActionDispatcher",
    "setMain",
    "__initCommands",
    "_draw",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onManagerEvent",
    "tooltip",
    "Manager",
    "window",
    "addEventListener",
    "_onBeforeUnload",
    "statics",
    "ROOT",
    "properties",
    "openFiles",
    "check",
    "deferredInit",
    "writeableFolder",
    "init",
    "currentFolder",
    "nullable",
    "apply",
    "currentSelection",
    "deleteableSelection",
    "renameableSelection",
    "visible",
    "members",
    "__previewFileIndex",
    "__root",
    "_pane",
    "_tree",
    "_stack",
    "_oldCommandGroup",
    "_managerCommands",
    "_mainContent",
    "_openFilesController",
    "_hiddenConfigFakeFile",
    "_applyVisible",
    "value",
    "Init",
    "getApplication",
    "getCommandManager",
    "setActive",
    "bom",
    "element",
    "Style",
    "set",
    "__getRoot",
    "io",
    "rest",
    "Client",
    "getFsClient",
    "checkEnvironmentSync",
    "err",
    "res",
    "snackbar",
    "Controller",
    "error",
    "forEach",
    "env",
    "refreshActions",
    "entity",
    "state",
    "locale",
    "tr",
    "FileItem",
    "setReadable",
    "setWriteable",
    "widget",
    "getFocusedWidget",
    "resetFocusedWidget",
    "setFocusedWidget",
    "canHandleAction",
    "actionName",
    "getCurrentSelection",
    "isWriteable",
    "actions",
    "getCurrentFolder",
    "push",
    "includes",
    "_doClose",
    "document",
    "querySelector",
    "configLoader",
    "util",
    "ConfigLoader",
    "app",
    "load",
    "bootstrap",
    "setVisible",
    "handleAction",
    "unsavedFiles",
    "closeCurrentFile",
    "closeFile",
    "getOpenFiles",
    "filter",
    "openFile",
    "getFile",
    "isModified",
    "length",
    "dialog",
    "qxl",
    "Confirm",
    "callback",
    "confirmed",
    "save",
    "dispose",
    "context",
    "caption",
    "yesButtonLabel",
    "noButtonLabel",
    "useBlocker",
    "show",
    "_onCreate",
    "readSync",
    "path",
    "file",
    "getFullPath",
    "isConfigFile",
    "converter",
    "ConfigUpgrader",
    "convertPureToTile",
    "convertedContent",
    "suggestedName",
    "match",
    "exec",
    "getName",
    "_onDelete",
    "_showAbout",
    "warn",
    "ev",
    "preventDefault",
    "returnValue",
    "configureButton",
    "button",
    "unConfigureButton",
    "_handleFileEvent",
    "getData",
    "action",
    "copy",
    "some",
    "isRelated",
    "resetCurrentFolder",
    "refresh",
    "__findConfigFile",
    "name",
    "demoFolder",
    "getChildren",
    "child",
    "startsWith",
    "substr",
    "handler",
    "handlerOptions",
    "_onChangeTreeSelection",
    "Preferences",
    "isQuickPreview",
    "mode",
    "__openSelectedFile",
    "node",
    "getType",
    "setCurrentFolder",
    "getParent",
    "setCurrentSelection",
    "resetCurrentSelection",
    "setEditing",
    "_applyCurrentFolder",
    "old",
    "removeRelatedBindings",
    "bind",
    "resetWriteableFolder",
    "_applyCurrentSelection",
    "resetDeleteableSelection",
    "_onChangeFileSelection",
    "sel",
    "getSelection",
    "getItem",
    "editorConfig",
    "handlerId",
    "getHandlerId",
    "FileHandlerRegistry",
    "getFileHandlerById",
    "getFileHandler",
    "instance",
    "Clazz",
    "setFile",
    "indexOf",
    "add",
    "editor",
    "AbstractEditor",
    "setHandlerOptions",
    "getHandlerOptions",
    "setSelection",
    "GlobalState",
    "setOpenedFocusedFile",
    "resetOpenedFocusedFile",
    "preview",
    "handlerType",
    "handlerConf",
    "info",
    "classname",
    "isExternal",
    "isOpen",
    "of",
    "OpenFile",
    "resetHandlerOptions",
    "isPermanent",
    "setItem",
    "setPermanent",
    "getTarget",
    "setModelSelection",
    "checkUnsavedChanged",
    "found",
    "f",
    "isTemporary",
    "resetModified",
    "dispatchByName",
    "noButtonIcon",
    "allowCancel",
    "force",
    "isCloseable",
    "resetPermanent",
    "selectionIndex",
    "remove",
    "currentHandler",
    "hasInterface",
    "constructor",
    "IEditor",
    "Start",
    "resetFile",
    "resetSelection",
    "replace",
    "CompareFiles",
    "fileHandlerConf",
    "clear",
    "destroy",
    "monaco",
    "oldModel",
    "getModel",
    "getUri",
    "selected",
    "_onCloseFile",
    "dom",
    "Element",
    "create",
    "id",
    "style",
    "insertEnd",
    "body",
    "theme",
    "Meta",
    "setTheme",
    "Dark",
    "group",
    "command",
    "Group",
    "Command",
    "renameCommand",
    "getActive",
    "item",
    "FileController",
    "_onChangeStackSelection",
    "selection",
    "page",
    "toArray",
    "find",
    "__getFileNamePrompt",
    "prompt",
    "Prompt",
    "content",
    "folder",
    "existsMessage",
    "handlePrompt",
    "filename",
    "exists",
    "readable",
    "writeable",
    "loaded",
    "modified",
    "temporary",
    "parentFolder",
    "createSync",
    "getBusTopic",
    "source",
    "addChild",
    "sortElements",
    "__findDroppable",
    "elem",
    "nodeType",
    "getAttribute",
    "parentNode",
    "domRoot",
    "root",
    "Inline",
    "addListenerOnce",
    "getContentElement",
    "getDomElement",
    "target",
    "setRoot",
    "setLayout",
    "layout",
    "Canvas",
    "bottom",
    "left",
    "resize",
    "bounds",
    "getBounds",
    "setLayoutProperties",
    "Math",
    "round",
    "width",
    "setMaxHeight",
    "height",
    "addListener",
    "innerHeight",
    "main",
    "container",
    "Composite",
    "Dock",
    "edge",
    "menuBar",
    "MenuBar",
    "uploadButton",
    "getButton",
    "uploadManager",
    "upload",
    "UploadMgr",
    "splitpane",
    "Pane",
    "rootFolder",
    "fakeIconFile",
    "getIconFile",
    "overrideIcon",
    "open",
    "fakeChildren",
    "icon",
    "dark",
    "Images",
    "getIcon",
    "tree",
    "FileSystem",
    "leftContainer",
    "VBox",
    "leftBar",
    "ToolBar",
    "reload",
    "buttonConfig",
    "getButtonConfiguration",
    "args",
    "flex",
    "list",
    "form",
    "List",
    "setAppearance",
    "controller",
    "setDelegate",
    "createItem",
    "FileTabItem",
    "bindItem",
    "index",
    "bindDefaultProperties",
    "bindProperty",
    "Stack",
    "startOpenFile",
    "setCloseable",
    "dialogConf",
    "modal",
    "minWidth",
    "min",
    "Viewport",
    "getWidth",
    "maxHeight",
    "getHeight",
    "Version",
    "VERSION",
    "DATE",
    "REV",
    "LIBRARY_VERSION",
    "BigAlert",
    "destruct",
    "_disposeObjects",
    "application",
    "DeferredCall",
    "resetRoot",
    "schedule",
    "removeChild",
    "unsubscribe",
    "Main",
    "$$instance"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* Main.js \n * \n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * Main class of the CometVisu file manager.\n * @author Tobias Bräutigam\n * @since 0.12.0\n *\n * @asset(manager/*)\n */\nqx.Class.define('cv.ui.manager.Main', {\n  extend: qx.core.Object,\n  type: 'singleton',\n  include: [\n    cv.ui.manager.control.MFileEventHandler\n  ],\n  implement: [cv.ui.manager.IActionHandler, cv.ui.manager.control.IFileEventHandler],\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function () {\n    this.base(arguments);\n    iconfont.material.Load;\n    cv.ui.manager.model.BackupFolder.getInstance();\n    this._checkEnvironment();\n    this.initOpenFiles(new qx.data.Array());\n    this.__actionDispatcher = cv.ui.manager.control.ActionDispatcher.getInstance();\n    this.__actionDispatcher.setMain(this);\n\n    this.__initCommands();\n    this._draw();\n\n    qx.event.message.Bus.subscribe('cv.manager.*', this._onManagerEvent, this);\n\n    // Initialize tooltip manager\n    qx.ui.tooltip.Manager.getInstance();\n\n    //qx.event.Registration.addListener(window, 'beforeunload', this._onBeforeUnload, this);\n    window.addEventListener('beforeunload', event => {\n      this._onBeforeUnload(event);\n    });\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    ROOT: null\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    openFiles: {\n      check: 'qx.data.Array',\n      deferredInit: true\n    },\n\n    /**\n     * Current selected folder (if a file is selected its parent folder) is writeable.\n     */\n    writeableFolder: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeWriteableFolder'\n    },\n\n    currentFolder: {\n      check: 'cv.ui.manager.model.FileItem',\n      nullable: true,\n      apply: '_applyCurrentFolder',\n      event: 'changeCurrentFolder'\n    },\n\n    currentSelection: {\n      check: 'cv.ui.manager.model.FileItem',\n      nullable: true,\n      apply: '_applyCurrentSelection',\n      event: 'changeCurrentSelection'\n    },\n\n    deleteableSelection: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeDeleteableSelection'\n    },\n\n    renameableSelection: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeRenameableSelection'\n    },\n\n    visible: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeVisible',\n      apply: '_applyVisible'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __previewFileIndex: null,\n    __root: null,\n    _pane: null,\n    _tree: null,\n    _stack: null,\n    _oldCommandGroup: null,\n    _managerCommands: null,\n    _mainContent: null,\n    _openFilesController: null,\n    _hiddenConfigFakeFile: null,\n    __actionDispatcher: null,\n\n    _applyVisible: function (value) {\n      const manager = qx.core.Init.getApplication().getCommandManager();\n      if (value) {\n        manager.setActive(this._managerCommands);\n        qx.bom.element.Style.set(this.__getRoot(), 'display', 'block');\n      } else {\n        manager.setActive(this._oldCommandGroup);\n        qx.bom.element.Style.set(this.__getRoot(), 'display', 'none');\n      }\n    },\n\n    _checkEnvironment: function () {\n      cv.io.rest.Client.getFsClient().checkEnvironmentSync(function (err, res) {\n        if (err) {\n          cv.ui.manager.snackbar.Controller.error(err);\n        } else if (res) {\n          res.forEach(function (env) {\n            let refreshActions = false;\n            switch (env.entity) {\n              case '.':\n                // config folder must be writeable\n                if ((env.state & 1) === 0) {\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('config folder does not exists'));\n                } else if ((env.state & 2) === 0) {\n                  cv.ui.manager.model.FileItem.ROOT.setReadable(false);\n                  refreshActions = true;\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('config folder is not readable'));\n                } else if ((env.state & 4) === 0) {\n                  cv.ui.manager.model.FileItem.ROOT.setWriteable(false);\n                  refreshActions = true;\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('config folder is not writeable'));\n                }\n                if (refreshActions) {\n                  const widget = this.__actionDispatcher.getFocusedWidget();\n                  this.__actionDispatcher.resetFocusedWidget();\n                  this.__actionDispatcher.setFocusedWidget(widget);\n                }\n                break;\n\n              case 'backup':\n                if ((env.state & 4) === 0 && (env.state & 1) === 1) {\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('backup folder is not writeable'));\n                }\n                break;\n\n              case 'media':\n                if ((env.state & 4) === 0 && (env.state & 1) === 1) {\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('media folder is not writeable'));\n                }\n                break;\n\n              case 'hidden.php':\n                if ((env.state & 4) === 0 && (env.state & 1) === 1) {\n                  cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Hidden configuration file (hidden.php) not writeable'));\n                }\n                break;\n            }\n          }, this);\n        }\n      }, this);\n    },\n\n    canHandleAction: function (actionName) {\n      if (actionName === 'delete' && this.getCurrentSelection() && !this.getCurrentSelection().isWriteable()) {\n        // needs a writeable file\n        return false;\n      }\n      let actions = ['close', 'quit', 'about'];\n      const currentFolder = this.getCurrentFolder();\n      if (currentFolder.isWriteable()) {\n        actions.push('new-file');\n        actions.push('new-folder');\n        actions.push('delete');\n        actions.push('upload');\n        actions.push('clone');\n        actions.push('convertToTile');\n      }\n      if (cv.ui.manager.model.FileItem.ROOT.isWriteable()) {\n        actions.push('new-config-file');\n      }\n      return actions.includes(actionName);\n    },\n\n    _doClose() {\n      if (document.querySelector('#main.loading')) {\n        // there is no config file loaded, load the default one\n        let configLoader = new cv.util.ConfigLoader();\n        let app = qx.core.Init.getApplication();\n        configLoader.load(app.bootstrap, app);\n      }\n      this.setVisible(false);\n    },\n\n    handleAction: function (actionName, data) {\n      let unsavedFiles;\n      switch (actionName) {\n        case 'close':\n          if (!data) {\n            this.closeCurrentFile();\n          } else {\n            this.closeFile(data);\n          }\n          break;\n\n        case 'quit':\n          unsavedFiles = this.getOpenFiles().filter(openFile => openFile.getFile().isModified());\n\n          if (unsavedFiles.length > 0) {\n            const dialog = new qxl.dialog.Confirm({\n              message: qx.locale.Manager.tr('You have files opened with unsaved changes, you should save them now.'),\n              callback: function (confirmed) {\n                if (confirmed) {\n                  unsavedFiles.forEach(openFile => {\n                    openFile.save();\n                  });\n                }\n                dialog.dispose();\n                this._doClose();\n              },\n              context: this,\n              caption: qx.locale.Manager.tr('Unsaved changes'),\n              yesButtonLabel: qx.locale.Manager.tr('Save & quit'),\n              noButtonLabel: qx.locale.Manager.tr('Quit without saving'),\n              useBlocker: true\n            });\n            dialog.show();\n          } else {\n            this._doClose();\n          }\n          break;\n\n        case 'new-file':\n          this._onCreate('file', null, data);\n          break;\n\n        case 'new-config-file':\n          cv.io.rest.Client.getFsClient().readSync({path: 'demo/templates/visu_config.xml'}, function (err, res) {\n            if (err) {\n              cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Cannot load config template'));\n            } else {\n              this._onCreate('config', res, cv.ui.manager.model.FileItem.ROOT);\n            }\n          }, this);\n          break;\n\n        case 'clone':\n          cv.io.rest.Client.getFsClient().readSync({path: data.file.getFullPath()}, function (err, res) {\n            if (err) {\n              cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Cannot load file content'));\n            } else if (data.file.isConfigFile()) {\n                // config files need to be cloned in the root folder\n                this._onCreate('config', res, cv.ui.manager.model.FileItem.ROOT);\n              } else {\n                this._onCreate('file', res);\n              }\n          }, this);\n          break;\n\n        case 'convertToTile':\n          cv.io.rest.Client.getFsClient().readSync({path: data.file.getFullPath()}, function (err, res) {\n            if (err) {\n              cv.ui.manager.snackbar.Controller.error(qx.locale.Manager.tr('Cannot load file content'));\n            } else if (data.file.isConfigFile()) {\n              const converter = new cv.util.ConfigUpgrader();\n              const [err, convertedContent] = converter.convertPureToTile(res);\n              if (err) {\n                cv.ui.manager.snackbar.Controller.error(err);\n              } else {\n                let suggestedName = 'tile';\n                const match = /visu[_-]config[_-]([\\w\\d_-]+)(\\.xml)?/.exec(data.file.getName());\n                if (match) {\n                  suggestedName = 'tile-' + match[1];\n                }\n                // config files need to be cloned in the root folder\n                this._onCreate('config', convertedContent, cv.ui.manager.model.FileItem.ROOT, 'cv.ui.manager.editor.Source', suggestedName);\n              }\n            }\n          }, this);\n          break;\n\n        case 'new-folder':\n          this._onCreate('dir', null, data);\n          break;\n\n        case 'delete':\n          this._onDelete(data);\n          break;\n\n        case 'upload':\n          // nothing to to, this is handled in another way\n          break;\n\n        case 'about':\n          this._showAbout();\n          break;\n\n        default:\n          this.warn(actionName + ' handling is not implemented yet!');\n          break;\n      }\n    },\n\n    _onBeforeUnload: function (ev) {\n      const unsavedFiles = this.getOpenFiles().filter(openFile => openFile.getFile().isModified());\n      if (unsavedFiles.length > 0) {\n        ev.preventDefault();\n        ev.returnValue = '';\n      } else {\n        delete ev['returnValue'];\n      }\n    },\n\n    configureButton: function (button) {},\n    unConfigureButton: function (button) {},\n\n    _handleFileEvent: function (ev) {\n      const data = ev.getData();\n      if (data.action === 'deleted') {\n        // check if file is currently opened and close it\n        const openFiles = this.getOpenFiles().copy();\n        openFiles.some(function (openFile) {\n          if (openFile.getFile().isRelated(data.path)) {\n            this.closeFile(openFile);\n          }\n          return false;\n        }, this);\n        if (this.getCurrentFolder() && this.getCurrentFolder().getFullPath() === data.path) {\n          this.resetCurrentFolder();\n        }\n      } else {\n        this.warn('unhandled file event', data.action);\n      }\n      this._tree.refresh();\n    },\n\n    __findConfigFile: function (name) {\n      let file = null;\n      let demoFolder = null;\n      cv.ui.manager.model.FileItem.ROOT.getChildren().some(child => {\n        if (child.getName() === 'demo') {\n          demoFolder = child;\n        } else if (child.getName() === name) {\n          file = child;\n          return true;\n        }\n        return false;\n      });\n      if (!file && demoFolder) {\n        if (name.startsWith('demo/')) {\n          name = name.substr(5);\n        }\n        // check demo configs\n        demoFolder.getChildren().some(child => {\n          if (child.getName() === name) {\n            file = child;\n            return true;\n          }\n          return false;\n        });\n      }\n      return file;\n    },\n\n    _onManagerEvent: function (ev) {\n      let data = ev.getData();\n      switch (ev.getName()) {\n        case 'cv.manager.compareFiles':\n          this.openFile(data, false);\n          break;\n\n        case 'cv.manager.openWith':\n          if (typeof data.file === 'string') {\n            // this can only by a file in the root dir (a config)\n            data.file = this.__findConfigFile(data.file);\n          }\n          this.openFile(data.file || this.getCurrentSelection(), false, data.handler, null, data.handlerOptions);\n          break;\n\n        case 'cv.manager.open':\n          if (typeof data === 'string') {\n            // this can only by a file in the root dir (a config)\n            data = this.__findConfigFile(data);\n          }\n          this.openFile(data || this.getCurrentSelection(), false);\n          break;\n      }\n    },\n\n    /**\n     * open selected file in preview mode\n     * @param ev\n     * @private\n     */\n    _onChangeTreeSelection: function (ev) {\n      const data = ev.getData();\n      if ((cv.ui.manager.model.Preferences.getInstance().isQuickPreview() && data.mode === 'tap') || data.mode === 'dbltap') {\n        this.__openSelectedFile(data.node, data.mode);\n      }\n      const node = data.node;\n      if (node) {\n        if (data.node.getType() === 'file') {\n          this.setCurrentFolder(data.node.getParent());\n        } else {\n          this.setCurrentFolder(node);\n        }\n        this.setCurrentSelection(node);\n      } else {\n        this.resetCurrentFolder();\n        this.resetCurrentSelection();\n      }\n    },\n\n    __openSelectedFile: function (node, mode) {\n      if (node) {\n        if (node.getType() === 'file') {\n          this.openFile(node, mode === 'tap');\n        } else if (mode === 'dbltap') {\n          // edit folder name on dbltap\n          node.setEditing(true);\n        }\n      }\n    },\n\n    _applyCurrentFolder: function (value, old) {\n      if (old) {\n        old.removeRelatedBindings(this);\n      }\n      if (value) {\n        value.bind('writeable', this, 'writeableFolder');\n      } else {\n        this.resetWriteableFolder();\n      }\n    },\n\n    _applyCurrentSelection: function (value, old) {\n      if (old) {\n        old.removeRelatedBindings(this);\n      }\n      if (value) {\n        value.bind('writeable', this, 'deleteableSelection');\n        value.bind('inTrash', this, 'renameableSelection', {\n          converter: function (value) {\n            return !value;\n          }\n        });\n      } else {\n        this.resetDeleteableSelection();\n      }\n    },\n\n    _onChangeFileSelection: function () {\n      const sel = this._openFilesController.getSelection();\n      if (sel.length > 0) {\n        const openFile = sel.getItem(0);\n        const file = openFile.getFile();\n        let editorConfig;\n        const handlerId = openFile.getHandlerId();\n        if (handlerId) {\n          editorConfig = cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(handlerId);\n        } else {\n          editorConfig = cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(file);\n        }\n        if (!editorConfig.instance) {\n          editorConfig.instance = new editorConfig.Clazz();\n        }\n        editorConfig.instance.setFile(file);\n        if (this._stack.indexOf(editorConfig.instance) < 0) {\n          this._stack.add(editorConfig.instance);\n        }\n        if (editorConfig.instance instanceof cv.ui.manager.editor.AbstractEditor) {\n          editorConfig.instance.setHandlerOptions(openFile.getHandlerOptions());\n        }\n        this._stack.setSelection([editorConfig.instance]);\n        this.__actionDispatcher.setFocusedWidget(editorConfig.instance);\n\n        cv.ui.manager.core.GlobalState.getInstance().setOpenedFocusedFile(file);\n      } else {\n        cv.ui.manager.core.GlobalState.getInstance().resetOpenedFocusedFile();\n      }\n    },\n\n    /**\n     * @param file {cv.ui.manager.model.FileItem} the file to open\n     * @param preview {Boolean} open the file in preview mode\n     * @param handlerId {String} use this handler to open the file (classname as string)\n     * @param handlerType {String} use a special handler type, e.g. 'edit' if you want to open the file with an editor and not a viewer\n     * @param handlerOptions\n     */\n    openFile: function (file, preview, handlerId, handlerType, handlerOptions) {\n      const openFiles = this.getOpenFiles();\n      let openFile;\n      let handlerConf;\n      if (!handlerId) {\n        handlerConf = cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(file, handlerType);\n\n        if (!handlerConf) {\n          // no handler\n          cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr('Cannot open file: \"%1\"', file.getName()));\n          return;\n        } \n          handlerId = handlerConf.Clazz.classname;\n      } else {\n        // check if this handler opens the file in a external frame that is not connected to the manager\n        handlerConf = cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandlerById(handlerId);\n        if (!handlerConf.instance) {\n          handlerConf.instance = new handlerConf.Clazz();\n        }\n        if (handlerConf.instance.isExternal()) {\n          handlerConf.instance.setFile(file);\n          return;\n        }\n      }\n      const isOpen = openFiles.some(function (of) {\n        if (of.getFile() === file && handlerId === of.getHandlerId()) {\n          openFile = of;\n          return true;\n        }\n        return false;\n      });\n      if (!openFile) {\n        openFile = new cv.ui.manager.model.OpenFile(file, handlerId);\n      }\n      if (handlerOptions) {\n        openFile.setHandlerOptions(handlerOptions);\n      } else {\n        openFile.resetHandlerOptions();\n      }\n      if (preview === true) {\n        if (!openFile.isPermanent()) {\n          if (this.__previewFileIndex !== null && openFiles.getItem(this.__previewFileIndex) && !openFiles.getItem(this.__previewFileIndex).isPermanent()) {\n            openFiles.setItem(this.__previewFileIndex, openFile);\n          } else {\n            this.__previewFileIndex = openFiles.length;\n            openFiles.push(openFile);\n          }\n          // do not 'downgrade' the permanent state\n          openFile.setPermanent(false);\n        }\n      } else {\n        if (!isOpen && (this.__previewFileIndex === null || openFiles.indexOf(openFile) !== this.__previewFileIndex)) {\n          openFiles.push(openFile);\n        }\n        openFile.setPermanent(true);\n        this.__previewFileIndex = null;\n      }\n      this._openFilesController.getTarget().setModelSelection([openFile]);\n    },\n\n    /**\n     * Opens a confirm dialog on how to treat the unsaved changes in the file if it has been modified and not saved.\n     * @param openFile {cv.ui.manager.model.OpenFile|cv.ui.manager.model.FileItem} file to check\n     * @return {boolean} true if the confirm dialog has been shown\n     */\n    checkUnsavedChanged: function (openFile) {\n      if (openFile instanceof cv.ui.manager.model.FileItem) {\n        // find the opened file\n        const found = this.getOpenFiles().some(function (f) {\n          if (f.getFile().getFullPath() === openFile.getFullPath()) {\n            openFile = f;\n            return true;\n          }\n          return false;\n        });\n        if (!found) {\n          return false;\n        }\n      }\n      const file = openFile.getFile();\n      if (file.isModified()) {\n        // check if temporary\n        let message = qx.locale.Manager.tr('This file has unsaved changes that will be lost when you close it without saving.');\n        if (file.isTemporary()) {\n          message = qx.locale.Manager.tr('This file has not been saved on the backend yet. It will be lost when you close it without saving.');\n        }\n        const dialog = new qxl.dialog.Confirm({\n          message: message,\n          callback: confirmed => {\n            if (confirmed === true) {\n              openFile.save();\n              this.closeFile(openFile, true);\n            } else if (confirmed === false) {\n              file.resetModified();\n              if (file.isTemporary()) {\n                qx.event.message.Bus.dispatchByName('cv.manager.file', {\n                  action: 'deleted',\n                  path: file.getFullPath()\n                });\n              }\n              this.closeFile(openFile, true);\n            } else {\n              // cancel closing, do nothing\n            }\n            dialog.dispose();\n          },\n          context: this,\n          caption: qx.locale.Manager.tr('Unsaved changes'),\n          yesButtonLabel: qx.locale.Manager.tr('Save & close'),\n          noButtonLabel: qx.locale.Manager.tr('Discard & close'),\n          noButtonIcon: 'qxl.dialog.icon.delete',\n          useBlocker: true,\n          allowCancel: true\n        });\n        dialog.show();\n        return true;\n      }\n      return false;\n    },\n\n    closeFile: function (openFile, force) {\n      if (openFile instanceof cv.ui.manager.model.FileItem) {\n        // find the opened file\n        const found = this.getOpenFiles().some(function (f) {\n          if (f.getFile().getFullPath() === openFile.getFullPath()) {\n            openFile = f;\n            return true;\n          }\n          return false;\n        });\n        if (!found) {\n          return;\n        }\n      }\n      if (!openFile || !openFile.isCloseable()) {\n        return;\n      }\n      const file = openFile.getFile();\n\n      // check if this file is modified\n      if (!force && this.checkUnsavedChanged(openFile)) {\n        return;\n      }\n      if (openFile instanceof cv.ui.manager.model.OpenFile) {\n        openFile.resetPermanent();\n      }\n      const currentSelection = this._openFilesController.getSelection();\n      let selectionIndex = -1;\n      const openFiles = this.getOpenFiles();\n      if (currentSelection.length > 0 && currentSelection.getItem(0) === openFile) {\n        // we need to select another file after this one got closed\n        selectionIndex = openFiles.indexOf(openFile);\n      }\n      openFiles.remove(openFile);\n      const currentHandler = this._stack.getSelection()[0];\n      if (qx.Class.hasInterface(currentHandler.constructor, cv.ui.manager.editor.IEditor) && !(currentHandler instanceof cv.ui.manager.Start)) {\n        // reset the handlers file\n        currentHandler.resetFile();\n      }\n      if (this.getOpenFiles().length === 0) {\n        this._stack.resetSelection();\n        this.__actionDispatcher.resetFocusedWidget();\n        this.__previewFileIndex = null;\n      }\n      if (selectionIndex > 0) {\n        this._openFilesController.getSelection().replace(openFiles.getItem(selectionIndex - 1));\n      } else if (selectionIndex === 0 && openFiles.length > 0) {\n        this._openFilesController.getSelection().replace(openFiles.getItem(0));\n      }\n\n      if (file instanceof cv.ui.manager.model.CompareFiles) {\n        const fileHandlerConf = cv.ui.manager.control.FileHandlerRegistry.getInstance().getFileHandler(file);\n        fileHandlerConf.instance.clear();\n        if (openFiles.filter(function (openFile) {\n          return openFile.getFile() instanceof cv.ui.manager.model.CompareFiles;\n        }).length === 0) {\n          fileHandlerConf.instance.destroy();\n          fileHandlerConf.instance = null;\n        }\n      } else if (window.monaco && openFile.getHandlerId() === 'cv.ui.manager.editor.Source') {\n        // close textmodel in monaco editor if exists\n        const oldModel = window.monaco.editor.getModel(file.getUri());\n        if (oldModel) {\n          oldModel.dispose();\n        }\n      }\n    },\n\n    closeCurrentFile: function () {\n      const selected = this._openFilesController.getSelection().length > 0 ? this._openFilesController.getSelection().getItem(0) : null;\n      if (selected) {\n        this.closeFile(selected);\n      }\n    },\n\n    _onCloseFile: function (ev) {\n      this.closeFile(ev.getData());\n    },\n\n    __getRoot: function () {\n      if (!this.__root) {\n        this.__root = qx.dom.Element.create('div', {\n          id: 'manager',\n          style: 'position: absolute; top: 0; left: 0; right: 0; bottom: 0;'\n        });\n        qx.dom.Element.insertEnd(this.__root, document.body);\n        qx.theme.manager.Meta.getInstance().setTheme(cv.theme.Dark);\n      }\n      return this.__root;\n    },\n\n    __initCommands: function () {\n      const group = this._managerCommands = new qx.ui.command.Group();\n      group.add('save', new qx.ui.command.Command('Ctrl+S'));\n      group.add('save-as', new qx.ui.command.Command('Ctrl+Shift+S'));\n      // this command will close the browser window, thats not what we want\n      // group.add('close', new qx.ui.command.Command('Ctrl+W'));\n      group.add('new-file', new qx.ui.command.Command('Ctrl+N'));\n      group.add('new-folder', new qx.ui.command.Command('Ctrl+Shift+N'));\n      group.add('quit', new qx.ui.command.Command('Ctrl+Q'));\n      // group.add('delete', new qx.ui.command.Command('Ctrl+Del'));\n\n      const renameCommand = new qx.ui.command.Command('F2');\n      group.add('rename', renameCommand);\n      this.bind('renameableSelection', renameCommand, 'enabled');\n\n      group.add('undo', new qx.ui.command.Command('Ctrl+Z'));\n      group.add('redo', new qx.ui.command.Command('Ctrl+Y'));\n\n      // edit commands (adding cut/copy/paste command will deactivate the native browser functions)\n      // and as we cannot simulate pasting from clipboard, we do not use them here\n      group.add('cut', new qx.ui.command.Command('Ctrl+X'));\n      group.add('copy', new qx.ui.command.Command('Ctrl+C'));\n      group.add('paste', new qx.ui.command.Command('Ctrl+V'));\n\n      group.add('help', new qx.ui.command.Command('F1'));\n\n      const manager = qx.core.Init.getApplication().getCommandManager();\n      this._oldCommandGroup = manager.getActive();\n      manager.add(group);\n      manager.setActive(group);\n    },\n\n    _onDelete: function (file) {\n      const item = file || this.getCurrentSelection();\n      if (item) {\n        cv.ui.manager.control.FileController.getInstance().delete(item);\n      }\n    },\n\n    _onChangeStackSelection: function (ev) {\n      const selection = ev.getData();\n      const openFiles = [];\n      // sync tab selection with currently visible page\n      selection.forEach(function(page) {\n        const openFile = this.getOpenFiles().toArray().find(function (openFile) {\n          return openFile.getFile() === page.getFile() && openFile.getHandlerId() === page.classname;\n        });\n        if (openFile) {\n          openFiles.push(openFile);\n        }\n      }, this);\n\n      this._openFilesController.getSelection().replace(openFiles);\n    },\n\n    __getFileNamePrompt: function (message, callback, context, value, caption) {\n      const prompt = new cv.ui.manager.dialog.Prompt({\n        message: message,\n        callback: callback || null,\n        context: context || null,\n        value: value || null,\n        caption: caption || '',\n        filter: /[\\w\\d_\\-\\.\\s]/\n      });\n      prompt.show();\n      return prompt;\n    },\n\n    _onCreate: function (type, content, folder, handlerId, suggestedName) {\n      const currentFolder = folder || this.getCurrentFolder();\n      if (!currentFolder) {\n        return;\n      }\n      let message;\n      let existsMessage;\n      if (type === 'config') {\n        message = qx.locale.Manager.tr('Please enter the name of the new configuration (without \"visu_config_\" at the beginning and \".xml\" at the end)');\n        existsMessage = qx.locale.Manager.tr('A configuration with this name already exists.');\n      } else if (type === 'file') {\n        message = qx.locale.Manager.tr('Please enter the file name.');\n        existsMessage = qx.locale.Manager.tr('A file with this name already exists.');\n      } else {\n        message = qx.locale.Manager.tr('Please enter the folder name.');\n        existsMessage = qx.locale.Manager.tr('A folder with this name already exists.');\n      }\n      const handlePrompt = function (name) {\n        if (!name) {\n          // canceled\n          return;\n        }\n        let filename = name;\n        // add visu_config_..-xml\n        if (type === 'config') {\n          const match = /visu[_-]config[_-]([\\w\\d_-]+)(\\.xml)?/.exec(name);\n          if (match) {\n            name = match[1];\n          }\n          filename = 'visu_config_' + name + '.xml';\n        }\n        // check if name does not exist\n        const exists = currentFolder.getChildren().some(function (child) {\n          return (child.getName() === filename && child.getType() === type);\n        }, this);\n\n        if (exists) {\n          cv.ui.manager.snackbar.Controller.error(existsMessage);\n          this.__getFileNamePrompt(message, handlePrompt, this, name);\n        } else {\n          const item = new cv.ui.manager.model.FileItem(filename, currentFolder.getFullPath(), currentFolder);\n          item.set({\n            type: type === 'config' ? 'file' : type,\n            readable: true,\n            writeable: true,\n            loaded: true,\n            modified: true,\n            temporary: true,\n            parentFolder: currentFolder.getFullPath(),\n            content: content || ''\n          });\n          if (type === 'dir') {\n            // create directory directly\n            cv.io.rest.Client.getFsClient().createSync({\n              path: item.getFullPath(),\n              type: type\n            }, null, function (err) {\n              if (err) {\n                cv.ui.manager.snackbar.Controller.error(err);\n              } else {\n                cv.ui.manager.snackbar.Controller.info(qx.locale.Manager.tr('Folder has been created'));\n                item.set({\n                  modified: false,\n                  temporary: false\n                });\n                qx.event.message.Bus.dispatchByName(item.getBusTopic(), {\n                  type: 'created',\n                  file: item,\n                  data: '',\n                  source: this\n                });\n              }\n            }, this);\n          }\n          currentFolder.addChild(item);\n          currentFolder.sortElements();\n          this._tree.refresh();\n          this._tree.setSelection(item);\n          // do not open new folders\n          if (type !== 'dir') {\n            // open the file in an editor\n            this.openFile(item, false, handlerId, 'edit');\n          }\n        }\n      };\n\n      this.__getFileNamePrompt(message, handlePrompt, this, suggestedName);\n    },\n\n    /**\n     * Finds next droppable parent of the given element. Maybe the element itself as well.\n     *\n     * Looks for the attribute <code>qxDroppable</code> with the value <code>on</code>.\n     *\n     * @param elem {Element} The element to query\n     * @return {Element} The next parent element which is droppable. May also be <code>null</code>\n     */\n    __findDroppable : function (elem) {\n      while (elem && elem.nodeType === 1) {\n        if (elem.getAttribute('qxDroppable') === 'on') {\n          return elem;\n        }\n\n        elem = elem.parentNode;\n      }\n\n      return null;\n    },\n\n    // overridden\n    _draw: function () {\n      const domRoot = this.__getRoot();\n      const root = new qx.ui.root.Inline(domRoot, true, true);\n      this.bind('visible', root, 'visibility', {\n        converter: function (visible) {\n          return visible ? 'visible' : 'excluded';\n        }\n      });\n      root.addListenerOnce('appear', function () {\n        // disable file drop\n        const element = root.getContentElement().getDomElement();\n        element.addEventListener('drop', function (ev) {\n          const target = this.__findDroppable(ev.target);\n          if (!target) {\n            ev.preventDefault();\n          }\n        }.bind(this));\n        element.addEventListener('dragover', function (ev) {\n          const target = this.__findDroppable(ev.target);\n          if (!target) {\n            ev.preventDefault();\n          }\n        }.bind(this));\n      }, this);\n      qx.core.Init.getApplication().setRoot(root);\n      root.setLayout(new qx.ui.layout.Canvas());\n\n      const snackbar = cv.ui.manager.snackbar.Controller.getInstance();\n      root.add(snackbar, {\n        bottom: 10,\n        left: 200\n      });\n\n      /**\n       *\n       */\n      function resize() {\n        const bounds = root.getBounds();\n        snackbar.setLayoutProperties({\n          bottom: 10,\n          left: Math.round(bounds.width / 2) - 150\n        });\n        snackbar.setMaxHeight(bounds.height - 40);\n      }\n      root.addListener('resize', resize, this);\n      root.addListener('appear', resize, this);\n      window.addEventListener('resize', function () {\n        // sync window height with manager height\n        domRoot.style.height = window.innerHeight + 'px';\n      });\n\n      const main = new qx.ui.container.Composite(new qx.ui.layout.Dock());\n      root.add(main, {edge: 0});\n      // menu on top\n      const menuBar = cv.ui.manager.MenuBar.getInstance();\n      main.add(menuBar, {edge: 'north'});\n\n      const uploadButton = menuBar.getButton('upload');\n      const uploadManager = new cv.ui.manager.upload.UploadMgr(uploadButton);\n      this.bind('currentFolder', uploadManager, 'folder');\n\n      this._pane = new qx.ui.splitpane.Pane();\n      main.add(this._pane, {edge: 'center'});\n\n      const rootFolder = cv.ui.manager.model.FileItem.ROOT = new cv.ui.manager.model.FileItem('.');\n      const fakeIconFile = cv.ui.manager.model.FileItem.getIconFile();\n      // TODO: needs to be verified by the backend\n      rootFolder.set({\n        overrideIcon: true,\n        writeable: true,\n        readable: true,\n        open: true,\n        fakeChildren: [fakeIconFile],\n        icon: cv.theme.dark.Images.getIcon('home', 18)\n      });\n      this.setCurrentFolder(rootFolder);\n      this._tree = new cv.ui.manager.tree.FileSystem(rootFolder);\n      this._tree.addListener('changeSelection', this._onChangeTreeSelection, this);\n\n      // left container\n      const leftContainer = new qx.ui.container.Composite(new qx.ui.layout.VBox());\n\n      // left toolbar\n      const leftBar = new cv.ui.manager.ToolBar(uploadManager);\n      this.bind('currentFolder', leftBar, 'folder');\n      this.bind('currentSelection', leftBar, 'file');\n      leftBar.addListener('reload', this._tree.reload, this._tree);\n\n      // globally bind writeable folder to command for new files\n      const buttonConfig = menuBar.getButtonConfiguration();\n      this.bind('writeableFolder', buttonConfig['new-file'].args[2], 'enabled');\n      this.bind('writeableFolder', buttonConfig['new-folder'].args[2], 'enabled');\n      // this.bind('deleteableSelection', buttonConfig['delete'].args[2], 'enabled');\n\n      leftContainer.add(leftBar);\n      leftContainer.add(this._tree, {flex: 1});\n      this._pane.add(leftContainer, 0);\n      cv.ui.manager.model.Preferences.getInstance().bind('expertMode', leftContainer, 'visibility', {\n        converter: function (value) {\n          return value ? 'visible' : 'excluded';\n        }\n      });\n\n      this._mainContent = new qx.ui.container.Composite(new qx.ui.layout.VBox());\n\n      // tab list\n      const list = new qx.ui.form.List(true);\n      list.setAppearance('open-files-tabs');\n      this._openFilesController = new qx.data.controller.List(this.getOpenFiles(), list, 'file.name');\n      this._openFilesController.setDelegate({\n        createItem: function () {\n          const item = new cv.ui.manager.form.FileTabItem();\n          item.addListener('close', this._onCloseFile, this);\n          return item;\n        }.bind(this),\n\n        bindItem: function (controller, item, index) {\n          controller.bindDefaultProperties(item, index);\n          controller.bindProperty('file.permanent', 'permanent', null, item, index);\n          controller.bindProperty('file.modified', 'modified', null, item, index);\n          controller.bindProperty('icon', 'icon', null, item, index);\n          controller.bindProperty('closeable', 'closeable', null, item, index);\n        }\n      });\n      list.addListener('changeSelection', this._onChangeFileSelection, this);\n      this._mainContent.add(list);\n\n      this._stack = new qx.ui.container.Stack();\n      this._stack.addListener('changeSelection', this._onChangeStackSelection, this);\n      this._mainContent.add(this._stack, {flex: 1});\n      this._pane.add(this._mainContent, 1);\n\n      const startOpenFile = new cv.ui.manager.model.OpenFile(rootFolder, 'cv.ui.manager.Start');\n      startOpenFile.setCloseable(false);\n      this.getOpenFiles().push(startOpenFile);\n      list.setModelSelection([startOpenFile]);\n    },\n\n    _showAbout: function () {\n      const dialogConf = {\n        caption: qx.locale.Manager.tr('About'),\n        modal: true,\n        minWidth: Math.min(500, qx.bom.Viewport.getWidth()),\n        maxHeight: qx.bom.Viewport.getHeight(),\n        message: `\n<div class=\"about-cv\">\n <img src=\"resource/icons/comet_icon_128x128_ff8000.png\" width=\"128\" height=\"128\"/>\n <h2>CometVisu ${cv.Version.VERSION}</h2>\n <div class=\"info\">\n   <label for=\"date\">${qx.locale.Manager.tr('Build date')}: </label><span id=\"date\">${cv.Version.DATE}</span><br/>\n   <label for=\"build\">${qx.locale.Manager.tr('Build revision')}: </label><span id=\"build\">${cv.Version.REV}</span><br/>\n   <label for=\"lib-version\">${qx.locale.Manager.tr('Library version')}: </label><span id=\"lib-version\">${cv.Version.LIBRARY_VERSION}</span>\n </div>\n</div>`};\n      new cv.ui.manager.dialog.BigAlert(dialogConf).show();\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._disposeObjects(\n      '_pane', '_tree', '_stack', '_mainContent', '_openFilesController'\n    );\n    // restore former command group\n    const application = qx.core.Init.getApplication();\n    const manager = application.getCommandManager();\n    manager.setActive(this._oldCommandGroup);\n    this._oldCommandGroup = null;\n\n    // defer the reset to let the dispose queue to be emptied before removing the root\n    new qx.util.DeferredCall(function () {\n      application.resetRoot();\n    }).schedule();\n\n    document.body.removeChild(this.__root);\n    this.__root = null;\n    this.__actionDispatcher = null;\n\n    qx.event.message.Bus.unsubscribe('cv.manager.*', this._onManagerEvent, this);\n\n    // destroy the singleton instance\n    delete cv.ui.manager.Main.$$instance;\n  }\n});\n"
  ]
}