{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "qxl",
    "dialog",
    "Dialog",
    "construct",
    "file",
    "content",
    "errors",
    "properties",
    "_file",
    "_content",
    "split",
    "_errors",
    "Object",
    "assign",
    "useBlocker",
    "addListener",
    "window",
    "monaco",
    "cv",
    "ui",
    "manager",
    "editor",
    "Source",
    "load",
    "highlight",
    "events",
    "action",
    "members",
    "_rootListenerId",
    "Array",
    "from",
    "document",
    "querySelectorAll",
    "forEach",
    "elem",
    "colorizeElement",
    "theme",
    "_createWidgetContent",
    "container",
    "_createDialogContainer",
    "vbox",
    "Composite",
    "layout",
    "VBox",
    "add",
    "prologue",
    "tr",
    "getFullPath",
    "options",
    "labelOptions",
    "rich",
    "width",
    "Math",
    "min",
    "bom",
    "Viewport",
    "getWidth",
    "allowGrowX",
    "message",
    "basic",
    "Label",
    "set",
    "errorBox",
    "errorScroll",
    "Scroll",
    "padding",
    "decorator",
    "setMinHeight",
    "setHeight",
    "Document",
    "getHeight",
    "core",
    "Init",
    "getApplication",
    "getRoot",
    "flex",
    "errorLabels",
    "Map",
    "error",
    "errorId",
    "line",
    "element",
    "attribute",
    "label",
    "has",
    "codeSnippet",
    "startIndex",
    "max",
    "endIndex",
    "length",
    "minIndent",
    "Number",
    "POSITIVE_INFINITY",
    "i",
    "indent",
    "search",
    "push",
    "trimRight",
    "map",
    "xml",
    "String",
    "escape",
    "substr",
    "headline",
    "join",
    "get",
    "startsWith",
    "setValue",
    "getValue",
    "option",
    "buttonPane",
    "_createButtonPane",
    "closeButton",
    "form",
    "Button",
    "fireDataEvent",
    "proceedButton",
    "openSourceButton",
    "destruct",
    "removeListenerById",
    "ValidationError"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/dialog/ValidationError.js"
  ],
  "sourcesContent": [
    "/* ValidationError.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Show validation errors for a config file.\n */\nqx.Class.define('cv.ui.manager.dialog.ValidationError', {\n  extend: qxl.dialog.Dialog,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  /**\n   *\n   * @param file {cv.ui.manager.model.FileItem}\n   * @param content {String}\n   * @param errors {Array<Map>}\n   * @param properties {Map?}\n   */\n  construct(file, content, errors, properties) {\n    this._file = file;\n    this._content = content.split('\\n');\n    this._errors = errors;\n    super(\n      Object.assign(properties || {}, {\n        useBlocker: true\n      })\n    );\n\n    this.addListener('appear', () => {\n      if (!window.monaco) {\n        cv.ui.manager.editor.Source.load(this.highlight, this);\n      } else {\n        this.highlight();\n      }\n    });\n  },\n\n  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n    action: 'qx.event.type.Data'\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _content: null,\n    _errors: null,\n    _rootListenerId: null,\n\n    /**\n     * @var {cv.ui.manager.model.FileItem}\n     */\n    _file: null,\n\n    highlight() {\n      Array.from(document.querySelectorAll('pre.highlight')).forEach(elem => {\n        monaco.editor.colorizeElement(elem, {\n          theme: 'vs-dark'\n        });\n      });\n    },\n\n    /**\n     * Create the main content of the widget\n     */\n    _createWidgetContent() {\n      let container = this._createDialogContainer();\n      let vbox = new qx.ui.container.Composite(new qx.ui.layout.VBox(10));\n      container.add(vbox);\n\n      let prologue = this.tr(\n        '<h3>Config Errors</h3>\\\n<p>The validation of \"%1\" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because \\\nit can break the file completely. Please open this file in the text editor and fix the errors there. \\\nOnly proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>',\n\n        this._file.getFullPath()\n      );\n\n      let options = this.tr(\n        '<p>You can choose between the following options:\\\n<ul>\\\n    <li><b>Cancel</b> - Close this editor</li>\\\n    <li><b>Proceed</b> - Open the defective file in this editor</li>\\\n    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li>\\\n</ul>\\\n</p>'\n      );\n\n      const labelOptions = {\n        rich: true,\n        width: Math.min(qx.bom.Viewport.getWidth() - 32, 750),\n        allowGrowX: true\n      };\n\n      const message = new qx.ui.basic.Label(prologue);\n      message.set(labelOptions);\n      vbox.add(message);\n\n      // errors\n      const errorBox = new qx.ui.container.Composite(new qx.ui.layout.VBox(0));\n      const errorScroll = new qx.ui.container.Scroll(errorBox);\n      errorScroll.set({\n        padding: [0, 0, 8, 8],\n        decorator: 'cv-editor-config-section'\n      });\n\n      errorScroll.setMinHeight(100);\n      errorScroll.setHeight(Math.min(300, qx.bom.Document.getHeight() - 340));\n      this._rootListenerId = qx.core.Init.getApplication()\n        .getRoot()\n        .addListener('resize', function () {\n          errorScroll.setHeight(Math.min(300, qx.bom.Document.getHeight() - 340));\n        });\n      vbox.add(errorScroll, { flex: 1 });\n      const errorLabels = new Map();\n      this._errors.forEach(error => {\n        const errorId = error.line + error.element + error.attribute;\n        let label;\n        if (!errorLabels.has(errorId)) {\n          let codeSnippet = [];\n          const startIndex = Math.max(0, error.line - 3);\n          const endIndex = Math.min(this._content.length - 1, error.line + 2);\n          let minIndent = Number.POSITIVE_INFINITY;\n          for (let i = startIndex; i < endIndex; i++) {\n            const line = this._content[i];\n            const indent = line.search(/\\S|$/);\n            if (indent < minIndent && indent >= 0) {\n              minIndent = indent;\n            }\n            codeSnippet.push([i + 1, line.trimRight()]);\n          }\n          if (minIndent === Number.POSITIVE_INFINITY) {\n            minIndent = 0;\n          }\n          codeSnippet = codeSnippet.map(line => line[0] + ': ' + qx.xml.String.escape(line[1].substr(minIndent)));\n\n          const headline = this.tr('Line %1', error.line);\n          label = new qx.ui.basic.Label(\n            `<h4>${headline}</h4><pre class=\"highlight\" style=\"background-color: black; padding: 8px;\" data-lang=\"text/xml\">${codeSnippet.join(\n              '\\n'\n            )}</pre>`\n          );\n\n          label.set(labelOptions);\n          errorLabels.set(errorId, label);\n          errorBox.add(label);\n        } else {\n          label = errorLabels.get(errorId);\n        }\n        if (!error.message.startsWith('[facet')) {\n          label.setValue(label.getValue() + `<p>${error.message}</p>`);\n        }\n      }, this);\n\n      const option = new qx.ui.basic.Label(options);\n      option.set(labelOptions);\n      vbox.add(option);\n\n      // buttons\n      let buttonPane = this._createButtonPane();\n\n      // close button\n      let closeButton = new qx.ui.form.Button(this.tr('Cancel'));\n      closeButton.addListener('execute', () => this.fireDataEvent('action', 'cancel'));\n\n      let proceedButton = new qx.ui.form.Button(this.tr('Proceed'));\n      proceedButton.addListener('execute', () => this.fireDataEvent('action', 'proceed'));\n\n      let openSourceButton = new qx.ui.form.Button(this.tr('Open in text editor'));\n\n      openSourceButton.addListener('execute', () => this.fireDataEvent('action', 'open-source'));\n\n      buttonPane.add(closeButton);\n      buttonPane.add(proceedButton);\n      buttonPane.add(openSourceButton);\n\n      container.add(buttonPane);\n      this.add(container);\n    }\n  },\n\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct() {\n    this._content = null;\n    this._errors = null;\n    this._file = null;\n    if (this._rootListenerId) {\n      qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);\n      this._rootListenerId = null;\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}