{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/ui/manager/dialog/ValidationError.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "qxl",
    "dialog",
    "Dialog",
    "construct",
    "file",
    "content",
    "errors",
    "properties",
    "_file",
    "_content",
    "split",
    "_errors",
    "Object",
    "assign",
    "useBlocker",
    "addListener",
    "window",
    "monaco",
    "cv",
    "ui",
    "manager",
    "editor",
    "Source",
    "load",
    "highlight",
    "events",
    "action",
    "members",
    "_rootListenerId",
    "Array",
    "from",
    "document",
    "querySelectorAll",
    "forEach",
    "elem",
    "colorizeElement",
    "theme",
    "_createWidgetContent",
    "container",
    "_createDialogContainer",
    "vbox",
    "Composite",
    "layout",
    "VBox",
    "add",
    "prologue",
    "tr",
    "getFullPath",
    "options",
    "labelOptions",
    "rich",
    "width",
    "Math",
    "min",
    "bom",
    "Viewport",
    "getWidth",
    "allowGrowX",
    "message",
    "basic",
    "Label",
    "set",
    "errorBox",
    "errorScroll",
    "Scroll",
    "padding",
    "decorator",
    "setMinHeight",
    "setHeight",
    "Document",
    "getHeight",
    "core",
    "Init",
    "getApplication",
    "getRoot",
    "flex",
    "errorLabels",
    "Map",
    "error",
    "errorId",
    "line",
    "element",
    "attribute",
    "label",
    "has",
    "codeSnippet",
    "startIndex",
    "max",
    "endIndex",
    "length",
    "minIndent",
    "Number",
    "POSITIVE_INFINITY",
    "i",
    "indent",
    "search",
    "push",
    "trimRight",
    "map",
    "xml",
    "String",
    "escape",
    "substr",
    "headline",
    "join",
    "get",
    "startsWith",
    "setValue",
    "getValue",
    "option",
    "buttonPane",
    "_createButtonPane",
    "closeButton",
    "form",
    "Button",
    "fireDataEvent",
    "proceedButton",
    "openSourceButton",
    "destruct",
    "removeListenerById",
    "ValidationError"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n * Show validation errors for a config file.\n */\nqx.Class.define('cv.ui.manager.dialog.ValidationError', {\n  extend: qxl.dialog.Dialog,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  /**\n   *\n   * @param file {cv.ui.manager.model.FileItem}\n   * @param content {String}\n   * @param errors {Array<Map>}\n   * @param properties {Map?}\n   */\n  construct: function (file, content, errors, properties) {\n    this._file = file;\n    this._content = content.split('\\n');\n    this._errors = errors;\n    this.base(arguments, Object.assign(properties || {}, {\n      useBlocker: true\n    }));\n\n    this.addListener('appear', () => {\n      if (!window.monaco) {\n        cv.ui.manager.editor.Source.load(this.highlight, this);\n      } else {\n        this.highlight();\n      }\n    });\n  },\n\n  /*\n  ***********************************************\n    EVENTS\n  ***********************************************\n  */\n  events: {\n   action: 'qx.event.type.Data'\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    _content: null,\n    _errors: null,\n    _rootListenerId: null,\n\n    /**\n     * @var {cv.ui.manager.model.FileItem}\n     */\n    _file: null,\n\n    highlight: function () {\n      Array.from(document.querySelectorAll('pre.highlight')).forEach(elem => {\n        monaco.editor.colorizeElement(elem, {\n          theme: 'vs-dark'\n        });\n      });\n    },\n\n    /**\n     * Create the main content of the widget\n     */\n    _createWidgetContent: function() {\n      let container = this._createDialogContainer();\n      let vbox = new qx.ui.container.Composite(new qx.ui.layout.VBox(10));\n      container.add(vbox);\n\n      let prologue = this.tr('<h3>Config Errors</h3>\\\n<p>The validation of \"%1\" showed some errors. It is NOT recommended to edit this file in the XML-Tree editor, because \\\nit can break the file completely. Please open this file in the text editor and fix the errors there. \\\nOnly proceed to edit the file in the XML-Tree editor if you know what you are doing.</p>', this._file.getFullPath());\n\n      let options = this.tr('<p>You can choose between the following options:\\\n<ul>\\\n    <li><b>Cancel</b> - Close this editor</li>\\\n    <li><b>Proceed</b> - Open the defective file in this editor</li>\\\n    <li><b>Open in text editor</b> - Close this editor and open the defective file in the text editor</li>\\\n</ul>\\\n</p>');\n      const labelOptions = {\n        rich: true,\n        width: Math.min(qx.bom.Viewport.getWidth() - 32, 750),\n        allowGrowX: true\n      };\n      const message = new qx.ui.basic.Label(prologue);\n      message.set(labelOptions);\n      vbox.add(message);\n\n      // errors\n      const errorBox = new qx.ui.container.Composite(new qx.ui.layout.VBox(0));\n      const errorScroll = new qx.ui.container.Scroll(errorBox);\n      errorScroll.set({\n        padding: [0, 0, 8, 8],\n        decorator: 'cv-editor-config-section'\n      });\n      errorScroll.setMinHeight(100);\n      errorScroll.setHeight(Math.min(300, qx.bom.Document.getHeight() - 340));\n      this._rootListenerId = qx.core.Init.getApplication().getRoot().addListener('resize', function () {\n        errorScroll.setHeight(Math.min(300, qx.bom.Document.getHeight() - 340));\n      });\n      vbox.add(errorScroll, {flex: 1});\n      const errorLabels = new Map();\n      this._errors.forEach(error => {\n        const errorId = error.line + error.element + error.attribute;\n        let label;\n        if (!errorLabels.has(errorId)) {\n          let codeSnippet = [];\n          const startIndex = Math.max(0, error.line-3);\n          const endIndex = Math.min(this._content.length - 1, error.line+2);\n          let minIndent = Number.POSITIVE_INFINITY;\n          for (let i = startIndex; i < endIndex; i++) {\n            const line = this._content[i];\n            const indent = line.search(/\\S|$/);\n            if (indent < minIndent && indent >= 0) {\n              minIndent = indent;\n            }\n            codeSnippet.push([i+1, line.trimRight()]);\n          }\n          if (minIndent === Number.POSITIVE_INFINITY) {\n            minIndent = 0;\n          }\n          codeSnippet = codeSnippet.map(line => line[0] + ': ' + qx.xml.String.escape(line[1].substr(minIndent)));\n          const headline = this.tr('Line %1', error.line);\n          label = new qx.ui.basic.Label(`<h4>${headline}</h4><pre class=\"highlight\" style=\"background-color: black; padding: 8px;\" data-lang=\"text/xml\">${codeSnippet.join('\\n')}</pre>`);\n          label.set(labelOptions);\n          errorLabels.set(errorId, label);\n          errorBox.add(label);\n        } else {\n          label = errorLabels.get(errorId);\n        }\n        if (!error.message.startsWith('[facet')) {\n          label.setValue(label.getValue() + `<p>${error.message}</p>`);\n        }\n      }, this);\n\n      const option = new qx.ui.basic.Label(options);\n      option.set(labelOptions);\n      vbox.add(option);\n\n      // buttons\n      let buttonPane = this._createButtonPane();\n\n      // close button\n      let closeButton = new qx.ui.form.Button(this.tr('Cancel'));\n      closeButton.addListener('execute', () => this.fireDataEvent('action', 'cancel'), this);\n\n      let proceedButton = new qx.ui.form.Button(this.tr('Proceed'));\n      proceedButton.addListener('execute', () => this.fireDataEvent('action', 'proceed'), this);\n\n      let openSourceButton = new qx.ui.form.Button(this.tr('Open in text editor'));\n      openSourceButton.addListener('execute', () => this.fireDataEvent('action', 'open-source'), this);\n\n      buttonPane.add(closeButton);\n      buttonPane.add(proceedButton);\n      buttonPane.add(openSourceButton);\n\n      container.add(buttonPane);\n      this.add(container);\n    }\n  },\n  /*\n  ***********************************************\n    DESTRUCTOR\n  ***********************************************\n  */\n  destruct: function () {\n    this._content = null;\n    this._errors = null;\n    this._file = null;\n    if (this._rootListenerId) {\n      qx.core.Init.getApplication().getRoot().removeListenerById(this._rootListenerId);\n      this._rootListenerId = null;\n    }\n  }\n});\n"
  ]
}