{
  "version": 3,
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/plugins/diagram/AbstractDiagram.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "ui",
    "structure",
    "AbstractWidget",
    "include",
    "common",
    "Operate",
    "Refresh",
    "type",
    "construct",
    "props",
    "_debouncedLoadDiagramData",
    "util",
    "Function",
    "debounce",
    "loadDiagramData",
    "bind",
    "statics",
    "cache",
    "parse",
    "xml",
    "path",
    "flavour",
    "pageType",
    "mappings",
    "Object",
    "assign",
    "getAttributeToPropertyMappings",
    "parser",
    "WidgetParser",
    "parseElement",
    "parseRefresh",
    "legend",
    "getAttribute",
    "data",
    "Model",
    "getInstance",
    "setWidgetData",
    "content",
    "getDiagramElements",
    "legendInline",
    "indexOf",
    "legendPopup",
    "series",
    "seriesStart",
    "seriesEnd",
    "seriesResolution",
    "transform",
    "parseInt",
    "period",
    "legendposition",
    "timeformat",
    "timeformatTooltip",
    "zoomYAxis",
    "value",
    "title",
    "target",
    "refresh",
    "gridcolor",
    "previewlabels",
    "popup",
    "tooltip",
    "xmlElement",
    "retVal",
    "axes",
    "axesnum",
    "ts",
    "tsnum",
    "axesNameIndex",
    "querySelectorAll",
    "forEach",
    "elem",
    "unit",
    "axisLabel",
    "position",
    "min",
    "max",
    "tickDecimals",
    "tickFormatter",
    "v",
    "axis",
    "toFixed",
    "textContent",
    "src",
    "tagName",
    "steps",
    "fillMissing",
    "tsType",
    "color",
    "label",
    "axisIndex",
    "fill",
    "scaling",
    "parseFloat",
    "cFunc",
    "fillTs",
    "resol",
    "offset",
    "style",
    "align",
    "barWidth",
    "getInfluxFilter",
    "dsIndex",
    "children",
    "length",
    "retval",
    "i",
    "child",
    "lookupTsCache",
    "start",
    "end",
    "res",
    "forceNowDatapoint",
    "force",
    "callback",
    "callbackParameter",
    "client",
    "TemplateEngine",
    "visu",
    "key",
    "url",
    "chartsResource",
    "getResourcePath",
    "encodeURIComponent",
    "filter",
    "field",
    "authentication",
    "urlNotInCache",
    "doLoad",
    "undefined",
    "Date",
    "now",
    "timestamp",
    "waitingCallbacks",
    "push",
    "xhr",
    "dispose",
    "io",
    "request",
    "Xhr",
    "authorize",
    "set",
    "accept",
    "addListener",
    "ev",
    "_onSuccess",
    "_onStatusError",
    "send",
    "tsdata",
    "getTarget",
    "getResponse",
    "hasCustomChartsDataProcessor",
    "processChartsData",
    "millisOffset",
    "newRrd",
    "Array",
    "j",
    "l",
    "last",
    "from",
    "waitingCallback",
    "log",
    "Logger",
    "error",
    "properties",
    "check",
    "init",
    "nullable",
    "apply",
    "members",
    "_init",
    "popupplot",
    "plot",
    "plotted",
    "_timerPopup",
    "__isPopup",
    "_applyTitle",
    "setLabel",
    "_setupRefreshAction",
    "getRefresh",
    "_timer",
    "event",
    "Timer",
    "_stopRefresh",
    "timer",
    "isEnabled",
    "stop",
    "_startRefresh",
    "runImmediately",
    "fireEvent",
    "_action",
    "popupDiagram",
    "dom",
    "Element",
    "create",
    "id",
    "getPath",
    "PopupHandler",
    "showPopup",
    "getLabel",
    "page",
    "getParentPage",
    "Registration",
    "removeAllListeners",
    "shutdown",
    "parent",
    "parentNode",
    "entries",
    "height",
    "width",
    "margin",
    "key_value",
    "innerHTML",
    "stopPropagation",
    "initDiagram",
    "isPopup",
    "options",
    "canvas",
    "getTooltip",
    "tooltipOpts",
    "xDateFormat",
    "getTimeformatTooltip",
    "shifts",
    "x",
    "y",
    "defaultTheme",
    "zoom",
    "interactive",
    "trigger",
    "amount",
    "pan",
    "cursor",
    "frameRate",
    "triggerOnDrag",
    "yaxes",
    "JSON",
    "stringify",
    "getContent",
    "xaxes",
    "mode",
    "getTimeformat",
    "show",
    "isLegendPopup",
    "isLegendInline",
    "backgroundColor",
    "getLegendposition",
    "grid",
    "aboveData",
    "getGridcolor",
    "tickColor",
    "markingsColor",
    "borderColor",
    "hoverable",
    "touch",
    "scale",
    "autoWidth",
    "autoHeight",
    "delayTouchEnded",
    "simulClick",
    "tapThreshold",
    "dbltapThreshold",
    "tapPrecision",
    "val",
    "axisLabelColour",
    "yaxis",
    "zoomRange",
    "getZoomYAxis",
    "xaxis",
    "panRange",
    "clickable",
    "getPreviewlabels",
    "ticks",
    "diagram",
    "$",
    "empty",
    "debug",
    "that",
    "self",
    "container",
    "closest",
    "actor",
    "action",
    "getPlaceholder",
    "unbind",
    "getSeriesSettings",
    "xAxis",
    "isInteractive",
    "hour",
    "day",
    "fullday",
    "week",
    "month",
    "year",
    "ret",
    "getSeries",
    "getSeriesStart",
    "getSeriesEnd",
    "getSeriesResolution",
    "selectedSeries",
    "getPeriod",
    "datamin",
    "datamax",
    "forceReload",
    "getAxes",
    "loadedData",
    "tsloaded",
    "tsSuccessful",
    "index",
    "isNaN",
    "getForceNowDatapoint",
    "plugins",
    "AbstractDiagram",
    "bars",
    "lines",
    "zero",
    "points",
    "fulldata",
    "loadedIndex",
    "k",
    "setData",
    "setupGrid",
    "draw",
    "destruct",
    "_disposeObjects",
    "defer",
    "loader",
    "ScriptLoader",
    "addScripts"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/* AbstractDiagram.js \n * \n * copyright (c) 2010-2017, Christian Mayer and the CometVisu contributers.\n * \n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n\n/**\n * This plugins integrates flot (diagrams in javascript) into the visualization.\n * server-side data-storage is rrd or InfluxDB.\n *\n * short documentation\n *\n * <h4>widgets:</h4>\n * <ul>\n *   <li>diagram</li>\n *   <li>diagram_info</li>\n * </ul>\n *\n * <h4>attributes (per diagram):</h4>\n * <ul>\n *   <li>series:               optional, \"hour\", \"day\" (default), \"week\", \"month\", \"year\"</li>\n *   <li>period:               optional, number of \"series\" to be shown</li>\n *   <li>refresh:              optional, refresh-rate in seconds, no refresh if missing</li>\n *   <li>gridcolor:            optional, color for dataline and grid, HTML-colorcode</li>\n *   <li>width, height:        optional, width and height of \"inline\"-diagram</li>\n *   <li>previewlabels:        optional, show labels on \"inline\"-diagram</li>\n *   <li>popup:                optional, make diagram clickable and open popup</li>\n *   <li>legend:               optional, \"none\", \"both\", \"inline\", \"popup\" select display of legend</li>\n *   <li>title:                optional, diagram title (overrides label-content)</li>\n * </ul>\n *\n * <h4>attributes (per graph):</h4>\n * <ul>\n *   <li>style:                optional, \"lines\" (default), \"bars\", \"points\" select graph type</li>\n *   <li>fill:                 optional, true or false - fill the space under the line / within the bar (line / bar style graphs)</li>\n *   <li>barWidth:             optional, width of bars (bar style graphs)</li>\n *   <li>align:                optional, \"left\" (default), \"center\", \"right\" select qlignemnt of bars (bar style graphs)</li>\n * </ul>\n *\n * @author Michael Hausl [michael at hausl dot com]\n * @since 0.6.0\n *\n * @asset(plugins/diagram/influxfetch.php)\n * @asset(plugins/diagram/dep/flot/jquery.flot.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.touch.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.canvas.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.resize.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.time.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.axislabels.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.tooltip.min.js)\n * @asset(plugins/diagram/dep/flot/jquery.flot.navigate.min.js)\n */\nqx.Class.define('cv.plugins.diagram.AbstractDiagram', {\n  extend: cv.ui.structure.AbstractWidget,\n  include: [cv.ui.common.Operate, cv.ui.common.Refresh],\n  type: 'abstract',\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct: function (props) {\n    this.base(arguments, props);\n    this._debouncedLoadDiagramData = qx.util.Function.debounce(this.loadDiagramData.bind(this), 200);\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    cache: {},\n    /**\n     * Parses the widgets XML configuration and extracts the given information\n     * to a simple key/value map.\n     * @param xml {Element} XML-Element\n     * @param path {String} internal path of the widget\n     * @param flavour {String} Flavour of the widget\n     * @param pageType {String} Page type (2d, 3d, ...)\n     * @param mappings\n     */\n    parse: function (xml, path, flavour, pageType, mappings) {\n      if (mappings) {\n        mappings = Object.assign(mappings, this.getAttributeToPropertyMappings());\n      } else {\n        mappings = this.getAttributeToPropertyMappings();\n      }\n      cv.parser.WidgetParser.parseElement(this, xml, path, flavour, pageType, mappings);\n      cv.parser.WidgetParser.parseRefresh(xml, path);\n\n      const legend = xml.getAttribute('legend') || 'both';\n      return cv.data.Model.getInstance().setWidgetData(path, {\n        content           : this.getDiagramElements(xml),\n        legendInline      : ['both', 'inline'].indexOf(legend) >= 0,\n        legendPopup       : ['both', 'popup'].indexOf(legend) >= 0\n      });\n    },\n\n    getAttributeToPropertyMappings: function() {\n      return {\n        series            : { 'default': 'day' },\n        seriesStart       : { 'default': 'end-month' },\n        seriesEnd         : { 'default': 'now' },\n        seriesResolution  : { 'default': 300, transform: parseInt },\n        period            : { 'default': 1, transform: parseInt },\n        legendposition    : { 'default': 'ne' },\n        timeformat        : {},\n        timeformatTooltip : { 'default': '%d.%m.%Y %H:%M' },\n        zoomYAxis         : { transform: function(value) {\n          return value === 'true';\n        }},\n        title             : { target: 'title' },\n        refresh           : {},\n        gridcolor         : { 'default': '#81664B' },\n        previewlabels     : { transform: function(value) {\n          return value === 'true';\n        }},\n        popup             : { transform: function(value) {\n          return value === 'true';\n        }},\n        tooltip           : { transform: function(value) {\n          return value === 'true';\n        }}\n      };\n    },\n\n    getDiagramElements: function(xmlElement) {\n      const retVal = {\n        axes: [],\n        axesnum: 0,\n        ts: [],\n        tsnum: 0\n      };\n      const axesNameIndex = [];\n\n      xmlElement.querySelectorAll('axis').forEach(function(elem) {\n        const unit = elem.getAttribute('unit') || '';\n        retVal.axes[retVal.axesnum] = {\n          axisLabel     : elem.getAttribute('label') || null,\n          position      : elem.getAttribute('position') || 'left',\n          min           : elem.getAttribute('min') || null,\n          max           : elem.getAttribute('max') || null,\n          unit          : unit,\n          tickDecimals  : elem.getAttribute('decimals') || null,\n          tickFormatter : function (v, axis) {\n            return v.toFixed(axis.tickDecimals) + unit;\n          }\n        };\n        retVal.axesnum++;\n        axesNameIndex[elem.textContent] = retVal.axesnum;\n      }, this);\n\n      xmlElement.querySelectorAll('influx,rrd').forEach(function(elem) {\n        const src = elem.tagName === 'rrd' ? elem.textContent : elem.getAttribute('measurement');\n        const steps = (elem.getAttribute('steps') || 'false') === 'true';\n        const fillMissing = elem.getAttribute('fillMissing');\n        retVal.ts[retVal.tsnum] = {\n          tsType    : elem.tagName,\n          src       : src,\n          color     : elem.getAttribute('color'),\n          label     : elem.getAttribute('label') || src,\n          axisIndex : axesNameIndex[elem.getAttribute('yaxis')] || 1,\n          steps     : steps,\n          fill      : (elem.getAttribute('fill') || 'false') === 'true',\n          scaling   : parseFloat(elem.getAttribute('scaling')) || 1.0,\n          cFunc     : elem.getAttribute('consolidationFunction') || (elem.tagName === 'rrd' ? 'AVERAGE' : 'MEAN'),\n          fillTs    : (fillMissing === null) ? (steps ? 'previous' : 'linear') : fillMissing,\n          resol     : parseInt(elem.getAttribute('resolution')),\n          offset    : parseInt(elem.getAttribute('offset')),\n          style     : elem.getAttribute('style') || 'lines',\n          align     : elem.getAttribute('align') || 'center',\n          barWidth  : elem.getAttribute('barWidth') || 1\n        };\n        if (elem.tagName === 'influx') {\n          retVal.ts[retVal.tsnum]['filter'] = this.getInfluxFilter(elem, 'AND');\n          retVal.ts[retVal.tsnum]['field'] = elem.getAttribute('field');\n          retVal.ts[retVal.tsnum]['authentication'] = elem.getAttribute('authentication');\n        } else {\n          let dsIndex = elem.getAttribute('datasourceIndex') || 0;\n          if (dsIndex < 0) {\n            dsIndex = 0;\n          }\n          retVal.ts[retVal.tsnum].dsIndex = dsIndex;\n        }\n        retVal.tsnum++;\n      }, this);\n      return retVal;\n    },\n\n    /**\n     * Recursively walk through the elem to build filter sting\n     * @param elem\n     * @param type\n     */\n    getInfluxFilter: function(elem, type) {\n      const children = elem.children;\n      const length = children.length;\n      let retval = '';\n      let i = 0;\n\n      for (; i < length; i++) {\n        const child = children[i];\n\n        if (retval != '') {\n          retval += ' ' + type + ' ';\n        }\n\n        switch (child.tagName) {\n          case 'and':\n            retval += this.getInfluxFilter(child, 'AND');\n            break;\n\n          case 'or':\n            retval += this.getInfluxFilter(child, 'OR');\n            break;\n\n          case 'tag':\n            retval += child.getAttribute('key') + ' ' + child.getAttribute('operator') + ' \\'' + child.getAttribute('value') + '\\'';\n            break;\n\n          default:\n             // ignore unknown\n        }\n      }\n\n      if (type) {\n        return '(' + retval + ')';\n      }\n\n      return retval;\n    },\n\n    /**\n     * Get the rrd or InfluxDB and put it's content in the cache.\n     * @param ts\n     * @param start\n     * @param end\n     * @param res\n     * @param forceNowDatapoint\n     * @param refresh {Number} time is seconds to refresh the data\n     * @param force {Boolean} Update even when the cache is still valid\n     * @param callback {Function} call when the data has arrived\n     * @param callbackParameter\n     */\n    lookupTsCache: function(ts, start, end, res, forceNowDatapoint, refresh, force, callback, callbackParameter) {\n      const client = cv.TemplateEngine.getInstance().visu;\n      let key;\n      let url;\n      const chartsResource = client.getResourcePath('charts', {\n        src: ts.src,\n        start: start,\n        end: end\n      });\n      if (ts.tsType !== 'influx' && chartsResource !== null) {\n        // the backend provides an charts resource that must be processed differently (e.g. openHABs persistence data\n        url = chartsResource;\n        key = url;\n      } else {\n        url = ((ts.tsType === 'influx')\n            ? 'resource/plugins/diagram/influxfetch.php?ts=' + ts.src\n            : client.getResourcePath('rrd') + '?rrd=' + encodeURIComponent(ts.src) + '.rrd') +\n            '&ds=' + encodeURIComponent(ts.cFunc) +\n            // NOTE: don't encodeURIComponent `start` and `end` for RRD as the \"+\" needs to be in the URL in plain text\n            //       although it looks wrong (as a \"+\" in a URL translates in the decode to a space: \" \")\n            '&start=' + (ts.tsType === 'rrd' ? start : encodeURIComponent(start)) +\n            '&end=' + (ts.tsType === 'rrd' ? end : encodeURIComponent(end)) +\n            '&res=' + encodeURIComponent(res) +\n            (ts.fillTs ? '&fill=' + encodeURIComponent(ts.fillTs) : '') +\n            (ts.filter ? '&filter=' + encodeURIComponent(ts.filter) : '') +\n            (ts.field ? '&field=' + encodeURIComponent(ts.field) : '') +\n            (ts.authentication ? '&auth=' + encodeURIComponent(ts.authentication) : '');\n        key = url + (ts.tsType === 'rrd' ? '|' + ts.dsIndex : '');\n      }\n      let\n        urlNotInCache = !(key in this.cache);\n        let doLoad = force || urlNotInCache || !('data' in this.cache[key]) || (refresh!==undefined && (Date.now()-this.cache[key].timestamp) > refresh*1000);\n\n      if (doLoad) {\n        if (urlNotInCache) {\n          this.cache[key] = {waitingCallbacks: []};\n        }\n        this.cache[key].waitingCallbacks.push([ callback, callbackParameter ]);\n\n        if (this.cache[key].waitingCallbacks.length === 1) {\n          if (this.cache[key].xhr) {\n            this.cache[key].xhr.dispose();\n          }\n          const xhr = new qx.io.request.Xhr(url);\n          client.authorize(xhr);\n          xhr.set({\n            accept: 'application/json'\n          });\n          xhr.addListener('success', function(ev) {\n            this._onSuccess(ts, key, ev, forceNowDatapoint);\n          }, this);\n          xhr.addListener('statusError', function(ev) {\n            this._onStatusError(ts, key, ev);\n          }, this);\n          this.cache[key].xhr = xhr;\n          xhr.send();\n        }\n      } else {\n        callback(this.cache[key].data, callbackParameter);\n      }\n    },\n\n    _onSuccess: function(ts, key, ev, forceNowDatapoint) {\n      let tsdata = ev.getTarget().getResponse();\n      if (tsdata !== null) {\n        const client = cv.TemplateEngine.getInstance().visu;\n        if (client.hasCustomChartsDataProcessor(tsdata)) {\n          tsdata = client.processChartsData(tsdata);\n        } else {\n          // calculate timestamp offset and scaling\n          const millisOffset = (ts.offset ? ts.offset * 1000 : 0);\n          const newRrd = new Array(tsdata.length);\n          let j = 0;\n          const l = tsdata.length;\n          for (; j < l; j++) {\n            if (ts.tsType === 'rrd') {\n              newRrd[j] = [(tsdata[j][0] + millisOffset), (parseFloat(tsdata[j][1][ts.dsIndex]) * ts.scaling)];\n            } else {\n              newRrd[j] = [(tsdata[j][0] + millisOffset), (parseFloat(tsdata[j][1]) * ts.scaling)];\n            }\n          }\n          tsdata = newRrd;\n        }\n      }\n\n      let now = Date.now();\n\n      if (forceNowDatapoint && tsdata.length > 0) {\n        let last = Array.from(tsdata[tsdata.length - 1]); // force copy\n        last[0] = now;\n        tsdata.push(last);\n      }\n\n      this.cache[key].data = tsdata;\n      this.cache[key].timestamp = now;\n\n      this.cache[key].waitingCallbacks.forEach(function (waitingCallback) {\n        waitingCallback[0](tsdata, waitingCallback[1]);\n      }, this);\n      this.cache[key].waitingCallbacks.length = 0; // empty array)\n    },\n\n    _onStatusError: function(ts, key, ev) {\n      qx.log.Logger.error(this, '_onStatusError', ts, key, ev);\n      const tsdata = [];\n\n      this.cache[key].data = tsdata;\n      this.cache[key].timestamp = Date.now();\n\n      this.cache[key].waitingCallbacks.forEach(function (waitingCallback) {\n        waitingCallback[0](tsdata, waitingCallback[1]);\n      }, this);\n      this.cache[key].waitingCallbacks.length = 0; // empty array)\n    }\n  },\n\n  /*\n  ******************************************************\n    PROPERTIES\n  ******************************************************\n  */\n  properties: {\n    content: {\n      check: 'Object',\n      init: {}\n    },\n    title: {\n      check: 'String',\n      nullable: true,\n      apply: '_applyTitle'\n    },\n    series: {\n      check: ['hour', 'day', 'week', 'month', 'year', 'fullday', 'custom'],\n      init: 'day'\n    },\n    seriesStart: {\n      check: 'String',\n      init: 'end-month'\n    },\n    seriesEnd: {\n      check: 'String',\n      init: 'now'\n    },\n    seriesResolution: {\n      check: 'Number',\n      init: 300\n    },\n    forceNowDatapoint: {\n      check: 'Boolean',\n      init: true\n    },\n    period: {\n      check: 'Number',\n      init: 1\n    },\n    legendInline: {\n      check: 'Boolean',\n      init: true\n    },\n    legendPopup: {\n      check: 'Boolean',\n      init: true\n    },\n    legendposition: {\n      check: ['nw', 'ne', 'sw', 'se'],\n      init: 'ne'\n    },\n    timeformat: {\n      check: 'String',\n      nullable: true\n    },\n    timeformatTooltip: {\n      check: 'String',\n      init: '%d.%m.%Y %H:%M'\n    },\n    zoomYAxis: {\n      check: 'Boolean',\n      init: false\n    },\n    gridcolor: {\n      check: 'String',\n      init: '#81664B'\n    },\n    previewlabels: {\n      check: 'Boolean',\n      init: false\n    },\n    popup: {\n      check: 'Boolean',\n      init: false\n    },\n    tooltip: {\n      check: 'Boolean',\n      init: false\n    }\n  },\n\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    _init: null,\n    popupplot: null,\n    plot: null,\n    plotted: null,\n    _timerPopup: null,\n    __isPopup: false,\n\n    // property apply\n    _applyTitle: function(value) {\n      if (value) {\n        // override label\n        this.setLabel('<div class=\"label\">' + value + '</div>');\n      }\n    },\n\n    _setupRefreshAction: function() {\n      if (this.getRefresh()) {\n        if (!this._timer) {\n          this._timer = new qx.event.Timer(this.getRefresh());\n          this._timer.addListener('interval', function () {\n            this.loadDiagramData(this.plot, false, true);\n          }, this);\n        }\n\n        if (!this._timerPopup) {\n          this._timerPopup = new qx.event.Timer(this.getRefresh());\n          this._timerPopup.addListener('interval', function () {\n            this.loadDiagramData(this.popupplot, false, true);\n          }, this);\n        }\n      }\n    },\n\n    /**\n     * Stop the refresh timer\n     *\n     * @param timer {qx.event.Timer} stop this timer\n     * @protected\n     */\n    _stopRefresh: function(timer) {\n      if (timer && timer.isEnabled()) {\n        timer.stop();\n      }\n    },\n\n    /**\n     * Start the refresh timer\n     *\n     * @param timer {qx.event.Timer} start this timer\n     * @param runImmediately {Boolean} fire the timers 'interval' event immediately to trigger an refresh right now\n     * @protected\n     */\n    _startRefresh: function(timer, runImmediately) {\n      if (timer) {\n        if (!timer.isEnabled()) {\n          timer.start();\n        }\n        if (runImmediately === true) {\n          timer.fireEvent('interval');\n        }\n      }\n    },\n\n    _action: function() {\n      const popupDiagram = qx.dom.Element.create('div', {\n        'class': 'diagram',\n        id: this.getPath() + '_big',\n        style: 'height: 90%'\n      });\n      this._init = true;\n      const popup = cv.ui.PopupHandler.showPopup('diagram', {\n        title: this.getLabel(),\n        content: popupDiagram,\n        page: this.getParentPage().getPath()\n      });\n\n      // this will be called when the popup is being closed.\n      // NOTE: this will be called twice, one time for the foreground and one\n      //       time for the background.\n      popup.addListener('close', function() {\n        this._stopRefresh(this._timerPopup);\n        qx.event.Registration.removeAllListeners(popupDiagram);\n        if (this.popupplot) {\n          this.popupplot.shutdown();\n          this.popupplot = null;\n        }\n      }, this);\n\n      const parent = popupDiagram.parentNode;\n      Object.entries({height: '100%', width: '95%', margin: 'auto'}).forEach(function(key_value) {\n parent.style[key_value[0]]=key_value[1]; \n});// define parent as 100%!\n      popupDiagram.innerHTML = '';\n      qx.event.Registration.addListener(popupDiagram, 'tap', function(event) {\n        // don't let the popup know about the click, or it will close\n        event.stopPropagation();\n      }, this);\n\n      this.initDiagram(true);\n\n      this._startRefresh(this._timerPopup, true);\n    },\n\n    initDiagram: function(isPopup) {\n      if (!this._init) {\n        return;\n      }\n      this._init = false;\n      isPopup = isPopup || this.__isPopup;\n\n      const options = {\n        canvas: true,\n        tooltip: this.getTooltip(),\n        tooltipOpts: {\n          content: '<center>%x<br/>%y</center>',\n          xDateFormat: this.getTimeformatTooltip(),\n          shifts: {\n            x: 20,\n            y: 10\n          },\n          defaultTheme: false\n        },\n        zoom: {\n          interactive: isPopup,\n          trigger: 'dblclick',\n          amount: 1.5\n        },\n        pan: {\n          interactive: isPopup,\n          cursor: 'move',\n          frameRate: 20,\n          triggerOnDrag: false\n        },\n        yaxes: JSON.parse(JSON.stringify(this.getContent().axes)), // deep copy to prevent side effects\n        xaxes: [{\n          mode: 'time',\n          timeformat: this.getTimeformat()\n        }],\n        legend: {\n          show: (isPopup && this.isLegendPopup()) || (!isPopup && this.isLegendInline()),\n          backgroundColor: '#101010',\n          position: this.getLegendposition()\n        },\n        grid: {\n          show: true,\n          aboveData: false,\n          color: this.getGridcolor(),\n          backgroundColor: '#000000',\n          tickColor: this.getGridcolor(),\n          markingsColor: this.getGridcolor(),\n          borderColor: this.getGridcolor(),\n          hoverable: true\n        },\n        touch: {\n          pan: isPopup ? 'x' : 'none', // what axis pan work\n          scale: isPopup ? 'x' : 'none', // what axis zoom work\n          autoWidth: false,\n          autoHeight: false,\n          delayTouchEnded: 500, // delay in ms before touchended event is fired if no more touches\n          callback: null, // other plot draw callback\n          simulClick: true, // plugin will generate Mouse click event to brwoser on tap or double tap\n          tapThreshold: 150, // range of time where a tap event could be detected\n          dbltapThreshold: 200, // delay needed to detect a double tap\n          tapPrecision: 60 / 2 // tap events boundaries ( 60px square by default )\n        }\n      };\n      options.yaxes.forEach(function(val) {\n        Object.assign(val, {axisLabelColour: this.getGridcolor(), color: this.getGridcolor()});\n      }, this);\n      options.xaxes.forEach(function(val) {\n        Object.assign(val, {axisLabelColour: this.getGridcolor(), color: this.getGridcolor()});\n      }, this);\n      if (isPopup) {\n        Object.assign(options, {\n          yaxis : {\n            isPopup   : true,\n            zoomRange : this.getZoomYAxis() ? [null, null] : false\n          },\n          xaxis : {\n            zoomRange : [null, null],\n            panRange  : [null, null]\n          }\n        });\n      }\n      if (this.getTooltip()) {\n        options.grid.hoverable = true;\n        options.grid.clickable = true;\n      }\n\n      if (!isPopup && !this.getPreviewlabels()) {\n        Object.assign(options, {xaxes: [ {ticks: 0, mode: options.xaxes[0].mode } ]});\n        if (options.yaxes.length === 0) {\n          options.yaxes[0] = {};\n        }\n        options.yaxes.forEach(function(val) {\n          Object.assign(val, {ticks:0, axisLabel: null});\n        }, this);\n      }\n\n      // plot diagram initially with empty values\n      const diagram = isPopup ? $('#' + this.getPath() + '_big') : $('#' + this.getPath() + ' .actor div');\n      diagram.empty();\n      const plot = $.plot(diagram, [], options);\n      if (isPopup) {\n        this.debug('popup plot generated');\n        this.popupplot = plot;\n      } else {\n        this.debug('plot generated');\n        this.plot = plot;\n      }\n      this.plotted = true;\n\n      const that = this;\n      diagram.bind('plotpan', function(event, plot) {\n        that._debouncedLoadDiagramData(plot, isPopup, false);\n      }).bind('plotzoom', function() {\n        that.loadDiagramData(plot, isPopup, false);\n      }).bind('touchended', function() {\n        that.loadDiagramData(plot, isPopup, false);\n      }).bind('tap', function() {\n        const self = this;\n        const container = $(self).closest('.widget_container')[0];\n        if (!isPopup && container !== undefined) {\n          const actor = $(self).closest('.actor')[0];\n          const path = container.id;\n          if (actor !== undefined && path.length > 0) {\n            that.action();\n          }\n        }\n      });\n\n      if (!isPopup) {\n        // disable touch plugin in non-popup\n        plot.getPlaceholder().unbind('touchstart').unbind('touchmove').unbind('touchend');\n      }\n\n      this.loadDiagramData(plot, isPopup, false);\n    },\n\n    getSeriesSettings: function(xAxis, isInteractive) {\n      const series = {\n        hour: {res: '60', start: 'hour', end: 'now'},\n        day: {res: '300', start: 'day', end: 'now'},\n        fullday: {res: '300', start: 'day', end: 'midnight+24hour'},\n        week: {res: '1800', start: 'week', end: 'now'},\n        month: {res: '21600', start: 'month', end: 'now'},\n        year: {res: '432000', start: 'year', end: 'now'}\n      };\n\n      const ret = {\n        start: null,\n        end: null,\n        res: null\n      };\n      if (this.getSeries() === 'custom') {\n        // initial load, take parameters from custom configuration\n        ret.start = this.getSeriesStart();\n        ret.end = this.getSeriesEnd();\n        ret.res = this.getSeriesResolution();\n      } else {\n        const selectedSeries = series[this.getSeries()];\n        if (!selectedSeries) {\n          return null;\n        }\n\n        // initial load, take parameters from configuration\n        ret.start = 'end-' + this.getPeriod() + selectedSeries.start;\n        ret.end = selectedSeries.end;\n        ret.res = this.getSeriesResolution() ? this.getSeriesResolution() : selectedSeries.res;\n      }\n\n      if (xAxis.datamin && xAxis.datamax && isInteractive) {\n        ret.start = (xAxis.min / 1000).toFixed(0);\n      }\n      return ret;\n    },\n\n    loadDiagramData: function(plot, isInteractive, forceReload) {\n      if (!plot) {\n        return;\n      }\n      const series = this.getSeriesSettings(plot.getAxes().xaxis, isInteractive);\n      if (!series) {\n        return;\n      }\n\n      // init\n      let loadedData = [];\n      let tsloaded = 0;\n      let tsSuccessful = 0;\n      // get all time series data\n      this.getContent().ts.forEach(function(ts, index) {\n        const res = isNaN(ts.resol) ? series.res : ts.resol;\n        const forceNowDatapoint = this.getForceNowDatapoint();\n        const refresh = this.getRefresh() ? this.getRefresh() : res;\n\n        cv.plugins.diagram.AbstractDiagram.lookupTsCache(ts, series.start, series.end, res, forceNowDatapoint, refresh, forceReload, function(tsdata) {\n          tsloaded++;\n          if (tsdata !== null) {\n            tsSuccessful++;\n\n            // store the data for diagram plotting\n            loadedData[index] = {\n              label: ts.label,\n              color: ts.color,\n              data: tsdata,\n              yaxis: parseInt(ts.axisIndex),\n              bars: { show: ts.style === 'bars', fill: ts.fill, barWidth: parseInt(ts.barWidth), align: ts.align },\n              lines: { show: ts.style === 'lines', steps: ts.steps, fill: ts.fill, zero: false },\n              points: { show: ts.style === 'points', fill: ts.fill }\n            };\n          }\n\n          // if loading has finished, i.e. all time series have been retrieved,\n          // go on and plot the diagram\n          if (tsloaded === this.getContent().tsnum) {\n            let fulldata;\n            // If all time series were successfully loaded, no extra action is needed.\n            // Otherwise we need to reduce the array to the loaded data.\n            if (tsSuccessful === tsloaded) {\n              fulldata = loadedData;\n            } else {\n              fulldata = [];\n              let loadedIndex = -1;\n              for (let j = 0; j < tsSuccessful; j++) {\n                for (let k = loadedIndex + 1; k < loadedData.length; k++) {\n                  if (loadedData[k] !== null) {\n                    fulldata[j] = loadedData[k];\n                    loadedIndex = k;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // plot\n            plot.setData(fulldata);\n            plot.setupGrid();\n            plot.draw();\n\n            loadedData = [];\n          }\n        }.bind(this));\n      }, this);\n    }\n  },\n\n  /*\n  ******************************************************\n    DESTRUCTOR\n  ******************************************************\n  */\n  destruct: function() {\n    if (this._timerPopup) {\n      this._disposeObjects('_timerPopup');\n    }\n  },\n\n  defer: function() {\n    const loader = cv.util.ScriptLoader.getInstance();\n    loader.addScripts([\n      'plugins/diagram/dep/flot/jquery.flot.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.touch.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.canvas.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.resize.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.time.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.axislabels.js',\n      'plugins/diagram/dep/flot/jquery.flot.tooltip.min.js',\n      'plugins/diagram/dep/flot/jquery.flot.navigate.min.js'\n    ], [0]);\n  }\n});\n"
  ]
}