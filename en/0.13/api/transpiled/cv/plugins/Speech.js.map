{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "include",
    "cv",
    "ui",
    "common",
    "Update",
    "construct",
    "props",
    "_initOnCreate",
    "constructor",
    "call",
    "set",
    "__lastSpeech",
    "statics",
    "parse",
    "element",
    "path",
    "window",
    "speechSynthesis",
    "log",
    "Logger",
    "warn",
    "address",
    "parser",
    "pure",
    "WidgetParser",
    "makeAddressList",
    "data",
    "Model",
    "getInstance",
    "setWidgetData",
    "language",
    "getAttribute",
    "toLowerCase",
    "mapping",
    "repeatTimeout",
    "parseInt",
    "$$type",
    "$$initOnCacheLoad",
    "properties",
    "check",
    "init",
    "parentWidget",
    "members",
    "getDomString",
    "undefined",
    "_processIncomingValue",
    "value",
    "applyTransform",
    "applyMapping",
    "handleUpdate",
    "text",
    "io",
    "BackendConnections",
    "getClient",
    "getDataReceived",
    "time",
    "Date",
    "now",
    "debug",
    "length",
    "substring",
    "getRepeatTimeout",
    "Math",
    "round",
    "notifications",
    "SpeechHandler",
    "say",
    "getLanguage",
    "defer",
    "addHandler",
    "plugins",
    "Speech",
    "structure",
    "WidgetFactory",
    "registerClass"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/plugins/Speech.js"
  ],
  "sourcesContent": [
    "/* Speech.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * Use the Web Speech API (https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API)\n * to make text-to-speech service available. This plugin listens to a address and forwards the\n * incoming data to the browser TTS engine (if the browser supports it)\n *\n * <h4>Simple example</h4>\n * <pre class=\"sunlight-highlight-xml\">\n * &lt;speech lang=&quot;en&quot;&gt;\n *  &lt;address transform=&quot;OH:string&quot; mode=&quot;read&quot;&gt;Speak&lt;/address&gt;\n * &lt;/speech&gt;\n * </pre>\n *\n * <h4>Example preventing repetition within a timeout and use mapping</h4>\n * <pre class=\"sunlight-highlight-xml\">\n * ...\n * &lt;meta&gt;\n *  &lt;plugins&gt;\n *    &lt;plugin name=&quot;speech&quot; /&gt;\n *  &lt;/plugins&gt;\n *  &lt;mappings&gt;\n *    &lt;mapping name=&quot;speak&quot;&gt;\n *      &lt;entry value=&quot;0&quot;&gt;Hello, welcome home&lt;/entry&gt;\n *      &lt;entry value=&quot;1&quot;&gt;Please close all windows&lt;/entry&gt;\n *      &lt;entry value=&quot;2&quot;&gt;Please close all doors&lt;/entry&gt;\n *    &lt;/mapping&gt;\n *  &lt;/mappings&gt;\n * &lt;/meta&gt;\n * ...\n * &lt;speech lang=&quot;en&quot; repeat-timout=&quot;300&quot; mapping=&quot;speak&quot;&gt;\n *  &lt;address transform=&quot;DPT:5.010&quot; mode=&quot;read&quot;&gt;Speak&lt;/address&gt;\n * &lt;/speech&gt;\n * </pre>\n *\n * @author Tobias BrÃ¤utigam\n * @since 0.10.0\n *\n */\nqx.Class.define('cv.plugins.Speech', {\n  extend: qx.core.Object,\n  include: cv.ui.common.Update,\n\n  /*\n   ******************************************************\n   CONSTRUCTOR\n   ******************************************************\n   */\n  construct(props) {\n    this._initOnCreate = true;\n    super();\n    this.set(props);\n    this.__lastSpeech = {};\n  },\n\n  /*\n   ******************************************************\n   STATICS\n   ******************************************************\n   */\n  statics: {\n    parse(element, path) {\n      if (!window.speechSynthesis) {\n        qx.log.Logger.warn(this, 'this browser does not support the Web Speech API');\n\n        return null;\n      }\n\n      const address = cv.parser.pure.WidgetParser.makeAddressList(element, path);\n\n      return cv.data.Model.getInstance().setWidgetData(path, {\n        path: path,\n        language: element.getAttribute('lang') ? element.getAttribute('lang').toLowerCase() : '',\n        address: address,\n        mapping: element.getAttribute('mapping') || '',\n        repeatTimeout: element.getAttribute('repeat-timeout') ? parseInt(element.getAttribute('repeat-timeout')) : -1,\n        $$type: 'speech',\n        // this widget needs to be initialized when the cache is used, otherwise it wont be available\n        $$initOnCacheLoad: true\n      });\n    }\n  },\n\n  /*\n   ******************************************************\n   PROPERTIES\n   ******************************************************\n   */\n  properties: {\n    path: { check: 'String' },\n    $$type: { check: 'String' },\n    $$initOnCacheLoad: { check: 'Boolean' },\n    language: { check: 'String' },\n    mapping: { check: 'String', init: '' },\n    repeatTimeout: { check: 'Number', init: -1 },\n    parentWidget: {\n      check: 'cv.ui.structure.pure.AbstractBasicWidget',\n      init: null\n    }\n  },\n\n  /*\n   ******************************************************\n   MEMBERS\n   ******************************************************\n   */\n  members: {\n    __lastSpeech: null,\n\n    getDomString() {\n      return undefined;\n    },\n\n    _processIncomingValue(address, data) {\n      // #1: transform the raw value to a JavaScript type\n      const value = this.applyTransform(address, data);\n\n      // #2: map it to a value the user wants to see\n      return this.applyMapping(value);\n    },\n\n    handleUpdate(text, address) {\n      if (!cv.io.BackendConnections.getClient().getDataReceived()) {\n        // first call -> skipping\n        this.__lastSpeech[address] = {\n          text: text,\n          time: Date.now()\n        };\n\n        this.debug('skipping initial TTS for ' + text);\n        return;\n      }\n\n      if (!text || text.length === 0) {\n        // nothing to say\n        this.debug('no text to speech given');\n        return;\n      }\n\n      if (typeof text === 'string' && text.substring(0, 1) === '!') {\n        // override repeatTimeout, force saying this\n        text = text.substring(1);\n      } else if (this.getRepeatTimeout() >= 0) {\n        // do not repeat (within timeout when this.repeatTimeout > 0)\n        if (\n          this.__lastSpeech[address] &&\n          this.__lastSpeech[address].text === text &&\n          (this.getRepeatTimeout() === 0 ||\n            this.getRepeatTimeout() >= Math.round((Date.now() - this.__lastSpeech[address].time) / 1000))\n        ) {\n          // update time\n          this.__lastSpeech[address].time = Date.now();\n          // do not repeat\n          this.debug('skipping TTS because of repetition ' + text);\n          return;\n        }\n      }\n      this.debug(\n        'changing lastSpeech from \\'%s\\' to \\'%s\\'',\n        this.__lastSpeech[address] ? this.__lastSpeech[address].text : '',\n        text\n      );\n\n      this.__lastSpeech[address] = {\n        text: text,\n        time: Date.now()\n      };\n\n      cv.core.notifications.SpeechHandler.getInstance().say(text, this.getLanguage());\n    }\n  },\n\n  defer(statics) {\n    // register the parser\n    cv.parser.pure.WidgetParser.addHandler('speech', cv.plugins.Speech);\n    cv.ui.structure.WidgetFactory.registerClass('speech', statics);\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}