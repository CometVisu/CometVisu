{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "io",
    "AbstractClient",
    "implement",
    "IClient",
    "construct",
    "constructor",
    "call",
    "addresses",
    "__persistedTargets",
    "theme",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onPageChange",
    "properties",
    "connected",
    "check",
    "init",
    "server",
    "nullable",
    "members",
    "backendName",
    "implementedAddresses",
    "ev",
    "page",
    "getData",
    "data",
    "getAttribute",
    "Model",
    "getInstance",
    "updateFrom",
    "getType",
    "receive",
    "json",
    "login",
    "loginOnly",
    "credentials",
    "callback",
    "context",
    "filters",
    "core",
    "Environment",
    "get",
    "value",
    "name",
    "localStorage",
    "getItem",
    "func",
    "error",
    "addSubscription",
    "address",
    "includes",
    "push",
    "write",
    "options",
    "parts",
    "split",
    "target",
    "shift",
    "backend",
    "BackendConnections",
    "getClient",
    "restart",
    "warn",
    "url",
    "window",
    "location",
    "reload",
    "URL",
    "href",
    "searchParams",
    "set",
    "replace",
    "toString",
    "action",
    "Application",
    "structureController",
    "scrollToPage",
    "_applyTheme",
    "length",
    "rest",
    "Client",
    "getBaseUrl",
    "origin",
    "xhr",
    "request",
    "Xhr",
    "send",
    "onUpdate",
    "setItem",
    "document",
    "documentElement",
    "setAttribute",
    "stop",
    "getResourcePath",
    "params",
    "getLastError",
    "getBackend",
    "Map",
    "authorize",
    "req",
    "terminate",
    "update",
    "record",
    "type",
    "showError",
    "args",
    "setInitialAddresses",
    "hasCustomChartsDataProcessor",
    "processChartsData",
    "hasProvider",
    "getProviderUrl",
    "getProviderData",
    "format",
    "map",
    "label",
    "insertText",
    "kind",
    "monaco",
    "languages",
    "CompletionItemKind",
    "Value",
    "Promise",
    "resolve",
    "getProviderConvertFunction",
    "System"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/System.js"
  ],
  "sourcesContent": [
    "/* System.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * A backend client to handle internal system states.\n * With this backend you get access to e.g. backend connection states, currently shown page in the UI and can\n * trigger some things like:\n * - Restart a backend connection\n * - navigate to another page\n * - reload the browser\n * - trigger HTTP requests\n */\nqx.Class.define('cv.io.System', {\n  extend: cv.io.AbstractClient,\n  implement: cv.io.IClient,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super();\n    this.addresses = [];\n    this.__persistedTargets = {\n      theme: '_applyTheme'\n    };\n    qx.event.message.Bus.subscribe('cv.ui.structure.tile.currentPage', this._onPageChange, this);\n  },\n\n  /*\n  ***********************************************\n   PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    connected: {\n      check: 'Boolean',\n      init: true,\n      event: 'changeConnected'\n    },\n\n    /**\n     * The server the client is currently speaking to\n     */\n    server: {\n      check: 'String',\n      nullable: true,\n      event: 'changedServer'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    backendName: 'system',\n    addresses: null,\n    implementedAddresses: null,\n    __persistedTargets: null,\n\n    _onPageChange(ev) {\n      const page = ev.getData();\n      const data = {};\n      data['nav:current-page'] = page.getAttribute('id');\n      cv.data.Model.getInstance().updateFrom('system', data);\n    },\n\n    getType() {\n      return this.backendName;\n    },\n\n    receive(json) {},\n\n    login(loginOnly, credentials, callback, context) {\n      if (callback) {\n        callback.call(context);\n      }\n    },\n\n    subscribe(addresses, filters) {\n      this.addresses = addresses ? addresses : [];\n      if (qx.core.Environment.get('html.storage.local')) {\n        let value;\n        for (const name in this.__persistedTargets) {\n          value = localStorage.getItem('system:' + name);\n          if (value) {\n            const func = this[this.__persistedTargets[name]];\n            if (typeof func === 'function') {\n              func(value);\n            } else {\n              this.error(name + 'is no function');\n            }\n          }\n        }\n      }\n    },\n\n    addSubscription(address) {\n      if (!this.addresses.includes(address)) {\n        this.addresses.push(address);\n      }\n    },\n\n    write(address, value, options) {\n      if (address) {\n        const parts = address.split(':');\n        const target = parts.shift();\n        if (target === 'backend') {\n          const name = parts.shift();\n          const backend = name === 'system' ? this : cv.io.BackendConnections.getClient(name);\n          if (backend) {\n            switch (value) {\n              case 'restart':\n                backend.restart(true);\n                break;\n\n              default:\n                this.warn('unhandled backend action:', value);\n            }\n          }\n        } else if (target === 'browser') {\n          let url;\n          switch (value) {\n            case 'reload':\n              window.location.reload();\n              break;\n\n            case 'forced-reload':\n              url = new URL(window.location.href);\n              url.searchParams.set('forceReload', 'true');\n              window.location.replace(url.toString());\n              break;\n\n            default:\n              this.warn('unhandled browser action:', value);\n          }\n        } else if (target === 'nav') {\n          const action = parts.shift();\n          switch (action) {\n            case 'current-page':\n              cv.Application.structureController.scrollToPage(value);\n              break;\n          }\n        } else if (target === 'theme') {\n          this._applyTheme(value);\n        } else if (target === 'http' || target === 'https') {\n          // send HTTP request, ignore the answer\n          if (parts.length >= 2 && parts[0] === 'proxy') {\n            const url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n\n            url.searchParams.set('url', target + ':' + parts[1]);\n            address = url.toString();\n          }\n          const xhr = new qx.io.request.Xhr(address);\n          xhr.send();\n        } else if (target === 'state' || target === 'notification') {\n          // just write the value to the states to update Listeners\n          cv.data.Model.getInstance().onUpdate(address, value, 'system');\n        }\n\n        if (qx.core.Environment.get('html.storage.local') && target in this.__persistedTargets) {\n          localStorage.setItem('system:' + target, value);\n        }\n      }\n    },\n\n    _applyTheme(theme) {\n      document.documentElement.setAttribute('data-theme', theme);\n      cv.data.Model.getInstance().onUpdate('theme', theme, 'system');\n    },\n\n    restart() {},\n\n    stop() {},\n\n    getResourcePath(name, params) {\n      if (name === 'charts') {\n        return null;\n      }\n      return name;\n    },\n\n    getLastError() {\n      return null;\n    },\n\n    getBackend() {\n      return new Map();\n    },\n\n    authorize(req) {},\n\n    terminate() {},\n\n    update(json) {},\n    record(type, data) {},\n    showError(type, message, args) {},\n\n    // not used / needed in this client\n    setInitialAddresses(addresses) {},\n\n    hasCustomChartsDataProcessor() {\n      return false;\n    },\n    processChartsData(data) {\n      return data;\n    },\n    hasProvider(name) {\n      return false;\n    },\n    getProviderUrl(name) {\n      return null;\n    },\n\n    getProviderData(name, format) {\n      if (name === 'addresses') {\n        let data = null;\n        if (format === 'monaco') {\n          data = this.implementedAddresses.map(name => ({\n            label: name,\n            insertText: name,\n            kind: window.monaco.languages.CompletionItemKind.Value\n          }));\n        } else {\n          data = this.implementedAddresses.map(name => ({\n            label: name,\n            value: name\n          }));\n        }\n        return Promise.resolve(data);\n      }\n      return null;\n    },\n\n    getProviderConvertFunction(name, format) {\n      return null;\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}