{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "io",
    "AbstractClient",
    "implement",
    "IClient",
    "construct",
    "constructor",
    "call",
    "addresses",
    "__persistedTargets",
    "theme",
    "event",
    "message",
    "Bus",
    "subscribe",
    "_onPageChange",
    "properties",
    "connected",
    "refine",
    "init",
    "members",
    "backendName",
    "implementedAddresses",
    "ev",
    "page",
    "getData",
    "data",
    "getAttribute",
    "Model",
    "getInstance",
    "updateFrom",
    "getType",
    "receive",
    "json",
    "login",
    "loginOnly",
    "credentials",
    "callback",
    "context",
    "filters",
    "core",
    "Environment",
    "get",
    "value",
    "name",
    "localStorage",
    "getItem",
    "func",
    "error",
    "addSubscription",
    "address",
    "includes",
    "push",
    "write",
    "options",
    "parts",
    "split",
    "target",
    "shift",
    "backend",
    "BackendConnections",
    "getClient",
    "restart",
    "warn",
    "url",
    "window",
    "location",
    "reload",
    "URL",
    "href",
    "searchParams",
    "set",
    "replace",
    "toString",
    "action",
    "Application",
    "structureController",
    "scrollToPage",
    "_applyTheme",
    "length",
    "rest",
    "Client",
    "getBaseUrl",
    "origin",
    "xhr",
    "request",
    "Xhr",
    "send",
    "onUpdate",
    "setItem",
    "document",
    "documentElement",
    "setAttribute",
    "stop",
    "getResourcePath",
    "params",
    "getLastError",
    "getBackend",
    "Map",
    "authorize",
    "req",
    "canAuthorize",
    "terminate",
    "update",
    "record",
    "type",
    "showError",
    "args",
    "setInitialAddresses",
    "hasCustomChartsDataProcessor",
    "processChartsData",
    "hasProvider",
    "getProviderUrl",
    "getProviderData",
    "format",
    "map",
    "label",
    "insertText",
    "kind",
    "monaco",
    "languages",
    "CompletionItemKind",
    "Value",
    "Promise",
    "resolve",
    "getProviderConvertFunction",
    "System"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/System.js"
  ],
  "sourcesContent": [
    "/* System.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * A backend client to handle internal system states.\n * With this backend you get access to e.g. backend connection states, currently shown page in the UI and can\n * trigger some things like:\n * - Restart a backend connection\n * - navigate to another page\n * - reload the browser\n * - trigger HTTP requests\n */\nqx.Class.define('cv.io.System', {\n  extend: cv.io.AbstractClient,\n  implement: cv.io.IClient,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super();\n    this.addresses = [];\n    this.__persistedTargets = {\n      theme: '_applyTheme'\n    };\n    qx.event.message.Bus.subscribe('cv.ui.structure.tile.currentPage', this._onPageChange, this);\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    // system backend is always connected\n    connected: {\n      refine: true,\n      init: true\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    backendName: 'system',\n    addresses: null,\n    implementedAddresses: null,\n    __persistedTargets: null,\n\n    _onPageChange(ev) {\n      const page = ev.getData();\n      const data = {};\n      data['nav:current-page'] = page.getAttribute('id');\n      cv.data.Model.getInstance().updateFrom('system', data);\n    },\n\n    getType() {\n      return this.backendName;\n    },\n\n    receive(json) {},\n\n    login(loginOnly, credentials, callback, context) {\n      if (callback) {\n        callback.call(context);\n      }\n    },\n\n    subscribe(addresses, filters) {\n      this.addresses = addresses ? addresses : [];\n      if (qx.core.Environment.get('html.storage.local')) {\n        let value;\n        for (const name in this.__persistedTargets) {\n          value = localStorage.getItem('system:' + name);\n          if (value) {\n            const func = this[this.__persistedTargets[name]];\n            if (typeof func === 'function') {\n              func(value);\n            } else {\n              this.error(name + 'is no function');\n            }\n          }\n        }\n      }\n    },\n\n    addSubscription(address) {\n      if (!this.addresses.includes(address)) {\n        this.addresses.push(address);\n      }\n    },\n\n    write(address, value, options) {\n      if (address) {\n        const parts = address.split(':');\n        const target = parts.shift();\n        if (target === 'backend') {\n          const name = parts.shift();\n          const backend = name === 'system' ? this : cv.io.BackendConnections.getClient(name);\n          if (backend) {\n            switch (value) {\n              case 'restart':\n                backend.restart(true);\n                break;\n\n              default:\n                this.warn('unhandled backend action:', value);\n            }\n          }\n        } else if (target === 'browser') {\n          let url;\n          switch (value) {\n            case 'reload':\n              window.location.reload();\n              break;\n\n            case 'forced-reload':\n              url = new URL(window.location.href);\n              url.searchParams.set('forceReload', 'true');\n              window.location.replace(url.toString());\n              break;\n\n            default:\n              this.warn('unhandled browser action:', value);\n          }\n        } else if (target === 'nav') {\n          const action = parts.shift();\n          switch (action) {\n            case 'current-page':\n              cv.Application.structureController.scrollToPage(value);\n              break;\n          }\n        } else if (target === 'theme') {\n          this._applyTheme(value);\n        } else if (target === 'http' || target === 'https') {\n          // send HTTP request, ignore the answer\n          if (parts.length >= 2 && parts[0] === 'proxy') {\n            const url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n\n            url.searchParams.set('url', target + ':' + parts[1]);\n            address = url.toString();\n          }\n          const xhr = new qx.io.request.Xhr(address);\n          xhr.send();\n        } else if (target === 'state' || target === 'notification') {\n          // just write the value to the states to update Listeners\n          cv.data.Model.getInstance().onUpdate(address, value, 'system');\n        }\n\n        if (qx.core.Environment.get('html.storage.local') && target in this.__persistedTargets) {\n          localStorage.setItem('system:' + target, value);\n        }\n      }\n    },\n\n    _applyTheme(theme) {\n      document.documentElement.setAttribute('data-theme', theme);\n      cv.data.Model.getInstance().onUpdate('theme', theme, 'system');\n    },\n\n    restart() {},\n\n    stop() {},\n\n    getResourcePath(name, params) {\n      if (name === 'charts') {\n        return null;\n      }\n      return name;\n    },\n\n    getLastError() {\n      return null;\n    },\n\n    getBackend() {\n      return new Map();\n    },\n\n    authorize(req) {},\n    canAuthorize() {\n      return false;\n    },\n\n    terminate() {},\n\n    update(json) {},\n    record(type, data) {},\n    showError(type, message, args) {},\n\n    // not used / needed in this client\n    setInitialAddresses(addresses) {},\n\n    hasCustomChartsDataProcessor() {\n      return false;\n    },\n    processChartsData(data) {\n      return data;\n    },\n    hasProvider(name) {\n      return false;\n    },\n    getProviderUrl(name) {\n      return null;\n    },\n\n    getProviderData(name, format) {\n      if (name === 'addresses') {\n        let data = null;\n        if (format === 'monaco') {\n          data = this.implementedAddresses.map(name => ({\n            label: name,\n            insertText: name,\n            kind: window.monaco.languages.CompletionItemKind.Value\n          }));\n        } else {\n          data = this.implementedAddresses.map(name => ({\n            label: name,\n            value: name\n          }));\n        }\n        return Promise.resolve(data);\n      }\n      return null;\n    },\n\n    getProviderConvertFunction(name, format) {\n      return null;\n    }\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}