{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "implement",
    "cv",
    "io",
    "listmodel",
    "IListModel",
    "construct",
    "initModel",
    "data",
    "Array",
    "statics",
    "REQUIRES",
    "properties",
    "model",
    "check",
    "deferredInit",
    "device",
    "init",
    "apply",
    "max",
    "transform",
    "members",
    "__calllistUri",
    "_parseInt",
    "value",
    "parseInt",
    "_applyDevice",
    "_init",
    "url",
    "getDevice",
    "debug",
    "Fetch",
    "fetch",
    "response",
    "notifications",
    "Router",
    "dispatchMessage",
    "title",
    "locale",
    "Manager",
    "tr",
    "severity",
    "message",
    "JSON",
    "stringify",
    "status",
    "statusText",
    "refresh",
    "getModel",
    "removeAll",
    "getMax",
    "window",
    "DOMParser",
    "parseFromString",
    "itemList",
    "getElementsByTagName",
    "item",
    "childrenList",
    "children",
    "entry",
    "child",
    "nodeName",
    "textContent",
    "push",
    "defer",
    "clazz",
    "Registry",
    "register",
    "FritzCallList"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/listmodel/FritzCallList.js"
  ],
  "sourcesContent": [
    "/**\n * Data retrieval for FritzBox calllists retrieves via TR64 (using the same PHP backend as the TR64 plugin).\n */\nqx.Class.define('cv.io.listmodel.FritzCallList', {\n  extend: qx.core.Object,\n  implement: cv.io.listmodel.IListModel,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct() {\n    super();\n    this.initModel(new qx.data.Array());\n  },\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    REQUIRES: ['php']\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    model: {\n      check: 'qx.data.Array',\n      deferredInit: true\n    },\n\n    device: {\n      check: 'String',\n      init: '',\n      apply: '_applyDevice'\n    },\n\n    max: {\n      check: 'Number',\n      init: 0,\n      transform: '_parseInt'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    __calllistUri: null,\n\n    _parseInt(value) {\n      if (typeof value === 'string') {\n        return parseInt(value);\n      }\n      return value;\n    },\n\n    _applyDevice() {\n      // reset calllistUrl when device has changed\n      this.__calllistUri = null;\n    },\n\n    async _init() {\n      const url =\n        'resource/plugins/tr064/soap.php?device=' +\n        this.getDevice() +\n        '&location=upnp/control/x_contact&uri=urn:dslforum-org:service:X_AVM-DE_OnTel:1&fn=GetCallList';\n      this.debug('requesting soap url');\n\n      try {\n        const response = await cv.io.Fetch.fetch(url);\n        if (response) {\n          if (typeof response === 'string') {\n            this.__calllistUri = response;\n          } else {\n            cv.core.notifications.Router.dispatchMessage('cv.tr064.error', {\n              title: qx.locale.Manager.tr('TR-064 communication response error'),\n              severity: 'urgent',\n              message: qx.locale.Manager.tr('Reading URL \"%1\" failed with content: \"%2\"', url, JSON.stringify(response))\n            });\n\n            this.__calllistUri = '<fail>';\n          }\n        }\n      } catch (e) {\n        // else:\n        cv.core.notifications.Router.dispatchMessage('cv.tr064.error', {\n          title: qx.locale.Manager.tr('TR-064 communication error'),\n          severity: 'urgent',\n          message: qx.locale.Manager.tr(\n            'Reading URL \"%1\" failed with status \"%2\": \"%2\"',\n            e.url,\n            e.status,\n            e.statusText\n          )\n        });\n\n        this.__calllistUri = '<fail>';\n      }\n    },\n\n    async refresh() {\n      if (!this.__calllistUri) {\n        await this._init();\n      }\n      const model = this.getModel();\n      model.removeAll();\n      if (this.__calllistUri === '<fail>') {\n        return; // this problem won't fix anymore during this instance\n      }\n\n      const url =\n        'resource/plugins/tr064/proxy.php?device=' +\n        this.getDevice() +\n        '&uri=' +\n        this.__calllistUri +\n        '%26max=' +\n        this.getMax();\n      try {\n        const response = await cv.io.Fetch.fetch(url);\n        if (response) {\n          const data = new window.DOMParser().parseFromString(response, 'text/xml');\n          const itemList = data.getElementsByTagName('Call');\n\n          for (let item of itemList) {\n            const childrenList = item.children;\n            const entry = {};\n            for (let child of childrenList) {\n              entry[child.nodeName] = child.textContent;\n            }\n            model.push(entry);\n          }\n        }\n      } catch (e) {\n          if (e.status === 404) {\n            // refresh session id\n            await this._init();\n            await this.refresh();\n          } else {\n            cv.core.notifications.Router.dispatchMessage('cv.tr064.error', {\n              title: qx.locale.Manager.tr('TR-064 communication error'),\n              severity: 'urgent',\n              message: qx.locale.Manager.tr(\n                'Reading URL \"%1\" failed with status \"%2\": \"%2\"',\n                e.url,\n                e.status,\n                e.statusText\n              )\n            });\n\n            model.removeAll();\n          }\n        }\n    }\n  },\n\n  defer(clazz) {\n    cv.io.listmodel.Registry.register(clazz);\n  }\n});\n"
  ],
  "mappings": "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"
}