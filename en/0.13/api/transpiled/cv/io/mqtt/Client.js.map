{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "cv",
    "io",
    "AbstractClient",
    "implement",
    "IClient",
    "construct",
    "type",
    "backendUrl",
    "constructor",
    "call",
    "initialAddresses",
    "_type",
    "_backendUrl",
    "URL",
    "document",
    "replace",
    "__groups",
    "__memberLookup",
    "properties",
    "connected",
    "check",
    "init",
    "event",
    "server",
    "nullable",
    "members",
    "_client",
    "getBackend",
    "getType",
    "hasProvider",
    "name",
    "getProviderUrl",
    "getProviderConvertFunction",
    "getProviderData",
    "format",
    "setInitialAddresses",
    "addresses",
    "subscribe",
    "filters",
    "_this",
    "forEach",
    "value",
    "login",
    "loginOnly",
    "credentials",
    "callback",
    "context",
    "self",
    "onConnect",
    "param",
    "setConnected",
    "onFailure",
    "n",
    "core",
    "notifications",
    "Router",
    "getInstance",
    "dispatchMessage",
    "title",
    "locale",
    "Manager",
    "tr",
    "message",
    "errorMessage",
    "errorCode",
    "severity",
    "unique",
    "deletable",
    "options",
    "reconnect",
    "timeout",
    "onSuccess",
    "username",
    "userName",
    "password",
    "Paho",
    "MQTT",
    "Client",
    "toString",
    "Math",
    "random",
    "substr",
    "e",
    "error",
    "onConnectionLost",
    "responseObject",
    "warn",
    "onMessageArrived",
    "update",
    "topic",
    "payloadString",
    "connect",
    "authorize",
    "req",
    "getResourcePath",
    "params",
    "hasCustomChartsDataProcessor",
    "processChartsData",
    "data",
    "write",
    "address",
    "isConnected",
    "Message",
    "destinationName",
    "qos",
    "undefined",
    "retain",
    "retained",
    "send",
    "getLastError",
    "restart",
    "full",
    "json",
    "record",
    "showError",
    "args",
    "terminate",
    "disconnect",
    "destruct",
    "mqtt"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/mqtt/Client.js"
  ],
  "sourcesContent": [
    "/* Client.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * MQTT client\n */\nqx.Class.define('cv.io.mqtt.Client', {\n  extend: cv.io.AbstractClient,\n  implement: cv.io.IClient,\n\n  /*\n  ***********************************************\n    CONSTRUCTOR\n  ***********************************************\n  */\n  construct(type, backendUrl) {\n    super();\n    this.initialAddresses = [];\n    this._type = type;\n    this._backendUrl = new URL(backendUrl || document.URL.replace(/.*:\\/\\/([^\\/:]*)(:[0-9]*)?\\/.*/, 'ws://$1:8083/'));\n\n    this.__groups = {};\n    this.__memberLookup = {};\n  },\n\n  /*\n  ***********************************************\n    PROPERTIES\n  ***********************************************\n  */\n  properties: {\n    connected: {\n      check: 'Boolean',\n      init: false,\n      event: 'changeConnected'\n    },\n\n    server: {\n      check: 'String',\n      nullable: true,\n      event: 'changedServer'\n    }\n  },\n\n  /*\n  ***********************************************\n    MEMBERS\n  ***********************************************\n  */\n  members: {\n    /*\n     * @var {Paho.MQTT.Client}\n     */\n    _client: null,\n    _type: null,\n\n    /**\n     * Returns the current backend configuration\n     * @return {Map}\n     */\n    getBackend() {\n      return {};\n    },\n\n    getType() {\n      return this._type;\n    },\n\n    /**\n     * Returns true, when the backend provides a special data provider for this kins of data\n     * @param name {String}\n     * @return {Boolean}\n     */\n    hasProvider(name) {\n      return false;\n    },\n\n    /**\n     * URL to the provided data\n     * @param name\n     * @return {String}\n     */\n    getProviderUrl(name) {\n      return null;\n    },\n\n    /**\n     * Mapping function the convert the data from the backend to a format the CometVisu data provider consumer can process.\n     * @param name {String}\n     */\n    getProviderConvertFunction(name) {\n      return null;\n    },\n\n    getProviderData: function (name, format) {\n      return null;\n    },\n\n    /**\n     * Set a subset of addresses the client should request initially (e.g. the ones one the start page).\n     * This can be used to increase the init state loading speed by sending an initial request with a smaller\n     * subset of addresses to the backend and send the rest later.\n     * @param addresses {Array}\n     */\n    setInitialAddresses(addresses) {},\n\n    /**\n     * Subscribe to the addresses in the parameter. The second parameter\n     * (filter) is optional\n     *\n     * @param addresses {Array?} addresses to subscribe to\n     * @param filters {Array?} Filters\n     *\n     */\n    subscribe(addresses, filters) {\n      addresses.forEach(value => this._client.subscribe(value));\n    },\n\n    /**\n     * This function starts the communication by a login and then runs the\n     * ongoing communication task\n     *\n     * @param loginOnly {Boolean} if true only login and backend configuration, no subscription\n     *                            to addresses (default: false)\n     * @param credentials {Map} map with \"username\" and \"password\" (optional)\n     * @param callback {Function} call this function when login is done\n     * @param context {Object} context for the callback (this)\n     *\n     */\n    login(loginOnly, credentials, callback, context) {\n      let self = this;\n\n      /**\n       * @param param\n       */\n      function onConnect(param) {\n        self.setConnected(true);\n        if (callback) {\n          callback.call(context);\n        }\n      }\n\n      /**\n       * @param param\n       */\n      function onFailure(param) {\n        self.setConnected(false);\n        let n = cv.core.notifications.Router.getInstance();\n        n.dispatchMessage(\n          'cv.client.connection',\n          {\n            title: 'MQTT: ' + qx.locale.Manager.tr('Connection error'),\n            message: param.errorMessage + '<br/>\\nCode: ' + param.errorCode,\n            severity: 'urgent',\n            unique: true,\n            deletable: false\n          },\n\n          'popup'\n        );\n      }\n\n      let options = {\n        reconnect: true,\n        timeout: 10,\n        onSuccess: onConnect,\n        onFailure: onFailure\n      };\n\n      if (this._backendUrl.username !== '') {\n        options.userName = this._backendUrl.username;\n      }\n      if (this._backendUrl.password !== '') {\n        options.password = this._backendUrl.password;\n      }\n\n      try {\n        this._client = new Paho.MQTT.Client(\n          this._backendUrl.toString(),\n          'CometVisu_' + Math.random().toString(16).substr(2, 8)\n        );\n      } catch (e) {\n        self.error('MQTT Client error:', e);\n        self.setConnected(false);\n        return;\n      }\n\n      this._client.onConnectionLost = function (responseObject) {\n        self.warn('Connection Lost: ' + responseObject.errorMessage, responseObject);\n\n        self.setConnected(false);\n      };\n\n      this._client.onMessageArrived = function (message) {\n        let update = {};\n        update[message.topic] = message.payloadString;\n        self.update(update);\n      };\n\n      try {\n        this._client.connect(options);\n      } catch (e) {\n        onFailure({\n          errorMessage: e.toString(),\n          errorCode: 'login -> _client.connect(' + this._backendUrl + ')'\n        });\n      }\n    },\n\n    /**\n     * Authorize a Request by adding the necessary headers.\n     * @param req {qx.io.request.Xhr}\n     */\n    authorize(req) {},\n\n    /**\n     * return the relative path to a resource on the currently used backend\n     *\n     * @param name {String} Name of the resource (e.g. login, read, write, rrd)\n     * @param params {Map?} optional data needed to generate the resource path\n     * @return {String|null} relative path to the resource, returns `null` when the backend does not provide that resource\n     */\n    getResourcePath(name, params) {},\n\n    /**\n     * This client provides an own processor for charts data\n     * @return {Boolean}\n     */\n    hasCustomChartsDataProcessor() {},\n\n    /**\n     * For custom backend charts data some processing might be done to convert it in a format the CometVisu can handle\n     * @param data {var}\n     */\n    processChartsData(data) {},\n\n    /**\n     * This function sends a value\n     * @param address {String} address to send the value to\n     * @param value {String} value to send\n     * @param options {Object} optional options, depending on backend\n     *\n     */\n    write(address, value, options) {\n      if (this.isConnected()) {\n        let message = new Paho.MQTT.Message(value.toString());\n        message.destinationName = address;\n        if (options.qos !== undefined) {\n          message.qos = options.qos;\n        }\n        if (options.retain !== undefined) {\n          message.retained = options.retain;\n        }\n        this._client.send(message);\n      }\n    },\n\n    /**\n     * Get the last recorded error\n     *\n     * @return {{code: (*|Integer), text: (*|String), response: (*|String|null), url: (*|String), time: number}|*}\n     */\n    getLastError() {},\n\n    /**\n     * Restart the connection\n     * @param full\n     */\n    restart(full) {},\n\n    /**\n     * Handle the incoming state updates. This method is not implemented by the client itself.\n     * It is injected by the project using the client.\n     * @param json\n     */\n    update(json) {},\n\n    /**\n     * Can be overridden to record client communication with backend\n     * @param type {String} type of event to record\n     * @param data {Object} data to record\n     */\n    record(type, data) {},\n\n    /**\n     * Can be overridden to provide an error handler for client errors\n     * @param type {Number} one of cv.io.Client.ERROR_CODES\n     * @param message {String} detailed error message\n     * @param args\n     */\n    showError(type, message, args) {},\n\n    terminate() {\n      if (this.isConnected()) {\n        this._client.disconnect();\n      }\n    },\n\n    /**\n     * Destructor\n     */\n    destruct() {\n      if (this.isConnected()) {\n        this._client.disconnect();\n      }\n      this._client = null;\n    }\n  }\n});\n"
  ],
  "mappings": ";;;;;;;;;;;;;;;;;;EAAAA,EAAE,CAACC,SAAS,CAACC,oBAAoB,CAACC,aAAa,CAAC;EAAhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EAEA;AACA;AACA;EACAH,EAAE,CAACI,KAAK,CAACC,MAAM,CAAC,mBAAmB,EAAE;IACnCC,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,cAAc;IAC5BC,SAAS,EAAEH,EAAE,CAACC,EAAE,CAACG,OAAO;IAExB;AACF;AACA;AACA;AACA;IACEC,SAAS,WAAAA,UAACC,IAAI,EAAEC,UAAU,EAAE;MAC1BP,EAAA,CAAAC,EAAA,CAAAC,cAAA,CAAAM,WAAA,CAAAC,IAAA;MACA,IAAI,CAACC,gBAAgB,GAAG,EAAE;MAC1B,IAAI,CAACC,KAAK,GAAGL,IAAI;MACjB,IAAI,CAACM,WAAW,GAAG,IAAIC,GAAG,CAACN,UAAU,IAAIO,QAAQ,CAACD,GAAG,CAACE,OAAO,CAAC,gCAAgC,EAAE,eAAe,CAAC,CAAC;MAEjH,IAAI,CAACC,SAAQ,GAAG,CAAC,CAAC;MAClB,IAAI,CAACC,SAAc,GAAG,CAAC,CAAC;IAC1B,CAAC;IAED;AACF;AACA;AACA;AACA;IACEC,UAAU,EAAE;MACVC,SAAS,EAAE;QACTC,KAAK,EAAE,SAAS;QAChBC,IAAI,EAAE,KAAK;QACXC,KAAK,EAAE;MACT,CAAC;MAEDC,MAAM,EAAE;QACNH,KAAK,EAAE,QAAQ;QACfI,QAAQ,EAAE,IAAI;QACdF,KAAK,EAAE;MACT;IACF,CAAC;IAED;AACF;AACA;AACA;AACA;IACEG,OAAO,EAAE;MACP;AACJ;AACA;MACIC,OAAO,EAAE,IAAI;MACbf,KAAK,EAAE,IAAI;MAEX;AACJ;AACA;AACA;MACIgB,UAAU,WAAAA,WAAA,EAAG;QACX,OAAO,CAAC,CAAC;MACX,CAAC;MAEDC,OAAO,WAAAA,QAAA,EAAG;QACR,OAAO,IAAI,CAACjB,KAAK;MACnB,CAAC;MAED;AACJ;AACA;AACA;AACA;MACIkB,WAAW,WAAAA,YAACC,IAAI,EAAE;QAChB,OAAO,KAAK;MACd,CAAC;MAED;AACJ;AACA;AACA;AACA;MACIC,cAAc,WAAAA,eAACD,IAAI,EAAE;QACnB,OAAO,IAAI;MACb,CAAC;MAED;AACJ;AACA;AACA;MACIE,0BAA0B,WAAAA,2BAACF,IAAI,EAAE;QAC/B,OAAO,IAAI;MACb,CAAC;MAEDG,eAAe,EAAE,SAAAA,gBAAUH,IAAI,EAAEI,MAAM,EAAE;QACvC,OAAO,IAAI;MACb,CAAC;MAED;AACJ;AACA;AACA;AACA;AACA;MACIC,mBAAmB,WAAAA,oBAACC,SAAS,EAAE,CAAC,CAAC;MAEjC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;MACIC,SAAS,WAAAA,UAACD,SAAS,EAAEE,OAAO,EAAE;QAAA,IAAAC,KAAA;QAC5BH,SAAS,CAACI,OAAO,CAAC,UAAAC,KAAK;UAAA,OAAIF,KAAI,CAACb,OAAO,CAACW,SAAS,CAACI,KAAK,CAAC;QAAA,EAAC;MAC3D,CAAC;MAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACIC,KAAK,WAAAA,MAACC,SAAS,EAAEC,WAAW,EAAEC,QAAQ,EAAEC,OAAO,EAAE;QAC/C,IAAIC,IAAI,GAAG,IAAI;;QAEf;AACN;AACA;QACM,SAASC,SAASA,CAACC,KAAK,EAAE;UACxBF,IAAI,CAACG,YAAY,CAAC,IAAI,CAAC;UACvB,IAAIL,QAAQ,EAAE;YACZA,QAAQ,CAACpC,IAAI,CAACqC,OAAO,CAAC;UACxB;QACF;;QAEA;AACN;AACA;QACM,SAASK,SAASA,CAACF,KAAK,EAAE;UACxBF,IAAI,CAACG,YAAY,CAAC,KAAK,CAAC;UACxB,IAAIE,CAAC,GAAGpD,EAAE,CAACqD,IAAI,CAACC,aAAa,CAACC,MAAM,CAACC,WAAW,EAAE;UAClDJ,CAAC,CAACK,eAAe,CACf,sBAAsB,EACtB;YACEC,KAAK,EAAE,QAAQ,GAAGjE,EAAE,CAACkE,MAAM,CAACC,OAAO,CAACC,EAAE,CAAC,kBAAkB,CAAC;YAC1DC,OAAO,EAAEb,KAAK,CAACc,YAAY,GAAG,eAAe,GAAGd,KAAK,CAACe,SAAS;YAC/DC,QAAQ,EAAE,QAAQ;YAClBC,MAAM,EAAE,IAAI;YACZC,SAAS,EAAE;UACb,CAAC,EAED,OAAO,CACR;QACH;QAEA,IAAIC,OAAO,GAAG;UACZC,SAAS,EAAE,IAAI;UACfC,OAAO,EAAE,EAAE;UACXC,SAAS,EAAEvB,SAAS;UACpBG,SAAS,EAAEA;QACb,CAAC;QAED,IAAI,IAAI,CAACvC,WAAW,CAAC4D,QAAQ,KAAK,EAAE,EAAE;UACpCJ,OAAO,CAACK,QAAQ,GAAG,IAAI,CAAC7D,WAAW,CAAC4D,QAAQ;QAC9C;QACA,IAAI,IAAI,CAAC5D,WAAW,CAAC8D,QAAQ,KAAK,EAAE,EAAE;UACpCN,OAAO,CAACM,QAAQ,GAAG,IAAI,CAAC9D,WAAW,CAAC8D,QAAQ;QAC9C;QAEA,IAAI;UACF,IAAI,CAAChD,OAAO,GAAG,IAAIiD,IAAI,CAACC,IAAI,CAACC,MAAM,CACjC,IAAI,CAACjE,WAAW,CAACkE,QAAQ,EAAE,EAC3B,YAAY,GAAGC,IAAI,CAACC,MAAM,EAAE,CAACF,QAAQ,CAAC,EAAE,CAAC,CAACG,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CACvD;QACH,CAAC,CAAC,OAAOC,CAAC,EAAE;UACVnC,IAAI,CAACoC,KAAK,CAAC,oBAAoB,EAAED,CAAC,CAAC;UACnCnC,IAAI,CAACG,YAAY,CAAC,KAAK,CAAC;UACxB;QACF;QAEA,IAAI,CAACxB,OAAO,CAAC0D,gBAAgB,GAAG,UAAUC,cAAc,EAAE;UACxDtC,IAAI,CAACuC,IAAI,CAAC,mBAAmB,GAAGD,cAAc,CAACtB,YAAY,EAAEsB,cAAc,CAAC;UAE5EtC,IAAI,CAACG,YAAY,CAAC,KAAK,CAAC;QAC1B,CAAC;QAED,IAAI,CAACxB,OAAO,CAAC6D,gBAAgB,GAAG,UAAUzB,OAAO,EAAE;UACjD,IAAI0B,MAAM,GAAG,CAAC,CAAC;UACfA,MAAM,CAAC1B,OAAO,CAAC2B,KAAK,CAAC,GAAG3B,OAAO,CAAC4B,aAAa;UAC7C3C,IAAI,CAACyC,MAAM,CAACA,MAAM,CAAC;QACrB,CAAC;QAED,IAAI;UACF,IAAI,CAAC9D,OAAO,CAACiE,OAAO,CAACvB,OAAO,CAAC;QAC/B,CAAC,CAAC,OAAOc,CAAC,EAAE;UACV/B,SAAS,CAAC;YACRY,YAAY,EAAEmB,CAAC,CAACJ,QAAQ,EAAE;YAC1Bd,SAAS,EAAE,2BAA2B,GAAG,IAAI,CAACpD,WAAW,GAAG;UAC9D,CAAC,CAAC;QACJ;MACF,CAAC;MAED;AACJ;AACA;AACA;MACIgF,SAAS,WAAAA,UAACC,GAAG,EAAE,CAAC,CAAC;MAEjB;AACJ;AACA;AACA;AACA;AACA;AACA;MACIC,eAAe,WAAAA,gBAAChE,IAAI,EAAEiE,MAAM,EAAE,CAAC,CAAC;MAEhC;AACJ;AACA;AACA;MACIC,4BAA4B,WAAAA,6BAAA,EAAG,CAAC,CAAC;MAEjC;AACJ;AACA;AACA;MACIC,iBAAiB,WAAAA,kBAACC,IAAI,EAAE,CAAC,CAAC;MAE1B;AACJ;AACA;AACA;AACA;AACA;AACA;MACIC,KAAK,WAAAA,MAACC,OAAO,EAAE3D,KAAK,EAAE2B,OAAO,EAAE;QAC7B,IAAI,IAAI,CAACiC,WAAW,EAAE,EAAE;UACtB,IAAIvC,OAAO,GAAG,IAAIa,IAAI,CAACC,IAAI,CAAC0B,OAAO,CAAC7D,KAAK,CAACqC,QAAQ,EAAE,CAAC;UACrDhB,OAAO,CAACyC,eAAe,GAAGH,OAAO;UACjC,IAAIhC,OAAO,CAACoC,GAAG,KAAKC,SAAS,EAAE;YAC7B3C,OAAO,CAAC0C,GAAG,GAAGpC,OAAO,CAACoC,GAAG;UAC3B;UACA,IAAIpC,OAAO,CAACsC,MAAM,KAAKD,SAAS,EAAE;YAChC3C,OAAO,CAAC6C,QAAQ,GAAGvC,OAAO,CAACsC,MAAM;UACnC;UACA,IAAI,CAAChF,OAAO,CAACkF,IAAI,CAAC9C,OAAO,CAAC;QAC5B;MACF,CAAC;MAED;AACJ;AACA;AACA;AACA;MACI+C,YAAY,WAAAA,aAAA,EAAG,CAAC,CAAC;MAEjB;AACJ;AACA;AACA;MACIC,OAAO,WAAAA,QAACC,IAAI,EAAE,CAAC,CAAC;MAEhB;AACJ;AACA;AACA;AACA;MACIvB,MAAM,WAAAA,OAACwB,IAAI,EAAE,CAAC,CAAC;MAEf;AACJ;AACA;AACA;AACA;MACIC,MAAM,WAAAA,OAAC3G,IAAI,EAAE4F,IAAI,EAAE,CAAC,CAAC;MAErB;AACJ;AACA;AACA;AACA;AACA;MACIgB,SAAS,WAAAA,UAAC5G,IAAI,EAAEwD,OAAO,EAAEqD,IAAI,EAAE,CAAC,CAAC;MAEjCC,SAAS,WAAAA,UAAA,EAAG;QACV,IAAI,IAAI,CAACf,WAAW,EAAE,EAAE;UACtB,IAAI,CAAC3E,OAAO,CAAC2F,UAAU,EAAE;QAC3B;MACF,CAAC;MAED;AACJ;AACA;MACIC,QAAQ,WAAAA,SAAA,EAAG;QACT,IAAI,IAAI,CAACjB,WAAW,EAAE,EAAE;UACtB,IAAI,CAAC3E,OAAO,CAAC2F,UAAU,EAAE;QAC3B;QACA,IAAI,CAAC3F,OAAO,GAAG,IAAI;MACrB;IACF;EACF,CAAC,CAAC;EApUF1B,EAAE,CAACC,EAAE,CAACsH,IAAI,CAAC1C,MAAM,CAACjF,aAAa,GAAGA,aAAa;AAAC"
}