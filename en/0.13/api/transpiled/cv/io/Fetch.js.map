{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "__cache",
    "DEFAULT_CACHE_TTL",
    "__gcInterval",
    "cachedFetch",
    "resource",
    "options",
    "proxy",
    "client",
    "undefined",
    "cache",
    "cv",
    "io",
    "Fetch",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "entry",
    "ttl",
    "time",
    "data",
    "Date",
    "now",
    "ps",
    "fetch",
    "cacheEntry",
    "then",
    "e",
    "log",
    "Logger",
    "error",
    "setInterval",
    "_gc",
    "url",
    "URL",
    "rest",
    "Client",
    "getBaseUrl",
    "window",
    "location",
    "origin",
    "searchParams",
    "set",
    "proxyParam",
    "Promise",
    "resolve",
    "reject",
    "xhr",
    "request",
    "Xhr",
    "authorize",
    "addListener",
    "ev",
    "getTarget",
    "getResponse",
    "send",
    "proxyFetch",
    "maxAge",
    "eol"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/Fetch.js"
  ],
  "sourcesContent": [
    "/* Fetch.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * native fetch replacement that supports the internal recording mechanism for replay file.\n */\nqx.Class.define('cv.io.Fetch', {\n  type: 'static',\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    __cache: {},\n    DEFAULT_CACHE_TTL: 5*60, // 5 minutes\n    __gcInterval: null,\n\n    async cachedFetch(resource, options = {}, proxy = false, client = undefined) {\n      const cache = cv.io.Fetch.__cache;\n      if (Object.prototype.hasOwnProperty.call(cache, resource)) {\n        const entry = cache[resource];\n        const ttl = options.ttl || cv.io.Fetch.DEFAULT_CACHE_TTL;\n        // check age\n        if (entry.time === 0) {\n          // request is still running, return the promise\n          return entry.data;\n        } else if (entry.time > Date.now() - ttl*1000) {\n          // request is not outdated yet\n          return entry.data;\n        }\n      }\n      if (options && Object.prototype.hasOwnProperty.call(options, 'ttl')) {\n        delete options.ttl;\n      }\n      const ps = cv.io.Fetch.fetch(resource, options, proxy, client);\n      const cacheEntry = {\n        data: ps,\n        time: 0,\n        ttl: options.ttl || cv.io.Fetch.DEFAULT_CACHE_TTL\n      };\n      cache[resource] = cacheEntry;\n      ps.then(() => {\n        cacheEntry.time = Date.now();\n      }).catch(e => {\n        qx.log.Logger.error(cv.io.Fetch, 'error loading ' + resource + ': ', e);\n        delete cache[resource];\n      });\n      if (!cv.io.Fetch.__gcInterval) {\n        cv.io.Fetch.__gcInterval = setInterval(() => {\n          cv.io.Fetch._gc();\n        }, cv.io.Fetch.DEFAULT_CACHE_TTL);\n      }\n      return ps;\n    },\n\n    /**\n     *\n     * @param resource {URL|string}\n     * @param options {object}\n     * @param proxy {boolean}\n     * @param client {cv.io.IClient}\n     * @returns {Promise<Response>}\n     */\n    async fetch(resource, options = {}, proxy = false, client = undefined) {\n      if (proxy) {\n        const url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n        if (resource) {\n          url.searchParams.set('url', resource);\n        }\n        if (options) {\n          for (const proxyParam of ['self-signed', 'config-section', 'auth-type']) {\n            if (Object.prototype.hasOwnProperty.call(options, proxyParam)) {\n              url.searchParams.set(proxyParam, options[proxyParam]);\n              delete options[proxyParam];\n            }\n          }\n        }\n        resource = url;\n      } else if (options) {\n        for (const proxyParam of ['self-signed', 'config-section', 'auth-type']) {\n          if (Object.prototype.hasOwnProperty.call(options, proxyParam)) {\n            delete options[proxyParam];\n          }\n        }\n      }\n      return new Promise((resolve, reject) => {\n        const xhr = new qx.io.request.Xhr('' + resource);\n        xhr.set(options);\n        if (client) {\n          client.authorize(xhr);\n        }\n        xhr.addListener('success', ev => {\n          const request = ev.getTarget();\n          resolve(request.getResponse());\n        });\n        xhr.addListener('statusError', ev => {\n          const request = ev.getTarget();\n          reject(request.getResponse());\n        });\n        xhr.send();\n      });\n    },\n\n    /**\n     *\n     * @param resource {URL|string}\n     * @param options {object}\n     * @param client {cv.io.IClient}\n     * @returns {Promise<Response>}\n     */\n    async proxyFetch(resource, options, client) {\n      return cv.io.Fetch.fetch(resource, options, true, client);\n    },\n\n    /**\n     * Garbage collection for fetch cache\n     * @private\n     */\n    _gc() {\n      // go through cache and delete what's older than an hour (unless its ttl is bigger)\n      let entry;\n      let maxAge = 60*60*1000; // one hour\n      let eol = Date.now() - maxAge;\n      for (const resource in cv.io.Fetch.__cache) {\n        entry = cv.io.Fetch.__cache[resource];\n        if (entry.time <= eol && entry.ttl*1000 < maxAge) {\n          delete cv.io.Fetch.__cache[resource];\n        }\n      }\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}