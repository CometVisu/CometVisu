{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "statics",
    "__cache",
    "DEFAULT_CACHE_TTL",
    "__gcInterval",
    "cachedFetch",
    "resource",
    "options",
    "proxy",
    "client",
    "undefined",
    "cache",
    "cv",
    "io",
    "Fetch",
    "Object",
    "prototype",
    "hasOwnProperty",
    "call",
    "entry",
    "ttl",
    "time",
    "data",
    "Date",
    "now",
    "ps",
    "fetch",
    "cacheEntry",
    "then",
    "e",
    "log",
    "Logger",
    "error",
    "setInterval",
    "_gc",
    "url",
    "URL",
    "rest",
    "Client",
    "getBaseUrl",
    "window",
    "location",
    "origin",
    "searchParams",
    "set",
    "proxyParam",
    "Promise",
    "resolve",
    "reject",
    "xhr",
    "request",
    "Xhr",
    "authorize",
    "addListener",
    "ev",
    "getTarget",
    "getResponse",
    "statusText",
    "getStatusText",
    "status",
    "getStatus",
    "send",
    "proxyFetch",
    "maxAge",
    "eol"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/io/Fetch.js"
  ],
  "sourcesContent": [
    "/* Fetch.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * native fetch replacement that supports the internal recording mechanism for replay file.\n */\nqx.Class.define('cv.io.Fetch', {\n  type: 'static',\n\n  /*\n  ***********************************************\n    STATICS\n  ***********************************************\n  */\n  statics: {\n    __cache: {},\n    DEFAULT_CACHE_TTL: 5*60, // 5 minutes\n    __gcInterval: null,\n\n    async cachedFetch(resource, options = {}, proxy = false, client = undefined) {\n      const cache = cv.io.Fetch.__cache;\n      if (Object.prototype.hasOwnProperty.call(cache, resource)) {\n        const entry = cache[resource];\n        const ttl = options.ttl || cv.io.Fetch.DEFAULT_CACHE_TTL;\n        // check age\n        if (entry.time === 0) {\n          // request is still running, return the promise\n          return entry.data;\n        } else if (entry.time > Date.now() - ttl*1000) {\n          // request is not outdated yet\n          return entry.data;\n        }\n      }\n      if (options && Object.prototype.hasOwnProperty.call(options, 'ttl')) {\n        delete options.ttl;\n      }\n      const ps = cv.io.Fetch.fetch(resource, options, proxy, client);\n      const cacheEntry = {\n        data: ps,\n        time: 0,\n        ttl: options.ttl || cv.io.Fetch.DEFAULT_CACHE_TTL\n      };\n      cache[resource] = cacheEntry;\n      ps.then(() => {\n        cacheEntry.time = Date.now();\n      }).catch(e => {\n        qx.log.Logger.error(cv.io.Fetch, 'error loading ' + resource + ': ', e);\n        delete cache[resource];\n      });\n      if (!cv.io.Fetch.__gcInterval) {\n        cv.io.Fetch.__gcInterval = setInterval(() => {\n          cv.io.Fetch._gc();\n        }, cv.io.Fetch.DEFAULT_CACHE_TTL);\n      }\n      return ps;\n    },\n\n    /**\n     *\n     * @param resource {URL|string}\n     * @param options {object}\n     * @param proxy {boolean}\n     * @param client {cv.io.IClient}\n     * @returns {Promise<String>}\n     */\n    async fetch(resource, options = {}, proxy = false, client = undefined) {\n      if (proxy) {\n        const url = new URL(cv.io.rest.Client.getBaseUrl() + '/proxy', window.location.origin);\n        if (resource) {\n          url.searchParams.set('url', resource);\n        }\n        if (options) {\n          for (const proxyParam of ['self-signed', 'config-section', 'auth-type']) {\n            if (Object.prototype.hasOwnProperty.call(options, proxyParam)) {\n              url.searchParams.set(proxyParam, options[proxyParam]);\n              delete options[proxyParam];\n            }\n          }\n        }\n        resource = url;\n      } else if (options) {\n        for (const proxyParam of ['self-signed', 'config-section', 'auth-type']) {\n          if (Object.prototype.hasOwnProperty.call(options, proxyParam)) {\n            delete options[proxyParam];\n          }\n        }\n      }\n      return new Promise((resolve, reject) => {\n        const xhr = new qx.io.request.Xhr('' + resource);\n        xhr.set(options);\n        if (client) {\n          client.authorize(xhr);\n        }\n        xhr.addListener('success', ev => {\n          const request = ev.getTarget();\n          resolve(request.getResponse());\n        });\n        xhr.addListener('statusError', ev => {\n          const request = ev.getTarget();\n          reject({\n            url: resource,\n            statusText: request.getStatusText(),\n            status: request.getStatus()\n          });\n        });\n        xhr.addListener('fail', ev => {\n          const request = ev.getTarget();\n          reject({\n            url: resource,\n            status: request.getStatus(),\n            statusText: 'response parsing failure'\n          });\n        });\n        xhr.send();\n      });\n    },\n\n    /**\n     *\n     * @param resource {URL|string}\n     * @param options {object}\n     * @param client {cv.io.IClient}\n     * @returns {Promise<Response>}\n     */\n    async proxyFetch(resource, options, client) {\n      return cv.io.Fetch.fetch(resource, options, true, client);\n    },\n\n    /**\n     * Garbage collection for fetch cache\n     * @private\n     */\n    _gc() {\n      // go through cache and delete what's older than an hour (unless its ttl is bigger)\n      let entry;\n      let maxAge = 60*60*1000; // one hour\n      let eol = Date.now() - maxAge;\n      for (const resource in cv.io.Fetch.__cache) {\n        entry = cv.io.Fetch.__cache[resource];\n        if (entry.time <= eol && entry.ttl*1000 < maxAge) {\n          delete cv.io.Fetch.__cache[resource];\n        }\n      }\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}