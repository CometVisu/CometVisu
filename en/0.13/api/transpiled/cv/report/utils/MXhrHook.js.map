{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Mixin",
    "define",
    "construct",
    "addListener",
    "_onPhaseChange",
    "statics",
    "PENDING",
    "members",
    "__sendTime",
    "getRequestHash",
    "cv",
    "ConfigCache",
    "hashCode",
    "report",
    "Record",
    "normalizeUrl",
    "_getConfiguredUrl",
    "getMethod",
    "JSON",
    "stringify",
    "getRequestData",
    "ev",
    "hash",
    "delay",
    "url",
    "getData",
    "Date",
    "now",
    "record",
    "XHR",
    "method",
    "headers",
    "_getAllRequestHeaders",
    "requestData",
    "utils",
    "MXhrHook",
    "push",
    "error",
    "getAllResponseHeaders",
    "trim",
    "split",
    "forEach",
    "entry",
    "parts",
    "getStatus",
    "status",
    "body",
    "getTransport",
    "responseText",
    "phase",
    "shift",
    "length"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/source/class/cv/report/utils/MXhrHook.js"
  ],
  "sourcesContent": [
    "/* MXhrHook.js\n *\n * copyright (c) 2010-2022, Christian Mayer and the CometVisu contributers.\n *\n * This program is free software; you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by the Free\n * Software Foundation; either version 3 of the License, or (at your option)\n * any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for\n * more details.\n *\n * You should have received a copy of the GNU General Public License along\n * with this program; if not, write to the Free Software Foundation, Inc.,\n * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA\n */\n\n/**\n * This mixin patches {qx.io.request.Xhr} to get noticed about every XHR request to record its response.\n */\nqx.Mixin.define('cv.report.utils.MXhrHook', {\n  /*\n  ******************************************************\n    CONSTRUCTOR\n  ******************************************************\n  */\n  construct() {\n    this.addListener('changePhase', this._onPhaseChange, this);\n  },\n\n  /*\n  ******************************************************\n    STATICS\n  ******************************************************\n  */\n  statics: {\n    PENDING: {}\n  },\n\n  /*\n  ******************************************************\n    MEMBERS\n  ******************************************************\n  */\n  members: {\n    __sendTime: null,\n\n    /**\n     * Calculate Hash code for current request\n     */\n    getRequestHash() {\n      return cv.ConfigCache.hashCode(\n        cv.report.Record.normalizeUrl(this._getConfiguredUrl()) +\n          this.getMethod() +\n          JSON.stringify(this.getRequestData())\n      );\n    },\n\n    _onPhaseChange(ev) {\n      const hash = this.getRequestHash();\n      let delay;\n      const url = cv.report.Record.normalizeUrl(this._getConfiguredUrl());\n\n      if (ev.getData() === 'opened') {\n        this.__sendTime = Date.now();\n        // calculate Hash value for request\n        cv.report.Record.record(cv.report.Record.XHR, 'request', {\n          url: url,\n          method: this.getMethod(),\n          headers: this._getAllRequestHeaders(),\n          requestData: this.getRequestData(),\n          hash: hash\n        });\n\n        if (!cv.report.utils.MXhrHook.PENDING[hash]) {\n          cv.report.utils.MXhrHook.PENDING[hash] = [];\n        }\n        cv.report.utils.MXhrHook.PENDING[hash].push(url);\n      } else if (ev.getData() === 'load') {\n        if (!this.__sendTime) {\n          this.error('response received without sendTime set. Not possible to calculate correct delay');\n        }\n        // response has been received (successful or not) -> log it\n        const headers = {};\n        this.getAllResponseHeaders()\n          .trim()\n          .split('\\r\\n')\n          .forEach(function (entry) {\n            const parts = entry.split(': ');\n            headers[parts[0]] = parts[1];\n          });\n        delay = Date.now() - this.__sendTime;\n\n        // log the trigger that triggers the server responses\n\n        // do not log 404 answers as the fake server sends them automatically\n        // end the logged ones break the replay for some reason\n        if (this.getStatus() !== 404) {\n          cv.report.Record.record(cv.report.Record.XHR, 'response', {\n            url: url,\n            method: this.getMethod(),\n            status: this.getStatus(),\n            delay: delay,\n            headers: headers,\n            body: this.getTransport().responseText,\n            hash: hash,\n            phase: 'load'\n          });\n        }\n        this.__sendTime = null;\n\n        // delete pending request\n        cv.report.utils.MXhrHook.PENDING[hash].shift();\n        if (cv.report.utils.MXhrHook.PENDING[hash].length === 0) {\n          delete cv.report.utils.MXhrHook.PENDING[hash];\n        }\n      } else if (ev.getData() === 'abort') {\n        delay = Date.now() - this.__sendTime;\n\n        // request aborted, maybe by watchdog\n        cv.report.Record.record(cv.report.Record.XHR, 'response', {\n          url: url,\n          delay: delay,\n          hash: hash,\n          phase: 'abort'\n        });\n\n        // delete pending request\n        cv.report.utils.MXhrHook.PENDING[hash].shift();\n        if (cv.report.utils.MXhrHook.PENDING[hash].length === 0) {\n          delete cv.report.utils.MXhrHook.PENDING[hash];\n        }\n      }\n    }\n  }\n});\n"
  ],
  "mappings": ";;;;;;;;;;;EAAAA,EAAE,CAACC,SAAS,CAACC,oBAAoB,CAACC,aAAa,CAAC;EAAhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EAEA;AACA;AACA;EACAH,EAAE,CAACI,KAAK,CAACC,MAAM,CAAC,0BAA0B,EAAE;IAC1C;AACF;AACA;AACA;AACA;IACEC,SAAS,WAAAA,UAAA,EAAG;MACV,IAAI,CAACC,WAAW,CAAC,aAAa,EAAE,IAAI,CAACC,cAAc,EAAE,IAAI,CAAC;IAC5D,CAAC;IAED;AACF;AACA;AACA;AACA;IACEC,OAAO,EAAE;MACPC,OAAO,EAAE,CAAC;IACZ,CAAC;IAED;AACF;AACA;AACA;AACA;IACEC,OAAO,EAAE;MACPC,SAAU,EAAE,IAAI;MAEhB;AACJ;AACA;MACIC,cAAc,WAAAA,eAAA,EAAG;QACf,OAAOC,EAAE,CAACC,WAAW,CAACC,QAAQ,CAC5BF,EAAE,CAACG,MAAM,CAACC,MAAM,CAACC,YAAY,CAAC,IAAI,CAACC,iBAAiB,CAAC,CAAC,CAAC,GACrD,IAAI,CAACC,SAAS,CAAC,CAAC,GAChBC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACC,cAAc,CAAC,CAAC,CACxC,CAAC;MACH,CAAC;MAEDhB,cAAc,WAAAA,eAACiB,EAAE,EAAE;QACjB,IAAMC,IAAI,GAAG,IAAI,CAACb,cAAc,CAAC,CAAC;QAClC,IAAIc,KAAK;QACT,IAAMC,GAAG,GAAGd,EAAE,CAACG,MAAM,CAACC,MAAM,CAACC,YAAY,CAAC,IAAI,CAACC,iBAAiB,CAAC,CAAC,CAAC;QAEnE,IAAIK,EAAE,CAACI,OAAO,CAAC,CAAC,KAAK,QAAQ,EAAE;UAC7B,IAAI,CAACjB,SAAU,GAAGkB,IAAI,CAACC,GAAG,CAAC,CAAC;UAC5B;UACAjB,EAAE,CAACG,MAAM,CAACC,MAAM,CAACc,MAAM,CAAClB,EAAE,CAACG,MAAM,CAACC,MAAM,CAACe,GAAG,EAAE,SAAS,EAAE;YACvDL,GAAG,EAAEA,GAAG;YACRM,MAAM,EAAE,IAAI,CAACb,SAAS,CAAC,CAAC;YACxBc,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAAC,CAAC;YACrCC,WAAW,EAAE,IAAI,CAACb,cAAc,CAAC,CAAC;YAClCE,IAAI,EAAEA;UACR,CAAC,CAAC;UAEF,IAAI,CAACZ,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,EAAE;YAC3CZ,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,GAAG,EAAE;UAC7C;UACAZ,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,CAACc,IAAI,CAACZ,GAAG,CAAC;QAClD,CAAC,MAAM,IAAIH,EAAE,CAACI,OAAO,CAAC,CAAC,KAAK,MAAM,EAAE;UAClC,IAAI,CAAC,IAAI,CAACjB,SAAU,EAAE;YACpB,IAAI,CAAC6B,KAAK,CAAC,iFAAiF,CAAC;UAC/F;UACA;UACA,IAAMN,OAAO,GAAG,CAAC,CAAC;UAClB,IAAI,CAACO,qBAAqB,CAAC,CAAC,CACzBC,IAAI,CAAC,CAAC,CACNC,KAAK,CAAC,MAAM,CAAC,CACbC,OAAO,CAAC,UAAUC,KAAK,EAAE;YACxB,IAAMC,KAAK,GAAGD,KAAK,CAACF,KAAK,CAAC,IAAI,CAAC;YAC/BT,OAAO,CAACY,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC;UAC9B,CAAC,CAAC;UACJpB,KAAK,GAAGG,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACnB,SAAU;;UAEpC;;UAEA;UACA;UACA,IAAI,IAAI,CAACoC,SAAS,CAAC,CAAC,KAAK,GAAG,EAAE;YAC5BlC,EAAE,CAACG,MAAM,CAACC,MAAM,CAACc,MAAM,CAAClB,EAAE,CAACG,MAAM,CAACC,MAAM,CAACe,GAAG,EAAE,UAAU,EAAE;cACxDL,GAAG,EAAEA,GAAG;cACRM,MAAM,EAAE,IAAI,CAACb,SAAS,CAAC,CAAC;cACxB4B,MAAM,EAAE,IAAI,CAACD,SAAS,CAAC,CAAC;cACxBrB,KAAK,EAAEA,KAAK;cACZQ,OAAO,EAAEA,OAAO;cAChBe,IAAI,EAAE,IAAI,CAACC,YAAY,CAAC,CAAC,CAACC,YAAY;cACtC1B,IAAI,EAAEA,IAAI;cACV2B,KAAK,EAAE;YACT,CAAC,CAAC;UACJ;UACA,IAAI,CAACzC,SAAU,GAAG,IAAI;;UAEtB;UACAE,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,CAAC4B,KAAK,CAAC,CAAC;UAC9C,IAAIxC,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,CAAC6B,MAAM,KAAK,CAAC,EAAE;YACvD,OAAOzC,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC;UAC/C;QACF,CAAC,MAAM,IAAID,EAAE,CAACI,OAAO,CAAC,CAAC,KAAK,OAAO,EAAE;UACnCF,KAAK,GAAGG,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACnB,SAAU;;UAEpC;UACAE,EAAE,CAACG,MAAM,CAACC,MAAM,CAACc,MAAM,CAAClB,EAAE,CAACG,MAAM,CAACC,MAAM,CAACe,GAAG,EAAE,UAAU,EAAE;YACxDL,GAAG,EAAEA,GAAG;YACRD,KAAK,EAAEA,KAAK;YACZD,IAAI,EAAEA,IAAI;YACV2B,KAAK,EAAE;UACT,CAAC,CAAC;;UAEF;UACAvC,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,CAAC4B,KAAK,CAAC,CAAC;UAC9C,IAAIxC,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC,CAAC6B,MAAM,KAAK,CAAC,EAAE;YACvD,OAAOzC,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAAC7B,OAAO,CAACgB,IAAI,CAAC;UAC/C;QACF;MACF;IACF;EACF,CAAC,CAAC;EAzIFZ,EAAE,CAACG,MAAM,CAACqB,KAAK,CAACC,QAAQ,CAACpC,aAAa,GAAGA,aAAa;AAAC"
}