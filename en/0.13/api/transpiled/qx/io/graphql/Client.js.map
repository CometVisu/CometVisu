{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "io",
    "transport",
    "AbstractClient",
    "statics",
    "registerTransport",
    "events",
    "error",
    "construct",
    "transportOrUri",
    "selectTransport",
    "members",
    "send",
    "request",
    "getTransport",
    "Promise",
    "resolve",
    "reject",
    "addListenerOnce",
    "evt",
    "core",
    "Environment",
    "get",
    "debug",
    "getData",
    "responseData",
    "lang",
    "Json",
    "parse",
    "graphQlResponse",
    "graphql",
    "protocol",
    "Response",
    "getErrors",
    "_handleErrors",
    "e",
    "exception",
    "Transport",
    "message",
    "toString",
    "response",
    "errors",
    "forEach",
    "Protocol",
    "toObject",
    "fireDataEvent",
    "environment",
    "Client"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/node_modules/@qooxdoo/framework/source/class/qx/io/graphql/Client.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n      2020 Christian Boulanger\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (cboulanger)\n\n************************************************************************ */\n\n/**\n * This class provides a simple GraphQl client (https://graphql.org/).\n * For transport, it is based on internally on the fetch API\n * (https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch)\n * which, if needed, must be directly configured via the `init` parameter of the\n * constructor, until a more generalized qx.io API has been developed.\n * @experimental The API might change. Feedback is appreciated.\n */\nqx.Class.define(\"qx.io.graphql.Client\", {\n  extend: qx.io.transport.AbstractClient,\n\n  statics: {\n    registerTransport: qx.io.transport.AbstractClient.registerTransport\n  },\n\n  events: {\n    /**\n     * Event fired when a request results in an error. Event data is an instance of\n     * {@link qx.io.exception.Transport}, {@link qx.io.exception.Protocol},\n     * or {@link qx.io.exception.Cancel}.\n     */\n    error: \"qx.event.type.Data\"\n  },\n\n  /**\n   * @param {qx.io.transport.ITransport|String} transportOrUri\n   *    Transport object, which must implement {@link qx.io.transport.ITransport}\n   *    or a string URI, which will trigger auto-detection of transport, as long as an\n   *    appropriate transport has been registered with the static `registerTransport()` function.\n   */\n  construct(transportOrUri) {\n    super();\n    this.selectTransport(transportOrUri);\n  },\n\n  members: {\n    /**\n     * Send the given GraphQl query. See https://graphql.org/learn/queries/\n     *\n     * @param {qx.io.graphql.protocol.Request} request The GraphQl request object.\n     * @return {qx.Promise} Promise that resolves with the data\n     */\n    async send(request) {\n      let transport = this.getTransport();\n      return new qx.Promise((resolve, reject) => {\n        transport.addListenerOnce(\"message\", evt => {\n          try {\n            if (qx.core.Environment.get(\"qx.io.graphql.debug\")) {\n              this.debug(\"<<< Received: \" + evt.getData());\n            }\n            let responseData = qx.lang.Json.parse(evt.getData());\n            let graphQlResponse = new qx.io.graphql.protocol.Response(\n              responseData\n            );\n\n            if (graphQlResponse.getErrors()) {\n              return reject(this._handleErrors(graphQlResponse));\n            }\n            return resolve(graphQlResponse.getData());\n          } catch (e) {\n            this.error(e);\n            return reject(new qx.io.exception.Transport(e.message));\n          }\n        });\n        if (qx.core.Environment.get(\"qx.io.graphql.debug\")) {\n          this.debug(\">>>> Sending \" + request.toString());\n        }\n        transport.send(request.toString()).catch(reject);\n      });\n    },\n\n    /**\n     * Handle the errors reported by the GraphQL endpoint. The response\n     * can contain several errors, but we can only throw one of them.\n     * However, we can fire an event for each error, which might be useful\n     * if they are to be logged. The errors that are thrown or fired as\n     * event data contain the original response object in the `data` property\n     *\n     * @param {qx.io.graphql.protocol.Response} response The response object\n     * @return {qx.io.exception.Protocol}\n     */\n    _handleErrors(response) {\n      let errors = response.getErrors();\n      errors.forEach(error => {\n        let exception = new qx.io.exception.Protocol(\n          error.message,\n          null,\n          response.toObject()\n        );\n\n        this.fireDataEvent(\"error\", exception);\n      });\n      return new qx.io.exception.Protocol(\n        errors[0].message,\n        null,\n        response.toObject()\n      );\n    }\n  },\n\n  environment: {\n    \"qx.io.graphql.debug\": false\n  }\n});\n"
  ],
  "mappings": "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"
}