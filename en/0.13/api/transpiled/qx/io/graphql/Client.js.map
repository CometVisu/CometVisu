{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "io",
    "transport",
    "AbstractClient",
    "statics",
    "registerTransport",
    "events",
    "error",
    "construct",
    "transportOrUri",
    "selectTransport",
    "members",
    "send",
    "request",
    "getTransport",
    "Promise",
    "resolve",
    "reject",
    "addListenerOnce",
    "evt",
    "core",
    "Environment",
    "get",
    "debug",
    "getData",
    "responseData",
    "lang",
    "Json",
    "parse",
    "graphQlResponse",
    "graphql",
    "protocol",
    "Response",
    "getErrors",
    "_handleErrors",
    "e",
    "exception",
    "Transport",
    "message",
    "toString",
    "response",
    "errors",
    "forEach",
    "Protocol",
    "toObject",
    "fireDataEvent",
    "environment",
    "Client"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/node_modules/@qooxdoo/framework/source/class/qx/io/graphql/Client.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n      2020 Christian Boulanger\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (cboulanger)\n\n************************************************************************ */\n\n/**\n * This class provides a simple GraphQl client (https://graphql.org/).\n * For transport, it is based on internally on the fetch API\n * (https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch)\n * which, if needed, must be directly configured via the `init` parameter of the\n * constructor, until a more generalized qx.io API has been developed.\n * @experimental The API might change. Feedback is appreciated.\n */\nqx.Class.define(\"qx.io.graphql.Client\", {\n  extend: qx.io.transport.AbstractClient,\n\n  statics: {\n    registerTransport: qx.io.transport.AbstractClient.registerTransport\n  },\n\n  events: {\n    /**\n     * Event fired when a request results in an error. Event data is an instance of\n     * {@link qx.io.exception.Transport}, {@link qx.io.exception.Protocol},\n     * or {@link qx.io.exception.Cancel}.\n     */\n    error: \"qx.event.type.Data\"\n  },\n\n  /**\n   * @param {qx.io.transport.ITransport|String} transportOrUri\n   *    Transport object, which must implement {@link qx.io.transport.ITransport}\n   *    or a string URI, which will trigger auto-detection of transport, as long as an\n   *    appropriate transport has been registered with the static `registerTransport()` function.\n   */\n  construct(transportOrUri) {\n    super();\n    this.selectTransport(transportOrUri);\n  },\n\n  members: {\n    /**\n     * Send the given GraphQl query. See https://graphql.org/learn/queries/\n     *\n     * @param {qx.io.graphql.protocol.Request} request The GraphQl request object.\n     * @return {qx.Promise} Promise that resolves with the data\n     */\n    async send(request) {\n      let transport = this.getTransport();\n      return new qx.Promise((resolve, reject) => {\n        transport.addListenerOnce(\"message\", evt => {\n          try {\n            if (qx.core.Environment.get(\"qx.io.graphql.debug\")) {\n              this.debug(\"<<< Received: \" + evt.getData());\n            }\n            let responseData = qx.lang.Json.parse(evt.getData());\n            let graphQlResponse = new qx.io.graphql.protocol.Response(\n              responseData\n            );\n\n            if (graphQlResponse.getErrors()) {\n              return reject(this._handleErrors(graphQlResponse));\n            }\n            return resolve(graphQlResponse.getData());\n          } catch (e) {\n            this.error(e);\n            return reject(new qx.io.exception.Transport(e.message));\n          }\n        });\n        if (qx.core.Environment.get(\"qx.io.graphql.debug\")) {\n          this.debug(\">>>> Sending \" + request.toString());\n        }\n        transport.send(request.toString()).catch(reject);\n      });\n    },\n\n    /**\n     * Handle the errors reported by the GraphQL endpoint. The response\n     * can contain several errors, but we can only throw one of them.\n     * However, we can fire an event for each error, which might be useful\n     * if they are to be logged. The errors that are thrown or fired as\n     * event data contain the original response object in the `data` property\n     *\n     * @param {qx.io.graphql.protocol.Response} response The response object\n     * @return {qx.io.exception.Protocol}\n     */\n    _handleErrors(response) {\n      let errors = response.getErrors();\n      errors.forEach(error => {\n        let exception = new qx.io.exception.Protocol(\n          error.message,\n          null,\n          response.toObject()\n        );\n\n        this.fireDataEvent(\"error\", exception);\n      });\n      return new qx.io.exception.Protocol(\n        errors[0].message,\n        null,\n        response.toObject()\n      );\n    }\n  },\n\n  environment: {\n    \"qx.io.graphql.debug\": false\n  }\n});\n"
  ],
  "mappings": "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"
}