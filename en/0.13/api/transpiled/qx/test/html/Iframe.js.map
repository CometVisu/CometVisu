{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "dev",
    "unit",
    "TestCase",
    "include",
    "MMock",
    "members",
    "__doc",
    "__frame",
    "__origin",
    "__destSource",
    "__alredyRun",
    "setUp",
    "helper",
    "document",
    "createElement",
    "body",
    "appendChild",
    "html",
    "Root",
    "setAttribute",
    "frame",
    "Iframe",
    "add",
    "window",
    "location",
    "protocol",
    "util",
    "ResourceManager",
    "getInstance",
    "toUri",
    "test_set_source_to_URL_with_same_origin",
    "_this",
    "source",
    "addListener",
    "resume",
    "element",
    "getDomElement",
    "currentUrl",
    "bom",
    "queryCurrentUrl",
    "src",
    "getSource",
    "blank",
    "msg",
    "actual",
    "assertString",
    "assertMatch",
    "setSource",
    "Element",
    "flush",
    "wait",
    "test_update_source_on_navigate",
    "addListenerOnce",
    "test_skip_setting_source_if_frame_is_already_on_URL",
    "_this2",
    "origSetSource",
    "Error",
    "url",
    "e",
    "fail",
    "test_set_null_source_if_frame_is_crossOrigin",
    "_this3",
    "skip",
    "elem",
    "spy",
    "assertCalledWith",
    "tearDown",
    "div",
    "getElementById",
    "removeChild",
    "getSandbox",
    "restore",
    "dispose",
    "test"
  ],
  "sources": [
    "/home/runner/work/CometVisu/CometVisu/node_modules/@qooxdoo/framework/source/class/qx/test/html/Iframe.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2004-2010 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Tristan Koch (tristankoch)\n\n************************************************************************ */\n\n/* ************************************************************************\n\n\n************************************************************************ */\n/**\n *\n * @asset(qx/static/blank.html)\n */\n\nqx.Class.define(\"qx.test.html.Iframe\", {\n  extend: qx.dev.unit.TestCase,\n  include: qx.dev.unit.MMock,\n\n  members: {\n    __doc: null,\n    __frame: null,\n    __origin: null,\n    __destSource: null,\n\n    __alredyRun: false,\n\n    setUp() {\n      var helper = document.createElement(\"div\");\n      document.body.appendChild(helper);\n\n      this.__doc = new qx.html.Root(helper);\n      this.__doc.setAttribute(\"id\", \"doc\");\n\n      var frame = (this.__frame = new qx.html.Iframe());\n      this.__doc.add(frame);\n\n      // Source in parent directory is not of same origin\n      // when using file protocol â€“ use non-existing file\n      // in same directory instead\n      if (window.location.protocol === \"file:\") {\n        this.__destSource = \"blank.html\";\n      } else {\n        this.__destSource = qx.util.ResourceManager.getInstance().toUri(\n          qx.core.Environment.get(\"qx.blankpage\")\n        );\n      }\n    },\n\n    \"test: set source to URL with same origin\"() {\n      var frame = this.__frame;\n\n      var source = this.__destSource;\n\n      frame.addListener(\"load\", () => {\n        this.resume(function () {\n          var element = frame.getDomElement();\n          var currentUrl =\n            qx.bom.Iframe.queryCurrentUrl(element) || element.src;\n          var source = frame.getSource();\n          var blank = \"/blank.html$\";\n\n          var msg = function (actual) {\n            return \"Must be \" + currentUrl + \", but was \" + actual;\n          };\n\n          // BOM\n          this.assertString(currentUrl);\n          this.assertMatch(currentUrl, blank, msg(currentUrl));\n\n          // HTML\n          this.assertString(source);\n          this.assertMatch(source, blank, msg(source));\n        });\n      });\n\n      frame.setSource(source);\n      qx.html.Element.flush();\n\n      this.wait();\n    },\n\n    \"test: update source on navigate\"() {\n      var frame = this.__frame;\n\n      // As soon as the original frame has loaded,\n      // fake user-action and browse\n      var source = this.__destSource;\n      frame.addListenerOnce(\"load\", function () {\n        qx.html.Element.flush();\n        qx.bom.Iframe.setSource(frame.getDomElement(), source);\n      });\n\n      qx.html.Element.flush();\n\n      // Give changed frame some time to load\n      this.wait(\n        500,\n        function () {\n          this.assertMatch(frame.getSource(), \"/blank.html$\");\n        },\n        this\n      );\n    },\n\n    \"test: skip setting source if frame is already on URL\"() {\n      var frame = this.__frame;\n\n      // As soon as the original frame has loaded,\n      // fake user-action and browse\n      var source = this.__destSource;\n      frame.addListenerOnce(\"load\", function () {\n        qx.bom.Iframe.setSource(frame.getDomElement(), source);\n      });\n      qx.html.Element.flush();\n\n      var origSetSource;\n      frame.addListener(\"load\", () => {\n        origSetSource = qx.bom.Iframe.setSource;\n        qx.bom.Iframe.setSource = function () {\n          throw new Error(\"setSource\");\n        };\n\n        try {\n          var url = qx.bom.Iframe.queryCurrentUrl(frame.getDomElement());\n          frame.setSource(url);\n          qx.html.Element.flush();\n          this.resume();\n        } catch (e) {\n          this.resume(function () {\n            this.fail(\"Setting same URL must be skipped\");\n          });\n        }\n\n        qx.bom.Iframe.setSource = origSetSource;\n      });\n\n      this.wait();\n    },\n\n    \"test: set null source if frame is cross-origin\"() {\n      var frame = this.__frame;\n\n      if (this.__alredyRun) {\n        this.skip(\"This test can only run once. Reload to run again.\");\n      }\n\n      // On cross origin\n      frame.addListener(\"load\", () => {\n        this.resume(function () {\n          var elem = frame.getDomElement();\n          this.spy(qx.bom.Iframe, \"setSource\");\n          frame.setSource(null);\n\n          this.assertCalledWith(qx.bom.Iframe.setSource, elem, null);\n        });\n      });\n\n      frame.setSource(\"http://example.com\");\n\n      this.__alredyRun = true;\n      this.wait();\n    },\n\n    tearDown() {\n      qx.html.Element.flush();\n      var div = document.getElementById(\"doc\");\n      document.body.removeChild(div);\n\n      this.getSandbox().restore();\n      this.__frame.dispose();\n      this.__frame = null;\n    }\n  }\n});\n"
  ],
  "mappings": "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",
  "ignoreList": []
}