<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<config
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../visu_config_tile.xsd"
        design="tile"
        version="1"
>
    <cv-meta>
        <cv-backend type="openhab" username="oh.CometVisu.NxR3UQ5AhJB8Ju8ZFI9Z6IXnvlqgmFJ5EhVGFVy49fi6REytcCFCxhKSKoesju6nDWuqWC9DZR39vIh2ig"/>
        <cv-backend name="si" default="true" type="simulated"/>
        <cv-backend name="mqtt" type="mqtt" uri="ws://mqtt:9001/"/>
        <cv-mapping name="light">
            <entry value="0">ri-lightbulb-line</entry>
            <entry value="1">ri-lightbulb-fill</entry>
        </cv-mapping>
        <cv-mapping name="speaker">
            <entry value="0">ri-speaker-line</entry>
            <entry value="1">ri-speaker-fill</entry>
        </cv-mapping>
        <cv-mapping name="percent">
            <formula>y = x + "%"</formula>
        </cv-mapping>
        <cv-mapping name="PlayStop">
            <entry value="0">ri-play-fill</entry>
            <entry value="1">ri-stop-fill</entry>
        </cv-mapping>
        <cv-mapping name="WindowOpen">
            <entry value="0">knxuf-fts_window_1w</entry>
            <entry range-min="1">knxuf-fts_window_1w_open</entry>
        </cv-mapping>
        <cv-mapping name="PlayProgress">
            <formula>y = Math.round(100/store.get('duration')*x)</formula>
        </cv-mapping>
        <cv-styling name="button">
            <entry value="0">inactive</entry>
            <entry range-min="1">active</entry>
        </cv-styling>
        <cv-mapping name="kWh">
            <formula>y = Math.round(x/1000)</formula>
        </cv-mapping>
        <cv-mapping name="RtcOn" type="boolean">
            <entry value="Comfort">true</entry>
            <entry value="Economy">false</entry>
            <entry value="Building Protection">false</entry>
            <entry value="Stondby">false</entry>
        </cv-mapping>
    </cv-meta>
    <header>
        <!--<div style="display: flex; padding: calc(var(&#45;&#45;spacing)*2); gap: var(&#45;&#45;spacing)">-->
        <cv-group open="true" wrap="false">
            <cv-status format="%d an">
                <cv-icon slot="icon" size="x-large">ri-lightbulb-line</cv-icon>
                <cv-address slot="address" transform="OH:number" mode="read" backend="main">number:Lights</cv-address>
                <span slot="label">Lichter</span>
                <cv-popup slot="popup" modal="true">
                    <cv-list rowspan="3" colspan="3">
                        <model filter="item.active===true" sort-by="label">
                            <cv-address transform="raw" mode="read" backend="main">members:Lights</cv-address>
                        </model>
                        <header>
                            <h4>Eingeschaltete Lichter</h4>
                        </header>
                        <template>
                            <cv-listitem>
                                <cv-button class="round-button" mapping="light" size="small">
                                    <cv-address backend="main" mode="readwrite" transform="OH:switch">${name}</cv-address>
                                    <cv-icon class="value" />
                                </cv-button>
                                <div class="content">
                                    <label class="primary">${label}</label>
                                </div>
                            </cv-listitem>
                        </template>
                        <template when="empty">
                            <li><label class="primary">Zur Zeit sind keine Lampen eingeschaltet</label></li>
                        </template>
                    </cv-list>
                </cv-popup>
            </cv-status>
            <cv-status format="%d offen">
                <cv-icon slot="icon" size="x-large">knxuf-fts_shutter_10</cv-icon>
                <cv-address slot="address" transform="OH:number" mode="read" backend="main">number:Shutters</cv-address>
                <span slot="label">Rollladen</span>
            </cv-status>
            <cv-status format="%d offen">
                <cv-value slot="icon" mapping="WindowOpen">
                    <cv-icon size="x-large" class="value">knxuf-fts_window_1w_open</cv-icon>
                    <cv-address transform="OH:number" mode="read" backend="main">number:Windows</cv-address>
                </cv-value>
                <cv-address slot="address" transform="OH:number" mode="read" backend="main">number:Windows</cv-address>
                <span slot="label">Fenster</span>
            </cv-status>
            <cv-status format="%d an">
            <cv-icon slot="icon" size="x-large">ri-speaker-line</cv-icon>
            <cv-address slot="address" transform="OH:number" mode="read" backend="main">number:Speakers</cv-address>
            <span slot="label">Lautsprecher</span>
            <cv-popup slot="popup" modal="true">
                <cv-list rowspan="3" colspan="3">
                    <model filter="item.active===true" sort-by="label">
                        <cv-address transform="raw" mode="read" backend="main">members:Speakers</cv-address>
                    </model>
                    <header>
                        <h4>Eingeschaltete Lautsprecher</h4>
                    </header>
                    <template>
                        <cv-listitem>
                            <cv-button class="round-button" mapping="speaker" size="small">
                                <cv-address backend="main" mode="readwrite" transform="OH:switch">${name}</cv-address>
                                <cv-icon class="value" />
                            </cv-button>
                            <div class="content">
                                <label class="primary">${label}</label>
                            </div>
                        </cv-listitem>
                    </template>
                    <template when="empty">
                        <li><label class="primary">Zur Zeit sind keine Lautsprecher eingeschaltet</label></li>
                    </template>
                </cv-list>
            </cv-popup>
        </cv-status>
        </cv-group>
        <nav>
            <cv-menu model="pages"/>
        </nav>
    </header>
    <main>
        <aside mobile="false">
            <p>This is my left side content</p>
        </aside>
        <cv-page id="main" name="Start">
        <cv-group>
            <summary>Switches</summary>
            <cv-switch mapping="light" styling="button">
                <cv-address slot="address" transform="OH:switch" backend="main">Light_SF_Office</cv-address>
                <span slot="primaryLabel">Default</span>
                <span slot="secondaryLabel">Switch with state</span>
            </cv-switch>
            <cv-switch mapping="light" styling="button">
                <cv-address slot="address" transform="OH:switch" backend="main">Light_SF_Bath</cv-address>
                <span slot="primaryLabel">Bad</span>
            </cv-switch>
            <cv-switch mapping="light" styling="button">
                <cv-address slot="address" transform="OH:switch" backend="main" mode="write" value="1">Light_SF_Office</cv-address>
                <span slot="primaryLabel">Trigger</span>
                <span slot="secondaryLabel">no state, fixed value</span>
            </cv-switch>
            <cv-switch mapping="light" styling="button">
                <cv-address slot="address" transform="OH:switch" backend="si" mode="write" value="1" on="down">Light_SF_Office</cv-address>
                <cv-address slot="address" transform="OH:switch" backend="si" mode="write" value="0" on="up">Light_SF_Office</cv-address>
                <cv-address slot="address" transform="OH:switch" backend="si" mode="read">Light_SF_Office</cv-address>
                <span slot="primaryLabel">Push-button</span>
            </cv-switch>
            <cv-switch mapping="light" styling="button">
                <cv-address slot="address" transform="OH:switch" backend="main">Light_SF_Office</cv-address>
                <cv-address slot="address" transform="OH:number" mode="read" backend="si" target="progress">Test_Value</cv-address>
                <span slot="primaryLabel">Button</span>
                <span slot="secondaryLabel">with progress</span>
            </cv-switch>
        </cv-group>
        <cv-group open="true">
            <summary>Other actors</summary>
            <cv-shutter styling="button" position-mapping="percent">
                <cv-address slot="downAddress" transform="OH:rollershutter" mode="write" value="100" backend="main">Shutter_FF_Living</cv-address>
                <cv-address slot="stopAddress" transform="OH:rollershutter" mode="write" value="STOP" backend="main">Shutter_FF_Living</cv-address>
                <cv-address slot="upAddress" transform="OH:rollershutter" mode="write" value="0" backend="main">Shutter_FF_Living</cv-address>
                <cv-address slot="positionAddress" transform="OH:number" mode="read" backend="main">Shutter_FF_Living</cv-address>
                <span slot="primaryLabel">Default</span>
            </cv-shutter>
            <cv-tile>
                <cv-row colspan="3" row="first">
                    <cv-value>
                        <cv-address transform="OH:string" mode="read" backend="main">Sink_Tuxedo_Album</cv-address>
                        <label class="value secondary"/>
                    </cv-value>
                    <cv-value>
                        <cv-address transform="OH:string" mode="read" backend="main">Sink_Tuxedo_Title</cv-address>
                        <label class="value primary medium"/>
                    </cv-value>
                </cv-row>
                <cv-button class="round-button" row="2" column="1" size="small">
                    <cv-address transform="OH:raw" backend="main" value="PREVIOUS" mode="write">Sink_Tuxedo_Control</cv-address>
                    <cv-icon>ri-skip-back-mini-fill</cv-icon>
                </cv-button>
                <cv-button class="round-button" row="2" column="2" mapping="PlayStop" progress-mapping="PlayProgress">
                    <cv-address transform="OH:playPause" backend="main">Sink_Tuxedo_Control</cv-address>
                    <cv-address transform="OH:number" backend="main" mode="read" target="progress">Sink_Tuxedo_PlayTime</cv-address>
                    <cv-address transform="OH:number" backend="main" mode="read" target="store:duration">Sink_Tuxedo_Duration</cv-address>
                    <cv-icon class="value">ri-stop-fill</cv-icon>
                </cv-button>
                <cv-button class="round-button" row="2" column="3" size="small">
                    <cv-address transform="OH:raw" backend="main" value="NEXT" mode="write">Sink_Tuxedo_Control</cv-address>
                    <cv-icon>ri-skip-forward-mini-fill</cv-icon>
                </cv-button>
                <cv-slider row="3" min="0" max="100" format="%d %%" throttle-interval="0">
                    <cv-address transform="OH:number" backend="main">Sink_Tuxedo_Volume</cv-address>
                    <cv-icon class="decrease">ri-volume-down-line</cv-icon>
                    <cv-icon class="increase">ri-volume-up-line</cv-icon>
                </cv-slider>
                <cv-address transform="OH:string" backend="main" mode="read" target="background-image">Sink_Tuxedo_CoverArt</cv-address>
                <cv-address transform="OH:thing:status" backend="main" mode="read" target="show-exclude">squeezebox:squeezeboxplayer:lms:Tuxedo</cv-address>
            </cv-tile>
            <cv-tile>
                <cv-spinner format="%.1f °C" min="15" max="25" step-width="0.5" colspan="3">
                    <cv-address transform="OH:number" backend="main">Temperature_SF_Office_Target</cv-address>
                    <cv-address transform="OH:string" backend="main" mode="read" target="show-hide" mapping="RtcOn">HVAC_SF_Office</cv-address>
                    <label class="value primary"/>
                </cv-spinner>
                <cv-select row="2" colspan="3">
                    <cv-address transform="OH:string" backend="main">HVAC_SF_Office</cv-address>
                    <cv-option key="auto"><cv-icon>ri-character-recognition-line</cv-icon>Auto</cv-option>
                    <cv-option key="stondby"><cv-icon>ri-shut-down-line</cv-icon>Aus</cv-option>
                    <cv-option key="economy"><cv-icon>ri-leaf-line</cv-icon>Eco</cv-option>
                    <cv-option key="comfort"><cv-icon>ri-temp-cold-line</cv-icon>Komfort</cv-option>
                    <cv-option key="building protection"><cv-icon>ri-shield-line</cv-icon>Frostschutz</cv-option>
                </cv-select>
                <cv-row colspan="3" row="3">
                    <label class="primary">RTC</label>
                </cv-row>
            </cv-tile>
            <cv-info mapping="kWh">
                <cv-address slot="address" backend="mqtt" mode="read" transform="MQTT:number">vzlogger/data/chn0/raw</cv-address>
                <span slot="label">Zählerstand</span>
                <span slot="unit">kWh</span>
            </cv-info>
            <cv-info mapping="kWh">
                <cv-address slot="address" backend="mqtt" mode="read" transform="MQTT:number">vzlogger/data/chn1/raw</cv-address>
                <span slot="label">Einspeisung</span>
                <span slot="unit">kWh</span>
            </cv-info>
            <cv-info format="%.2f">
                <cv-address slot="address" backend="mqtt" mode="read" transform="MQTT:number">vzlogger/data/chn2/raw</cv-address>
                <span slot="label">Stromverbrauch</span>
                <span slot="unit">W</span>
            </cv-info>
        </cv-group>
        <cv-group>
            <summary>Show values</summary>
            <cv-tile>
                <cv-row colspan="3" row="last">
                    <label class="secondary">Meter</label>
                </cv-row>
                <cv-row colspan="3" row="2">
                    <cv-value>
                        <cv-address transform="OH:number" mode="read" backend="si">Test_Value</cv-address>
                        <meter class="value" min="0" max="100"/>
                    </cv-value>
                </cv-row>
            </cv-tile>
            <cv-tile size="2x4">
                <cv-image src="http://192.168.178.24/Streaming/channels/1/picture?snapShotImageType=JPEG" refresh="60" authorization="basic" username="viewer" password="viewer" proxy="true"/>
            </cv-tile>
        </cv-group>
        <cv-tile size="2x1">
            <cv-chart format="%.1f °C" series="day" refresh="300" colspan="3" rowspan="3">
                <dataset type="line" src="Temperature_FF_Living" src-type="rrd"/>
            </cv-chart>
        </cv-tile>
    </cv-page>
        <cv-page id="rooms" name="Räume">
            <cv-status format="%d an">
                <cv-icon slot="icon" size="x-large">ri-lightbulb-line</cv-icon>
                <cv-address slot="address" transform="OH:number" mode="read" backend="main">number:Lights</cv-address>
                <span slot="label">Lichter</span>
            </cv-status>
            <cv-tile size="1x2">
                <cv-list rowspan="3" colspan="3">
                    <model sort-by="label" sort-mode="desc">
                        <script><![CDATA[
                    for (let i = 0; i < Math.round(Math.random()*10); i++) {
                        model.push({
                            label: 'This is list item no ' + i,
                            subLabel: 'Sublabel number ' + i
                        })
                    }
                   ]]>
                        </script>
                    </model>
                    <template>
                        <li>
                            <label class="primary">${label}</label>
                            <label class="secondary">${subLabel}</label>
                        </li>
                    </template>
                </cv-list>
            </cv-tile>
            <cv-page id="livingFF" name="Wohnzimmer"/>
            <cv-page id="diningFF" name="Esszimmer"/>
        </cv-page>
        <cv-page id="functions" name="Funktionen">
            <cv-page id="light" name="Licht"/>
            <cv-page id="blinds" name="Rollladen"/>
            <cv-page id="audio" name="Musik"/>
        </cv-page>
        <cv-page id="comm" name="Kommunikation">
            <h1>Headline of parent</h1>
            <cv-page id="visitors" name="Besucher">
                <p>Hello World!</p>
            </cv-page>
            <cv-page id="calls" name="Anrufe"/>
        </cv-page>
        <cv-popup modal="true" style="padding: 0" auto-close-timeout="120">
            <cv-image style="width: 470px" src="http://192.168.178.24/ISAPI/streaming/channels/1/picture" refresh="2" authorization="basic" username="viewer" password="viewer" proxy="true"/>
            <cv-button class="bottom green overlay">
                <cv-address backend="main" mode="readwrite" transform="OH:switch" on="down" value="1">Switch_GF_FrontDoor</cv-address>
                <cv-address backend="main" mode="write" transform="OH:switch" on="up" value="0">Switch_GF_FrontDoor</cv-address>
                <label class="primary value">Öffnen</label>
            </cv-button>
            <cv-address backend="main" mode="read" transform="OH:switch" target="open">Bell_FF</cv-address>
        </cv-popup>
        <aside>
            <p>This is my right side content</p>
        </aside>
    </main>

    <footer>
        <p>This is my footer</p>
    </footer>
</config>
